var NE=Object.defineProperty;var BE=(_e,et,rt)=>et in _e?NE(_e,et,{enumerable:!0,configurable:!0,writable:!0,value:rt}):_e[et]=rt;var $o=(_e,et,rt)=>(BE(_e,typeof et!="symbol"?et+"":et,rt),rt),X0=(_e,et,rt)=>{if(!et.has(_e))throw TypeError("Cannot "+rt)};var It=(_e,et,rt)=>(X0(_e,et,"read from private field"),rt?rt.call(_e):et.get(_e)),Bn=(_e,et,rt)=>{if(et.has(_e))throw TypeError("Cannot add the same private member more than once");et instanceof WeakSet?et.add(_e):et.set(_e,rt)},yr=(_e,et,rt,at)=>(X0(_e,et,"write to private field"),at?at.call(_e,rt):et.set(_e,rt),rt);var Q_=(_e,et,rt,at)=>({set _(ut){yr(_e,et,ut,rt)},get _(){return It(_e,et,at)}}),nr=(_e,et,rt)=>(X0(_e,et,"access private method"),rt);function _mergeNamespaces(_e,et){for(var rt=0;rt<et.length;rt++){const at=et[rt];if(typeof at!="string"&&!Array.isArray(at)){for(const ut in at)if(ut!=="default"&&!(ut in _e)){const pt=Object.getOwnPropertyDescriptor(at,ut);pt&&Object.defineProperty(_e,ut,pt.get?pt:{enumerable:!0,get:()=>at[ut]})}}}return Object.freeze(Object.defineProperty(_e,Symbol.toStringTag,{value:"Module"}))}(function(){const et=document.createElement("link").relList;if(et&&et.supports&&et.supports("modulepreload"))return;for(const ut of document.querySelectorAll('link[rel="modulepreload"]'))at(ut);new MutationObserver(ut=>{for(const pt of ut)if(pt.type==="childList")for(const yt of pt.addedNodes)yt.tagName==="LINK"&&yt.rel==="modulepreload"&&at(yt)}).observe(document,{childList:!0,subtree:!0});function rt(ut){const pt={};return ut.integrity&&(pt.integrity=ut.integrity),ut.referrerPolicy&&(pt.referrerPolicy=ut.referrerPolicy),ut.crossOrigin==="use-credentials"?pt.credentials="include":ut.crossOrigin==="anonymous"?pt.credentials="omit":pt.credentials="same-origin",pt}function at(ut){if(ut.ep)return;ut.ep=!0;const pt=rt(ut);fetch(ut.href,pt)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(_e){return _e&&_e.__esModule&&Object.prototype.hasOwnProperty.call(_e,"default")?_e.default:_e}function getAugmentedNamespace(_e){if(_e.__esModule)return _e;var et=_e.default;if(typeof et=="function"){var rt=function at(){return this instanceof at?Reflect.construct(et,arguments,this.constructor):et.apply(this,arguments)};rt.prototype=et.prototype}else rt={};return Object.defineProperty(rt,"__esModule",{value:!0}),Object.keys(_e).forEach(function(at){var ut=Object.getOwnPropertyDescriptor(_e,at);Object.defineProperty(rt,at,ut.get?ut:{enumerable:!0,get:function(){return _e[at]}})}),rt}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$3=Symbol.for("react.element"),n$5=Symbol.for("react.portal"),p$5=Symbol.for("react.fragment"),q$3=Symbol.for("react.strict_mode"),r$2=Symbol.for("react.profiler"),t$3=Symbol.for("react.provider"),u$4=Symbol.for("react.context"),v$3=Symbol.for("react.forward_ref"),w$2=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$2(_e){return _e===null||typeof _e!="object"?null:(_e=z$1&&_e[z$1]||_e["@@iterator"],typeof _e=="function"?_e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$2={};function E$1(_e,et,rt){this.props=_e,this.context=et,this.refs=D$2,this.updater=rt||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(_e,et){if(typeof _e!="object"&&typeof _e!="function"&&_e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_e,et,"setState")};E$1.prototype.forceUpdate=function(_e){this.updater.enqueueForceUpdate(this,_e,"forceUpdate")};function F$1(){}F$1.prototype=E$1.prototype;function G$2(_e,et,rt){this.props=_e,this.context=et,this.refs=D$2,this.updater=rt||B$1}var H$1=G$2.prototype=new F$1;H$1.constructor=G$2;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$2(_e,et,rt){var at,ut={},pt=null,yt=null;if(et!=null)for(at in et.ref!==void 0&&(yt=et.ref),et.key!==void 0&&(pt=""+et.key),et)J$1.call(et,at)&&!L$1.hasOwnProperty(at)&&(ut[at]=et[at]);var ct=arguments.length-2;if(ct===1)ut.children=rt;else if(1<ct){for(var At=Array(ct),Pt=0;Pt<ct;Pt++)At[Pt]=arguments[Pt+2];ut.children=At}if(_e&&_e.defaultProps)for(at in ct=_e.defaultProps,ct)ut[at]===void 0&&(ut[at]=ct[at]);return{$$typeof:l$3,type:_e,key:pt,ref:yt,props:ut,_owner:K$1.current}}function N$1(_e,et){return{$$typeof:l$3,type:_e.type,key:et,ref:_e.ref,props:_e.props,_owner:_e._owner}}function O$2(_e){return typeof _e=="object"&&_e!==null&&_e.$$typeof===l$3}function escape$1(_e){var et={"=":"=0",":":"=2"};return"$"+_e.replace(/[=:]/g,function(rt){return et[rt]})}var P$2=/\/+/g;function Q$2(_e,et){return typeof _e=="object"&&_e!==null&&_e.key!=null?escape$1(""+_e.key):et.toString(36)}function R$1(_e,et,rt,at,ut){var pt=typeof _e;(pt==="undefined"||pt==="boolean")&&(_e=null);var yt=!1;if(_e===null)yt=!0;else switch(pt){case"string":case"number":yt=!0;break;case"object":switch(_e.$$typeof){case l$3:case n$5:yt=!0}}if(yt)return yt=_e,ut=ut(yt),_e=at===""?"."+Q$2(yt,0):at,I$2(ut)?(rt="",_e!=null&&(rt=_e.replace(P$2,"$&/")+"/"),R$1(ut,et,rt,"",function(Pt){return Pt})):ut!=null&&(O$2(ut)&&(ut=N$1(ut,rt+(!ut.key||yt&&yt.key===ut.key?"":(""+ut.key).replace(P$2,"$&/")+"/")+_e)),et.push(ut)),1;if(yt=0,at=at===""?".":at+":",I$2(_e))for(var ct=0;ct<_e.length;ct++){pt=_e[ct];var At=at+Q$2(pt,ct);yt+=R$1(pt,et,rt,At,ut)}else if(At=A$2(_e),typeof At=="function")for(_e=At.call(_e),ct=0;!(pt=_e.next()).done;)pt=pt.value,At=at+Q$2(pt,ct++),yt+=R$1(pt,et,rt,At,ut);else if(pt==="object")throw et=String(_e),Error("Objects are not valid as a React child (found: "+(et==="[object Object]"?"object with keys {"+Object.keys(_e).join(", ")+"}":et)+"). If you meant to render a collection of children, use an array instead.");return yt}function S$2(_e,et,rt){if(_e==null)return _e;var at=[],ut=0;return R$1(_e,at,"","",function(pt){return et.call(rt,pt,ut++)}),at}function T$2(_e){if(_e._status===-1){var et=_e._result;et=et(),et.then(function(rt){(_e._status===0||_e._status===-1)&&(_e._status=1,_e._result=rt)},function(rt){(_e._status===0||_e._status===-1)&&(_e._status=2,_e._result=rt)}),_e._status===-1&&(_e._status=0,_e._result=et)}if(_e._status===1)return _e._result.default;throw _e._result}var U$2={current:null},V$2={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$1};react_production_min.Children={map:S$2,forEach:function(_e,et,rt){S$2(_e,function(){et.apply(this,arguments)},rt)},count:function(_e){var et=0;return S$2(_e,function(){et++}),et},toArray:function(_e){return S$2(_e,function(et){return et})||[]},only:function(_e){if(!O$2(_e))throw Error("React.Children.only expected to receive a single React element child.");return _e}};react_production_min.Component=E$1;react_production_min.Fragment=p$5;react_production_min.Profiler=r$2;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$3;react_production_min.Suspense=w$2;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$2;react_production_min.cloneElement=function(_e,et,rt){if(_e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+_e+".");var at=C$1({},_e.props),ut=_e.key,pt=_e.ref,yt=_e._owner;if(et!=null){if(et.ref!==void 0&&(pt=et.ref,yt=K$1.current),et.key!==void 0&&(ut=""+et.key),_e.type&&_e.type.defaultProps)var ct=_e.type.defaultProps;for(At in et)J$1.call(et,At)&&!L$1.hasOwnProperty(At)&&(at[At]=et[At]===void 0&&ct!==void 0?ct[At]:et[At])}var At=arguments.length-2;if(At===1)at.children=rt;else if(1<At){ct=Array(At);for(var Pt=0;Pt<At;Pt++)ct[Pt]=arguments[Pt+2];at.children=ct}return{$$typeof:l$3,type:_e.type,key:ut,ref:pt,props:at,_owner:yt}};react_production_min.createContext=function(_e){return _e={$$typeof:u$4,_currentValue:_e,_currentValue2:_e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},_e.Provider={$$typeof:t$3,_context:_e},_e.Consumer=_e};react_production_min.createElement=M$2;react_production_min.createFactory=function(_e){var et=M$2.bind(null,_e);return et.type=_e,et};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(_e){return{$$typeof:v$3,render:_e}};react_production_min.isValidElement=O$2;react_production_min.lazy=function(_e){return{$$typeof:y,_payload:{_status:-1,_result:_e},_init:T$2}};react_production_min.memo=function(_e,et){return{$$typeof:x,type:_e,compare:et===void 0?null:et}};react_production_min.startTransition=function(_e){var et=V$2.transition;V$2.transition={};try{_e()}finally{V$2.transition=et}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(_e,et){return U$2.current.useCallback(_e,et)};react_production_min.useContext=function(_e){return U$2.current.useContext(_e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(_e){return U$2.current.useDeferredValue(_e)};react_production_min.useEffect=function(_e,et){return U$2.current.useEffect(_e,et)};react_production_min.useId=function(){return U$2.current.useId()};react_production_min.useImperativeHandle=function(_e,et,rt){return U$2.current.useImperativeHandle(_e,et,rt)};react_production_min.useInsertionEffect=function(_e,et){return U$2.current.useInsertionEffect(_e,et)};react_production_min.useLayoutEffect=function(_e,et){return U$2.current.useLayoutEffect(_e,et)};react_production_min.useMemo=function(_e,et){return U$2.current.useMemo(_e,et)};react_production_min.useReducer=function(_e,et,rt){return U$2.current.useReducer(_e,et,rt)};react_production_min.useRef=function(_e){return U$2.current.useRef(_e)};react_production_min.useState=function(_e){return U$2.current.useState(_e)};react_production_min.useSyncExternalStore=function(_e,et,rt){return U$2.current.useSyncExternalStore(_e,et,rt)};react_production_min.useTransition=function(){return U$2.current.useTransition()};react_production_min.version="18.2.0";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$2=Symbol.for("react.fragment"),m$3=Object.prototype.hasOwnProperty,n$4=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$4={key:!0,ref:!0,__self:!0,__source:!0};function q$2(_e,et,rt){var at,ut={},pt=null,yt=null;rt!==void 0&&(pt=""+rt),et.key!==void 0&&(pt=""+et.key),et.ref!==void 0&&(yt=et.ref);for(at in et)m$3.call(et,at)&&!p$4.hasOwnProperty(at)&&(ut[at]=et[at]);if(_e&&_e.defaultProps)for(at in et=_e.defaultProps,et)ut[at]===void 0&&(ut[at]=et[at]);return{$$typeof:k$1,type:_e,key:pt,ref:yt,props:ut,_owner:n$4.current}}reactJsxRuntime_production_min.Fragment=l$2;reactJsxRuntime_production_min.jsx=q$2;reactJsxRuntime_production_min.jsxs=q$2;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(_e){function et(Pn,lr){var xr=Pn.length;Pn.push(lr);e:for(;0<xr;){var Dr=xr-1>>>1,$r=Pn[Dr];if(0<ut($r,lr))Pn[Dr]=lr,Pn[xr]=$r,xr=Dr;else break e}}function rt(Pn){return Pn.length===0?null:Pn[0]}function at(Pn){if(Pn.length===0)return null;var lr=Pn[0],xr=Pn.pop();if(xr!==lr){Pn[0]=xr;e:for(var Dr=0,$r=Pn.length,An=$r>>>1;Dr<An;){var Nt=2*(Dr+1)-1,Zt=Pn[Nt],$t=Nt+1,rn=Pn[$t];if(0>ut(Zt,xr))$t<$r&&0>ut(rn,Zt)?(Pn[Dr]=rn,Pn[$t]=xr,Dr=$t):(Pn[Dr]=Zt,Pn[Nt]=xr,Dr=Nt);else if($t<$r&&0>ut(rn,xr))Pn[Dr]=rn,Pn[$t]=xr,Dr=$t;else break e}}return lr}function ut(Pn,lr){var xr=Pn.sortIndex-lr.sortIndex;return xr!==0?xr:Pn.id-lr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var pt=performance;_e.unstable_now=function(){return pt.now()}}else{var yt=Date,ct=yt.now();_e.unstable_now=function(){return yt.now()-ct}}var At=[],Pt=[],kt=1,Lt=null,Mt=3,Qt=!1,Jt=!1,sn=!1,tn=typeof setTimeout=="function"?setTimeout:null,Bt=typeof clearTimeout=="function"?clearTimeout:null,zt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ht(Pn){for(var lr=rt(Pt);lr!==null;){if(lr.callback===null)at(Pt);else if(lr.startTime<=Pn)at(Pt),lr.sortIndex=lr.expirationTime,et(At,lr);else break;lr=rt(Pt)}}function nn(Pn){if(sn=!1,Ht(Pn),!Jt)if(rt(At)!==null)Jt=!0,gr(Ot);else{var lr=rt(Pt);lr!==null&&br(nn,lr.startTime-Pn)}}function Ot(Pn,lr){Jt=!1,sn&&(sn=!1,Bt(hn),hn=-1),Qt=!0;var xr=Mt;try{for(Ht(lr),Lt=rt(At);Lt!==null&&(!(Lt.expirationTime>lr)||Pn&&!fn());){var Dr=Lt.callback;if(typeof Dr=="function"){Lt.callback=null,Mt=Lt.priorityLevel;var $r=Dr(Lt.expirationTime<=lr);lr=_e.unstable_now(),typeof $r=="function"?Lt.callback=$r:Lt===rt(At)&&at(At),Ht(lr)}else at(At);Lt=rt(At)}if(Lt!==null)var An=!0;else{var Nt=rt(Pt);Nt!==null&&br(nn,Nt.startTime-lr),An=!1}return An}finally{Lt=null,Mt=xr,Qt=!1}}var Kt=!1,mn=null,hn=-1,Yt=5,vn=-1;function fn(){return!(_e.unstable_now()-vn<Yt)}function Wn(){if(mn!==null){var Pn=_e.unstable_now();vn=Pn;var lr=!0;try{lr=mn(!0,Pn)}finally{lr?Xn():(Kt=!1,mn=null)}}else Kt=!1}var Xn;if(typeof zt=="function")Xn=function(){zt(Wn)};else if(typeof MessageChannel<"u"){var Sn=new MessageChannel,_i=Sn.port2;Sn.port1.onmessage=Wn,Xn=function(){_i.postMessage(null)}}else Xn=function(){tn(Wn,0)};function gr(Pn){mn=Pn,Kt||(Kt=!0,Xn())}function br(Pn,lr){hn=tn(function(){Pn(_e.unstable_now())},lr)}_e.unstable_IdlePriority=5,_e.unstable_ImmediatePriority=1,_e.unstable_LowPriority=4,_e.unstable_NormalPriority=3,_e.unstable_Profiling=null,_e.unstable_UserBlockingPriority=2,_e.unstable_cancelCallback=function(Pn){Pn.callback=null},_e.unstable_continueExecution=function(){Jt||Qt||(Jt=!0,gr(Ot))},_e.unstable_forceFrameRate=function(Pn){0>Pn||125<Pn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Yt=0<Pn?Math.floor(1e3/Pn):5},_e.unstable_getCurrentPriorityLevel=function(){return Mt},_e.unstable_getFirstCallbackNode=function(){return rt(At)},_e.unstable_next=function(Pn){switch(Mt){case 1:case 2:case 3:var lr=3;break;default:lr=Mt}var xr=Mt;Mt=lr;try{return Pn()}finally{Mt=xr}},_e.unstable_pauseExecution=function(){},_e.unstable_requestPaint=function(){},_e.unstable_runWithPriority=function(Pn,lr){switch(Pn){case 1:case 2:case 3:case 4:case 5:break;default:Pn=3}var xr=Mt;Mt=Pn;try{return lr()}finally{Mt=xr}},_e.unstable_scheduleCallback=function(Pn,lr,xr){var Dr=_e.unstable_now();switch(typeof xr=="object"&&xr!==null?(xr=xr.delay,xr=typeof xr=="number"&&0<xr?Dr+xr:Dr):xr=Dr,Pn){case 1:var $r=-1;break;case 2:$r=250;break;case 5:$r=1073741823;break;case 4:$r=1e4;break;default:$r=5e3}return $r=xr+$r,Pn={id:kt++,callback:lr,priorityLevel:Pn,startTime:xr,expirationTime:$r,sortIndex:-1},xr>Dr?(Pn.sortIndex=xr,et(Pt,Pn),rt(At)===null&&Pn===rt(Pt)&&(sn?(Bt(hn),hn=-1):sn=!0,br(nn,xr-Dr))):(Pn.sortIndex=$r,et(At,Pn),Jt||Qt||(Jt=!0,gr(Ot))),Pn},_e.unstable_shouldYield=fn,_e.unstable_wrapCallback=function(Pn){var lr=Mt;return function(){var xr=Mt;Mt=lr;try{return Pn.apply(this,arguments)}finally{Mt=xr}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$3(_e){for(var et="https://reactjs.org/docs/error-decoder.html?invariant="+_e,rt=1;rt<arguments.length;rt++)et+="&args[]="+encodeURIComponent(arguments[rt]);return"Minified React error #"+_e+"; visit "+et+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(_e,et){ha(_e,et),ha(_e+"Capture",et)}function ha(_e,et){for(ea[_e]=et,_e=0;_e<et.length;_e++)da.add(et[_e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(_e){return ja.call(ma,_e)?!0:ja.call(la,_e)?!1:ka.test(_e)?ma[_e]=!0:(la[_e]=!0,!1)}function pa(_e,et,rt,at){if(rt!==null&&rt.type===0)return!1;switch(typeof et){case"function":case"symbol":return!0;case"boolean":return at?!1:rt!==null?!rt.acceptsBooleans:(_e=_e.toLowerCase().slice(0,5),_e!=="data-"&&_e!=="aria-");default:return!1}}function qa(_e,et,rt,at){if(et===null||typeof et>"u"||pa(_e,et,rt,at))return!0;if(at)return!1;if(rt!==null)switch(rt.type){case 3:return!et;case 4:return et===!1;case 5:return isNaN(et);case 6:return isNaN(et)||1>et}return!1}function v$2(_e,et,rt,at,ut,pt,yt){this.acceptsBooleans=et===2||et===3||et===4,this.attributeName=at,this.attributeNamespace=ut,this.mustUseProperty=rt,this.propertyName=_e,this.type=et,this.sanitizeURL=pt,this.removeEmptyString=yt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(_e){z[_e]=new v$2(_e,0,!1,_e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(_e){var et=_e[0];z[et]=new v$2(et,1,!1,_e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(_e){z[_e]=new v$2(_e,2,!1,_e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(_e){z[_e]=new v$2(_e,2,!1,_e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(_e){z[_e]=new v$2(_e,3,!1,_e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(_e){z[_e]=new v$2(_e,3,!0,_e,null,!1,!1)});["capture","download"].forEach(function(_e){z[_e]=new v$2(_e,4,!1,_e,null,!1,!1)});["cols","rows","size","span"].forEach(function(_e){z[_e]=new v$2(_e,6,!1,_e,null,!1,!1)});["rowSpan","start"].forEach(function(_e){z[_e]=new v$2(_e,5,!1,_e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(_e){return _e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(_e){var et=_e.replace(ra,sa);z[et]=new v$2(et,1,!1,_e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(_e){var et=_e.replace(ra,sa);z[et]=new v$2(et,1,!1,_e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(_e){var et=_e.replace(ra,sa);z[et]=new v$2(et,1,!1,_e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(_e){z[_e]=new v$2(_e,1,!1,_e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$2("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(_e){z[_e]=new v$2(_e,1,!1,_e.toLowerCase(),null,!0,!0)});function ta(_e,et,rt,at){var ut=z.hasOwnProperty(et)?z[et]:null;(ut!==null?ut.type!==0:at||!(2<et.length)||et[0]!=="o"&&et[0]!=="O"||et[1]!=="n"&&et[1]!=="N")&&(qa(et,rt,ut,at)&&(rt=null),at||ut===null?oa(et)&&(rt===null?_e.removeAttribute(et):_e.setAttribute(et,""+rt)):ut.mustUseProperty?_e[ut.propertyName]=rt===null?ut.type===3?!1:"":rt:(et=ut.attributeName,at=ut.attributeNamespace,rt===null?_e.removeAttribute(et):(ut=ut.type,rt=ut===3||ut===4&&rt===!0?"":""+rt,at?_e.setAttributeNS(at,et,rt):_e.setAttribute(et,rt))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(_e){return _e===null||typeof _e!="object"?null:(_e=Ja&&_e[Ja]||_e["@@iterator"],typeof _e=="function"?_e:null)}var A$1=Object.assign,La;function Ma(_e){if(La===void 0)try{throw Error()}catch(rt){var et=rt.stack.trim().match(/\n( *(at )?)/);La=et&&et[1]||""}return`
`+La+_e}var Na=!1;function Oa(_e,et){if(!_e||Na)return"";Na=!0;var rt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(et)if(et=function(){throw Error()},Object.defineProperty(et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(et,[])}catch(Pt){var at=Pt}Reflect.construct(_e,[],et)}else{try{et.call()}catch(Pt){at=Pt}_e.call(et.prototype)}else{try{throw Error()}catch(Pt){at=Pt}_e()}}catch(Pt){if(Pt&&at&&typeof Pt.stack=="string"){for(var ut=Pt.stack.split(`
`),pt=at.stack.split(`
`),yt=ut.length-1,ct=pt.length-1;1<=yt&&0<=ct&&ut[yt]!==pt[ct];)ct--;for(;1<=yt&&0<=ct;yt--,ct--)if(ut[yt]!==pt[ct]){if(yt!==1||ct!==1)do if(yt--,ct--,0>ct||ut[yt]!==pt[ct]){var At=`
`+ut[yt].replace(" at new "," at ");return _e.displayName&&At.includes("<anonymous>")&&(At=At.replace("<anonymous>",_e.displayName)),At}while(1<=yt&&0<=ct);break}}}finally{Na=!1,Error.prepareStackTrace=rt}return(_e=_e?_e.displayName||_e.name:"")?Ma(_e):""}function Pa(_e){switch(_e.tag){case 5:return Ma(_e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return _e=Oa(_e.type,!1),_e;case 11:return _e=Oa(_e.type.render,!1),_e;case 1:return _e=Oa(_e.type,!0),_e;default:return""}}function Qa(_e){if(_e==null)return null;if(typeof _e=="function")return _e.displayName||_e.name||null;if(typeof _e=="string")return _e;switch(_e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof _e=="object")switch(_e.$$typeof){case Ca:return(_e.displayName||"Context")+".Consumer";case Ba:return(_e._context.displayName||"Context")+".Provider";case Da:var et=_e.render;return _e=_e.displayName,_e||(_e=et.displayName||et.name||"",_e=_e!==""?"ForwardRef("+_e+")":"ForwardRef"),_e;case Ga:return et=_e.displayName||null,et!==null?et:Qa(_e.type)||"Memo";case Ha:et=_e._payload,_e=_e._init;try{return Qa(_e(et))}catch{}}return null}function Ra(_e){var et=_e.type;switch(_e.tag){case 24:return"Cache";case 9:return(et.displayName||"Context")+".Consumer";case 10:return(et._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _e=et.render,_e=_e.displayName||_e.name||"",et.displayName||(_e!==""?"ForwardRef("+_e+")":"ForwardRef");case 7:return"Fragment";case 5:return et;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(et);case 8:return et===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof et=="function")return et.displayName||et.name||null;if(typeof et=="string")return et}return null}function Sa(_e){switch(typeof _e){case"boolean":case"number":case"string":case"undefined":return _e;case"object":return _e;default:return""}}function Ta(_e){var et=_e.type;return(_e=_e.nodeName)&&_e.toLowerCase()==="input"&&(et==="checkbox"||et==="radio")}function Ua(_e){var et=Ta(_e)?"checked":"value",rt=Object.getOwnPropertyDescriptor(_e.constructor.prototype,et),at=""+_e[et];if(!_e.hasOwnProperty(et)&&typeof rt<"u"&&typeof rt.get=="function"&&typeof rt.set=="function"){var ut=rt.get,pt=rt.set;return Object.defineProperty(_e,et,{configurable:!0,get:function(){return ut.call(this)},set:function(yt){at=""+yt,pt.call(this,yt)}}),Object.defineProperty(_e,et,{enumerable:rt.enumerable}),{getValue:function(){return at},setValue:function(yt){at=""+yt},stopTracking:function(){_e._valueTracker=null,delete _e[et]}}}}function Va(_e){_e._valueTracker||(_e._valueTracker=Ua(_e))}function Wa(_e){if(!_e)return!1;var et=_e._valueTracker;if(!et)return!0;var rt=et.getValue(),at="";return _e&&(at=Ta(_e)?_e.checked?"true":"false":_e.value),_e=at,_e!==rt?(et.setValue(_e),!0):!1}function Xa(_e){if(_e=_e||(typeof document<"u"?document:void 0),typeof _e>"u")return null;try{return _e.activeElement||_e.body}catch{return _e.body}}function Ya(_e,et){var rt=et.checked;return A$1({},et,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:rt??_e._wrapperState.initialChecked})}function Za(_e,et){var rt=et.defaultValue==null?"":et.defaultValue,at=et.checked!=null?et.checked:et.defaultChecked;rt=Sa(et.value!=null?et.value:rt),_e._wrapperState={initialChecked:at,initialValue:rt,controlled:et.type==="checkbox"||et.type==="radio"?et.checked!=null:et.value!=null}}function ab(_e,et){et=et.checked,et!=null&&ta(_e,"checked",et,!1)}function bb(_e,et){ab(_e,et);var rt=Sa(et.value),at=et.type;if(rt!=null)at==="number"?(rt===0&&_e.value===""||_e.value!=rt)&&(_e.value=""+rt):_e.value!==""+rt&&(_e.value=""+rt);else if(at==="submit"||at==="reset"){_e.removeAttribute("value");return}et.hasOwnProperty("value")?cb(_e,et.type,rt):et.hasOwnProperty("defaultValue")&&cb(_e,et.type,Sa(et.defaultValue)),et.checked==null&&et.defaultChecked!=null&&(_e.defaultChecked=!!et.defaultChecked)}function db(_e,et,rt){if(et.hasOwnProperty("value")||et.hasOwnProperty("defaultValue")){var at=et.type;if(!(at!=="submit"&&at!=="reset"||et.value!==void 0&&et.value!==null))return;et=""+_e._wrapperState.initialValue,rt||et===_e.value||(_e.value=et),_e.defaultValue=et}rt=_e.name,rt!==""&&(_e.name=""),_e.defaultChecked=!!_e._wrapperState.initialChecked,rt!==""&&(_e.name=rt)}function cb(_e,et,rt){(et!=="number"||Xa(_e.ownerDocument)!==_e)&&(rt==null?_e.defaultValue=""+_e._wrapperState.initialValue:_e.defaultValue!==""+rt&&(_e.defaultValue=""+rt))}var eb=Array.isArray;function fb(_e,et,rt,at){if(_e=_e.options,et){et={};for(var ut=0;ut<rt.length;ut++)et["$"+rt[ut]]=!0;for(rt=0;rt<_e.length;rt++)ut=et.hasOwnProperty("$"+_e[rt].value),_e[rt].selected!==ut&&(_e[rt].selected=ut),ut&&at&&(_e[rt].defaultSelected=!0)}else{for(rt=""+Sa(rt),et=null,ut=0;ut<_e.length;ut++){if(_e[ut].value===rt){_e[ut].selected=!0,at&&(_e[ut].defaultSelected=!0);return}et!==null||_e[ut].disabled||(et=_e[ut])}et!==null&&(et.selected=!0)}}function gb(_e,et){if(et.dangerouslySetInnerHTML!=null)throw Error(p$3(91));return A$1({},et,{value:void 0,defaultValue:void 0,children:""+_e._wrapperState.initialValue})}function hb(_e,et){var rt=et.value;if(rt==null){if(rt=et.children,et=et.defaultValue,rt!=null){if(et!=null)throw Error(p$3(92));if(eb(rt)){if(1<rt.length)throw Error(p$3(93));rt=rt[0]}et=rt}et==null&&(et=""),rt=et}_e._wrapperState={initialValue:Sa(rt)}}function ib(_e,et){var rt=Sa(et.value),at=Sa(et.defaultValue);rt!=null&&(rt=""+rt,rt!==_e.value&&(_e.value=rt),et.defaultValue==null&&_e.defaultValue!==rt&&(_e.defaultValue=rt)),at!=null&&(_e.defaultValue=""+at)}function jb(_e){var et=_e.textContent;et===_e._wrapperState.initialValue&&et!==""&&et!==null&&(_e.value=et)}function kb(_e){switch(_e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(_e,et){return _e==null||_e==="http://www.w3.org/1999/xhtml"?kb(et):_e==="http://www.w3.org/2000/svg"&&et==="foreignObject"?"http://www.w3.org/1999/xhtml":_e}var mb,nb=function(_e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(et,rt,at,ut){MSApp.execUnsafeLocalFunction(function(){return _e(et,rt,at,ut)})}:_e}(function(_e,et){if(_e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in _e)_e.innerHTML=et;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+et.valueOf().toString()+"</svg>",et=mb.firstChild;_e.firstChild;)_e.removeChild(_e.firstChild);for(;et.firstChild;)_e.appendChild(et.firstChild)}});function ob(_e,et){if(et){var rt=_e.firstChild;if(rt&&rt===_e.lastChild&&rt.nodeType===3){rt.nodeValue=et;return}}_e.textContent=et}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(_e){qb.forEach(function(et){et=et+_e.charAt(0).toUpperCase()+_e.substring(1),pb[et]=pb[_e]})});function rb(_e,et,rt){return et==null||typeof et=="boolean"||et===""?"":rt||typeof et!="number"||et===0||pb.hasOwnProperty(_e)&&pb[_e]?(""+et).trim():et+"px"}function sb(_e,et){_e=_e.style;for(var rt in et)if(et.hasOwnProperty(rt)){var at=rt.indexOf("--")===0,ut=rb(rt,et[rt],at);rt==="float"&&(rt="cssFloat"),at?_e.setProperty(rt,ut):_e[rt]=ut}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(_e,et){if(et){if(tb[_e]&&(et.children!=null||et.dangerouslySetInnerHTML!=null))throw Error(p$3(137,_e));if(et.dangerouslySetInnerHTML!=null){if(et.children!=null)throw Error(p$3(60));if(typeof et.dangerouslySetInnerHTML!="object"||!("__html"in et.dangerouslySetInnerHTML))throw Error(p$3(61))}if(et.style!=null&&typeof et.style!="object")throw Error(p$3(62))}}function vb(_e,et){if(_e.indexOf("-")===-1)return typeof et.is=="string";switch(_e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(_e){return _e=_e.target||_e.srcElement||window,_e.correspondingUseElement&&(_e=_e.correspondingUseElement),_e.nodeType===3?_e.parentNode:_e}var yb=null,zb=null,Ab=null;function Bb(_e){if(_e=Cb(_e)){if(typeof yb!="function")throw Error(p$3(280));var et=_e.stateNode;et&&(et=Db(et),yb(_e.stateNode,_e.type,et))}}function Eb(_e){zb?Ab?Ab.push(_e):Ab=[_e]:zb=_e}function Fb(){if(zb){var _e=zb,et=Ab;if(Ab=zb=null,Bb(_e),et)for(_e=0;_e<et.length;_e++)Bb(et[_e])}}function Gb(_e,et){return _e(et)}function Hb(){}var Ib=!1;function Jb(_e,et,rt){if(Ib)return _e(et,rt);Ib=!0;try{return Gb(_e,et,rt)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(_e,et){var rt=_e.stateNode;if(rt===null)return null;var at=Db(rt);if(at===null)return null;rt=at[et];e:switch(et){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(at=!at.disabled)||(_e=_e.type,at=!(_e==="button"||_e==="input"||_e==="select"||_e==="textarea")),_e=!at;break e;default:_e=!1}if(_e)return null;if(rt&&typeof rt!="function")throw Error(p$3(231,et,typeof rt));return rt}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(_e,et,rt,at,ut,pt,yt,ct,At){var Pt=Array.prototype.slice.call(arguments,3);try{et.apply(rt,Pt)}catch(kt){this.onError(kt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(_e){Ob=!0,Pb=_e}};function Tb(_e,et,rt,at,ut,pt,yt,ct,At){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(_e,et,rt,at,ut,pt,yt,ct,At){if(Tb.apply(this,arguments),Ob){if(Ob){var Pt=Pb;Ob=!1,Pb=null}else throw Error(p$3(198));Qb||(Qb=!0,Rb=Pt)}}function Vb(_e){var et=_e,rt=_e;if(_e.alternate)for(;et.return;)et=et.return;else{_e=et;do et=_e,et.flags&4098&&(rt=et.return),_e=et.return;while(_e)}return et.tag===3?rt:null}function Wb(_e){if(_e.tag===13){var et=_e.memoizedState;if(et===null&&(_e=_e.alternate,_e!==null&&(et=_e.memoizedState)),et!==null)return et.dehydrated}return null}function Xb(_e){if(Vb(_e)!==_e)throw Error(p$3(188))}function Yb(_e){var et=_e.alternate;if(!et){if(et=Vb(_e),et===null)throw Error(p$3(188));return et!==_e?null:_e}for(var rt=_e,at=et;;){var ut=rt.return;if(ut===null)break;var pt=ut.alternate;if(pt===null){if(at=ut.return,at!==null){rt=at;continue}break}if(ut.child===pt.child){for(pt=ut.child;pt;){if(pt===rt)return Xb(ut),_e;if(pt===at)return Xb(ut),et;pt=pt.sibling}throw Error(p$3(188))}if(rt.return!==at.return)rt=ut,at=pt;else{for(var yt=!1,ct=ut.child;ct;){if(ct===rt){yt=!0,rt=ut,at=pt;break}if(ct===at){yt=!0,at=ut,rt=pt;break}ct=ct.sibling}if(!yt){for(ct=pt.child;ct;){if(ct===rt){yt=!0,rt=pt,at=ut;break}if(ct===at){yt=!0,at=pt,rt=ut;break}ct=ct.sibling}if(!yt)throw Error(p$3(189))}}if(rt.alternate!==at)throw Error(p$3(190))}if(rt.tag!==3)throw Error(p$3(188));return rt.stateNode.current===rt?_e:et}function Zb(_e){return _e=Yb(_e),_e!==null?$b(_e):null}function $b(_e){if(_e.tag===5||_e.tag===6)return _e;for(_e=_e.child;_e!==null;){var et=$b(_e);if(et!==null)return et;_e=_e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(_e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,_e,void 0,(_e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(_e){return _e>>>=0,_e===0?32:31-(pc(_e)/qc|0)|0}var rc=64,sc=4194304;function tc(_e){switch(_e&-_e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _e}}function uc(_e,et){var rt=_e.pendingLanes;if(rt===0)return 0;var at=0,ut=_e.suspendedLanes,pt=_e.pingedLanes,yt=rt&268435455;if(yt!==0){var ct=yt&~ut;ct!==0?at=tc(ct):(pt&=yt,pt!==0&&(at=tc(pt)))}else yt=rt&~ut,yt!==0?at=tc(yt):pt!==0&&(at=tc(pt));if(at===0)return 0;if(et!==0&&et!==at&&!(et&ut)&&(ut=at&-at,pt=et&-et,ut>=pt||ut===16&&(pt&4194240)!==0))return et;if(at&4&&(at|=rt&16),et=_e.entangledLanes,et!==0)for(_e=_e.entanglements,et&=at;0<et;)rt=31-oc(et),ut=1<<rt,at|=_e[rt],et&=~ut;return at}function vc(_e,et){switch(_e){case 1:case 2:case 4:return et+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return et+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(_e,et){for(var rt=_e.suspendedLanes,at=_e.pingedLanes,ut=_e.expirationTimes,pt=_e.pendingLanes;0<pt;){var yt=31-oc(pt),ct=1<<yt,At=ut[yt];At===-1?(!(ct&rt)||ct&at)&&(ut[yt]=vc(ct,et)):At<=et&&(_e.expiredLanes|=ct),pt&=~ct}}function xc(_e){return _e=_e.pendingLanes&-1073741825,_e!==0?_e:_e&1073741824?1073741824:0}function yc(){var _e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),_e}function zc(_e){for(var et=[],rt=0;31>rt;rt++)et.push(_e);return et}function Ac(_e,et,rt){_e.pendingLanes|=et,et!==536870912&&(_e.suspendedLanes=0,_e.pingedLanes=0),_e=_e.eventTimes,et=31-oc(et),_e[et]=rt}function Bc(_e,et){var rt=_e.pendingLanes&~et;_e.pendingLanes=et,_e.suspendedLanes=0,_e.pingedLanes=0,_e.expiredLanes&=et,_e.mutableReadLanes&=et,_e.entangledLanes&=et,et=_e.entanglements;var at=_e.eventTimes;for(_e=_e.expirationTimes;0<rt;){var ut=31-oc(rt),pt=1<<ut;et[ut]=0,at[ut]=-1,_e[ut]=-1,rt&=~pt}}function Cc(_e,et){var rt=_e.entangledLanes|=et;for(_e=_e.entanglements;rt;){var at=31-oc(rt),ut=1<<at;ut&et|_e[at]&et&&(_e[at]|=et),rt&=~ut}}var C=0;function Dc(_e){return _e&=-_e,1<_e?4<_e?_e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(_e,et){switch(_e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(et.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(et.pointerId)}}function Tc(_e,et,rt,at,ut,pt){return _e===null||_e.nativeEvent!==pt?(_e={blockedOn:et,domEventName:rt,eventSystemFlags:at,nativeEvent:pt,targetContainers:[ut]},et!==null&&(et=Cb(et),et!==null&&Fc(et)),_e):(_e.eventSystemFlags|=at,et=_e.targetContainers,ut!==null&&et.indexOf(ut)===-1&&et.push(ut),_e)}function Uc(_e,et,rt,at,ut){switch(et){case"focusin":return Lc=Tc(Lc,_e,et,rt,at,ut),!0;case"dragenter":return Mc=Tc(Mc,_e,et,rt,at,ut),!0;case"mouseover":return Nc=Tc(Nc,_e,et,rt,at,ut),!0;case"pointerover":var pt=ut.pointerId;return Oc.set(pt,Tc(Oc.get(pt)||null,_e,et,rt,at,ut)),!0;case"gotpointercapture":return pt=ut.pointerId,Pc.set(pt,Tc(Pc.get(pt)||null,_e,et,rt,at,ut)),!0}return!1}function Vc(_e){var et=Wc(_e.target);if(et!==null){var rt=Vb(et);if(rt!==null){if(et=rt.tag,et===13){if(et=Wb(rt),et!==null){_e.blockedOn=et,Ic(_e.priority,function(){Gc(rt)});return}}else if(et===3&&rt.stateNode.current.memoizedState.isDehydrated){_e.blockedOn=rt.tag===3?rt.stateNode.containerInfo:null;return}}}_e.blockedOn=null}function Xc(_e){if(_e.blockedOn!==null)return!1;for(var et=_e.targetContainers;0<et.length;){var rt=Yc(_e.domEventName,_e.eventSystemFlags,et[0],_e.nativeEvent);if(rt===null){rt=_e.nativeEvent;var at=new rt.constructor(rt.type,rt);wb=at,rt.target.dispatchEvent(at),wb=null}else return et=Cb(rt),et!==null&&Fc(et),_e.blockedOn=rt,!1;et.shift()}return!0}function Zc(_e,et,rt){Xc(_e)&&rt.delete(et)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(_e,et){_e.blockedOn===et&&(_e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(_e){function et(ut){return ad(ut,_e)}if(0<Kc.length){ad(Kc[0],_e);for(var rt=1;rt<Kc.length;rt++){var at=Kc[rt];at.blockedOn===_e&&(at.blockedOn=null)}}for(Lc!==null&&ad(Lc,_e),Mc!==null&&ad(Mc,_e),Nc!==null&&ad(Nc,_e),Oc.forEach(et),Pc.forEach(et),rt=0;rt<Qc.length;rt++)at=Qc[rt],at.blockedOn===_e&&(at.blockedOn=null);for(;0<Qc.length&&(rt=Qc[0],rt.blockedOn===null);)Vc(rt),rt.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(_e,et,rt,at){var ut=C,pt=cd.transition;cd.transition=null;try{C=1,fd(_e,et,rt,at)}finally{C=ut,cd.transition=pt}}function gd(_e,et,rt,at){var ut=C,pt=cd.transition;cd.transition=null;try{C=4,fd(_e,et,rt,at)}finally{C=ut,cd.transition=pt}}function fd(_e,et,rt,at){if(dd){var ut=Yc(_e,et,rt,at);if(ut===null)hd(_e,et,at,id,rt),Sc(_e,at);else if(Uc(ut,_e,et,rt,at))at.stopPropagation();else if(Sc(_e,at),et&4&&-1<Rc.indexOf(_e)){for(;ut!==null;){var pt=Cb(ut);if(pt!==null&&Ec(pt),pt=Yc(_e,et,rt,at),pt===null&&hd(_e,et,at,id,rt),pt===ut)break;ut=pt}ut!==null&&at.stopPropagation()}else hd(_e,et,at,null,rt)}}var id=null;function Yc(_e,et,rt,at){if(id=null,_e=xb(at),_e=Wc(_e),_e!==null)if(et=Vb(_e),et===null)_e=null;else if(rt=et.tag,rt===13){if(_e=Wb(et),_e!==null)return _e;_e=null}else if(rt===3){if(et.stateNode.current.memoizedState.isDehydrated)return et.tag===3?et.stateNode.containerInfo:null;_e=null}else et!==_e&&(_e=null);return id=_e,null}function jd(_e){switch(_e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var _e,et=ld,rt=et.length,at,ut="value"in kd?kd.value:kd.textContent,pt=ut.length;for(_e=0;_e<rt&&et[_e]===ut[_e];_e++);var yt=rt-_e;for(at=1;at<=yt&&et[rt-at]===ut[pt-at];at++);return md=ut.slice(_e,1<at?1-at:void 0)}function od(_e){var et=_e.keyCode;return"charCode"in _e?(_e=_e.charCode,_e===0&&et===13&&(_e=13)):_e=et,_e===10&&(_e=13),32<=_e||_e===13?_e:0}function pd(){return!0}function qd(){return!1}function rd(_e){function et(rt,at,ut,pt,yt){this._reactName=rt,this._targetInst=ut,this.type=at,this.nativeEvent=pt,this.target=yt,this.currentTarget=null;for(var ct in _e)_e.hasOwnProperty(ct)&&(rt=_e[ct],this[ct]=rt?rt(pt):pt[ct]);return this.isDefaultPrevented=(pt.defaultPrevented!=null?pt.defaultPrevented:pt.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(et.prototype,{preventDefault:function(){this.defaultPrevented=!0;var rt=this.nativeEvent;rt&&(rt.preventDefault?rt.preventDefault():typeof rt.returnValue!="unknown"&&(rt.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var rt=this.nativeEvent;rt&&(rt.stopPropagation?rt.stopPropagation():typeof rt.cancelBubble!="unknown"&&(rt.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),et}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(_e){return _e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(_e){return _e.relatedTarget===void 0?_e.fromElement===_e.srcElement?_e.toElement:_e.fromElement:_e.relatedTarget},movementX:function(_e){return"movementX"in _e?_e.movementX:(_e!==yd&&(yd&&_e.type==="mousemove"?(wd=_e.screenX-yd.screenX,xd=_e.screenY-yd.screenY):xd=wd=0,yd=_e),wd)},movementY:function(_e){return"movementY"in _e?_e.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(_e){return"clipboardData"in _e?_e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(_e){var et=this.nativeEvent;return et.getModifierState?et.getModifierState(_e):(_e=Od[_e])?!!et[_e]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(_e){if(_e.key){var et=Md[_e.key]||_e.key;if(et!=="Unidentified")return et}return _e.type==="keypress"?(_e=od(_e),_e===13?"Enter":String.fromCharCode(_e)):_e.type==="keydown"||_e.type==="keyup"?Nd[_e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(_e){return _e.type==="keypress"?od(_e):0},keyCode:function(_e){return _e.type==="keydown"||_e.type==="keyup"?_e.keyCode:0},which:function(_e){return _e.type==="keypress"?od(_e):_e.type==="keydown"||_e.type==="keyup"?_e.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(_e){return"deltaX"in _e?_e.deltaX:"wheelDeltaX"in _e?-_e.wheelDeltaX:0},deltaY:function(_e){return"deltaY"in _e?_e.deltaY:"wheelDeltaY"in _e?-_e.wheelDeltaY:"wheelDelta"in _e?-_e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe$1=!1;function ge$1(_e,et){switch(_e){case"keyup":return $d.indexOf(et.keyCode)!==-1;case"keydown":return et.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(_e){return _e=_e.detail,typeof _e=="object"&&"data"in _e?_e.data:null}var ie=!1;function je(_e,et){switch(_e){case"compositionend":return he$1(et);case"keypress":return et.which!==32?null:(fe$1=!0,ee$1);case"textInput":return _e=et.data,_e===ee$1&&fe$1?null:_e;default:return null}}function ke(_e,et){if(ie)return _e==="compositionend"||!ae&&ge$1(_e,et)?(_e=nd(),md=ld=kd=null,ie=!1,_e):null;switch(_e){case"paste":return null;case"keypress":if(!(et.ctrlKey||et.altKey||et.metaKey)||et.ctrlKey&&et.altKey){if(et.char&&1<et.char.length)return et.char;if(et.which)return String.fromCharCode(et.which)}return null;case"compositionend":return de$1&&et.locale!=="ko"?null:et.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(_e){var et=_e&&_e.nodeName&&_e.nodeName.toLowerCase();return et==="input"?!!le$1[_e.type]:et==="textarea"}function ne$1(_e,et,rt,at){Eb(at),et=oe$1(et,"onChange"),0<et.length&&(rt=new td("onChange","change",null,rt,at),_e.push({event:rt,listeners:et}))}var pe$1=null,qe=null;function re$2(_e){se$1(_e,0)}function te(_e){var et=ue$1(_e);if(Wa(et))return _e}function ve$1(_e,et){if(_e==="change")return et}var we=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye$1=typeof ze.oninput=="function"}xe$1=ye$1}else xe$1=!1;we=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be),qe=pe$1=null)}function Be(_e){if(_e.propertyName==="value"&&te(qe)){var et=[];ne$1(et,qe,_e,xb(_e)),Jb(re$2,et)}}function Ce(_e,et,rt){_e==="focusin"?(Ae$1(),pe$1=et,qe=rt,pe$1.attachEvent("onpropertychange",Be)):_e==="focusout"&&Ae$1()}function De(_e){if(_e==="selectionchange"||_e==="keyup"||_e==="keydown")return te(qe)}function Ee$1(_e,et){if(_e==="click")return te(et)}function Fe(_e,et){if(_e==="input"||_e==="change")return te(et)}function Ge(_e,et){return _e===et&&(_e!==0||1/_e===1/et)||_e!==_e&&et!==et}var He=typeof Object.is=="function"?Object.is:Ge;function Ie$1(_e,et){if(He(_e,et))return!0;if(typeof _e!="object"||_e===null||typeof et!="object"||et===null)return!1;var rt=Object.keys(_e),at=Object.keys(et);if(rt.length!==at.length)return!1;for(at=0;at<rt.length;at++){var ut=rt[at];if(!ja.call(et,ut)||!He(_e[ut],et[ut]))return!1}return!0}function Je(_e){for(;_e&&_e.firstChild;)_e=_e.firstChild;return _e}function Ke(_e,et){var rt=Je(_e);_e=0;for(var at;rt;){if(rt.nodeType===3){if(at=_e+rt.textContent.length,_e<=et&&at>=et)return{node:rt,offset:et-_e};_e=at}e:{for(;rt;){if(rt.nextSibling){rt=rt.nextSibling;break e}rt=rt.parentNode}rt=void 0}rt=Je(rt)}}function Le(_e,et){return _e&&et?_e===et?!0:_e&&_e.nodeType===3?!1:et&&et.nodeType===3?Le(_e,et.parentNode):"contains"in _e?_e.contains(et):_e.compareDocumentPosition?!!(_e.compareDocumentPosition(et)&16):!1:!1}function Me(){for(var _e=window,et=Xa();et instanceof _e.HTMLIFrameElement;){try{var rt=typeof et.contentWindow.location.href=="string"}catch{rt=!1}if(rt)_e=et.contentWindow;else break;et=Xa(_e.document)}return et}function Ne(_e){var et=_e&&_e.nodeName&&_e.nodeName.toLowerCase();return et&&(et==="input"&&(_e.type==="text"||_e.type==="search"||_e.type==="tel"||_e.type==="url"||_e.type==="password")||et==="textarea"||_e.contentEditable==="true")}function Oe(_e){var et=Me(),rt=_e.focusedElem,at=_e.selectionRange;if(et!==rt&&rt&&rt.ownerDocument&&Le(rt.ownerDocument.documentElement,rt)){if(at!==null&&Ne(rt)){if(et=at.start,_e=at.end,_e===void 0&&(_e=et),"selectionStart"in rt)rt.selectionStart=et,rt.selectionEnd=Math.min(_e,rt.value.length);else if(_e=(et=rt.ownerDocument||document)&&et.defaultView||window,_e.getSelection){_e=_e.getSelection();var ut=rt.textContent.length,pt=Math.min(at.start,ut);at=at.end===void 0?pt:Math.min(at.end,ut),!_e.extend&&pt>at&&(ut=at,at=pt,pt=ut),ut=Ke(rt,pt);var yt=Ke(rt,at);ut&&yt&&(_e.rangeCount!==1||_e.anchorNode!==ut.node||_e.anchorOffset!==ut.offset||_e.focusNode!==yt.node||_e.focusOffset!==yt.offset)&&(et=et.createRange(),et.setStart(ut.node,ut.offset),_e.removeAllRanges(),pt>at?(_e.addRange(et),_e.extend(yt.node,yt.offset)):(et.setEnd(yt.node,yt.offset),_e.addRange(et)))}}for(et=[],_e=rt;_e=_e.parentNode;)_e.nodeType===1&&et.push({element:_e,left:_e.scrollLeft,top:_e.scrollTop});for(typeof rt.focus=="function"&&rt.focus(),rt=0;rt<et.length;rt++)_e=et[rt],_e.element.scrollLeft=_e.left,_e.element.scrollTop=_e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re$1=null,Se$1=null,Te$1=!1;function Ue(_e,et,rt){var at=rt.window===rt?rt.document:rt.nodeType===9?rt:rt.ownerDocument;Te$1||Qe==null||Qe!==Xa(at)||(at=Qe,"selectionStart"in at&&Ne(at)?at={start:at.selectionStart,end:at.selectionEnd}:(at=(at.ownerDocument&&at.ownerDocument.defaultView||window).getSelection(),at={anchorNode:at.anchorNode,anchorOffset:at.anchorOffset,focusNode:at.focusNode,focusOffset:at.focusOffset}),Se$1&&Ie$1(Se$1,at)||(Se$1=at,at=oe$1(Re$1,"onSelect"),0<at.length&&(et=new td("onSelect","select",null,et,rt),_e.push({event:et,listeners:at}),et.target=Qe)))}function Ve(_e,et){var rt={};return rt[_e.toLowerCase()]=et.toLowerCase(),rt["Webkit"+_e]="webkit"+et,rt["Moz"+_e]="moz"+et,rt}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(_e){if(Xe[_e])return Xe[_e];if(!We[_e])return _e;var et=We[_e],rt;for(rt in et)if(et.hasOwnProperty(rt)&&rt in Ye)return Xe[_e]=et[rt];return _e}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(_e,et){df.set(_e,et),fa(et,[_e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(_e,et,rt){var at=_e.type||"unknown-event";_e.currentTarget=rt,Ub(at,et,void 0,_e),_e.currentTarget=null}function se$1(_e,et){et=(et&4)!==0;for(var rt=0;rt<_e.length;rt++){var at=_e[rt],ut=at.event;at=at.listeners;e:{var pt=void 0;if(et)for(var yt=at.length-1;0<=yt;yt--){var ct=at[yt],At=ct.instance,Pt=ct.currentTarget;if(ct=ct.listener,At!==pt&&ut.isPropagationStopped())break e;nf(ut,ct,Pt),pt=At}else for(yt=0;yt<at.length;yt++){if(ct=at[yt],At=ct.instance,Pt=ct.currentTarget,ct=ct.listener,At!==pt&&ut.isPropagationStopped())break e;nf(ut,ct,Pt),pt=At}}}if(Qb)throw _e=Rb,Qb=!1,Rb=null,_e}function D$1(_e,et){var rt=et[of];rt===void 0&&(rt=et[of]=new Set);var at=_e+"__bubble";rt.has(at)||(pf(et,_e,2,!1),rt.add(at))}function qf(_e,et,rt){var at=0;et&&(at|=4),pf(rt,_e,at,et)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(_e){if(!_e[rf]){_e[rf]=!0,da.forEach(function(rt){rt!=="selectionchange"&&(mf.has(rt)||qf(rt,!1,_e),qf(rt,!0,_e))});var et=_e.nodeType===9?_e:_e.ownerDocument;et===null||et[rf]||(et[rf]=!0,qf("selectionchange",!1,et))}}function pf(_e,et,rt,at){switch(jd(et)){case 1:var ut=ed;break;case 4:ut=gd;break;default:ut=fd}rt=ut.bind(null,et,rt,_e),ut=void 0,!Lb||et!=="touchstart"&&et!=="touchmove"&&et!=="wheel"||(ut=!0),at?ut!==void 0?_e.addEventListener(et,rt,{capture:!0,passive:ut}):_e.addEventListener(et,rt,!0):ut!==void 0?_e.addEventListener(et,rt,{passive:ut}):_e.addEventListener(et,rt,!1)}function hd(_e,et,rt,at,ut){var pt=at;if(!(et&1)&&!(et&2)&&at!==null)e:for(;;){if(at===null)return;var yt=at.tag;if(yt===3||yt===4){var ct=at.stateNode.containerInfo;if(ct===ut||ct.nodeType===8&&ct.parentNode===ut)break;if(yt===4)for(yt=at.return;yt!==null;){var At=yt.tag;if((At===3||At===4)&&(At=yt.stateNode.containerInfo,At===ut||At.nodeType===8&&At.parentNode===ut))return;yt=yt.return}for(;ct!==null;){if(yt=Wc(ct),yt===null)return;if(At=yt.tag,At===5||At===6){at=pt=yt;continue e}ct=ct.parentNode}}at=at.return}Jb(function(){var Pt=pt,kt=xb(rt),Lt=[];e:{var Mt=df.get(_e);if(Mt!==void 0){var Qt=td,Jt=_e;switch(_e){case"keypress":if(od(rt)===0)break e;case"keydown":case"keyup":Qt=Rd;break;case"focusin":Jt="focus",Qt=Fd;break;case"focusout":Jt="blur",Qt=Fd;break;case"beforeblur":case"afterblur":Qt=Fd;break;case"click":if(rt.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Qt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Qt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Qt=Vd;break;case $e:case af:case bf:Qt=Hd;break;case cf:Qt=Xd;break;case"scroll":Qt=vd;break;case"wheel":Qt=Zd;break;case"copy":case"cut":case"paste":Qt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Qt=Td}var sn=(et&4)!==0,tn=!sn&&_e==="scroll",Bt=sn?Mt!==null?Mt+"Capture":null:Mt;sn=[];for(var zt=Pt,Ht;zt!==null;){Ht=zt;var nn=Ht.stateNode;if(Ht.tag===5&&nn!==null&&(Ht=nn,Bt!==null&&(nn=Kb(zt,Bt),nn!=null&&sn.push(tf(zt,nn,Ht)))),tn)break;zt=zt.return}0<sn.length&&(Mt=new Qt(Mt,Jt,null,rt,kt),Lt.push({event:Mt,listeners:sn}))}}if(!(et&7)){e:{if(Mt=_e==="mouseover"||_e==="pointerover",Qt=_e==="mouseout"||_e==="pointerout",Mt&&rt!==wb&&(Jt=rt.relatedTarget||rt.fromElement)&&(Wc(Jt)||Jt[uf]))break e;if((Qt||Mt)&&(Mt=kt.window===kt?kt:(Mt=kt.ownerDocument)?Mt.defaultView||Mt.parentWindow:window,Qt?(Jt=rt.relatedTarget||rt.toElement,Qt=Pt,Jt=Jt?Wc(Jt):null,Jt!==null&&(tn=Vb(Jt),Jt!==tn||Jt.tag!==5&&Jt.tag!==6)&&(Jt=null)):(Qt=null,Jt=Pt),Qt!==Jt)){if(sn=Bd,nn="onMouseLeave",Bt="onMouseEnter",zt="mouse",(_e==="pointerout"||_e==="pointerover")&&(sn=Td,nn="onPointerLeave",Bt="onPointerEnter",zt="pointer"),tn=Qt==null?Mt:ue$1(Qt),Ht=Jt==null?Mt:ue$1(Jt),Mt=new sn(nn,zt+"leave",Qt,rt,kt),Mt.target=tn,Mt.relatedTarget=Ht,nn=null,Wc(kt)===Pt&&(sn=new sn(Bt,zt+"enter",Jt,rt,kt),sn.target=Ht,sn.relatedTarget=tn,nn=sn),tn=nn,Qt&&Jt)t:{for(sn=Qt,Bt=Jt,zt=0,Ht=sn;Ht;Ht=vf(Ht))zt++;for(Ht=0,nn=Bt;nn;nn=vf(nn))Ht++;for(;0<zt-Ht;)sn=vf(sn),zt--;for(;0<Ht-zt;)Bt=vf(Bt),Ht--;for(;zt--;){if(sn===Bt||Bt!==null&&sn===Bt.alternate)break t;sn=vf(sn),Bt=vf(Bt)}sn=null}else sn=null;Qt!==null&&wf(Lt,Mt,Qt,sn,!1),Jt!==null&&tn!==null&&wf(Lt,tn,Jt,sn,!0)}}e:{if(Mt=Pt?ue$1(Pt):window,Qt=Mt.nodeName&&Mt.nodeName.toLowerCase(),Qt==="select"||Qt==="input"&&Mt.type==="file")var Ot=ve$1;else if(me(Mt))if(we)Ot=Fe;else{Ot=De;var Kt=Ce}else(Qt=Mt.nodeName)&&Qt.toLowerCase()==="input"&&(Mt.type==="checkbox"||Mt.type==="radio")&&(Ot=Ee$1);if(Ot&&(Ot=Ot(_e,Pt))){ne$1(Lt,Ot,rt,kt);break e}Kt&&Kt(_e,Mt,Pt),_e==="focusout"&&(Kt=Mt._wrapperState)&&Kt.controlled&&Mt.type==="number"&&cb(Mt,"number",Mt.value)}switch(Kt=Pt?ue$1(Pt):window,_e){case"focusin":(me(Kt)||Kt.contentEditable==="true")&&(Qe=Kt,Re$1=Pt,Se$1=null);break;case"focusout":Se$1=Re$1=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue(Lt,rt,kt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(Lt,rt,kt)}var mn;if(ae)e:{switch(_e){case"compositionstart":var hn="onCompositionStart";break e;case"compositionend":hn="onCompositionEnd";break e;case"compositionupdate":hn="onCompositionUpdate";break e}hn=void 0}else ie?ge$1(_e,rt)&&(hn="onCompositionEnd"):_e==="keydown"&&rt.keyCode===229&&(hn="onCompositionStart");hn&&(de$1&&rt.locale!=="ko"&&(ie||hn!=="onCompositionStart"?hn==="onCompositionEnd"&&ie&&(mn=nd()):(kd=kt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Kt=oe$1(Pt,hn),0<Kt.length&&(hn=new Ld(hn,_e,null,rt,kt),Lt.push({event:hn,listeners:Kt}),mn?hn.data=mn:(mn=he$1(rt),mn!==null&&(hn.data=mn)))),(mn=ce?je(_e,rt):ke(_e,rt))&&(Pt=oe$1(Pt,"onBeforeInput"),0<Pt.length&&(kt=new Ld("onBeforeInput","beforeinput",null,rt,kt),Lt.push({event:kt,listeners:Pt}),kt.data=mn))}se$1(Lt,et)})}function tf(_e,et,rt){return{instance:_e,listener:et,currentTarget:rt}}function oe$1(_e,et){for(var rt=et+"Capture",at=[];_e!==null;){var ut=_e,pt=ut.stateNode;ut.tag===5&&pt!==null&&(ut=pt,pt=Kb(_e,rt),pt!=null&&at.unshift(tf(_e,pt,ut)),pt=Kb(_e,et),pt!=null&&at.push(tf(_e,pt,ut))),_e=_e.return}return at}function vf(_e){if(_e===null)return null;do _e=_e.return;while(_e&&_e.tag!==5);return _e||null}function wf(_e,et,rt,at,ut){for(var pt=et._reactName,yt=[];rt!==null&&rt!==at;){var ct=rt,At=ct.alternate,Pt=ct.stateNode;if(At!==null&&At===at)break;ct.tag===5&&Pt!==null&&(ct=Pt,ut?(At=Kb(rt,pt),At!=null&&yt.unshift(tf(rt,At,ct))):ut||(At=Kb(rt,pt),At!=null&&yt.push(tf(rt,At,ct)))),rt=rt.return}yt.length!==0&&_e.push({event:et,listeners:yt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(_e){return(typeof _e=="string"?_e:""+_e).replace(xf,`
`).replace(yf,"")}function Af(_e,et,rt){if(et=zf(et),zf(_e)!==et&&rt)throw Error(p$3(425))}function Bf(){}var Cf=null,Df=null;function Ef(_e,et){return _e==="textarea"||_e==="noscript"||typeof et.children=="string"||typeof et.children=="number"||typeof et.dangerouslySetInnerHTML=="object"&&et.dangerouslySetInnerHTML!==null&&et.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(_e){return Hf.resolve(null).then(_e).catch(If)}:Ff;function If(_e){setTimeout(function(){throw _e})}function Kf(_e,et){var rt=et,at=0;do{var ut=rt.nextSibling;if(_e.removeChild(rt),ut&&ut.nodeType===8)if(rt=ut.data,rt==="/$"){if(at===0){_e.removeChild(ut),bd(et);return}at--}else rt!=="$"&&rt!=="$?"&&rt!=="$!"||at++;rt=ut}while(rt);bd(et)}function Lf(_e){for(;_e!=null;_e=_e.nextSibling){var et=_e.nodeType;if(et===1||et===3)break;if(et===8){if(et=_e.data,et==="$"||et==="$!"||et==="$?")break;if(et==="/$")return null}}return _e}function Mf(_e){_e=_e.previousSibling;for(var et=0;_e;){if(_e.nodeType===8){var rt=_e.data;if(rt==="$"||rt==="$!"||rt==="$?"){if(et===0)return _e;et--}else rt==="/$"&&et++}_e=_e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(_e){var et=_e[Of];if(et)return et;for(var rt=_e.parentNode;rt;){if(et=rt[uf]||rt[Of]){if(rt=et.alternate,et.child!==null||rt!==null&&rt.child!==null)for(_e=Mf(_e);_e!==null;){if(rt=_e[Of])return rt;_e=Mf(_e)}return et}_e=rt,rt=_e.parentNode}return null}function Cb(_e){return _e=_e[Of]||_e[uf],!_e||_e.tag!==5&&_e.tag!==6&&_e.tag!==13&&_e.tag!==3?null:_e}function ue$1(_e){if(_e.tag===5||_e.tag===6)return _e.stateNode;throw Error(p$3(33))}function Db(_e){return _e[Pf]||null}var Sf=[],Tf=-1;function Uf(_e){return{current:_e}}function E(_e){0>Tf||(_e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(_e,et){Tf++,Sf[Tf]=_e.current,_e.current=et}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(_e,et){var rt=_e.type.contextTypes;if(!rt)return Vf;var at=_e.stateNode;if(at&&at.__reactInternalMemoizedUnmaskedChildContext===et)return at.__reactInternalMemoizedMaskedChildContext;var ut={},pt;for(pt in rt)ut[pt]=et[pt];return at&&(_e=_e.stateNode,_e.__reactInternalMemoizedUnmaskedChildContext=et,_e.__reactInternalMemoizedMaskedChildContext=ut),ut}function Zf(_e){return _e=_e.childContextTypes,_e!=null}function $f(){E(Wf),E(H)}function ag(_e,et,rt){if(H.current!==Vf)throw Error(p$3(168));G$1(H,et),G$1(Wf,rt)}function bg(_e,et,rt){var at=_e.stateNode;if(et=et.childContextTypes,typeof at.getChildContext!="function")return rt;at=at.getChildContext();for(var ut in at)if(!(ut in et))throw Error(p$3(108,Ra(_e)||"Unknown",ut));return A$1({},rt,at)}function cg(_e){return _e=(_e=_e.stateNode)&&_e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G$1(H,_e),G$1(Wf,Wf.current),!0}function dg(_e,et,rt){var at=_e.stateNode;if(!at)throw Error(p$3(169));rt?(_e=bg(_e,et,Xf),at.__reactInternalMemoizedMergedChildContext=_e,E(Wf),E(H),G$1(H,_e)):E(Wf),G$1(Wf,rt)}var eg=null,fg=!1,gg=!1;function hg(_e){eg===null?eg=[_e]:eg.push(_e)}function ig(_e){fg=!0,hg(_e)}function jg(){if(!gg&&eg!==null){gg=!0;var _e=0,et=C;try{var rt=eg;for(C=1;_e<rt.length;_e++){var at=rt[_e];do at=at(!0);while(at!==null)}eg=null,fg=!1}catch(ut){throw eg!==null&&(eg=eg.slice(_e+1)),ac(fc,jg),ut}finally{C=et,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(_e,et){kg[lg++]=ng,kg[lg++]=mg,mg=_e,ng=et}function ug(_e,et,rt){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=_e;var at=rg;_e=sg;var ut=32-oc(at)-1;at&=~(1<<ut),rt+=1;var pt=32-oc(et)+ut;if(30<pt){var yt=ut-ut%5;pt=(at&(1<<yt)-1).toString(32),at>>=yt,ut-=yt,rg=1<<32-oc(et)+ut|rt<<ut|at,sg=pt+_e}else rg=1<<pt|rt<<ut|at,sg=_e}function vg(_e){_e.return!==null&&(tg(_e,1),ug(_e,1,0))}function wg(_e){for(;_e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;_e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(_e,et){var rt=Bg(5,null,null,0);rt.elementType="DELETED",rt.stateNode=et,rt.return=_e,et=_e.deletions,et===null?(_e.deletions=[rt],_e.flags|=16):et.push(rt)}function Cg(_e,et){switch(_e.tag){case 5:var rt=_e.type;return et=et.nodeType!==1||rt.toLowerCase()!==et.nodeName.toLowerCase()?null:et,et!==null?(_e.stateNode=et,xg=_e,yg=Lf(et.firstChild),!0):!1;case 6:return et=_e.pendingProps===""||et.nodeType!==3?null:et,et!==null?(_e.stateNode=et,xg=_e,yg=null,!0):!1;case 13:return et=et.nodeType!==8?null:et,et!==null?(rt=qg!==null?{id:rg,overflow:sg}:null,_e.memoizedState={dehydrated:et,treeContext:rt,retryLane:1073741824},rt=Bg(18,null,null,0),rt.stateNode=et,rt.return=_e,_e.child=rt,xg=_e,yg=null,!0):!1;default:return!1}}function Dg(_e){return(_e.mode&1)!==0&&(_e.flags&128)===0}function Eg(_e){if(I$1){var et=yg;if(et){var rt=et;if(!Cg(_e,et)){if(Dg(_e))throw Error(p$3(418));et=Lf(rt.nextSibling);var at=xg;et&&Cg(_e,et)?Ag(at,rt):(_e.flags=_e.flags&-4097|2,I$1=!1,xg=_e)}}else{if(Dg(_e))throw Error(p$3(418));_e.flags=_e.flags&-4097|2,I$1=!1,xg=_e}}}function Fg(_e){for(_e=_e.return;_e!==null&&_e.tag!==5&&_e.tag!==3&&_e.tag!==13;)_e=_e.return;xg=_e}function Gg(_e){if(_e!==xg)return!1;if(!I$1)return Fg(_e),I$1=!0,!1;var et;if((et=_e.tag!==3)&&!(et=_e.tag!==5)&&(et=_e.type,et=et!=="head"&&et!=="body"&&!Ef(_e.type,_e.memoizedProps)),et&&(et=yg)){if(Dg(_e))throw Hg(),Error(p$3(418));for(;et;)Ag(_e,et),et=Lf(et.nextSibling)}if(Fg(_e),_e.tag===13){if(_e=_e.memoizedState,_e=_e!==null?_e.dehydrated:null,!_e)throw Error(p$3(317));e:{for(_e=_e.nextSibling,et=0;_e;){if(_e.nodeType===8){var rt=_e.data;if(rt==="/$"){if(et===0){yg=Lf(_e.nextSibling);break e}et--}else rt!=="$"&&rt!=="$!"&&rt!=="$?"||et++}_e=_e.nextSibling}yg=null}}else yg=xg?Lf(_e.stateNode.nextSibling):null;return!0}function Hg(){for(var _e=yg;_e;)_e=Lf(_e.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(_e){zg===null?zg=[_e]:zg.push(_e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(_e,et){if(_e&&_e.defaultProps){et=A$1({},et),_e=_e.defaultProps;for(var rt in _e)et[rt]===void 0&&(et[rt]=_e[rt]);return et}return et}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(_e){var et=Mg.current;E(Mg),_e._currentValue=et}function Sg(_e,et,rt){for(;_e!==null;){var at=_e.alternate;if((_e.childLanes&et)!==et?(_e.childLanes|=et,at!==null&&(at.childLanes|=et)):at!==null&&(at.childLanes&et)!==et&&(at.childLanes|=et),_e===rt)break;_e=_e.return}}function Tg(_e,et){Ng=_e,Pg=Og=null,_e=_e.dependencies,_e!==null&&_e.firstContext!==null&&(_e.lanes&et&&(Ug=!0),_e.firstContext=null)}function Vg(_e){var et=_e._currentValue;if(Pg!==_e)if(_e={context:_e,memoizedValue:et,next:null},Og===null){if(Ng===null)throw Error(p$3(308));Og=_e,Ng.dependencies={lanes:0,firstContext:_e}}else Og=Og.next=_e;return et}var Wg=null;function Xg(_e){Wg===null?Wg=[_e]:Wg.push(_e)}function Yg(_e,et,rt,at){var ut=et.interleaved;return ut===null?(rt.next=rt,Xg(et)):(rt.next=ut.next,ut.next=rt),et.interleaved=rt,Zg(_e,at)}function Zg(_e,et){_e.lanes|=et;var rt=_e.alternate;for(rt!==null&&(rt.lanes|=et),rt=_e,_e=_e.return;_e!==null;)_e.childLanes|=et,rt=_e.alternate,rt!==null&&(rt.childLanes|=et),rt=_e,_e=_e.return;return rt.tag===3?rt.stateNode:null}var $g=!1;function ah(_e){_e.updateQueue={baseState:_e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(_e,et){_e=_e.updateQueue,et.updateQueue===_e&&(et.updateQueue={baseState:_e.baseState,firstBaseUpdate:_e.firstBaseUpdate,lastBaseUpdate:_e.lastBaseUpdate,shared:_e.shared,effects:_e.effects})}function ch(_e,et){return{eventTime:_e,lane:et,tag:0,payload:null,callback:null,next:null}}function dh(_e,et,rt){var at=_e.updateQueue;if(at===null)return null;if(at=at.shared,K&2){var ut=at.pending;return ut===null?et.next=et:(et.next=ut.next,ut.next=et),at.pending=et,Zg(_e,rt)}return ut=at.interleaved,ut===null?(et.next=et,Xg(at)):(et.next=ut.next,ut.next=et),at.interleaved=et,Zg(_e,rt)}function eh(_e,et,rt){if(et=et.updateQueue,et!==null&&(et=et.shared,(rt&4194240)!==0)){var at=et.lanes;at&=_e.pendingLanes,rt|=at,et.lanes=rt,Cc(_e,rt)}}function fh(_e,et){var rt=_e.updateQueue,at=_e.alternate;if(at!==null&&(at=at.updateQueue,rt===at)){var ut=null,pt=null;if(rt=rt.firstBaseUpdate,rt!==null){do{var yt={eventTime:rt.eventTime,lane:rt.lane,tag:rt.tag,payload:rt.payload,callback:rt.callback,next:null};pt===null?ut=pt=yt:pt=pt.next=yt,rt=rt.next}while(rt!==null);pt===null?ut=pt=et:pt=pt.next=et}else ut=pt=et;rt={baseState:at.baseState,firstBaseUpdate:ut,lastBaseUpdate:pt,shared:at.shared,effects:at.effects},_e.updateQueue=rt;return}_e=rt.lastBaseUpdate,_e===null?rt.firstBaseUpdate=et:_e.next=et,rt.lastBaseUpdate=et}function gh(_e,et,rt,at){var ut=_e.updateQueue;$g=!1;var pt=ut.firstBaseUpdate,yt=ut.lastBaseUpdate,ct=ut.shared.pending;if(ct!==null){ut.shared.pending=null;var At=ct,Pt=At.next;At.next=null,yt===null?pt=Pt:yt.next=Pt,yt=At;var kt=_e.alternate;kt!==null&&(kt=kt.updateQueue,ct=kt.lastBaseUpdate,ct!==yt&&(ct===null?kt.firstBaseUpdate=Pt:ct.next=Pt,kt.lastBaseUpdate=At))}if(pt!==null){var Lt=ut.baseState;yt=0,kt=Pt=At=null,ct=pt;do{var Mt=ct.lane,Qt=ct.eventTime;if((at&Mt)===Mt){kt!==null&&(kt=kt.next={eventTime:Qt,lane:0,tag:ct.tag,payload:ct.payload,callback:ct.callback,next:null});e:{var Jt=_e,sn=ct;switch(Mt=et,Qt=rt,sn.tag){case 1:if(Jt=sn.payload,typeof Jt=="function"){Lt=Jt.call(Qt,Lt,Mt);break e}Lt=Jt;break e;case 3:Jt.flags=Jt.flags&-65537|128;case 0:if(Jt=sn.payload,Mt=typeof Jt=="function"?Jt.call(Qt,Lt,Mt):Jt,Mt==null)break e;Lt=A$1({},Lt,Mt);break e;case 2:$g=!0}}ct.callback!==null&&ct.lane!==0&&(_e.flags|=64,Mt=ut.effects,Mt===null?ut.effects=[ct]:Mt.push(ct))}else Qt={eventTime:Qt,lane:Mt,tag:ct.tag,payload:ct.payload,callback:ct.callback,next:null},kt===null?(Pt=kt=Qt,At=Lt):kt=kt.next=Qt,yt|=Mt;if(ct=ct.next,ct===null){if(ct=ut.shared.pending,ct===null)break;Mt=ct,ct=Mt.next,Mt.next=null,ut.lastBaseUpdate=Mt,ut.shared.pending=null}}while(!0);if(kt===null&&(At=Lt),ut.baseState=At,ut.firstBaseUpdate=Pt,ut.lastBaseUpdate=kt,et=ut.shared.interleaved,et!==null){ut=et;do yt|=ut.lane,ut=ut.next;while(ut!==et)}else pt===null&&(ut.shared.lanes=0);hh|=yt,_e.lanes=yt,_e.memoizedState=Lt}}function ih(_e,et,rt){if(_e=et.effects,et.effects=null,_e!==null)for(et=0;et<_e.length;et++){var at=_e[et],ut=at.callback;if(ut!==null){if(at.callback=null,at=rt,typeof ut!="function")throw Error(p$3(191,ut));ut.call(at)}}}var jh=new aa.Component().refs;function kh(_e,et,rt,at){et=_e.memoizedState,rt=rt(at,et),rt=rt==null?et:A$1({},et,rt),_e.memoizedState=rt,_e.lanes===0&&(_e.updateQueue.baseState=rt)}var nh={isMounted:function(_e){return(_e=_e._reactInternals)?Vb(_e)===_e:!1},enqueueSetState:function(_e,et,rt){_e=_e._reactInternals;var at=L(),ut=lh(_e),pt=ch(at,ut);pt.payload=et,rt!=null&&(pt.callback=rt),et=dh(_e,pt,ut),et!==null&&(mh(et,_e,ut,at),eh(et,_e,ut))},enqueueReplaceState:function(_e,et,rt){_e=_e._reactInternals;var at=L(),ut=lh(_e),pt=ch(at,ut);pt.tag=1,pt.payload=et,rt!=null&&(pt.callback=rt),et=dh(_e,pt,ut),et!==null&&(mh(et,_e,ut,at),eh(et,_e,ut))},enqueueForceUpdate:function(_e,et){_e=_e._reactInternals;var rt=L(),at=lh(_e),ut=ch(rt,at);ut.tag=2,et!=null&&(ut.callback=et),et=dh(_e,ut,at),et!==null&&(mh(et,_e,at,rt),eh(et,_e,at))}};function oh(_e,et,rt,at,ut,pt,yt){return _e=_e.stateNode,typeof _e.shouldComponentUpdate=="function"?_e.shouldComponentUpdate(at,pt,yt):et.prototype&&et.prototype.isPureReactComponent?!Ie$1(rt,at)||!Ie$1(ut,pt):!0}function ph(_e,et,rt){var at=!1,ut=Vf,pt=et.contextType;return typeof pt=="object"&&pt!==null?pt=Vg(pt):(ut=Zf(et)?Xf:H.current,at=et.contextTypes,pt=(at=at!=null)?Yf(_e,ut):Vf),et=new et(rt,pt),_e.memoizedState=et.state!==null&&et.state!==void 0?et.state:null,et.updater=nh,_e.stateNode=et,et._reactInternals=_e,at&&(_e=_e.stateNode,_e.__reactInternalMemoizedUnmaskedChildContext=ut,_e.__reactInternalMemoizedMaskedChildContext=pt),et}function qh(_e,et,rt,at){_e=et.state,typeof et.componentWillReceiveProps=="function"&&et.componentWillReceiveProps(rt,at),typeof et.UNSAFE_componentWillReceiveProps=="function"&&et.UNSAFE_componentWillReceiveProps(rt,at),et.state!==_e&&nh.enqueueReplaceState(et,et.state,null)}function rh(_e,et,rt,at){var ut=_e.stateNode;ut.props=rt,ut.state=_e.memoizedState,ut.refs=jh,ah(_e);var pt=et.contextType;typeof pt=="object"&&pt!==null?ut.context=Vg(pt):(pt=Zf(et)?Xf:H.current,ut.context=Yf(_e,pt)),ut.state=_e.memoizedState,pt=et.getDerivedStateFromProps,typeof pt=="function"&&(kh(_e,et,pt,rt),ut.state=_e.memoizedState),typeof et.getDerivedStateFromProps=="function"||typeof ut.getSnapshotBeforeUpdate=="function"||typeof ut.UNSAFE_componentWillMount!="function"&&typeof ut.componentWillMount!="function"||(et=ut.state,typeof ut.componentWillMount=="function"&&ut.componentWillMount(),typeof ut.UNSAFE_componentWillMount=="function"&&ut.UNSAFE_componentWillMount(),et!==ut.state&&nh.enqueueReplaceState(ut,ut.state,null),gh(_e,rt,ut,at),ut.state=_e.memoizedState),typeof ut.componentDidMount=="function"&&(_e.flags|=4194308)}function sh(_e,et,rt){if(_e=rt.ref,_e!==null&&typeof _e!="function"&&typeof _e!="object"){if(rt._owner){if(rt=rt._owner,rt){if(rt.tag!==1)throw Error(p$3(309));var at=rt.stateNode}if(!at)throw Error(p$3(147,_e));var ut=at,pt=""+_e;return et!==null&&et.ref!==null&&typeof et.ref=="function"&&et.ref._stringRef===pt?et.ref:(et=function(yt){var ct=ut.refs;ct===jh&&(ct=ut.refs={}),yt===null?delete ct[pt]:ct[pt]=yt},et._stringRef=pt,et)}if(typeof _e!="string")throw Error(p$3(284));if(!rt._owner)throw Error(p$3(290,_e))}return _e}function th(_e,et){throw _e=Object.prototype.toString.call(et),Error(p$3(31,_e==="[object Object]"?"object with keys {"+Object.keys(et).join(", ")+"}":_e))}function uh(_e){var et=_e._init;return et(_e._payload)}function vh(_e){function et(Bt,zt){if(_e){var Ht=Bt.deletions;Ht===null?(Bt.deletions=[zt],Bt.flags|=16):Ht.push(zt)}}function rt(Bt,zt){if(!_e)return null;for(;zt!==null;)et(Bt,zt),zt=zt.sibling;return null}function at(Bt,zt){for(Bt=new Map;zt!==null;)zt.key!==null?Bt.set(zt.key,zt):Bt.set(zt.index,zt),zt=zt.sibling;return Bt}function ut(Bt,zt){return Bt=wh(Bt,zt),Bt.index=0,Bt.sibling=null,Bt}function pt(Bt,zt,Ht){return Bt.index=Ht,_e?(Ht=Bt.alternate,Ht!==null?(Ht=Ht.index,Ht<zt?(Bt.flags|=2,zt):Ht):(Bt.flags|=2,zt)):(Bt.flags|=1048576,zt)}function yt(Bt){return _e&&Bt.alternate===null&&(Bt.flags|=2),Bt}function ct(Bt,zt,Ht,nn){return zt===null||zt.tag!==6?(zt=xh(Ht,Bt.mode,nn),zt.return=Bt,zt):(zt=ut(zt,Ht),zt.return=Bt,zt)}function At(Bt,zt,Ht,nn){var Ot=Ht.type;return Ot===ya?kt(Bt,zt,Ht.props.children,nn,Ht.key):zt!==null&&(zt.elementType===Ot||typeof Ot=="object"&&Ot!==null&&Ot.$$typeof===Ha&&uh(Ot)===zt.type)?(nn=ut(zt,Ht.props),nn.ref=sh(Bt,zt,Ht),nn.return=Bt,nn):(nn=yh(Ht.type,Ht.key,Ht.props,null,Bt.mode,nn),nn.ref=sh(Bt,zt,Ht),nn.return=Bt,nn)}function Pt(Bt,zt,Ht,nn){return zt===null||zt.tag!==4||zt.stateNode.containerInfo!==Ht.containerInfo||zt.stateNode.implementation!==Ht.implementation?(zt=zh(Ht,Bt.mode,nn),zt.return=Bt,zt):(zt=ut(zt,Ht.children||[]),zt.return=Bt,zt)}function kt(Bt,zt,Ht,nn,Ot){return zt===null||zt.tag!==7?(zt=Ah(Ht,Bt.mode,nn,Ot),zt.return=Bt,zt):(zt=ut(zt,Ht),zt.return=Bt,zt)}function Lt(Bt,zt,Ht){if(typeof zt=="string"&&zt!==""||typeof zt=="number")return zt=xh(""+zt,Bt.mode,Ht),zt.return=Bt,zt;if(typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case va:return Ht=yh(zt.type,zt.key,zt.props,null,Bt.mode,Ht),Ht.ref=sh(Bt,null,zt),Ht.return=Bt,Ht;case wa:return zt=zh(zt,Bt.mode,Ht),zt.return=Bt,zt;case Ha:var nn=zt._init;return Lt(Bt,nn(zt._payload),Ht)}if(eb(zt)||Ka(zt))return zt=Ah(zt,Bt.mode,Ht,null),zt.return=Bt,zt;th(Bt,zt)}return null}function Mt(Bt,zt,Ht,nn){var Ot=zt!==null?zt.key:null;if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number")return Ot!==null?null:ct(Bt,zt,""+Ht,nn);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case va:return Ht.key===Ot?At(Bt,zt,Ht,nn):null;case wa:return Ht.key===Ot?Pt(Bt,zt,Ht,nn):null;case Ha:return Ot=Ht._init,Mt(Bt,zt,Ot(Ht._payload),nn)}if(eb(Ht)||Ka(Ht))return Ot!==null?null:kt(Bt,zt,Ht,nn,null);th(Bt,Ht)}return null}function Qt(Bt,zt,Ht,nn,Ot){if(typeof nn=="string"&&nn!==""||typeof nn=="number")return Bt=Bt.get(Ht)||null,ct(zt,Bt,""+nn,Ot);if(typeof nn=="object"&&nn!==null){switch(nn.$$typeof){case va:return Bt=Bt.get(nn.key===null?Ht:nn.key)||null,At(zt,Bt,nn,Ot);case wa:return Bt=Bt.get(nn.key===null?Ht:nn.key)||null,Pt(zt,Bt,nn,Ot);case Ha:var Kt=nn._init;return Qt(Bt,zt,Ht,Kt(nn._payload),Ot)}if(eb(nn)||Ka(nn))return Bt=Bt.get(Ht)||null,kt(zt,Bt,nn,Ot,null);th(zt,nn)}return null}function Jt(Bt,zt,Ht,nn){for(var Ot=null,Kt=null,mn=zt,hn=zt=0,Yt=null;mn!==null&&hn<Ht.length;hn++){mn.index>hn?(Yt=mn,mn=null):Yt=mn.sibling;var vn=Mt(Bt,mn,Ht[hn],nn);if(vn===null){mn===null&&(mn=Yt);break}_e&&mn&&vn.alternate===null&&et(Bt,mn),zt=pt(vn,zt,hn),Kt===null?Ot=vn:Kt.sibling=vn,Kt=vn,mn=Yt}if(hn===Ht.length)return rt(Bt,mn),I$1&&tg(Bt,hn),Ot;if(mn===null){for(;hn<Ht.length;hn++)mn=Lt(Bt,Ht[hn],nn),mn!==null&&(zt=pt(mn,zt,hn),Kt===null?Ot=mn:Kt.sibling=mn,Kt=mn);return I$1&&tg(Bt,hn),Ot}for(mn=at(Bt,mn);hn<Ht.length;hn++)Yt=Qt(mn,Bt,hn,Ht[hn],nn),Yt!==null&&(_e&&Yt.alternate!==null&&mn.delete(Yt.key===null?hn:Yt.key),zt=pt(Yt,zt,hn),Kt===null?Ot=Yt:Kt.sibling=Yt,Kt=Yt);return _e&&mn.forEach(function(fn){return et(Bt,fn)}),I$1&&tg(Bt,hn),Ot}function sn(Bt,zt,Ht,nn){var Ot=Ka(Ht);if(typeof Ot!="function")throw Error(p$3(150));if(Ht=Ot.call(Ht),Ht==null)throw Error(p$3(151));for(var Kt=Ot=null,mn=zt,hn=zt=0,Yt=null,vn=Ht.next();mn!==null&&!vn.done;hn++,vn=Ht.next()){mn.index>hn?(Yt=mn,mn=null):Yt=mn.sibling;var fn=Mt(Bt,mn,vn.value,nn);if(fn===null){mn===null&&(mn=Yt);break}_e&&mn&&fn.alternate===null&&et(Bt,mn),zt=pt(fn,zt,hn),Kt===null?Ot=fn:Kt.sibling=fn,Kt=fn,mn=Yt}if(vn.done)return rt(Bt,mn),I$1&&tg(Bt,hn),Ot;if(mn===null){for(;!vn.done;hn++,vn=Ht.next())vn=Lt(Bt,vn.value,nn),vn!==null&&(zt=pt(vn,zt,hn),Kt===null?Ot=vn:Kt.sibling=vn,Kt=vn);return I$1&&tg(Bt,hn),Ot}for(mn=at(Bt,mn);!vn.done;hn++,vn=Ht.next())vn=Qt(mn,Bt,hn,vn.value,nn),vn!==null&&(_e&&vn.alternate!==null&&mn.delete(vn.key===null?hn:vn.key),zt=pt(vn,zt,hn),Kt===null?Ot=vn:Kt.sibling=vn,Kt=vn);return _e&&mn.forEach(function(Wn){return et(Bt,Wn)}),I$1&&tg(Bt,hn),Ot}function tn(Bt,zt,Ht,nn){if(typeof Ht=="object"&&Ht!==null&&Ht.type===ya&&Ht.key===null&&(Ht=Ht.props.children),typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case va:e:{for(var Ot=Ht.key,Kt=zt;Kt!==null;){if(Kt.key===Ot){if(Ot=Ht.type,Ot===ya){if(Kt.tag===7){rt(Bt,Kt.sibling),zt=ut(Kt,Ht.props.children),zt.return=Bt,Bt=zt;break e}}else if(Kt.elementType===Ot||typeof Ot=="object"&&Ot!==null&&Ot.$$typeof===Ha&&uh(Ot)===Kt.type){rt(Bt,Kt.sibling),zt=ut(Kt,Ht.props),zt.ref=sh(Bt,Kt,Ht),zt.return=Bt,Bt=zt;break e}rt(Bt,Kt);break}else et(Bt,Kt);Kt=Kt.sibling}Ht.type===ya?(zt=Ah(Ht.props.children,Bt.mode,nn,Ht.key),zt.return=Bt,Bt=zt):(nn=yh(Ht.type,Ht.key,Ht.props,null,Bt.mode,nn),nn.ref=sh(Bt,zt,Ht),nn.return=Bt,Bt=nn)}return yt(Bt);case wa:e:{for(Kt=Ht.key;zt!==null;){if(zt.key===Kt)if(zt.tag===4&&zt.stateNode.containerInfo===Ht.containerInfo&&zt.stateNode.implementation===Ht.implementation){rt(Bt,zt.sibling),zt=ut(zt,Ht.children||[]),zt.return=Bt,Bt=zt;break e}else{rt(Bt,zt);break}else et(Bt,zt);zt=zt.sibling}zt=zh(Ht,Bt.mode,nn),zt.return=Bt,Bt=zt}return yt(Bt);case Ha:return Kt=Ht._init,tn(Bt,zt,Kt(Ht._payload),nn)}if(eb(Ht))return Jt(Bt,zt,Ht,nn);if(Ka(Ht))return sn(Bt,zt,Ht,nn);th(Bt,Ht)}return typeof Ht=="string"&&Ht!==""||typeof Ht=="number"?(Ht=""+Ht,zt!==null&&zt.tag===6?(rt(Bt,zt.sibling),zt=ut(zt,Ht),zt.return=Bt,Bt=zt):(rt(Bt,zt),zt=xh(Ht,Bt.mode,nn),zt.return=Bt,Bt=zt),yt(Bt)):rt(Bt,zt)}return tn}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(_e){if(_e===Dh)throw Error(p$3(174));return _e}function Ih(_e,et){switch(G$1(Gh,et),G$1(Fh,_e),G$1(Eh,Dh),_e=et.nodeType,_e){case 9:case 11:et=(et=et.documentElement)?et.namespaceURI:lb(null,"");break;default:_e=_e===8?et.parentNode:et,et=_e.namespaceURI||null,_e=_e.tagName,et=lb(et,_e)}E(Eh),G$1(Eh,et)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh(_e){Hh(Gh.current);var et=Hh(Eh.current),rt=lb(et,_e.type);et!==rt&&(G$1(Fh,_e),G$1(Eh,rt))}function Lh(_e){Fh.current===_e&&(E(Eh),E(Fh))}var M$1=Uf(0);function Mh(_e){for(var et=_e;et!==null;){if(et.tag===13){var rt=et.memoizedState;if(rt!==null&&(rt=rt.dehydrated,rt===null||rt.data==="$?"||rt.data==="$!"))return et}else if(et.tag===19&&et.memoizedProps.revealOrder!==void 0){if(et.flags&128)return et}else if(et.child!==null){et.child.return=et,et=et.child;continue}if(et===_e)break;for(;et.sibling===null;){if(et.return===null||et.return===_e)return null;et=et.return}et.sibling.return=et.return,et=et.sibling}return null}var Nh=[];function Oh(){for(var _e=0;_e<Nh.length;_e++)Nh[_e]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O$1=null,P$1=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q$1(){throw Error(p$3(321))}function Wh(_e,et){if(et===null)return!1;for(var rt=0;rt<et.length&&rt<_e.length;rt++)if(!He(_e[rt],et[rt]))return!1;return!0}function Xh(_e,et,rt,at,ut,pt){if(Rh=pt,N=et,et.memoizedState=null,et.updateQueue=null,et.lanes=0,Ph.current=_e===null||_e.memoizedState===null?Yh:Zh,_e=rt(at,ut),Th){pt=0;do{if(Th=!1,Uh=0,25<=pt)throw Error(p$3(301));pt+=1,P$1=O$1=null,et.updateQueue=null,Ph.current=$h,_e=rt(at,ut)}while(Th)}if(Ph.current=ai,et=O$1!==null&&O$1.next!==null,Rh=0,P$1=O$1=N=null,Sh=!1,et)throw Error(p$3(300));return _e}function bi(){var _e=Uh!==0;return Uh=0,_e}function ci(){var _e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P$1===null?N.memoizedState=P$1=_e:P$1=P$1.next=_e,P$1}function di(){if(O$1===null){var _e=N.alternate;_e=_e!==null?_e.memoizedState:null}else _e=O$1.next;var et=P$1===null?N.memoizedState:P$1.next;if(et!==null)P$1=et,O$1=_e;else{if(_e===null)throw Error(p$3(310));O$1=_e,_e={memoizedState:O$1.memoizedState,baseState:O$1.baseState,baseQueue:O$1.baseQueue,queue:O$1.queue,next:null},P$1===null?N.memoizedState=P$1=_e:P$1=P$1.next=_e}return P$1}function ei(_e,et){return typeof et=="function"?et(_e):et}function fi(_e){var et=di(),rt=et.queue;if(rt===null)throw Error(p$3(311));rt.lastRenderedReducer=_e;var at=O$1,ut=at.baseQueue,pt=rt.pending;if(pt!==null){if(ut!==null){var yt=ut.next;ut.next=pt.next,pt.next=yt}at.baseQueue=ut=pt,rt.pending=null}if(ut!==null){pt=ut.next,at=at.baseState;var ct=yt=null,At=null,Pt=pt;do{var kt=Pt.lane;if((Rh&kt)===kt)At!==null&&(At=At.next={lane:0,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null}),at=Pt.hasEagerState?Pt.eagerState:_e(at,Pt.action);else{var Lt={lane:kt,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null};At===null?(ct=At=Lt,yt=at):At=At.next=Lt,N.lanes|=kt,hh|=kt}Pt=Pt.next}while(Pt!==null&&Pt!==pt);At===null?yt=at:At.next=ct,He(at,et.memoizedState)||(Ug=!0),et.memoizedState=at,et.baseState=yt,et.baseQueue=At,rt.lastRenderedState=at}if(_e=rt.interleaved,_e!==null){ut=_e;do pt=ut.lane,N.lanes|=pt,hh|=pt,ut=ut.next;while(ut!==_e)}else ut===null&&(rt.lanes=0);return[et.memoizedState,rt.dispatch]}function gi(_e){var et=di(),rt=et.queue;if(rt===null)throw Error(p$3(311));rt.lastRenderedReducer=_e;var at=rt.dispatch,ut=rt.pending,pt=et.memoizedState;if(ut!==null){rt.pending=null;var yt=ut=ut.next;do pt=_e(pt,yt.action),yt=yt.next;while(yt!==ut);He(pt,et.memoizedState)||(Ug=!0),et.memoizedState=pt,et.baseQueue===null&&(et.baseState=pt),rt.lastRenderedState=pt}return[pt,at]}function hi(){}function ii(_e,et){var rt=N,at=di(),ut=et(),pt=!He(at.memoizedState,ut);if(pt&&(at.memoizedState=ut,Ug=!0),at=at.queue,ji(ki.bind(null,rt,at,_e),[_e]),at.getSnapshot!==et||pt||P$1!==null&&P$1.memoizedState.tag&1){if(rt.flags|=2048,li(9,mi.bind(null,rt,at,ut,et),void 0,null),R===null)throw Error(p$3(349));Rh&30||ni(rt,et,ut)}return ut}function ni(_e,et,rt){_e.flags|=16384,_e={getSnapshot:et,value:rt},et=N.updateQueue,et===null?(et={lastEffect:null,stores:null},N.updateQueue=et,et.stores=[_e]):(rt=et.stores,rt===null?et.stores=[_e]:rt.push(_e))}function mi(_e,et,rt,at){et.value=rt,et.getSnapshot=at,oi(et)&&pi(_e)}function ki(_e,et,rt){return rt(function(){oi(et)&&pi(_e)})}function oi(_e){var et=_e.getSnapshot;_e=_e.value;try{var rt=et();return!He(_e,rt)}catch{return!0}}function pi(_e){var et=Zg(_e,1);et!==null&&mh(et,_e,1,-1)}function qi(_e){var et=ci();return typeof _e=="function"&&(_e=_e()),et.memoizedState=et.baseState=_e,_e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:_e},et.queue=_e,_e=_e.dispatch=ri.bind(null,N,_e),[et.memoizedState,_e]}function li(_e,et,rt,at){return _e={tag:_e,create:et,destroy:rt,deps:at,next:null},et=N.updateQueue,et===null?(et={lastEffect:null,stores:null},N.updateQueue=et,et.lastEffect=_e.next=_e):(rt=et.lastEffect,rt===null?et.lastEffect=_e.next=_e:(at=rt.next,rt.next=_e,_e.next=at,et.lastEffect=_e)),_e}function si(){return di().memoizedState}function ti(_e,et,rt,at){var ut=ci();N.flags|=_e,ut.memoizedState=li(1|et,rt,void 0,at===void 0?null:at)}function ui(_e,et,rt,at){var ut=di();at=at===void 0?null:at;var pt=void 0;if(O$1!==null){var yt=O$1.memoizedState;if(pt=yt.destroy,at!==null&&Wh(at,yt.deps)){ut.memoizedState=li(et,rt,pt,at);return}}N.flags|=_e,ut.memoizedState=li(1|et,rt,pt,at)}function vi(_e,et){return ti(8390656,8,_e,et)}function ji(_e,et){return ui(2048,8,_e,et)}function wi(_e,et){return ui(4,2,_e,et)}function xi(_e,et){return ui(4,4,_e,et)}function yi(_e,et){if(typeof et=="function")return _e=_e(),et(_e),function(){et(null)};if(et!=null)return _e=_e(),et.current=_e,function(){et.current=null}}function zi(_e,et,rt){return rt=rt!=null?rt.concat([_e]):null,ui(4,4,yi.bind(null,et,_e),rt)}function Ai(){}function Bi(_e,et){var rt=di();et=et===void 0?null:et;var at=rt.memoizedState;return at!==null&&et!==null&&Wh(et,at[1])?at[0]:(rt.memoizedState=[_e,et],_e)}function Ci(_e,et){var rt=di();et=et===void 0?null:et;var at=rt.memoizedState;return at!==null&&et!==null&&Wh(et,at[1])?at[0]:(_e=_e(),rt.memoizedState=[_e,et],_e)}function Di(_e,et,rt){return Rh&21?(He(rt,et)||(rt=yc(),N.lanes|=rt,hh|=rt,_e.baseState=!0),et):(_e.baseState&&(_e.baseState=!1,Ug=!0),_e.memoizedState=rt)}function Ei(_e,et){var rt=C;C=rt!==0&&4>rt?rt:4,_e(!0);var at=Qh.transition;Qh.transition={};try{_e(!1),et()}finally{C=rt,Qh.transition=at}}function Fi(){return di().memoizedState}function Gi(_e,et,rt){var at=lh(_e);if(rt={lane:at,action:rt,hasEagerState:!1,eagerState:null,next:null},Hi(_e))Ii(et,rt);else if(rt=Yg(_e,et,rt,at),rt!==null){var ut=L();mh(rt,_e,at,ut),Ji(rt,et,at)}}function ri(_e,et,rt){var at=lh(_e),ut={lane:at,action:rt,hasEagerState:!1,eagerState:null,next:null};if(Hi(_e))Ii(et,ut);else{var pt=_e.alternate;if(_e.lanes===0&&(pt===null||pt.lanes===0)&&(pt=et.lastRenderedReducer,pt!==null))try{var yt=et.lastRenderedState,ct=pt(yt,rt);if(ut.hasEagerState=!0,ut.eagerState=ct,He(ct,yt)){var At=et.interleaved;At===null?(ut.next=ut,Xg(et)):(ut.next=At.next,At.next=ut),et.interleaved=ut;return}}catch{}finally{}rt=Yg(_e,et,ut,at),rt!==null&&(ut=L(),mh(rt,_e,at,ut),Ji(rt,et,at))}}function Hi(_e){var et=_e.alternate;return _e===N||et!==null&&et===N}function Ii(_e,et){Th=Sh=!0;var rt=_e.pending;rt===null?et.next=et:(et.next=rt.next,rt.next=et),_e.pending=et}function Ji(_e,et,rt){if(rt&4194240){var at=et.lanes;at&=_e.pendingLanes,rt|=at,et.lanes=rt,Cc(_e,rt)}}var ai={readContext:Vg,useCallback:Q$1,useContext:Q$1,useEffect:Q$1,useImperativeHandle:Q$1,useInsertionEffect:Q$1,useLayoutEffect:Q$1,useMemo:Q$1,useReducer:Q$1,useRef:Q$1,useState:Q$1,useDebugValue:Q$1,useDeferredValue:Q$1,useTransition:Q$1,useMutableSource:Q$1,useSyncExternalStore:Q$1,useId:Q$1,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(_e,et){return ci().memoizedState=[_e,et===void 0?null:et],_e},useContext:Vg,useEffect:vi,useImperativeHandle:function(_e,et,rt){return rt=rt!=null?rt.concat([_e]):null,ti(4194308,4,yi.bind(null,et,_e),rt)},useLayoutEffect:function(_e,et){return ti(4194308,4,_e,et)},useInsertionEffect:function(_e,et){return ti(4,2,_e,et)},useMemo:function(_e,et){var rt=ci();return et=et===void 0?null:et,_e=_e(),rt.memoizedState=[_e,et],_e},useReducer:function(_e,et,rt){var at=ci();return et=rt!==void 0?rt(et):et,at.memoizedState=at.baseState=et,_e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_e,lastRenderedState:et},at.queue=_e,_e=_e.dispatch=Gi.bind(null,N,_e),[at.memoizedState,_e]},useRef:function(_e){var et=ci();return _e={current:_e},et.memoizedState=_e},useState:qi,useDebugValue:Ai,useDeferredValue:function(_e){return ci().memoizedState=_e},useTransition:function(){var _e=qi(!1),et=_e[0];return _e=Ei.bind(null,_e[1]),ci().memoizedState=_e,[et,_e]},useMutableSource:function(){},useSyncExternalStore:function(_e,et,rt){var at=N,ut=ci();if(I$1){if(rt===void 0)throw Error(p$3(407));rt=rt()}else{if(rt=et(),R===null)throw Error(p$3(349));Rh&30||ni(at,et,rt)}ut.memoizedState=rt;var pt={value:rt,getSnapshot:et};return ut.queue=pt,vi(ki.bind(null,at,pt,_e),[_e]),at.flags|=2048,li(9,mi.bind(null,at,pt,rt,et),void 0,null),rt},useId:function(){var _e=ci(),et=R.identifierPrefix;if(I$1){var rt=sg,at=rg;rt=(at&~(1<<32-oc(at)-1)).toString(32)+rt,et=":"+et+"R"+rt,rt=Uh++,0<rt&&(et+="H"+rt.toString(32)),et+=":"}else rt=Vh++,et=":"+et+"r"+rt.toString(32)+":";return _e.memoizedState=et},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(_e){var et=di();return Di(et,O$1.memoizedState,_e)},useTransition:function(){var _e=fi(ei)[0],et=di().memoizedState;return[_e,et]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(_e){var et=di();return O$1===null?et.memoizedState=_e:Di(et,O$1.memoizedState,_e)},useTransition:function(){var _e=gi(ei)[0],et=di().memoizedState;return[_e,et]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(_e,et){try{var rt="",at=et;do rt+=Pa(at),at=at.return;while(at);var ut=rt}catch(pt){ut=`
Error generating stack: `+pt.message+`
`+pt.stack}return{value:_e,source:et,stack:ut,digest:null}}function Li(_e,et,rt){return{value:_e,source:null,stack:rt??null,digest:et??null}}function Mi(_e,et){try{console.error(et.value)}catch(rt){setTimeout(function(){throw rt})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(_e,et,rt){rt=ch(-1,rt),rt.tag=3,rt.payload={element:null};var at=et.value;return rt.callback=function(){Pi||(Pi=!0,Qi=at),Mi(_e,et)},rt}function Ri(_e,et,rt){rt=ch(-1,rt),rt.tag=3;var at=_e.type.getDerivedStateFromError;if(typeof at=="function"){var ut=et.value;rt.payload=function(){return at(ut)},rt.callback=function(){Mi(_e,et)}}var pt=_e.stateNode;return pt!==null&&typeof pt.componentDidCatch=="function"&&(rt.callback=function(){Mi(_e,et),typeof at!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var yt=et.stack;this.componentDidCatch(et.value,{componentStack:yt!==null?yt:""})}),rt}function Ti(_e,et,rt){var at=_e.pingCache;if(at===null){at=_e.pingCache=new Ni;var ut=new Set;at.set(et,ut)}else ut=at.get(et),ut===void 0&&(ut=new Set,at.set(et,ut));ut.has(rt)||(ut.add(rt),_e=Ui.bind(null,_e,et,rt),et.then(_e,_e))}function Vi(_e){do{var et;if((et=_e.tag===13)&&(et=_e.memoizedState,et=et!==null?et.dehydrated!==null:!0),et)return _e;_e=_e.return}while(_e!==null);return null}function Wi(_e,et,rt,at,ut){return _e.mode&1?(_e.flags|=65536,_e.lanes=ut,_e):(_e===et?_e.flags|=65536:(_e.flags|=128,rt.flags|=131072,rt.flags&=-52805,rt.tag===1&&(rt.alternate===null?rt.tag=17:(et=ch(-1,1),et.tag=2,dh(rt,et,1))),rt.lanes|=1),_e)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(_e,et,rt,at){et.child=_e===null?Ch(et,null,rt,at):Bh(et,_e.child,rt,at)}function Zi(_e,et,rt,at,ut){rt=rt.render;var pt=et.ref;return Tg(et,ut),at=Xh(_e,et,rt,at,pt,ut),rt=bi(),_e!==null&&!Ug?(et.updateQueue=_e.updateQueue,et.flags&=-2053,_e.lanes&=~ut,$i(_e,et,ut)):(I$1&&rt&&vg(et),et.flags|=1,Yi(_e,et,at,ut),et.child)}function aj(_e,et,rt,at,ut){if(_e===null){var pt=rt.type;return typeof pt=="function"&&!bj(pt)&&pt.defaultProps===void 0&&rt.compare===null&&rt.defaultProps===void 0?(et.tag=15,et.type=pt,cj(_e,et,pt,at,ut)):(_e=yh(rt.type,null,at,et,et.mode,ut),_e.ref=et.ref,_e.return=et,et.child=_e)}if(pt=_e.child,!(_e.lanes&ut)){var yt=pt.memoizedProps;if(rt=rt.compare,rt=rt!==null?rt:Ie$1,rt(yt,at)&&_e.ref===et.ref)return $i(_e,et,ut)}return et.flags|=1,_e=wh(pt,at),_e.ref=et.ref,_e.return=et,et.child=_e}function cj(_e,et,rt,at,ut){if(_e!==null){var pt=_e.memoizedProps;if(Ie$1(pt,at)&&_e.ref===et.ref)if(Ug=!1,et.pendingProps=at=pt,(_e.lanes&ut)!==0)_e.flags&131072&&(Ug=!0);else return et.lanes=_e.lanes,$i(_e,et,ut)}return dj(_e,et,rt,at,ut)}function ej(_e,et,rt){var at=et.pendingProps,ut=at.children,pt=_e!==null?_e.memoizedState:null;if(at.mode==="hidden")if(!(et.mode&1))et.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(fj,gj),gj|=rt;else{if(!(rt&1073741824))return _e=pt!==null?pt.baseLanes|rt:rt,et.lanes=et.childLanes=1073741824,et.memoizedState={baseLanes:_e,cachePool:null,transitions:null},et.updateQueue=null,G$1(fj,gj),gj|=_e,null;et.memoizedState={baseLanes:0,cachePool:null,transitions:null},at=pt!==null?pt.baseLanes:rt,G$1(fj,gj),gj|=at}else pt!==null?(at=pt.baseLanes|rt,et.memoizedState=null):at=rt,G$1(fj,gj),gj|=at;return Yi(_e,et,ut,rt),et.child}function hj(_e,et){var rt=et.ref;(_e===null&&rt!==null||_e!==null&&_e.ref!==rt)&&(et.flags|=512,et.flags|=2097152)}function dj(_e,et,rt,at,ut){var pt=Zf(rt)?Xf:H.current;return pt=Yf(et,pt),Tg(et,ut),rt=Xh(_e,et,rt,at,pt,ut),at=bi(),_e!==null&&!Ug?(et.updateQueue=_e.updateQueue,et.flags&=-2053,_e.lanes&=~ut,$i(_e,et,ut)):(I$1&&at&&vg(et),et.flags|=1,Yi(_e,et,rt,ut),et.child)}function ij(_e,et,rt,at,ut){if(Zf(rt)){var pt=!0;cg(et)}else pt=!1;if(Tg(et,ut),et.stateNode===null)jj(_e,et),ph(et,rt,at),rh(et,rt,at,ut),at=!0;else if(_e===null){var yt=et.stateNode,ct=et.memoizedProps;yt.props=ct;var At=yt.context,Pt=rt.contextType;typeof Pt=="object"&&Pt!==null?Pt=Vg(Pt):(Pt=Zf(rt)?Xf:H.current,Pt=Yf(et,Pt));var kt=rt.getDerivedStateFromProps,Lt=typeof kt=="function"||typeof yt.getSnapshotBeforeUpdate=="function";Lt||typeof yt.UNSAFE_componentWillReceiveProps!="function"&&typeof yt.componentWillReceiveProps!="function"||(ct!==at||At!==Pt)&&qh(et,yt,at,Pt),$g=!1;var Mt=et.memoizedState;yt.state=Mt,gh(et,at,yt,ut),At=et.memoizedState,ct!==at||Mt!==At||Wf.current||$g?(typeof kt=="function"&&(kh(et,rt,kt,at),At=et.memoizedState),(ct=$g||oh(et,rt,ct,at,Mt,At,Pt))?(Lt||typeof yt.UNSAFE_componentWillMount!="function"&&typeof yt.componentWillMount!="function"||(typeof yt.componentWillMount=="function"&&yt.componentWillMount(),typeof yt.UNSAFE_componentWillMount=="function"&&yt.UNSAFE_componentWillMount()),typeof yt.componentDidMount=="function"&&(et.flags|=4194308)):(typeof yt.componentDidMount=="function"&&(et.flags|=4194308),et.memoizedProps=at,et.memoizedState=At),yt.props=at,yt.state=At,yt.context=Pt,at=ct):(typeof yt.componentDidMount=="function"&&(et.flags|=4194308),at=!1)}else{yt=et.stateNode,bh(_e,et),ct=et.memoizedProps,Pt=et.type===et.elementType?ct:Lg(et.type,ct),yt.props=Pt,Lt=et.pendingProps,Mt=yt.context,At=rt.contextType,typeof At=="object"&&At!==null?At=Vg(At):(At=Zf(rt)?Xf:H.current,At=Yf(et,At));var Qt=rt.getDerivedStateFromProps;(kt=typeof Qt=="function"||typeof yt.getSnapshotBeforeUpdate=="function")||typeof yt.UNSAFE_componentWillReceiveProps!="function"&&typeof yt.componentWillReceiveProps!="function"||(ct!==Lt||Mt!==At)&&qh(et,yt,at,At),$g=!1,Mt=et.memoizedState,yt.state=Mt,gh(et,at,yt,ut);var Jt=et.memoizedState;ct!==Lt||Mt!==Jt||Wf.current||$g?(typeof Qt=="function"&&(kh(et,rt,Qt,at),Jt=et.memoizedState),(Pt=$g||oh(et,rt,Pt,at,Mt,Jt,At)||!1)?(kt||typeof yt.UNSAFE_componentWillUpdate!="function"&&typeof yt.componentWillUpdate!="function"||(typeof yt.componentWillUpdate=="function"&&yt.componentWillUpdate(at,Jt,At),typeof yt.UNSAFE_componentWillUpdate=="function"&&yt.UNSAFE_componentWillUpdate(at,Jt,At)),typeof yt.componentDidUpdate=="function"&&(et.flags|=4),typeof yt.getSnapshotBeforeUpdate=="function"&&(et.flags|=1024)):(typeof yt.componentDidUpdate!="function"||ct===_e.memoizedProps&&Mt===_e.memoizedState||(et.flags|=4),typeof yt.getSnapshotBeforeUpdate!="function"||ct===_e.memoizedProps&&Mt===_e.memoizedState||(et.flags|=1024),et.memoizedProps=at,et.memoizedState=Jt),yt.props=at,yt.state=Jt,yt.context=At,at=Pt):(typeof yt.componentDidUpdate!="function"||ct===_e.memoizedProps&&Mt===_e.memoizedState||(et.flags|=4),typeof yt.getSnapshotBeforeUpdate!="function"||ct===_e.memoizedProps&&Mt===_e.memoizedState||(et.flags|=1024),at=!1)}return kj(_e,et,rt,at,pt,ut)}function kj(_e,et,rt,at,ut,pt){hj(_e,et);var yt=(et.flags&128)!==0;if(!at&&!yt)return ut&&dg(et,rt,!1),$i(_e,et,pt);at=et.stateNode,Xi.current=et;var ct=yt&&typeof rt.getDerivedStateFromError!="function"?null:at.render();return et.flags|=1,_e!==null&&yt?(et.child=Bh(et,_e.child,null,pt),et.child=Bh(et,null,ct,pt)):Yi(_e,et,ct,pt),et.memoizedState=at.state,ut&&dg(et,rt,!0),et.child}function lj(_e){var et=_e.stateNode;et.pendingContext?ag(_e,et.pendingContext,et.pendingContext!==et.context):et.context&&ag(_e,et.context,!1),Ih(_e,et.containerInfo)}function mj(_e,et,rt,at,ut){return Ig(),Jg(ut),et.flags|=256,Yi(_e,et,rt,at),et.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(_e){return{baseLanes:_e,cachePool:null,transitions:null}}function pj(_e,et,rt){var at=et.pendingProps,ut=M$1.current,pt=!1,yt=(et.flags&128)!==0,ct;if((ct=yt)||(ct=_e!==null&&_e.memoizedState===null?!1:(ut&2)!==0),ct?(pt=!0,et.flags&=-129):(_e===null||_e.memoizedState!==null)&&(ut|=1),G$1(M$1,ut&1),_e===null)return Eg(et),_e=et.memoizedState,_e!==null&&(_e=_e.dehydrated,_e!==null)?(et.mode&1?_e.data==="$!"?et.lanes=8:et.lanes=1073741824:et.lanes=1,null):(yt=at.children,_e=at.fallback,pt?(at=et.mode,pt=et.child,yt={mode:"hidden",children:yt},!(at&1)&&pt!==null?(pt.childLanes=0,pt.pendingProps=yt):pt=qj(yt,at,0,null),_e=Ah(_e,at,rt,null),pt.return=et,_e.return=et,pt.sibling=_e,et.child=pt,et.child.memoizedState=oj(rt),et.memoizedState=nj,_e):rj(et,yt));if(ut=_e.memoizedState,ut!==null&&(ct=ut.dehydrated,ct!==null))return sj(_e,et,yt,at,ct,ut,rt);if(pt){pt=at.fallback,yt=et.mode,ut=_e.child,ct=ut.sibling;var At={mode:"hidden",children:at.children};return!(yt&1)&&et.child!==ut?(at=et.child,at.childLanes=0,at.pendingProps=At,et.deletions=null):(at=wh(ut,At),at.subtreeFlags=ut.subtreeFlags&14680064),ct!==null?pt=wh(ct,pt):(pt=Ah(pt,yt,rt,null),pt.flags|=2),pt.return=et,at.return=et,at.sibling=pt,et.child=at,at=pt,pt=et.child,yt=_e.child.memoizedState,yt=yt===null?oj(rt):{baseLanes:yt.baseLanes|rt,cachePool:null,transitions:yt.transitions},pt.memoizedState=yt,pt.childLanes=_e.childLanes&~rt,et.memoizedState=nj,at}return pt=_e.child,_e=pt.sibling,at=wh(pt,{mode:"visible",children:at.children}),!(et.mode&1)&&(at.lanes=rt),at.return=et,at.sibling=null,_e!==null&&(rt=et.deletions,rt===null?(et.deletions=[_e],et.flags|=16):rt.push(_e)),et.child=at,et.memoizedState=null,at}function rj(_e,et){return et=qj({mode:"visible",children:et},_e.mode,0,null),et.return=_e,_e.child=et}function tj(_e,et,rt,at){return at!==null&&Jg(at),Bh(et,_e.child,null,rt),_e=rj(et,et.pendingProps.children),_e.flags|=2,et.memoizedState=null,_e}function sj(_e,et,rt,at,ut,pt,yt){if(rt)return et.flags&256?(et.flags&=-257,at=Li(Error(p$3(422))),tj(_e,et,yt,at)):et.memoizedState!==null?(et.child=_e.child,et.flags|=128,null):(pt=at.fallback,ut=et.mode,at=qj({mode:"visible",children:at.children},ut,0,null),pt=Ah(pt,ut,yt,null),pt.flags|=2,at.return=et,pt.return=et,at.sibling=pt,et.child=at,et.mode&1&&Bh(et,_e.child,null,yt),et.child.memoizedState=oj(yt),et.memoizedState=nj,pt);if(!(et.mode&1))return tj(_e,et,yt,null);if(ut.data==="$!"){if(at=ut.nextSibling&&ut.nextSibling.dataset,at)var ct=at.dgst;return at=ct,pt=Error(p$3(419)),at=Li(pt,at,void 0),tj(_e,et,yt,at)}if(ct=(yt&_e.childLanes)!==0,Ug||ct){if(at=R,at!==null){switch(yt&-yt){case 4:ut=2;break;case 16:ut=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ut=32;break;case 536870912:ut=268435456;break;default:ut=0}ut=ut&(at.suspendedLanes|yt)?0:ut,ut!==0&&ut!==pt.retryLane&&(pt.retryLane=ut,Zg(_e,ut),mh(at,_e,ut,-1))}return uj(),at=Li(Error(p$3(421))),tj(_e,et,yt,at)}return ut.data==="$?"?(et.flags|=128,et.child=_e.child,et=vj.bind(null,_e),ut._reactRetry=et,null):(_e=pt.treeContext,yg=Lf(ut.nextSibling),xg=et,I$1=!0,zg=null,_e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=_e.id,sg=_e.overflow,qg=et),et=rj(et,at.children),et.flags|=4096,et)}function wj(_e,et,rt){_e.lanes|=et;var at=_e.alternate;at!==null&&(at.lanes|=et),Sg(_e.return,et,rt)}function xj(_e,et,rt,at,ut){var pt=_e.memoizedState;pt===null?_e.memoizedState={isBackwards:et,rendering:null,renderingStartTime:0,last:at,tail:rt,tailMode:ut}:(pt.isBackwards=et,pt.rendering=null,pt.renderingStartTime=0,pt.last=at,pt.tail=rt,pt.tailMode=ut)}function yj(_e,et,rt){var at=et.pendingProps,ut=at.revealOrder,pt=at.tail;if(Yi(_e,et,at.children,rt),at=M$1.current,at&2)at=at&1|2,et.flags|=128;else{if(_e!==null&&_e.flags&128)e:for(_e=et.child;_e!==null;){if(_e.tag===13)_e.memoizedState!==null&&wj(_e,rt,et);else if(_e.tag===19)wj(_e,rt,et);else if(_e.child!==null){_e.child.return=_e,_e=_e.child;continue}if(_e===et)break e;for(;_e.sibling===null;){if(_e.return===null||_e.return===et)break e;_e=_e.return}_e.sibling.return=_e.return,_e=_e.sibling}at&=1}if(G$1(M$1,at),!(et.mode&1))et.memoizedState=null;else switch(ut){case"forwards":for(rt=et.child,ut=null;rt!==null;)_e=rt.alternate,_e!==null&&Mh(_e)===null&&(ut=rt),rt=rt.sibling;rt=ut,rt===null?(ut=et.child,et.child=null):(ut=rt.sibling,rt.sibling=null),xj(et,!1,ut,rt,pt);break;case"backwards":for(rt=null,ut=et.child,et.child=null;ut!==null;){if(_e=ut.alternate,_e!==null&&Mh(_e)===null){et.child=ut;break}_e=ut.sibling,ut.sibling=rt,rt=ut,ut=_e}xj(et,!0,rt,null,pt);break;case"together":xj(et,!1,null,null,void 0);break;default:et.memoizedState=null}return et.child}function jj(_e,et){!(et.mode&1)&&_e!==null&&(_e.alternate=null,et.alternate=null,et.flags|=2)}function $i(_e,et,rt){if(_e!==null&&(et.dependencies=_e.dependencies),hh|=et.lanes,!(rt&et.childLanes))return null;if(_e!==null&&et.child!==_e.child)throw Error(p$3(153));if(et.child!==null){for(_e=et.child,rt=wh(_e,_e.pendingProps),et.child=rt,rt.return=et;_e.sibling!==null;)_e=_e.sibling,rt=rt.sibling=wh(_e,_e.pendingProps),rt.return=et;rt.sibling=null}return et.child}function zj(_e,et,rt){switch(et.tag){case 3:lj(et),Ig();break;case 5:Kh(et);break;case 1:Zf(et.type)&&cg(et);break;case 4:Ih(et,et.stateNode.containerInfo);break;case 10:var at=et.type._context,ut=et.memoizedProps.value;G$1(Mg,at._currentValue),at._currentValue=ut;break;case 13:if(at=et.memoizedState,at!==null)return at.dehydrated!==null?(G$1(M$1,M$1.current&1),et.flags|=128,null):rt&et.child.childLanes?pj(_e,et,rt):(G$1(M$1,M$1.current&1),_e=$i(_e,et,rt),_e!==null?_e.sibling:null);G$1(M$1,M$1.current&1);break;case 19:if(at=(rt&et.childLanes)!==0,_e.flags&128){if(at)return yj(_e,et,rt);et.flags|=128}if(ut=et.memoizedState,ut!==null&&(ut.rendering=null,ut.tail=null,ut.lastEffect=null),G$1(M$1,M$1.current),at)break;return null;case 22:case 23:return et.lanes=0,ej(_e,et,rt)}return $i(_e,et,rt)}var Aj,Bj,Cj,Dj;Aj=function(_e,et){for(var rt=et.child;rt!==null;){if(rt.tag===5||rt.tag===6)_e.appendChild(rt.stateNode);else if(rt.tag!==4&&rt.child!==null){rt.child.return=rt,rt=rt.child;continue}if(rt===et)break;for(;rt.sibling===null;){if(rt.return===null||rt.return===et)return;rt=rt.return}rt.sibling.return=rt.return,rt=rt.sibling}};Bj=function(){};Cj=function(_e,et,rt,at){var ut=_e.memoizedProps;if(ut!==at){_e=et.stateNode,Hh(Eh.current);var pt=null;switch(rt){case"input":ut=Ya(_e,ut),at=Ya(_e,at),pt=[];break;case"select":ut=A$1({},ut,{value:void 0}),at=A$1({},at,{value:void 0}),pt=[];break;case"textarea":ut=gb(_e,ut),at=gb(_e,at),pt=[];break;default:typeof ut.onClick!="function"&&typeof at.onClick=="function"&&(_e.onclick=Bf)}ub(rt,at);var yt;rt=null;for(Pt in ut)if(!at.hasOwnProperty(Pt)&&ut.hasOwnProperty(Pt)&&ut[Pt]!=null)if(Pt==="style"){var ct=ut[Pt];for(yt in ct)ct.hasOwnProperty(yt)&&(rt||(rt={}),rt[yt]="")}else Pt!=="dangerouslySetInnerHTML"&&Pt!=="children"&&Pt!=="suppressContentEditableWarning"&&Pt!=="suppressHydrationWarning"&&Pt!=="autoFocus"&&(ea.hasOwnProperty(Pt)?pt||(pt=[]):(pt=pt||[]).push(Pt,null));for(Pt in at){var At=at[Pt];if(ct=ut!=null?ut[Pt]:void 0,at.hasOwnProperty(Pt)&&At!==ct&&(At!=null||ct!=null))if(Pt==="style")if(ct){for(yt in ct)!ct.hasOwnProperty(yt)||At&&At.hasOwnProperty(yt)||(rt||(rt={}),rt[yt]="");for(yt in At)At.hasOwnProperty(yt)&&ct[yt]!==At[yt]&&(rt||(rt={}),rt[yt]=At[yt])}else rt||(pt||(pt=[]),pt.push(Pt,rt)),rt=At;else Pt==="dangerouslySetInnerHTML"?(At=At?At.__html:void 0,ct=ct?ct.__html:void 0,At!=null&&ct!==At&&(pt=pt||[]).push(Pt,At)):Pt==="children"?typeof At!="string"&&typeof At!="number"||(pt=pt||[]).push(Pt,""+At):Pt!=="suppressContentEditableWarning"&&Pt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(Pt)?(At!=null&&Pt==="onScroll"&&D$1("scroll",_e),pt||ct===At||(pt=[])):(pt=pt||[]).push(Pt,At))}rt&&(pt=pt||[]).push("style",rt);var Pt=pt;(et.updateQueue=Pt)&&(et.flags|=4)}};Dj=function(_e,et,rt,at){rt!==at&&(et.flags|=4)};function Ej(_e,et){if(!I$1)switch(_e.tailMode){case"hidden":et=_e.tail;for(var rt=null;et!==null;)et.alternate!==null&&(rt=et),et=et.sibling;rt===null?_e.tail=null:rt.sibling=null;break;case"collapsed":rt=_e.tail;for(var at=null;rt!==null;)rt.alternate!==null&&(at=rt),rt=rt.sibling;at===null?et||_e.tail===null?_e.tail=null:_e.tail.sibling=null:at.sibling=null}}function S$1(_e){var et=_e.alternate!==null&&_e.alternate.child===_e.child,rt=0,at=0;if(et)for(var ut=_e.child;ut!==null;)rt|=ut.lanes|ut.childLanes,at|=ut.subtreeFlags&14680064,at|=ut.flags&14680064,ut.return=_e,ut=ut.sibling;else for(ut=_e.child;ut!==null;)rt|=ut.lanes|ut.childLanes,at|=ut.subtreeFlags,at|=ut.flags,ut.return=_e,ut=ut.sibling;return _e.subtreeFlags|=at,_e.childLanes=rt,et}function Fj(_e,et,rt){var at=et.pendingProps;switch(wg(et),et.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(et),null;case 1:return Zf(et.type)&&$f(),S$1(et),null;case 3:return at=et.stateNode,Jh(),E(Wf),E(H),Oh(),at.pendingContext&&(at.context=at.pendingContext,at.pendingContext=null),(_e===null||_e.child===null)&&(Gg(et)?et.flags|=4:_e===null||_e.memoizedState.isDehydrated&&!(et.flags&256)||(et.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(_e,et),S$1(et),null;case 5:Lh(et);var ut=Hh(Gh.current);if(rt=et.type,_e!==null&&et.stateNode!=null)Cj(_e,et,rt,at,ut),_e.ref!==et.ref&&(et.flags|=512,et.flags|=2097152);else{if(!at){if(et.stateNode===null)throw Error(p$3(166));return S$1(et),null}if(_e=Hh(Eh.current),Gg(et)){at=et.stateNode,rt=et.type;var pt=et.memoizedProps;switch(at[Of]=et,at[Pf]=pt,_e=(et.mode&1)!==0,rt){case"dialog":D$1("cancel",at),D$1("close",at);break;case"iframe":case"object":case"embed":D$1("load",at);break;case"video":case"audio":for(ut=0;ut<lf.length;ut++)D$1(lf[ut],at);break;case"source":D$1("error",at);break;case"img":case"image":case"link":D$1("error",at),D$1("load",at);break;case"details":D$1("toggle",at);break;case"input":Za(at,pt),D$1("invalid",at);break;case"select":at._wrapperState={wasMultiple:!!pt.multiple},D$1("invalid",at);break;case"textarea":hb(at,pt),D$1("invalid",at)}ub(rt,pt),ut=null;for(var yt in pt)if(pt.hasOwnProperty(yt)){var ct=pt[yt];yt==="children"?typeof ct=="string"?at.textContent!==ct&&(pt.suppressHydrationWarning!==!0&&Af(at.textContent,ct,_e),ut=["children",ct]):typeof ct=="number"&&at.textContent!==""+ct&&(pt.suppressHydrationWarning!==!0&&Af(at.textContent,ct,_e),ut=["children",""+ct]):ea.hasOwnProperty(yt)&&ct!=null&&yt==="onScroll"&&D$1("scroll",at)}switch(rt){case"input":Va(at),db(at,pt,!0);break;case"textarea":Va(at),jb(at);break;case"select":case"option":break;default:typeof pt.onClick=="function"&&(at.onclick=Bf)}at=ut,et.updateQueue=at,at!==null&&(et.flags|=4)}else{yt=ut.nodeType===9?ut:ut.ownerDocument,_e==="http://www.w3.org/1999/xhtml"&&(_e=kb(rt)),_e==="http://www.w3.org/1999/xhtml"?rt==="script"?(_e=yt.createElement("div"),_e.innerHTML="<script><\/script>",_e=_e.removeChild(_e.firstChild)):typeof at.is=="string"?_e=yt.createElement(rt,{is:at.is}):(_e=yt.createElement(rt),rt==="select"&&(yt=_e,at.multiple?yt.multiple=!0:at.size&&(yt.size=at.size))):_e=yt.createElementNS(_e,rt),_e[Of]=et,_e[Pf]=at,Aj(_e,et,!1,!1),et.stateNode=_e;e:{switch(yt=vb(rt,at),rt){case"dialog":D$1("cancel",_e),D$1("close",_e),ut=at;break;case"iframe":case"object":case"embed":D$1("load",_e),ut=at;break;case"video":case"audio":for(ut=0;ut<lf.length;ut++)D$1(lf[ut],_e);ut=at;break;case"source":D$1("error",_e),ut=at;break;case"img":case"image":case"link":D$1("error",_e),D$1("load",_e),ut=at;break;case"details":D$1("toggle",_e),ut=at;break;case"input":Za(_e,at),ut=Ya(_e,at),D$1("invalid",_e);break;case"option":ut=at;break;case"select":_e._wrapperState={wasMultiple:!!at.multiple},ut=A$1({},at,{value:void 0}),D$1("invalid",_e);break;case"textarea":hb(_e,at),ut=gb(_e,at),D$1("invalid",_e);break;default:ut=at}ub(rt,ut),ct=ut;for(pt in ct)if(ct.hasOwnProperty(pt)){var At=ct[pt];pt==="style"?sb(_e,At):pt==="dangerouslySetInnerHTML"?(At=At?At.__html:void 0,At!=null&&nb(_e,At)):pt==="children"?typeof At=="string"?(rt!=="textarea"||At!=="")&&ob(_e,At):typeof At=="number"&&ob(_e,""+At):pt!=="suppressContentEditableWarning"&&pt!=="suppressHydrationWarning"&&pt!=="autoFocus"&&(ea.hasOwnProperty(pt)?At!=null&&pt==="onScroll"&&D$1("scroll",_e):At!=null&&ta(_e,pt,At,yt))}switch(rt){case"input":Va(_e),db(_e,at,!1);break;case"textarea":Va(_e),jb(_e);break;case"option":at.value!=null&&_e.setAttribute("value",""+Sa(at.value));break;case"select":_e.multiple=!!at.multiple,pt=at.value,pt!=null?fb(_e,!!at.multiple,pt,!1):at.defaultValue!=null&&fb(_e,!!at.multiple,at.defaultValue,!0);break;default:typeof ut.onClick=="function"&&(_e.onclick=Bf)}switch(rt){case"button":case"input":case"select":case"textarea":at=!!at.autoFocus;break e;case"img":at=!0;break e;default:at=!1}}at&&(et.flags|=4)}et.ref!==null&&(et.flags|=512,et.flags|=2097152)}return S$1(et),null;case 6:if(_e&&et.stateNode!=null)Dj(_e,et,_e.memoizedProps,at);else{if(typeof at!="string"&&et.stateNode===null)throw Error(p$3(166));if(rt=Hh(Gh.current),Hh(Eh.current),Gg(et)){if(at=et.stateNode,rt=et.memoizedProps,at[Of]=et,(pt=at.nodeValue!==rt)&&(_e=xg,_e!==null))switch(_e.tag){case 3:Af(at.nodeValue,rt,(_e.mode&1)!==0);break;case 5:_e.memoizedProps.suppressHydrationWarning!==!0&&Af(at.nodeValue,rt,(_e.mode&1)!==0)}pt&&(et.flags|=4)}else at=(rt.nodeType===9?rt:rt.ownerDocument).createTextNode(at),at[Of]=et,et.stateNode=at}return S$1(et),null;case 13:if(E(M$1),at=et.memoizedState,_e===null||_e.memoizedState!==null&&_e.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&et.mode&1&&!(et.flags&128))Hg(),Ig(),et.flags|=98560,pt=!1;else if(pt=Gg(et),at!==null&&at.dehydrated!==null){if(_e===null){if(!pt)throw Error(p$3(318));if(pt=et.memoizedState,pt=pt!==null?pt.dehydrated:null,!pt)throw Error(p$3(317));pt[Of]=et}else Ig(),!(et.flags&128)&&(et.memoizedState=null),et.flags|=4;S$1(et),pt=!1}else zg!==null&&(Gj(zg),zg=null),pt=!0;if(!pt)return et.flags&65536?et:null}return et.flags&128?(et.lanes=rt,et):(at=at!==null,at!==(_e!==null&&_e.memoizedState!==null)&&at&&(et.child.flags|=8192,et.mode&1&&(_e===null||M$1.current&1?T$1===0&&(T$1=3):uj())),et.updateQueue!==null&&(et.flags|=4),S$1(et),null);case 4:return Jh(),Bj(_e,et),_e===null&&sf(et.stateNode.containerInfo),S$1(et),null;case 10:return Rg(et.type._context),S$1(et),null;case 17:return Zf(et.type)&&$f(),S$1(et),null;case 19:if(E(M$1),pt=et.memoizedState,pt===null)return S$1(et),null;if(at=(et.flags&128)!==0,yt=pt.rendering,yt===null)if(at)Ej(pt,!1);else{if(T$1!==0||_e!==null&&_e.flags&128)for(_e=et.child;_e!==null;){if(yt=Mh(_e),yt!==null){for(et.flags|=128,Ej(pt,!1),at=yt.updateQueue,at!==null&&(et.updateQueue=at,et.flags|=4),et.subtreeFlags=0,at=rt,rt=et.child;rt!==null;)pt=rt,_e=at,pt.flags&=14680066,yt=pt.alternate,yt===null?(pt.childLanes=0,pt.lanes=_e,pt.child=null,pt.subtreeFlags=0,pt.memoizedProps=null,pt.memoizedState=null,pt.updateQueue=null,pt.dependencies=null,pt.stateNode=null):(pt.childLanes=yt.childLanes,pt.lanes=yt.lanes,pt.child=yt.child,pt.subtreeFlags=0,pt.deletions=null,pt.memoizedProps=yt.memoizedProps,pt.memoizedState=yt.memoizedState,pt.updateQueue=yt.updateQueue,pt.type=yt.type,_e=yt.dependencies,pt.dependencies=_e===null?null:{lanes:_e.lanes,firstContext:_e.firstContext}),rt=rt.sibling;return G$1(M$1,M$1.current&1|2),et.child}_e=_e.sibling}pt.tail!==null&&B()>Hj&&(et.flags|=128,at=!0,Ej(pt,!1),et.lanes=4194304)}else{if(!at)if(_e=Mh(yt),_e!==null){if(et.flags|=128,at=!0,rt=_e.updateQueue,rt!==null&&(et.updateQueue=rt,et.flags|=4),Ej(pt,!0),pt.tail===null&&pt.tailMode==="hidden"&&!yt.alternate&&!I$1)return S$1(et),null}else 2*B()-pt.renderingStartTime>Hj&&rt!==1073741824&&(et.flags|=128,at=!0,Ej(pt,!1),et.lanes=4194304);pt.isBackwards?(yt.sibling=et.child,et.child=yt):(rt=pt.last,rt!==null?rt.sibling=yt:et.child=yt,pt.last=yt)}return pt.tail!==null?(et=pt.tail,pt.rendering=et,pt.tail=et.sibling,pt.renderingStartTime=B(),et.sibling=null,rt=M$1.current,G$1(M$1,at?rt&1|2:rt&1),et):(S$1(et),null);case 22:case 23:return Ij(),at=et.memoizedState!==null,_e!==null&&_e.memoizedState!==null!==at&&(et.flags|=8192),at&&et.mode&1?gj&1073741824&&(S$1(et),et.subtreeFlags&6&&(et.flags|=8192)):S$1(et),null;case 24:return null;case 25:return null}throw Error(p$3(156,et.tag))}function Jj(_e,et){switch(wg(et),et.tag){case 1:return Zf(et.type)&&$f(),_e=et.flags,_e&65536?(et.flags=_e&-65537|128,et):null;case 3:return Jh(),E(Wf),E(H),Oh(),_e=et.flags,_e&65536&&!(_e&128)?(et.flags=_e&-65537|128,et):null;case 5:return Lh(et),null;case 13:if(E(M$1),_e=et.memoizedState,_e!==null&&_e.dehydrated!==null){if(et.alternate===null)throw Error(p$3(340));Ig()}return _e=et.flags,_e&65536?(et.flags=_e&-65537|128,et):null;case 19:return E(M$1),null;case 4:return Jh(),null;case 10:return Rg(et.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U$1=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Mj(_e,et){var rt=_e.ref;if(rt!==null)if(typeof rt=="function")try{rt(null)}catch(at){W$1(_e,et,at)}else rt.current=null}function Nj(_e,et,rt){try{rt()}catch(at){W$1(_e,et,at)}}var Oj=!1;function Pj(_e,et){if(Cf=dd,_e=Me(),Ne(_e)){if("selectionStart"in _e)var rt={start:_e.selectionStart,end:_e.selectionEnd};else e:{rt=(rt=_e.ownerDocument)&&rt.defaultView||window;var at=rt.getSelection&&rt.getSelection();if(at&&at.rangeCount!==0){rt=at.anchorNode;var ut=at.anchorOffset,pt=at.focusNode;at=at.focusOffset;try{rt.nodeType,pt.nodeType}catch{rt=null;break e}var yt=0,ct=-1,At=-1,Pt=0,kt=0,Lt=_e,Mt=null;t:for(;;){for(var Qt;Lt!==rt||ut!==0&&Lt.nodeType!==3||(ct=yt+ut),Lt!==pt||at!==0&&Lt.nodeType!==3||(At=yt+at),Lt.nodeType===3&&(yt+=Lt.nodeValue.length),(Qt=Lt.firstChild)!==null;)Mt=Lt,Lt=Qt;for(;;){if(Lt===_e)break t;if(Mt===rt&&++Pt===ut&&(ct=yt),Mt===pt&&++kt===at&&(At=yt),(Qt=Lt.nextSibling)!==null)break;Lt=Mt,Mt=Lt.parentNode}Lt=Qt}rt=ct===-1||At===-1?null:{start:ct,end:At}}else rt=null}rt=rt||{start:0,end:0}}else rt=null;for(Df={focusedElem:_e,selectionRange:rt},dd=!1,V$1=et;V$1!==null;)if(et=V$1,_e=et.child,(et.subtreeFlags&1028)!==0&&_e!==null)_e.return=et,V$1=_e;else for(;V$1!==null;){et=V$1;try{var Jt=et.alternate;if(et.flags&1024)switch(et.tag){case 0:case 11:case 15:break;case 1:if(Jt!==null){var sn=Jt.memoizedProps,tn=Jt.memoizedState,Bt=et.stateNode,zt=Bt.getSnapshotBeforeUpdate(et.elementType===et.type?sn:Lg(et.type,sn),tn);Bt.__reactInternalSnapshotBeforeUpdate=zt}break;case 3:var Ht=et.stateNode.containerInfo;Ht.nodeType===1?Ht.textContent="":Ht.nodeType===9&&Ht.documentElement&&Ht.removeChild(Ht.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$3(163))}}catch(nn){W$1(et,et.return,nn)}if(_e=et.sibling,_e!==null){_e.return=et.return,V$1=_e;break}V$1=et.return}return Jt=Oj,Oj=!1,Jt}function Qj(_e,et,rt){var at=et.updateQueue;if(at=at!==null?at.lastEffect:null,at!==null){var ut=at=at.next;do{if((ut.tag&_e)===_e){var pt=ut.destroy;ut.destroy=void 0,pt!==void 0&&Nj(et,rt,pt)}ut=ut.next}while(ut!==at)}}function Rj(_e,et){if(et=et.updateQueue,et=et!==null?et.lastEffect:null,et!==null){var rt=et=et.next;do{if((rt.tag&_e)===_e){var at=rt.create;rt.destroy=at()}rt=rt.next}while(rt!==et)}}function Sj(_e){var et=_e.ref;if(et!==null){var rt=_e.stateNode;switch(_e.tag){case 5:_e=rt;break;default:_e=rt}typeof et=="function"?et(_e):et.current=_e}}function Tj(_e){var et=_e.alternate;et!==null&&(_e.alternate=null,Tj(et)),_e.child=null,_e.deletions=null,_e.sibling=null,_e.tag===5&&(et=_e.stateNode,et!==null&&(delete et[Of],delete et[Pf],delete et[of],delete et[Qf],delete et[Rf])),_e.stateNode=null,_e.return=null,_e.dependencies=null,_e.memoizedProps=null,_e.memoizedState=null,_e.pendingProps=null,_e.stateNode=null,_e.updateQueue=null}function Uj(_e){return _e.tag===5||_e.tag===3||_e.tag===4}function Vj(_e){e:for(;;){for(;_e.sibling===null;){if(_e.return===null||Uj(_e.return))return null;_e=_e.return}for(_e.sibling.return=_e.return,_e=_e.sibling;_e.tag!==5&&_e.tag!==6&&_e.tag!==18;){if(_e.flags&2||_e.child===null||_e.tag===4)continue e;_e.child.return=_e,_e=_e.child}if(!(_e.flags&2))return _e.stateNode}}function Wj(_e,et,rt){var at=_e.tag;if(at===5||at===6)_e=_e.stateNode,et?rt.nodeType===8?rt.parentNode.insertBefore(_e,et):rt.insertBefore(_e,et):(rt.nodeType===8?(et=rt.parentNode,et.insertBefore(_e,rt)):(et=rt,et.appendChild(_e)),rt=rt._reactRootContainer,rt!=null||et.onclick!==null||(et.onclick=Bf));else if(at!==4&&(_e=_e.child,_e!==null))for(Wj(_e,et,rt),_e=_e.sibling;_e!==null;)Wj(_e,et,rt),_e=_e.sibling}function Xj(_e,et,rt){var at=_e.tag;if(at===5||at===6)_e=_e.stateNode,et?rt.insertBefore(_e,et):rt.appendChild(_e);else if(at!==4&&(_e=_e.child,_e!==null))for(Xj(_e,et,rt),_e=_e.sibling;_e!==null;)Xj(_e,et,rt),_e=_e.sibling}var X$1=null,Yj=!1;function Zj(_e,et,rt){for(rt=rt.child;rt!==null;)ak(_e,et,rt),rt=rt.sibling}function ak(_e,et,rt){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,rt)}catch{}switch(rt.tag){case 5:U$1||Mj(rt,et);case 6:var at=X$1,ut=Yj;X$1=null,Zj(_e,et,rt),X$1=at,Yj=ut,X$1!==null&&(Yj?(_e=X$1,rt=rt.stateNode,_e.nodeType===8?_e.parentNode.removeChild(rt):_e.removeChild(rt)):X$1.removeChild(rt.stateNode));break;case 18:X$1!==null&&(Yj?(_e=X$1,rt=rt.stateNode,_e.nodeType===8?Kf(_e.parentNode,rt):_e.nodeType===1&&Kf(_e,rt),bd(_e)):Kf(X$1,rt.stateNode));break;case 4:at=X$1,ut=Yj,X$1=rt.stateNode.containerInfo,Yj=!0,Zj(_e,et,rt),X$1=at,Yj=ut;break;case 0:case 11:case 14:case 15:if(!U$1&&(at=rt.updateQueue,at!==null&&(at=at.lastEffect,at!==null))){ut=at=at.next;do{var pt=ut,yt=pt.destroy;pt=pt.tag,yt!==void 0&&(pt&2||pt&4)&&Nj(rt,et,yt),ut=ut.next}while(ut!==at)}Zj(_e,et,rt);break;case 1:if(!U$1&&(Mj(rt,et),at=rt.stateNode,typeof at.componentWillUnmount=="function"))try{at.props=rt.memoizedProps,at.state=rt.memoizedState,at.componentWillUnmount()}catch(ct){W$1(rt,et,ct)}Zj(_e,et,rt);break;case 21:Zj(_e,et,rt);break;case 22:rt.mode&1?(U$1=(at=U$1)||rt.memoizedState!==null,Zj(_e,et,rt),U$1=at):Zj(_e,et,rt);break;default:Zj(_e,et,rt)}}function bk(_e){var et=_e.updateQueue;if(et!==null){_e.updateQueue=null;var rt=_e.stateNode;rt===null&&(rt=_e.stateNode=new Lj),et.forEach(function(at){var ut=ck.bind(null,_e,at);rt.has(at)||(rt.add(at),at.then(ut,ut))})}}function dk(_e,et){var rt=et.deletions;if(rt!==null)for(var at=0;at<rt.length;at++){var ut=rt[at];try{var pt=_e,yt=et,ct=yt;e:for(;ct!==null;){switch(ct.tag){case 5:X$1=ct.stateNode,Yj=!1;break e;case 3:X$1=ct.stateNode.containerInfo,Yj=!0;break e;case 4:X$1=ct.stateNode.containerInfo,Yj=!0;break e}ct=ct.return}if(X$1===null)throw Error(p$3(160));ak(pt,yt,ut),X$1=null,Yj=!1;var At=ut.alternate;At!==null&&(At.return=null),ut.return=null}catch(Pt){W$1(ut,et,Pt)}}if(et.subtreeFlags&12854)for(et=et.child;et!==null;)ek(et,_e),et=et.sibling}function ek(_e,et){var rt=_e.alternate,at=_e.flags;switch(_e.tag){case 0:case 11:case 14:case 15:if(dk(et,_e),fk(_e),at&4){try{Qj(3,_e,_e.return),Rj(3,_e)}catch(sn){W$1(_e,_e.return,sn)}try{Qj(5,_e,_e.return)}catch(sn){W$1(_e,_e.return,sn)}}break;case 1:dk(et,_e),fk(_e),at&512&&rt!==null&&Mj(rt,rt.return);break;case 5:if(dk(et,_e),fk(_e),at&512&&rt!==null&&Mj(rt,rt.return),_e.flags&32){var ut=_e.stateNode;try{ob(ut,"")}catch(sn){W$1(_e,_e.return,sn)}}if(at&4&&(ut=_e.stateNode,ut!=null)){var pt=_e.memoizedProps,yt=rt!==null?rt.memoizedProps:pt,ct=_e.type,At=_e.updateQueue;if(_e.updateQueue=null,At!==null)try{ct==="input"&&pt.type==="radio"&&pt.name!=null&&ab(ut,pt),vb(ct,yt);var Pt=vb(ct,pt);for(yt=0;yt<At.length;yt+=2){var kt=At[yt],Lt=At[yt+1];kt==="style"?sb(ut,Lt):kt==="dangerouslySetInnerHTML"?nb(ut,Lt):kt==="children"?ob(ut,Lt):ta(ut,kt,Lt,Pt)}switch(ct){case"input":bb(ut,pt);break;case"textarea":ib(ut,pt);break;case"select":var Mt=ut._wrapperState.wasMultiple;ut._wrapperState.wasMultiple=!!pt.multiple;var Qt=pt.value;Qt!=null?fb(ut,!!pt.multiple,Qt,!1):Mt!==!!pt.multiple&&(pt.defaultValue!=null?fb(ut,!!pt.multiple,pt.defaultValue,!0):fb(ut,!!pt.multiple,pt.multiple?[]:"",!1))}ut[Pf]=pt}catch(sn){W$1(_e,_e.return,sn)}}break;case 6:if(dk(et,_e),fk(_e),at&4){if(_e.stateNode===null)throw Error(p$3(162));ut=_e.stateNode,pt=_e.memoizedProps;try{ut.nodeValue=pt}catch(sn){W$1(_e,_e.return,sn)}}break;case 3:if(dk(et,_e),fk(_e),at&4&&rt!==null&&rt.memoizedState.isDehydrated)try{bd(et.containerInfo)}catch(sn){W$1(_e,_e.return,sn)}break;case 4:dk(et,_e),fk(_e);break;case 13:dk(et,_e),fk(_e),ut=_e.child,ut.flags&8192&&(pt=ut.memoizedState!==null,ut.stateNode.isHidden=pt,!pt||ut.alternate!==null&&ut.alternate.memoizedState!==null||(gk=B())),at&4&&bk(_e);break;case 22:if(kt=rt!==null&&rt.memoizedState!==null,_e.mode&1?(U$1=(Pt=U$1)||kt,dk(et,_e),U$1=Pt):dk(et,_e),fk(_e),at&8192){if(Pt=_e.memoizedState!==null,(_e.stateNode.isHidden=Pt)&&!kt&&_e.mode&1)for(V$1=_e,kt=_e.child;kt!==null;){for(Lt=V$1=kt;V$1!==null;){switch(Mt=V$1,Qt=Mt.child,Mt.tag){case 0:case 11:case 14:case 15:Qj(4,Mt,Mt.return);break;case 1:Mj(Mt,Mt.return);var Jt=Mt.stateNode;if(typeof Jt.componentWillUnmount=="function"){at=Mt,rt=Mt.return;try{et=at,Jt.props=et.memoizedProps,Jt.state=et.memoizedState,Jt.componentWillUnmount()}catch(sn){W$1(at,rt,sn)}}break;case 5:Mj(Mt,Mt.return);break;case 22:if(Mt.memoizedState!==null){hk(Lt);continue}}Qt!==null?(Qt.return=Mt,V$1=Qt):hk(Lt)}kt=kt.sibling}e:for(kt=null,Lt=_e;;){if(Lt.tag===5){if(kt===null){kt=Lt;try{ut=Lt.stateNode,Pt?(pt=ut.style,typeof pt.setProperty=="function"?pt.setProperty("display","none","important"):pt.display="none"):(ct=Lt.stateNode,At=Lt.memoizedProps.style,yt=At!=null&&At.hasOwnProperty("display")?At.display:null,ct.style.display=rb("display",yt))}catch(sn){W$1(_e,_e.return,sn)}}}else if(Lt.tag===6){if(kt===null)try{Lt.stateNode.nodeValue=Pt?"":Lt.memoizedProps}catch(sn){W$1(_e,_e.return,sn)}}else if((Lt.tag!==22&&Lt.tag!==23||Lt.memoizedState===null||Lt===_e)&&Lt.child!==null){Lt.child.return=Lt,Lt=Lt.child;continue}if(Lt===_e)break e;for(;Lt.sibling===null;){if(Lt.return===null||Lt.return===_e)break e;kt===Lt&&(kt=null),Lt=Lt.return}kt===Lt&&(kt=null),Lt.sibling.return=Lt.return,Lt=Lt.sibling}}break;case 19:dk(et,_e),fk(_e),at&4&&bk(_e);break;case 21:break;default:dk(et,_e),fk(_e)}}function fk(_e){var et=_e.flags;if(et&2){try{e:{for(var rt=_e.return;rt!==null;){if(Uj(rt)){var at=rt;break e}rt=rt.return}throw Error(p$3(160))}switch(at.tag){case 5:var ut=at.stateNode;at.flags&32&&(ob(ut,""),at.flags&=-33);var pt=Vj(_e);Xj(_e,pt,ut);break;case 3:case 4:var yt=at.stateNode.containerInfo,ct=Vj(_e);Wj(_e,ct,yt);break;default:throw Error(p$3(161))}}catch(At){W$1(_e,_e.return,At)}_e.flags&=-3}et&4096&&(_e.flags&=-4097)}function ik(_e,et,rt){V$1=_e,jk(_e)}function jk(_e,et,rt){for(var at=(_e.mode&1)!==0;V$1!==null;){var ut=V$1,pt=ut.child;if(ut.tag===22&&at){var yt=ut.memoizedState!==null||Kj;if(!yt){var ct=ut.alternate,At=ct!==null&&ct.memoizedState!==null||U$1;ct=Kj;var Pt=U$1;if(Kj=yt,(U$1=At)&&!Pt)for(V$1=ut;V$1!==null;)yt=V$1,At=yt.child,yt.tag===22&&yt.memoizedState!==null?kk(ut):At!==null?(At.return=yt,V$1=At):kk(ut);for(;pt!==null;)V$1=pt,jk(pt),pt=pt.sibling;V$1=ut,Kj=ct,U$1=Pt}lk(_e)}else ut.subtreeFlags&8772&&pt!==null?(pt.return=ut,V$1=pt):lk(_e)}}function lk(_e){for(;V$1!==null;){var et=V$1;if(et.flags&8772){var rt=et.alternate;try{if(et.flags&8772)switch(et.tag){case 0:case 11:case 15:U$1||Rj(5,et);break;case 1:var at=et.stateNode;if(et.flags&4&&!U$1)if(rt===null)at.componentDidMount();else{var ut=et.elementType===et.type?rt.memoizedProps:Lg(et.type,rt.memoizedProps);at.componentDidUpdate(ut,rt.memoizedState,at.__reactInternalSnapshotBeforeUpdate)}var pt=et.updateQueue;pt!==null&&ih(et,pt,at);break;case 3:var yt=et.updateQueue;if(yt!==null){if(rt=null,et.child!==null)switch(et.child.tag){case 5:rt=et.child.stateNode;break;case 1:rt=et.child.stateNode}ih(et,yt,rt)}break;case 5:var ct=et.stateNode;if(rt===null&&et.flags&4){rt=ct;var At=et.memoizedProps;switch(et.type){case"button":case"input":case"select":case"textarea":At.autoFocus&&rt.focus();break;case"img":At.src&&(rt.src=At.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(et.memoizedState===null){var Pt=et.alternate;if(Pt!==null){var kt=Pt.memoizedState;if(kt!==null){var Lt=kt.dehydrated;Lt!==null&&bd(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$3(163))}U$1||et.flags&512&&Sj(et)}catch(Mt){W$1(et,et.return,Mt)}}if(et===_e){V$1=null;break}if(rt=et.sibling,rt!==null){rt.return=et.return,V$1=rt;break}V$1=et.return}}function hk(_e){for(;V$1!==null;){var et=V$1;if(et===_e){V$1=null;break}var rt=et.sibling;if(rt!==null){rt.return=et.return,V$1=rt;break}V$1=et.return}}function kk(_e){for(;V$1!==null;){var et=V$1;try{switch(et.tag){case 0:case 11:case 15:var rt=et.return;try{Rj(4,et)}catch(At){W$1(et,rt,At)}break;case 1:var at=et.stateNode;if(typeof at.componentDidMount=="function"){var ut=et.return;try{at.componentDidMount()}catch(At){W$1(et,ut,At)}}var pt=et.return;try{Sj(et)}catch(At){W$1(et,pt,At)}break;case 5:var yt=et.return;try{Sj(et)}catch(At){W$1(et,yt,At)}}}catch(At){W$1(et,et.return,At)}if(et===_e){V$1=null;break}var ct=et.sibling;if(ct!==null){ct.return=et.return,V$1=ct;break}V$1=et.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y$1=null,Z$1=0,gj=0,fj=Uf(0),T$1=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh(_e){return _e.mode&1?K&2&&Z$1!==0?Z$1&-Z$1:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(_e=C,_e!==0||(_e=window.event,_e=_e===void 0?16:jd(_e.type)),_e):1}function mh(_e,et,rt,at){if(50<zk)throw zk=0,Ak=null,Error(p$3(185));Ac(_e,rt,at),(!(K&2)||_e!==R)&&(_e===R&&(!(K&2)&&(rk|=rt),T$1===4&&Dk(_e,Z$1)),Ek(_e,at),rt===1&&K===0&&!(et.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek(_e,et){var rt=_e.callbackNode;wc(_e,et);var at=uc(_e,_e===R?Z$1:0);if(at===0)rt!==null&&bc(rt),_e.callbackNode=null,_e.callbackPriority=0;else if(et=at&-at,_e.callbackPriority!==et){if(rt!=null&&bc(rt),et===1)_e.tag===0?ig(Fk.bind(null,_e)):hg(Fk.bind(null,_e)),Jf(function(){!(K&6)&&jg()}),rt=null;else{switch(Dc(at)){case 1:rt=fc;break;case 4:rt=gc;break;case 16:rt=hc;break;case 536870912:rt=jc;break;default:rt=hc}rt=Gk(rt,Hk.bind(null,_e))}_e.callbackPriority=et,_e.callbackNode=rt}}function Hk(_e,et){if(Bk=-1,Ck=0,K&6)throw Error(p$3(327));var rt=_e.callbackNode;if(Ik()&&_e.callbackNode!==rt)return null;var at=uc(_e,_e===R?Z$1:0);if(at===0)return null;if(at&30||at&_e.expiredLanes||et)et=Jk(_e,at);else{et=at;var ut=K;K|=2;var pt=Kk();(R!==_e||Z$1!==et)&&(vk=null,Hj=B()+500,Lk(_e,et));do try{Mk();break}catch(ct){Nk(_e,ct)}while(!0);Qg(),nk.current=pt,K=ut,Y$1!==null?et=0:(R=null,Z$1=0,et=T$1)}if(et!==0){if(et===2&&(ut=xc(_e),ut!==0&&(at=ut,et=Ok(_e,ut))),et===1)throw rt=qk,Lk(_e,0),Dk(_e,at),Ek(_e,B()),rt;if(et===6)Dk(_e,at);else{if(ut=_e.current.alternate,!(at&30)&&!Pk(ut)&&(et=Jk(_e,at),et===2&&(pt=xc(_e),pt!==0&&(at=pt,et=Ok(_e,pt))),et===1))throw rt=qk,Lk(_e,0),Dk(_e,at),Ek(_e,B()),rt;switch(_e.finishedWork=ut,_e.finishedLanes=at,et){case 0:case 1:throw Error(p$3(345));case 2:Qk(_e,uk,vk);break;case 3:if(Dk(_e,at),(at&130023424)===at&&(et=gk+500-B(),10<et)){if(uc(_e,0)!==0)break;if(ut=_e.suspendedLanes,(ut&at)!==at){L(),_e.pingedLanes|=_e.suspendedLanes&ut;break}_e.timeoutHandle=Ff(Qk.bind(null,_e,uk,vk),et);break}Qk(_e,uk,vk);break;case 4:if(Dk(_e,at),(at&4194240)===at)break;for(et=_e.eventTimes,ut=-1;0<at;){var yt=31-oc(at);pt=1<<yt,yt=et[yt],yt>ut&&(ut=yt),at&=~pt}if(at=ut,at=B()-at,at=(120>at?120:480>at?480:1080>at?1080:1920>at?1920:3e3>at?3e3:4320>at?4320:1960*mk(at/1960))-at,10<at){_e.timeoutHandle=Ff(Qk.bind(null,_e,uk,vk),at);break}Qk(_e,uk,vk);break;case 5:Qk(_e,uk,vk);break;default:throw Error(p$3(329))}}}return Ek(_e,B()),_e.callbackNode===rt?Hk.bind(null,_e):null}function Ok(_e,et){var rt=tk;return _e.current.memoizedState.isDehydrated&&(Lk(_e,et).flags|=256),_e=Jk(_e,et),_e!==2&&(et=uk,uk=rt,et!==null&&Gj(et)),_e}function Gj(_e){uk===null?uk=_e:uk.push.apply(uk,_e)}function Pk(_e){for(var et=_e;;){if(et.flags&16384){var rt=et.updateQueue;if(rt!==null&&(rt=rt.stores,rt!==null))for(var at=0;at<rt.length;at++){var ut=rt[at],pt=ut.getSnapshot;ut=ut.value;try{if(!He(pt(),ut))return!1}catch{return!1}}}if(rt=et.child,et.subtreeFlags&16384&&rt!==null)rt.return=et,et=rt;else{if(et===_e)break;for(;et.sibling===null;){if(et.return===null||et.return===_e)return!0;et=et.return}et.sibling.return=et.return,et=et.sibling}}return!0}function Dk(_e,et){for(et&=~sk,et&=~rk,_e.suspendedLanes|=et,_e.pingedLanes&=~et,_e=_e.expirationTimes;0<et;){var rt=31-oc(et),at=1<<rt;_e[rt]=-1,et&=~at}}function Fk(_e){if(K&6)throw Error(p$3(327));Ik();var et=uc(_e,0);if(!(et&1))return Ek(_e,B()),null;var rt=Jk(_e,et);if(_e.tag!==0&&rt===2){var at=xc(_e);at!==0&&(et=at,rt=Ok(_e,at))}if(rt===1)throw rt=qk,Lk(_e,0),Dk(_e,et),Ek(_e,B()),rt;if(rt===6)throw Error(p$3(345));return _e.finishedWork=_e.current.alternate,_e.finishedLanes=et,Qk(_e,uk,vk),Ek(_e,B()),null}function Rk(_e,et){var rt=K;K|=1;try{return _e(et)}finally{K=rt,K===0&&(Hj=B()+500,fg&&jg())}}function Sk(_e){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var et=K;K|=1;var rt=pk.transition,at=C;try{if(pk.transition=null,C=1,_e)return _e()}finally{C=at,pk.transition=rt,K=et,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk(_e,et){_e.finishedWork=null,_e.finishedLanes=0;var rt=_e.timeoutHandle;if(rt!==-1&&(_e.timeoutHandle=-1,Gf(rt)),Y$1!==null)for(rt=Y$1.return;rt!==null;){var at=rt;switch(wg(at),at.tag){case 1:at=at.type.childContextTypes,at!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(at);break;case 4:Jh();break;case 13:E(M$1);break;case 19:E(M$1);break;case 10:Rg(at.type._context);break;case 22:case 23:Ij()}rt=rt.return}if(R=_e,Y$1=_e=wh(_e.current,null),Z$1=gj=et,T$1=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(et=0;et<Wg.length;et++)if(rt=Wg[et],at=rt.interleaved,at!==null){rt.interleaved=null;var ut=at.next,pt=rt.pending;if(pt!==null){var yt=pt.next;pt.next=ut,at.next=yt}rt.pending=at}Wg=null}return _e}function Nk(_e,et){do{var rt=Y$1;try{if(Qg(),Ph.current=ai,Sh){for(var at=N.memoizedState;at!==null;){var ut=at.queue;ut!==null&&(ut.pending=null),at=at.next}Sh=!1}if(Rh=0,P$1=O$1=N=null,Th=!1,Uh=0,ok.current=null,rt===null||rt.return===null){T$1=1,qk=et,Y$1=null;break}e:{var pt=_e,yt=rt.return,ct=rt,At=et;if(et=Z$1,ct.flags|=32768,At!==null&&typeof At=="object"&&typeof At.then=="function"){var Pt=At,kt=ct,Lt=kt.tag;if(!(kt.mode&1)&&(Lt===0||Lt===11||Lt===15)){var Mt=kt.alternate;Mt?(kt.updateQueue=Mt.updateQueue,kt.memoizedState=Mt.memoizedState,kt.lanes=Mt.lanes):(kt.updateQueue=null,kt.memoizedState=null)}var Qt=Vi(yt);if(Qt!==null){Qt.flags&=-257,Wi(Qt,yt,ct,pt,et),Qt.mode&1&&Ti(pt,Pt,et),et=Qt,At=Pt;var Jt=et.updateQueue;if(Jt===null){var sn=new Set;sn.add(At),et.updateQueue=sn}else Jt.add(At);break e}else{if(!(et&1)){Ti(pt,Pt,et),uj();break e}At=Error(p$3(426))}}else if(I$1&&ct.mode&1){var tn=Vi(yt);if(tn!==null){!(tn.flags&65536)&&(tn.flags|=256),Wi(tn,yt,ct,pt,et),Jg(Ki(At,ct));break e}}pt=At=Ki(At,ct),T$1!==4&&(T$1=2),tk===null?tk=[pt]:tk.push(pt),pt=yt;do{switch(pt.tag){case 3:pt.flags|=65536,et&=-et,pt.lanes|=et;var Bt=Oi(pt,At,et);fh(pt,Bt);break e;case 1:ct=At;var zt=pt.type,Ht=pt.stateNode;if(!(pt.flags&128)&&(typeof zt.getDerivedStateFromError=="function"||Ht!==null&&typeof Ht.componentDidCatch=="function"&&(Si===null||!Si.has(Ht)))){pt.flags|=65536,et&=-et,pt.lanes|=et;var nn=Ri(pt,ct,et);fh(pt,nn);break e}}pt=pt.return}while(pt!==null)}Tk(rt)}catch(Ot){et=Ot,Y$1===rt&&rt!==null&&(Y$1=rt=rt.return);continue}break}while(!0)}function Kk(){var _e=nk.current;return nk.current=ai,_e===null?ai:_e}function uj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z$1)}function Jk(_e,et){var rt=K;K|=2;var at=Kk();(R!==_e||Z$1!==et)&&(vk=null,Lk(_e,et));do try{Uk();break}catch(ut){Nk(_e,ut)}while(!0);if(Qg(),K=rt,nk.current=at,Y$1!==null)throw Error(p$3(261));return R=null,Z$1=0,T$1}function Uk(){for(;Y$1!==null;)Vk(Y$1)}function Mk(){for(;Y$1!==null&&!cc();)Vk(Y$1)}function Vk(_e){var et=Wk(_e.alternate,_e,gj);_e.memoizedProps=_e.pendingProps,et===null?Tk(_e):Y$1=et,ok.current=null}function Tk(_e){var et=_e;do{var rt=et.alternate;if(_e=et.return,et.flags&32768){if(rt=Jj(rt,et),rt!==null){rt.flags&=32767,Y$1=rt;return}if(_e!==null)_e.flags|=32768,_e.subtreeFlags=0,_e.deletions=null;else{T$1=6,Y$1=null;return}}else if(rt=Fj(rt,et,gj),rt!==null){Y$1=rt;return}if(et=et.sibling,et!==null){Y$1=et;return}Y$1=et=_e}while(et!==null);T$1===0&&(T$1=5)}function Qk(_e,et,rt){var at=C,ut=pk.transition;try{pk.transition=null,C=1,Xk(_e,et,rt,at)}finally{pk.transition=ut,C=at}return null}function Xk(_e,et,rt,at){do Ik();while(xk!==null);if(K&6)throw Error(p$3(327));rt=_e.finishedWork;var ut=_e.finishedLanes;if(rt===null)return null;if(_e.finishedWork=null,_e.finishedLanes=0,rt===_e.current)throw Error(p$3(177));_e.callbackNode=null,_e.callbackPriority=0;var pt=rt.lanes|rt.childLanes;if(Bc(_e,pt),_e===R&&(Y$1=R=null,Z$1=0),!(rt.subtreeFlags&2064)&&!(rt.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),pt=(rt.flags&15990)!==0,rt.subtreeFlags&15990||pt){pt=pk.transition,pk.transition=null;var yt=C;C=1;var ct=K;K|=4,ok.current=null,Pj(_e,rt),ek(rt,_e),Oe(Df),dd=!!Cf,Df=Cf=null,_e.current=rt,ik(rt),dc(),K=ct,C=yt,pk.transition=pt}else _e.current=rt;if(wk&&(wk=!1,xk=_e,yk=ut),pt=_e.pendingLanes,pt===0&&(Si=null),mc(rt.stateNode),Ek(_e,B()),et!==null)for(at=_e.onRecoverableError,rt=0;rt<et.length;rt++)ut=et[rt],at(ut.value,{componentStack:ut.stack,digest:ut.digest});if(Pi)throw Pi=!1,_e=Qi,Qi=null,_e;return yk&1&&_e.tag!==0&&Ik(),pt=_e.pendingLanes,pt&1?_e===Ak?zk++:(zk=0,Ak=_e):zk=0,jg(),null}function Ik(){if(xk!==null){var _e=Dc(yk),et=pk.transition,rt=C;try{if(pk.transition=null,C=16>_e?16:_e,xk===null)var at=!1;else{if(_e=xk,xk=null,yk=0,K&6)throw Error(p$3(331));var ut=K;for(K|=4,V$1=_e.current;V$1!==null;){var pt=V$1,yt=pt.child;if(V$1.flags&16){var ct=pt.deletions;if(ct!==null){for(var At=0;At<ct.length;At++){var Pt=ct[At];for(V$1=Pt;V$1!==null;){var kt=V$1;switch(kt.tag){case 0:case 11:case 15:Qj(8,kt,pt)}var Lt=kt.child;if(Lt!==null)Lt.return=kt,V$1=Lt;else for(;V$1!==null;){kt=V$1;var Mt=kt.sibling,Qt=kt.return;if(Tj(kt),kt===Pt){V$1=null;break}if(Mt!==null){Mt.return=Qt,V$1=Mt;break}V$1=Qt}}}var Jt=pt.alternate;if(Jt!==null){var sn=Jt.child;if(sn!==null){Jt.child=null;do{var tn=sn.sibling;sn.sibling=null,sn=tn}while(sn!==null)}}V$1=pt}}if(pt.subtreeFlags&2064&&yt!==null)yt.return=pt,V$1=yt;else e:for(;V$1!==null;){if(pt=V$1,pt.flags&2048)switch(pt.tag){case 0:case 11:case 15:Qj(9,pt,pt.return)}var Bt=pt.sibling;if(Bt!==null){Bt.return=pt.return,V$1=Bt;break e}V$1=pt.return}}var zt=_e.current;for(V$1=zt;V$1!==null;){yt=V$1;var Ht=yt.child;if(yt.subtreeFlags&2064&&Ht!==null)Ht.return=yt,V$1=Ht;else e:for(yt=zt;V$1!==null;){if(ct=V$1,ct.flags&2048)try{switch(ct.tag){case 0:case 11:case 15:Rj(9,ct)}}catch(Ot){W$1(ct,ct.return,Ot)}if(ct===yt){V$1=null;break e}var nn=ct.sibling;if(nn!==null){nn.return=ct.return,V$1=nn;break e}V$1=ct.return}}if(K=ut,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,_e)}catch{}at=!0}return at}finally{C=rt,pk.transition=et}}return!1}function Yk(_e,et,rt){et=Ki(rt,et),et=Oi(_e,et,1),_e=dh(_e,et,1),et=L(),_e!==null&&(Ac(_e,1,et),Ek(_e,et))}function W$1(_e,et,rt){if(_e.tag===3)Yk(_e,_e,rt);else for(;et!==null;){if(et.tag===3){Yk(et,_e,rt);break}else if(et.tag===1){var at=et.stateNode;if(typeof et.type.getDerivedStateFromError=="function"||typeof at.componentDidCatch=="function"&&(Si===null||!Si.has(at))){_e=Ki(rt,_e),_e=Ri(et,_e,1),et=dh(et,_e,1),_e=L(),et!==null&&(Ac(et,1,_e),Ek(et,_e));break}}et=et.return}}function Ui(_e,et,rt){var at=_e.pingCache;at!==null&&at.delete(et),et=L(),_e.pingedLanes|=_e.suspendedLanes&rt,R===_e&&(Z$1&rt)===rt&&(T$1===4||T$1===3&&(Z$1&130023424)===Z$1&&500>B()-gk?Lk(_e,0):sk|=rt),Ek(_e,et)}function Zk(_e,et){et===0&&(_e.mode&1?(et=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):et=1);var rt=L();_e=Zg(_e,et),_e!==null&&(Ac(_e,et,rt),Ek(_e,rt))}function vj(_e){var et=_e.memoizedState,rt=0;et!==null&&(rt=et.retryLane),Zk(_e,rt)}function ck(_e,et){var rt=0;switch(_e.tag){case 13:var at=_e.stateNode,ut=_e.memoizedState;ut!==null&&(rt=ut.retryLane);break;case 19:at=_e.stateNode;break;default:throw Error(p$3(314))}at!==null&&at.delete(et),Zk(_e,rt)}var Wk;Wk=function(_e,et,rt){if(_e!==null)if(_e.memoizedProps!==et.pendingProps||Wf.current)Ug=!0;else{if(!(_e.lanes&rt)&&!(et.flags&128))return Ug=!1,zj(_e,et,rt);Ug=!!(_e.flags&131072)}else Ug=!1,I$1&&et.flags&1048576&&ug(et,ng,et.index);switch(et.lanes=0,et.tag){case 2:var at=et.type;jj(_e,et),_e=et.pendingProps;var ut=Yf(et,H.current);Tg(et,rt),ut=Xh(null,et,at,_e,ut,rt);var pt=bi();return et.flags|=1,typeof ut=="object"&&ut!==null&&typeof ut.render=="function"&&ut.$$typeof===void 0?(et.tag=1,et.memoizedState=null,et.updateQueue=null,Zf(at)?(pt=!0,cg(et)):pt=!1,et.memoizedState=ut.state!==null&&ut.state!==void 0?ut.state:null,ah(et),ut.updater=nh,et.stateNode=ut,ut._reactInternals=et,rh(et,at,_e,rt),et=kj(null,et,at,!0,pt,rt)):(et.tag=0,I$1&&pt&&vg(et),Yi(null,et,ut,rt),et=et.child),et;case 16:at=et.elementType;e:{switch(jj(_e,et),_e=et.pendingProps,ut=at._init,at=ut(at._payload),et.type=at,ut=et.tag=$k(at),_e=Lg(at,_e),ut){case 0:et=dj(null,et,at,_e,rt);break e;case 1:et=ij(null,et,at,_e,rt);break e;case 11:et=Zi(null,et,at,_e,rt);break e;case 14:et=aj(null,et,at,Lg(at.type,_e),rt);break e}throw Error(p$3(306,at,""))}return et;case 0:return at=et.type,ut=et.pendingProps,ut=et.elementType===at?ut:Lg(at,ut),dj(_e,et,at,ut,rt);case 1:return at=et.type,ut=et.pendingProps,ut=et.elementType===at?ut:Lg(at,ut),ij(_e,et,at,ut,rt);case 3:e:{if(lj(et),_e===null)throw Error(p$3(387));at=et.pendingProps,pt=et.memoizedState,ut=pt.element,bh(_e,et),gh(et,at,null,rt);var yt=et.memoizedState;if(at=yt.element,pt.isDehydrated)if(pt={element:at,isDehydrated:!1,cache:yt.cache,pendingSuspenseBoundaries:yt.pendingSuspenseBoundaries,transitions:yt.transitions},et.updateQueue.baseState=pt,et.memoizedState=pt,et.flags&256){ut=Ki(Error(p$3(423)),et),et=mj(_e,et,at,rt,ut);break e}else if(at!==ut){ut=Ki(Error(p$3(424)),et),et=mj(_e,et,at,rt,ut);break e}else for(yg=Lf(et.stateNode.containerInfo.firstChild),xg=et,I$1=!0,zg=null,rt=Ch(et,null,at,rt),et.child=rt;rt;)rt.flags=rt.flags&-3|4096,rt=rt.sibling;else{if(Ig(),at===ut){et=$i(_e,et,rt);break e}Yi(_e,et,at,rt)}et=et.child}return et;case 5:return Kh(et),_e===null&&Eg(et),at=et.type,ut=et.pendingProps,pt=_e!==null?_e.memoizedProps:null,yt=ut.children,Ef(at,ut)?yt=null:pt!==null&&Ef(at,pt)&&(et.flags|=32),hj(_e,et),Yi(_e,et,yt,rt),et.child;case 6:return _e===null&&Eg(et),null;case 13:return pj(_e,et,rt);case 4:return Ih(et,et.stateNode.containerInfo),at=et.pendingProps,_e===null?et.child=Bh(et,null,at,rt):Yi(_e,et,at,rt),et.child;case 11:return at=et.type,ut=et.pendingProps,ut=et.elementType===at?ut:Lg(at,ut),Zi(_e,et,at,ut,rt);case 7:return Yi(_e,et,et.pendingProps,rt),et.child;case 8:return Yi(_e,et,et.pendingProps.children,rt),et.child;case 12:return Yi(_e,et,et.pendingProps.children,rt),et.child;case 10:e:{if(at=et.type._context,ut=et.pendingProps,pt=et.memoizedProps,yt=ut.value,G$1(Mg,at._currentValue),at._currentValue=yt,pt!==null)if(He(pt.value,yt)){if(pt.children===ut.children&&!Wf.current){et=$i(_e,et,rt);break e}}else for(pt=et.child,pt!==null&&(pt.return=et);pt!==null;){var ct=pt.dependencies;if(ct!==null){yt=pt.child;for(var At=ct.firstContext;At!==null;){if(At.context===at){if(pt.tag===1){At=ch(-1,rt&-rt),At.tag=2;var Pt=pt.updateQueue;if(Pt!==null){Pt=Pt.shared;var kt=Pt.pending;kt===null?At.next=At:(At.next=kt.next,kt.next=At),Pt.pending=At}}pt.lanes|=rt,At=pt.alternate,At!==null&&(At.lanes|=rt),Sg(pt.return,rt,et),ct.lanes|=rt;break}At=At.next}}else if(pt.tag===10)yt=pt.type===et.type?null:pt.child;else if(pt.tag===18){if(yt=pt.return,yt===null)throw Error(p$3(341));yt.lanes|=rt,ct=yt.alternate,ct!==null&&(ct.lanes|=rt),Sg(yt,rt,et),yt=pt.sibling}else yt=pt.child;if(yt!==null)yt.return=pt;else for(yt=pt;yt!==null;){if(yt===et){yt=null;break}if(pt=yt.sibling,pt!==null){pt.return=yt.return,yt=pt;break}yt=yt.return}pt=yt}Yi(_e,et,ut.children,rt),et=et.child}return et;case 9:return ut=et.type,at=et.pendingProps.children,Tg(et,rt),ut=Vg(ut),at=at(ut),et.flags|=1,Yi(_e,et,at,rt),et.child;case 14:return at=et.type,ut=Lg(at,et.pendingProps),ut=Lg(at.type,ut),aj(_e,et,at,ut,rt);case 15:return cj(_e,et,et.type,et.pendingProps,rt);case 17:return at=et.type,ut=et.pendingProps,ut=et.elementType===at?ut:Lg(at,ut),jj(_e,et),et.tag=1,Zf(at)?(_e=!0,cg(et)):_e=!1,Tg(et,rt),ph(et,at,ut),rh(et,at,ut,rt),kj(null,et,at,!0,_e,rt);case 19:return yj(_e,et,rt);case 22:return ej(_e,et,rt)}throw Error(p$3(156,et.tag))};function Gk(_e,et){return ac(_e,et)}function al(_e,et,rt,at){this.tag=_e,this.key=rt,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=et,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=at,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(_e,et,rt,at){return new al(_e,et,rt,at)}function bj(_e){return _e=_e.prototype,!(!_e||!_e.isReactComponent)}function $k(_e){if(typeof _e=="function")return bj(_e)?1:0;if(_e!=null){if(_e=_e.$$typeof,_e===Da)return 11;if(_e===Ga)return 14}return 2}function wh(_e,et){var rt=_e.alternate;return rt===null?(rt=Bg(_e.tag,et,_e.key,_e.mode),rt.elementType=_e.elementType,rt.type=_e.type,rt.stateNode=_e.stateNode,rt.alternate=_e,_e.alternate=rt):(rt.pendingProps=et,rt.type=_e.type,rt.flags=0,rt.subtreeFlags=0,rt.deletions=null),rt.flags=_e.flags&14680064,rt.childLanes=_e.childLanes,rt.lanes=_e.lanes,rt.child=_e.child,rt.memoizedProps=_e.memoizedProps,rt.memoizedState=_e.memoizedState,rt.updateQueue=_e.updateQueue,et=_e.dependencies,rt.dependencies=et===null?null:{lanes:et.lanes,firstContext:et.firstContext},rt.sibling=_e.sibling,rt.index=_e.index,rt.ref=_e.ref,rt}function yh(_e,et,rt,at,ut,pt){var yt=2;if(at=_e,typeof _e=="function")bj(_e)&&(yt=1);else if(typeof _e=="string")yt=5;else e:switch(_e){case ya:return Ah(rt.children,ut,pt,et);case za:yt=8,ut|=8;break;case Aa:return _e=Bg(12,rt,et,ut|2),_e.elementType=Aa,_e.lanes=pt,_e;case Ea:return _e=Bg(13,rt,et,ut),_e.elementType=Ea,_e.lanes=pt,_e;case Fa:return _e=Bg(19,rt,et,ut),_e.elementType=Fa,_e.lanes=pt,_e;case Ia:return qj(rt,ut,pt,et);default:if(typeof _e=="object"&&_e!==null)switch(_e.$$typeof){case Ba:yt=10;break e;case Ca:yt=9;break e;case Da:yt=11;break e;case Ga:yt=14;break e;case Ha:yt=16,at=null;break e}throw Error(p$3(130,_e==null?_e:typeof _e,""))}return et=Bg(yt,rt,et,ut),et.elementType=_e,et.type=at,et.lanes=pt,et}function Ah(_e,et,rt,at){return _e=Bg(7,_e,at,et),_e.lanes=rt,_e}function qj(_e,et,rt,at){return _e=Bg(22,_e,at,et),_e.elementType=Ia,_e.lanes=rt,_e.stateNode={isHidden:!1},_e}function xh(_e,et,rt){return _e=Bg(6,_e,null,et),_e.lanes=rt,_e}function zh(_e,et,rt){return et=Bg(4,_e.children!==null?_e.children:[],_e.key,et),et.lanes=rt,et.stateNode={containerInfo:_e.containerInfo,pendingChildren:null,implementation:_e.implementation},et}function bl(_e,et,rt,at,ut){this.tag=et,this.containerInfo=_e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=at,this.onRecoverableError=ut,this.mutableSourceEagerHydrationData=null}function cl(_e,et,rt,at,ut,pt,yt,ct,At){return _e=new bl(_e,et,rt,ct,At),et===1?(et=1,pt===!0&&(et|=8)):et=0,pt=Bg(3,null,null,et),_e.current=pt,pt.stateNode=_e,pt.memoizedState={element:at,isDehydrated:rt,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(pt),_e}function dl(_e,et,rt){var at=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:at==null?null:""+at,children:_e,containerInfo:et,implementation:rt}}function el(_e){if(!_e)return Vf;_e=_e._reactInternals;e:{if(Vb(_e)!==_e||_e.tag!==1)throw Error(p$3(170));var et=_e;do{switch(et.tag){case 3:et=et.stateNode.context;break e;case 1:if(Zf(et.type)){et=et.stateNode.__reactInternalMemoizedMergedChildContext;break e}}et=et.return}while(et!==null);throw Error(p$3(171))}if(_e.tag===1){var rt=_e.type;if(Zf(rt))return bg(_e,rt,et)}return et}function fl(_e,et,rt,at,ut,pt,yt,ct,At){return _e=cl(rt,at,!0,_e,ut,pt,yt,ct,At),_e.context=el(null),rt=_e.current,at=L(),ut=lh(rt),pt=ch(at,ut),pt.callback=et??null,dh(rt,pt,ut),_e.current.lanes=ut,Ac(_e,ut,at),Ek(_e,at),_e}function gl(_e,et,rt,at){var ut=et.current,pt=L(),yt=lh(ut);return rt=el(rt),et.context===null?et.context=rt:et.pendingContext=rt,et=ch(pt,yt),et.payload={element:_e},at=at===void 0?null:at,at!==null&&(et.callback=at),_e=dh(ut,et,yt),_e!==null&&(mh(_e,ut,yt,pt),eh(_e,ut,yt)),yt}function hl(_e){if(_e=_e.current,!_e.child)return null;switch(_e.child.tag){case 5:return _e.child.stateNode;default:return _e.child.stateNode}}function il(_e,et){if(_e=_e.memoizedState,_e!==null&&_e.dehydrated!==null){var rt=_e.retryLane;_e.retryLane=rt!==0&&rt<et?rt:et}}function jl(_e,et){il(_e,et),(_e=_e.alternate)&&il(_e,et)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(_e){console.error(_e)};function ml(_e){this._internalRoot=_e}nl.prototype.render=ml.prototype.render=function(_e){var et=this._internalRoot;if(et===null)throw Error(p$3(409));gl(_e,et,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var _e=this._internalRoot;if(_e!==null){this._internalRoot=null;var et=_e.containerInfo;Sk(function(){gl(null,_e,null,null)}),et[uf]=null}};function nl(_e){this._internalRoot=_e}nl.prototype.unstable_scheduleHydration=function(_e){if(_e){var et=Hc();_e={blockedOn:null,target:_e,priority:et};for(var rt=0;rt<Qc.length&&et!==0&&et<Qc[rt].priority;rt++);Qc.splice(rt,0,_e),rt===0&&Vc(_e)}};function ol(_e){return!(!_e||_e.nodeType!==1&&_e.nodeType!==9&&_e.nodeType!==11)}function pl(_e){return!(!_e||_e.nodeType!==1&&_e.nodeType!==9&&_e.nodeType!==11&&(_e.nodeType!==8||_e.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(_e,et,rt,at,ut){if(ut){if(typeof at=="function"){var pt=at;at=function(){var Pt=hl(yt);pt.call(Pt)}}var yt=fl(et,at,_e,0,null,!1,!1,"",ql);return _e._reactRootContainer=yt,_e[uf]=yt.current,sf(_e.nodeType===8?_e.parentNode:_e),Sk(),yt}for(;ut=_e.lastChild;)_e.removeChild(ut);if(typeof at=="function"){var ct=at;at=function(){var Pt=hl(At);ct.call(Pt)}}var At=cl(_e,0,!1,null,null,!1,!1,"",ql);return _e._reactRootContainer=At,_e[uf]=At.current,sf(_e.nodeType===8?_e.parentNode:_e),Sk(function(){gl(et,At,rt,at)}),At}function sl(_e,et,rt,at,ut){var pt=rt._reactRootContainer;if(pt){var yt=pt;if(typeof ut=="function"){var ct=ut;ut=function(){var At=hl(yt);ct.call(At)}}gl(et,yt,_e,ut)}else yt=rl(rt,et,_e,ut,at);return hl(yt)}Ec=function(_e){switch(_e.tag){case 3:var et=_e.stateNode;if(et.current.memoizedState.isDehydrated){var rt=tc(et.pendingLanes);rt!==0&&(Cc(et,rt|1),Ek(et,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var at=Zg(_e,1);if(at!==null){var ut=L();mh(at,_e,1,ut)}}),jl(_e,1)}};Fc=function(_e){if(_e.tag===13){var et=Zg(_e,134217728);if(et!==null){var rt=L();mh(et,_e,134217728,rt)}jl(_e,134217728)}};Gc=function(_e){if(_e.tag===13){var et=lh(_e),rt=Zg(_e,et);if(rt!==null){var at=L();mh(rt,_e,et,at)}jl(_e,et)}};Hc=function(){return C};Ic=function(_e,et){var rt=C;try{return C=_e,et()}finally{C=rt}};yb=function(_e,et,rt){switch(et){case"input":if(bb(_e,rt),et=rt.name,rt.type==="radio"&&et!=null){for(rt=_e;rt.parentNode;)rt=rt.parentNode;for(rt=rt.querySelectorAll("input[name="+JSON.stringify(""+et)+'][type="radio"]'),et=0;et<rt.length;et++){var at=rt[et];if(at!==_e&&at.form===_e.form){var ut=Db(at);if(!ut)throw Error(p$3(90));Wa(at),bb(at,ut)}}}break;case"textarea":ib(_e,rt);break;case"select":et=rt.value,et!=null&&fb(_e,!!rt.multiple,et,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(_e){return _e=Zb(_e),_e===null?null:_e.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function(_e,et){var rt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(et))throw Error(p$3(200));return dl(_e,et,null,rt)};reactDom_production_min.createRoot=function(_e,et){if(!ol(_e))throw Error(p$3(299));var rt=!1,at="",ut=ll;return et!=null&&(et.unstable_strictMode===!0&&(rt=!0),et.identifierPrefix!==void 0&&(at=et.identifierPrefix),et.onRecoverableError!==void 0&&(ut=et.onRecoverableError)),et=cl(_e,1,!1,null,null,rt,!1,at,ut),_e[uf]=et.current,sf(_e.nodeType===8?_e.parentNode:_e),new ml(et)};reactDom_production_min.findDOMNode=function(_e){if(_e==null)return null;if(_e.nodeType===1)return _e;var et=_e._reactInternals;if(et===void 0)throw typeof _e.render=="function"?Error(p$3(188)):(_e=Object.keys(_e).join(","),Error(p$3(268,_e)));return _e=Zb(et),_e=_e===null?null:_e.stateNode,_e};reactDom_production_min.flushSync=function(_e){return Sk(_e)};reactDom_production_min.hydrate=function(_e,et,rt){if(!pl(et))throw Error(p$3(200));return sl(null,_e,et,!0,rt)};reactDom_production_min.hydrateRoot=function(_e,et,rt){if(!ol(_e))throw Error(p$3(405));var at=rt!=null&&rt.hydratedSources||null,ut=!1,pt="",yt=ll;if(rt!=null&&(rt.unstable_strictMode===!0&&(ut=!0),rt.identifierPrefix!==void 0&&(pt=rt.identifierPrefix),rt.onRecoverableError!==void 0&&(yt=rt.onRecoverableError)),et=fl(et,null,_e,1,rt??null,ut,!1,pt,yt),_e[uf]=et.current,sf(_e),at)for(_e=0;_e<at.length;_e++)rt=at[_e],ut=rt._getVersion,ut=ut(rt._source),et.mutableSourceEagerHydrationData==null?et.mutableSourceEagerHydrationData=[rt,ut]:et.mutableSourceEagerHydrationData.push(rt,ut);return new nl(et)};reactDom_production_min.render=function(_e,et,rt){if(!pl(et))throw Error(p$3(200));return sl(null,_e,et,!1,rt)};reactDom_production_min.unmountComponentAtNode=function(_e){if(!pl(_e))throw Error(p$3(40));return _e._reactRootContainer?(Sk(function(){sl(null,null,_e,!1,function(){_e._reactRootContainer=null,_e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(_e,et,rt,at){if(!pl(rt))throw Error(p$3(200));if(_e==null||_e._reactInternals===void 0)throw Error(p$3(38));return sl(_e,et,rt,!1,at)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(_e){console.error(_e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m$2=reactDomExports;client.createRoot=m$2.createRoot,client.hydrateRoot=m$2.hydrateRoot;/**
 * @remix-run/router v1.14.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$3(){return _extends$3=Object.assign?Object.assign.bind():function(_e){for(var et=1;et<arguments.length;et++){var rt=arguments[et];for(var at in rt)Object.prototype.hasOwnProperty.call(rt,at)&&(_e[at]=rt[at])}return _e},_extends$3.apply(this,arguments)}var Action;(function(_e){_e.Pop="POP",_e.Push="PUSH",_e.Replace="REPLACE"})(Action||(Action={}));const PopStateEventType="popstate";function createBrowserHistory(_e){_e===void 0&&(_e={});function et(at,ut){let{pathname:pt,search:yt,hash:ct}=at.location;return createLocation("",{pathname:pt,search:yt,hash:ct},ut.state&&ut.state.usr||null,ut.state&&ut.state.key||"default")}function rt(at,ut){return typeof ut=="string"?ut:createPath(ut)}return getUrlBasedHistory(et,rt,null,_e)}function invariant(_e,et){if(_e===!1||_e===null||typeof _e>"u")throw new Error(et)}function warning(_e,et){if(!_e){typeof console<"u"&&console.warn(et);try{throw new Error(et)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(_e,et){return{usr:_e.state,key:_e.key,idx:et}}function createLocation(_e,et,rt,at){return rt===void 0&&(rt=null),_extends$3({pathname:typeof _e=="string"?_e:_e.pathname,search:"",hash:""},typeof et=="string"?parsePath(et):et,{state:rt,key:et&&et.key||at||createKey()})}function createPath(_e){let{pathname:et="/",search:rt="",hash:at=""}=_e;return rt&&rt!=="?"&&(et+=rt.charAt(0)==="?"?rt:"?"+rt),at&&at!=="#"&&(et+=at.charAt(0)==="#"?at:"#"+at),et}function parsePath(_e){let et={};if(_e){let rt=_e.indexOf("#");rt>=0&&(et.hash=_e.substr(rt),_e=_e.substr(0,rt));let at=_e.indexOf("?");at>=0&&(et.search=_e.substr(at),_e=_e.substr(0,at)),_e&&(et.pathname=_e)}return et}function getUrlBasedHistory(_e,et,rt,at){at===void 0&&(at={});let{window:ut=document.defaultView,v5Compat:pt=!1}=at,yt=ut.history,ct=Action.Pop,At=null,Pt=kt();Pt==null&&(Pt=0,yt.replaceState(_extends$3({},yt.state,{idx:Pt}),""));function kt(){return(yt.state||{idx:null}).idx}function Lt(){ct=Action.Pop;let tn=kt(),Bt=tn==null?null:tn-Pt;Pt=tn,At&&At({action:ct,location:sn.location,delta:Bt})}function Mt(tn,Bt){ct=Action.Push;let zt=createLocation(sn.location,tn,Bt);rt&&rt(zt,tn),Pt=kt()+1;let Ht=getHistoryState(zt,Pt),nn=sn.createHref(zt);try{yt.pushState(Ht,"",nn)}catch(Ot){if(Ot instanceof DOMException&&Ot.name==="DataCloneError")throw Ot;ut.location.assign(nn)}pt&&At&&At({action:ct,location:sn.location,delta:1})}function Qt(tn,Bt){ct=Action.Replace;let zt=createLocation(sn.location,tn,Bt);rt&&rt(zt,tn),Pt=kt();let Ht=getHistoryState(zt,Pt),nn=sn.createHref(zt);yt.replaceState(Ht,"",nn),pt&&At&&At({action:ct,location:sn.location,delta:0})}function Jt(tn){let Bt=ut.location.origin!=="null"?ut.location.origin:ut.location.href,zt=typeof tn=="string"?tn:createPath(tn);return invariant(Bt,"No window.location.(origin|href) available to create URL for href: "+zt),new URL(zt,Bt)}let sn={get action(){return ct},get location(){return _e(ut,yt)},listen(tn){if(At)throw new Error("A history only accepts one active listener");return ut.addEventListener(PopStateEventType,Lt),At=tn,()=>{ut.removeEventListener(PopStateEventType,Lt),At=null}},createHref(tn){return et(ut,tn)},createURL:Jt,encodeLocation(tn){let Bt=Jt(tn);return{pathname:Bt.pathname,search:Bt.search,hash:Bt.hash}},push:Mt,replace:Qt,go(tn){return yt.go(tn)}};return sn}var ResultType;(function(_e){_e.data="data",_e.deferred="deferred",_e.redirect="redirect",_e.error="error"})(ResultType||(ResultType={}));function matchRoutes(_e,et,rt){rt===void 0&&(rt="/");let at=typeof et=="string"?parsePath(et):et,ut=stripBasename(at.pathname||"/",rt);if(ut==null)return null;let pt=flattenRoutes(_e);rankRouteBranches(pt);let yt=null;for(let ct=0;yt==null&&ct<pt.length;++ct)yt=matchRouteBranch(pt[ct],safelyDecodeURI(ut));return yt}function flattenRoutes(_e,et,rt,at){et===void 0&&(et=[]),rt===void 0&&(rt=[]),at===void 0&&(at="");let ut=(pt,yt,ct)=>{let At={relativePath:ct===void 0?pt.path||"":ct,caseSensitive:pt.caseSensitive===!0,childrenIndex:yt,route:pt};At.relativePath.startsWith("/")&&(invariant(At.relativePath.startsWith(at),'Absolute route path "'+At.relativePath+'" nested under path '+('"'+at+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),At.relativePath=At.relativePath.slice(at.length));let Pt=joinPaths([at,At.relativePath]),kt=rt.concat(At);pt.children&&pt.children.length>0&&(invariant(pt.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+Pt+'".')),flattenRoutes(pt.children,et,kt,Pt)),!(pt.path==null&&!pt.index)&&et.push({path:Pt,score:computeScore(Pt,pt.index),routesMeta:kt})};return _e.forEach((pt,yt)=>{var ct;if(pt.path===""||!((ct=pt.path)!=null&&ct.includes("?")))ut(pt,yt);else for(let At of explodeOptionalSegments(pt.path))ut(pt,yt,At)}),et}function explodeOptionalSegments(_e){let et=_e.split("/");if(et.length===0)return[];let[rt,...at]=et,ut=rt.endsWith("?"),pt=rt.replace(/\?$/,"");if(at.length===0)return ut?[pt,""]:[pt];let yt=explodeOptionalSegments(at.join("/")),ct=[];return ct.push(...yt.map(At=>At===""?pt:[pt,At].join("/"))),ut&&ct.push(...yt),ct.map(At=>_e.startsWith("/")&&At===""?"/":At)}function rankRouteBranches(_e){_e.sort((et,rt)=>et.score!==rt.score?rt.score-et.score:compareIndexes(et.routesMeta.map(at=>at.childrenIndex),rt.routesMeta.map(at=>at.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=_e=>_e==="*";function computeScore(_e,et){let rt=_e.split("/"),at=rt.length;return rt.some(isSplat)&&(at+=splatPenalty),et&&(at+=indexRouteValue),rt.filter(ut=>!isSplat(ut)).reduce((ut,pt)=>ut+(paramRe.test(pt)?dynamicSegmentValue:pt===""?emptySegmentValue:staticSegmentValue),at)}function compareIndexes(_e,et){return _e.length===et.length&&_e.slice(0,-1).every((at,ut)=>at===et[ut])?_e[_e.length-1]-et[et.length-1]:0}function matchRouteBranch(_e,et){let{routesMeta:rt}=_e,at={},ut="/",pt=[];for(let yt=0;yt<rt.length;++yt){let ct=rt[yt],At=yt===rt.length-1,Pt=ut==="/"?et:et.slice(ut.length)||"/",kt=matchPath({path:ct.relativePath,caseSensitive:ct.caseSensitive,end:At},Pt);if(!kt)return null;Object.assign(at,kt.params);let Lt=ct.route;pt.push({params:at,pathname:joinPaths([ut,kt.pathname]),pathnameBase:normalizePathname(joinPaths([ut,kt.pathnameBase])),route:Lt}),kt.pathnameBase!=="/"&&(ut=joinPaths([ut,kt.pathnameBase]))}return pt}function matchPath(_e,et){typeof _e=="string"&&(_e={path:_e,caseSensitive:!1,end:!0});let[rt,at]=compilePath(_e.path,_e.caseSensitive,_e.end),ut=et.match(rt);if(!ut)return null;let pt=ut[0],yt=pt.replace(/(.)\/+$/,"$1"),ct=ut.slice(1);return{params:at.reduce((Pt,kt,Lt)=>{let{paramName:Mt,isOptional:Qt}=kt;if(Mt==="*"){let sn=ct[Lt]||"";yt=pt.slice(0,pt.length-sn.length).replace(/(.)\/+$/,"$1")}const Jt=ct[Lt];return Qt&&!Jt?Pt[Mt]=void 0:Pt[Mt]=safelyDecodeURIComponent(Jt||"",Mt),Pt},{}),pathname:pt,pathnameBase:yt,pattern:_e}}function compilePath(_e,et,rt){et===void 0&&(et=!1),rt===void 0&&(rt=!0),warning(_e==="*"||!_e.endsWith("*")||_e.endsWith("/*"),'Route path "'+_e+'" will be treated as if it were '+('"'+_e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+_e.replace(/\*$/,"/*")+'".'));let at=[],ut="^"+_e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(yt,ct,At)=>(at.push({paramName:ct,isOptional:At!=null}),At?"/?([^\\/]+)?":"/([^\\/]+)"));return _e.endsWith("*")?(at.push({paramName:"*"}),ut+=_e==="*"||_e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):rt?ut+="\\/*$":_e!==""&&_e!=="/"&&(ut+="(?:(?=\\/|$))"),[new RegExp(ut,et?void 0:"i"),at]}function safelyDecodeURI(_e){try{return decodeURI(_e)}catch(et){return warning(!1,'The URL path "'+_e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+et+").")),_e}}function safelyDecodeURIComponent(_e,et){try{return decodeURIComponent(_e)}catch(rt){return warning(!1,'The value for the URL param "'+et+'" will not be decoded because'+(' the string "'+_e+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+rt+").")),_e}}function stripBasename(_e,et){if(et==="/")return _e;if(!_e.toLowerCase().startsWith(et.toLowerCase()))return null;let rt=et.endsWith("/")?et.length-1:et.length,at=_e.charAt(rt);return at&&at!=="/"?null:_e.slice(rt)||"/"}function resolvePath(_e,et){et===void 0&&(et="/");let{pathname:rt,search:at="",hash:ut=""}=typeof _e=="string"?parsePath(_e):_e;return{pathname:rt?rt.startsWith("/")?rt:resolvePathname(rt,et):et,search:normalizeSearch(at),hash:normalizeHash(ut)}}function resolvePathname(_e,et){let rt=et.replace(/\/+$/,"").split("/");return _e.split("/").forEach(ut=>{ut===".."?rt.length>1&&rt.pop():ut!=="."&&rt.push(ut)}),rt.length>1?rt.join("/"):"/"}function getInvalidPathError(_e,et,rt,at){return"Cannot include a '"+_e+"' character in a manually specified "+("`to."+et+"` field ["+JSON.stringify(at)+"].  Please separate it out to the ")+("`to."+rt+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(_e){return _e.filter((et,rt)=>rt===0||et.route.path&&et.route.path.length>0)}function getResolveToMatches(_e,et){let rt=getPathContributingMatches(_e);return et?rt.map((at,ut)=>ut===_e.length-1?at.pathname:at.pathnameBase):rt.map(at=>at.pathnameBase)}function resolveTo(_e,et,rt,at){at===void 0&&(at=!1);let ut;typeof _e=="string"?ut=parsePath(_e):(ut=_extends$3({},_e),invariant(!ut.pathname||!ut.pathname.includes("?"),getInvalidPathError("?","pathname","search",ut)),invariant(!ut.pathname||!ut.pathname.includes("#"),getInvalidPathError("#","pathname","hash",ut)),invariant(!ut.search||!ut.search.includes("#"),getInvalidPathError("#","search","hash",ut)));let pt=_e===""||ut.pathname==="",yt=pt?"/":ut.pathname,ct;if(yt==null)ct=rt;else{let Lt=et.length-1;if(!at&&yt.startsWith("..")){let Mt=yt.split("/");for(;Mt[0]==="..";)Mt.shift(),Lt-=1;ut.pathname=Mt.join("/")}ct=Lt>=0?et[Lt]:"/"}let At=resolvePath(ut,ct),Pt=yt&&yt!=="/"&&yt.endsWith("/"),kt=(pt||yt===".")&&rt.endsWith("/");return!At.pathname.endsWith("/")&&(Pt||kt)&&(At.pathname+="/"),At}const joinPaths=_e=>_e.join("/").replace(/\/\/+/g,"/"),normalizePathname=_e=>_e.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=_e=>!_e||_e==="?"?"":_e.startsWith("?")?_e:"?"+_e,normalizeHash=_e=>!_e||_e==="#"?"":_e.startsWith("#")?_e:"#"+_e;function isRouteErrorResponse(_e){return _e!=null&&typeof _e.status=="number"&&typeof _e.statusText=="string"&&typeof _e.internal=="boolean"&&"data"in _e}const validMutationMethodsArr=["post","put","patch","delete"];new Set(validMutationMethodsArr);const validRequestMethodsArr=["get",...validMutationMethodsArr];new Set(validRequestMethodsArr);/**
 * React Router v6.21.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(_e){for(var et=1;et<arguments.length;et++){var rt=arguments[et];for(var at in rt)Object.prototype.hasOwnProperty.call(rt,at)&&(_e[at]=rt[at])}return _e},_extends$2.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useHref(_e,et){let{relative:rt}=et===void 0?{}:et;useInRouterContext()||invariant(!1);let{basename:at,navigator:ut}=reactExports.useContext(NavigationContext),{hash:pt,pathname:yt,search:ct}=useResolvedPath(_e,{relative:rt}),At=yt;return at!=="/"&&(At=yt==="/"?at:joinPaths([at,yt])),ut.createHref({pathname:At,search:ct,hash:pt})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return useInRouterContext()||invariant(!1),reactExports.useContext(LocationContext).location}function useIsomorphicLayoutEffect(_e){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(_e)}function useNavigate(){let{isDataRoute:_e}=reactExports.useContext(RouteContext);return _e?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant(!1);let _e=reactExports.useContext(DataRouterContext),{basename:et,future:rt,navigator:at}=reactExports.useContext(NavigationContext),{matches:ut}=reactExports.useContext(RouteContext),{pathname:pt}=useLocation(),yt=JSON.stringify(getResolveToMatches(ut,rt.v7_relativeSplatPath)),ct=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>{ct.current=!0}),reactExports.useCallback(function(Pt,kt){if(kt===void 0&&(kt={}),!ct.current)return;if(typeof Pt=="number"){at.go(Pt);return}let Lt=resolveTo(Pt,JSON.parse(yt),pt,kt.relative==="path");_e==null&&et!=="/"&&(Lt.pathname=Lt.pathname==="/"?et:joinPaths([et,Lt.pathname])),(kt.replace?at.replace:at.push)(Lt,kt.state,kt)},[et,at,yt,pt,_e])}function useResolvedPath(_e,et){let{relative:rt}=et===void 0?{}:et,{future:at}=reactExports.useContext(NavigationContext),{matches:ut}=reactExports.useContext(RouteContext),{pathname:pt}=useLocation(),yt=JSON.stringify(getResolveToMatches(ut,at.v7_relativeSplatPath));return reactExports.useMemo(()=>resolveTo(_e,JSON.parse(yt),pt,rt==="path"),[_e,yt,pt,rt])}function useRoutes(_e,et){return useRoutesImpl(_e,et)}function useRoutesImpl(_e,et,rt,at){useInRouterContext()||invariant(!1);let{navigator:ut}=reactExports.useContext(NavigationContext),{matches:pt}=reactExports.useContext(RouteContext),yt=pt[pt.length-1],ct=yt?yt.params:{};yt&&yt.pathname;let At=yt?yt.pathnameBase:"/";yt&&yt.route;let Pt=useLocation(),kt;if(et){var Lt;let tn=typeof et=="string"?parsePath(et):et;At==="/"||(Lt=tn.pathname)!=null&&Lt.startsWith(At)||invariant(!1),kt=tn}else kt=Pt;let Mt=kt.pathname||"/",Qt=At==="/"?Mt:Mt.slice(At.length)||"/",Jt=matchRoutes(_e,{pathname:Qt}),sn=_renderMatches(Jt&&Jt.map(tn=>Object.assign({},tn,{params:Object.assign({},ct,tn.params),pathname:joinPaths([At,ut.encodeLocation?ut.encodeLocation(tn.pathname).pathname:tn.pathname]),pathnameBase:tn.pathnameBase==="/"?At:joinPaths([At,ut.encodeLocation?ut.encodeLocation(tn.pathnameBase).pathname:tn.pathnameBase])})),pt,rt,at);return et&&sn?reactExports.createElement(LocationContext.Provider,{value:{location:_extends$2({pathname:"/",search:"",hash:"",state:null,key:"default"},kt),navigationType:Action.Pop}},sn):sn}function DefaultErrorComponent(){let _e=useRouteError(),et=isRouteErrorResponse(_e)?_e.status+" "+_e.statusText:_e instanceof Error?_e.message:JSON.stringify(_e),rt=_e instanceof Error?_e.stack:null,ut={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},et),rt?reactExports.createElement("pre",{style:ut},rt):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(et){super(et),this.state={location:et.location,revalidation:et.revalidation,error:et.error}}static getDerivedStateFromError(et){return{error:et}}static getDerivedStateFromProps(et,rt){return rt.location!==et.location||rt.revalidation!=="idle"&&et.revalidation==="idle"?{error:et.error,location:et.location,revalidation:et.revalidation}:{error:et.error!==void 0?et.error:rt.error,location:rt.location,revalidation:et.revalidation||rt.revalidation}}componentDidCatch(et,rt){console.error("React Router caught the following error during render",et,rt)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(_e){let{routeContext:et,match:rt,children:at}=_e,ut=reactExports.useContext(DataRouterContext);return ut&&ut.static&&ut.staticContext&&(rt.route.errorElement||rt.route.ErrorBoundary)&&(ut.staticContext._deepestRenderedBoundaryId=rt.route.id),reactExports.createElement(RouteContext.Provider,{value:et},at)}function _renderMatches(_e,et,rt,at){var ut;if(et===void 0&&(et=[]),rt===void 0&&(rt=null),at===void 0&&(at=null),_e==null){var pt;if((pt=rt)!=null&&pt.errors)_e=rt.matches;else return null}let yt=_e,ct=(ut=rt)==null?void 0:ut.errors;if(ct!=null){let kt=yt.findIndex(Lt=>Lt.route.id&&(ct==null?void 0:ct[Lt.route.id]));kt>=0||invariant(!1),yt=yt.slice(0,Math.min(yt.length,kt+1))}let At=!1,Pt=-1;if(rt&&at&&at.v7_partialHydration)for(let kt=0;kt<yt.length;kt++){let Lt=yt[kt];if((Lt.route.HydrateFallback||Lt.route.hydrateFallbackElement)&&(Pt=kt),Lt.route.id){let{loaderData:Mt,errors:Qt}=rt,Jt=Lt.route.loader&&Mt[Lt.route.id]===void 0&&(!Qt||Qt[Lt.route.id]===void 0);if(Lt.route.lazy||Jt){At=!0,Pt>=0?yt=yt.slice(0,Pt+1):yt=[yt[0]];break}}}return yt.reduceRight((kt,Lt,Mt)=>{let Qt,Jt=!1,sn=null,tn=null;rt&&(Qt=ct&&Lt.route.id?ct[Lt.route.id]:void 0,sn=Lt.route.errorElement||defaultErrorElement,At&&(Pt<0&&Mt===0?(warningOnce("route-fallback",!1),Jt=!0,tn=null):Pt===Mt&&(Jt=!0,tn=Lt.route.hydrateFallbackElement||null)));let Bt=et.concat(yt.slice(0,Mt+1)),zt=()=>{let Ht;return Qt?Ht=sn:Jt?Ht=tn:Lt.route.Component?Ht=reactExports.createElement(Lt.route.Component,null):Lt.route.element?Ht=Lt.route.element:Ht=kt,reactExports.createElement(RenderedRoute,{match:Lt,routeContext:{outlet:kt,matches:Bt,isDataRoute:rt!=null},children:Ht})};return rt&&(Lt.route.ErrorBoundary||Lt.route.errorElement||Mt===0)?reactExports.createElement(RenderErrorBoundary,{location:rt.location,revalidation:rt.revalidation,component:sn,error:Qt,children:zt(),routeContext:{outlet:null,matches:Bt,isDataRoute:!0}}):zt()},null)}var DataRouterHook$1=function(_e){return _e.UseBlocker="useBlocker",_e.UseRevalidator="useRevalidator",_e.UseNavigateStable="useNavigate",_e}(DataRouterHook$1||{}),DataRouterStateHook$1=function(_e){return _e.UseBlocker="useBlocker",_e.UseLoaderData="useLoaderData",_e.UseActionData="useActionData",_e.UseRouteError="useRouteError",_e.UseNavigation="useNavigation",_e.UseRouteLoaderData="useRouteLoaderData",_e.UseMatches="useMatches",_e.UseRevalidator="useRevalidator",_e.UseNavigateStable="useNavigate",_e.UseRouteId="useRouteId",_e}(DataRouterStateHook$1||{});function useDataRouterContext(_e){let et=reactExports.useContext(DataRouterContext);return et||invariant(!1),et}function useDataRouterState(_e){let et=reactExports.useContext(DataRouterStateContext);return et||invariant(!1),et}function useRouteContext(_e){let et=reactExports.useContext(RouteContext);return et||invariant(!1),et}function useCurrentRouteId(_e){let et=useRouteContext(),rt=et.matches[et.matches.length-1];return rt.route.id||invariant(!1),rt.route.id}function useRouteError(){var _e;let et=reactExports.useContext(RouteErrorContext),rt=useDataRouterState(DataRouterStateHook$1.UseRouteError),at=useCurrentRouteId(DataRouterStateHook$1.UseRouteError);return et!==void 0?et:(_e=rt.errors)==null?void 0:_e[at]}function useNavigateStable(){let{router:_e}=useDataRouterContext(DataRouterHook$1.UseNavigateStable),et=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),rt=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>{rt.current=!0}),reactExports.useCallback(function(ut,pt){pt===void 0&&(pt={}),rt.current&&(typeof ut=="number"?_e.navigate(ut):_e.navigate(ut,_extends$2({fromRouteId:et},pt)))},[_e,et])}const alreadyWarned={};function warningOnce(_e,et,rt){!et&&!alreadyWarned[_e]&&(alreadyWarned[_e]=!0)}function Navigate(_e){let{to:et,replace:rt,state:at,relative:ut}=_e;useInRouterContext()||invariant(!1);let{future:pt,static:yt}=reactExports.useContext(NavigationContext),{matches:ct}=reactExports.useContext(RouteContext),{pathname:At}=useLocation(),Pt=useNavigate(),kt=resolveTo(et,getResolveToMatches(ct,pt.v7_relativeSplatPath),At,ut==="path"),Lt=JSON.stringify(kt);return reactExports.useEffect(()=>Pt(JSON.parse(Lt),{replace:rt,state:at,relative:ut}),[Pt,Lt,ut,rt,at]),null}function Route(_e){invariant(!1)}function Router(_e){let{basename:et="/",children:rt=null,location:at,navigationType:ut=Action.Pop,navigator:pt,static:yt=!1,future:ct}=_e;useInRouterContext()&&invariant(!1);let At=et.replace(/^\/*/,"/"),Pt=reactExports.useMemo(()=>({basename:At,navigator:pt,static:yt,future:_extends$2({v7_relativeSplatPath:!1},ct)}),[At,ct,pt,yt]);typeof at=="string"&&(at=parsePath(at));let{pathname:kt="/",search:Lt="",hash:Mt="",state:Qt=null,key:Jt="default"}=at,sn=reactExports.useMemo(()=>{let tn=stripBasename(kt,At);return tn==null?null:{location:{pathname:tn,search:Lt,hash:Mt,state:Qt,key:Jt},navigationType:ut}},[At,kt,Lt,Mt,Qt,Jt,ut]);return sn==null?null:reactExports.createElement(NavigationContext.Provider,{value:Pt},reactExports.createElement(LocationContext.Provider,{children:rt,value:sn}))}function Routes(_e){let{children:et,location:rt}=_e;return useRoutes(createRoutesFromChildren(et),rt)}new Promise(()=>{});function createRoutesFromChildren(_e,et){et===void 0&&(et=[]);let rt=[];return reactExports.Children.forEach(_e,(at,ut)=>{if(!reactExports.isValidElement(at))return;let pt=[...et,ut];if(at.type===reactExports.Fragment){rt.push.apply(rt,createRoutesFromChildren(at.props.children,pt));return}at.type!==Route&&invariant(!1),!at.props.index||!at.props.children||invariant(!1);let yt={id:at.props.id||pt.join("-"),caseSensitive:at.props.caseSensitive,element:at.props.element,Component:at.props.Component,index:at.props.index,path:at.props.path,loader:at.props.loader,action:at.props.action,errorElement:at.props.errorElement,ErrorBoundary:at.props.ErrorBoundary,hasErrorBoundary:at.props.ErrorBoundary!=null||at.props.errorElement!=null,shouldRevalidate:at.props.shouldRevalidate,handle:at.props.handle,lazy:at.props.lazy};at.props.children&&(yt.children=createRoutesFromChildren(at.props.children,pt)),rt.push(yt)}),rt}/**
 * React Router DOM v6.21.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(_e){for(var et=1;et<arguments.length;et++){var rt=arguments[et];for(var at in rt)Object.prototype.hasOwnProperty.call(rt,at)&&(_e[at]=rt[at])}return _e},_extends$1.apply(this,arguments)}function _objectWithoutPropertiesLoose$1(_e,et){if(_e==null)return{};var rt={},at=Object.keys(_e),ut,pt;for(pt=0;pt<at.length;pt++)ut=at[pt],!(et.indexOf(ut)>=0)&&(rt[ut]=_e[ut]);return rt}function isModifiedEvent(_e){return!!(_e.metaKey||_e.altKey||_e.ctrlKey||_e.shiftKey)}function shouldProcessLinkClick(_e,et){return _e.button===0&&(!et||et==="_self")&&!isModifiedEvent(_e)}const _excluded$1=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],START_TRANSITION="startTransition",startTransitionImpl=React$1[START_TRANSITION];function BrowserRouter(_e){let{basename:et,children:rt,future:at,window:ut}=_e,pt=reactExports.useRef();pt.current==null&&(pt.current=createBrowserHistory({window:ut,v5Compat:!0}));let yt=pt.current,[ct,At]=reactExports.useState({action:yt.action,location:yt.location}),{v7_startTransition:Pt}=at||{},kt=reactExports.useCallback(Lt=>{Pt&&startTransitionImpl?startTransitionImpl(()=>At(Lt)):At(Lt)},[At,Pt]);return reactExports.useLayoutEffect(()=>yt.listen(kt),[yt,kt]),reactExports.createElement(Router,{basename:et,children:rt,location:ct.location,navigationType:ct.action,navigator:yt,future:at})}const isBrowser=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function(et,rt){let{onClick:at,relative:ut,reloadDocument:pt,replace:yt,state:ct,target:At,to:Pt,preventScrollReset:kt,unstable_viewTransition:Lt}=et,Mt=_objectWithoutPropertiesLoose$1(et,_excluded$1),{basename:Qt}=reactExports.useContext(NavigationContext),Jt,sn=!1;if(typeof Pt=="string"&&ABSOLUTE_URL_REGEX.test(Pt)&&(Jt=Pt,isBrowser))try{let Ht=new URL(window.location.href),nn=Pt.startsWith("//")?new URL(Ht.protocol+Pt):new URL(Pt),Ot=stripBasename(nn.pathname,Qt);nn.origin===Ht.origin&&Ot!=null?Pt=Ot+nn.search+nn.hash:sn=!0}catch{}let tn=useHref(Pt,{relative:ut}),Bt=useLinkClickHandler(Pt,{replace:yt,state:ct,target:At,preventScrollReset:kt,relative:ut,unstable_viewTransition:Lt});function zt(Ht){at&&at(Ht),Ht.defaultPrevented||Bt(Ht)}return reactExports.createElement("a",_extends$1({},Mt,{href:Jt||tn,onClick:sn||pt?at:zt,ref:rt,target:At}))});var DataRouterHook;(function(_e){_e.UseScrollRestoration="useScrollRestoration",_e.UseSubmit="useSubmit",_e.UseSubmitFetcher="useSubmitFetcher",_e.UseFetcher="useFetcher",_e.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(_e){_e.UseFetcher="useFetcher",_e.UseFetchers="useFetchers",_e.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));function useLinkClickHandler(_e,et){let{target:rt,replace:at,state:ut,preventScrollReset:pt,relative:yt,unstable_viewTransition:ct}=et===void 0?{}:et,At=useNavigate(),Pt=useLocation(),kt=useResolvedPath(_e,{relative:yt});return reactExports.useCallback(Lt=>{if(shouldProcessLinkClick(Lt,rt)){Lt.preventDefault();let Mt=at!==void 0?at:createPath(Pt)===createPath(kt);At(_e,{replace:Mt,state:ut,preventScrollReset:pt,relative:yt,unstable_viewTransition:ct})}},[Pt,At,kt,at,ut,rt,_e,pt,yt,ct])}var define_import_meta_env_default$1={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const createStoreImpl=_e=>{let et;const rt=new Set,at=(kt,Lt)=>{const Mt=typeof kt=="function"?kt(et):kt;if(!Object.is(Mt,et)){const Qt=et;et=Lt??(typeof Mt!="object"||Mt===null)?Mt:Object.assign({},et,Mt),rt.forEach(Jt=>Jt(et,Qt))}},ut=()=>et,At={setState:at,getState:ut,getInitialState:()=>Pt,subscribe:kt=>(rt.add(kt),()=>rt.delete(kt)),destroy:()=>{(define_import_meta_env_default$1?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),rt.clear()}},Pt=et=_e(at,ut,At);return At},createStore=_e=>_e?createStoreImpl(_e):createStoreImpl;var withSelector={exports:{}},withSelector_production_min={},shim={exports:{}},useSyncExternalStoreShim_production_min={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e$1=reactExports;function h$3(_e,et){return _e===et&&(_e!==0||1/_e===1/et)||_e!==_e&&et!==et}var k=typeof Object.is=="function"?Object.is:h$3,l$1=e$1.useState,m$1=e$1.useEffect,n$3=e$1.useLayoutEffect,p$2=e$1.useDebugValue;function q$1(_e,et){var rt=et(),at=l$1({inst:{value:rt,getSnapshot:et}}),ut=at[0].inst,pt=at[1];return n$3(function(){ut.value=rt,ut.getSnapshot=et,r$1(ut)&&pt({inst:ut})},[_e,rt,et]),m$1(function(){return r$1(ut)&&pt({inst:ut}),_e(function(){r$1(ut)&&pt({inst:ut})})},[_e]),p$2(rt),rt}function r$1(_e){var et=_e.getSnapshot;_e=_e.value;try{var rt=et();return!k(_e,rt)}catch{return!0}}function t$2(_e,et){return et()}var u$3=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?t$2:q$1;useSyncExternalStoreShim_production_min.useSyncExternalStore=e$1.useSyncExternalStore!==void 0?e$1.useSyncExternalStore:u$3;shim.exports=useSyncExternalStoreShim_production_min;var shimExports=shim.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h$2=reactExports,n$2=shimExports;function p$1(_e,et){return _e===et&&(_e!==0||1/_e===1/et)||_e!==_e&&et!==et}var q=typeof Object.is=="function"?Object.is:p$1,r=n$2.useSyncExternalStore,t$1=h$2.useRef,u$2=h$2.useEffect,v$1=h$2.useMemo,w$1=h$2.useDebugValue;withSelector_production_min.useSyncExternalStoreWithSelector=function(_e,et,rt,at,ut){var pt=t$1(null);if(pt.current===null){var yt={hasValue:!1,value:null};pt.current=yt}else yt=pt.current;pt=v$1(function(){function At(Qt){if(!Pt){if(Pt=!0,kt=Qt,Qt=at(Qt),ut!==void 0&&yt.hasValue){var Jt=yt.value;if(ut(Jt,Qt))return Lt=Jt}return Lt=Qt}if(Jt=Lt,q(kt,Qt))return Jt;var sn=at(Qt);return ut!==void 0&&ut(Jt,sn)?Jt:(kt=Qt,Lt=sn)}var Pt=!1,kt,Lt,Mt=rt===void 0?null:rt;return[function(){return At(et())},Mt===null?void 0:function(){return At(Mt())}]},[et,rt,at,ut]);var ct=r(_e,pt[0],pt[1]);return u$2(function(){yt.hasValue=!0,yt.value=ct},[ct]),w$1(ct),ct};withSelector.exports=withSelector_production_min;var withSelectorExports=withSelector.exports;const useSyncExternalStoreExports=getDefaultExportFromCjs(withSelectorExports);var define_import_meta_env_default={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{useDebugValue}=React,{useSyncExternalStoreWithSelector}=useSyncExternalStoreExports;let didWarnAboutEqualityFn=!1;const identity=_e=>_e;function useStore(_e,et=identity,rt){(define_import_meta_env_default?"production":void 0)!=="production"&&rt&&!didWarnAboutEqualityFn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),didWarnAboutEqualityFn=!0);const at=useSyncExternalStoreWithSelector(_e.subscribe,_e.getState,_e.getServerState||_e.getInitialState,et,rt);return useDebugValue(at),at}const createImpl=_e=>{(define_import_meta_env_default?"production":void 0)!=="production"&&typeof _e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const et=typeof _e=="function"?createStore(_e):_e,rt=(at,ut)=>useStore(et,at,ut);return Object.assign(rt,et),rt},create=_e=>_e?createImpl(_e):createImpl,useConversation=create(_e=>({selectedConversation:null,setSelectedConversation:et=>_e({selectedConversation:et}),messages:[],setMessages:et=>_e({messages:et})}));var DefaultContext={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},IconContext=React.createContext&&React.createContext(DefaultContext),_excluded=["attr","size","title"];function _objectWithoutProperties(_e,et){if(_e==null)return{};var rt=_objectWithoutPropertiesLoose(_e,et),at,ut;if(Object.getOwnPropertySymbols){var pt=Object.getOwnPropertySymbols(_e);for(ut=0;ut<pt.length;ut++)at=pt[ut],!(et.indexOf(at)>=0)&&Object.prototype.propertyIsEnumerable.call(_e,at)&&(rt[at]=_e[at])}return rt}function _objectWithoutPropertiesLoose(_e,et){if(_e==null)return{};var rt={},at=Object.keys(_e),ut,pt;for(pt=0;pt<at.length;pt++)ut=at[pt],!(et.indexOf(ut)>=0)&&(rt[ut]=_e[ut]);return rt}function _extends(){return _extends=Object.assign?Object.assign.bind():function(_e){for(var et=1;et<arguments.length;et++){var rt=arguments[et];for(var at in rt)Object.prototype.hasOwnProperty.call(rt,at)&&(_e[at]=rt[at])}return _e},_extends.apply(this,arguments)}function ownKeys(_e,et){var rt=Object.keys(_e);if(Object.getOwnPropertySymbols){var at=Object.getOwnPropertySymbols(_e);et&&(at=at.filter(function(ut){return Object.getOwnPropertyDescriptor(_e,ut).enumerable})),rt.push.apply(rt,at)}return rt}function _objectSpread(_e){for(var et=1;et<arguments.length;et++){var rt=arguments[et]!=null?arguments[et]:{};et%2?ownKeys(Object(rt),!0).forEach(function(at){_defineProperty(_e,at,rt[at])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(rt)):ownKeys(Object(rt)).forEach(function(at){Object.defineProperty(_e,at,Object.getOwnPropertyDescriptor(rt,at))})}return _e}function _defineProperty(_e,et,rt){return et=_toPropertyKey(et),et in _e?Object.defineProperty(_e,et,{value:rt,enumerable:!0,configurable:!0,writable:!0}):_e[et]=rt,_e}function _toPropertyKey(_e){var et=_toPrimitive(_e,"string");return typeof et=="symbol"?et:String(et)}function _toPrimitive(_e,et){if(typeof _e!="object"||_e===null)return _e;var rt=_e[Symbol.toPrimitive];if(rt!==void 0){var at=rt.call(_e,et||"default");if(typeof at!="object")return at;throw new TypeError("@@toPrimitive must return a primitive value.")}return(et==="string"?String:Number)(_e)}function Tree2Element(_e){return _e&&_e.map((et,rt)=>React.createElement(et.tag,_objectSpread({key:rt},et.attr),Tree2Element(et.child)))}function GenIcon(_e){return et=>React.createElement(IconBase,_extends({attr:_objectSpread({},_e.attr)},et),Tree2Element(_e.child))}function IconBase(_e){var et=rt=>{var{attr:at,size:ut,title:pt}=_e,yt=_objectWithoutProperties(_e,_excluded),ct=ut||rt.size||"1em",At;return rt.className&&(At=rt.className),_e.className&&(At=(At?At+" ":"")+_e.className),React.createElement("svg",_extends({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},rt.attr,at,yt,{className:At,style:_objectSpread(_objectSpread({color:_e.color||rt.color},rt.style),_e.style),height:ct,width:ct,xmlns:"http://www.w3.org/2000/svg"}),pt&&React.createElement("title",null,pt),_e.children)};return IconContext!==void 0?React.createElement(IconContext.Consumer,null,rt=>et(rt)):et(DefaultContext)}function BsChevronLeft(_e){return GenIcon({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"},child:[]}]})(_e)}function BsChevronRight(_e){return GenIcon({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"},child:[]}]})(_e)}function BsSend(_e){return GenIcon({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"},child:[]}]})(_e)}function BsX(_e){return GenIcon({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"},child:[]}]})(_e)}var lib={exports:{}},core_min={};function commonjsRequire(_e){throw new Error('Could not dynamically require "'+_e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(et,rt){module.exports=et.pdfjsLib=rt()})(globalThis,()=>(()=>{var __webpack_modules__=[,(_e,et)=>{var ns;Object.defineProperty(et,"__esModule",{value:!0}),et.VerbosityLevel=et.Util=et.UnknownErrorException=et.UnexpectedResponseException=et.TextRenderingMode=et.RenderingIntentFlag=et.PromiseCapability=et.PermissionFlag=et.PasswordResponses=et.PasswordException=et.PageActionEventType=et.OPS=et.MissingPDFException=et.MAX_IMAGE_SIZE_TO_CACHE=et.LINE_FACTOR=et.LINE_DESCENT_FACTOR=et.InvalidPDFException=et.ImageKind=et.IDENTITY_MATRIX=et.FormatError=et.FeatureTest=et.FONT_IDENTITY_MATRIX=et.DocumentActionEventType=et.CMapCompressionType=et.BaseException=et.BASELINE_FACTOR=et.AnnotationType=et.AnnotationReplyType=et.AnnotationPrefix=et.AnnotationMode=et.AnnotationFlag=et.AnnotationFieldFlag=et.AnnotationEditorType=et.AnnotationEditorPrefix=et.AnnotationEditorParamsType=et.AnnotationBorderStyleType=et.AnnotationActionEventType=et.AbortException=void 0,et.assert=lr,et.bytesToString=jn,et.createValidAbsoluteUrl=Dr,et.getModificationDate=qr,et.getUuid=Ms,et.getVerbosityLevel=_i,et.info=gr,et.isArrayBuffer=Tr,et.isArrayEqual=Zr,et.isNodeJS=void 0,et.normalizeUnicode=Ts,et.objectFromMap=Rr,et.objectSize=wr,et.setVerbosityLevel=Sn,et.shadow=$r,et.string32=cr,et.stringToBytes=dr,et.stringToPDFString=Lr,et.stringToUTF8String=hr,et.unreachable=Pn,et.utf8StringToString=or,et.warn=br;const rt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");et.isNodeJS=rt;const at=[1,0,0,1,0,0];et.IDENTITY_MATRIX=at;const ut=[.001,0,0,.001,0,0];et.FONT_IDENTITY_MATRIX=ut;const pt=1e7;et.MAX_IMAGE_SIZE_TO_CACHE=pt;const yt=1.35;et.LINE_FACTOR=yt;const ct=.35;et.LINE_DESCENT_FACTOR=ct;const At=ct/yt;et.BASELINE_FACTOR=At;const Pt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};et.RenderingIntentFlag=Pt;const kt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};et.AnnotationMode=kt;const Lt="pdfjs_internal_editor_";et.AnnotationEditorPrefix=Lt;const Mt={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};et.AnnotationEditorType=Mt;const Qt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};et.AnnotationEditorParamsType=Qt;const Jt={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};et.PermissionFlag=Jt;const sn={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};et.TextRenderingMode=sn;const tn={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};et.ImageKind=tn;const Bt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};et.AnnotationType=Bt;const zt={GROUP:"Group",REPLY:"R"};et.AnnotationReplyType=zt;const Ht={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};et.AnnotationFlag=Ht;const nn={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};et.AnnotationFieldFlag=nn;const Ot={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};et.AnnotationBorderStyleType=Ot;const Kt={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};et.AnnotationActionEventType=Kt;const mn={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};et.DocumentActionEventType=mn;const hn={O:"PageOpen",C:"PageClose"};et.PageActionEventType=hn;const Yt={ERRORS:0,WARNINGS:1,INFOS:5};et.VerbosityLevel=Yt;const vn={NONE:0,BINARY:1};et.CMapCompressionType=vn;const fn={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};et.OPS=fn;const Wn={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};et.PasswordResponses=Wn;let Xn=Yt.WARNINGS;function Sn(tr){Number.isInteger(tr)&&(Xn=tr)}function _i(){return Xn}function gr(tr){Xn>=Yt.INFOS&&console.log(`Info: ${tr}`)}function br(tr){Xn>=Yt.WARNINGS&&console.log(`Warning: ${tr}`)}function Pn(tr){throw new Error(tr)}function lr(tr,Yn){tr||Pn(Yn)}function xr(tr){switch(tr==null?void 0:tr.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Dr(tr,Yn=null,qn=null){if(!tr)return null;try{if(qn&&typeof tr=="string"){if(qn.addDefaultProtocol&&tr.startsWith("www.")){const kr=tr.match(/\./g);(kr==null?void 0:kr.length)>=2&&(tr=`http://${tr}`)}if(qn.tryConvertEncoding)try{tr=hr(tr)}catch{}}const Er=Yn?new URL(tr,Yn):new URL(tr);if(xr(Er))return Er}catch{}return null}function $r(tr,Yn,qn,Er=!1){return Object.defineProperty(tr,Yn,{value:qn,enumerable:!Er,configurable:!0,writable:!1}),qn}const An=function(){function Yn(qn,Er){this.constructor===Yn&&Pn("Cannot initialize BaseException."),this.message=qn,this.name=Er}return Yn.prototype=new Error,Yn.constructor=Yn,Yn}();et.BaseException=An;class Nt extends An{constructor(Yn,qn){super(Yn,"PasswordException"),this.code=qn}}et.PasswordException=Nt;class Zt extends An{constructor(Yn,qn){super(Yn,"UnknownErrorException"),this.details=qn}}et.UnknownErrorException=Zt;class $t extends An{constructor(Yn){super(Yn,"InvalidPDFException")}}et.InvalidPDFException=$t;class rn extends An{constructor(Yn){super(Yn,"MissingPDFException")}}et.MissingPDFException=rn;class an extends An{constructor(Yn,qn){super(Yn,"UnexpectedResponseException"),this.status=qn}}et.UnexpectedResponseException=an;class En extends An{constructor(Yn){super(Yn,"FormatError")}}et.FormatError=En;class Mn extends An{constructor(Yn){super(Yn,"AbortException")}}et.AbortException=Mn;function jn(tr){(typeof tr!="object"||(tr==null?void 0:tr.length)===void 0)&&Pn("Invalid argument for bytesToString");const Yn=tr.length,qn=8192;if(Yn<qn)return String.fromCharCode.apply(null,tr);const Er=[];for(let kr=0;kr<Yn;kr+=qn){const Us=Math.min(kr+qn,Yn),lo=tr.subarray(kr,Us);Er.push(String.fromCharCode.apply(null,lo))}return Er.join("")}function dr(tr){typeof tr!="string"&&Pn("Invalid argument for stringToBytes");const Yn=tr.length,qn=new Uint8Array(Yn);for(let Er=0;Er<Yn;++Er)qn[Er]=tr.charCodeAt(Er)&255;return qn}function cr(tr){return String.fromCharCode(tr>>24&255,tr>>16&255,tr>>8&255,tr&255)}function wr(tr){return Object.keys(tr).length}function Rr(tr){const Yn=Object.create(null);for(const[qn,Er]of tr)Yn[qn]=Er;return Yn}function On(){const tr=new Uint8Array(4);return tr[0]=1,new Uint32Array(tr.buffer,0,1)[0]===1}function Mr(){try{return new Function(""),!0}catch{return!1}}class ts{static get isLittleEndian(){return $r(this,"isLittleEndian",On())}static get isEvalSupported(){return $r(this,"isEvalSupported",Mr())}static get isOffscreenCanvasSupported(){return $r(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?$r(this,"platform",{isWin:!1,isMac:!1}):$r(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var Yn,qn;return $r(this,"isCSSRoundSupported",(qn=(Yn=globalThis.CSS)==null?void 0:Yn.supports)==null?void 0:qn.call(Yn,"width: round(1.5px, 1px)"))}}et.FeatureTest=ts;const Jr=[...Array(256).keys()].map(tr=>tr.toString(16).padStart(2,"0"));class jr{static makeHexColor(Yn,qn,Er){return`#${Jr[Yn]}${Jr[qn]}${Jr[Er]}`}static scaleMinMax(Yn,qn){let Er;Yn[0]?(Yn[0]<0&&(Er=qn[0],qn[0]=qn[1],qn[1]=Er),qn[0]*=Yn[0],qn[1]*=Yn[0],Yn[3]<0&&(Er=qn[2],qn[2]=qn[3],qn[3]=Er),qn[2]*=Yn[3],qn[3]*=Yn[3]):(Er=qn[0],qn[0]=qn[2],qn[2]=Er,Er=qn[1],qn[1]=qn[3],qn[3]=Er,Yn[1]<0&&(Er=qn[2],qn[2]=qn[3],qn[3]=Er),qn[2]*=Yn[1],qn[3]*=Yn[1],Yn[2]<0&&(Er=qn[0],qn[0]=qn[1],qn[1]=Er),qn[0]*=Yn[2],qn[1]*=Yn[2]),qn[0]+=Yn[4],qn[1]+=Yn[4],qn[2]+=Yn[5],qn[3]+=Yn[5]}static transform(Yn,qn){return[Yn[0]*qn[0]+Yn[2]*qn[1],Yn[1]*qn[0]+Yn[3]*qn[1],Yn[0]*qn[2]+Yn[2]*qn[3],Yn[1]*qn[2]+Yn[3]*qn[3],Yn[0]*qn[4]+Yn[2]*qn[5]+Yn[4],Yn[1]*qn[4]+Yn[3]*qn[5]+Yn[5]]}static applyTransform(Yn,qn){const Er=Yn[0]*qn[0]+Yn[1]*qn[2]+qn[4],kr=Yn[0]*qn[1]+Yn[1]*qn[3]+qn[5];return[Er,kr]}static applyInverseTransform(Yn,qn){const Er=qn[0]*qn[3]-qn[1]*qn[2],kr=(Yn[0]*qn[3]-Yn[1]*qn[2]+qn[2]*qn[5]-qn[4]*qn[3])/Er,Us=(-Yn[0]*qn[1]+Yn[1]*qn[0]+qn[4]*qn[1]-qn[5]*qn[0])/Er;return[kr,Us]}static getAxialAlignedBoundingBox(Yn,qn){const Er=this.applyTransform(Yn,qn),kr=this.applyTransform(Yn.slice(2,4),qn),Us=this.applyTransform([Yn[0],Yn[3]],qn),lo=this.applyTransform([Yn[2],Yn[1]],qn);return[Math.min(Er[0],kr[0],Us[0],lo[0]),Math.min(Er[1],kr[1],Us[1],lo[1]),Math.max(Er[0],kr[0],Us[0],lo[0]),Math.max(Er[1],kr[1],Us[1],lo[1])]}static inverseTransform(Yn){const qn=Yn[0]*Yn[3]-Yn[1]*Yn[2];return[Yn[3]/qn,-Yn[1]/qn,-Yn[2]/qn,Yn[0]/qn,(Yn[2]*Yn[5]-Yn[4]*Yn[3])/qn,(Yn[4]*Yn[1]-Yn[5]*Yn[0])/qn]}static singularValueDecompose2dScale(Yn){const qn=[Yn[0],Yn[2],Yn[1],Yn[3]],Er=Yn[0]*qn[0]+Yn[1]*qn[2],kr=Yn[0]*qn[1]+Yn[1]*qn[3],Us=Yn[2]*qn[0]+Yn[3]*qn[2],lo=Yn[2]*qn[1]+Yn[3]*qn[3],rr=(Er+lo)/2,_n=Math.sqrt((Er+lo)**2-4*(Er*lo-Us*kr))/2,Wt=rr+_n||1,jt=rr-_n||1;return[Math.sqrt(Wt),Math.sqrt(jt)]}static normalizeRect(Yn){const qn=Yn.slice(0);return Yn[0]>Yn[2]&&(qn[0]=Yn[2],qn[2]=Yn[0]),Yn[1]>Yn[3]&&(qn[1]=Yn[3],qn[3]=Yn[1]),qn}static intersect(Yn,qn){const Er=Math.max(Math.min(Yn[0],Yn[2]),Math.min(qn[0],qn[2])),kr=Math.min(Math.max(Yn[0],Yn[2]),Math.max(qn[0],qn[2]));if(Er>kr)return null;const Us=Math.max(Math.min(Yn[1],Yn[3]),Math.min(qn[1],qn[3])),lo=Math.min(Math.max(Yn[1],Yn[3]),Math.max(qn[1],qn[3]));return Us>lo?null:[Er,Us,kr,lo]}static bezierBoundingBox(Yn,qn,Er,kr,Us,lo,rr,_n){const Wt=[],jt=[[],[]];let ln,xn,Nn,Tn,Kn,Cn,un,Rt;for(let zn=0;zn<2;++zn){if(zn===0?(xn=6*Yn-12*Er+6*Us,ln=-3*Yn+9*Er-9*Us+3*rr,Nn=3*Er-3*Yn):(xn=6*qn-12*kr+6*lo,ln=-3*qn+9*kr-9*lo+3*_n,Nn=3*kr-3*qn),Math.abs(ln)<1e-12){if(Math.abs(xn)<1e-12)continue;Tn=-Nn/xn,0<Tn&&Tn<1&&Wt.push(Tn);continue}un=xn*xn-4*Nn*ln,Rt=Math.sqrt(un),!(un<0)&&(Kn=(-xn+Rt)/(2*ln),0<Kn&&Kn<1&&Wt.push(Kn),Cn=(-xn-Rt)/(2*ln),0<Cn&&Cn<1&&Wt.push(Cn))}let qt=Wt.length,yn;const Rn=qt;for(;qt--;)Tn=Wt[qt],yn=1-Tn,jt[0][qt]=yn*yn*yn*Yn+3*yn*yn*Tn*Er+3*yn*Tn*Tn*Us+Tn*Tn*Tn*rr,jt[1][qt]=yn*yn*yn*qn+3*yn*yn*Tn*kr+3*yn*Tn*Tn*lo+Tn*Tn*Tn*_n;return jt[0][Rn]=Yn,jt[1][Rn]=qn,jt[0][Rn+1]=rr,jt[1][Rn+1]=_n,jt[0].length=jt[1].length=Rn+2,[Math.min(...jt[0]),Math.min(...jt[1]),Math.max(...jt[0]),Math.max(...jt[1])]}}et.Util=jr;const ss=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Lr(tr){if(tr[0]>="ï"){let qn;if(tr[0]==="þ"&&tr[1]==="ÿ"?qn="utf-16be":tr[0]==="ÿ"&&tr[1]==="þ"?qn="utf-16le":tr[0]==="ï"&&tr[1]==="»"&&tr[2]==="¿"&&(qn="utf-8"),qn)try{const Er=new TextDecoder(qn,{fatal:!0}),kr=dr(tr);return Er.decode(kr)}catch(Er){br(`stringToPDFString: "${Er}".`)}}const Yn=[];for(let qn=0,Er=tr.length;qn<Er;qn++){const kr=ss[tr.charCodeAt(qn)];Yn.push(kr?String.fromCharCode(kr):tr.charAt(qn))}return Yn.join("")}function hr(tr){return decodeURIComponent(escape(tr))}function or(tr){return unescape(encodeURIComponent(tr))}function Tr(tr){return typeof tr=="object"&&(tr==null?void 0:tr.byteLength)!==void 0}function Zr(tr,Yn){if(tr.length!==Yn.length)return!1;for(let qn=0,Er=tr.length;qn<Er;qn++)if(tr[qn]!==Yn[qn])return!1;return!0}function qr(tr=new Date){return[tr.getUTCFullYear().toString(),(tr.getUTCMonth()+1).toString().padStart(2,"0"),tr.getUTCDate().toString().padStart(2,"0"),tr.getUTCHours().toString().padStart(2,"0"),tr.getUTCMinutes().toString().padStart(2,"0"),tr.getUTCSeconds().toString().padStart(2,"0")].join("")}class Cr{constructor(){Bn(this,ns,!1);this.promise=new Promise((Yn,qn)=>{this.resolve=Er=>{yr(this,ns,!0),Yn(Er)},this.reject=Er=>{yr(this,ns,!0),qn(Er)}})}get settled(){return It(this,ns)}}ns=new WeakMap,et.PromiseCapability=Cr;let ws=null,ds=null;function Ts(tr){return ws||(ws=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,ds=new Map([["ﬅ","ſt"]])),tr.replaceAll(ws,(Yn,qn,Er)=>qn?qn.normalize("NFKC"):ds.get(Er))}function Ms(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const tr=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(tr);else for(let Yn=0;Yn<32;Yn++)tr[Yn]=Math.floor(Math.random()*255);return jn(tr)}const Pr="pdfjs_internal_id_";et.AnnotationPrefix=Pr},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var _e,rt,at,ut,s_,yt,zy,At,Pt,kt,Lt,Mt,Qt,Jt,sn,tn,Ny,zt,Ht,Z0,Ot,Kt;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(hn){if(typeof hn=="string"||hn instanceof URL?hn={url:hn}:(0,_util.isArrayBuffer)(hn)&&(hn={data:hn}),typeof hn!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!hn.url&&!hn.data&&!hn.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const Yt=new PDFDocumentLoadingTask,{docId:vn}=Yt,fn=hn.url?getUrlProp(hn.url):null,Wn=hn.data?getDataProp(hn.data):null,Xn=hn.httpHeaders||null,Sn=hn.withCredentials===!0,_i=hn.password??null,gr=hn.range instanceof PDFDataRangeTransport?hn.range:null,br=Number.isInteger(hn.rangeChunkSize)&&hn.rangeChunkSize>0?hn.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let Pn=hn.worker instanceof PDFWorker?hn.worker:null;const lr=hn.verbosity,xr=typeof hn.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(hn.docBaseUrl)?hn.docBaseUrl:null,Dr=typeof hn.cMapUrl=="string"?hn.cMapUrl:null,$r=hn.cMapPacked!==!1,An=hn.CMapReaderFactory||DefaultCMapReaderFactory,Nt=typeof hn.standardFontDataUrl=="string"?hn.standardFontDataUrl:null,Zt=hn.StandardFontDataFactory||DefaultStandardFontDataFactory,$t=hn.stopAtErrors!==!0,rn=Number.isInteger(hn.maxImageSize)&&hn.maxImageSize>-1?hn.maxImageSize:-1,an=hn.isEvalSupported!==!1,En=typeof hn.isOffscreenCanvasSupported=="boolean"?hn.isOffscreenCanvasSupported:!_util.isNodeJS,Mn=Number.isInteger(hn.canvasMaxAreaInBytes)?hn.canvasMaxAreaInBytes:-1,jn=typeof hn.disableFontFace=="boolean"?hn.disableFontFace:_util.isNodeJS,dr=hn.fontExtraProperties===!0,cr=hn.enableXfa===!0,wr=hn.ownerDocument||globalThis.document,Rr=hn.disableRange===!0,On=hn.disableStream===!0,Mr=hn.disableAutoFetch===!0,ts=hn.pdfBug===!0,Jr=gr?gr.length:hn.length??NaN,jr=typeof hn.useSystemFonts=="boolean"?hn.useSystemFonts:!_util.isNodeJS&&!jn,ss=typeof hn.useWorkerFetch=="boolean"?hn.useWorkerFetch:An===_display_utils.DOMCMapReaderFactory&&Zt===_display_utils.DOMStandardFontDataFactory&&Dr&&Nt&&(0,_display_utils.isValidFetchUrl)(Dr,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(Nt,document.baseURI),Lr=hn.canvasFactory||new DefaultCanvasFactory({ownerDocument:wr}),hr=hn.filterFactory||new DefaultFilterFactory({docId:vn,ownerDocument:wr}),or=null;(0,_util.setVerbosityLevel)(lr);const Tr={canvasFactory:Lr,filterFactory:hr};if(ss||(Tr.cMapReaderFactory=new An({baseUrl:Dr,isCompressed:$r}),Tr.standardFontDataFactory=new Zt({baseUrl:Nt})),!Pn){const Cr={verbosity:lr,port:_worker_options.GlobalWorkerOptions.workerPort};Pn=Cr.port?PDFWorker.fromPort(Cr):new PDFWorker(Cr),Yt._worker=Pn}const Zr={docId:vn,apiVersion:"3.11.174",data:Wn,password:_i,disableAutoFetch:Mr,rangeChunkSize:br,length:Jr,docBaseUrl:xr,enableXfa:cr,evaluatorOptions:{maxImageSize:rn,disableFontFace:jn,ignoreErrors:$t,isEvalSupported:an,isOffscreenCanvasSupported:En,canvasMaxAreaInBytes:Mn,fontExtraProperties:dr,useSystemFonts:jr,cMapUrl:ss?Dr:null,standardFontDataUrl:ss?Nt:null}},qr={ignoreErrors:$t,isEvalSupported:an,disableFontFace:jn,fontExtraProperties:dr,enableXfa:cr,ownerDocument:wr,disableAutoFetch:Mr,pdfBug:ts,styleElement:or};return Pn.promise.then(function(){if(Yt.destroyed)throw new Error("Loading aborted");const Cr=_fetchDocument(Pn,Zr),ws=new Promise(function(ds){let Ts;gr?Ts=new _transport_stream.PDFDataTransportStream({length:Jr,initialData:gr.initialData,progressiveDone:gr.progressiveDone,contentDispositionFilename:gr.contentDispositionFilename,disableRange:Rr,disableStream:On},gr):Wn||(Ts=(Pr=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(Pr):(0,_display_utils.isValidFetchUrl)(Pr.url)?new _displayFetch_stream.PDFFetchStream(Pr):new _displayNetwork.PDFNetworkStream(Pr))({url:fn,length:Jr,httpHeaders:Xn,withCredentials:Sn,rangeChunkSize:br,disableRange:Rr,disableStream:On})),ds(Ts)});return Promise.all([Cr,ws]).then(function([ds,Ts]){if(Yt.destroyed)throw new Error("Loading aborted");const Ms=new _message_handler.MessageHandler(vn,ds,Pn.port),Pr=new WorkerTransport(Ms,Yt,Ts,qr,Tr);Yt._transport=Pr,Ms.send("Ready",null)})}).catch(Yt._capability.reject),Yt}async function _fetchDocument(hn,Yt){if(hn.destroyed)throw new Error("Worker was destroyed");const vn=await hn.messageHandler.sendWithPromise("GetDocRequest",Yt,Yt.data?[Yt.data.buffer]:null);if(hn.destroyed)throw new Error("Worker was destroyed");return vn}function getUrlProp(hn){if(hn instanceof URL)return hn.href;try{return new URL(hn,window.location).href}catch{if(_util.isNodeJS&&typeof hn=="string")return hn}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(hn){if(_util.isNodeJS&&typeof Buffer<"u"&&hn instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(hn instanceof Uint8Array&&hn.byteLength===hn.buffer.byteLength)return hn;if(typeof hn=="string")return(0,_util.stringToBytes)(hn);if(typeof hn=="object"&&!isNaN(hn==null?void 0:hn.length)||(0,_util.isArrayBuffer)(hn))return new Uint8Array(hn);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const et=class et{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${Q_(et,_e)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var Yt,vn,fn;this.destroyed=!0;try{(Yt=this._worker)!=null&&Yt.port&&(this._worker._pendingDestroy=!0),await((vn=this._transport)==null?void 0:vn.destroy())}catch(Wn){throw(fn=this._worker)!=null&&fn.port&&delete this._worker._pendingDestroy,Wn}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};_e=new WeakMap,Bn(et,_e,0);let PDFDocumentLoadingTask=et;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(Yt,vn,fn=!1,Wn=null){this.length=Yt,this.initialData=vn,this.progressiveDone=fn,this.contentDispositionFilename=Wn,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(Yt){this._rangeListeners.push(Yt)}addProgressListener(Yt){this._progressListeners.push(Yt)}addProgressiveReadListener(Yt){this._progressiveReadListeners.push(Yt)}addProgressiveDoneListener(Yt){this._progressiveDoneListeners.push(Yt)}onDataRange(Yt,vn){for(const fn of this._rangeListeners)fn(Yt,vn)}onDataProgress(Yt,vn){this._readyCapability.promise.then(()=>{for(const fn of this._progressListeners)fn(Yt,vn)})}onDataProgressiveRead(Yt){this._readyCapability.promise.then(()=>{for(const vn of this._progressiveReadListeners)vn(Yt)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const Yt of this._progressiveDoneListeners)Yt()})}transportReady(){this._readyCapability.resolve()}requestDataRange(Yt,vn){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(Yt,vn){this._pdfInfo=Yt,this._transport=vn,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(fn=>{if(!fn)return fn;const Wn=[];for(const Xn in fn)Wn.push(...fn[Xn]);return Wn}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(Yt){return this._transport.getPage(Yt)}getPageIndex(Yt){return this._transport.getPageIndex(Yt)}getDestinations(){return this._transport.getDestinations()}getDestination(Yt){return this._transport.getDestination(Yt)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(Yt=!1){return this._transport.startCleanup(Yt||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(Yt,vn,fn,Wn=!1){Bn(this,ut);Bn(this,yt);Bn(this,rt,null);Bn(this,at,!1);this._pageIndex=Yt,this._pageInfo=vn,this._transport=fn,this._stats=Wn?new _display_utils.StatTimer:null,this._pdfBug=Wn,this.commonObjs=fn.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:Yt,rotation:vn=this.rotate,offsetX:fn=0,offsetY:Wn=0,dontFlip:Xn=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:Yt,rotation:vn,offsetX:fn,offsetY:Wn,dontFlip:Xn})}getAnnotations({intent:Yt="display"}={}){const vn=this._transport.getRenderingIntent(Yt);return this._transport.getAnnotations(this._pageIndex,vn.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var Yt;return((Yt=this._transport._htmlForXfa)==null?void 0:Yt.children[this._pageIndex])||null}render({canvasContext:Yt,viewport:vn,intent:fn="display",annotationMode:Wn=_util.AnnotationMode.ENABLE,transform:Xn=null,background:Sn=null,optionalContentConfigPromise:_i=null,annotationCanvasMap:gr=null,pageColors:br=null,printAnnotationStorage:Pn=null}){var Zt,$t;(Zt=this._stats)==null||Zt.time("Overall");const lr=this._transport.getRenderingIntent(fn,Wn,Pn);yr(this,at,!1),nr(this,yt,zy).call(this),_i||(_i=this._transport.getOptionalContentConfig());let xr=this._intentStates.get(lr.cacheKey);xr||(xr=Object.create(null),this._intentStates.set(lr.cacheKey,xr)),xr.streamReaderCancelTimeout&&(clearTimeout(xr.streamReaderCancelTimeout),xr.streamReaderCancelTimeout=null);const Dr=!!(lr.renderingIntent&_util.RenderingIntentFlag.PRINT);xr.displayReadyCapability||(xr.displayReadyCapability=new _util.PromiseCapability,xr.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},($t=this._stats)==null||$t.time("Page Request"),this._pumpOperatorList(lr));const $r=rn=>{var an,En;xr.renderTasks.delete(An),(this._maybeCleanupAfterRender||Dr)&&yr(this,at,!0),nr(this,ut,s_).call(this,!Dr),rn?(An.capability.reject(rn),this._abortOperatorList({intentState:xr,reason:rn instanceof Error?rn:new Error(rn)})):An.capability.resolve(),(an=this._stats)==null||an.timeEnd("Rendering"),(En=this._stats)==null||En.timeEnd("Overall")},An=new InternalRenderTask({callback:$r,params:{canvasContext:Yt,viewport:vn,transform:Xn,background:Sn},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:gr,operatorList:xr.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Dr,pdfBug:this._pdfBug,pageColors:br});(xr.renderTasks||(xr.renderTasks=new Set)).add(An);const Nt=An.task;return Promise.all([xr.displayReadyCapability.promise,_i]).then(([rn,an])=>{var En;if(this.destroyed){$r();return}(En=this._stats)==null||En.time("Rendering"),An.initializeGraphics({transparency:rn,optionalContentConfig:an}),An.operatorListChanged()}).catch($r),Nt}getOperatorList({intent:Yt="display",annotationMode:vn=_util.AnnotationMode.ENABLE,printAnnotationStorage:fn=null}={}){var gr;function Wn(){Sn.operatorList.lastChunk&&(Sn.opListReadCapability.resolve(Sn.operatorList),Sn.renderTasks.delete(_i))}const Xn=this._transport.getRenderingIntent(Yt,vn,fn,!0);let Sn=this._intentStates.get(Xn.cacheKey);Sn||(Sn=Object.create(null),this._intentStates.set(Xn.cacheKey,Sn));let _i;return Sn.opListReadCapability||(_i=Object.create(null),_i.operatorListChanged=Wn,Sn.opListReadCapability=new _util.PromiseCapability,(Sn.renderTasks||(Sn.renderTasks=new Set)).add(_i),Sn.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(gr=this._stats)==null||gr.time("Page Request"),this._pumpOperatorList(Xn)),Sn.opListReadCapability.promise}streamTextContent({includeMarkedContent:Yt=!1,disableNormalization:vn=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:Yt===!0,disableNormalization:vn===!0},{highWaterMark:100,size(Wn){return Wn.items.length}})}getTextContent(Yt={}){if(this._transport._htmlForXfa)return this.getXfa().then(fn=>_xfa_text.XfaText.textContent(fn));const vn=this.streamTextContent(Yt);return new Promise(function(fn,Wn){function Xn(){Sn.read().then(function({value:gr,done:br}){if(br){fn(_i);return}Object.assign(_i.styles,gr.styles),_i.items.push(...gr.items),Xn()},Wn)}const Sn=vn.getReader(),_i={items:[],styles:Object.create(null)};Xn()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const Yt=[];for(const vn of this._intentStates.values())if(this._abortOperatorList({intentState:vn,reason:new Error("Page was destroyed."),force:!0}),!vn.opListReadCapability)for(const fn of vn.renderTasks)Yt.push(fn.completed),fn.cancel();return this.objs.clear(),yr(this,at,!1),nr(this,yt,zy).call(this),Promise.all(Yt)}cleanup(Yt=!1){yr(this,at,!0);const vn=nr(this,ut,s_).call(this,!1);return Yt&&vn&&this._stats&&(this._stats=new _display_utils.StatTimer),vn}_startRenderPage(Yt,vn){var Wn,Xn;const fn=this._intentStates.get(vn);fn&&((Wn=this._stats)==null||Wn.timeEnd("Page Request"),(Xn=fn.displayReadyCapability)==null||Xn.resolve(Yt))}_renderPageChunk(Yt,vn){for(let fn=0,Wn=Yt.length;fn<Wn;fn++)vn.operatorList.fnArray.push(Yt.fnArray[fn]),vn.operatorList.argsArray.push(Yt.argsArray[fn]);vn.operatorList.lastChunk=Yt.lastChunk,vn.operatorList.separateAnnots=Yt.separateAnnots;for(const fn of vn.renderTasks)fn.operatorListChanged();Yt.lastChunk&&nr(this,ut,s_).call(this,!0)}_pumpOperatorList({renderingIntent:Yt,cacheKey:vn,annotationStorageSerializable:fn}){const{map:Wn,transfers:Xn}=fn,_i=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:Yt,cacheKey:vn,annotationStorage:Wn},Xn).getReader(),gr=this._intentStates.get(vn);gr.streamReader=_i;const br=()=>{_i.read().then(({value:Pn,done:lr})=>{if(lr){gr.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Pn,gr),br())},Pn=>{if(gr.streamReader=null,!this._transport.destroyed){if(gr.operatorList){gr.operatorList.lastChunk=!0;for(const lr of gr.renderTasks)lr.operatorListChanged();nr(this,ut,s_).call(this,!0)}if(gr.displayReadyCapability)gr.displayReadyCapability.reject(Pn);else if(gr.opListReadCapability)gr.opListReadCapability.reject(Pn);else throw Pn}})};br()}_abortOperatorList({intentState:Yt,reason:vn,force:fn=!1}){if(Yt.streamReader){if(Yt.streamReaderCancelTimeout&&(clearTimeout(Yt.streamReaderCancelTimeout),Yt.streamReaderCancelTimeout=null),!fn){if(Yt.renderTasks.size>0)return;if(vn instanceof _display_utils.RenderingCancelledException){let Wn=RENDERING_CANCELLED_TIMEOUT;vn.extraDelay>0&&vn.extraDelay<1e3&&(Wn+=vn.extraDelay),Yt.streamReaderCancelTimeout=setTimeout(()=>{Yt.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:Yt,reason:vn,force:!0})},Wn);return}}if(Yt.streamReader.cancel(new _util.AbortException(vn.message)).catch(()=>{}),Yt.streamReader=null,!this._transport.destroyed){for(const[Wn,Xn]of this._intentStates)if(Xn===Yt){this._intentStates.delete(Wn);break}this.cleanup()}}}get stats(){return this._stats}}rt=new WeakMap,at=new WeakMap,ut=new WeakSet,s_=function(Yt=!1){if(nr(this,yt,zy).call(this),!It(this,at)||this.destroyed)return!1;if(Yt)return yr(this,rt,setTimeout(()=>{yr(this,rt,null),nr(this,ut,s_).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:vn,operatorList:fn}of this._intentStates.values())if(vn.size>0||!fn.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),yr(this,at,!1),!0},yt=new WeakSet,zy=function(){It(this,rt)&&(clearTimeout(It(this,rt)),yr(this,rt,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Bn(this,At,new Set);Bn(this,Pt,Promise.resolve())}postMessage(Yt,vn){const fn={data:structuredClone(Yt,vn?{transfer:vn}:null)};It(this,Pt).then(()=>{for(const Wn of It(this,At))Wn.call(this,fn)})}addEventListener(Yt,vn){It(this,At).add(vn)}removeEventListener(Yt,vn){It(this,At).delete(vn)}terminate(){It(this,At).clear()}}At=new WeakMap,Pt=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const hn=(kt=document==null?void 0:document.currentScript)==null?void 0:kt.src;hn&&(PDFWorkerUtil.fallbackWorkerSrc=hn.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(hn,Yt){let vn;try{if(vn=new URL(hn),!vn.origin||vn.origin==="null")return!1}catch{return!1}const fn=new URL(Yt,vn);return vn.origin===fn.origin},PDFWorkerUtil.createCDNWrapper=function(hn){const Yt=`importScripts("${hn}");`;return URL.createObjectURL(new Blob([Yt]))}}const _PDFWorker=class _PDFWorker{constructor({name:hn=null,port:Yt=null,verbosity:vn=(0,_util.getVerbosityLevel)()}={}){var fn;if(this.name=hn,this.destroyed=!1,this.verbosity=vn,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,Yt){if((fn=It(_PDFWorker,Lt))!=null&&fn.has(Yt))throw new Error("Cannot use more than one PDFWorker per port.");(It(_PDFWorker,Lt)||yr(_PDFWorker,Lt,new WeakMap)).set(Yt,this),this._initializeFromPort(Yt);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(hn){this._port=hn,this._messageHandler=new _message_handler.MessageHandler("main","worker",hn),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:hn}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,hn)||(hn=PDFWorkerUtil.createCDNWrapper(new URL(hn,window.location).href));const Yt=new Worker(hn),vn=new _message_handler.MessageHandler("main","worker",Yt),fn=()=>{Yt.removeEventListener("error",Wn),vn.destroy(),Yt.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},Wn=()=>{this._webWorker||fn()};Yt.addEventListener("error",Wn),vn.on("test",Sn=>{if(Yt.removeEventListener("error",Wn),this.destroyed){fn();return}Sn?(this._messageHandler=vn,this._port=Yt,this._webWorker=Yt,this._readyCapability.resolve(),vn.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),vn.destroy(),Yt.terminate())}),vn.on("ready",Sn=>{if(Yt.removeEventListener("error",Wn),this.destroyed){fn();return}try{Xn()}catch{this._setupFakeWorker()}});const Xn=()=>{const Sn=new Uint8Array;vn.send("test",Sn,[Sn.buffer])};Xn();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(hn=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const Yt=new LoopbackPort;this._port=Yt;const vn=`fake${PDFWorkerUtil.fakeWorkerId++}`,fn=new _message_handler.MessageHandler(vn+"_worker",vn,Yt);hn.setup(fn,Yt);const Wn=new _message_handler.MessageHandler(vn,vn+"_worker",Yt);this._messageHandler=Wn,this._readyCapability.resolve(),Wn.send("configure",{verbosity:this.verbosity})}).catch(hn=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${hn.message}".`))})}destroy(){var hn;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(hn=It(_PDFWorker,Lt))==null||hn.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(hn){var vn;if(!(hn!=null&&hn.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const Yt=(vn=It(this,Lt))==null?void 0:vn.get(hn.port);if(Yt){if(Yt._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return Yt}return new _PDFWorker(hn)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var hn;try{return((hn=globalThis.pdfjsWorker)==null?void 0:hn.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};Lt=new WeakMap,Bn(_PDFWorker,Lt,void 0);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(Yt,vn,fn,Wn,Xn){Bn(this,tn);Bn(this,Mt,new Map);Bn(this,Qt,new Map);Bn(this,Jt,new Map);Bn(this,sn,null);this.messageHandler=Yt,this.loadingTask=vn,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:Wn.ownerDocument,styleElement:Wn.styleElement}),this._params=Wn,this.canvasFactory=Xn.canvasFactory,this.filterFactory=Xn.filterFactory,this.cMapReaderFactory=Xn.cMapReaderFactory,this.standardFontDataFactory=Xn.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=fn,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(Yt,vn=_util.AnnotationMode.ENABLE,fn=null,Wn=!1){let Xn=_util.RenderingIntentFlag.DISPLAY,Sn=_annotation_storage.SerializableEmpty;switch(Yt){case"any":Xn=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Xn=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${Yt}`)}switch(vn){case _util.AnnotationMode.DISABLE:Xn+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Xn+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Xn+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,Sn=(Xn&_util.RenderingIntentFlag.PRINT&&fn instanceof _annotation_storage.PrintAnnotationStorage?fn:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${vn}`)}return Wn&&(Xn+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Xn,cacheKey:`${Xn}_${Sn.hash}`,annotationStorageSerializable:Sn}}destroy(){var fn;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(fn=It(this,sn))==null||fn.reject(new Error("Worker was destroyed during onPassword callback"));const Yt=[];for(const Wn of It(this,Qt).values())Yt.push(Wn._destroy());It(this,Qt).clear(),It(this,Jt).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const vn=this.messageHandler.sendWithPromise("Terminate",null);return Yt.push(vn),Promise.all(Yt).then(()=>{var Wn;this.commonObjs.clear(),this.fontLoader.clear(),It(this,Mt).clear(),this.filterFactory.destroy(),(Wn=this._networkStream)==null||Wn.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:Yt,loadingTask:vn}=this;Yt.on("GetReader",(fn,Wn)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Xn=>{this._lastProgress={loaded:Xn.loaded,total:Xn.total}},Wn.onPull=()=>{this._fullReader.read().then(function({value:Xn,done:Sn}){if(Sn){Wn.close();return}(0,_util.assert)(Xn instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),Wn.enqueue(new Uint8Array(Xn),1,[Xn])}).catch(Xn=>{Wn.error(Xn)})},Wn.onCancel=Xn=>{this._fullReader.cancel(Xn),Wn.ready.catch(Sn=>{if(!this.destroyed)throw Sn})}}),Yt.on("ReaderHeadersReady",fn=>{const Wn=new _util.PromiseCapability,Xn=this._fullReader;return Xn.headersReady.then(()=>{var Sn;(!Xn.isStreamingSupported||!Xn.isRangeSupported)&&(this._lastProgress&&((Sn=vn.onProgress)==null||Sn.call(vn,this._lastProgress)),Xn.onProgress=_i=>{var gr;(gr=vn.onProgress)==null||gr.call(vn,{loaded:_i.loaded,total:_i.total})}),Wn.resolve({isStreamingSupported:Xn.isStreamingSupported,isRangeSupported:Xn.isRangeSupported,contentLength:Xn.contentLength})},Wn.reject),Wn.promise}),Yt.on("GetRangeReader",(fn,Wn)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Xn=this._networkStream.getRangeReader(fn.begin,fn.end);if(!Xn){Wn.close();return}Wn.onPull=()=>{Xn.read().then(function({value:Sn,done:_i}){if(_i){Wn.close();return}(0,_util.assert)(Sn instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),Wn.enqueue(new Uint8Array(Sn),1,[Sn])}).catch(Sn=>{Wn.error(Sn)})},Wn.onCancel=Sn=>{Xn.cancel(Sn),Wn.ready.catch(_i=>{if(!this.destroyed)throw _i})}}),Yt.on("GetDoc",({pdfInfo:fn})=>{this._numPages=fn.numPages,this._htmlForXfa=fn.htmlForXfa,delete fn.htmlForXfa,vn._capability.resolve(new PDFDocumentProxy(fn,this))}),Yt.on("DocException",function(fn){let Wn;switch(fn.name){case"PasswordException":Wn=new _util.PasswordException(fn.message,fn.code);break;case"InvalidPDFException":Wn=new _util.InvalidPDFException(fn.message);break;case"MissingPDFException":Wn=new _util.MissingPDFException(fn.message);break;case"UnexpectedResponseException":Wn=new _util.UnexpectedResponseException(fn.message,fn.status);break;case"UnknownErrorException":Wn=new _util.UnknownErrorException(fn.message,fn.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}vn._capability.reject(Wn)}),Yt.on("PasswordRequest",fn=>{if(yr(this,sn,new _util.PromiseCapability),vn.onPassword){const Wn=Xn=>{Xn instanceof Error?It(this,sn).reject(Xn):It(this,sn).resolve({password:Xn})};try{vn.onPassword(Wn,fn.code)}catch(Xn){It(this,sn).reject(Xn)}}else It(this,sn).reject(new _util.PasswordException(fn.message,fn.code));return It(this,sn).promise}),Yt.on("DataLoaded",fn=>{var Wn;(Wn=vn.onProgress)==null||Wn.call(vn,{loaded:fn.length,total:fn.length}),this.downloadInfoCapability.resolve(fn)}),Yt.on("StartRenderPage",fn=>{if(this.destroyed)return;It(this,Qt).get(fn.pageIndex)._startRenderPage(fn.transparency,fn.cacheKey)}),Yt.on("commonobj",([fn,Wn,Xn])=>{var Sn;if(!this.destroyed&&!this.commonObjs.has(fn))switch(Wn){case"Font":const _i=this._params;if("error"in Xn){const Pn=Xn.error;(0,_util.warn)(`Error during font loading: ${Pn}`),this.commonObjs.resolve(fn,Pn);break}const gr=_i.pdfBug&&((Sn=globalThis.FontInspector)!=null&&Sn.enabled)?(Pn,lr)=>globalThis.FontInspector.fontAdded(Pn,lr):null,br=new _font_loader.FontFaceObject(Xn,{isEvalSupported:_i.isEvalSupported,disableFontFace:_i.disableFontFace,ignoreErrors:_i.ignoreErrors,inspectFont:gr});this.fontLoader.bind(br).catch(Pn=>Yt.sendWithPromise("FontFallback",{id:fn})).finally(()=>{!_i.fontExtraProperties&&br.data&&(br.data=null),this.commonObjs.resolve(fn,br)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(fn,Xn);break;default:throw new Error(`Got unknown common object type ${Wn}`)}}),Yt.on("obj",([fn,Wn,Xn,Sn])=>{var gr;if(this.destroyed)return;const _i=It(this,Qt).get(Wn);if(!_i.objs.has(fn))switch(Xn){case"Image":if(_i.objs.resolve(fn,Sn),Sn){let br;if(Sn.bitmap){const{width:Pn,height:lr}=Sn;br=Pn*lr*4}else br=((gr=Sn.data)==null?void 0:gr.length)||0;br>_util.MAX_IMAGE_SIZE_TO_CACHE&&(_i._maybeCleanupAfterRender=!0)}break;case"Pattern":_i.objs.resolve(fn,Sn);break;default:throw new Error(`Got unknown object type ${Xn}`)}}),Yt.on("DocProgress",fn=>{var Wn;this.destroyed||(Wn=vn.onProgress)==null||Wn.call(vn,{loaded:fn.loaded,total:fn.total})}),Yt.on("FetchBuiltInCMap",fn=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(fn):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),Yt.on("FetchStandardFontData",fn=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(fn):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var fn;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:Yt,transfers:vn}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:Yt,filename:((fn=this._fullReader)==null?void 0:fn.filename)??null},vn).finally(()=>{this.annotationStorage.resetModified()})}getPage(Yt){if(!Number.isInteger(Yt)||Yt<=0||Yt>this._numPages)return Promise.reject(new Error("Invalid page request."));const vn=Yt-1,fn=It(this,Jt).get(vn);if(fn)return fn;const Wn=this.messageHandler.sendWithPromise("GetPage",{pageIndex:vn}).then(Xn=>{if(this.destroyed)throw new Error("Transport destroyed");const Sn=new PDFPageProxy(vn,Xn,this,this._params.pdfBug);return It(this,Qt).set(vn,Sn),Sn});return It(this,Jt).set(vn,Wn),Wn}getPageIndex(Yt){return typeof Yt!="object"||Yt===null||!Number.isInteger(Yt.num)||Yt.num<0||!Number.isInteger(Yt.gen)||Yt.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:Yt.num,gen:Yt.gen})}getAnnotations(Yt,vn){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:Yt,intent:vn})}getFieldObjects(){return nr(this,tn,Ny).call(this,"GetFieldObjects")}hasJSActions(){return nr(this,tn,Ny).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(Yt){return typeof Yt!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:Yt})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return nr(this,tn,Ny).call(this,"GetDocJSActions")}getPageJSActions(Yt){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:Yt})}getStructTree(Yt){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:Yt})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(Yt=>new _optional_content_config.OptionalContentConfig(Yt))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const Yt="GetMetadata",vn=It(this,Mt).get(Yt);if(vn)return vn;const fn=this.messageHandler.sendWithPromise(Yt,null).then(Wn=>{var Xn,Sn;return{info:Wn[0],metadata:Wn[1]?new _metadata.Metadata(Wn[1]):null,contentDispositionFilename:((Xn=this._fullReader)==null?void 0:Xn.filename)??null,contentLength:((Sn=this._fullReader)==null?void 0:Sn.contentLength)??null}});return It(this,Mt).set(Yt,fn),fn}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(Yt=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const vn of It(this,Qt).values())if(!vn.cleanup())throw new Error(`startCleanup: Page ${vn.pageNumber} is currently rendering.`);this.commonObjs.clear(),Yt||this.fontLoader.clear(),It(this,Mt).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:Yt,enableXfa:vn}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:Yt,enableXfa:vn})}}Mt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,sn=new WeakMap,tn=new WeakSet,Ny=function(Yt,vn=null){const fn=It(this,Mt).get(Yt);if(fn)return fn;const Wn=this.messageHandler.sendWithPromise(Yt,vn);return It(this,Mt).set(Yt,Wn),Wn};class PDFObjects{constructor(){Bn(this,Ht);Bn(this,zt,Object.create(null))}get(Yt,vn=null){if(vn){const Wn=nr(this,Ht,Z0).call(this,Yt);return Wn.capability.promise.then(()=>vn(Wn.data)),null}const fn=It(this,zt)[Yt];if(!(fn!=null&&fn.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${Yt}.`);return fn.data}has(Yt){const vn=It(this,zt)[Yt];return(vn==null?void 0:vn.capability.settled)||!1}resolve(Yt,vn=null){const fn=nr(this,Ht,Z0).call(this,Yt);fn.data=vn,fn.capability.resolve()}clear(){var Yt;for(const vn in It(this,zt)){const{data:fn}=It(this,zt)[vn];(Yt=fn==null?void 0:fn.bitmap)==null||Yt.close()}yr(this,zt,Object.create(null))}}zt=new WeakMap,Ht=new WeakSet,Z0=function(Yt){var vn;return(vn=It(this,zt))[Yt]||(vn[Yt]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(Yt){Bn(this,Ot,null);yr(this,Ot,Yt),this.onContinue=null}get promise(){return It(this,Ot).capability.promise}cancel(Yt=0){It(this,Ot).cancel(null,Yt)}get separateAnnots(){const{separateAnnots:Yt}=It(this,Ot).operatorList;if(!Yt)return!1;const{annotationCanvasMap:vn}=It(this,Ot);return Yt.form||Yt.canvas&&(vn==null?void 0:vn.size)>0}}Ot=new WeakMap,exports.RenderTask=RenderTask;const mn=class mn{constructor({callback:Yt,params:vn,objs:fn,commonObjs:Wn,annotationCanvasMap:Xn,operatorList:Sn,pageIndex:_i,canvasFactory:gr,filterFactory:br,useRequestAnimationFrame:Pn=!1,pdfBug:lr=!1,pageColors:xr=null}){this.callback=Yt,this.params=vn,this.objs=fn,this.commonObjs=Wn,this.annotationCanvasMap=Xn,this.operatorListIdx=null,this.operatorList=Sn,this._pageIndex=_i,this.canvasFactory=gr,this.filterFactory=br,this._pdfBug=lr,this.pageColors=xr,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Pn===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=vn.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:Yt=!1,optionalContentConfig:vn}){var _i,gr;if(this.cancelled)return;if(this._canvas){if(It(mn,Kt).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");It(mn,Kt).add(this._canvas)}this._pdfBug&&((_i=globalThis.StepperManager)!=null&&_i.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:fn,viewport:Wn,transform:Xn,background:Sn}=this.params;this.gfx=new _canvas.CanvasGraphics(fn,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:vn},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Xn,viewport:Wn,transparency:Yt,background:Sn}),this.operatorListIdx=0,this.graphicsReady=!0,(gr=this.graphicsReadyCallback)==null||gr.call(this)}cancel(Yt=null,vn=0){var fn;this.running=!1,this.cancelled=!0,(fn=this.gfx)==null||fn.endDrawing(),It(mn,Kt).delete(this._canvas),this.callback(Yt||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,vn))}operatorListChanged(){var Yt;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(Yt=this.stepper)==null||Yt.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),It(mn,Kt).delete(this._canvas),this.callback())))}};Kt=new WeakMap,Bn(mn,Kt,new WeakSet);let InternalRenderTask=mn;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(_e,et,rt)=>{var Pt,kt,Lt,h1,Qt;Object.defineProperty(et,"__esModule",{value:!0}),et.SerializableEmpty=et.PrintAnnotationStorage=et.AnnotationStorage=void 0;var at=rt(1),ut=rt(4),pt=rt(8);const yt=Object.freeze({map:null,hash:"",transfers:void 0});et.SerializableEmpty=yt;class ct{constructor(){Bn(this,Lt);Bn(this,Pt,!1);Bn(this,kt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(sn,tn){const Bt=It(this,kt).get(sn);return Bt===void 0?tn:Object.assign(tn,Bt)}getRawValue(sn){return It(this,kt).get(sn)}remove(sn){if(It(this,kt).delete(sn),It(this,kt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const tn of It(this,kt).values())if(tn instanceof ut.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(sn,tn){const Bt=It(this,kt).get(sn);let zt=!1;if(Bt!==void 0)for(const[Ht,nn]of Object.entries(tn))Bt[Ht]!==nn&&(zt=!0,Bt[Ht]=nn);else zt=!0,It(this,kt).set(sn,tn);zt&&nr(this,Lt,h1).call(this),tn instanceof ut.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(tn.constructor._type)}has(sn){return It(this,kt).has(sn)}getAll(){return It(this,kt).size>0?(0,at.objectFromMap)(It(this,kt)):null}setAll(sn){for(const[tn,Bt]of Object.entries(sn))this.setValue(tn,Bt)}get size(){return It(this,kt).size}resetModified(){It(this,Pt)&&(yr(this,Pt,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new At(this)}get serializable(){if(It(this,kt).size===0)return yt;const sn=new Map,tn=new pt.MurmurHash3_64,Bt=[],zt=Object.create(null);let Ht=!1;for(const[nn,Ot]of It(this,kt)){const Kt=Ot instanceof ut.AnnotationEditor?Ot.serialize(!1,zt):Ot;Kt&&(sn.set(nn,Kt),tn.update(`${nn}:${JSON.stringify(Kt)}`),Ht||(Ht=!!Kt.bitmap))}if(Ht)for(const nn of sn.values())nn.bitmap&&Bt.push(nn.bitmap);return sn.size>0?{map:sn,hash:tn.hexdigest(),transfers:Bt}:yt}}Pt=new WeakMap,kt=new WeakMap,Lt=new WeakSet,h1=function(){It(this,Pt)||(yr(this,Pt,!0),typeof this.onSetModified=="function"&&this.onSetModified())},et.AnnotationStorage=ct;class At extends ct{constructor(tn){super();Bn(this,Qt,void 0);const{map:Bt,hash:zt,transfers:Ht}=tn.serializable,nn=structuredClone(Bt,Ht?{transfer:Ht}:null);yr(this,Qt,{map:nn,hash:zt,transfers:Ht})}get print(){(0,at.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return It(this,Qt)}}Qt=new WeakMap,et.PrintAnnotationStorage=At},(_e,et,rt)=>{var At,Pt,kt,Lt,Mt,Qt,Jt,sn,tn,Bt,zt,Ht,nn,Ot,Kt,K0,hn,Y0,vn,J0,Wn,Q0,Sn,d1,gr,p1,Pn,f1,xr,ev,$r,m1;Object.defineProperty(et,"__esModule",{value:!0}),et.AnnotationEditor=void 0;var at=rt(5),ut=rt(1),pt=rt(6);const Nt=class Nt{constructor($t){Bn(this,Kt);Bn(this,hn);Bn(this,Wn);Bn(this,Sn);Bn(this,gr);Bn(this,Pn);Bn(this,xr);Bn(this,$r);Bn(this,At,"");Bn(this,Pt,!1);Bn(this,kt,null);Bn(this,Lt,null);Bn(this,Mt,null);Bn(this,Qt,!1);Bn(this,Jt,null);Bn(this,sn,this.focusin.bind(this));Bn(this,tn,this.focusout.bind(this));Bn(this,Bt,!1);Bn(this,zt,!1);Bn(this,Ht,!1);$o(this,"_initialOptions",Object.create(null));$o(this,"_uiManager",null);$o(this,"_focusEventsAllowed",!0);$o(this,"_l10nPromise",null);Bn(this,nn,!1);Bn(this,Ot,Nt._zIndex++);this.constructor===Nt&&(0,ut.unreachable)("Cannot initialize AnnotationEditor."),this.parent=$t.parent,this.id=$t.id,this.width=this.height=null,this.pageIndex=$t.parent.pageIndex,this.name=$t.name,this.div=null,this._uiManager=$t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=$t.isCentered,this._structTreeParentId=null;const{rotation:rn,rawDims:{pageWidth:an,pageHeight:En,pageX:Mn,pageY:jn}}=this.parent.viewport;this.rotation=rn,this.pageRotation=(360+rn-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[an,En],this.pageTranslation=[Mn,jn];const[dr,cr]=this.parentDimensions;this.x=$t.x/dr,this.y=$t.y/cr,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,ut.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement($t){const rn=new ct({id:$t.parent.getNextId(),parent:$t.parent,uiManager:$t._uiManager});rn.annotationElementId=$t.annotationElementId,rn.deleted=!0,rn._uiManager.addToAnnotationStorage(rn)}static initialize($t,rn=null){if(Nt._l10nPromise||(Nt._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(En=>[En,$t.get(En)]))),rn!=null&&rn.strings)for(const En of rn.strings)Nt._l10nPromise.set(En,$t.get(En));if(Nt._borderLineWidth!==-1)return;const an=getComputedStyle(document.documentElement);Nt._borderLineWidth=parseFloat(an.getPropertyValue("--outline-width"))||0}static updateDefaultParams($t,rn){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting($t){return!1}static paste($t,rn){(0,ut.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return It(this,nn)}set _isDraggable($t){var rn;yr(this,nn,$t),(rn=this.div)==null||rn.classList.toggle("draggable",$t)}center(){const[$t,rn]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*rn/($t*2),this.y+=this.width*$t/(rn*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*rn/($t*2),this.y-=this.width*$t/(rn*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands($t){this._uiManager.addCommands($t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=It(this,Ot)}setParent($t){$t!==null&&(this.pageIndex=$t.pageIndex,this.pageDimensions=$t.pageDimensions),this.parent=$t}focusin($t){this._focusEventsAllowed&&(It(this,Bt)?yr(this,Bt,!1):this.parent.setSelected(this))}focusout($t){var an;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const rn=$t.relatedTarget;rn!=null&&rn.closest(`#${this.id}`)||($t.preventDefault(),(an=this.parent)!=null&&an.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt($t,rn,an,En){const[Mn,jn]=this.parentDimensions;[an,En]=this.screenToPageTranslation(an,En),this.x=($t+an)/Mn,this.y=(rn+En)/jn,this.fixAndSetPosition()}translate($t,rn){nr(this,Kt,K0).call(this,this.parentDimensions,$t,rn)}translateInPage($t,rn){nr(this,Kt,K0).call(this,this.pageDimensions,$t,rn),this.div.scrollIntoView({block:"nearest"})}drag($t,rn){const[an,En]=this.parentDimensions;if(this.x+=$t/an,this.y+=rn/En,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:wr,y:Rr}=this.div.getBoundingClientRect();this.parent.findNewParent(this,wr,Rr)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:Mn,y:jn}=this;const[dr,cr]=nr(this,hn,Y0).call(this);Mn+=dr,jn+=cr,this.div.style.left=`${(100*Mn).toFixed(2)}%`,this.div.style.top=`${(100*jn).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[$t,rn]=this.pageDimensions;let{x:an,y:En,width:Mn,height:jn}=this;switch(Mn*=$t,jn*=rn,an*=$t,En*=rn,this.rotation){case 0:an=Math.max(0,Math.min($t-Mn,an)),En=Math.max(0,Math.min(rn-jn,En));break;case 90:an=Math.max(0,Math.min($t-jn,an)),En=Math.min(rn,Math.max(Mn,En));break;case 180:an=Math.min($t,Math.max(Mn,an)),En=Math.min(rn,Math.max(jn,En));break;case 270:an=Math.min($t,Math.max(jn,an)),En=Math.max(0,Math.min(rn-Mn,En));break}this.x=an/=$t,this.y=En/=rn;const[dr,cr]=nr(this,hn,Y0).call(this);an+=dr,En+=cr;const{style:wr}=this.div;wr.left=`${(100*an).toFixed(2)}%`,wr.top=`${(100*En).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation($t,rn){var an;return nr(an=Nt,vn,J0).call(an,$t,rn,this.parentRotation)}pageTranslationToScreen($t,rn){var an;return nr(an=Nt,vn,J0).call(an,$t,rn,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:$t,pageDimensions:[rn,an]}=this,En=rn*$t,Mn=an*$t;return ut.FeatureTest.isCSSRoundSupported?[Math.round(En),Math.round(Mn)]:[En,Mn]}setDims($t,rn){var Mn;const[an,En]=this.parentDimensions;this.div.style.width=`${(100*$t/an).toFixed(2)}%`,It(this,Qt)||(this.div.style.height=`${(100*rn/En).toFixed(2)}%`),(Mn=It(this,kt))==null||Mn.classList.toggle("small",$t<Nt.SMALL_EDITOR_SIZE||rn<Nt.SMALL_EDITOR_SIZE)}fixDims(){const{style:$t}=this.div,{height:rn,width:an}=$t,En=an.endsWith("%"),Mn=!It(this,Qt)&&rn.endsWith("%");if(En&&Mn)return;const[jn,dr]=this.parentDimensions;En||($t.width=`${(100*parseFloat(an)/jn).toFixed(2)}%`),!It(this,Qt)&&!Mn&&($t.height=`${(100*parseFloat(rn)/dr).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(It(this,kt))return;const $t=yr(this,kt,document.createElement("button"));$t.className="altText";const rn=await Nt._l10nPromise.get("editor_alt_text_button_label");$t.textContent=rn,$t.setAttribute("aria-label",rn),$t.tabIndex="0",$t.addEventListener("contextmenu",pt.noContextMenu),$t.addEventListener("pointerdown",an=>an.stopPropagation()),$t.addEventListener("click",an=>{an.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),$t.addEventListener("keydown",an=>{an.target===$t&&an.key==="Enter"&&(an.preventDefault(),this._uiManager.editAltText(this))}),nr(this,xr,ev).call(this),this.div.append($t),Nt.SMALL_EDITOR_SIZE||(Nt.SMALL_EDITOR_SIZE=Math.min(128,Math.round($t.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:It(this,At),decorative:It(this,Pt)}}set altTextData({altText:$t,decorative:rn}){It(this,At)===$t&&It(this,Pt)===rn||(yr(this,At,$t),yr(this,Pt,rn),nr(this,xr,ev).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",It(this,sn)),this.div.addEventListener("focusout",It(this,tn));const[$t,rn]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*rn/$t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*$t/rn).toFixed(2)}%`);const[an,En]=this.getInitialTranslation();return this.translate(an,En),(0,at.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown($t){const{isMac:rn}=ut.FeatureTest.platform;if($t.button!==0||$t.ctrlKey&&rn){$t.preventDefault();return}yr(this,Bt,!0),nr(this,$r,m1).call(this,$t)}moveInDOM(){var $t;($t=this.parent)==null||$t.moveEditorInDOM(this)}_setParentAndPosition($t,rn,an){$t.changeParent(this),this.x=rn,this.y=an,this.fixAndSetPosition()}getRect($t,rn){const an=this.parentScale,[En,Mn]=this.pageDimensions,[jn,dr]=this.pageTranslation,cr=$t/an,wr=rn/an,Rr=this.x*En,On=this.y*Mn,Mr=this.width*En,ts=this.height*Mn;switch(this.rotation){case 0:return[Rr+cr+jn,Mn-On-wr-ts+dr,Rr+cr+Mr+jn,Mn-On-wr+dr];case 90:return[Rr+wr+jn,Mn-On+cr+dr,Rr+wr+ts+jn,Mn-On+cr+Mr+dr];case 180:return[Rr-cr-Mr+jn,Mn-On+wr+dr,Rr-cr+jn,Mn-On+wr+ts+dr];case 270:return[Rr-wr-ts+jn,Mn-On-cr-Mr+dr,Rr-wr+jn,Mn-On-cr+dr];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords($t,rn){const[an,En,Mn,jn]=$t,dr=Mn-an,cr=jn-En;switch(this.rotation){case 0:return[an,rn-jn,dr,cr];case 90:return[an,rn-En,cr,dr];case 180:return[Mn,rn-En,dr,cr];case 270:return[Mn,rn-jn,cr,dr];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){yr(this,Ht,!0)}disableEditMode(){yr(this,Ht,!1)}isInEditMode(){return It(this,Ht)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var $t,rn;($t=this.div)==null||$t.addEventListener("focusin",It(this,sn)),(rn=this.div)==null||rn.addEventListener("focusout",It(this,tn))}serialize($t=!1,rn=null){(0,ut.unreachable)("An editor must be serializable")}static deserialize($t,rn,an){const En=new this.prototype.constructor({parent:rn,id:rn.getNextId(),uiManager:an});En.rotation=$t.rotation;const[Mn,jn]=En.pageDimensions,[dr,cr,wr,Rr]=En.getRectInCurrentCoords($t.rect,jn);return En.x=dr/Mn,En.y=cr/jn,En.width=wr/Mn,En.height=Rr/jn,En}remove(){var $t;this.div.removeEventListener("focusin",It(this,sn)),this.div.removeEventListener("focusout",It(this,tn)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),($t=It(this,kt))==null||$t.remove(),yr(this,kt,null),yr(this,Lt,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(nr(this,Sn,d1).call(this),It(this,Jt).classList.remove("hidden"))}select(){var $t;this.makeResizable(),($t=this.div)==null||$t.classList.add("selectedEditor")}unselect(){var $t,rn,an;($t=It(this,Jt))==null||$t.classList.add("hidden"),(rn=this.div)==null||rn.classList.remove("selectedEditor"),(an=this.div)!=null&&an.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams($t,rn){}disableEditing(){It(this,kt)&&(It(this,kt).hidden=!0)}enableEditing(){It(this,kt)&&(It(this,kt).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return It(this,zt)}set isEditing($t){yr(this,zt,$t),this.parent&&($t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio($t,rn){yr(this,Qt,!0);const an=$t/rn,{style:En}=this.div;En.aspectRatio=an,En.height="auto"}static get MIN_SIZE(){return 16}};At=new WeakMap,Pt=new WeakMap,kt=new WeakMap,Lt=new WeakMap,Mt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,sn=new WeakMap,tn=new WeakMap,Bt=new WeakMap,zt=new WeakMap,Ht=new WeakMap,nn=new WeakMap,Ot=new WeakMap,Kt=new WeakSet,K0=function([$t,rn],an,En){[an,En]=this.screenToPageTranslation(an,En),this.x+=an/$t,this.y+=En/rn,this.fixAndSetPosition()},hn=new WeakSet,Y0=function(){const[$t,rn]=this.parentDimensions,{_borderLineWidth:an}=Nt,En=an/$t,Mn=an/rn;switch(this.rotation){case 90:return[-En,Mn];case 180:return[En,Mn];case 270:return[En,-Mn];default:return[-En,-Mn]}},vn=new WeakSet,J0=function($t,rn,an){switch(an){case 90:return[rn,-$t];case 180:return[-$t,-rn];case 270:return[-rn,$t];default:return[$t,rn]}},Wn=new WeakSet,Q0=function($t){switch($t){case 90:{const[rn,an]=this.pageDimensions;return[0,-rn/an,an/rn,0]}case 180:return[-1,0,0,-1];case 270:{const[rn,an]=this.pageDimensions;return[0,rn/an,-an/rn,0]}default:return[1,0,0,1]}},Sn=new WeakSet,d1=function(){if(It(this,Jt))return;yr(this,Jt,document.createElement("div")),It(this,Jt).classList.add("resizers");const $t=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||$t.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const rn of $t){const an=document.createElement("div");It(this,Jt).append(an),an.classList.add("resizer",rn),an.addEventListener("pointerdown",nr(this,gr,p1).bind(this,rn)),an.addEventListener("contextmenu",pt.noContextMenu)}this.div.prepend(It(this,Jt))},gr=new WeakSet,p1=function($t,rn){rn.preventDefault();const{isMac:an}=ut.FeatureTest.platform;if(rn.button!==0||rn.ctrlKey&&an)return;const En=nr(this,Pn,f1).bind(this,$t),Mn=this._isDraggable;this._isDraggable=!1;const jn={passive:!0,capture:!0};window.addEventListener("pointermove",En,jn);const dr=this.x,cr=this.y,wr=this.width,Rr=this.height,On=this.parent.div.style.cursor,Mr=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(rn.target).cursor;const ts=()=>{this._isDraggable=Mn,window.removeEventListener("pointerup",ts),window.removeEventListener("blur",ts),window.removeEventListener("pointermove",En,jn),this.parent.div.style.cursor=On,this.div.style.cursor=Mr;const Jr=this.x,jr=this.y,ss=this.width,Lr=this.height;Jr===dr&&jr===cr&&ss===wr&&Lr===Rr||this.addCommands({cmd:()=>{this.width=ss,this.height=Lr,this.x=Jr,this.y=jr;const[hr,or]=this.parentDimensions;this.setDims(hr*ss,or*Lr),this.fixAndSetPosition()},undo:()=>{this.width=wr,this.height=Rr,this.x=dr,this.y=cr;const[hr,or]=this.parentDimensions;this.setDims(hr*wr,or*Rr),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",ts),window.addEventListener("blur",ts)},Pn=new WeakSet,f1=function($t,rn){const[an,En]=this.parentDimensions,Mn=this.x,jn=this.y,dr=this.width,cr=this.height,wr=Nt.MIN_SIZE/an,Rr=Nt.MIN_SIZE/En,On=Er=>Math.round(Er*1e4)/1e4,Mr=nr(this,Wn,Q0).call(this,this.rotation),ts=(Er,kr)=>[Mr[0]*Er+Mr[2]*kr,Mr[1]*Er+Mr[3]*kr],Jr=nr(this,Wn,Q0).call(this,360-this.rotation),jr=(Er,kr)=>[Jr[0]*Er+Jr[2]*kr,Jr[1]*Er+Jr[3]*kr];let ss,Lr,hr=!1,or=!1;switch($t){case"topLeft":hr=!0,ss=(Er,kr)=>[0,0],Lr=(Er,kr)=>[Er,kr];break;case"topMiddle":ss=(Er,kr)=>[Er/2,0],Lr=(Er,kr)=>[Er/2,kr];break;case"topRight":hr=!0,ss=(Er,kr)=>[Er,0],Lr=(Er,kr)=>[0,kr];break;case"middleRight":or=!0,ss=(Er,kr)=>[Er,kr/2],Lr=(Er,kr)=>[0,kr/2];break;case"bottomRight":hr=!0,ss=(Er,kr)=>[Er,kr],Lr=(Er,kr)=>[0,0];break;case"bottomMiddle":ss=(Er,kr)=>[Er/2,kr],Lr=(Er,kr)=>[Er/2,0];break;case"bottomLeft":hr=!0,ss=(Er,kr)=>[0,kr],Lr=(Er,kr)=>[Er,0];break;case"middleLeft":or=!0,ss=(Er,kr)=>[0,kr/2],Lr=(Er,kr)=>[Er,kr/2];break}const Tr=ss(dr,cr),Zr=Lr(dr,cr);let qr=ts(...Zr);const Cr=On(Mn+qr[0]),ws=On(jn+qr[1]);let ds=1,Ts=1,[Ms,Pr]=this.screenToPageTranslation(rn.movementX,rn.movementY);if([Ms,Pr]=jr(Ms/an,Pr/En),hr){const Er=Math.hypot(dr,cr);ds=Ts=Math.max(Math.min(Math.hypot(Zr[0]-Tr[0]-Ms,Zr[1]-Tr[1]-Pr)/Er,1/dr,1/cr),wr/dr,Rr/cr)}else or?ds=Math.max(wr,Math.min(1,Math.abs(Zr[0]-Tr[0]-Ms)))/dr:Ts=Math.max(Rr,Math.min(1,Math.abs(Zr[1]-Tr[1]-Pr)))/cr;const ns=On(dr*ds),tr=On(cr*Ts);qr=ts(...Lr(ns,tr));const Yn=Cr-qr[0],qn=ws-qr[1];this.width=ns,this.height=tr,this.x=Yn,this.y=qn,this.setDims(an*ns,En*tr),this.fixAndSetPosition()},xr=new WeakSet,ev=async function(){var an;const $t=It(this,kt);if(!$t)return;if(!It(this,At)&&!It(this,Pt)){$t.classList.remove("done"),(an=It(this,Lt))==null||an.remove();return}Nt._l10nPromise.get("editor_alt_text_edit_button_label").then(En=>{$t.setAttribute("aria-label",En)});let rn=It(this,Lt);if(!rn){yr(this,Lt,rn=document.createElement("span")),rn.className="tooltip",rn.setAttribute("role","tooltip");const En=rn.id=`alt-text-tooltip-${this.id}`;$t.setAttribute("aria-describedby",En);const Mn=100;$t.addEventListener("mouseenter",()=>{yr(this,Mt,setTimeout(()=>{yr(this,Mt,null),It(this,Lt).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},Mn))}),$t.addEventListener("mouseleave",()=>{var jn;clearTimeout(It(this,Mt)),yr(this,Mt,null),(jn=It(this,Lt))==null||jn.classList.remove("show")})}$t.classList.add("done"),rn.innerText=It(this,Pt)?await Nt._l10nPromise.get("editor_alt_text_decorative_tooltip"):It(this,At),rn.parentNode||$t.append(rn)},$r=new WeakSet,m1=function($t){if(!this._isDraggable)return;const rn=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let an,En;rn&&(an={passive:!0,capture:!0},En=jn=>{const[dr,cr]=this.screenToPageTranslation(jn.movementX,jn.movementY);this._uiManager.dragSelectedEditors(dr,cr)},window.addEventListener("pointermove",En,an));const Mn=()=>{if(window.removeEventListener("pointerup",Mn),window.removeEventListener("blur",Mn),rn&&window.removeEventListener("pointermove",En,an),yr(this,Bt,!1),!this._uiManager.endDragSession()){const{isMac:jn}=ut.FeatureTest.platform;$t.ctrlKey&&!jn||$t.shiftKey||$t.metaKey&&jn?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",Mn),window.addEventListener("blur",Mn)},Bn(Nt,vn),$o(Nt,"_borderLineWidth",-1),$o(Nt,"_colorManager",new at.ColorManager),$o(Nt,"_zIndex",1),$o(Nt,"SMALL_EDITOR_SIZE",0);let yt=Nt;et.AnnotationEditor=yt;class ct extends yt{constructor($t){super($t),this.annotationElementId=$t.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(_e,et,rt)=>{var Qt,Jt,sn,tn,Bt,tv,nn,Ot,Kt,mn,hn,g1,fn,Wn,Xn,Sn,_i,gr,br,Pn,lr,xr,Dr,$r,An,Nt,Zt,$t,rn,an,En,Mn,jn,dr,cr,wr,Rr,On,Mr,ts,Jr,jr,ss,Lr,hr,or,Tr,_1,qr,nv,ws,iv,Ts,By,Pr,rv,tr,sv,qn,Xu,kr,ey,lo,y1,_n,v1,jt,ov,xn,ty,Tn,av;Object.defineProperty(et,"__esModule",{value:!0}),et.KeyboardManager=et.CommandManager=et.ColorManager=et.AnnotationEditorUIManager=void 0,et.bindEvents=pt,et.opacityToHex=yt;var at=rt(1),ut=rt(6);function pt(un,Rt,qt){for(const yn of qt)Rt.addEventListener(yn,un[yn].bind(un))}function yt(un){return Math.round(Math.min(255,Math.max(1,255*un))).toString(16).padStart(2,"0")}class ct{constructor(){Bn(this,Qt,0)}getId(){return`${at.AnnotationEditorPrefix}${Q_(this,Qt)._++}`}}Qt=new WeakMap;const Ht=class Ht{constructor(){Bn(this,Bt);Bn(this,Jt,(0,at.getUuid)());Bn(this,sn,0);Bn(this,tn,null)}static get _isSVGFittingCanvas(){const Rt='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',yn=new OffscreenCanvas(1,3).getContext("2d"),Rn=new Image;Rn.src=Rt;const zn=Rn.decode().then(()=>(yn.drawImage(Rn,0,0,1,1,0,0,1,3),new Uint32Array(yn.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,at.shadow)(this,"_isSVGFittingCanvas",zn)}async getFromFile(Rt){const{lastModified:qt,name:yn,size:Rn,type:zn}=Rt;return nr(this,Bt,tv).call(this,`${qt}_${yn}_${Rn}_${zn}`,Rt)}async getFromUrl(Rt){return nr(this,Bt,tv).call(this,Rt,Rt)}async getFromId(Rt){It(this,tn)||yr(this,tn,new Map);const qt=It(this,tn).get(Rt);return qt?qt.bitmap?(qt.refCounter+=1,qt):qt.file?this.getFromFile(qt.file):this.getFromUrl(qt.url):null}getSvgUrl(Rt){const qt=It(this,tn).get(Rt);return qt!=null&&qt.isSvg?qt.svgUrl:null}deleteId(Rt){It(this,tn)||yr(this,tn,new Map);const qt=It(this,tn).get(Rt);qt&&(qt.refCounter-=1,qt.refCounter===0&&(qt.bitmap=null))}isValidId(Rt){return Rt.startsWith(`image_${It(this,Jt)}_`)}};Jt=new WeakMap,sn=new WeakMap,tn=new WeakMap,Bt=new WeakSet,tv=async function(Rt,qt){It(this,tn)||yr(this,tn,new Map);let yn=It(this,tn).get(Rt);if(yn===null)return null;if(yn!=null&&yn.bitmap)return yn.refCounter+=1,yn;try{yn||(yn={bitmap:null,id:`image_${It(this,Jt)}_${Q_(this,sn)._++}`,refCounter:0,isSvg:!1});let Rn;if(typeof qt=="string"){yn.url=qt;const zn=await fetch(qt);if(!zn.ok)throw new Error(zn.statusText);Rn=await zn.blob()}else Rn=yn.file=qt;if(Rn.type==="image/svg+xml"){const zn=Ht._isSVGFittingCanvas,ir=new FileReader,Sr=new Image,Nr=new Promise((Fr,ps)=>{Sr.onload=()=>{yn.bitmap=Sr,yn.isSvg=!0,Fr()},ir.onload=async()=>{const Gr=yn.svgUrl=ir.result;Sr.src=await zn?`${Gr}#svgView(preserveAspectRatio(none))`:Gr},Sr.onerror=ir.onerror=ps});ir.readAsDataURL(Rn),await Nr}else yn.bitmap=await createImageBitmap(Rn);yn.refCounter=1}catch(Rn){console.error(Rn),yn=null}return It(this,tn).set(Rt,yn),yn&&It(this,tn).set(yn.id,yn),yn};let At=Ht;class Pt{constructor(Rt=128){Bn(this,nn,[]);Bn(this,Ot,!1);Bn(this,Kt,void 0);Bn(this,mn,-1);yr(this,Kt,Rt)}add({cmd:Rt,undo:qt,mustExec:yn,type:Rn=NaN,overwriteIfSameType:zn=!1,keepUndo:ir=!1}){if(yn&&Rt(),It(this,Ot))return;const Sr={cmd:Rt,undo:qt,type:Rn};if(It(this,mn)===-1){It(this,nn).length>0&&(It(this,nn).length=0),yr(this,mn,0),It(this,nn).push(Sr);return}if(zn&&It(this,nn)[It(this,mn)].type===Rn){ir&&(Sr.undo=It(this,nn)[It(this,mn)].undo),It(this,nn)[It(this,mn)]=Sr;return}const Nr=It(this,mn)+1;Nr===It(this,Kt)?It(this,nn).splice(0,1):(yr(this,mn,Nr),Nr<It(this,nn).length&&It(this,nn).splice(Nr)),It(this,nn).push(Sr)}undo(){It(this,mn)!==-1&&(yr(this,Ot,!0),It(this,nn)[It(this,mn)].undo(),yr(this,Ot,!1),yr(this,mn,It(this,mn)-1))}redo(){It(this,mn)<It(this,nn).length-1&&(yr(this,mn,It(this,mn)+1),yr(this,Ot,!0),It(this,nn)[It(this,mn)].cmd(),yr(this,Ot,!1))}hasSomethingToUndo(){return It(this,mn)!==-1}hasSomethingToRedo(){return It(this,mn)<It(this,nn).length-1}destroy(){yr(this,nn,null)}}nn=new WeakMap,Ot=new WeakMap,Kt=new WeakMap,mn=new WeakMap,et.CommandManager=Pt;class kt{constructor(Rt){Bn(this,hn);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:qt}=at.FeatureTest.platform;for(const[yn,Rn,zn={}]of Rt)for(const ir of yn){const Sr=ir.startsWith("mac+");qt&&Sr?(this.callbacks.set(ir.slice(4),{callback:Rn,options:zn}),this.allKeys.add(ir.split("+").at(-1))):!qt&&!Sr&&(this.callbacks.set(ir,{callback:Rn,options:zn}),this.allKeys.add(ir.split("+").at(-1)))}}exec(Rt,qt){if(!this.allKeys.has(qt.key))return;const yn=this.callbacks.get(nr(this,hn,g1).call(this,qt));if(!yn)return;const{callback:Rn,options:{bubbles:zn=!1,args:ir=[],checker:Sr=null}}=yn;Sr&&!Sr(Rt,qt)||(Rn.bind(Rt,...ir)(),zn||(qt.stopPropagation(),qt.preventDefault()))}}hn=new WeakSet,g1=function(Rt){Rt.altKey&&this.buffer.push("alt"),Rt.ctrlKey&&this.buffer.push("ctrl"),Rt.metaKey&&this.buffer.push("meta"),Rt.shiftKey&&this.buffer.push("shift"),this.buffer.push(Rt.key);const qt=this.buffer.join("+");return this.buffer.length=0,qt},et.KeyboardManager=kt;const vn=class vn{get _colors(){const Rt=new Map([["CanvasText",null],["Canvas",null]]);return(0,ut.getColorValues)(Rt),(0,at.shadow)(this,"_colors",Rt)}convert(Rt){const qt=(0,ut.getRGB)(Rt);if(!window.matchMedia("(forced-colors: active)").matches)return qt;for(const[yn,Rn]of this._colors)if(Rn.every((zn,ir)=>zn===qt[ir]))return vn._colorsMapping.get(yn);return qt}getHexCode(Rt){const qt=this._colors.get(Rt);return qt?at.Util.makeHexColor(...qt):Rt}};$o(vn,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Lt=vn;et.ColorManager=Lt;const Cn=class Cn{constructor(Rt,qt,yn,Rn,zn,ir){Bn(this,Tr);Bn(this,qr);Bn(this,ws);Bn(this,Ts);Bn(this,Pr);Bn(this,tr);Bn(this,qn);Bn(this,kr);Bn(this,lo);Bn(this,_n);Bn(this,jt);Bn(this,xn);Bn(this,Tn);Bn(this,fn,null);Bn(this,Wn,new Map);Bn(this,Xn,new Map);Bn(this,Sn,null);Bn(this,_i,null);Bn(this,gr,new Pt);Bn(this,br,0);Bn(this,Pn,new Set);Bn(this,lr,null);Bn(this,xr,null);Bn(this,Dr,new Set);Bn(this,$r,null);Bn(this,An,new ct);Bn(this,Nt,!1);Bn(this,Zt,!1);Bn(this,$t,null);Bn(this,rn,at.AnnotationEditorType.NONE);Bn(this,an,new Set);Bn(this,En,null);Bn(this,Mn,this.blur.bind(this));Bn(this,jn,this.focus.bind(this));Bn(this,dr,this.copy.bind(this));Bn(this,cr,this.cut.bind(this));Bn(this,wr,this.paste.bind(this));Bn(this,Rr,this.keydown.bind(this));Bn(this,On,this.onEditingAction.bind(this));Bn(this,Mr,this.onPageChanging.bind(this));Bn(this,ts,this.onScaleChanging.bind(this));Bn(this,Jr,this.onRotationChanging.bind(this));Bn(this,jr,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Bn(this,ss,[0,0]);Bn(this,Lr,null);Bn(this,hr,null);Bn(this,or,null);yr(this,hr,Rt),yr(this,or,qt),yr(this,Sn,yn),this._eventBus=Rn,this._eventBus._on("editingaction",It(this,On)),this._eventBus._on("pagechanging",It(this,Mr)),this._eventBus._on("scalechanging",It(this,ts)),this._eventBus._on("rotationchanging",It(this,Jr)),yr(this,_i,zn.annotationStorage),yr(this,$r,zn.filterFactory),yr(this,En,ir),this.viewParameters={realScale:ut.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const Rt=Cn.prototype,qt=zn=>{const{activeElement:ir}=document;return ir&&It(zn,hr).contains(ir)&&zn.hasSomethingToControl()},yn=this.TRANSLATE_SMALL,Rn=this.TRANSLATE_BIG;return(0,at.shadow)(this,"_keyboardManager",new kt([[["ctrl+a","mac+meta+a"],Rt.selectAll],[["ctrl+z","mac+meta+z"],Rt.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],Rt.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],Rt.delete],[["Escape","mac+Escape"],Rt.unselectAll],[["ArrowLeft","mac+ArrowLeft"],Rt.translateSelectedEditors,{args:[-yn,0],checker:qt}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Rt.translateSelectedEditors,{args:[-Rn,0],checker:qt}],[["ArrowRight","mac+ArrowRight"],Rt.translateSelectedEditors,{args:[yn,0],checker:qt}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Rt.translateSelectedEditors,{args:[Rn,0],checker:qt}],[["ArrowUp","mac+ArrowUp"],Rt.translateSelectedEditors,{args:[0,-yn],checker:qt}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Rt.translateSelectedEditors,{args:[0,-Rn],checker:qt}],[["ArrowDown","mac+ArrowDown"],Rt.translateSelectedEditors,{args:[0,yn],checker:qt}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Rt.translateSelectedEditors,{args:[0,Rn],checker:qt}]]))}destroy(){nr(this,Ts,By).call(this),nr(this,qr,nv).call(this),this._eventBus._off("editingaction",It(this,On)),this._eventBus._off("pagechanging",It(this,Mr)),this._eventBus._off("scalechanging",It(this,ts)),this._eventBus._off("rotationchanging",It(this,Jr));for(const Rt of It(this,Xn).values())Rt.destroy();It(this,Xn).clear(),It(this,Wn).clear(),It(this,Dr).clear(),yr(this,fn,null),It(this,an).clear(),It(this,gr).destroy(),It(this,Sn).destroy()}get hcmFilter(){return(0,at.shadow)(this,"hcmFilter",It(this,En)?It(this,$r).addHCMFilter(It(this,En).foreground,It(this,En).background):"none")}get direction(){return(0,at.shadow)(this,"direction",getComputedStyle(It(this,hr)).direction)}editAltText(Rt){var qt;(qt=It(this,Sn))==null||qt.editAltText(this,Rt)}onPageChanging({pageNumber:Rt}){yr(this,br,Rt-1)}focusMainContainer(){It(this,hr).focus()}findParent(Rt,qt){for(const yn of It(this,Xn).values()){const{x:Rn,y:zn,width:ir,height:Sr}=yn.div.getBoundingClientRect();if(Rt>=Rn&&Rt<=Rn+ir&&qt>=zn&&qt<=zn+Sr)return yn}return null}disableUserSelect(Rt=!1){It(this,or).classList.toggle("noUserSelect",Rt)}addShouldRescale(Rt){It(this,Dr).add(Rt)}removeShouldRescale(Rt){It(this,Dr).delete(Rt)}onScaleChanging({scale:Rt}){this.commitOrRemove(),this.viewParameters.realScale=Rt*ut.PixelsPerInch.PDF_TO_CSS_UNITS;for(const qt of It(this,Dr))qt.onScaleChanging()}onRotationChanging({pagesRotation:Rt}){this.commitOrRemove(),this.viewParameters.rotation=Rt}addToAnnotationStorage(Rt){!Rt.isEmpty()&&It(this,_i)&&!It(this,_i).has(Rt.id)&&It(this,_i).setValue(Rt.id,Rt)}blur(){if(!this.hasSelection)return;const{activeElement:Rt}=document;for(const qt of It(this,an))if(qt.div.contains(Rt)){yr(this,$t,[qt,Rt]),qt._focusEventsAllowed=!1;break}}focus(){if(!It(this,$t))return;const[Rt,qt]=It(this,$t);yr(this,$t,null),qt.addEventListener("focusin",()=>{Rt._focusEventsAllowed=!0},{once:!0}),qt.focus()}addEditListeners(){nr(this,ws,iv).call(this),nr(this,Pr,rv).call(this)}removeEditListeners(){nr(this,Ts,By).call(this),nr(this,tr,sv).call(this)}copy(Rt){var yn;if(Rt.preventDefault(),(yn=It(this,fn))==null||yn.commitOrRemove(),!this.hasSelection)return;const qt=[];for(const Rn of It(this,an)){const zn=Rn.serialize(!0);zn&&qt.push(zn)}qt.length!==0&&Rt.clipboardData.setData("application/pdfjs",JSON.stringify(qt))}cut(Rt){this.copy(Rt),this.delete()}paste(Rt){Rt.preventDefault();const{clipboardData:qt}=Rt;for(const zn of qt.items)for(const ir of It(this,xr))if(ir.isHandlingMimeForPasting(zn.type)){ir.paste(zn,this.currentLayer);return}let yn=qt.getData("application/pdfjs");if(!yn)return;try{yn=JSON.parse(yn)}catch(zn){(0,at.warn)(`paste: "${zn.message}".`);return}if(!Array.isArray(yn))return;this.unselectAll();const Rn=this.currentLayer;try{const zn=[];for(const Nr of yn){const Fr=Rn.deserialize(Nr);if(!Fr)return;zn.push(Fr)}const ir=()=>{for(const Nr of zn)nr(this,jt,ov).call(this,Nr);nr(this,Tn,av).call(this,zn)},Sr=()=>{for(const Nr of zn)Nr.remove()};this.addCommands({cmd:ir,undo:Sr,mustExec:!0})}catch(zn){(0,at.warn)(`paste: "${zn.message}".`)}}keydown(Rt){var qt;(qt=this.getActive())!=null&&qt.shouldGetKeyboardEvents()||Cn._keyboardManager.exec(this,Rt)}onEditingAction(Rt){["undo","redo","delete","selectAll"].includes(Rt.name)&&this[Rt.name]()}setEditingState(Rt){Rt?(nr(this,Tr,_1).call(this),nr(this,ws,iv).call(this),nr(this,Pr,rv).call(this),nr(this,qn,Xu).call(this,{isEditing:It(this,rn)!==at.AnnotationEditorType.NONE,isEmpty:nr(this,xn,ty).call(this),hasSomethingToUndo:It(this,gr).hasSomethingToUndo(),hasSomethingToRedo:It(this,gr).hasSomethingToRedo(),hasSelectedEditor:!1})):(nr(this,qr,nv).call(this),nr(this,Ts,By).call(this),nr(this,tr,sv).call(this),nr(this,qn,Xu).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(Rt){if(!It(this,xr)){yr(this,xr,Rt);for(const qt of It(this,xr))nr(this,kr,ey).call(this,qt.defaultPropertiesToUpdate)}}getId(){return It(this,An).getId()}get currentLayer(){return It(this,Xn).get(It(this,br))}getLayer(Rt){return It(this,Xn).get(Rt)}get currentPageIndex(){return It(this,br)}addLayer(Rt){It(this,Xn).set(Rt.pageIndex,Rt),It(this,Nt)?Rt.enable():Rt.disable()}removeLayer(Rt){It(this,Xn).delete(Rt.pageIndex)}updateMode(Rt,qt=null){if(It(this,rn)!==Rt){if(yr(this,rn,Rt),Rt===at.AnnotationEditorType.NONE){this.setEditingState(!1),nr(this,_n,v1).call(this);return}this.setEditingState(!0),nr(this,lo,y1).call(this),this.unselectAll();for(const yn of It(this,Xn).values())yn.updateMode(Rt);if(qt){for(const yn of It(this,Wn).values())if(yn.annotationElementId===qt){this.setSelected(yn),yn.enterInEditMode();break}}}}updateToolbar(Rt){Rt!==It(this,rn)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:Rt})}updateParams(Rt,qt){if(It(this,xr)){if(Rt===at.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(Rt);return}for(const yn of It(this,an))yn.updateParams(Rt,qt);for(const yn of It(this,xr))yn.updateDefaultParams(Rt,qt)}}enableWaiting(Rt=!1){if(It(this,Zt)!==Rt){yr(this,Zt,Rt);for(const qt of It(this,Xn).values())Rt?qt.disableClick():qt.enableClick(),qt.div.classList.toggle("waiting",Rt)}}getEditors(Rt){const qt=[];for(const yn of It(this,Wn).values())yn.pageIndex===Rt&&qt.push(yn);return qt}getEditor(Rt){return It(this,Wn).get(Rt)}addEditor(Rt){It(this,Wn).set(Rt.id,Rt)}removeEditor(Rt){var qt;It(this,Wn).delete(Rt.id),this.unselect(Rt),(!Rt.annotationElementId||!It(this,Pn).has(Rt.annotationElementId))&&((qt=It(this,_i))==null||qt.remove(Rt.id))}addDeletedAnnotationElement(Rt){It(this,Pn).add(Rt.annotationElementId),Rt.deleted=!0}isDeletedAnnotationElement(Rt){return It(this,Pn).has(Rt)}removeDeletedAnnotationElement(Rt){It(this,Pn).delete(Rt.annotationElementId),Rt.deleted=!1}setActiveEditor(Rt){It(this,fn)!==Rt&&(yr(this,fn,Rt),Rt&&nr(this,kr,ey).call(this,Rt.propertiesToUpdate))}toggleSelected(Rt){if(It(this,an).has(Rt)){It(this,an).delete(Rt),Rt.unselect(),nr(this,qn,Xu).call(this,{hasSelectedEditor:this.hasSelection});return}It(this,an).add(Rt),Rt.select(),nr(this,kr,ey).call(this,Rt.propertiesToUpdate),nr(this,qn,Xu).call(this,{hasSelectedEditor:!0})}setSelected(Rt){for(const qt of It(this,an))qt!==Rt&&qt.unselect();It(this,an).clear(),It(this,an).add(Rt),Rt.select(),nr(this,kr,ey).call(this,Rt.propertiesToUpdate),nr(this,qn,Xu).call(this,{hasSelectedEditor:!0})}isSelected(Rt){return It(this,an).has(Rt)}unselect(Rt){Rt.unselect(),It(this,an).delete(Rt),nr(this,qn,Xu).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return It(this,an).size!==0}undo(){It(this,gr).undo(),nr(this,qn,Xu).call(this,{hasSomethingToUndo:It(this,gr).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:nr(this,xn,ty).call(this)})}redo(){It(this,gr).redo(),nr(this,qn,Xu).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:It(this,gr).hasSomethingToRedo(),isEmpty:nr(this,xn,ty).call(this)})}addCommands(Rt){It(this,gr).add(Rt),nr(this,qn,Xu).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:nr(this,xn,ty).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const Rt=[...It(this,an)],qt=()=>{for(const Rn of Rt)Rn.remove()},yn=()=>{for(const Rn of Rt)nr(this,jt,ov).call(this,Rn)};this.addCommands({cmd:qt,undo:yn,mustExec:!0})}commitOrRemove(){var Rt;(Rt=It(this,fn))==null||Rt.commitOrRemove()}hasSomethingToControl(){return It(this,fn)||this.hasSelection}selectAll(){for(const Rt of It(this,an))Rt.commit();nr(this,Tn,av).call(this,It(this,Wn).values())}unselectAll(){if(It(this,fn)){It(this,fn).commitOrRemove();return}if(this.hasSelection){for(const Rt of It(this,an))Rt.unselect();It(this,an).clear(),nr(this,qn,Xu).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(Rt,qt,yn=!1){if(yn||this.commitOrRemove(),!this.hasSelection)return;It(this,ss)[0]+=Rt,It(this,ss)[1]+=qt;const[Rn,zn]=It(this,ss),ir=[...It(this,an)],Sr=1e3;It(this,Lr)&&clearTimeout(It(this,Lr)),yr(this,Lr,setTimeout(()=>{yr(this,Lr,null),It(this,ss)[0]=It(this,ss)[1]=0,this.addCommands({cmd:()=>{for(const Nr of ir)It(this,Wn).has(Nr.id)&&Nr.translateInPage(Rn,zn)},undo:()=>{for(const Nr of ir)It(this,Wn).has(Nr.id)&&Nr.translateInPage(-Rn,-zn)},mustExec:!1})},Sr));for(const Nr of ir)Nr.translateInPage(Rt,qt)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),yr(this,lr,new Map);for(const Rt of It(this,an))It(this,lr).set(Rt,{savedX:Rt.x,savedY:Rt.y,savedPageIndex:Rt.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!It(this,lr))return!1;this.disableUserSelect(!1);const Rt=It(this,lr);yr(this,lr,null);let qt=!1;for(const[{x:Rn,y:zn,pageIndex:ir},Sr]of Rt)Sr.newX=Rn,Sr.newY=zn,Sr.newPageIndex=ir,qt||(qt=Rn!==Sr.savedX||zn!==Sr.savedY||ir!==Sr.savedPageIndex);if(!qt)return!1;const yn=(Rn,zn,ir,Sr)=>{if(It(this,Wn).has(Rn.id)){const Nr=It(this,Xn).get(Sr);Nr?Rn._setParentAndPosition(Nr,zn,ir):(Rn.pageIndex=Sr,Rn.x=zn,Rn.y=ir)}};return this.addCommands({cmd:()=>{for(const[Rn,{newX:zn,newY:ir,newPageIndex:Sr}]of Rt)yn(Rn,zn,ir,Sr)},undo:()=>{for(const[Rn,{savedX:zn,savedY:ir,savedPageIndex:Sr}]of Rt)yn(Rn,zn,ir,Sr)},mustExec:!0}),!0}dragSelectedEditors(Rt,qt){if(It(this,lr))for(const yn of It(this,lr).keys())yn.drag(Rt,qt)}rebuild(Rt){if(Rt.parent===null){const qt=this.getLayer(Rt.pageIndex);qt?(qt.changeParent(Rt),qt.addOrRebuild(Rt)):(this.addEditor(Rt),this.addToAnnotationStorage(Rt),Rt.rebuild())}else Rt.parent.addOrRebuild(Rt)}isActive(Rt){return It(this,fn)===Rt}getActive(){return It(this,fn)}getMode(){return It(this,rn)}get imageManager(){return(0,at.shadow)(this,"imageManager",new At)}};fn=new WeakMap,Wn=new WeakMap,Xn=new WeakMap,Sn=new WeakMap,_i=new WeakMap,gr=new WeakMap,br=new WeakMap,Pn=new WeakMap,lr=new WeakMap,xr=new WeakMap,Dr=new WeakMap,$r=new WeakMap,An=new WeakMap,Nt=new WeakMap,Zt=new WeakMap,$t=new WeakMap,rn=new WeakMap,an=new WeakMap,En=new WeakMap,Mn=new WeakMap,jn=new WeakMap,dr=new WeakMap,cr=new WeakMap,wr=new WeakMap,Rr=new WeakMap,On=new WeakMap,Mr=new WeakMap,ts=new WeakMap,Jr=new WeakMap,jr=new WeakMap,ss=new WeakMap,Lr=new WeakMap,hr=new WeakMap,or=new WeakMap,Tr=new WeakSet,_1=function(){window.addEventListener("focus",It(this,jn)),window.addEventListener("blur",It(this,Mn))},qr=new WeakSet,nv=function(){window.removeEventListener("focus",It(this,jn)),window.removeEventListener("blur",It(this,Mn))},ws=new WeakSet,iv=function(){window.addEventListener("keydown",It(this,Rr),{capture:!0})},Ts=new WeakSet,By=function(){window.removeEventListener("keydown",It(this,Rr),{capture:!0})},Pr=new WeakSet,rv=function(){document.addEventListener("copy",It(this,dr)),document.addEventListener("cut",It(this,cr)),document.addEventListener("paste",It(this,wr))},tr=new WeakSet,sv=function(){document.removeEventListener("copy",It(this,dr)),document.removeEventListener("cut",It(this,cr)),document.removeEventListener("paste",It(this,wr))},qn=new WeakSet,Xu=function(Rt){Object.entries(Rt).some(([yn,Rn])=>It(this,jr)[yn]!==Rn)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(It(this,jr),Rt)})},kr=new WeakSet,ey=function(Rt){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:Rt})},lo=new WeakSet,y1=function(){if(!It(this,Nt)){yr(this,Nt,!0);for(const Rt of It(this,Xn).values())Rt.enable()}},_n=new WeakSet,v1=function(){if(this.unselectAll(),It(this,Nt)){yr(this,Nt,!1);for(const Rt of It(this,Xn).values())Rt.disable()}},jt=new WeakSet,ov=function(Rt){const qt=It(this,Xn).get(Rt.pageIndex);qt?qt.addOrRebuild(Rt):this.addEditor(Rt)},xn=new WeakSet,ty=function(){if(It(this,Wn).size===0)return!0;if(It(this,Wn).size===1)for(const Rt of It(this,Wn).values())return Rt.isEmpty();return!1},Tn=new WeakSet,av=function(Rt){It(this,an).clear();for(const qt of Rt)qt.isEmpty()||(It(this,an).add(qt),qt.select());nr(this,qn,Xu).call(this,{hasSelectedEditor:!0})},$o(Cn,"TRANSLATE_SMALL",1),$o(Cn,"TRANSLATE_BIG",10);let Mt=Cn;et.AnnotationEditorUIManager=Mt},(_e,et,rt)=>{var br,Pn,lr,xr,Dr,$r,An,Nt,Zt,$t,rn,an,o_,Mn,a_,dr,lv,wr,jy,On,$y,ts,ny,jr,iy;Object.defineProperty(et,"__esModule",{value:!0}),et.StatTimer=et.RenderingCancelledException=et.PixelsPerInch=et.PageViewport=et.PDFDateString=et.DOMStandardFontDataFactory=et.DOMSVGFactory=et.DOMFilterFactory=et.DOMCanvasFactory=et.DOMCMapReaderFactory=void 0,et.deprecated=mn,et.getColorValues=Wn,et.getCurrentTransform=Xn,et.getCurrentTransformInverse=Sn,et.getFilenameFromUrl=Bt,et.getPdfFilenameFromUrl=zt,et.getRGB=fn,et.getXfaPageViewport=vn,et.isDataScheme=sn,et.isPdfFile=tn,et.isValidFetchUrl=nn,et.loadScript=Kt,et.noContextMenu=Ot,et.setLayerDimensions=_i;var at=rt(7),ut=rt(1);const pt="http://www.w3.org/2000/svg",gr=class gr{};$o(gr,"CSS",96),$o(gr,"PDF",72),$o(gr,"PDF_TO_CSS_UNITS",gr.CSS/gr.PDF);let yt=gr;et.PixelsPerInch=yt;class ct extends at.BaseFilterFactory{constructor({docId:or,ownerDocument:Tr=globalThis.document}={}){super();Bn(this,an);Bn(this,Mn);Bn(this,dr);Bn(this,wr);Bn(this,On);Bn(this,ts);Bn(this,jr);Bn(this,br,void 0);Bn(this,Pn,void 0);Bn(this,lr,void 0);Bn(this,xr,void 0);Bn(this,Dr,void 0);Bn(this,$r,void 0);Bn(this,An,void 0);Bn(this,Nt,void 0);Bn(this,Zt,void 0);Bn(this,$t,void 0);Bn(this,rn,0);yr(this,lr,or),yr(this,xr,Tr)}addFilter(or){if(!or)return"none";let Tr=It(this,an,o_).get(or);if(Tr)return Tr;let Zr,qr,Cr,ws;if(or.length===1){const Pr=or[0],ns=new Array(256);for(let tr=0;tr<256;tr++)ns[tr]=Pr[tr]/255;ws=Zr=qr=Cr=ns.join(",")}else{const[Pr,ns,tr]=or,Yn=new Array(256),qn=new Array(256),Er=new Array(256);for(let kr=0;kr<256;kr++)Yn[kr]=Pr[kr]/255,qn[kr]=ns[kr]/255,Er[kr]=tr[kr]/255;Zr=Yn.join(","),qr=qn.join(","),Cr=Er.join(","),ws=`${Zr}${qr}${Cr}`}if(Tr=It(this,an,o_).get(ws),Tr)return It(this,an,o_).set(or,Tr),Tr;const ds=`g_${It(this,lr)}_transfer_map_${Q_(this,rn)._++}`,Ts=`url(#${ds})`;It(this,an,o_).set(or,Ts),It(this,an,o_).set(ws,Ts);const Ms=nr(this,wr,jy).call(this,ds);return nr(this,ts,ny).call(this,Zr,qr,Cr,Ms),Ts}addHCMFilter(or,Tr){var ns;const Zr=`${or}-${Tr}`;if(It(this,$r)===Zr)return It(this,An);if(yr(this,$r,Zr),yr(this,An,"none"),(ns=It(this,Dr))==null||ns.remove(),!or||!Tr)return It(this,An);const qr=nr(this,jr,iy).call(this,or);or=ut.Util.makeHexColor(...qr);const Cr=nr(this,jr,iy).call(this,Tr);if(Tr=ut.Util.makeHexColor(...Cr),It(this,Mn,a_).style.color="",or==="#000000"&&Tr==="#ffffff"||or===Tr)return It(this,An);const ws=new Array(256);for(let tr=0;tr<=255;tr++){const Yn=tr/255;ws[tr]=Yn<=.03928?Yn/12.92:((Yn+.055)/1.055)**2.4}const ds=ws.join(","),Ts=`g_${It(this,lr)}_hcm_filter`,Ms=yr(this,Nt,nr(this,wr,jy).call(this,Ts));nr(this,ts,ny).call(this,ds,ds,ds,Ms),nr(this,dr,lv).call(this,Ms);const Pr=(tr,Yn)=>{const qn=qr[tr]/255,Er=Cr[tr]/255,kr=new Array(Yn+1);for(let Us=0;Us<=Yn;Us++)kr[Us]=qn+Us/Yn*(Er-qn);return kr.join(",")};return nr(this,ts,ny).call(this,Pr(0,5),Pr(1,5),Pr(2,5),Ms),yr(this,An,`url(#${Ts})`),It(this,An)}addHighlightHCMFilter(or,Tr,Zr,qr){var Er;const Cr=`${or}-${Tr}-${Zr}-${qr}`;if(It(this,Zt)===Cr)return It(this,$t);if(yr(this,Zt,Cr),yr(this,$t,"none"),(Er=It(this,Nt))==null||Er.remove(),!or||!Tr)return It(this,$t);const[ws,ds]=[or,Tr].map(nr(this,jr,iy).bind(this));let Ts=Math.round(.2126*ws[0]+.7152*ws[1]+.0722*ws[2]),Ms=Math.round(.2126*ds[0]+.7152*ds[1]+.0722*ds[2]),[Pr,ns]=[Zr,qr].map(nr(this,jr,iy).bind(this));Ms<Ts&&([Ts,Ms,Pr,ns]=[Ms,Ts,ns,Pr]),It(this,Mn,a_).style.color="";const tr=(kr,Us,lo)=>{const rr=new Array(256),_n=(Ms-Ts)/lo,Wt=kr/255,jt=(Us-kr)/(255*lo);let ln=0;for(let xn=0;xn<=lo;xn++){const Nn=Math.round(Ts+xn*_n),Tn=Wt+xn*jt;for(let Kn=ln;Kn<=Nn;Kn++)rr[Kn]=Tn;ln=Nn+1}for(let xn=ln;xn<256;xn++)rr[xn]=rr[ln-1];return rr.join(",")},Yn=`g_${It(this,lr)}_hcm_highlight_filter`,qn=yr(this,Nt,nr(this,wr,jy).call(this,Yn));return nr(this,dr,lv).call(this,qn),nr(this,ts,ny).call(this,tr(Pr[0],ns[0],5),tr(Pr[1],ns[1],5),tr(Pr[2],ns[2],5),qn),yr(this,$t,`url(#${Yn})`),It(this,$t)}destroy(or=!1){or&&(It(this,An)||It(this,$t))||(It(this,Pn)&&(It(this,Pn).parentNode.parentNode.remove(),yr(this,Pn,null)),It(this,br)&&(It(this,br).clear(),yr(this,br,null)),yr(this,rn,0))}}br=new WeakMap,Pn=new WeakMap,lr=new WeakMap,xr=new WeakMap,Dr=new WeakMap,$r=new WeakMap,An=new WeakMap,Nt=new WeakMap,Zt=new WeakMap,$t=new WeakMap,rn=new WeakMap,an=new WeakSet,o_=function(){return It(this,br)||yr(this,br,new Map)},Mn=new WeakSet,a_=function(){if(!It(this,Pn)){const or=It(this,xr).createElement("div"),{style:Tr}=or;Tr.visibility="hidden",Tr.contain="strict",Tr.width=Tr.height=0,Tr.position="absolute",Tr.top=Tr.left=0,Tr.zIndex=-1;const Zr=It(this,xr).createElementNS(pt,"svg");Zr.setAttribute("width",0),Zr.setAttribute("height",0),yr(this,Pn,It(this,xr).createElementNS(pt,"defs")),or.append(Zr),Zr.append(It(this,Pn)),It(this,xr).body.append(or)}return It(this,Pn)},dr=new WeakSet,lv=function(or){const Tr=It(this,xr).createElementNS(pt,"feColorMatrix");Tr.setAttribute("type","matrix"),Tr.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),or.append(Tr)},wr=new WeakSet,jy=function(or){const Tr=It(this,xr).createElementNS(pt,"filter");return Tr.setAttribute("color-interpolation-filters","sRGB"),Tr.setAttribute("id",or),It(this,Mn,a_).append(Tr),Tr},On=new WeakSet,$y=function(or,Tr,Zr){const qr=It(this,xr).createElementNS(pt,Tr);qr.setAttribute("type","discrete"),qr.setAttribute("tableValues",Zr),or.append(qr)},ts=new WeakSet,ny=function(or,Tr,Zr,qr){const Cr=It(this,xr).createElementNS(pt,"feComponentTransfer");qr.append(Cr),nr(this,On,$y).call(this,Cr,"feFuncR",or),nr(this,On,$y).call(this,Cr,"feFuncG",Tr),nr(this,On,$y).call(this,Cr,"feFuncB",Zr)},jr=new WeakSet,iy=function(or){return It(this,Mn,a_).style.color=or,fn(getComputedStyle(It(this,Mn,a_)).getPropertyValue("color"))},et.DOMFilterFactory=ct;class At extends at.BaseCanvasFactory{constructor({ownerDocument:hr=globalThis.document}={}){super(),this._document=hr}_createCanvas(hr,or){const Tr=this._document.createElement("canvas");return Tr.width=hr,Tr.height=or,Tr}}et.DOMCanvasFactory=At;async function Pt(Lr,hr=!1){if(nn(Lr,document.baseURI)){const or=await fetch(Lr);if(!or.ok)throw new Error(or.statusText);return hr?new Uint8Array(await or.arrayBuffer()):(0,ut.stringToBytes)(await or.text())}return new Promise((or,Tr)=>{const Zr=new XMLHttpRequest;Zr.open("GET",Lr,!0),hr&&(Zr.responseType="arraybuffer"),Zr.onreadystatechange=()=>{if(Zr.readyState===XMLHttpRequest.DONE){if(Zr.status===200||Zr.status===0){let qr;if(hr&&Zr.response?qr=new Uint8Array(Zr.response):!hr&&Zr.responseText&&(qr=(0,ut.stringToBytes)(Zr.responseText)),qr){or(qr);return}}Tr(new Error(Zr.statusText))}},Zr.send(null)})}class kt extends at.BaseCMapReaderFactory{_fetchData(hr,or){return Pt(hr,this.isCompressed).then(Tr=>({cMapData:Tr,compressionType:or}))}}et.DOMCMapReaderFactory=kt;class Lt extends at.BaseStandardFontDataFactory{_fetchData(hr){return Pt(hr,!0)}}et.DOMStandardFontDataFactory=Lt;class Mt extends at.BaseSVGFactory{_createSVG(hr){return document.createElementNS(pt,hr)}}et.DOMSVGFactory=Mt;class Qt{constructor({viewBox:hr,scale:or,rotation:Tr,offsetX:Zr=0,offsetY:qr=0,dontFlip:Cr=!1}){this.viewBox=hr,this.scale=or,this.rotation=Tr,this.offsetX=Zr,this.offsetY=qr;const ws=(hr[2]+hr[0])/2,ds=(hr[3]+hr[1])/2;let Ts,Ms,Pr,ns;switch(Tr%=360,Tr<0&&(Tr+=360),Tr){case 180:Ts=-1,Ms=0,Pr=0,ns=1;break;case 90:Ts=0,Ms=1,Pr=1,ns=0;break;case 270:Ts=0,Ms=-1,Pr=-1,ns=0;break;case 0:Ts=1,Ms=0,Pr=0,ns=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Cr&&(Pr=-Pr,ns=-ns);let tr,Yn,qn,Er;Ts===0?(tr=Math.abs(ds-hr[1])*or+Zr,Yn=Math.abs(ws-hr[0])*or+qr,qn=(hr[3]-hr[1])*or,Er=(hr[2]-hr[0])*or):(tr=Math.abs(ws-hr[0])*or+Zr,Yn=Math.abs(ds-hr[1])*or+qr,qn=(hr[2]-hr[0])*or,Er=(hr[3]-hr[1])*or),this.transform=[Ts*or,Ms*or,Pr*or,ns*or,tr-Ts*or*ws-Pr*or*ds,Yn-Ms*or*ws-ns*or*ds],this.width=qn,this.height=Er}get rawDims(){const{viewBox:hr}=this;return(0,ut.shadow)(this,"rawDims",{pageWidth:hr[2]-hr[0],pageHeight:hr[3]-hr[1],pageX:hr[0],pageY:hr[1]})}clone({scale:hr=this.scale,rotation:or=this.rotation,offsetX:Tr=this.offsetX,offsetY:Zr=this.offsetY,dontFlip:qr=!1}={}){return new Qt({viewBox:this.viewBox.slice(),scale:hr,rotation:or,offsetX:Tr,offsetY:Zr,dontFlip:qr})}convertToViewportPoint(hr,or){return ut.Util.applyTransform([hr,or],this.transform)}convertToViewportRectangle(hr){const or=ut.Util.applyTransform([hr[0],hr[1]],this.transform),Tr=ut.Util.applyTransform([hr[2],hr[3]],this.transform);return[or[0],or[1],Tr[0],Tr[1]]}convertToPdfPoint(hr,or){return ut.Util.applyInverseTransform([hr,or],this.transform)}}et.PageViewport=Qt;class Jt extends ut.BaseException{constructor(hr,or=0){super(hr,"RenderingCancelledException"),this.extraDelay=or}}et.RenderingCancelledException=Jt;function sn(Lr){const hr=Lr.length;let or=0;for(;or<hr&&Lr[or].trim()==="";)or++;return Lr.substring(or,or+5).toLowerCase()==="data:"}function tn(Lr){return typeof Lr=="string"&&/\.pdf$/i.test(Lr)}function Bt(Lr,hr=!1){return hr||([Lr]=Lr.split(/[#?]/,1)),Lr.substring(Lr.lastIndexOf("/")+1)}function zt(Lr,hr="document.pdf"){if(typeof Lr!="string")return hr;if(sn(Lr))return(0,ut.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),hr;const or=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Tr=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Zr=or.exec(Lr);let qr=Tr.exec(Zr[1])||Tr.exec(Zr[2])||Tr.exec(Zr[3]);if(qr&&(qr=qr[0],qr.includes("%")))try{qr=Tr.exec(decodeURIComponent(qr))[0]}catch{}return qr||hr}class Ht{constructor(){$o(this,"started",Object.create(null));$o(this,"times",[])}time(hr){hr in this.started&&(0,ut.warn)(`Timer is already running for ${hr}`),this.started[hr]=Date.now()}timeEnd(hr){hr in this.started||(0,ut.warn)(`Timer has not been started for ${hr}`),this.times.push({name:hr,start:this.started[hr],end:Date.now()}),delete this.started[hr]}toString(){const hr=[];let or=0;for(const{name:Tr}of this.times)or=Math.max(Tr.length,or);for(const{name:Tr,start:Zr,end:qr}of this.times)hr.push(`${Tr.padEnd(or)} ${qr-Zr}ms
`);return hr.join("")}}et.StatTimer=Ht;function nn(Lr,hr){try{const{protocol:or}=hr?new URL(Lr,hr):new URL(Lr);return or==="http:"||or==="https:"}catch{return!1}}function Ot(Lr){Lr.preventDefault()}function Kt(Lr,hr=!1){return new Promise((or,Tr)=>{const Zr=document.createElement("script");Zr.src=Lr,Zr.onload=function(qr){hr&&Zr.remove(),or(qr)},Zr.onerror=function(){Tr(new Error(`Cannot load script at: ${Zr.src}`))},(document.head||document.documentElement).append(Zr)})}function mn(Lr){console.log("Deprecated API usage: "+Lr)}let hn;class Yt{static toDateObject(hr){if(!hr||typeof hr!="string")return null;hn||(hn=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const or=hn.exec(hr);if(!or)return null;const Tr=parseInt(or[1],10);let Zr=parseInt(or[2],10);Zr=Zr>=1&&Zr<=12?Zr-1:0;let qr=parseInt(or[3],10);qr=qr>=1&&qr<=31?qr:1;let Cr=parseInt(or[4],10);Cr=Cr>=0&&Cr<=23?Cr:0;let ws=parseInt(or[5],10);ws=ws>=0&&ws<=59?ws:0;let ds=parseInt(or[6],10);ds=ds>=0&&ds<=59?ds:0;const Ts=or[7]||"Z";let Ms=parseInt(or[8],10);Ms=Ms>=0&&Ms<=23?Ms:0;let Pr=parseInt(or[9],10)||0;return Pr=Pr>=0&&Pr<=59?Pr:0,Ts==="-"?(Cr+=Ms,ws+=Pr):Ts==="+"&&(Cr-=Ms,ws-=Pr),new Date(Date.UTC(Tr,Zr,qr,Cr,ws,ds))}}et.PDFDateString=Yt;function vn(Lr,{scale:hr=1,rotation:or=0}){const{width:Tr,height:Zr}=Lr.attributes.style,qr=[0,0,parseInt(Tr),parseInt(Zr)];return new Qt({viewBox:qr,scale:hr,rotation:or})}function fn(Lr){if(Lr.startsWith("#")){const hr=parseInt(Lr.slice(1),16);return[(hr&16711680)>>16,(hr&65280)>>8,hr&255]}return Lr.startsWith("rgb(")?Lr.slice(4,-1).split(",").map(hr=>parseInt(hr)):Lr.startsWith("rgba(")?Lr.slice(5,-1).split(",").map(hr=>parseInt(hr)).slice(0,3):((0,ut.warn)(`Not a valid color format: "${Lr}"`),[0,0,0])}function Wn(Lr){const hr=document.createElement("span");hr.style.visibility="hidden",document.body.append(hr);for(const or of Lr.keys()){hr.style.color=or;const Tr=window.getComputedStyle(hr).color;Lr.set(or,fn(Tr))}hr.remove()}function Xn(Lr){const{a:hr,b:or,c:Tr,d:Zr,e:qr,f:Cr}=Lr.getTransform();return[hr,or,Tr,Zr,qr,Cr]}function Sn(Lr){const{a:hr,b:or,c:Tr,d:Zr,e:qr,f:Cr}=Lr.getTransform().invertSelf();return[hr,or,Tr,Zr,qr,Cr]}function _i(Lr,hr,or=!1,Tr=!0){if(hr instanceof Qt){const{pageWidth:Zr,pageHeight:qr}=hr.rawDims,{style:Cr}=Lr,ws=ut.FeatureTest.isCSSRoundSupported,ds=`var(--scale-factor) * ${Zr}px`,Ts=`var(--scale-factor) * ${qr}px`,Ms=ws?`round(${ds}, 1px)`:`calc(${ds})`,Pr=ws?`round(${Ts}, 1px)`:`calc(${Ts})`;!or||hr.rotation%180===0?(Cr.width=Ms,Cr.height=Pr):(Cr.width=Pr,Cr.height=Ms)}Tr&&Lr.setAttribute("data-main-rotation",hr.rotation)}},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.BaseStandardFontDataFactory=et.BaseSVGFactory=et.BaseFilterFactory=et.BaseCanvasFactory=et.BaseCMapReaderFactory=void 0;var at=rt(1);class ut{constructor(){this.constructor===ut&&(0,at.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(kt){return"none"}addHCMFilter(kt,Lt){return"none"}addHighlightHCMFilter(kt,Lt,Mt,Qt){return"none"}destroy(kt=!1){}}et.BaseFilterFactory=ut;class pt{constructor(){this.constructor===pt&&(0,at.unreachable)("Cannot initialize BaseCanvasFactory.")}create(kt,Lt){if(kt<=0||Lt<=0)throw new Error("Invalid canvas size");const Mt=this._createCanvas(kt,Lt);return{canvas:Mt,context:Mt.getContext("2d")}}reset(kt,Lt,Mt){if(!kt.canvas)throw new Error("Canvas is not specified");if(Lt<=0||Mt<=0)throw new Error("Invalid canvas size");kt.canvas.width=Lt,kt.canvas.height=Mt}destroy(kt){if(!kt.canvas)throw new Error("Canvas is not specified");kt.canvas.width=0,kt.canvas.height=0,kt.canvas=null,kt.context=null}_createCanvas(kt,Lt){(0,at.unreachable)("Abstract method `_createCanvas` called.")}}et.BaseCanvasFactory=pt;class yt{constructor({baseUrl:kt=null,isCompressed:Lt=!0}){this.constructor===yt&&(0,at.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=kt,this.isCompressed=Lt}async fetch({name:kt}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!kt)throw new Error("CMap name must be specified.");const Lt=this.baseUrl+kt+(this.isCompressed?".bcmap":""),Mt=this.isCompressed?at.CMapCompressionType.BINARY:at.CMapCompressionType.NONE;return this._fetchData(Lt,Mt).catch(Qt=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${Lt}`)})}_fetchData(kt,Lt){(0,at.unreachable)("Abstract method `_fetchData` called.")}}et.BaseCMapReaderFactory=yt;class ct{constructor({baseUrl:kt=null}){this.constructor===ct&&(0,at.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=kt}async fetch({filename:kt}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!kt)throw new Error("Font filename must be specified.");const Lt=`${this.baseUrl}${kt}`;return this._fetchData(Lt).catch(Mt=>{throw new Error(`Unable to load font data at: ${Lt}`)})}_fetchData(kt){(0,at.unreachable)("Abstract method `_fetchData` called.")}}et.BaseStandardFontDataFactory=ct;class At{constructor(){this.constructor===At&&(0,at.unreachable)("Cannot initialize BaseSVGFactory.")}create(kt,Lt,Mt=!1){if(kt<=0||Lt<=0)throw new Error("Invalid SVG dimensions");const Qt=this._createSVG("svg:svg");return Qt.setAttribute("version","1.1"),Mt||(Qt.setAttribute("width",`${kt}px`),Qt.setAttribute("height",`${Lt}px`)),Qt.setAttribute("preserveAspectRatio","none"),Qt.setAttribute("viewBox",`0 0 ${kt} ${Lt}`),Qt}createElement(kt){if(typeof kt!="string")throw new Error("Invalid SVG element type");return this._createSVG(kt)}_createSVG(kt){(0,at.unreachable)("Abstract method `_createSVG` called.")}}et.BaseSVGFactory=At},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.MurmurHash3_64=void 0;var at=rt(1);const ut=3285377520,pt=4294901760,yt=65535;class ct{constructor(Pt){this.h1=Pt?Pt&4294967295:ut,this.h2=Pt?Pt&4294967295:ut}update(Pt){let kt,Lt;if(typeof Pt=="string"){kt=new Uint8Array(Pt.length*2),Lt=0;for(let mn=0,hn=Pt.length;mn<hn;mn++){const Yt=Pt.charCodeAt(mn);Yt<=255?kt[Lt++]=Yt:(kt[Lt++]=Yt>>>8,kt[Lt++]=Yt&255)}}else if((0,at.isArrayBuffer)(Pt))kt=Pt.slice(),Lt=kt.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const Mt=Lt>>2,Qt=Lt-Mt*4,Jt=new Uint32Array(kt.buffer,0,Mt);let sn=0,tn=0,Bt=this.h1,zt=this.h2;const Ht=3432918353,nn=461845907,Ot=Ht&yt,Kt=nn&yt;for(let mn=0;mn<Mt;mn++)mn&1?(sn=Jt[mn],sn=sn*Ht&pt|sn*Ot&yt,sn=sn<<15|sn>>>17,sn=sn*nn&pt|sn*Kt&yt,Bt^=sn,Bt=Bt<<13|Bt>>>19,Bt=Bt*5+3864292196):(tn=Jt[mn],tn=tn*Ht&pt|tn*Ot&yt,tn=tn<<15|tn>>>17,tn=tn*nn&pt|tn*Kt&yt,zt^=tn,zt=zt<<13|zt>>>19,zt=zt*5+3864292196);switch(sn=0,Qt){case 3:sn^=kt[Mt*4+2]<<16;case 2:sn^=kt[Mt*4+1]<<8;case 1:sn^=kt[Mt*4],sn=sn*Ht&pt|sn*Ot&yt,sn=sn<<15|sn>>>17,sn=sn*nn&pt|sn*Kt&yt,Mt&1?Bt^=sn:zt^=sn}this.h1=Bt,this.h2=zt}hexdigest(){let Pt=this.h1,kt=this.h2;return Pt^=kt>>>1,Pt=Pt*3981806797&pt|Pt*36045&yt,kt=kt*4283543511&pt|((kt<<16|Pt>>>16)*2950163797&pt)>>>16,Pt^=kt>>>1,Pt=Pt*444984403&pt|Pt*60499&yt,kt=kt*3301882366&pt|((kt<<16|Pt>>>16)*3120437893&pt)>>>16,Pt^=kt>>>1,(Pt>>>0).toString(16).padStart(8,"0")+(kt>>>0).toString(16).padStart(8,"0")}}et.MurmurHash3_64=ct},(_e,et,rt)=>{var yt;Object.defineProperty(et,"__esModule",{value:!0}),et.FontLoader=et.FontFaceObject=void 0;var at=rt(1);class ut{constructor({ownerDocument:At=globalThis.document,styleElement:Pt=null}){Bn(this,yt,new Set);this._document=At,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(At){this.nativeFontFaces.add(At),this._document.fonts.add(At)}removeNativeFontFace(At){this.nativeFontFaces.delete(At),this._document.fonts.delete(At)}insertRule(At){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const Pt=this.styleElement.sheet;Pt.insertRule(At,Pt.cssRules.length)}clear(){for(const At of this.nativeFontFaces)this._document.fonts.delete(At);this.nativeFontFaces.clear(),It(this,yt).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(At){if(!(!At||It(this,yt).has(At.loadedName))){if((0,at.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:Pt,src:kt,style:Lt}=At,Mt=new FontFace(Pt,kt,Lt);this.addNativeFontFace(Mt);try{await Mt.load(),It(this,yt).add(Pt)}catch{(0,at.warn)(`Cannot load system font: ${At.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(Mt)}return}(0,at.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(At){if(At.attached||At.missingFile&&!At.systemFontInfo)return;if(At.attached=!0,At.systemFontInfo){await this.loadSystemFont(At.systemFontInfo);return}if(this.isFontLoadingAPISupported){const kt=At.createNativeFontFace();if(kt){this.addNativeFontFace(kt);try{await kt.loaded}catch(Lt){throw(0,at.warn)(`Failed to load font '${kt.family}': '${Lt}'.`),At.disableFontFace=!0,Lt}}return}const Pt=At.createFontFaceRule();if(Pt){if(this.insertRule(Pt),this.isSyncFontLoadingSupported)return;await new Promise(kt=>{const Lt=this._queueLoadingCallback(kt);this._prepareFontLoadEvent(At,Lt)})}}get isFontLoadingAPISupported(){var Pt;const At=!!((Pt=this._document)!=null&&Pt.fonts);return(0,at.shadow)(this,"isFontLoadingAPISupported",At)}get isSyncFontLoadingSupported(){let At=!1;return(at.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(At=!0),(0,at.shadow)(this,"isSyncFontLoadingSupported",At)}_queueLoadingCallback(At){function Pt(){for((0,at.assert)(!Lt.done,"completeRequest() cannot be called twice."),Lt.done=!0;kt.length>0&&kt[0].done;){const Mt=kt.shift();setTimeout(Mt.callback,0)}}const{loadingRequests:kt}=this,Lt={done:!1,complete:Pt,callback:At};return kt.push(Lt),Lt}get _loadTestFont(){const At=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,at.shadow)(this,"_loadTestFont",At)}_prepareFontLoadEvent(At,Pt){function kt(fn,Wn){return fn.charCodeAt(Wn)<<24|fn.charCodeAt(Wn+1)<<16|fn.charCodeAt(Wn+2)<<8|fn.charCodeAt(Wn+3)&255}function Lt(fn,Wn,Xn,Sn){const _i=fn.substring(0,Wn),gr=fn.substring(Wn+Xn);return _i+Sn+gr}let Mt,Qt;const Jt=this._document.createElement("canvas");Jt.width=1,Jt.height=1;const sn=Jt.getContext("2d");let tn=0;function Bt(fn,Wn){if(++tn>30){(0,at.warn)("Load test font never loaded."),Wn();return}if(sn.font="30px "+fn,sn.fillText(".",0,20),sn.getImageData(0,0,1,1).data[3]>0){Wn();return}setTimeout(Bt.bind(null,fn,Wn))}const zt=`lt${Date.now()}${this.loadTestFontId++}`;let Ht=this._loadTestFont;Ht=Lt(Ht,976,zt.length,zt);const Ot=16,Kt=1482184792;let mn=kt(Ht,Ot);for(Mt=0,Qt=zt.length-3;Mt<Qt;Mt+=4)mn=mn-Kt+kt(zt,Mt)|0;Mt<zt.length&&(mn=mn-Kt+kt(zt+"XXX",Mt)|0),Ht=Lt(Ht,Ot,4,(0,at.string32)(mn));const hn=`url(data:font/opentype;base64,${btoa(Ht)});`,Yt=`@font-face {font-family:"${zt}";src:${hn}}`;this.insertRule(Yt);const vn=this._document.createElement("div");vn.style.visibility="hidden",vn.style.width=vn.style.height="10px",vn.style.position="absolute",vn.style.top=vn.style.left="0px";for(const fn of[At.loadedName,zt]){const Wn=this._document.createElement("span");Wn.textContent="Hi",Wn.style.fontFamily=fn,vn.append(Wn)}this._document.body.append(vn),Bt(zt,()=>{vn.remove(),Pt.complete()})}}yt=new WeakMap,et.FontLoader=ut;class pt{constructor(At,{isEvalSupported:Pt=!0,disableFontFace:kt=!1,ignoreErrors:Lt=!1,inspectFont:Mt=null}){this.compiledGlyphs=Object.create(null);for(const Qt in At)this[Qt]=At[Qt];this.isEvalSupported=Pt!==!1,this.disableFontFace=kt===!0,this.ignoreErrors=Lt===!0,this._inspectFont=Mt}createNativeFontFace(){var Pt;if(!this.data||this.disableFontFace)return null;let At;if(!this.cssFontInfo)At=new FontFace(this.loadedName,this.data,{});else{const kt={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(kt.style=`oblique ${this.cssFontInfo.italicAngle}deg`),At=new FontFace(this.cssFontInfo.fontFamily,this.data,kt)}return(Pt=this._inspectFont)==null||Pt.call(this,this),At}createFontFaceRule(){var Lt;if(!this.data||this.disableFontFace)return null;const At=(0,at.bytesToString)(this.data),Pt=`url(data:${this.mimetype};base64,${btoa(At)});`;let kt;if(!this.cssFontInfo)kt=`@font-face {font-family:"${this.loadedName}";src:${Pt}}`;else{let Mt=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(Mt+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),kt=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${Mt}src:${Pt}}`}return(Lt=this._inspectFont)==null||Lt.call(this,this,Pt),kt}getPathGenerator(At,Pt){if(this.compiledGlyphs[Pt]!==void 0)return this.compiledGlyphs[Pt];let kt;try{kt=At.get(this.loadedName+"_path_"+Pt)}catch(Lt){if(!this.ignoreErrors)throw Lt;return(0,at.warn)(`getPathGenerator - ignoring character: "${Lt}".`),this.compiledGlyphs[Pt]=function(Mt,Qt){}}if(this.isEvalSupported&&at.FeatureTest.isEvalSupported){const Lt=[];for(const Mt of kt){const Qt=Mt.args!==void 0?Mt.args.join(","):"";Lt.push("c.",Mt.cmd,"(",Qt,`);
`)}return this.compiledGlyphs[Pt]=new Function("c","size",Lt.join(""))}return this.compiledGlyphs[Pt]=function(Lt,Mt){for(const Qt of kt)Qt.cmd==="scale"&&(Qt.args=[Mt,-Mt]),Lt[Qt.cmd].apply(Lt,Qt.args)}}}et.FontFaceObject=pt},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.NodeStandardFontDataFactory=et.NodeFilterFactory=et.NodeCanvasFactory=et.NodeCMapReaderFactory=void 0;var at=rt(7);rt(1);const ut=function(Pt){return new Promise((kt,Lt)=>{require$$5.readFile(Pt,(Qt,Jt)=>{if(Qt||!Jt){Lt(new Error(Qt));return}kt(new Uint8Array(Jt))})})};class pt extends at.BaseFilterFactory{}et.NodeFilterFactory=pt;class yt extends at.BaseCanvasFactory{_createCanvas(kt,Lt){return require$$5.createCanvas(kt,Lt)}}et.NodeCanvasFactory=yt;class ct extends at.BaseCMapReaderFactory{_fetchData(kt,Lt){return ut(kt).then(Mt=>({cMapData:Mt,compressionType:Lt}))}}et.NodeCMapReaderFactory=ct;class At extends at.BaseStandardFontDataFactory{_fetchData(kt){return ut(kt)}}et.NodeStandardFontDataFactory=At},(_e,et,rt)=>{var Pn,cv,xr,uv;Object.defineProperty(et,"__esModule",{value:!0}),et.CanvasGraphics=void 0;var at=rt(1),ut=rt(6),pt=rt(12),yt=rt(13);const ct=16,At=100,Pt=4096,kt=15,Lt=10,Mt=1e3,Qt=16;function Jt(An,Nt){if(An._removeMirroring)throw new Error("Context is already forwarding operations.");An.__originalSave=An.save,An.__originalRestore=An.restore,An.__originalRotate=An.rotate,An.__originalScale=An.scale,An.__originalTranslate=An.translate,An.__originalTransform=An.transform,An.__originalSetTransform=An.setTransform,An.__originalResetTransform=An.resetTransform,An.__originalClip=An.clip,An.__originalMoveTo=An.moveTo,An.__originalLineTo=An.lineTo,An.__originalBezierCurveTo=An.bezierCurveTo,An.__originalRect=An.rect,An.__originalClosePath=An.closePath,An.__originalBeginPath=An.beginPath,An._removeMirroring=()=>{An.save=An.__originalSave,An.restore=An.__originalRestore,An.rotate=An.__originalRotate,An.scale=An.__originalScale,An.translate=An.__originalTranslate,An.transform=An.__originalTransform,An.setTransform=An.__originalSetTransform,An.resetTransform=An.__originalResetTransform,An.clip=An.__originalClip,An.moveTo=An.__originalMoveTo,An.lineTo=An.__originalLineTo,An.bezierCurveTo=An.__originalBezierCurveTo,An.rect=An.__originalRect,An.closePath=An.__originalClosePath,An.beginPath=An.__originalBeginPath,delete An._removeMirroring},An.save=function(){Nt.save(),this.__originalSave()},An.restore=function(){Nt.restore(),this.__originalRestore()},An.translate=function($t,rn){Nt.translate($t,rn),this.__originalTranslate($t,rn)},An.scale=function($t,rn){Nt.scale($t,rn),this.__originalScale($t,rn)},An.transform=function($t,rn,an,En,Mn,jn){Nt.transform($t,rn,an,En,Mn,jn),this.__originalTransform($t,rn,an,En,Mn,jn)},An.setTransform=function($t,rn,an,En,Mn,jn){Nt.setTransform($t,rn,an,En,Mn,jn),this.__originalSetTransform($t,rn,an,En,Mn,jn)},An.resetTransform=function(){Nt.resetTransform(),this.__originalResetTransform()},An.rotate=function($t){Nt.rotate($t),this.__originalRotate($t)},An.clip=function($t){Nt.clip($t),this.__originalClip($t)},An.moveTo=function(Zt,$t){Nt.moveTo(Zt,$t),this.__originalMoveTo(Zt,$t)},An.lineTo=function(Zt,$t){Nt.lineTo(Zt,$t),this.__originalLineTo(Zt,$t)},An.bezierCurveTo=function(Zt,$t,rn,an,En,Mn){Nt.bezierCurveTo(Zt,$t,rn,an,En,Mn),this.__originalBezierCurveTo(Zt,$t,rn,an,En,Mn)},An.rect=function(Zt,$t,rn,an){Nt.rect(Zt,$t,rn,an),this.__originalRect(Zt,$t,rn,an)},An.closePath=function(){Nt.closePath(),this.__originalClosePath()},An.beginPath=function(){Nt.beginPath(),this.__originalBeginPath()}}class sn{constructor(Nt){this.canvasFactory=Nt,this.cache=Object.create(null)}getCanvas(Nt,Zt,$t){let rn;return this.cache[Nt]!==void 0?(rn=this.cache[Nt],this.canvasFactory.reset(rn,Zt,$t)):(rn=this.canvasFactory.create(Zt,$t),this.cache[Nt]=rn),rn}delete(Nt){delete this.cache[Nt]}clear(){for(const Nt in this.cache){const Zt=this.cache[Nt];this.canvasFactory.destroy(Zt),delete this.cache[Nt]}}}function tn(An,Nt,Zt,$t,rn,an,En,Mn,jn,dr){const[cr,wr,Rr,On,Mr,ts]=(0,ut.getCurrentTransform)(An);if(wr===0&&Rr===0){const ss=En*cr+Mr,Lr=Math.round(ss),hr=Mn*On+ts,or=Math.round(hr),Tr=(En+jn)*cr+Mr,Zr=Math.abs(Math.round(Tr)-Lr)||1,qr=(Mn+dr)*On+ts,Cr=Math.abs(Math.round(qr)-or)||1;return An.setTransform(Math.sign(cr),0,0,Math.sign(On),Lr,or),An.drawImage(Nt,Zt,$t,rn,an,0,0,Zr,Cr),An.setTransform(cr,wr,Rr,On,Mr,ts),[Zr,Cr]}if(cr===0&&On===0){const ss=Mn*Rr+Mr,Lr=Math.round(ss),hr=En*wr+ts,or=Math.round(hr),Tr=(Mn+dr)*Rr+Mr,Zr=Math.abs(Math.round(Tr)-Lr)||1,qr=(En+jn)*wr+ts,Cr=Math.abs(Math.round(qr)-or)||1;return An.setTransform(0,Math.sign(wr),Math.sign(Rr),0,Lr,or),An.drawImage(Nt,Zt,$t,rn,an,0,0,Cr,Zr),An.setTransform(cr,wr,Rr,On,Mr,ts),[Cr,Zr]}An.drawImage(Nt,Zt,$t,rn,an,En,Mn,jn,dr);const Jr=Math.hypot(cr,wr),jr=Math.hypot(Rr,On);return[Jr*jn,jr*dr]}function Bt(An){const{width:Nt,height:Zt}=An;if(Nt>Mt||Zt>Mt)return null;const $t=1e3,rn=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),an=Nt+1;let En=new Uint8Array(an*(Zt+1)),Mn,jn,dr;const cr=Nt+7&-8;let wr=new Uint8Array(cr*Zt),Rr=0;for(const jr of An.data){let ss=128;for(;ss>0;)wr[Rr++]=jr&ss?0:255,ss>>=1}let On=0;for(Rr=0,wr[Rr]!==0&&(En[0]=1,++On),jn=1;jn<Nt;jn++)wr[Rr]!==wr[Rr+1]&&(En[jn]=wr[Rr]?2:1,++On),Rr++;for(wr[Rr]!==0&&(En[jn]=2,++On),Mn=1;Mn<Zt;Mn++){Rr=Mn*cr,dr=Mn*an,wr[Rr-cr]!==wr[Rr]&&(En[dr]=wr[Rr]?1:8,++On);let jr=(wr[Rr]?4:0)+(wr[Rr-cr]?8:0);for(jn=1;jn<Nt;jn++)jr=(jr>>2)+(wr[Rr+1]?4:0)+(wr[Rr-cr+1]?8:0),rn[jr]&&(En[dr+jn]=rn[jr],++On),Rr++;if(wr[Rr-cr]!==wr[Rr]&&(En[dr+jn]=wr[Rr]?2:4,++On),On>$t)return null}for(Rr=cr*(Zt-1),dr=Mn*an,wr[Rr]!==0&&(En[dr]=8,++On),jn=1;jn<Nt;jn++)wr[Rr]!==wr[Rr+1]&&(En[dr+jn]=wr[Rr]?4:8,++On),Rr++;if(wr[Rr]!==0&&(En[dr+jn]=4,++On),On>$t)return null;const Mr=new Int32Array([0,an,-1,0,-an,0,0,0,1]),ts=new Path2D;for(Mn=0;On&&Mn<=Zt;Mn++){let jr=Mn*an;const ss=jr+Nt;for(;jr<ss&&!En[jr];)jr++;if(jr===ss)continue;ts.moveTo(jr%an,Mn);const Lr=jr;let hr=En[jr];do{const or=Mr[hr];do jr+=or;while(!En[jr]);const Tr=En[jr];Tr!==5&&Tr!==10?(hr=Tr,En[jr]=0):(hr=Tr&51*hr>>4,En[jr]&=hr>>2|hr<<2),ts.lineTo(jr%an,jr/an|0),En[jr]||--On}while(Lr!==jr);--Mn}return wr=null,En=null,function(jr){jr.save(),jr.scale(1/Nt,-1/Zt),jr.translate(0,-Zt),jr.fill(ts),jr.beginPath(),jr.restore()}}class zt{constructor(Nt,Zt){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=at.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=at.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=at.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,Nt,Zt])}clone(){const Nt=Object.create(this);return Nt.clipBox=this.clipBox.slice(),Nt}setCurrentPoint(Nt,Zt){this.x=Nt,this.y=Zt}updatePathMinMax(Nt,Zt,$t){[Zt,$t]=at.Util.applyTransform([Zt,$t],Nt),this.minX=Math.min(this.minX,Zt),this.minY=Math.min(this.minY,$t),this.maxX=Math.max(this.maxX,Zt),this.maxY=Math.max(this.maxY,$t)}updateRectMinMax(Nt,Zt){const $t=at.Util.applyTransform(Zt,Nt),rn=at.Util.applyTransform(Zt.slice(2),Nt);this.minX=Math.min(this.minX,$t[0],rn[0]),this.minY=Math.min(this.minY,$t[1],rn[1]),this.maxX=Math.max(this.maxX,$t[0],rn[0]),this.maxY=Math.max(this.maxY,$t[1],rn[1])}updateScalingPathMinMax(Nt,Zt){at.Util.scaleMinMax(Nt,Zt),this.minX=Math.min(this.minX,Zt[0]),this.maxX=Math.max(this.maxX,Zt[1]),this.minY=Math.min(this.minY,Zt[2]),this.maxY=Math.max(this.maxY,Zt[3])}updateCurvePathMinMax(Nt,Zt,$t,rn,an,En,Mn,jn,dr,cr){const wr=at.Util.bezierBoundingBox(Zt,$t,rn,an,En,Mn,jn,dr);if(cr){cr[0]=Math.min(cr[0],wr[0],wr[2]),cr[1]=Math.max(cr[1],wr[0],wr[2]),cr[2]=Math.min(cr[2],wr[1],wr[3]),cr[3]=Math.max(cr[3],wr[1],wr[3]);return}this.updateRectMinMax(Nt,wr)}getPathBoundingBox(Nt=pt.PathType.FILL,Zt=null){const $t=[this.minX,this.minY,this.maxX,this.maxY];if(Nt===pt.PathType.STROKE){Zt||(0,at.unreachable)("Stroke bounding box must include transform.");const rn=at.Util.singularValueDecompose2dScale(Zt),an=rn[0]*this.lineWidth/2,En=rn[1]*this.lineWidth/2;$t[0]-=an,$t[1]-=En,$t[2]+=an,$t[3]+=En}return $t}updateClipFromPath(){const Nt=at.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(Nt||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(Nt){this.clipBox=Nt,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(Nt=pt.PathType.FILL,Zt=null){return at.Util.intersect(this.clipBox,this.getPathBoundingBox(Nt,Zt))}}function Ht(An,Nt){if(typeof ImageData<"u"&&Nt instanceof ImageData){An.putImageData(Nt,0,0);return}const Zt=Nt.height,$t=Nt.width,rn=Zt%Qt,an=(Zt-rn)/Qt,En=rn===0?an:an+1,Mn=An.createImageData($t,Qt);let jn=0,dr;const cr=Nt.data,wr=Mn.data;let Rr,On,Mr,ts;if(Nt.kind===at.ImageKind.GRAYSCALE_1BPP){const Jr=cr.byteLength,jr=new Uint32Array(wr.buffer,0,wr.byteLength>>2),ss=jr.length,Lr=$t+7>>3,hr=4294967295,or=at.FeatureTest.isLittleEndian?4278190080:255;for(Rr=0;Rr<En;Rr++){for(Mr=Rr<an?Qt:rn,dr=0,On=0;On<Mr;On++){const Tr=Jr-jn;let Zr=0;const qr=Tr>Lr?$t:Tr*8-7,Cr=qr&-8;let ws=0,ds=0;for(;Zr<Cr;Zr+=8)ds=cr[jn++],jr[dr++]=ds&128?hr:or,jr[dr++]=ds&64?hr:or,jr[dr++]=ds&32?hr:or,jr[dr++]=ds&16?hr:or,jr[dr++]=ds&8?hr:or,jr[dr++]=ds&4?hr:or,jr[dr++]=ds&2?hr:or,jr[dr++]=ds&1?hr:or;for(;Zr<qr;Zr++)ws===0&&(ds=cr[jn++],ws=128),jr[dr++]=ds&ws?hr:or,ws>>=1}for(;dr<ss;)jr[dr++]=0;An.putImageData(Mn,0,Rr*Qt)}}else if(Nt.kind===at.ImageKind.RGBA_32BPP){for(On=0,ts=$t*Qt*4,Rr=0;Rr<an;Rr++)wr.set(cr.subarray(jn,jn+ts)),jn+=ts,An.putImageData(Mn,0,On),On+=Qt;Rr<En&&(ts=$t*rn*4,wr.set(cr.subarray(jn,jn+ts)),An.putImageData(Mn,0,On))}else if(Nt.kind===at.ImageKind.RGB_24BPP)for(Mr=Qt,ts=$t*Mr,Rr=0;Rr<En;Rr++){for(Rr>=an&&(Mr=rn,ts=$t*Mr),dr=0,On=ts;On--;)wr[dr++]=cr[jn++],wr[dr++]=cr[jn++],wr[dr++]=cr[jn++],wr[dr++]=255;An.putImageData(Mn,0,Rr*Qt)}else throw new Error(`bad image kind: ${Nt.kind}`)}function nn(An,Nt){if(Nt.bitmap){An.drawImage(Nt.bitmap,0,0);return}const Zt=Nt.height,$t=Nt.width,rn=Zt%Qt,an=(Zt-rn)/Qt,En=rn===0?an:an+1,Mn=An.createImageData($t,Qt);let jn=0;const dr=Nt.data,cr=Mn.data;for(let wr=0;wr<En;wr++){const Rr=wr<an?Qt:rn;({srcPos:jn}=(0,yt.convertBlackAndWhiteToRGBA)({src:dr,srcPos:jn,dest:cr,width:$t,height:Rr,nonBlackColor:0})),An.putImageData(Mn,0,wr*Qt)}}function Ot(An,Nt){const Zt=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const $t of Zt)An[$t]!==void 0&&(Nt[$t]=An[$t]);An.setLineDash!==void 0&&(Nt.setLineDash(An.getLineDash()),Nt.lineDashOffset=An.lineDashOffset)}function Kt(An){if(An.strokeStyle=An.fillStyle="#000000",An.fillRule="nonzero",An.globalAlpha=1,An.lineWidth=1,An.lineCap="butt",An.lineJoin="miter",An.miterLimit=10,An.globalCompositeOperation="source-over",An.font="10px sans-serif",An.setLineDash!==void 0&&(An.setLineDash([]),An.lineDashOffset=0),!at.isNodeJS){const{filter:Nt}=An;Nt!=="none"&&Nt!==""&&(An.filter="none")}}function mn(An,Nt,Zt,$t){const rn=An.length;for(let an=3;an<rn;an+=4){const En=An[an];if(En===0)An[an-3]=Nt,An[an-2]=Zt,An[an-1]=$t;else if(En<255){const Mn=255-En;An[an-3]=An[an-3]*En+Nt*Mn>>8,An[an-2]=An[an-2]*En+Zt*Mn>>8,An[an-1]=An[an-1]*En+$t*Mn>>8}}}function hn(An,Nt,Zt){const $t=An.length,rn=1/255;for(let an=3;an<$t;an+=4){const En=Zt?Zt[An[an]]:An[an];Nt[an]=Nt[an]*En*rn|0}}function Yt(An,Nt,Zt){const $t=An.length;for(let rn=3;rn<$t;rn+=4){const an=An[rn-3]*77+An[rn-2]*152+An[rn-1]*28;Nt[rn]=Zt?Nt[rn]*Zt[an>>8]>>8:Nt[rn]*an>>16}}function vn(An,Nt,Zt,$t,rn,an,En,Mn,jn,dr,cr){const wr=!!an,Rr=wr?an[0]:0,On=wr?an[1]:0,Mr=wr?an[2]:0,ts=rn==="Luminosity"?Yt:hn,jr=Math.min($t,Math.ceil(1048576/Zt));for(let ss=0;ss<$t;ss+=jr){const Lr=Math.min(jr,$t-ss),hr=An.getImageData(Mn-dr,ss+(jn-cr),Zt,Lr),or=Nt.getImageData(Mn,ss+jn,Zt,Lr);wr&&mn(hr.data,Rr,On,Mr),ts(hr.data,or.data,En),Nt.putImageData(or,Mn,ss+jn)}}function fn(An,Nt,Zt,$t){const rn=$t[0],an=$t[1],En=$t[2]-rn,Mn=$t[3]-an;En===0||Mn===0||(vn(Nt.context,Zt,En,Mn,Nt.subtype,Nt.backdrop,Nt.transferMap,rn,an,Nt.offsetX,Nt.offsetY),An.save(),An.globalAlpha=1,An.globalCompositeOperation="source-over",An.setTransform(1,0,0,1,0,0),An.drawImage(Zt.canvas,0,0),An.restore())}function Wn(An,Nt){const Zt=at.Util.singularValueDecompose2dScale(An);Zt[0]=Math.fround(Zt[0]),Zt[1]=Math.fround(Zt[1]);const $t=Math.fround((globalThis.devicePixelRatio||1)*ut.PixelsPerInch.PDF_TO_CSS_UNITS);return Nt!==void 0?Nt:Zt[0]<=$t||Zt[1]<=$t}const Xn=["butt","round","square"],Sn=["miter","round","bevel"],_i={},gr={},$r=class $r{constructor(Nt,Zt,$t,rn,an,{optionalContentConfig:En,markedContentStack:Mn=null},jn,dr){Bn(this,Pn);Bn(this,xr);this.ctx=Nt,this.current=new zt(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=Zt,this.objs=$t,this.canvasFactory=rn,this.filterFactory=an,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=Mn||[],this.optionalContentConfig=En,this.cachedCanvases=new sn(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=jn,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=dr,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(Nt,Zt=null){return typeof Nt=="string"?Nt.startsWith("g_")?this.commonObjs.get(Nt):this.objs.get(Nt):Zt}beginDrawing({transform:Nt,viewport:Zt,transparency:$t=!1,background:rn=null}){const an=this.ctx.canvas.width,En=this.ctx.canvas.height,Mn=this.ctx.fillStyle;if(this.ctx.fillStyle=rn||"#ffffff",this.ctx.fillRect(0,0,an,En),this.ctx.fillStyle=Mn,$t){const jn=this.cachedCanvases.getCanvas("transparent",an,En);this.compositeCtx=this.ctx,this.transparentCanvas=jn.canvas,this.ctx=jn.context,this.ctx.save(),this.ctx.transform(...(0,ut.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),Kt(this.ctx),Nt&&(this.ctx.transform(...Nt),this.outputScaleX=Nt[0],this.outputScaleY=Nt[0]),this.ctx.transform(...Zt.transform),this.viewportScale=Zt.scale,this.baseTransform=(0,ut.getCurrentTransform)(this.ctx)}executeOperatorList(Nt,Zt,$t,rn){const an=Nt.argsArray,En=Nt.fnArray;let Mn=Zt||0;const jn=an.length;if(jn===Mn)return Mn;const dr=jn-Mn>Lt&&typeof $t=="function",cr=dr?Date.now()+kt:0;let wr=0;const Rr=this.commonObjs,On=this.objs;let Mr;for(;;){if(rn!==void 0&&Mn===rn.nextBreakPoint)return rn.breakIt(Mn,$t),Mn;if(Mr=En[Mn],Mr!==at.OPS.dependency)this[Mr].apply(this,an[Mn]);else for(const ts of an[Mn]){const Jr=ts.startsWith("g_")?Rr:On;if(!Jr.has(ts))return Jr.get(ts,$t),Mn}if(Mn++,Mn===jn)return Mn;if(dr&&++wr>Lt){if(Date.now()>cr)return $t(),Mn;wr=0}}}endDrawing(){nr(this,Pn,cv).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const Nt of this._cachedBitmapsMap.values()){for(const Zt of Nt.values())typeof HTMLCanvasElement<"u"&&Zt instanceof HTMLCanvasElement&&(Zt.width=Zt.height=0);Nt.clear()}this._cachedBitmapsMap.clear(),nr(this,xr,uv).call(this)}_scaleImage(Nt,Zt){const $t=Nt.width,rn=Nt.height;let an=Math.max(Math.hypot(Zt[0],Zt[1]),1),En=Math.max(Math.hypot(Zt[2],Zt[3]),1),Mn=$t,jn=rn,dr="prescale1",cr,wr;for(;an>2&&Mn>1||En>2&&jn>1;){let Rr=Mn,On=jn;an>2&&Mn>1&&(Rr=Mn>=16384?Math.floor(Mn/2)-1||1:Math.ceil(Mn/2),an/=Mn/Rr),En>2&&jn>1&&(On=jn>=16384?Math.floor(jn/2)-1||1:Math.ceil(jn)/2,En/=jn/On),cr=this.cachedCanvases.getCanvas(dr,Rr,On),wr=cr.context,wr.clearRect(0,0,Rr,On),wr.drawImage(Nt,0,0,Mn,jn,0,0,Rr,On),Nt=cr.canvas,Mn=Rr,jn=On,dr=dr==="prescale1"?"prescale2":"prescale1"}return{img:Nt,paintWidth:Mn,paintHeight:jn}}_createMaskCanvas(Nt){const Zt=this.ctx,{width:$t,height:rn}=Nt,an=this.current.fillColor,En=this.current.patternFill,Mn=(0,ut.getCurrentTransform)(Zt);let jn,dr,cr,wr;if((Nt.bitmap||Nt.data)&&Nt.count>1){const Zr=Nt.bitmap||Nt.data.buffer;dr=JSON.stringify(En?Mn:[Mn.slice(0,4),an]),jn=this._cachedBitmapsMap.get(Zr),jn||(jn=new Map,this._cachedBitmapsMap.set(Zr,jn));const qr=jn.get(dr);if(qr&&!En){const Cr=Math.round(Math.min(Mn[0],Mn[2])+Mn[4]),ws=Math.round(Math.min(Mn[1],Mn[3])+Mn[5]);return{canvas:qr,offsetX:Cr,offsetY:ws}}cr=qr}cr||(wr=this.cachedCanvases.getCanvas("maskCanvas",$t,rn),nn(wr.context,Nt));let Rr=at.Util.transform(Mn,[1/$t,0,0,-1/rn,0,0]);Rr=at.Util.transform(Rr,[1,0,0,1,0,-rn]);const On=at.Util.applyTransform([0,0],Rr),Mr=at.Util.applyTransform([$t,rn],Rr),ts=at.Util.normalizeRect([On[0],On[1],Mr[0],Mr[1]]),Jr=Math.round(ts[2]-ts[0])||1,jr=Math.round(ts[3]-ts[1])||1,ss=this.cachedCanvases.getCanvas("fillCanvas",Jr,jr),Lr=ss.context,hr=Math.min(On[0],Mr[0]),or=Math.min(On[1],Mr[1]);Lr.translate(-hr,-or),Lr.transform(...Rr),cr||(cr=this._scaleImage(wr.canvas,(0,ut.getCurrentTransformInverse)(Lr)),cr=cr.img,jn&&En&&jn.set(dr,cr)),Lr.imageSmoothingEnabled=Wn((0,ut.getCurrentTransform)(Lr),Nt.interpolate),tn(Lr,cr,0,0,cr.width,cr.height,0,0,$t,rn),Lr.globalCompositeOperation="source-in";const Tr=at.Util.transform((0,ut.getCurrentTransformInverse)(Lr),[1,0,0,1,-hr,-or]);return Lr.fillStyle=En?an.getPattern(Zt,this,Tr,pt.PathType.FILL):an,Lr.fillRect(0,0,$t,rn),jn&&!En&&(this.cachedCanvases.delete("fillCanvas"),jn.set(dr,ss.canvas)),{canvas:ss.canvas,offsetX:Math.round(hr),offsetY:Math.round(or)}}setLineWidth(Nt){Nt!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=Nt,this.ctx.lineWidth=Nt}setLineCap(Nt){this.ctx.lineCap=Xn[Nt]}setLineJoin(Nt){this.ctx.lineJoin=Sn[Nt]}setMiterLimit(Nt){this.ctx.miterLimit=Nt}setDash(Nt,Zt){const $t=this.ctx;$t.setLineDash!==void 0&&($t.setLineDash(Nt),$t.lineDashOffset=Zt)}setRenderingIntent(Nt){}setFlatness(Nt){}setGState(Nt){for(const[Zt,$t]of Nt)switch(Zt){case"LW":this.setLineWidth($t);break;case"LC":this.setLineCap($t);break;case"LJ":this.setLineJoin($t);break;case"ML":this.setMiterLimit($t);break;case"D":this.setDash($t[0],$t[1]);break;case"RI":this.setRenderingIntent($t);break;case"FL":this.setFlatness($t);break;case"Font":this.setFont($t[0],$t[1]);break;case"CA":this.current.strokeAlpha=$t;break;case"ca":this.current.fillAlpha=$t,this.ctx.globalAlpha=$t;break;case"BM":this.ctx.globalCompositeOperation=$t;break;case"SMask":this.current.activeSMask=$t?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter($t);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const Nt=this.inSMaskMode;this.current.activeSMask&&!Nt?this.beginSMaskMode():!this.current.activeSMask&&Nt&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const Nt=this.ctx.canvas.width,Zt=this.ctx.canvas.height,$t="smaskGroupAt"+this.groupLevel,rn=this.cachedCanvases.getCanvas($t,Nt,Zt);this.suspendedCtx=this.ctx,this.ctx=rn.context;const an=this.ctx;an.setTransform(...(0,ut.getCurrentTransform)(this.suspendedCtx)),Ot(this.suspendedCtx,an),Jt(an,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ot(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(Nt){if(!this.current.activeSMask)return;Nt?(Nt[0]=Math.floor(Nt[0]),Nt[1]=Math.floor(Nt[1]),Nt[2]=Math.ceil(Nt[2]),Nt[3]=Math.ceil(Nt[3])):Nt=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const Zt=this.current.activeSMask,$t=this.suspendedCtx;fn($t,Zt,this.ctx,Nt),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(Ot(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const Nt=this.current;this.stateStack.push(Nt),this.current=Nt.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Ot(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(Nt,Zt,$t,rn,an,En){this.ctx.transform(Nt,Zt,$t,rn,an,En),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(Nt,Zt,$t){const rn=this.ctx,an=this.current;let En=an.x,Mn=an.y,jn,dr;const cr=(0,ut.getCurrentTransform)(rn),wr=cr[0]===0&&cr[3]===0||cr[1]===0&&cr[2]===0,Rr=wr?$t.slice(0):null;for(let On=0,Mr=0,ts=Nt.length;On<ts;On++)switch(Nt[On]|0){case at.OPS.rectangle:En=Zt[Mr++],Mn=Zt[Mr++];const Jr=Zt[Mr++],jr=Zt[Mr++],ss=En+Jr,Lr=Mn+jr;rn.moveTo(En,Mn),Jr===0||jr===0?rn.lineTo(ss,Lr):(rn.lineTo(ss,Mn),rn.lineTo(ss,Lr),rn.lineTo(En,Lr)),wr||an.updateRectMinMax(cr,[En,Mn,ss,Lr]),rn.closePath();break;case at.OPS.moveTo:En=Zt[Mr++],Mn=Zt[Mr++],rn.moveTo(En,Mn),wr||an.updatePathMinMax(cr,En,Mn);break;case at.OPS.lineTo:En=Zt[Mr++],Mn=Zt[Mr++],rn.lineTo(En,Mn),wr||an.updatePathMinMax(cr,En,Mn);break;case at.OPS.curveTo:jn=En,dr=Mn,En=Zt[Mr+4],Mn=Zt[Mr+5],rn.bezierCurveTo(Zt[Mr],Zt[Mr+1],Zt[Mr+2],Zt[Mr+3],En,Mn),an.updateCurvePathMinMax(cr,jn,dr,Zt[Mr],Zt[Mr+1],Zt[Mr+2],Zt[Mr+3],En,Mn,Rr),Mr+=6;break;case at.OPS.curveTo2:jn=En,dr=Mn,rn.bezierCurveTo(En,Mn,Zt[Mr],Zt[Mr+1],Zt[Mr+2],Zt[Mr+3]),an.updateCurvePathMinMax(cr,jn,dr,En,Mn,Zt[Mr],Zt[Mr+1],Zt[Mr+2],Zt[Mr+3],Rr),En=Zt[Mr+2],Mn=Zt[Mr+3],Mr+=4;break;case at.OPS.curveTo3:jn=En,dr=Mn,En=Zt[Mr+2],Mn=Zt[Mr+3],rn.bezierCurveTo(Zt[Mr],Zt[Mr+1],En,Mn,En,Mn),an.updateCurvePathMinMax(cr,jn,dr,Zt[Mr],Zt[Mr+1],En,Mn,En,Mn,Rr),Mr+=4;break;case at.OPS.closePath:rn.closePath();break}wr&&an.updateScalingPathMinMax(cr,Rr),an.setCurrentPoint(En,Mn)}closePath(){this.ctx.closePath()}stroke(Nt=!0){const Zt=this.ctx,$t=this.current.strokeColor;Zt.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof $t=="object"&&($t!=null&&$t.getPattern)?(Zt.save(),Zt.strokeStyle=$t.getPattern(Zt,this,(0,ut.getCurrentTransformInverse)(Zt),pt.PathType.STROKE),this.rescaleAndStroke(!1),Zt.restore()):this.rescaleAndStroke(!0)),Nt&&this.consumePath(this.current.getClippedPathBoundingBox()),Zt.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(Nt=!0){const Zt=this.ctx,$t=this.current.fillColor,rn=this.current.patternFill;let an=!1;rn&&(Zt.save(),Zt.fillStyle=$t.getPattern(Zt,this,(0,ut.getCurrentTransformInverse)(Zt),pt.PathType.FILL),an=!0);const En=this.current.getClippedPathBoundingBox();this.contentVisible&&En!==null&&(this.pendingEOFill?(Zt.fill("evenodd"),this.pendingEOFill=!1):Zt.fill()),an&&Zt.restore(),Nt&&this.consumePath(En)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=_i}eoClip(){this.pendingClip=gr}beginText(){this.current.textMatrix=at.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const Nt=this.pendingTextPaths,Zt=this.ctx;if(Nt===void 0){Zt.beginPath();return}Zt.save(),Zt.beginPath();for(const $t of Nt)Zt.setTransform(...$t.transform),Zt.translate($t.x,$t.y),$t.addToPath(Zt,$t.fontSize);Zt.restore(),Zt.clip(),Zt.beginPath(),delete this.pendingTextPaths}setCharSpacing(Nt){this.current.charSpacing=Nt}setWordSpacing(Nt){this.current.wordSpacing=Nt}setHScale(Nt){this.current.textHScale=Nt/100}setLeading(Nt){this.current.leading=-Nt}setFont(Nt,Zt){var cr;const $t=this.commonObjs.get(Nt),rn=this.current;if(!$t)throw new Error(`Can't find font for ${Nt}`);if(rn.fontMatrix=$t.fontMatrix||at.FONT_IDENTITY_MATRIX,(rn.fontMatrix[0]===0||rn.fontMatrix[3]===0)&&(0,at.warn)("Invalid font matrix for font "+Nt),Zt<0?(Zt=-Zt,rn.fontDirection=-1):rn.fontDirection=1,this.current.font=$t,this.current.fontSize=Zt,$t.isType3Font)return;const an=$t.loadedName||"sans-serif",En=((cr=$t.systemFontInfo)==null?void 0:cr.css)||`"${an}", ${$t.fallbackName}`;let Mn="normal";$t.black?Mn="900":$t.bold&&(Mn="bold");const jn=$t.italic?"italic":"normal";let dr=Zt;Zt<ct?dr=ct:Zt>At&&(dr=At),this.current.fontSizeScale=Zt/dr,this.ctx.font=`${jn} ${Mn} ${dr}px ${En}`}setTextRenderingMode(Nt){this.current.textRenderingMode=Nt}setTextRise(Nt){this.current.textRise=Nt}moveText(Nt,Zt){this.current.x=this.current.lineX+=Nt,this.current.y=this.current.lineY+=Zt}setLeadingMoveText(Nt,Zt){this.setLeading(-Zt),this.moveText(Nt,Zt)}setTextMatrix(Nt,Zt,$t,rn,an,En){this.current.textMatrix=[Nt,Zt,$t,rn,an,En],this.current.textMatrixScale=Math.hypot(Nt,Zt),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(Nt,Zt,$t,rn){const an=this.ctx,En=this.current,Mn=En.font,jn=En.textRenderingMode,dr=En.fontSize/En.fontSizeScale,cr=jn&at.TextRenderingMode.FILL_STROKE_MASK,wr=!!(jn&at.TextRenderingMode.ADD_TO_PATH_FLAG),Rr=En.patternFill&&!Mn.missingFile;let On;(Mn.disableFontFace||wr||Rr)&&(On=Mn.getPathGenerator(this.commonObjs,Nt)),Mn.disableFontFace||Rr?(an.save(),an.translate(Zt,$t),an.beginPath(),On(an,dr),rn&&an.setTransform(...rn),(cr===at.TextRenderingMode.FILL||cr===at.TextRenderingMode.FILL_STROKE)&&an.fill(),(cr===at.TextRenderingMode.STROKE||cr===at.TextRenderingMode.FILL_STROKE)&&an.stroke(),an.restore()):((cr===at.TextRenderingMode.FILL||cr===at.TextRenderingMode.FILL_STROKE)&&an.fillText(Nt,Zt,$t),(cr===at.TextRenderingMode.STROKE||cr===at.TextRenderingMode.FILL_STROKE)&&an.strokeText(Nt,Zt,$t)),wr&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,ut.getCurrentTransform)(an),x:Zt,y:$t,fontSize:dr,addToPath:On})}get isFontSubpixelAAEnabled(){const{context:Nt}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);Nt.scale(1.5,1),Nt.fillText("I",0,10);const Zt=Nt.getImageData(0,0,10,10).data;let $t=!1;for(let rn=3;rn<Zt.length;rn+=4)if(Zt[rn]>0&&Zt[rn]<255){$t=!0;break}return(0,at.shadow)(this,"isFontSubpixelAAEnabled",$t)}showText(Nt){const Zt=this.current,$t=Zt.font;if($t.isType3Font)return this.showType3Text(Nt);const rn=Zt.fontSize;if(rn===0)return;const an=this.ctx,En=Zt.fontSizeScale,Mn=Zt.charSpacing,jn=Zt.wordSpacing,dr=Zt.fontDirection,cr=Zt.textHScale*dr,wr=Nt.length,Rr=$t.vertical,On=Rr?1:-1,Mr=$t.defaultVMetrics,ts=rn*Zt.fontMatrix[0],Jr=Zt.textRenderingMode===at.TextRenderingMode.FILL&&!$t.disableFontFace&&!Zt.patternFill;an.save(),an.transform(...Zt.textMatrix),an.translate(Zt.x,Zt.y+Zt.textRise),dr>0?an.scale(cr,-1):an.scale(cr,1);let jr;if(Zt.patternFill){an.save();const Tr=Zt.fillColor.getPattern(an,this,(0,ut.getCurrentTransformInverse)(an),pt.PathType.FILL);jr=(0,ut.getCurrentTransform)(an),an.restore(),an.fillStyle=Tr}let ss=Zt.lineWidth;const Lr=Zt.textMatrixScale;if(Lr===0||ss===0){const Tr=Zt.textRenderingMode&at.TextRenderingMode.FILL_STROKE_MASK;(Tr===at.TextRenderingMode.STROKE||Tr===at.TextRenderingMode.FILL_STROKE)&&(ss=this.getSinglePixelWidth())}else ss/=Lr;if(En!==1&&(an.scale(En,En),ss/=En),an.lineWidth=ss,$t.isInvalidPDFjsFont){const Tr=[];let Zr=0;for(const qr of Nt)Tr.push(qr.unicode),Zr+=qr.width;an.fillText(Tr.join(""),0,0),Zt.x+=Zr*ts*cr,an.restore(),this.compose();return}let hr=0,or;for(or=0;or<wr;++or){const Tr=Nt[or];if(typeof Tr=="number"){hr+=On*Tr*rn/1e3;continue}let Zr=!1;const qr=(Tr.isSpace?jn:0)+Mn,Cr=Tr.fontChar,ws=Tr.accent;let ds,Ts,Ms=Tr.width;if(Rr){const ns=Tr.vmetric||Mr,tr=-(Tr.vmetric?ns[1]:Ms*.5)*ts,Yn=ns[2]*ts;Ms=ns?-ns[0]:Ms,ds=tr/En,Ts=(hr+Yn)/En}else ds=hr/En,Ts=0;if($t.remeasure&&Ms>0){const ns=an.measureText(Cr).width*1e3/rn*En;if(Ms<ns&&this.isFontSubpixelAAEnabled){const tr=Ms/ns;Zr=!0,an.save(),an.scale(tr,1),ds/=tr}else Ms!==ns&&(ds+=(Ms-ns)/2e3*rn/En)}if(this.contentVisible&&(Tr.isInFont||$t.missingFile)){if(Jr&&!ws)an.fillText(Cr,ds,Ts);else if(this.paintChar(Cr,ds,Ts,jr),ws){const ns=ds+rn*ws.offset.x/En,tr=Ts-rn*ws.offset.y/En;this.paintChar(ws.fontChar,ns,tr,jr)}}const Pr=Rr?Ms*ts-qr*dr:Ms*ts+qr*dr;hr+=Pr,Zr&&an.restore()}Rr?Zt.y-=hr:Zt.x+=hr*cr,an.restore(),this.compose()}showType3Text(Nt){const Zt=this.ctx,$t=this.current,rn=$t.font,an=$t.fontSize,En=$t.fontDirection,Mn=rn.vertical?1:-1,jn=$t.charSpacing,dr=$t.wordSpacing,cr=$t.textHScale*En,wr=$t.fontMatrix||at.FONT_IDENTITY_MATRIX,Rr=Nt.length,On=$t.textRenderingMode===at.TextRenderingMode.INVISIBLE;let Mr,ts,Jr,jr;if(!(On||an===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,Zt.save(),Zt.transform(...$t.textMatrix),Zt.translate($t.x,$t.y),Zt.scale(cr,En),Mr=0;Mr<Rr;++Mr){if(ts=Nt[Mr],typeof ts=="number"){jr=Mn*ts*an/1e3,this.ctx.translate(jr,0),$t.x+=jr*cr;continue}const ss=(ts.isSpace?dr:0)+jn,Lr=rn.charProcOperatorList[ts.operatorListId];if(!Lr){(0,at.warn)(`Type3 character "${ts.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=ts,this.save(),Zt.scale(an,an),Zt.transform(...wr),this.executeOperatorList(Lr),this.restore()),Jr=at.Util.applyTransform([ts.width,0],wr)[0]*an+ss,Zt.translate(Jr,0),$t.x+=Jr*cr}Zt.restore(),this.processingType3=null}}setCharWidth(Nt,Zt){}setCharWidthAndBounds(Nt,Zt,$t,rn,an,En){this.ctx.rect($t,rn,an-$t,En-rn),this.ctx.clip(),this.endPath()}getColorN_Pattern(Nt){let Zt;if(Nt[0]==="TilingPattern"){const $t=Nt[1],rn=this.baseTransform||(0,ut.getCurrentTransform)(this.ctx),an={createCanvasGraphics:En=>new $r(En,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};Zt=new pt.TilingPattern(Nt,$t,this.ctx,an,rn)}else Zt=this._getPattern(Nt[1],Nt[2]);return Zt}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(Nt,Zt,$t){const rn=at.Util.makeHexColor(Nt,Zt,$t);this.ctx.strokeStyle=rn,this.current.strokeColor=rn}setFillRGBColor(Nt,Zt,$t){const rn=at.Util.makeHexColor(Nt,Zt,$t);this.ctx.fillStyle=rn,this.current.fillColor=rn,this.current.patternFill=!1}_getPattern(Nt,Zt=null){let $t;return this.cachedPatterns.has(Nt)?$t=this.cachedPatterns.get(Nt):($t=(0,pt.getShadingPattern)(this.getObject(Nt)),this.cachedPatterns.set(Nt,$t)),Zt&&($t.matrix=Zt),$t}shadingFill(Nt){if(!this.contentVisible)return;const Zt=this.ctx;this.save();const $t=this._getPattern(Nt);Zt.fillStyle=$t.getPattern(Zt,this,(0,ut.getCurrentTransformInverse)(Zt),pt.PathType.SHADING);const rn=(0,ut.getCurrentTransformInverse)(Zt);if(rn){const{width:an,height:En}=Zt.canvas,[Mn,jn,dr,cr]=at.Util.getAxialAlignedBoundingBox([0,0,an,En],rn);this.ctx.fillRect(Mn,jn,dr-Mn,cr-jn)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,at.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,at.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(Nt,Zt){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(Nt)&&Nt.length===6&&this.transform(...Nt),this.baseTransform=(0,ut.getCurrentTransform)(this.ctx),Zt)){const $t=Zt[2]-Zt[0],rn=Zt[3]-Zt[1];this.ctx.rect(Zt[0],Zt[1],$t,rn),this.current.updateRectMinMax((0,ut.getCurrentTransform)(this.ctx),Zt),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(Nt){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const Zt=this.ctx;Nt.isolated||(0,at.info)("TODO: Support non-isolated groups."),Nt.knockout&&(0,at.warn)("Knockout groups not supported.");const $t=(0,ut.getCurrentTransform)(Zt);if(Nt.matrix&&Zt.transform(...Nt.matrix),!Nt.bbox)throw new Error("Bounding box is required.");let rn=at.Util.getAxialAlignedBoundingBox(Nt.bbox,(0,ut.getCurrentTransform)(Zt));const an=[0,0,Zt.canvas.width,Zt.canvas.height];rn=at.Util.intersect(rn,an)||[0,0,0,0];const En=Math.floor(rn[0]),Mn=Math.floor(rn[1]);let jn=Math.max(Math.ceil(rn[2])-En,1),dr=Math.max(Math.ceil(rn[3])-Mn,1),cr=1,wr=1;jn>Pt&&(cr=jn/Pt,jn=Pt),dr>Pt&&(wr=dr/Pt,dr=Pt),this.current.startNewPathAndClipBox([0,0,jn,dr]);let Rr="groupAt"+this.groupLevel;Nt.smask&&(Rr+="_smask_"+this.smaskCounter++%2);const On=this.cachedCanvases.getCanvas(Rr,jn,dr),Mr=On.context;Mr.scale(1/cr,1/wr),Mr.translate(-En,-Mn),Mr.transform(...$t),Nt.smask?this.smaskStack.push({canvas:On.canvas,context:Mr,offsetX:En,offsetY:Mn,scaleX:cr,scaleY:wr,subtype:Nt.smask.subtype,backdrop:Nt.smask.backdrop,transferMap:Nt.smask.transferMap||null,startTransformInverse:null}):(Zt.setTransform(1,0,0,1,0,0),Zt.translate(En,Mn),Zt.scale(cr,wr),Zt.save()),Ot(Zt,Mr),this.ctx=Mr,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(Zt),this.groupLevel++}endGroup(Nt){if(!this.contentVisible)return;this.groupLevel--;const Zt=this.ctx,$t=this.groupStack.pop();if(this.ctx=$t,this.ctx.imageSmoothingEnabled=!1,Nt.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const rn=(0,ut.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...rn);const an=at.Util.getAxialAlignedBoundingBox([0,0,Zt.canvas.width,Zt.canvas.height],rn);this.ctx.drawImage(Zt.canvas,0,0),this.ctx.restore(),this.compose(an)}}beginAnnotation(Nt,Zt,$t,rn,an){if(nr(this,Pn,cv).call(this),Kt(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(Zt)&&Zt.length===4){const En=Zt[2]-Zt[0],Mn=Zt[3]-Zt[1];if(an&&this.annotationCanvasMap){$t=$t.slice(),$t[4]-=Zt[0],$t[5]-=Zt[1],Zt=Zt.slice(),Zt[0]=Zt[1]=0,Zt[2]=En,Zt[3]=Mn;const[jn,dr]=at.Util.singularValueDecompose2dScale((0,ut.getCurrentTransform)(this.ctx)),{viewportScale:cr}=this,wr=Math.ceil(En*this.outputScaleX*cr),Rr=Math.ceil(Mn*this.outputScaleY*cr);this.annotationCanvas=this.canvasFactory.create(wr,Rr);const{canvas:On,context:Mr}=this.annotationCanvas;this.annotationCanvasMap.set(Nt,On),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Mr,this.ctx.save(),this.ctx.setTransform(jn,0,0,-dr,0,Mn*dr),Kt(this.ctx)}else Kt(this.ctx),this.ctx.rect(Zt[0],Zt[1],En,Mn),this.ctx.clip(),this.endPath()}this.current=new zt(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...$t),this.transform(...rn)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),nr(this,xr,uv).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(Nt){if(!this.contentVisible)return;const Zt=Nt.count;Nt=this.getObject(Nt.data,Nt),Nt.count=Zt;const $t=this.ctx,rn=this.processingType3;if(rn&&(rn.compiled===void 0&&(rn.compiled=Bt(Nt)),rn.compiled)){rn.compiled($t);return}const an=this._createMaskCanvas(Nt),En=an.canvas;$t.save(),$t.setTransform(1,0,0,1,0,0),$t.drawImage(En,an.offsetX,an.offsetY),$t.restore(),this.compose()}paintImageMaskXObjectRepeat(Nt,Zt,$t=0,rn=0,an,En){if(!this.contentVisible)return;Nt=this.getObject(Nt.data,Nt);const Mn=this.ctx;Mn.save();const jn=(0,ut.getCurrentTransform)(Mn);Mn.transform(Zt,$t,rn,an,0,0);const dr=this._createMaskCanvas(Nt);Mn.setTransform(1,0,0,1,dr.offsetX-jn[4],dr.offsetY-jn[5]);for(let cr=0,wr=En.length;cr<wr;cr+=2){const Rr=at.Util.transform(jn,[Zt,$t,rn,an,En[cr],En[cr+1]]),[On,Mr]=at.Util.applyTransform([0,0],Rr);Mn.drawImage(dr.canvas,On,Mr)}Mn.restore(),this.compose()}paintImageMaskXObjectGroup(Nt){if(!this.contentVisible)return;const Zt=this.ctx,$t=this.current.fillColor,rn=this.current.patternFill;for(const an of Nt){const{data:En,width:Mn,height:jn,transform:dr}=an,cr=this.cachedCanvases.getCanvas("maskCanvas",Mn,jn),wr=cr.context;wr.save();const Rr=this.getObject(En,an);nn(wr,Rr),wr.globalCompositeOperation="source-in",wr.fillStyle=rn?$t.getPattern(wr,this,(0,ut.getCurrentTransformInverse)(Zt),pt.PathType.FILL):$t,wr.fillRect(0,0,Mn,jn),wr.restore(),Zt.save(),Zt.transform(...dr),Zt.scale(1,-1),tn(Zt,cr.canvas,0,0,Mn,jn,0,-1,1,1),Zt.restore()}this.compose()}paintImageXObject(Nt){if(!this.contentVisible)return;const Zt=this.getObject(Nt);if(!Zt){(0,at.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(Zt)}paintImageXObjectRepeat(Nt,Zt,$t,rn){if(!this.contentVisible)return;const an=this.getObject(Nt);if(!an){(0,at.warn)("Dependent image isn't ready yet");return}const En=an.width,Mn=an.height,jn=[];for(let dr=0,cr=rn.length;dr<cr;dr+=2)jn.push({transform:[Zt,0,0,$t,rn[dr],rn[dr+1]],x:0,y:0,w:En,h:Mn});this.paintInlineImageXObjectGroup(an,jn)}applyTransferMapsToCanvas(Nt){return this.current.transferMaps!=="none"&&(Nt.filter=this.current.transferMaps,Nt.drawImage(Nt.canvas,0,0),Nt.filter="none"),Nt.canvas}applyTransferMapsToBitmap(Nt){if(this.current.transferMaps==="none")return Nt.bitmap;const{bitmap:Zt,width:$t,height:rn}=Nt,an=this.cachedCanvases.getCanvas("inlineImage",$t,rn),En=an.context;return En.filter=this.current.transferMaps,En.drawImage(Zt,0,0),En.filter="none",an.canvas}paintInlineImageXObject(Nt){if(!this.contentVisible)return;const Zt=Nt.width,$t=Nt.height,rn=this.ctx;if(this.save(),!at.isNodeJS){const{filter:Mn}=rn;Mn!=="none"&&Mn!==""&&(rn.filter="none")}rn.scale(1/Zt,-1/$t);let an;if(Nt.bitmap)an=this.applyTransferMapsToBitmap(Nt);else if(typeof HTMLElement=="function"&&Nt instanceof HTMLElement||!Nt.data)an=Nt;else{const jn=this.cachedCanvases.getCanvas("inlineImage",Zt,$t).context;Ht(jn,Nt),an=this.applyTransferMapsToCanvas(jn)}const En=this._scaleImage(an,(0,ut.getCurrentTransformInverse)(rn));rn.imageSmoothingEnabled=Wn((0,ut.getCurrentTransform)(rn),Nt.interpolate),tn(rn,En.img,0,0,En.paintWidth,En.paintHeight,0,-$t,Zt,$t),this.compose(),this.restore()}paintInlineImageXObjectGroup(Nt,Zt){if(!this.contentVisible)return;const $t=this.ctx;let rn;if(Nt.bitmap)rn=Nt.bitmap;else{const an=Nt.width,En=Nt.height,jn=this.cachedCanvases.getCanvas("inlineImage",an,En).context;Ht(jn,Nt),rn=this.applyTransferMapsToCanvas(jn)}for(const an of Zt)$t.save(),$t.transform(...an.transform),$t.scale(1,-1),tn($t,rn,an.x,an.y,an.w,an.h,0,-1,1,1),$t.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(Nt){}markPointProps(Nt,Zt){}beginMarkedContent(Nt){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(Nt,Zt){Nt==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(Zt)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(Nt){const Zt=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(Nt);const $t=this.ctx;this.pendingClip&&(Zt||(this.pendingClip===gr?$t.clip("evenodd"):$t.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),$t.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const Nt=(0,ut.getCurrentTransform)(this.ctx);if(Nt[1]===0&&Nt[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(Nt[0]),Math.abs(Nt[3]));else{const Zt=Math.abs(Nt[0]*Nt[3]-Nt[2]*Nt[1]),$t=Math.hypot(Nt[0],Nt[2]),rn=Math.hypot(Nt[1],Nt[3]);this._cachedGetSinglePixelWidth=Math.max($t,rn)/Zt}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:Nt}=this.current,{a:Zt,b:$t,c:rn,d:an}=this.ctx.getTransform();let En,Mn;if($t===0&&rn===0){const jn=Math.abs(Zt),dr=Math.abs(an);if(jn===dr)if(Nt===0)En=Mn=1/jn;else{const cr=jn*Nt;En=Mn=cr<1?1/cr:1}else if(Nt===0)En=1/jn,Mn=1/dr;else{const cr=jn*Nt,wr=dr*Nt;En=cr<1?1/cr:1,Mn=wr<1?1/wr:1}}else{const jn=Math.abs(Zt*an-$t*rn),dr=Math.hypot(Zt,$t),cr=Math.hypot(rn,an);if(Nt===0)En=cr/jn,Mn=dr/jn;else{const wr=Nt*jn;En=cr>wr?cr/wr:1,Mn=dr>wr?dr/wr:1}}this._cachedScaleForStroking[0]=En,this._cachedScaleForStroking[1]=Mn}return this._cachedScaleForStroking}rescaleAndStroke(Nt){const{ctx:Zt}=this,{lineWidth:$t}=this.current,[rn,an]=this.getScaleForStroking();if(Zt.lineWidth=$t||1,rn===1&&an===1){Zt.stroke();return}const En=Zt.getLineDash();if(Nt&&Zt.save(),Zt.scale(rn,an),En.length>0){const Mn=Math.max(rn,an);Zt.setLineDash(En.map(jn=>jn/Mn)),Zt.lineDashOffset/=Mn}Zt.stroke(),Nt&&Zt.restore()}isContentVisible(){for(let Nt=this.markedContentStack.length-1;Nt>=0;Nt--)if(!this.markedContentStack[Nt].visible)return!1;return!0}};Pn=new WeakSet,cv=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},xr=new WeakSet,uv=function(){if(this.pageColors){const Nt=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(Nt!=="none"){const Zt=this.ctx.filter;this.ctx.filter=Nt,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=Zt}}};let br=$r;et.CanvasGraphics=br;for(const An in at.OPS)br.prototype[An]!==void 0&&(br.prototype[at.OPS[An]]=br.prototype[An])},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.TilingPattern=et.PathType=void 0,et.getShadingPattern=Qt;var at=rt(1),ut=rt(6);const pt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};et.PathType=pt;function yt(Bt,zt){if(!zt)return;const Ht=zt[2]-zt[0],nn=zt[3]-zt[1],Ot=new Path2D;Ot.rect(zt[0],zt[1],Ht,nn),Bt.clip(Ot)}class ct{constructor(){this.constructor===ct&&(0,at.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,at.unreachable)("Abstract method `getPattern` called.")}}class At extends ct{constructor(zt){super(),this._type=zt[1],this._bbox=zt[2],this._colorStops=zt[3],this._p0=zt[4],this._p1=zt[5],this._r0=zt[6],this._r1=zt[7],this.matrix=null}_createGradient(zt){let Ht;this._type==="axial"?Ht=zt.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(Ht=zt.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const nn of this._colorStops)Ht.addColorStop(nn[0],nn[1]);return Ht}getPattern(zt,Ht,nn,Ot){let Kt;if(Ot===pt.STROKE||Ot===pt.FILL){const mn=Ht.current.getClippedPathBoundingBox(Ot,(0,ut.getCurrentTransform)(zt))||[0,0,0,0],hn=Math.ceil(mn[2]-mn[0])||1,Yt=Math.ceil(mn[3]-mn[1])||1,vn=Ht.cachedCanvases.getCanvas("pattern",hn,Yt,!0),fn=vn.context;fn.clearRect(0,0,fn.canvas.width,fn.canvas.height),fn.beginPath(),fn.rect(0,0,fn.canvas.width,fn.canvas.height),fn.translate(-mn[0],-mn[1]),nn=at.Util.transform(nn,[1,0,0,1,mn[0],mn[1]]),fn.transform(...Ht.baseTransform),this.matrix&&fn.transform(...this.matrix),yt(fn,this._bbox),fn.fillStyle=this._createGradient(fn),fn.fill(),Kt=zt.createPattern(vn.canvas,"no-repeat");const Wn=new DOMMatrix(nn);Kt.setTransform(Wn)}else yt(zt,this._bbox),Kt=this._createGradient(zt);return Kt}}function Pt(Bt,zt,Ht,nn,Ot,Kt,mn,hn){const Yt=zt.coords,vn=zt.colors,fn=Bt.data,Wn=Bt.width*4;let Xn;Yt[Ht+1]>Yt[nn+1]&&(Xn=Ht,Ht=nn,nn=Xn,Xn=Kt,Kt=mn,mn=Xn),Yt[nn+1]>Yt[Ot+1]&&(Xn=nn,nn=Ot,Ot=Xn,Xn=mn,mn=hn,hn=Xn),Yt[Ht+1]>Yt[nn+1]&&(Xn=Ht,Ht=nn,nn=Xn,Xn=Kt,Kt=mn,mn=Xn);const Sn=(Yt[Ht]+zt.offsetX)*zt.scaleX,_i=(Yt[Ht+1]+zt.offsetY)*zt.scaleY,gr=(Yt[nn]+zt.offsetX)*zt.scaleX,br=(Yt[nn+1]+zt.offsetY)*zt.scaleY,Pn=(Yt[Ot]+zt.offsetX)*zt.scaleX,lr=(Yt[Ot+1]+zt.offsetY)*zt.scaleY;if(_i>=lr)return;const xr=vn[Kt],Dr=vn[Kt+1],$r=vn[Kt+2],An=vn[mn],Nt=vn[mn+1],Zt=vn[mn+2],$t=vn[hn],rn=vn[hn+1],an=vn[hn+2],En=Math.round(_i),Mn=Math.round(lr);let jn,dr,cr,wr,Rr,On,Mr,ts;for(let Jr=En;Jr<=Mn;Jr++){if(Jr<br){const or=Jr<_i?0:(_i-Jr)/(_i-br);jn=Sn-(Sn-gr)*or,dr=xr-(xr-An)*or,cr=Dr-(Dr-Nt)*or,wr=$r-($r-Zt)*or}else{let or;Jr>lr?or=1:br===lr?or=0:or=(br-Jr)/(br-lr),jn=gr-(gr-Pn)*or,dr=An-(An-$t)*or,cr=Nt-(Nt-rn)*or,wr=Zt-(Zt-an)*or}let jr;Jr<_i?jr=0:Jr>lr?jr=1:jr=(_i-Jr)/(_i-lr),Rr=Sn-(Sn-Pn)*jr,On=xr-(xr-$t)*jr,Mr=Dr-(Dr-rn)*jr,ts=$r-($r-an)*jr;const ss=Math.round(Math.min(jn,Rr)),Lr=Math.round(Math.max(jn,Rr));let hr=Wn*Jr+ss*4;for(let or=ss;or<=Lr;or++)jr=(jn-or)/(jn-Rr),jr<0?jr=0:jr>1&&(jr=1),fn[hr++]=dr-(dr-On)*jr|0,fn[hr++]=cr-(cr-Mr)*jr|0,fn[hr++]=wr-(wr-ts)*jr|0,fn[hr++]=255}}function kt(Bt,zt,Ht){const nn=zt.coords,Ot=zt.colors;let Kt,mn;switch(zt.type){case"lattice":const hn=zt.verticesPerRow,Yt=Math.floor(nn.length/hn)-1,vn=hn-1;for(Kt=0;Kt<Yt;Kt++){let fn=Kt*hn;for(let Wn=0;Wn<vn;Wn++,fn++)Pt(Bt,Ht,nn[fn],nn[fn+1],nn[fn+hn],Ot[fn],Ot[fn+1],Ot[fn+hn]),Pt(Bt,Ht,nn[fn+hn+1],nn[fn+1],nn[fn+hn],Ot[fn+hn+1],Ot[fn+1],Ot[fn+hn])}break;case"triangles":for(Kt=0,mn=nn.length;Kt<mn;Kt+=3)Pt(Bt,Ht,nn[Kt],nn[Kt+1],nn[Kt+2],Ot[Kt],Ot[Kt+1],Ot[Kt+2]);break;default:throw new Error("illegal figure")}}class Lt extends ct{constructor(zt){super(),this._coords=zt[2],this._colors=zt[3],this._figures=zt[4],this._bounds=zt[5],this._bbox=zt[7],this._background=zt[8],this.matrix=null}_createMeshCanvas(zt,Ht,nn){const hn=Math.floor(this._bounds[0]),Yt=Math.floor(this._bounds[1]),vn=Math.ceil(this._bounds[2])-hn,fn=Math.ceil(this._bounds[3])-Yt,Wn=Math.min(Math.ceil(Math.abs(vn*zt[0]*1.1)),3e3),Xn=Math.min(Math.ceil(Math.abs(fn*zt[1]*1.1)),3e3),Sn=vn/Wn,_i=fn/Xn,gr={coords:this._coords,colors:this._colors,offsetX:-hn,offsetY:-Yt,scaleX:1/Sn,scaleY:1/_i},br=Wn+2*2,Pn=Xn+2*2,lr=nn.getCanvas("mesh",br,Pn,!1),xr=lr.context,Dr=xr.createImageData(Wn,Xn);if(Ht){const An=Dr.data;for(let Nt=0,Zt=An.length;Nt<Zt;Nt+=4)An[Nt]=Ht[0],An[Nt+1]=Ht[1],An[Nt+2]=Ht[2],An[Nt+3]=255}for(const An of this._figures)kt(Dr,An,gr);return xr.putImageData(Dr,2,2),{canvas:lr.canvas,offsetX:hn-2*Sn,offsetY:Yt-2*_i,scaleX:Sn,scaleY:_i}}getPattern(zt,Ht,nn,Ot){yt(zt,this._bbox);let Kt;if(Ot===pt.SHADING)Kt=at.Util.singularValueDecompose2dScale((0,ut.getCurrentTransform)(zt));else if(Kt=at.Util.singularValueDecompose2dScale(Ht.baseTransform),this.matrix){const hn=at.Util.singularValueDecompose2dScale(this.matrix);Kt=[Kt[0]*hn[0],Kt[1]*hn[1]]}const mn=this._createMeshCanvas(Kt,Ot===pt.SHADING?null:this._background,Ht.cachedCanvases);return Ot!==pt.SHADING&&(zt.setTransform(...Ht.baseTransform),this.matrix&&zt.transform(...this.matrix)),zt.translate(mn.offsetX,mn.offsetY),zt.scale(mn.scaleX,mn.scaleY),zt.createPattern(mn.canvas,"no-repeat")}}class Mt extends ct{getPattern(){return"hotpink"}}function Qt(Bt){switch(Bt[0]){case"RadialAxial":return new At(Bt);case"Mesh":return new Lt(Bt);case"Dummy":return new Mt}throw new Error(`Unknown IR type: ${Bt[0]}`)}const Jt={COLORED:1,UNCOLORED:2},tn=class tn{constructor(zt,Ht,nn,Ot,Kt){this.operatorList=zt[2],this.matrix=zt[3]||[1,0,0,1,0,0],this.bbox=zt[4],this.xstep=zt[5],this.ystep=zt[6],this.paintType=zt[7],this.tilingType=zt[8],this.color=Ht,this.ctx=nn,this.canvasGraphicsFactory=Ot,this.baseTransform=Kt}createPatternCanvas(zt){const Ht=this.operatorList,nn=this.bbox,Ot=this.xstep,Kt=this.ystep,mn=this.paintType,hn=this.tilingType,Yt=this.color,vn=this.canvasGraphicsFactory;(0,at.info)("TilingType: "+hn);const fn=nn[0],Wn=nn[1],Xn=nn[2],Sn=nn[3],_i=at.Util.singularValueDecompose2dScale(this.matrix),gr=at.Util.singularValueDecompose2dScale(this.baseTransform),br=[_i[0]*gr[0],_i[1]*gr[1]],Pn=this.getSizeAndScale(Ot,this.ctx.canvas.width,br[0]),lr=this.getSizeAndScale(Kt,this.ctx.canvas.height,br[1]),xr=zt.cachedCanvases.getCanvas("pattern",Pn.size,lr.size,!0),Dr=xr.context,$r=vn.createCanvasGraphics(Dr);$r.groupLevel=zt.groupLevel,this.setFillAndStrokeStyleToContext($r,mn,Yt);let An=fn,Nt=Wn,Zt=Xn,$t=Sn;return fn<0&&(An=0,Zt+=Math.abs(fn)),Wn<0&&(Nt=0,$t+=Math.abs(Wn)),Dr.translate(-(Pn.scale*An),-(lr.scale*Nt)),$r.transform(Pn.scale,0,0,lr.scale,0,0),Dr.save(),this.clipBbox($r,An,Nt,Zt,$t),$r.baseTransform=(0,ut.getCurrentTransform)($r.ctx),$r.executeOperatorList(Ht),$r.endDrawing(),{canvas:xr.canvas,scaleX:Pn.scale,scaleY:lr.scale,offsetX:An,offsetY:Nt}}getSizeAndScale(zt,Ht,nn){zt=Math.abs(zt);const Ot=Math.max(tn.MAX_PATTERN_SIZE,Ht);let Kt=Math.ceil(zt*nn);return Kt>=Ot?Kt=Ot:nn=Kt/zt,{scale:nn,size:Kt}}clipBbox(zt,Ht,nn,Ot,Kt){const mn=Ot-Ht,hn=Kt-nn;zt.ctx.rect(Ht,nn,mn,hn),zt.current.updateRectMinMax((0,ut.getCurrentTransform)(zt.ctx),[Ht,nn,Ot,Kt]),zt.clip(),zt.endPath()}setFillAndStrokeStyleToContext(zt,Ht,nn){const Ot=zt.ctx,Kt=zt.current;switch(Ht){case Jt.COLORED:const mn=this.ctx;Ot.fillStyle=mn.fillStyle,Ot.strokeStyle=mn.strokeStyle,Kt.fillColor=mn.fillStyle,Kt.strokeColor=mn.strokeStyle;break;case Jt.UNCOLORED:const hn=at.Util.makeHexColor(nn[0],nn[1],nn[2]);Ot.fillStyle=hn,Ot.strokeStyle=hn,Kt.fillColor=hn,Kt.strokeColor=hn;break;default:throw new at.FormatError(`Unsupported paint type: ${Ht}`)}}getPattern(zt,Ht,nn,Ot){let Kt=nn;Ot!==pt.SHADING&&(Kt=at.Util.transform(Kt,Ht.baseTransform),this.matrix&&(Kt=at.Util.transform(Kt,this.matrix)));const mn=this.createPatternCanvas(Ht);let hn=new DOMMatrix(Kt);hn=hn.translate(mn.offsetX,mn.offsetY),hn=hn.scale(1/mn.scaleX,1/mn.scaleY);const Yt=zt.createPattern(mn.canvas,"repeat");return Yt.setTransform(hn),Yt}};$o(tn,"MAX_PATTERN_SIZE",3e3);let sn=tn;et.TilingPattern=sn},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.convertBlackAndWhiteToRGBA=pt,et.convertToRGBA=ut,et.grayToRGBA=ct;var at=rt(1);function ut(At){switch(At.kind){case at.ImageKind.GRAYSCALE_1BPP:return pt(At);case at.ImageKind.RGB_24BPP:return yt(At)}return null}function pt({src:At,srcPos:Pt=0,dest:kt,width:Lt,height:Mt,nonBlackColor:Qt=4294967295,inverseDecode:Jt=!1}){const sn=at.FeatureTest.isLittleEndian?4278190080:255,[tn,Bt]=Jt?[Qt,sn]:[sn,Qt],zt=Lt>>3,Ht=Lt&7,nn=At.length;kt=new Uint32Array(kt.buffer);let Ot=0;for(let Kt=0;Kt<Mt;Kt++){for(const hn=Pt+zt;Pt<hn;Pt++){const Yt=Pt<nn?At[Pt]:255;kt[Ot++]=Yt&128?Bt:tn,kt[Ot++]=Yt&64?Bt:tn,kt[Ot++]=Yt&32?Bt:tn,kt[Ot++]=Yt&16?Bt:tn,kt[Ot++]=Yt&8?Bt:tn,kt[Ot++]=Yt&4?Bt:tn,kt[Ot++]=Yt&2?Bt:tn,kt[Ot++]=Yt&1?Bt:tn}if(Ht===0)continue;const mn=Pt<nn?At[Pt++]:255;for(let hn=0;hn<Ht;hn++)kt[Ot++]=mn&1<<7-hn?Bt:tn}return{srcPos:Pt,destPos:Ot}}function yt({src:At,srcPos:Pt=0,dest:kt,destPos:Lt=0,width:Mt,height:Qt}){let Jt=0;const sn=At.length>>2,tn=new Uint32Array(At.buffer,Pt,sn);if(at.FeatureTest.isLittleEndian){for(;Jt<sn-2;Jt+=3,Lt+=4){const Bt=tn[Jt],zt=tn[Jt+1],Ht=tn[Jt+2];kt[Lt]=Bt|4278190080,kt[Lt+1]=Bt>>>24|zt<<8|4278190080,kt[Lt+2]=zt>>>16|Ht<<16|4278190080,kt[Lt+3]=Ht>>>8|4278190080}for(let Bt=Jt*4,zt=At.length;Bt<zt;Bt+=3)kt[Lt++]=At[Bt]|At[Bt+1]<<8|At[Bt+2]<<16|4278190080}else{for(;Jt<sn-2;Jt+=3,Lt+=4){const Bt=tn[Jt],zt=tn[Jt+1],Ht=tn[Jt+2];kt[Lt]=Bt|255,kt[Lt+1]=Bt<<24|zt>>>8|255,kt[Lt+2]=zt<<16|Ht>>>16|255,kt[Lt+3]=Ht<<8|255}for(let Bt=Jt*4,zt=At.length;Bt<zt;Bt+=3)kt[Lt++]=At[Bt]<<24|At[Bt+1]<<16|At[Bt+2]<<8|255}return{srcPos:Pt,destPos:Lt}}function ct(At,Pt){if(at.FeatureTest.isLittleEndian)for(let kt=0,Lt=At.length;kt<Lt;kt++)Pt[kt]=At[kt]*65793|4278190080;else for(let kt=0,Lt=At.length;kt<Lt;kt++)Pt[kt]=At[kt]*16843008|255}},(_e,et)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.GlobalWorkerOptions=void 0;const rt=Object.create(null);et.GlobalWorkerOptions=rt,rt.workerPort=null,rt.workerSrc=""},(_e,et,rt)=>{var At,x1,kt,b1,Mt,Uy;Object.defineProperty(et,"__esModule",{value:!0}),et.MessageHandler=void 0;var at=rt(1);const ut={UNKNOWN:0,DATA:1,ERROR:2},pt={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function yt(Jt){switch(Jt instanceof Error||typeof Jt=="object"&&Jt!==null||(0,at.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),Jt.name){case"AbortException":return new at.AbortException(Jt.message);case"MissingPDFException":return new at.MissingPDFException(Jt.message);case"PasswordException":return new at.PasswordException(Jt.message,Jt.code);case"UnexpectedResponseException":return new at.UnexpectedResponseException(Jt.message,Jt.status);case"UnknownErrorException":return new at.UnknownErrorException(Jt.message,Jt.details);default:return new at.UnknownErrorException(Jt.message,Jt.toString())}}class ct{constructor(sn,tn,Bt){Bn(this,At);Bn(this,kt);Bn(this,Mt);this.sourceName=sn,this.targetName=tn,this.comObj=Bt,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=zt=>{const Ht=zt.data;if(Ht.targetName!==this.sourceName)return;if(Ht.stream){nr(this,kt,b1).call(this,Ht);return}if(Ht.callback){const Ot=Ht.callbackId,Kt=this.callbackCapabilities[Ot];if(!Kt)throw new Error(`Cannot resolve callback ${Ot}`);if(delete this.callbackCapabilities[Ot],Ht.callback===ut.DATA)Kt.resolve(Ht.data);else if(Ht.callback===ut.ERROR)Kt.reject(yt(Ht.reason));else throw new Error("Unexpected callback case");return}const nn=this.actionHandler[Ht.action];if(!nn)throw new Error(`Unknown action from worker: ${Ht.action}`);if(Ht.callbackId){const Ot=this.sourceName,Kt=Ht.sourceName;new Promise(function(mn){mn(nn(Ht.data))}).then(function(mn){Bt.postMessage({sourceName:Ot,targetName:Kt,callback:ut.DATA,callbackId:Ht.callbackId,data:mn})},function(mn){Bt.postMessage({sourceName:Ot,targetName:Kt,callback:ut.ERROR,callbackId:Ht.callbackId,reason:yt(mn)})});return}if(Ht.streamId){nr(this,At,x1).call(this,Ht);return}nn(Ht.data)},Bt.addEventListener("message",this._onComObjOnMessage)}on(sn,tn){const Bt=this.actionHandler;if(Bt[sn])throw new Error(`There is already an actionName called "${sn}"`);Bt[sn]=tn}send(sn,tn,Bt){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:sn,data:tn},Bt)}sendWithPromise(sn,tn,Bt){const zt=this.callbackId++,Ht=new at.PromiseCapability;this.callbackCapabilities[zt]=Ht;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:sn,callbackId:zt,data:tn},Bt)}catch(nn){Ht.reject(nn)}return Ht.promise}sendWithStream(sn,tn,Bt,zt){const Ht=this.streamId++,nn=this.sourceName,Ot=this.targetName,Kt=this.comObj;return new ReadableStream({start:mn=>{const hn=new at.PromiseCapability;return this.streamControllers[Ht]={controller:mn,startCall:hn,pullCall:null,cancelCall:null,isClosed:!1},Kt.postMessage({sourceName:nn,targetName:Ot,action:sn,streamId:Ht,data:tn,desiredSize:mn.desiredSize},zt),hn.promise},pull:mn=>{const hn=new at.PromiseCapability;return this.streamControllers[Ht].pullCall=hn,Kt.postMessage({sourceName:nn,targetName:Ot,stream:pt.PULL,streamId:Ht,desiredSize:mn.desiredSize}),hn.promise},cancel:mn=>{(0,at.assert)(mn instanceof Error,"cancel must have a valid reason");const hn=new at.PromiseCapability;return this.streamControllers[Ht].cancelCall=hn,this.streamControllers[Ht].isClosed=!0,Kt.postMessage({sourceName:nn,targetName:Ot,stream:pt.CANCEL,streamId:Ht,reason:yt(mn)}),hn.promise}},Bt)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}At=new WeakSet,x1=function(sn){const tn=sn.streamId,Bt=this.sourceName,zt=sn.sourceName,Ht=this.comObj,nn=this,Ot=this.actionHandler[sn.action],Kt={enqueue(mn,hn=1,Yt){if(this.isCancelled)return;const vn=this.desiredSize;this.desiredSize-=hn,vn>0&&this.desiredSize<=0&&(this.sinkCapability=new at.PromiseCapability,this.ready=this.sinkCapability.promise),Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.ENQUEUE,streamId:tn,chunk:mn},Yt)},close(){this.isCancelled||(this.isCancelled=!0,Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.CLOSE,streamId:tn}),delete nn.streamSinks[tn])},error(mn){(0,at.assert)(mn instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.ERROR,streamId:tn,reason:yt(mn)}))},sinkCapability:new at.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:sn.desiredSize,ready:null};Kt.sinkCapability.resolve(),Kt.ready=Kt.sinkCapability.promise,this.streamSinks[tn]=Kt,new Promise(function(mn){mn(Ot(sn.data,Kt))}).then(function(){Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.START_COMPLETE,streamId:tn,success:!0})},function(mn){Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.START_COMPLETE,streamId:tn,reason:yt(mn)})})},kt=new WeakSet,b1=function(sn){const tn=sn.streamId,Bt=this.sourceName,zt=sn.sourceName,Ht=this.comObj,nn=this.streamControllers[tn],Ot=this.streamSinks[tn];switch(sn.stream){case pt.START_COMPLETE:sn.success?nn.startCall.resolve():nn.startCall.reject(yt(sn.reason));break;case pt.PULL_COMPLETE:sn.success?nn.pullCall.resolve():nn.pullCall.reject(yt(sn.reason));break;case pt.PULL:if(!Ot){Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.PULL_COMPLETE,streamId:tn,success:!0});break}Ot.desiredSize<=0&&sn.desiredSize>0&&Ot.sinkCapability.resolve(),Ot.desiredSize=sn.desiredSize,new Promise(function(Kt){var mn;Kt((mn=Ot.onPull)==null?void 0:mn.call(Ot))}).then(function(){Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.PULL_COMPLETE,streamId:tn,success:!0})},function(Kt){Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.PULL_COMPLETE,streamId:tn,reason:yt(Kt)})});break;case pt.ENQUEUE:if((0,at.assert)(nn,"enqueue should have stream controller"),nn.isClosed)break;nn.controller.enqueue(sn.chunk);break;case pt.CLOSE:if((0,at.assert)(nn,"close should have stream controller"),nn.isClosed)break;nn.isClosed=!0,nn.controller.close(),nr(this,Mt,Uy).call(this,nn,tn);break;case pt.ERROR:(0,at.assert)(nn,"error should have stream controller"),nn.controller.error(yt(sn.reason)),nr(this,Mt,Uy).call(this,nn,tn);break;case pt.CANCEL_COMPLETE:sn.success?nn.cancelCall.resolve():nn.cancelCall.reject(yt(sn.reason)),nr(this,Mt,Uy).call(this,nn,tn);break;case pt.CANCEL:if(!Ot)break;new Promise(function(Kt){var mn;Kt((mn=Ot.onCancel)==null?void 0:mn.call(Ot,yt(sn.reason)))}).then(function(){Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.CANCEL_COMPLETE,streamId:tn,success:!0})},function(Kt){Ht.postMessage({sourceName:Bt,targetName:zt,stream:pt.CANCEL_COMPLETE,streamId:tn,reason:yt(Kt)})}),Ot.sinkCapability.reject(yt(sn.reason)),Ot.isCancelled=!0,delete this.streamSinks[tn];break;default:throw new Error("Unexpected stream case")}},Mt=new WeakSet,Uy=async function(sn,tn){var Bt,zt,Ht;await Promise.allSettled([(Bt=sn.startCall)==null?void 0:Bt.promise,(zt=sn.pullCall)==null?void 0:zt.promise,(Ht=sn.cancelCall)==null?void 0:Ht.promise]),delete this.streamControllers[tn]},et.MessageHandler=ct},(_e,et,rt)=>{var pt,yt;Object.defineProperty(et,"__esModule",{value:!0}),et.Metadata=void 0;var at=rt(1);class ut{constructor({parsedData:At,rawData:Pt}){Bn(this,pt,void 0);Bn(this,yt,void 0);yr(this,pt,At),yr(this,yt,Pt)}getRaw(){return It(this,yt)}get(At){return It(this,pt).get(At)??null}getAll(){return(0,at.objectFromMap)(It(this,pt))}has(At){return It(this,pt).has(At)}}pt=new WeakMap,yt=new WeakMap,et.Metadata=ut},(_e,et,rt)=>{var At,Pt,kt,Lt,Mt,Qt,hv;Object.defineProperty(et,"__esModule",{value:!0}),et.OptionalContentConfig=void 0;var at=rt(1),ut=rt(8);const pt=Symbol("INTERNAL");class yt{constructor(tn,Bt){Bn(this,At,!0);this.name=tn,this.intent=Bt}get visible(){return It(this,At)}_setVisible(tn,Bt){tn!==pt&&(0,at.unreachable)("Internal method `_setVisible` called."),yr(this,At,Bt)}}At=new WeakMap;class ct{constructor(tn){Bn(this,Qt);Bn(this,Pt,null);Bn(this,kt,new Map);Bn(this,Lt,null);Bn(this,Mt,null);if(this.name=null,this.creator=null,tn!==null){this.name=tn.name,this.creator=tn.creator,yr(this,Mt,tn.order);for(const Bt of tn.groups)It(this,kt).set(Bt.id,new yt(Bt.name,Bt.intent));if(tn.baseState==="OFF")for(const Bt of It(this,kt).values())Bt._setVisible(pt,!1);for(const Bt of tn.on)It(this,kt).get(Bt)._setVisible(pt,!0);for(const Bt of tn.off)It(this,kt).get(Bt)._setVisible(pt,!1);yr(this,Lt,this.getHash())}}isVisible(tn){if(It(this,kt).size===0)return!0;if(!tn)return(0,at.warn)("Optional content group not defined."),!0;if(tn.type==="OCG")return It(this,kt).has(tn.id)?It(this,kt).get(tn.id).visible:((0,at.warn)(`Optional content group not found: ${tn.id}`),!0);if(tn.type==="OCMD"){if(tn.expression)return nr(this,Qt,hv).call(this,tn.expression);if(!tn.policy||tn.policy==="AnyOn"){for(const Bt of tn.ids){if(!It(this,kt).has(Bt))return(0,at.warn)(`Optional content group not found: ${Bt}`),!0;if(It(this,kt).get(Bt).visible)return!0}return!1}else if(tn.policy==="AllOn"){for(const Bt of tn.ids){if(!It(this,kt).has(Bt))return(0,at.warn)(`Optional content group not found: ${Bt}`),!0;if(!It(this,kt).get(Bt).visible)return!1}return!0}else if(tn.policy==="AnyOff"){for(const Bt of tn.ids){if(!It(this,kt).has(Bt))return(0,at.warn)(`Optional content group not found: ${Bt}`),!0;if(!It(this,kt).get(Bt).visible)return!0}return!1}else if(tn.policy==="AllOff"){for(const Bt of tn.ids){if(!It(this,kt).has(Bt))return(0,at.warn)(`Optional content group not found: ${Bt}`),!0;if(It(this,kt).get(Bt).visible)return!1}return!0}return(0,at.warn)(`Unknown optional content policy ${tn.policy}.`),!0}return(0,at.warn)(`Unknown group type ${tn.type}.`),!0}setVisibility(tn,Bt=!0){if(!It(this,kt).has(tn)){(0,at.warn)(`Optional content group not found: ${tn}`);return}It(this,kt).get(tn)._setVisible(pt,!!Bt),yr(this,Pt,null)}get hasInitialVisibility(){return It(this,Lt)===null||this.getHash()===It(this,Lt)}getOrder(){return It(this,kt).size?It(this,Mt)?It(this,Mt).slice():[...It(this,kt).keys()]:null}getGroups(){return It(this,kt).size>0?(0,at.objectFromMap)(It(this,kt)):null}getGroup(tn){return It(this,kt).get(tn)||null}getHash(){if(It(this,Pt)!==null)return It(this,Pt);const tn=new ut.MurmurHash3_64;for(const[Bt,zt]of It(this,kt))tn.update(`${Bt}:${zt.visible}`);return yr(this,Pt,tn.hexdigest())}}Pt=new WeakMap,kt=new WeakMap,Lt=new WeakMap,Mt=new WeakMap,Qt=new WeakSet,hv=function(tn){const Bt=tn.length;if(Bt<2)return!0;const zt=tn[0];for(let Ht=1;Ht<Bt;Ht++){const nn=tn[Ht];let Ot;if(Array.isArray(nn))Ot=nr(this,Qt,hv).call(this,nn);else if(It(this,kt).has(nn))Ot=It(this,kt).get(nn).visible;else return(0,at.warn)(`Optional content group not found: ${nn}`),!0;switch(zt){case"And":if(!Ot)return!1;break;case"Or":if(Ot)return!0;break;case"Not":return!Ot;default:return!0}}return zt==="And"},et.OptionalContentConfig=ct},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.PDFDataTransportStream=void 0;var at=rt(1),ut=rt(6);class pt{constructor({length:Pt,initialData:kt,progressiveDone:Lt=!1,contentDispositionFilename:Mt=null,disableRange:Qt=!1,disableStream:Jt=!1},sn){if((0,at.assert)(sn,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=Lt,this._contentDispositionFilename=Mt,(kt==null?void 0:kt.length)>0){const tn=kt instanceof Uint8Array&&kt.byteLength===kt.buffer.byteLength?kt.buffer:new Uint8Array(kt).buffer;this._queuedChunks.push(tn)}this._pdfDataRangeTransport=sn,this._isStreamingSupported=!Jt,this._isRangeSupported=!Qt,this._contentLength=Pt,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((tn,Bt)=>{this._onReceiveData({begin:tn,chunk:Bt})}),this._pdfDataRangeTransport.addProgressListener((tn,Bt)=>{this._onProgress({loaded:tn,total:Bt})}),this._pdfDataRangeTransport.addProgressiveReadListener(tn=>{this._onReceiveData({chunk:tn})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:Pt,chunk:kt}){const Lt=kt instanceof Uint8Array&&kt.byteLength===kt.buffer.byteLength?kt.buffer:new Uint8Array(kt).buffer;if(Pt===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(Lt):this._queuedChunks.push(Lt);else{const Mt=this._rangeReaders.some(function(Qt){return Qt._begin!==Pt?!1:(Qt._enqueue(Lt),!0)});(0,at.assert)(Mt,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var Pt;return((Pt=this._fullRequestReader)==null?void 0:Pt._loaded)??0}_onProgress(Pt){var kt,Lt,Mt,Qt;Pt.total===void 0?(Lt=(kt=this._rangeReaders[0])==null?void 0:kt.onProgress)==null||Lt.call(kt,{loaded:Pt.loaded}):(Qt=(Mt=this._fullRequestReader)==null?void 0:Mt.onProgress)==null||Qt.call(Mt,{loaded:Pt.loaded,total:Pt.total})}_onProgressiveDone(){var Pt;(Pt=this._fullRequestReader)==null||Pt.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(Pt){const kt=this._rangeReaders.indexOf(Pt);kt>=0&&this._rangeReaders.splice(kt,1)}getFullReader(){(0,at.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const Pt=this._queuedChunks;return this._queuedChunks=null,new yt(this,Pt,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(Pt,kt){if(kt<=this._progressiveDataLength)return null;const Lt=new ct(this,Pt,kt);return this._pdfDataRangeTransport.requestDataRange(Pt,kt),this._rangeReaders.push(Lt),Lt}cancelAllRequests(Pt){var kt;(kt=this._fullRequestReader)==null||kt.cancel(Pt);for(const Lt of this._rangeReaders.slice(0))Lt.cancel(Pt);this._pdfDataRangeTransport.abort()}}et.PDFDataTransportStream=pt;class yt{constructor(Pt,kt,Lt=!1,Mt=null){this._stream=Pt,this._done=Lt||!1,this._filename=(0,ut.isPdfFile)(Mt)?Mt:null,this._queuedChunks=kt||[],this._loaded=0;for(const Qt of this._queuedChunks)this._loaded+=Qt.byteLength;this._requests=[],this._headersReady=Promise.resolve(),Pt._fullRequestReader=this,this.onProgress=null}_enqueue(Pt){this._done||(this._requests.length>0?this._requests.shift().resolve({value:Pt,done:!1}):this._queuedChunks.push(Pt),this._loaded+=Pt.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const Pt=new at.PromiseCapability;return this._requests.push(Pt),Pt.promise}cancel(Pt){this._done=!0;for(const kt of this._requests)kt.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class ct{constructor(Pt,kt,Lt){this._stream=Pt,this._begin=kt,this._end=Lt,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(Pt){if(!this._done){if(this._requests.length===0)this._queuedChunk=Pt;else{this._requests.shift().resolve({value:Pt,done:!1});for(const Lt of this._requests)Lt.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const kt=this._queuedChunk;return this._queuedChunk=null,{value:kt,done:!1}}if(this._done)return{value:void 0,done:!0};const Pt=new at.PromiseCapability;return this._requests.push(Pt),Pt.promise}cancel(Pt){this._done=!0;for(const kt of this._requests)kt.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.PDFFetchStream=void 0;var at=rt(1),ut=rt(20);function pt(Lt,Mt,Qt){return{method:"GET",headers:Lt,signal:Qt.signal,mode:"cors",credentials:Mt?"include":"same-origin",redirect:"follow"}}function yt(Lt){const Mt=new Headers;for(const Qt in Lt){const Jt=Lt[Qt];Jt!==void 0&&Mt.append(Qt,Jt)}return Mt}function ct(Lt){return Lt instanceof Uint8Array?Lt.buffer:Lt instanceof ArrayBuffer?Lt:((0,at.warn)(`getArrayBuffer - unexpected data format: ${Lt}`),new Uint8Array(Lt).buffer)}class At{constructor(Mt){this.source=Mt,this.isHttp=/^https?:/i.test(Mt.url),this.httpHeaders=this.isHttp&&Mt.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var Mt;return((Mt=this._fullRequestReader)==null?void 0:Mt._loaded)??0}getFullReader(){return(0,at.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Pt(this),this._fullRequestReader}getRangeReader(Mt,Qt){if(Qt<=this._progressiveDataLength)return null;const Jt=new kt(this,Mt,Qt);return this._rangeRequestReaders.push(Jt),Jt}cancelAllRequests(Mt){var Qt;(Qt=this._fullRequestReader)==null||Qt.cancel(Mt);for(const Jt of this._rangeRequestReaders.slice(0))Jt.cancel(Mt)}}et.PDFFetchStream=At;class Pt{constructor(Mt){this._stream=Mt,this._reader=null,this._loaded=0,this._filename=null;const Qt=Mt.source;this._withCredentials=Qt.withCredentials||!1,this._contentLength=Qt.length,this._headersCapability=new at.PromiseCapability,this._disableRange=Qt.disableRange||!1,this._rangeChunkSize=Qt.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!Qt.disableStream,this._isRangeSupported=!Qt.disableRange,this._headers=yt(this._stream.httpHeaders);const Jt=Qt.url;fetch(Jt,pt(this._headers,this._withCredentials,this._abortController)).then(sn=>{if(!(0,ut.validateResponseStatus)(sn.status))throw(0,ut.createResponseStatusError)(sn.status,Jt);this._reader=sn.body.getReader(),this._headersCapability.resolve();const tn=Ht=>sn.headers.get(Ht),{allowRangeRequests:Bt,suggestedLength:zt}=(0,ut.validateRangeRequestCapabilities)({getResponseHeader:tn,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=Bt,this._contentLength=zt||this._contentLength,this._filename=(0,ut.extractFilenameFromHeader)(tn),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new at.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var Jt;await this._headersCapability.promise;const{value:Mt,done:Qt}=await this._reader.read();return Qt?{value:Mt,done:Qt}:(this._loaded+=Mt.byteLength,(Jt=this.onProgress)==null||Jt.call(this,{loaded:this._loaded,total:this._contentLength}),{value:ct(Mt),done:!1})}cancel(Mt){var Qt;(Qt=this._reader)==null||Qt.cancel(Mt),this._abortController.abort()}}class kt{constructor(Mt,Qt,Jt){this._stream=Mt,this._reader=null,this._loaded=0;const sn=Mt.source;this._withCredentials=sn.withCredentials||!1,this._readCapability=new at.PromiseCapability,this._isStreamingSupported=!sn.disableStream,this._abortController=new AbortController,this._headers=yt(this._stream.httpHeaders),this._headers.append("Range",`bytes=${Qt}-${Jt-1}`);const tn=sn.url;fetch(tn,pt(this._headers,this._withCredentials,this._abortController)).then(Bt=>{if(!(0,ut.validateResponseStatus)(Bt.status))throw(0,ut.createResponseStatusError)(Bt.status,tn);this._readCapability.resolve(),this._reader=Bt.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var Jt;await this._readCapability.promise;const{value:Mt,done:Qt}=await this._reader.read();return Qt?{value:Mt,done:Qt}:(this._loaded+=Mt.byteLength,(Jt=this.onProgress)==null||Jt.call(this,{loaded:this._loaded}),{value:ct(Mt),done:!1})}cancel(Mt){var Qt;(Qt=this._reader)==null||Qt.cancel(Mt),this._abortController.abort()}}},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.createResponseStatusError=At,et.extractFilenameFromHeader=ct,et.validateRangeRequestCapabilities=yt,et.validateResponseStatus=Pt;var at=rt(1),ut=rt(21),pt=rt(6);function yt({getResponseHeader:kt,isHttp:Lt,rangeChunkSize:Mt,disableRange:Qt}){const Jt={allowRangeRequests:!1,suggestedLength:void 0},sn=parseInt(kt("Content-Length"),10);return!Number.isInteger(sn)||(Jt.suggestedLength=sn,sn<=2*Mt)||Qt||!Lt||kt("Accept-Ranges")!=="bytes"||(kt("Content-Encoding")||"identity")!=="identity"||(Jt.allowRangeRequests=!0),Jt}function ct(kt){const Lt=kt("Content-Disposition");if(Lt){let Mt=(0,ut.getFilenameFromContentDispositionHeader)(Lt);if(Mt.includes("%"))try{Mt=decodeURIComponent(Mt)}catch{}if((0,pt.isPdfFile)(Mt))return Mt}return null}function At(kt,Lt){return kt===404||kt===0&&Lt.startsWith("file:")?new at.MissingPDFException('Missing PDF "'+Lt+'".'):new at.UnexpectedResponseException(`Unexpected server response (${kt}) while retrieving PDF "${Lt}".`,kt)}function Pt(kt){return kt===200||kt===206}},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.getFilenameFromContentDispositionHeader=ut;var at=rt(1);function ut(pt){let yt=!0,ct=At("filename\\*","i").exec(pt);if(ct){ct=ct[1];let sn=Mt(ct);return sn=unescape(sn),sn=Qt(sn),sn=Jt(sn),kt(sn)}if(ct=Lt(pt),ct){const sn=Jt(ct);return kt(sn)}if(ct=At("filename","i").exec(pt),ct){ct=ct[1];let sn=Mt(ct);return sn=Jt(sn),kt(sn)}function At(sn,tn){return new RegExp("(?:^|;)\\s*"+sn+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',tn)}function Pt(sn,tn){if(sn){if(!/^[\x00-\xFF]+$/.test(tn))return tn;try{const Bt=new TextDecoder(sn,{fatal:!0}),zt=(0,at.stringToBytes)(tn);tn=Bt.decode(zt),yt=!1}catch{}}return tn}function kt(sn){return yt&&/[\x80-\xff]/.test(sn)&&(sn=Pt("utf-8",sn),yt&&(sn=Pt("iso-8859-1",sn))),sn}function Lt(sn){const tn=[];let Bt;const zt=At("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(Bt=zt.exec(sn))!==null;){let[,nn,Ot,Kt]=Bt;if(nn=parseInt(nn,10),nn in tn){if(nn===0)break;continue}tn[nn]=[Ot,Kt]}const Ht=[];for(let nn=0;nn<tn.length&&nn in tn;++nn){let[Ot,Kt]=tn[nn];Kt=Mt(Kt),Ot&&(Kt=unescape(Kt),nn===0&&(Kt=Qt(Kt))),Ht.push(Kt)}return Ht.join("")}function Mt(sn){if(sn.startsWith('"')){const tn=sn.slice(1).split('\\"');for(let Bt=0;Bt<tn.length;++Bt){const zt=tn[Bt].indexOf('"');zt!==-1&&(tn[Bt]=tn[Bt].slice(0,zt),tn.length=Bt+1),tn[Bt]=tn[Bt].replaceAll(/\\(.)/g,"$1")}sn=tn.join('"')}return sn}function Qt(sn){const tn=sn.indexOf("'");if(tn===-1)return sn;const Bt=sn.slice(0,tn),Ht=sn.slice(tn+1).replace(/^[^']*'/,"");return Pt(Bt,Ht)}function Jt(sn){return!sn.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(sn)?sn:sn.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(tn,Bt,zt,Ht){if(zt==="q"||zt==="Q")return Ht=Ht.replaceAll("_"," "),Ht=Ht.replaceAll(/=([0-9a-fA-F]{2})/g,function(nn,Ot){return String.fromCharCode(parseInt(Ot,16))}),Pt(Bt,Ht);try{Ht=atob(Ht)}catch{}return Pt(Bt,Ht)})}return""}},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.PDFNetworkStream=void 0;var at=rt(1),ut=rt(20);const pt=200,yt=206;function ct(Mt){const Qt=Mt.response;return typeof Qt!="string"?Qt:(0,at.stringToBytes)(Qt).buffer}class At{constructor(Qt,Jt={}){this.url=Qt,this.isHttp=/^https?:/i.test(Qt),this.httpHeaders=this.isHttp&&Jt.httpHeaders||Object.create(null),this.withCredentials=Jt.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(Qt,Jt,sn){const tn={begin:Qt,end:Jt};for(const Bt in sn)tn[Bt]=sn[Bt];return this.request(tn)}requestFull(Qt){return this.request(Qt)}request(Qt){const Jt=new XMLHttpRequest,sn=this.currXhrId++,tn=this.pendingRequests[sn]={xhr:Jt};Jt.open("GET",this.url),Jt.withCredentials=this.withCredentials;for(const Bt in this.httpHeaders){const zt=this.httpHeaders[Bt];zt!==void 0&&Jt.setRequestHeader(Bt,zt)}return this.isHttp&&"begin"in Qt&&"end"in Qt?(Jt.setRequestHeader("Range",`bytes=${Qt.begin}-${Qt.end-1}`),tn.expectedStatus=yt):tn.expectedStatus=pt,Jt.responseType="arraybuffer",Qt.onError&&(Jt.onerror=function(Bt){Qt.onError(Jt.status)}),Jt.onreadystatechange=this.onStateChange.bind(this,sn),Jt.onprogress=this.onProgress.bind(this,sn),tn.onHeadersReceived=Qt.onHeadersReceived,tn.onDone=Qt.onDone,tn.onError=Qt.onError,tn.onProgress=Qt.onProgress,Jt.send(null),sn}onProgress(Qt,Jt){var tn;const sn=this.pendingRequests[Qt];sn&&((tn=sn.onProgress)==null||tn.call(sn,Jt))}onStateChange(Qt,Jt){var nn,Ot,Kt;const sn=this.pendingRequests[Qt];if(!sn)return;const tn=sn.xhr;if(tn.readyState>=2&&sn.onHeadersReceived&&(sn.onHeadersReceived(),delete sn.onHeadersReceived),tn.readyState!==4||!(Qt in this.pendingRequests))return;if(delete this.pendingRequests[Qt],tn.status===0&&this.isHttp){(nn=sn.onError)==null||nn.call(sn,tn.status);return}const Bt=tn.status||pt;if(!(Bt===pt&&sn.expectedStatus===yt)&&Bt!==sn.expectedStatus){(Ot=sn.onError)==null||Ot.call(sn,tn.status);return}const Ht=ct(tn);if(Bt===yt){const mn=tn.getResponseHeader("Content-Range"),hn=/bytes (\d+)-(\d+)\/(\d+)/.exec(mn);sn.onDone({begin:parseInt(hn[1],10),chunk:Ht})}else Ht?sn.onDone({begin:0,chunk:Ht}):(Kt=sn.onError)==null||Kt.call(sn,tn.status)}getRequestXhr(Qt){return this.pendingRequests[Qt].xhr}isPendingRequest(Qt){return Qt in this.pendingRequests}abortRequest(Qt){const Jt=this.pendingRequests[Qt].xhr;delete this.pendingRequests[Qt],Jt.abort()}}class Pt{constructor(Qt){this._source=Qt,this._manager=new At(Qt.url,{httpHeaders:Qt.httpHeaders,withCredentials:Qt.withCredentials}),this._rangeChunkSize=Qt.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(Qt){const Jt=this._rangeRequestReaders.indexOf(Qt);Jt>=0&&this._rangeRequestReaders.splice(Jt,1)}getFullReader(){return(0,at.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new kt(this._manager,this._source),this._fullRequestReader}getRangeReader(Qt,Jt){const sn=new Lt(this._manager,Qt,Jt);return sn.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(sn),sn}cancelAllRequests(Qt){var Jt;(Jt=this._fullRequestReader)==null||Jt.cancel(Qt);for(const sn of this._rangeRequestReaders.slice(0))sn.cancel(Qt)}}et.PDFNetworkStream=Pt;class kt{constructor(Qt,Jt){this._manager=Qt;const sn={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=Jt.url,this._fullRequestId=Qt.requestFull(sn),this._headersReceivedCapability=new at.PromiseCapability,this._disableRange=Jt.disableRange||!1,this._contentLength=Jt.length,this._rangeChunkSize=Jt.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const Qt=this._fullRequestId,Jt=this._manager.getRequestXhr(Qt),sn=zt=>Jt.getResponseHeader(zt),{allowRangeRequests:tn,suggestedLength:Bt}=(0,ut.validateRangeRequestCapabilities)({getResponseHeader:sn,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});tn&&(this._isRangeSupported=!0),this._contentLength=Bt||this._contentLength,this._filename=(0,ut.extractFilenameFromHeader)(sn),this._isRangeSupported&&this._manager.abortRequest(Qt),this._headersReceivedCapability.resolve()}_onDone(Qt){if(Qt&&(this._requests.length>0?this._requests.shift().resolve({value:Qt.chunk,done:!1}):this._cachedChunks.push(Qt.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const Jt of this._requests)Jt.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(Qt){this._storedError=(0,ut.createResponseStatusError)(Qt,this._url),this._headersReceivedCapability.reject(this._storedError);for(const Jt of this._requests)Jt.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(Qt){var Jt;(Jt=this.onProgress)==null||Jt.call(this,{loaded:Qt.loaded,total:Qt.lengthComputable?Qt.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const Qt=new at.PromiseCapability;return this._requests.push(Qt),Qt.promise}cancel(Qt){this._done=!0,this._headersReceivedCapability.reject(Qt);for(const Jt of this._requests)Jt.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Lt{constructor(Qt,Jt,sn){this._manager=Qt;const tn={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=Qt.url,this._requestId=Qt.requestRange(Jt,sn,tn),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var Qt;(Qt=this.onClosed)==null||Qt.call(this,this)}_onDone(Qt){const Jt=Qt.chunk;this._requests.length>0?this._requests.shift().resolve({value:Jt,done:!1}):this._queuedChunk=Jt,this._done=!0;for(const sn of this._requests)sn.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(Qt){this._storedError=(0,ut.createResponseStatusError)(Qt,this._url);for(const Jt of this._requests)Jt.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(Qt){var Jt;this.isStreamingSupported||(Jt=this.onProgress)==null||Jt.call(this,{loaded:Qt.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const Jt=this._queuedChunk;return this._queuedChunk=null,{value:Jt,done:!1}}if(this._done)return{value:void 0,done:!0};const Qt=new at.PromiseCapability;return this._requests.push(Qt),Qt.promise}cancel(Qt){this._done=!0;for(const Jt of this._requests)Jt.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.PDFNodeStream=void 0;var at=rt(1),ut=rt(20);const pt=/^file:\/\/\/[a-zA-Z]:\//;function yt(sn){const tn=require$$5,Bt=tn.parse(sn);return Bt.protocol==="file:"||Bt.host?Bt:/^[a-z]:[/\\]/i.test(sn)?tn.parse(`file:///${sn}`):(Bt.host||(Bt.protocol="file:"),Bt)}class ct{constructor(tn){this.source=tn,this.url=yt(tn.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&tn.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var tn;return((tn=this._fullRequestReader)==null?void 0:tn._loaded)??0}getFullReader(){return(0,at.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new Qt(this):new Lt(this),this._fullRequestReader}getRangeReader(tn,Bt){if(Bt<=this._progressiveDataLength)return null;const zt=this.isFsUrl?new Jt(this,tn,Bt):new Mt(this,tn,Bt);return this._rangeRequestReaders.push(zt),zt}cancelAllRequests(tn){var Bt;(Bt=this._fullRequestReader)==null||Bt.cancel(tn);for(const zt of this._rangeRequestReaders.slice(0))zt.cancel(tn)}}et.PDFNodeStream=ct;class At{constructor(tn){this._url=tn.url,this._done=!1,this._storedError=null,this.onProgress=null;const Bt=tn.source;this._contentLength=Bt.length,this._loaded=0,this._filename=null,this._disableRange=Bt.disableRange||!1,this._rangeChunkSize=Bt.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!Bt.disableStream,this._isRangeSupported=!Bt.disableRange,this._readableStream=null,this._readCapability=new at.PromiseCapability,this._headersCapability=new at.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var zt;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const tn=this._readableStream.read();return tn===null?(this._readCapability=new at.PromiseCapability,this.read()):(this._loaded+=tn.length,(zt=this.onProgress)==null||zt.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(tn).buffer,done:!1})}cancel(tn){if(!this._readableStream){this._error(tn);return}this._readableStream.destroy(tn)}_error(tn){this._storedError=tn,this._readCapability.resolve()}_setReadableStream(tn){this._readableStream=tn,tn.on("readable",()=>{this._readCapability.resolve()}),tn.on("end",()=>{tn.destroy(),this._done=!0,this._readCapability.resolve()}),tn.on("error",Bt=>{this._error(Bt)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new at.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Pt{constructor(tn){this._url=tn.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new at.PromiseCapability;const Bt=tn.source;this._isStreamingSupported=!Bt.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var zt;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const tn=this._readableStream.read();return tn===null?(this._readCapability=new at.PromiseCapability,this.read()):(this._loaded+=tn.length,(zt=this.onProgress)==null||zt.call(this,{loaded:this._loaded}),{value:new Uint8Array(tn).buffer,done:!1})}cancel(tn){if(!this._readableStream){this._error(tn);return}this._readableStream.destroy(tn)}_error(tn){this._storedError=tn,this._readCapability.resolve()}_setReadableStream(tn){this._readableStream=tn,tn.on("readable",()=>{this._readCapability.resolve()}),tn.on("end",()=>{tn.destroy(),this._done=!0,this._readCapability.resolve()}),tn.on("error",Bt=>{this._error(Bt)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function kt(sn,tn){return{protocol:sn.protocol,auth:sn.auth,host:sn.hostname,port:sn.port,path:sn.path,method:"GET",headers:tn}}class Lt extends At{constructor(tn){super(tn);const Bt=zt=>{if(zt.statusCode===404){const Kt=new at.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Kt,this._headersCapability.reject(Kt);return}this._headersCapability.resolve(),this._setReadableStream(zt);const Ht=Kt=>this._readableStream.headers[Kt.toLowerCase()],{allowRangeRequests:nn,suggestedLength:Ot}=(0,ut.validateRangeRequestCapabilities)({getResponseHeader:Ht,isHttp:tn.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=nn,this._contentLength=Ot||this._contentLength,this._filename=(0,ut.extractFilenameFromHeader)(Ht)};if(this._request=null,this._url.protocol==="http:"){const zt=require$$5;this._request=zt.request(kt(this._url,tn.httpHeaders),Bt)}else{const zt=require$$5;this._request=zt.request(kt(this._url,tn.httpHeaders),Bt)}this._request.on("error",zt=>{this._storedError=zt,this._headersCapability.reject(zt)}),this._request.end()}}class Mt extends Pt{constructor(tn,Bt,zt){super(tn),this._httpHeaders={};for(const nn in tn.httpHeaders){const Ot=tn.httpHeaders[nn];Ot!==void 0&&(this._httpHeaders[nn]=Ot)}this._httpHeaders.Range=`bytes=${Bt}-${zt-1}`;const Ht=nn=>{if(nn.statusCode===404){const Ot=new at.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Ot;return}this._setReadableStream(nn)};if(this._request=null,this._url.protocol==="http:"){const nn=require$$5;this._request=nn.request(kt(this._url,this._httpHeaders),Ht)}else{const nn=require$$5;this._request=nn.request(kt(this._url,this._httpHeaders),Ht)}this._request.on("error",nn=>{this._storedError=nn}),this._request.end()}}class Qt extends At{constructor(tn){super(tn);let Bt=decodeURIComponent(this._url.path);pt.test(this._url.href)&&(Bt=Bt.replace(/^\//,""));const zt=require$$5;zt.lstat(Bt,(Ht,nn)=>{if(Ht){Ht.code==="ENOENT"&&(Ht=new at.MissingPDFException(`Missing PDF "${Bt}".`)),this._storedError=Ht,this._headersCapability.reject(Ht);return}this._contentLength=nn.size,this._setReadableStream(zt.createReadStream(Bt)),this._headersCapability.resolve()})}}class Jt extends Pt{constructor(tn,Bt,zt){super(tn);let Ht=decodeURIComponent(this._url.path);pt.test(this._url.href)&&(Ht=Ht.replace(/^\//,""));const nn=require$$5;this._setReadableStream(nn.createReadStream(Ht,{start:Bt,end:zt-1}))}}},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.SVGGraphics=void 0;var at=rt(6),ut=rt(1);const pt={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},yt="http://www.w3.org/XML/1998/namespace",ct="http://www.w3.org/1999/xlink",At=["butt","round","square"],Pt=["miter","round","bevel"],kt=function(nn,Ot="",Kt=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!Kt)return URL.createObjectURL(new Blob([nn],{type:Ot}));const mn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let hn=`data:${Ot};base64,`;for(let Yt=0,vn=nn.length;Yt<vn;Yt+=3){const fn=nn[Yt]&255,Wn=nn[Yt+1]&255,Xn=nn[Yt+2]&255,Sn=fn>>2,_i=(fn&3)<<4|Wn>>4,gr=Yt+1<vn?(Wn&15)<<2|Xn>>6:64,br=Yt+2<vn?Xn&63:64;hn+=mn[Sn]+mn[_i]+mn[gr]+mn[br]}return hn},Lt=function(){const nn=new Uint8Array([137,80,78,71,13,10,26,10]),Ot=12,Kt=new Int32Array(256);for(let Xn=0;Xn<256;Xn++){let Sn=Xn;for(let _i=0;_i<8;_i++)Sn=Sn&1?3988292384^Sn>>1&2147483647:Sn>>1&2147483647;Kt[Xn]=Sn}function mn(Xn,Sn,_i){let gr=-1;for(let br=Sn;br<_i;br++){const Pn=(gr^Xn[br])&255,lr=Kt[Pn];gr=gr>>>8^lr}return gr^-1}function hn(Xn,Sn,_i,gr){let br=gr;const Pn=Sn.length;_i[br]=Pn>>24&255,_i[br+1]=Pn>>16&255,_i[br+2]=Pn>>8&255,_i[br+3]=Pn&255,br+=4,_i[br]=Xn.charCodeAt(0)&255,_i[br+1]=Xn.charCodeAt(1)&255,_i[br+2]=Xn.charCodeAt(2)&255,_i[br+3]=Xn.charCodeAt(3)&255,br+=4,_i.set(Sn,br),br+=Sn.length;const lr=mn(_i,gr+4,br);_i[br]=lr>>24&255,_i[br+1]=lr>>16&255,_i[br+2]=lr>>8&255,_i[br+3]=lr&255}function Yt(Xn,Sn,_i){let gr=1,br=0;for(let Pn=Sn;Pn<_i;++Pn)gr=(gr+(Xn[Pn]&255))%65521,br=(br+gr)%65521;return br<<16|gr}function vn(Xn){if(!ut.isNodeJS)return fn(Xn);try{const Sn=parseInt(process.versions.node)>=8?Xn:Buffer.from(Xn),_i=require$$5.deflateSync(Sn,{level:9});return _i instanceof Uint8Array?_i:new Uint8Array(_i)}catch(Sn){(0,ut.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Sn)}return fn(Xn)}function fn(Xn){let Sn=Xn.length;const _i=65535,gr=Math.ceil(Sn/_i),br=new Uint8Array(2+Sn+gr*5+4);let Pn=0;br[Pn++]=120,br[Pn++]=156;let lr=0;for(;Sn>_i;)br[Pn++]=0,br[Pn++]=255,br[Pn++]=255,br[Pn++]=0,br[Pn++]=0,br.set(Xn.subarray(lr,lr+_i),Pn),Pn+=_i,lr+=_i,Sn-=_i;br[Pn++]=1,br[Pn++]=Sn&255,br[Pn++]=Sn>>8&255,br[Pn++]=~Sn&65535&255,br[Pn++]=(~Sn&65535)>>8&255,br.set(Xn.subarray(lr),Pn),Pn+=Xn.length-lr;const xr=Yt(Xn,0,Xn.length);return br[Pn++]=xr>>24&255,br[Pn++]=xr>>16&255,br[Pn++]=xr>>8&255,br[Pn++]=xr&255,br}function Wn(Xn,Sn,_i,gr){const br=Xn.width,Pn=Xn.height;let lr,xr,Dr;const $r=Xn.data;switch(Sn){case ut.ImageKind.GRAYSCALE_1BPP:xr=0,lr=1,Dr=br+7>>3;break;case ut.ImageKind.RGB_24BPP:xr=2,lr=8,Dr=br*3;break;case ut.ImageKind.RGBA_32BPP:xr=6,lr=8,Dr=br*4;break;default:throw new Error("invalid format")}const An=new Uint8Array((1+Dr)*Pn);let Nt=0,Zt=0;for(let jn=0;jn<Pn;++jn)An[Nt++]=0,An.set($r.subarray(Zt,Zt+Dr),Nt),Zt+=Dr,Nt+=Dr;if(Sn===ut.ImageKind.GRAYSCALE_1BPP&&gr){Nt=0;for(let jn=0;jn<Pn;jn++){Nt++;for(let dr=0;dr<Dr;dr++)An[Nt++]^=255}}const $t=new Uint8Array([br>>24&255,br>>16&255,br>>8&255,br&255,Pn>>24&255,Pn>>16&255,Pn>>8&255,Pn&255,lr,xr,0,0,0]),rn=vn(An),an=nn.length+Ot*3+$t.length+rn.length,En=new Uint8Array(an);let Mn=0;return En.set(nn,Mn),Mn+=nn.length,hn("IHDR",$t,En,Mn),Mn+=Ot+$t.length,hn("IDATA",rn,En,Mn),Mn+=Ot+rn.length,hn("IEND",new Uint8Array(0),En,Mn),kt(En,"image/png",_i)}return function(Sn,_i,gr){const br=Sn.kind===void 0?ut.ImageKind.GRAYSCALE_1BPP:Sn.kind;return Wn(Sn,br,_i,gr)}}();class Mt{constructor(){this.fontSizeScale=1,this.fontWeight=pt.fontWeight,this.fontSize=0,this.textMatrix=ut.IDENTITY_MATRIX,this.fontMatrix=ut.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=ut.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=pt.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(Ot,Kt){this.x=Ot,this.y=Kt}}function Qt(nn){let Ot=[];const Kt=[];for(const mn of nn){if(mn.fn==="save"){Ot.push({fnId:92,fn:"group",items:[]}),Kt.push(Ot),Ot=Ot.at(-1).items;continue}mn.fn==="restore"?Ot=Kt.pop():Ot.push(mn)}return Ot}function Jt(nn){if(Number.isInteger(nn))return nn.toString();const Ot=nn.toFixed(10);let Kt=Ot.length-1;if(Ot[Kt]!=="0")return Ot;do Kt--;while(Ot[Kt]==="0");return Ot.substring(0,Ot[Kt]==="."?Kt:Kt+1)}function sn(nn){if(nn[4]===0&&nn[5]===0){if(nn[1]===0&&nn[2]===0)return nn[0]===1&&nn[3]===1?"":`scale(${Jt(nn[0])} ${Jt(nn[3])})`;if(nn[0]===nn[3]&&nn[1]===-nn[2]){const Ot=Math.acos(nn[0])*180/Math.PI;return`rotate(${Jt(Ot)})`}}else if(nn[0]===1&&nn[1]===0&&nn[2]===0&&nn[3]===1)return`translate(${Jt(nn[4])} ${Jt(nn[5])})`;return`matrix(${Jt(nn[0])} ${Jt(nn[1])} ${Jt(nn[2])} ${Jt(nn[3])} ${Jt(nn[4])} ${Jt(nn[5])})`}let tn=0,Bt=0,zt=0;class Ht{constructor(Ot,Kt,mn=!1){(0,at.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new at.DOMSVGFactory,this.current=new Mt,this.transformMatrix=ut.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=Ot,this.objs=Kt,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!mn,this._operatorIdMapping=[];for(const hn in ut.OPS)this._operatorIdMapping[ut.OPS[hn]]=hn}getObject(Ot,Kt=null){return typeof Ot=="string"?Ot.startsWith("g_")?this.commonObjs.get(Ot):this.objs.get(Ot):Kt}save(){this.transformStack.push(this.transformMatrix);const Ot=this.current;this.extraStack.push(Ot),this.current=Ot.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(Ot){this.save(),this.executeOpTree(Ot),this.restore()}loadDependencies(Ot){const Kt=Ot.fnArray,mn=Ot.argsArray;for(let hn=0,Yt=Kt.length;hn<Yt;hn++)if(Kt[hn]===ut.OPS.dependency)for(const vn of mn[hn]){const fn=vn.startsWith("g_")?this.commonObjs:this.objs,Wn=new Promise(Xn=>{fn.get(vn,Xn)});this.current.dependencies.push(Wn)}return Promise.all(this.current.dependencies)}transform(Ot,Kt,mn,hn,Yt,vn){const fn=[Ot,Kt,mn,hn,Yt,vn];this.transformMatrix=ut.Util.transform(this.transformMatrix,fn),this.tgrp=null}getSVG(Ot,Kt){this.viewport=Kt;const mn=this._initialize(Kt);return this.loadDependencies(Ot).then(()=>(this.transformMatrix=ut.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(Ot)),mn))}convertOpList(Ot){const Kt=this._operatorIdMapping,mn=Ot.argsArray,hn=Ot.fnArray,Yt=[];for(let vn=0,fn=hn.length;vn<fn;vn++){const Wn=hn[vn];Yt.push({fnId:Wn,fn:Kt[Wn],args:mn[vn]})}return Qt(Yt)}executeOpTree(Ot){for(const Kt of Ot){const mn=Kt.fn,hn=Kt.fnId,Yt=Kt.args;switch(hn|0){case ut.OPS.beginText:this.beginText();break;case ut.OPS.dependency:break;case ut.OPS.setLeading:this.setLeading(Yt);break;case ut.OPS.setLeadingMoveText:this.setLeadingMoveText(Yt[0],Yt[1]);break;case ut.OPS.setFont:this.setFont(Yt);break;case ut.OPS.showText:this.showText(Yt[0]);break;case ut.OPS.showSpacedText:this.showText(Yt[0]);break;case ut.OPS.endText:this.endText();break;case ut.OPS.moveText:this.moveText(Yt[0],Yt[1]);break;case ut.OPS.setCharSpacing:this.setCharSpacing(Yt[0]);break;case ut.OPS.setWordSpacing:this.setWordSpacing(Yt[0]);break;case ut.OPS.setHScale:this.setHScale(Yt[0]);break;case ut.OPS.setTextMatrix:this.setTextMatrix(Yt[0],Yt[1],Yt[2],Yt[3],Yt[4],Yt[5]);break;case ut.OPS.setTextRise:this.setTextRise(Yt[0]);break;case ut.OPS.setTextRenderingMode:this.setTextRenderingMode(Yt[0]);break;case ut.OPS.setLineWidth:this.setLineWidth(Yt[0]);break;case ut.OPS.setLineJoin:this.setLineJoin(Yt[0]);break;case ut.OPS.setLineCap:this.setLineCap(Yt[0]);break;case ut.OPS.setMiterLimit:this.setMiterLimit(Yt[0]);break;case ut.OPS.setFillRGBColor:this.setFillRGBColor(Yt[0],Yt[1],Yt[2]);break;case ut.OPS.setStrokeRGBColor:this.setStrokeRGBColor(Yt[0],Yt[1],Yt[2]);break;case ut.OPS.setStrokeColorN:this.setStrokeColorN(Yt);break;case ut.OPS.setFillColorN:this.setFillColorN(Yt);break;case ut.OPS.shadingFill:this.shadingFill(Yt[0]);break;case ut.OPS.setDash:this.setDash(Yt[0],Yt[1]);break;case ut.OPS.setRenderingIntent:this.setRenderingIntent(Yt[0]);break;case ut.OPS.setFlatness:this.setFlatness(Yt[0]);break;case ut.OPS.setGState:this.setGState(Yt[0]);break;case ut.OPS.fill:this.fill();break;case ut.OPS.eoFill:this.eoFill();break;case ut.OPS.stroke:this.stroke();break;case ut.OPS.fillStroke:this.fillStroke();break;case ut.OPS.eoFillStroke:this.eoFillStroke();break;case ut.OPS.clip:this.clip("nonzero");break;case ut.OPS.eoClip:this.clip("evenodd");break;case ut.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case ut.OPS.paintImageXObject:this.paintImageXObject(Yt[0]);break;case ut.OPS.paintInlineImageXObject:this.paintInlineImageXObject(Yt[0]);break;case ut.OPS.paintImageMaskXObject:this.paintImageMaskXObject(Yt[0]);break;case ut.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(Yt[0],Yt[1]);break;case ut.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case ut.OPS.closePath:this.closePath();break;case ut.OPS.closeStroke:this.closeStroke();break;case ut.OPS.closeFillStroke:this.closeFillStroke();break;case ut.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case ut.OPS.nextLine:this.nextLine();break;case ut.OPS.transform:this.transform(Yt[0],Yt[1],Yt[2],Yt[3],Yt[4],Yt[5]);break;case ut.OPS.constructPath:this.constructPath(Yt[0],Yt[1]);break;case ut.OPS.endPath:this.endPath();break;case 92:this.group(Kt.items);break;default:(0,ut.warn)(`Unimplemented operator ${mn}`);break}}}setWordSpacing(Ot){this.current.wordSpacing=Ot}setCharSpacing(Ot){this.current.charSpacing=Ot}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(Ot,Kt,mn,hn,Yt,vn){const fn=this.current;fn.textMatrix=fn.lineMatrix=[Ot,Kt,mn,hn,Yt,vn],fn.textMatrixScale=Math.hypot(Ot,Kt),fn.x=fn.lineX=0,fn.y=fn.lineY=0,fn.xcoords=[],fn.ycoords=[],fn.tspan=this.svgFactory.createElement("svg:tspan"),fn.tspan.setAttributeNS(null,"font-family",fn.fontFamily),fn.tspan.setAttributeNS(null,"font-size",`${Jt(fn.fontSize)}px`),fn.tspan.setAttributeNS(null,"y",Jt(-fn.y)),fn.txtElement=this.svgFactory.createElement("svg:text"),fn.txtElement.append(fn.tspan)}beginText(){const Ot=this.current;Ot.x=Ot.lineX=0,Ot.y=Ot.lineY=0,Ot.textMatrix=ut.IDENTITY_MATRIX,Ot.lineMatrix=ut.IDENTITY_MATRIX,Ot.textMatrixScale=1,Ot.tspan=this.svgFactory.createElement("svg:tspan"),Ot.txtElement=this.svgFactory.createElement("svg:text"),Ot.txtgrp=this.svgFactory.createElement("svg:g"),Ot.xcoords=[],Ot.ycoords=[]}moveText(Ot,Kt){const mn=this.current;mn.x=mn.lineX+=Ot,mn.y=mn.lineY+=Kt,mn.xcoords=[],mn.ycoords=[],mn.tspan=this.svgFactory.createElement("svg:tspan"),mn.tspan.setAttributeNS(null,"font-family",mn.fontFamily),mn.tspan.setAttributeNS(null,"font-size",`${Jt(mn.fontSize)}px`),mn.tspan.setAttributeNS(null,"y",Jt(-mn.y))}showText(Ot){const Kt=this.current,mn=Kt.font,hn=Kt.fontSize;if(hn===0)return;const Yt=Kt.fontSizeScale,vn=Kt.charSpacing,fn=Kt.wordSpacing,Wn=Kt.fontDirection,Xn=Kt.textHScale*Wn,Sn=mn.vertical,_i=Sn?1:-1,gr=mn.defaultVMetrics,br=hn*Kt.fontMatrix[0];let Pn=0;for(const Dr of Ot){if(Dr===null){Pn+=Wn*fn;continue}else if(typeof Dr=="number"){Pn+=_i*Dr*hn/1e3;continue}const $r=(Dr.isSpace?fn:0)+vn,An=Dr.fontChar;let Nt,Zt,$t=Dr.width;if(Sn){let an;const En=Dr.vmetric||gr;an=Dr.vmetric?En[1]:$t*.5,an=-an*br;const Mn=En[2]*br;$t=En?-En[0]:$t,Nt=an/Yt,Zt=(Pn+Mn)/Yt}else Nt=Pn/Yt,Zt=0;(Dr.isInFont||mn.missingFile)&&(Kt.xcoords.push(Kt.x+Nt),Sn&&Kt.ycoords.push(-Kt.y+Zt),Kt.tspan.textContent+=An);const rn=Sn?$t*br-$r*Wn:$t*br+$r*Wn;Pn+=rn}Kt.tspan.setAttributeNS(null,"x",Kt.xcoords.map(Jt).join(" ")),Sn?Kt.tspan.setAttributeNS(null,"y",Kt.ycoords.map(Jt).join(" ")):Kt.tspan.setAttributeNS(null,"y",Jt(-Kt.y)),Sn?Kt.y-=Pn:Kt.x+=Pn*Xn,Kt.tspan.setAttributeNS(null,"font-family",Kt.fontFamily),Kt.tspan.setAttributeNS(null,"font-size",`${Jt(Kt.fontSize)}px`),Kt.fontStyle!==pt.fontStyle&&Kt.tspan.setAttributeNS(null,"font-style",Kt.fontStyle),Kt.fontWeight!==pt.fontWeight&&Kt.tspan.setAttributeNS(null,"font-weight",Kt.fontWeight);const lr=Kt.textRenderingMode&ut.TextRenderingMode.FILL_STROKE_MASK;if(lr===ut.TextRenderingMode.FILL||lr===ut.TextRenderingMode.FILL_STROKE?(Kt.fillColor!==pt.fillColor&&Kt.tspan.setAttributeNS(null,"fill",Kt.fillColor),Kt.fillAlpha<1&&Kt.tspan.setAttributeNS(null,"fill-opacity",Kt.fillAlpha)):Kt.textRenderingMode===ut.TextRenderingMode.ADD_TO_PATH?Kt.tspan.setAttributeNS(null,"fill","transparent"):Kt.tspan.setAttributeNS(null,"fill","none"),lr===ut.TextRenderingMode.STROKE||lr===ut.TextRenderingMode.FILL_STROKE){const Dr=1/(Kt.textMatrixScale||1);this._setStrokeAttributes(Kt.tspan,Dr)}let xr=Kt.textMatrix;Kt.textRise!==0&&(xr=xr.slice(),xr[5]+=Kt.textRise),Kt.txtElement.setAttributeNS(null,"transform",`${sn(xr)} scale(${Jt(Xn)}, -1)`),Kt.txtElement.setAttributeNS(yt,"xml:space","preserve"),Kt.txtElement.append(Kt.tspan),Kt.txtgrp.append(Kt.txtElement),this._ensureTransformGroup().append(Kt.txtElement)}setLeadingMoveText(Ot,Kt){this.setLeading(-Kt),this.moveText(Ot,Kt)}addFontStyle(Ot){if(!Ot.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const Kt=kt(Ot.data,Ot.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${Ot.loadedName}"; src: url(${Kt}); }
`}setFont(Ot){const Kt=this.current,mn=this.commonObjs.get(Ot[0]);let hn=Ot[1];Kt.font=mn,this.embedFonts&&!mn.missingFile&&!this.embeddedFonts[mn.loadedName]&&(this.addFontStyle(mn),this.embeddedFonts[mn.loadedName]=mn),Kt.fontMatrix=mn.fontMatrix||ut.FONT_IDENTITY_MATRIX;let Yt="normal";mn.black?Yt="900":mn.bold&&(Yt="bold");const vn=mn.italic?"italic":"normal";hn<0?(hn=-hn,Kt.fontDirection=-1):Kt.fontDirection=1,Kt.fontSize=hn,Kt.fontFamily=mn.loadedName,Kt.fontWeight=Yt,Kt.fontStyle=vn,Kt.tspan=this.svgFactory.createElement("svg:tspan"),Kt.tspan.setAttributeNS(null,"y",Jt(-Kt.y)),Kt.xcoords=[],Kt.ycoords=[]}endText(){var Kt;const Ot=this.current;Ot.textRenderingMode&ut.TextRenderingMode.ADD_TO_PATH_FLAG&&((Kt=Ot.txtElement)!=null&&Kt.hasChildNodes())&&(Ot.element=Ot.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(Ot){Ot>0&&(this.current.lineWidth=Ot)}setLineCap(Ot){this.current.lineCap=At[Ot]}setLineJoin(Ot){this.current.lineJoin=Pt[Ot]}setMiterLimit(Ot){this.current.miterLimit=Ot}setStrokeAlpha(Ot){this.current.strokeAlpha=Ot}setStrokeRGBColor(Ot,Kt,mn){this.current.strokeColor=ut.Util.makeHexColor(Ot,Kt,mn)}setFillAlpha(Ot){this.current.fillAlpha=Ot}setFillRGBColor(Ot,Kt,mn){this.current.fillColor=ut.Util.makeHexColor(Ot,Kt,mn),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(Ot){this.current.strokeColor=this._makeColorN_Pattern(Ot)}setFillColorN(Ot){this.current.fillColor=this._makeColorN_Pattern(Ot)}shadingFill(Ot){const{width:Kt,height:mn}=this.viewport,hn=ut.Util.inverseTransform(this.transformMatrix),[Yt,vn,fn,Wn]=ut.Util.getAxialAlignedBoundingBox([0,0,Kt,mn],hn),Xn=this.svgFactory.createElement("svg:rect");Xn.setAttributeNS(null,"x",Yt),Xn.setAttributeNS(null,"y",vn),Xn.setAttributeNS(null,"width",fn-Yt),Xn.setAttributeNS(null,"height",Wn-vn),Xn.setAttributeNS(null,"fill",this._makeShadingPattern(Ot)),this.current.fillAlpha<1&&Xn.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(Xn)}_makeColorN_Pattern(Ot){return Ot[0]==="TilingPattern"?this._makeTilingPattern(Ot):this._makeShadingPattern(Ot)}_makeTilingPattern(Ot){const Kt=Ot[1],mn=Ot[2],hn=Ot[3]||ut.IDENTITY_MATRIX,[Yt,vn,fn,Wn]=Ot[4],Xn=Ot[5],Sn=Ot[6],_i=Ot[7],gr=`shading${zt++}`,[br,Pn,lr,xr]=ut.Util.normalizeRect([...ut.Util.applyTransform([Yt,vn],hn),...ut.Util.applyTransform([fn,Wn],hn)]),[Dr,$r]=ut.Util.singularValueDecompose2dScale(hn),An=Xn*Dr,Nt=Sn*$r,Zt=this.svgFactory.createElement("svg:pattern");Zt.setAttributeNS(null,"id",gr),Zt.setAttributeNS(null,"patternUnits","userSpaceOnUse"),Zt.setAttributeNS(null,"width",An),Zt.setAttributeNS(null,"height",Nt),Zt.setAttributeNS(null,"x",`${br}`),Zt.setAttributeNS(null,"y",`${Pn}`);const $t=this.svg,rn=this.transformMatrix,an=this.current.fillColor,En=this.current.strokeColor,Mn=this.svgFactory.create(lr-br,xr-Pn);if(this.svg=Mn,this.transformMatrix=hn,_i===2){const jn=ut.Util.makeHexColor(...Kt);this.current.fillColor=jn,this.current.strokeColor=jn}return this.executeOpTree(this.convertOpList(mn)),this.svg=$t,this.transformMatrix=rn,this.current.fillColor=an,this.current.strokeColor=En,Zt.append(Mn.childNodes[0]),this.defs.append(Zt),`url(#${gr})`}_makeShadingPattern(Ot){switch(typeof Ot=="string"&&(Ot=this.objs.get(Ot)),Ot[0]){case"RadialAxial":const Kt=`shading${zt++}`,mn=Ot[3];let hn;switch(Ot[1]){case"axial":const Yt=Ot[4],vn=Ot[5];hn=this.svgFactory.createElement("svg:linearGradient"),hn.setAttributeNS(null,"id",Kt),hn.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),hn.setAttributeNS(null,"x1",Yt[0]),hn.setAttributeNS(null,"y1",Yt[1]),hn.setAttributeNS(null,"x2",vn[0]),hn.setAttributeNS(null,"y2",vn[1]);break;case"radial":const fn=Ot[4],Wn=Ot[5],Xn=Ot[6],Sn=Ot[7];hn=this.svgFactory.createElement("svg:radialGradient"),hn.setAttributeNS(null,"id",Kt),hn.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),hn.setAttributeNS(null,"cx",Wn[0]),hn.setAttributeNS(null,"cy",Wn[1]),hn.setAttributeNS(null,"r",Sn),hn.setAttributeNS(null,"fx",fn[0]),hn.setAttributeNS(null,"fy",fn[1]),hn.setAttributeNS(null,"fr",Xn);break;default:throw new Error(`Unknown RadialAxial type: ${Ot[1]}`)}for(const Yt of mn){const vn=this.svgFactory.createElement("svg:stop");vn.setAttributeNS(null,"offset",Yt[0]),vn.setAttributeNS(null,"stop-color",Yt[1]),hn.append(vn)}return this.defs.append(hn),`url(#${Kt})`;case"Mesh":return(0,ut.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${Ot[0]}`)}}setDash(Ot,Kt){this.current.dashArray=Ot,this.current.dashPhase=Kt}constructPath(Ot,Kt){const mn=this.current;let hn=mn.x,Yt=mn.y,vn=[],fn=0;for(const Wn of Ot)switch(Wn|0){case ut.OPS.rectangle:hn=Kt[fn++],Yt=Kt[fn++];const Xn=Kt[fn++],Sn=Kt[fn++],_i=hn+Xn,gr=Yt+Sn;vn.push("M",Jt(hn),Jt(Yt),"L",Jt(_i),Jt(Yt),"L",Jt(_i),Jt(gr),"L",Jt(hn),Jt(gr),"Z");break;case ut.OPS.moveTo:hn=Kt[fn++],Yt=Kt[fn++],vn.push("M",Jt(hn),Jt(Yt));break;case ut.OPS.lineTo:hn=Kt[fn++],Yt=Kt[fn++],vn.push("L",Jt(hn),Jt(Yt));break;case ut.OPS.curveTo:hn=Kt[fn+4],Yt=Kt[fn+5],vn.push("C",Jt(Kt[fn]),Jt(Kt[fn+1]),Jt(Kt[fn+2]),Jt(Kt[fn+3]),Jt(hn),Jt(Yt)),fn+=6;break;case ut.OPS.curveTo2:vn.push("C",Jt(hn),Jt(Yt),Jt(Kt[fn]),Jt(Kt[fn+1]),Jt(Kt[fn+2]),Jt(Kt[fn+3])),hn=Kt[fn+2],Yt=Kt[fn+3],fn+=4;break;case ut.OPS.curveTo3:hn=Kt[fn+2],Yt=Kt[fn+3],vn.push("C",Jt(Kt[fn]),Jt(Kt[fn+1]),Jt(hn),Jt(Yt),Jt(hn),Jt(Yt)),fn+=4;break;case ut.OPS.closePath:vn.push("Z");break}vn=vn.join(" "),mn.path&&Ot.length>0&&Ot[0]!==ut.OPS.rectangle&&Ot[0]!==ut.OPS.moveTo?vn=mn.path.getAttributeNS(null,"d")+vn:(mn.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(mn.path)),mn.path.setAttributeNS(null,"d",vn),mn.path.setAttributeNS(null,"fill","none"),mn.element=mn.path,mn.setCurrentPoint(hn,Yt)}endPath(){const Ot=this.current;if(Ot.path=null,!this.pendingClip)return;if(!Ot.element){this.pendingClip=null;return}const Kt=`clippath${tn++}`,mn=this.svgFactory.createElement("svg:clipPath");mn.setAttributeNS(null,"id",Kt),mn.setAttributeNS(null,"transform",sn(this.transformMatrix));const hn=Ot.element.cloneNode(!0);if(this.pendingClip==="evenodd"?hn.setAttributeNS(null,"clip-rule","evenodd"):hn.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,mn.append(hn),this.defs.append(mn),Ot.activeClipUrl){Ot.clipGroup=null;for(const Yt of this.extraStack)Yt.clipGroup=null;mn.setAttributeNS(null,"clip-path",Ot.activeClipUrl)}Ot.activeClipUrl=`url(#${Kt})`,this.tgrp=null}clip(Ot){this.pendingClip=Ot}closePath(){const Ot=this.current;if(Ot.path){const Kt=`${Ot.path.getAttributeNS(null,"d")}Z`;Ot.path.setAttributeNS(null,"d",Kt)}}setLeading(Ot){this.current.leading=-Ot}setTextRise(Ot){this.current.textRise=Ot}setTextRenderingMode(Ot){this.current.textRenderingMode=Ot}setHScale(Ot){this.current.textHScale=Ot/100}setRenderingIntent(Ot){}setFlatness(Ot){}setGState(Ot){for(const[Kt,mn]of Ot)switch(Kt){case"LW":this.setLineWidth(mn);break;case"LC":this.setLineCap(mn);break;case"LJ":this.setLineJoin(mn);break;case"ML":this.setMiterLimit(mn);break;case"D":this.setDash(mn[0],mn[1]);break;case"RI":this.setRenderingIntent(mn);break;case"FL":this.setFlatness(mn);break;case"Font":this.setFont(mn);break;case"CA":this.setStrokeAlpha(mn);break;case"ca":this.setFillAlpha(mn);break;default:(0,ut.warn)(`Unimplemented graphic state operator ${Kt}`);break}}fill(){const Ot=this.current;Ot.element&&(Ot.element.setAttributeNS(null,"fill",Ot.fillColor),Ot.element.setAttributeNS(null,"fill-opacity",Ot.fillAlpha),this.endPath())}stroke(){const Ot=this.current;Ot.element&&(this._setStrokeAttributes(Ot.element),Ot.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(Ot,Kt=1){const mn=this.current;let hn=mn.dashArray;Kt!==1&&hn.length>0&&(hn=hn.map(function(Yt){return Kt*Yt})),Ot.setAttributeNS(null,"stroke",mn.strokeColor),Ot.setAttributeNS(null,"stroke-opacity",mn.strokeAlpha),Ot.setAttributeNS(null,"stroke-miterlimit",Jt(mn.miterLimit)),Ot.setAttributeNS(null,"stroke-linecap",mn.lineCap),Ot.setAttributeNS(null,"stroke-linejoin",mn.lineJoin),Ot.setAttributeNS(null,"stroke-width",Jt(Kt*mn.lineWidth)+"px"),Ot.setAttributeNS(null,"stroke-dasharray",hn.map(Jt).join(" ")),Ot.setAttributeNS(null,"stroke-dashoffset",Jt(Kt*mn.dashPhase)+"px")}eoFill(){var Ot;(Ot=this.current.element)==null||Ot.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var Ot;(Ot=this.current.element)==null||Ot.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const Ot=this.svgFactory.createElement("svg:rect");Ot.setAttributeNS(null,"x","0"),Ot.setAttributeNS(null,"y","0"),Ot.setAttributeNS(null,"width","1px"),Ot.setAttributeNS(null,"height","1px"),Ot.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(Ot)}paintImageXObject(Ot){const Kt=this.getObject(Ot);if(!Kt){(0,ut.warn)(`Dependent image with object ID ${Ot} is not ready yet`);return}this.paintInlineImageXObject(Kt)}paintInlineImageXObject(Ot,Kt){const mn=Ot.width,hn=Ot.height,Yt=Lt(Ot,this.forceDataSchema,!!Kt),vn=this.svgFactory.createElement("svg:rect");vn.setAttributeNS(null,"x","0"),vn.setAttributeNS(null,"y","0"),vn.setAttributeNS(null,"width",Jt(mn)),vn.setAttributeNS(null,"height",Jt(hn)),this.current.element=vn,this.clip("nonzero");const fn=this.svgFactory.createElement("svg:image");fn.setAttributeNS(ct,"xlink:href",Yt),fn.setAttributeNS(null,"x","0"),fn.setAttributeNS(null,"y",Jt(-hn)),fn.setAttributeNS(null,"width",Jt(mn)+"px"),fn.setAttributeNS(null,"height",Jt(hn)+"px"),fn.setAttributeNS(null,"transform",`scale(${Jt(1/mn)} ${Jt(-1/hn)})`),Kt?Kt.append(fn):this._ensureTransformGroup().append(fn)}paintImageMaskXObject(Ot){const Kt=this.getObject(Ot.data,Ot);if(Kt.bitmap){(0,ut.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const mn=this.current,hn=Kt.width,Yt=Kt.height,vn=mn.fillColor;mn.maskId=`mask${Bt++}`;const fn=this.svgFactory.createElement("svg:mask");fn.setAttributeNS(null,"id",mn.maskId);const Wn=this.svgFactory.createElement("svg:rect");Wn.setAttributeNS(null,"x","0"),Wn.setAttributeNS(null,"y","0"),Wn.setAttributeNS(null,"width",Jt(hn)),Wn.setAttributeNS(null,"height",Jt(Yt)),Wn.setAttributeNS(null,"fill",vn),Wn.setAttributeNS(null,"mask",`url(#${mn.maskId})`),this.defs.append(fn),this._ensureTransformGroup().append(Wn),this.paintInlineImageXObject(Kt,fn)}paintFormXObjectBegin(Ot,Kt){if(Array.isArray(Ot)&&Ot.length===6&&this.transform(Ot[0],Ot[1],Ot[2],Ot[3],Ot[4],Ot[5]),Kt){const mn=Kt[2]-Kt[0],hn=Kt[3]-Kt[1],Yt=this.svgFactory.createElement("svg:rect");Yt.setAttributeNS(null,"x",Kt[0]),Yt.setAttributeNS(null,"y",Kt[1]),Yt.setAttributeNS(null,"width",Jt(mn)),Yt.setAttributeNS(null,"height",Jt(hn)),this.current.element=Yt,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(Ot){const Kt=this.svgFactory.create(Ot.width,Ot.height),mn=this.svgFactory.createElement("svg:defs");Kt.append(mn),this.defs=mn;const hn=this.svgFactory.createElement("svg:g");return hn.setAttributeNS(null,"transform",sn(Ot.transform)),Kt.append(hn),this.svg=hn,Kt}_ensureClipGroup(){if(!this.current.clipGroup){const Ot=this.svgFactory.createElement("svg:g");Ot.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(Ot),this.current.clipGroup=Ot}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",sn(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}et.SVGGraphics=Ht},(_e,et)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.XfaText=void 0;class rt{static textContent(ut){const pt=[],yt={items:pt,styles:Object.create(null)};function ct(At){var Lt;if(!At)return;let Pt=null;const kt=At.name;if(kt==="#text")Pt=At.value;else if(rt.shouldBuildText(kt))(Lt=At==null?void 0:At.attributes)!=null&&Lt.textContent?Pt=At.attributes.textContent:At.value&&(Pt=At.value);else return;if(Pt!==null&&pt.push({str:Pt}),!!At.children)for(const Mt of At.children)ct(Mt)}return ct(ut),yt}static shouldBuildText(ut){return!(ut==="textarea"||ut==="input"||ut==="option"||ut==="select")}}et.XfaText=rt},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.TextLayerRenderTask=void 0,et.renderTextLayer=sn,et.updateTextLayer=tn;var at=rt(1),ut=rt(6);const pt=1e5,yt=30,ct=.8,At=new Map;function Pt(Bt,zt){let Ht;if(zt&&at.FeatureTest.isOffscreenCanvasSupported)Ht=new OffscreenCanvas(Bt,Bt).getContext("2d",{alpha:!1});else{const nn=document.createElement("canvas");nn.width=nn.height=Bt,Ht=nn.getContext("2d",{alpha:!1})}return Ht}function kt(Bt,zt){const Ht=At.get(Bt);if(Ht)return Ht;const nn=Pt(yt,zt);nn.font=`${yt}px ${Bt}`;const Ot=nn.measureText("");let Kt=Ot.fontBoundingBoxAscent,mn=Math.abs(Ot.fontBoundingBoxDescent);if(Kt){const Yt=Kt/(Kt+mn);return At.set(Bt,Yt),nn.canvas.width=nn.canvas.height=0,Yt}nn.strokeStyle="red",nn.clearRect(0,0,yt,yt),nn.strokeText("g",0,0);let hn=nn.getImageData(0,0,yt,yt).data;mn=0;for(let Yt=hn.length-1-3;Yt>=0;Yt-=4)if(hn[Yt]>0){mn=Math.ceil(Yt/4/yt);break}nn.clearRect(0,0,yt,yt),nn.strokeText("A",0,yt),hn=nn.getImageData(0,0,yt,yt).data,Kt=0;for(let Yt=0,vn=hn.length;Yt<vn;Yt+=4)if(hn[Yt]>0){Kt=yt-Math.floor(Yt/4/yt);break}if(nn.canvas.width=nn.canvas.height=0,Kt){const Yt=Kt/(Kt+mn);return At.set(Bt,Yt),Yt}return At.set(Bt,ct),ct}function Lt(Bt,zt,Ht){const nn=document.createElement("span"),Ot={angle:0,canvasWidth:0,hasText:zt.str!=="",hasEOL:zt.hasEOL,fontSize:0};Bt._textDivs.push(nn);const Kt=at.Util.transform(Bt._transform,zt.transform);let mn=Math.atan2(Kt[1],Kt[0]);const hn=Ht[zt.fontName];hn.vertical&&(mn+=Math.PI/2);const Yt=Math.hypot(Kt[2],Kt[3]),vn=Yt*kt(hn.fontFamily,Bt._isOffscreenCanvasSupported);let fn,Wn;mn===0?(fn=Kt[4],Wn=Kt[5]-vn):(fn=Kt[4]+vn*Math.sin(mn),Wn=Kt[5]-vn*Math.cos(mn));const Xn="calc(var(--scale-factor)*",Sn=nn.style;Bt._container===Bt._rootContainer?(Sn.left=`${(100*fn/Bt._pageWidth).toFixed(2)}%`,Sn.top=`${(100*Wn/Bt._pageHeight).toFixed(2)}%`):(Sn.left=`${Xn}${fn.toFixed(2)}px)`,Sn.top=`${Xn}${Wn.toFixed(2)}px)`),Sn.fontSize=`${Xn}${Yt.toFixed(2)}px)`,Sn.fontFamily=hn.fontFamily,Ot.fontSize=Yt,nn.setAttribute("role","presentation"),nn.textContent=zt.str,nn.dir=zt.dir,Bt._fontInspectorEnabled&&(nn.dataset.fontName=zt.fontName),mn!==0&&(Ot.angle=mn*(180/Math.PI));let _i=!1;if(zt.str.length>1)_i=!0;else if(zt.str!==" "&&zt.transform[0]!==zt.transform[3]){const gr=Math.abs(zt.transform[0]),br=Math.abs(zt.transform[3]);gr!==br&&Math.max(gr,br)/Math.min(gr,br)>1.5&&(_i=!0)}_i&&(Ot.canvasWidth=hn.vertical?zt.height:zt.width),Bt._textDivProperties.set(nn,Ot),Bt._isReadableStream&&Bt._layoutText(nn)}function Mt(Bt){const{div:zt,scale:Ht,properties:nn,ctx:Ot,prevFontSize:Kt,prevFontFamily:mn}=Bt,{style:hn}=zt;let Yt="";if(nn.canvasWidth!==0&&nn.hasText){const{fontFamily:vn}=hn,{canvasWidth:fn,fontSize:Wn}=nn;(Kt!==Wn||mn!==vn)&&(Ot.font=`${Wn*Ht}px ${vn}`,Bt.prevFontSize=Wn,Bt.prevFontFamily=vn);const{width:Xn}=Ot.measureText(zt.textContent);Xn>0&&(Yt=`scaleX(${fn*Ht/Xn})`)}nn.angle!==0&&(Yt=`rotate(${nn.angle}deg) ${Yt}`),Yt.length>0&&(hn.transform=Yt)}function Qt(Bt){if(Bt._canceled)return;const zt=Bt._textDivs,Ht=Bt._capability;if(zt.length>pt){Ht.resolve();return}if(!Bt._isReadableStream)for(const Ot of zt)Bt._layoutText(Ot);Ht.resolve()}class Jt{constructor({textContentSource:zt,container:Ht,viewport:nn,textDivs:Ot,textDivProperties:Kt,textContentItemsStr:mn,isOffscreenCanvasSupported:hn}){var Xn;this._textContentSource=zt,this._isReadableStream=zt instanceof ReadableStream,this._container=this._rootContainer=Ht,this._textDivs=Ot||[],this._textContentItemsStr=mn||[],this._isOffscreenCanvasSupported=hn,this._fontInspectorEnabled=!!((Xn=globalThis.FontInspector)!=null&&Xn.enabled),this._reader=null,this._textDivProperties=Kt||new WeakMap,this._canceled=!1,this._capability=new at.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:nn.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:Pt(0,hn)};const{pageWidth:Yt,pageHeight:vn,pageX:fn,pageY:Wn}=nn.rawDims;this._transform=[1,0,0,-1,-fn,Wn+vn],this._pageWidth=Yt,this._pageHeight=vn,(0,ut.setLayerDimensions)(Ht,nn),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new at.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new at.AbortException("TextLayer task cancelled."))}_processItems(zt,Ht){for(const nn of zt){if(nn.str===void 0){if(nn.type==="beginMarkedContentProps"||nn.type==="beginMarkedContent"){const Ot=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),nn.id!==null&&this._container.setAttribute("id",`${nn.id}`),Ot.append(this._container)}else nn.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(nn.str),Lt(this,nn,Ht)}}_layoutText(zt){const Ht=this._layoutTextParams.properties=this._textDivProperties.get(zt);if(this._layoutTextParams.div=zt,Mt(this._layoutTextParams),Ht.hasText&&this._container.append(zt),Ht.hasEOL){const nn=document.createElement("br");nn.setAttribute("role","presentation"),this._container.append(nn)}}_render(){const zt=new at.PromiseCapability;let Ht=Object.create(null);if(this._isReadableStream){const nn=()=>{this._reader.read().then(({value:Ot,done:Kt})=>{if(Kt){zt.resolve();return}Object.assign(Ht,Ot.styles),this._processItems(Ot.items,Ht),nn()},zt.reject)};this._reader=this._textContentSource.getReader(),nn()}else if(this._textContentSource){const{items:nn,styles:Ot}=this._textContentSource;this._processItems(nn,Ot),zt.resolve()}else throw new Error('No "textContentSource" parameter specified.');zt.promise.then(()=>{Ht=null,Qt(this)},this._capability.reject)}}et.TextLayerRenderTask=Jt;function sn(Bt){!Bt.textContentSource&&(Bt.textContent||Bt.textContentStream)&&((0,ut.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),Bt.textContentSource=Bt.textContent||Bt.textContentStream);const{container:zt,viewport:Ht}=Bt,nn=getComputedStyle(zt),Ot=nn.getPropertyValue("visibility"),Kt=parseFloat(nn.getPropertyValue("--scale-factor"));Ot==="visible"&&(!Kt||Math.abs(Kt-Ht.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const mn=new Jt(Bt);return mn._render(),mn}function tn({container:Bt,viewport:zt,textDivs:Ht,textDivProperties:nn,isOffscreenCanvasSupported:Ot,mustRotate:Kt=!0,mustRescale:mn=!0}){if(Kt&&(0,ut.setLayerDimensions)(Bt,{rotation:zt.rotation}),mn){const hn=Pt(0,Ot),vn={prevFontSize:null,prevFontFamily:null,div:null,scale:zt.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:hn};for(const fn of Ht)vn.properties=nn.get(fn),vn.div=fn,Mt(vn)}}},(_e,et,rt)=>{var kt,Lt,Mt,Qt,Jt,sn,tn,Bt,zt,Ht,nn,dv,Kt,Vy,hn,pv,vn,fv;Object.defineProperty(et,"__esModule",{value:!0}),et.AnnotationEditorLayer=void 0;var at=rt(1),ut=rt(4),pt=rt(28),yt=rt(33),ct=rt(6),At=rt(34);const Wn=class Wn{constructor({uiManager:Sn,pageIndex:_i,div:gr,accessibilityManager:br,annotationLayer:Pn,viewport:lr,l10n:xr}){Bn(this,nn);Bn(this,Kt);Bn(this,hn);Bn(this,vn);Bn(this,kt,void 0);Bn(this,Lt,!1);Bn(this,Mt,null);Bn(this,Qt,this.pointerup.bind(this));Bn(this,Jt,this.pointerdown.bind(this));Bn(this,sn,new Map);Bn(this,tn,!1);Bn(this,Bt,!1);Bn(this,zt,!1);Bn(this,Ht,void 0);const Dr=[pt.FreeTextEditor,yt.InkEditor,At.StampEditor];if(!Wn._initialized){Wn._initialized=!0;for(const $r of Dr)$r.initialize(xr)}Sn.registerEditorTypes(Dr),yr(this,Ht,Sn),this.pageIndex=_i,this.div=gr,yr(this,kt,br),yr(this,Mt,Pn),this.viewport=lr,It(this,Ht).addLayer(this)}get isEmpty(){return It(this,sn).size===0}updateToolbar(Sn){It(this,Ht).updateToolbar(Sn)}updateMode(Sn=It(this,Ht).getMode()){nr(this,vn,fv).call(this),Sn===at.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),Sn!==at.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",Sn===at.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",Sn===at.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",Sn===at.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(Sn){if(!Sn&&It(this,Ht).getMode()!==at.AnnotationEditorType.INK)return;if(!Sn){for(const gr of It(this,sn).values())if(gr.isEmpty()){gr.setInBackground();return}}nr(this,Kt,Vy).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(Sn){It(this,Ht).setEditingState(Sn)}addCommands(Sn){It(this,Ht).addCommands(Sn)}enable(){this.div.style.pointerEvents="auto";const Sn=new Set;for(const gr of It(this,sn).values())gr.enableEditing(),gr.annotationElementId&&Sn.add(gr.annotationElementId);if(!It(this,Mt))return;const _i=It(this,Mt).getEditableAnnotations();for(const gr of _i){if(gr.hide(),It(this,Ht).isDeletedAnnotationElement(gr.data.id)||Sn.has(gr.data.id))continue;const br=this.deserialize(gr);br&&(this.addOrRebuild(br),br.enableEditing())}}disable(){var _i;yr(this,zt,!0),this.div.style.pointerEvents="none";const Sn=new Set;for(const gr of It(this,sn).values()){if(gr.disableEditing(),!gr.annotationElementId||gr.serialize()!==null){Sn.add(gr.annotationElementId);continue}(_i=this.getEditableAnnotation(gr.annotationElementId))==null||_i.show(),gr.remove()}if(It(this,Mt)){const gr=It(this,Mt).getEditableAnnotations();for(const br of gr){const{id:Pn}=br.data;Sn.has(Pn)||It(this,Ht).isDeletedAnnotationElement(Pn)||br.show()}}nr(this,vn,fv).call(this),this.isEmpty&&(this.div.hidden=!0),yr(this,zt,!1)}getEditableAnnotation(Sn){var _i;return((_i=It(this,Mt))==null?void 0:_i.getEditableAnnotation(Sn))||null}setActiveEditor(Sn){It(this,Ht).getActive()!==Sn&&It(this,Ht).setActiveEditor(Sn)}enableClick(){this.div.addEventListener("pointerdown",It(this,Jt)),this.div.addEventListener("pointerup",It(this,Qt))}disableClick(){this.div.removeEventListener("pointerdown",It(this,Jt)),this.div.removeEventListener("pointerup",It(this,Qt))}attach(Sn){It(this,sn).set(Sn.id,Sn);const{annotationElementId:_i}=Sn;_i&&It(this,Ht).isDeletedAnnotationElement(_i)&&It(this,Ht).removeDeletedAnnotationElement(Sn)}detach(Sn){var _i;It(this,sn).delete(Sn.id),(_i=It(this,kt))==null||_i.removePointerInTextLayer(Sn.contentDiv),!It(this,zt)&&Sn.annotationElementId&&It(this,Ht).addDeletedAnnotationElement(Sn)}remove(Sn){this.detach(Sn),It(this,Ht).removeEditor(Sn),Sn.div.contains(document.activeElement)&&setTimeout(()=>{It(this,Ht).focusMainContainer()},0),Sn.div.remove(),Sn.isAttachedToDOM=!1,It(this,Bt)||this.addInkEditorIfNeeded(!1)}changeParent(Sn){var _i;Sn.parent!==this&&(Sn.annotationElementId&&(It(this,Ht).addDeletedAnnotationElement(Sn.annotationElementId),ut.AnnotationEditor.deleteAnnotationElement(Sn),Sn.annotationElementId=null),this.attach(Sn),(_i=Sn.parent)==null||_i.detach(Sn),Sn.setParent(this),Sn.div&&Sn.isAttachedToDOM&&(Sn.div.remove(),this.div.append(Sn.div)))}add(Sn){if(this.changeParent(Sn),It(this,Ht).addEditor(Sn),this.attach(Sn),!Sn.isAttachedToDOM){const _i=Sn.render();this.div.append(_i),Sn.isAttachedToDOM=!0}Sn.fixAndSetPosition(),Sn.onceAdded(),It(this,Ht).addToAnnotationStorage(Sn)}moveEditorInDOM(Sn){var gr;if(!Sn.isAttachedToDOM)return;const{activeElement:_i}=document;Sn.div.contains(_i)&&(Sn._focusEventsAllowed=!1,setTimeout(()=>{Sn.div.contains(document.activeElement)?Sn._focusEventsAllowed=!0:(Sn.div.addEventListener("focusin",()=>{Sn._focusEventsAllowed=!0},{once:!0}),_i.focus())},0)),Sn._structTreeParentId=(gr=It(this,kt))==null?void 0:gr.moveElementInDOM(this.div,Sn.div,Sn.contentDiv,!0)}addOrRebuild(Sn){Sn.needsToBeRebuilt()?Sn.rebuild():this.add(Sn)}addUndoableEditor(Sn){const _i=()=>Sn._uiManager.rebuild(Sn),gr=()=>{Sn.remove()};this.addCommands({cmd:_i,undo:gr,mustExec:!1})}getNextId(){return It(this,Ht).getId()}pasteEditor(Sn,_i){It(this,Ht).updateToolbar(Sn),It(this,Ht).updateMode(Sn);const{offsetX:gr,offsetY:br}=nr(this,hn,pv).call(this),Pn=this.getNextId(),lr=nr(this,nn,dv).call(this,{parent:this,id:Pn,x:gr,y:br,uiManager:It(this,Ht),isCentered:!0,..._i});lr&&this.add(lr)}deserialize(Sn){switch(Sn.annotationType??Sn.annotationEditorType){case at.AnnotationEditorType.FREETEXT:return pt.FreeTextEditor.deserialize(Sn,this,It(this,Ht));case at.AnnotationEditorType.INK:return yt.InkEditor.deserialize(Sn,this,It(this,Ht));case at.AnnotationEditorType.STAMP:return At.StampEditor.deserialize(Sn,this,It(this,Ht))}return null}addNewEditor(){nr(this,Kt,Vy).call(this,nr(this,hn,pv).call(this),!0)}setSelected(Sn){It(this,Ht).setSelected(Sn)}toggleSelected(Sn){It(this,Ht).toggleSelected(Sn)}isSelected(Sn){return It(this,Ht).isSelected(Sn)}unselect(Sn){It(this,Ht).unselect(Sn)}pointerup(Sn){const{isMac:_i}=at.FeatureTest.platform;if(!(Sn.button!==0||Sn.ctrlKey&&_i)&&Sn.target===this.div&&It(this,tn)){if(yr(this,tn,!1),!It(this,Lt)){yr(this,Lt,!0);return}if(It(this,Ht).getMode()===at.AnnotationEditorType.STAMP){It(this,Ht).unselectAll();return}nr(this,Kt,Vy).call(this,Sn,!1)}}pointerdown(Sn){if(It(this,tn)){yr(this,tn,!1);return}const{isMac:_i}=at.FeatureTest.platform;if(Sn.button!==0||Sn.ctrlKey&&_i||Sn.target!==this.div)return;yr(this,tn,!0);const gr=It(this,Ht).getActive();yr(this,Lt,!gr||gr.isEmpty())}findNewParent(Sn,_i,gr){const br=It(this,Ht).findParent(_i,gr);return br===null||br===this?!1:(br.changeParent(Sn),!0)}destroy(){var Sn,_i;((Sn=It(this,Ht).getActive())==null?void 0:Sn.parent)===this&&(It(this,Ht).commitOrRemove(),It(this,Ht).setActiveEditor(null));for(const gr of It(this,sn).values())(_i=It(this,kt))==null||_i.removePointerInTextLayer(gr.contentDiv),gr.setParent(null),gr.isAttachedToDOM=!1,gr.div.remove();this.div=null,It(this,sn).clear(),It(this,Ht).removeLayer(this)}render({viewport:Sn}){this.viewport=Sn,(0,ct.setLayerDimensions)(this.div,Sn);for(const _i of It(this,Ht).getEditors(this.pageIndex))this.add(_i);this.updateMode()}update({viewport:Sn}){It(this,Ht).commitOrRemove(),this.viewport=Sn,(0,ct.setLayerDimensions)(this.div,{rotation:Sn.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:Sn,pageHeight:_i}=this.viewport.rawDims;return[Sn,_i]}};kt=new WeakMap,Lt=new WeakMap,Mt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,sn=new WeakMap,tn=new WeakMap,Bt=new WeakMap,zt=new WeakMap,Ht=new WeakMap,nn=new WeakSet,dv=function(Sn){switch(It(this,Ht).getMode()){case at.AnnotationEditorType.FREETEXT:return new pt.FreeTextEditor(Sn);case at.AnnotationEditorType.INK:return new yt.InkEditor(Sn);case at.AnnotationEditorType.STAMP:return new At.StampEditor(Sn)}return null},Kt=new WeakSet,Vy=function(Sn,_i){const gr=this.getNextId(),br=nr(this,nn,dv).call(this,{parent:this,id:gr,x:Sn.offsetX,y:Sn.offsetY,uiManager:It(this,Ht),isCentered:_i});return br&&this.add(br),br},hn=new WeakSet,pv=function(){const{x:Sn,y:_i,width:gr,height:br}=this.div.getBoundingClientRect(),Pn=Math.max(0,Sn),lr=Math.max(0,_i),xr=Math.min(window.innerWidth,Sn+gr),Dr=Math.min(window.innerHeight,_i+br),$r=(Pn+xr)/2-Sn,An=(lr+Dr)/2-_i,[Nt,Zt]=this.viewport.rotation%180===0?[$r,An]:[An,$r];return{offsetX:Nt,offsetY:Zt}},vn=new WeakSet,fv=function(){yr(this,Bt,!0);for(const Sn of It(this,sn).values())Sn.isEmpty()&&Sn.remove();yr(this,Bt,!1)},$o(Wn,"_initialized",!1);let Pt=Wn;et.AnnotationEditorLayer=Pt},(_e,et,rt)=>{var At,Pt,kt,Lt,Mt,Qt,Jt,sn,tn,Bt,w1,Ht,E1,Ot,S1,mn,ry,Yt,mv,fn,A1,Xn,gv;Object.defineProperty(et,"__esModule",{value:!0}),et.FreeTextEditor=void 0;var at=rt(1),ut=rt(5),pt=rt(4),yt=rt(29);const _i=class _i extends pt.AnnotationEditor{constructor(Pn){super({...Pn,name:"freeTextEditor"});Bn(this,Bt);Bn(this,Ht);Bn(this,Ot);Bn(this,mn);Bn(this,Yt);Bn(this,fn);Bn(this,Xn);Bn(this,At,this.editorDivBlur.bind(this));Bn(this,Pt,this.editorDivFocus.bind(this));Bn(this,kt,this.editorDivInput.bind(this));Bn(this,Lt,this.editorDivKeydown.bind(this));Bn(this,Mt,void 0);Bn(this,Qt,"");Bn(this,Jt,`${this.id}-editor`);Bn(this,sn,void 0);Bn(this,tn,null);yr(this,Mt,Pn.color||_i._defaultColor||pt.AnnotationEditor._defaultLineColor),yr(this,sn,Pn.fontSize||_i._defaultFontSize)}static get _keyboardManager(){const Pn=_i.prototype,lr=$r=>$r.isEmpty(),xr=ut.AnnotationEditorUIManager.TRANSLATE_SMALL,Dr=ut.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,at.shadow)(this,"_keyboardManager",new ut.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Pn.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Pn.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Pn._translateEmpty,{args:[-xr,0],checker:lr}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Pn._translateEmpty,{args:[-Dr,0],checker:lr}],[["ArrowRight","mac+ArrowRight"],Pn._translateEmpty,{args:[xr,0],checker:lr}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Pn._translateEmpty,{args:[Dr,0],checker:lr}],[["ArrowUp","mac+ArrowUp"],Pn._translateEmpty,{args:[0,-xr],checker:lr}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Pn._translateEmpty,{args:[0,-Dr],checker:lr}],[["ArrowDown","mac+ArrowDown"],Pn._translateEmpty,{args:[0,xr],checker:lr}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Pn._translateEmpty,{args:[0,Dr],checker:lr}]]))}static initialize(Pn){pt.AnnotationEditor.initialize(Pn,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const lr=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(lr.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Pn,lr){switch(Pn){case at.AnnotationEditorParamsType.FREETEXT_SIZE:_i._defaultFontSize=lr;break;case at.AnnotationEditorParamsType.FREETEXT_COLOR:_i._defaultColor=lr;break}}updateParams(Pn,lr){switch(Pn){case at.AnnotationEditorParamsType.FREETEXT_SIZE:nr(this,Bt,w1).call(this,lr);break;case at.AnnotationEditorParamsType.FREETEXT_COLOR:nr(this,Ht,E1).call(this,lr);break}}static get defaultPropertiesToUpdate(){return[[at.AnnotationEditorParamsType.FREETEXT_SIZE,_i._defaultFontSize],[at.AnnotationEditorParamsType.FREETEXT_COLOR,_i._defaultColor||pt.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[at.AnnotationEditorParamsType.FREETEXT_SIZE,It(this,sn)],[at.AnnotationEditorParamsType.FREETEXT_COLOR,It(this,Mt)]]}_translateEmpty(Pn,lr){this._uiManager.translateSelectedEditors(Pn,lr,!0)}getInitialTranslation(){const Pn=this.parentScale;return[-_i._internalPadding*Pn,-(_i._internalPadding+It(this,sn))*Pn]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(at.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",It(this,Lt)),this.editorDiv.addEventListener("focus",It(this,Pt)),this.editorDiv.addEventListener("blur",It(this,At)),this.editorDiv.addEventListener("input",It(this,kt)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",It(this,Jt)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",It(this,Lt)),this.editorDiv.removeEventListener("focus",It(this,Pt)),this.editorDiv.removeEventListener("blur",It(this,At)),this.editorDiv.removeEventListener("input",It(this,kt)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Pn){this._focusEventsAllowed&&(super.focusin(Pn),Pn.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var Pn;if(this.width){nr(this,Xn,gv).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(Pn=this._initialOptions)!=null&&Pn.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Pn=It(this,Qt),lr=yr(this,Qt,nr(this,Ot,S1).call(this).trimEnd());if(Pn===lr)return;const xr=Dr=>{if(yr(this,Qt,Dr),!Dr){this.remove();return}nr(this,Yt,mv).call(this),this._uiManager.rebuild(this),nr(this,mn,ry).call(this)};this.addCommands({cmd:()=>{xr(lr)},undo:()=>{xr(Pn)},mustExec:!1}),nr(this,mn,ry).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Pn){this.enterInEditMode()}keydown(Pn){Pn.target===this.div&&Pn.key==="Enter"&&(this.enterInEditMode(),Pn.preventDefault())}editorDivKeydown(Pn){_i._keyboardManager.exec(this,Pn)}editorDivFocus(Pn){this.isEditing=!0}editorDivBlur(Pn){this.isEditing=!1}editorDivInput(Pn){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Pn,lr;this.width&&(Pn=this.x,lr=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",It(this,Jt)),this.enableEditing(),pt.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Dr=>{var $r;return($r=this.editorDiv)==null?void 0:$r.setAttribute("aria-label",Dr)}),pt.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Dr=>{var $r;return($r=this.editorDiv)==null?void 0:$r.setAttribute("default-content",Dr)}),this.editorDiv.contentEditable=!0;const{style:xr}=this.editorDiv;if(xr.fontSize=`calc(${It(this,sn)}px * var(--scale-factor))`,xr.color=It(this,Mt),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,ut.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Dr,$r]=this.parentDimensions;if(this.annotationElementId){const{position:An}=It(this,tn);let[Nt,Zt]=this.getInitialTranslation();[Nt,Zt]=this.pageTranslationToScreen(Nt,Zt);const[$t,rn]=this.pageDimensions,[an,En]=this.pageTranslation;let Mn,jn;switch(this.rotation){case 0:Mn=Pn+(An[0]-an)/$t,jn=lr+this.height-(An[1]-En)/rn;break;case 90:Mn=Pn+(An[0]-an)/$t,jn=lr-(An[1]-En)/rn,[Nt,Zt]=[Zt,-Nt];break;case 180:Mn=Pn-this.width+(An[0]-an)/$t,jn=lr-(An[1]-En)/rn,[Nt,Zt]=[-Nt,-Zt];break;case 270:Mn=Pn+(An[0]-an-this.height*rn)/$t,jn=lr+(An[1]-En-this.width*$t)/rn,[Nt,Zt]=[-Zt,Nt];break}this.setAt(Mn*Dr,jn*$r,Nt,Zt)}else this.setAt(Pn*Dr,lr*$r,this.width*Dr,this.height*$r);nr(this,Yt,mv).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Pn,lr,xr){let Dr=null;if(Pn instanceof yt.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:An,fontColor:Nt},rect:Zt,rotation:$t,id:rn},textContent:an,textPosition:En,parent:{page:{pageNumber:Mn}}}=Pn;if(!an||an.length===0)return null;Dr=Pn={annotationType:at.AnnotationEditorType.FREETEXT,color:Array.from(Nt),fontSize:An,value:an.join(`
`),position:En,pageIndex:Mn-1,rect:Zt,rotation:$t,id:rn,deleted:!1}}const $r=super.deserialize(Pn,lr,xr);return yr($r,sn,Pn.fontSize),yr($r,Mt,at.Util.makeHexColor(...Pn.color)),yr($r,Qt,Pn.value),$r.annotationElementId=Pn.id||null,yr($r,tn,Dr),$r}serialize(Pn=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const lr=_i._internalPadding*this.parentScale,xr=this.getRect(lr,lr),Dr=pt.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:It(this,Mt)),$r={annotationType:at.AnnotationEditorType.FREETEXT,color:Dr,fontSize:It(this,sn),value:It(this,Qt),pageIndex:this.pageIndex,rect:xr,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return Pn?$r:this.annotationElementId&&!nr(this,fn,A1).call(this,$r)?null:($r.id=this.annotationElementId,$r)}};At=new WeakMap,Pt=new WeakMap,kt=new WeakMap,Lt=new WeakMap,Mt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,sn=new WeakMap,tn=new WeakMap,Bt=new WeakSet,w1=function(Pn){const lr=Dr=>{this.editorDiv.style.fontSize=`calc(${Dr}px * var(--scale-factor))`,this.translate(0,-(Dr-It(this,sn))*this.parentScale),yr(this,sn,Dr),nr(this,mn,ry).call(this)},xr=It(this,sn);this.addCommands({cmd:()=>{lr(Pn)},undo:()=>{lr(xr)},mustExec:!0,type:at.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Ht=new WeakSet,E1=function(Pn){const lr=It(this,Mt);this.addCommands({cmd:()=>{yr(this,Mt,this.editorDiv.style.color=Pn)},undo:()=>{yr(this,Mt,this.editorDiv.style.color=lr)},mustExec:!0,type:at.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Ot=new WeakSet,S1=function(){const Pn=this.editorDiv.getElementsByTagName("div");if(Pn.length===0)return this.editorDiv.innerText;const lr=[];for(const xr of Pn)lr.push(xr.innerText.replace(/\r\n?|\n/,""));return lr.join(`
`)},mn=new WeakSet,ry=function(){const[Pn,lr]=this.parentDimensions;let xr;if(this.isAttachedToDOM)xr=this.div.getBoundingClientRect();else{const{currentLayer:Dr,div:$r}=this,An=$r.style.display;$r.style.display="hidden",Dr.div.append(this.div),xr=$r.getBoundingClientRect(),$r.remove(),$r.style.display=An}this.rotation%180===this.parentRotation%180?(this.width=xr.width/Pn,this.height=xr.height/lr):(this.width=xr.height/Pn,this.height=xr.width/lr),this.fixAndSetPosition()},Yt=new WeakSet,mv=function(){if(this.editorDiv.replaceChildren(),!!It(this,Qt))for(const Pn of It(this,Qt).split(`
`)){const lr=document.createElement("div");lr.append(Pn?document.createTextNode(Pn):document.createElement("br")),this.editorDiv.append(lr)}},fn=new WeakSet,A1=function(Pn){const{value:lr,fontSize:xr,color:Dr,rect:$r,pageIndex:An}=It(this,tn);return Pn.value!==lr||Pn.fontSize!==xr||Pn.rect.some((Nt,Zt)=>Math.abs(Nt-$r[Zt])>=1)||Pn.color.some((Nt,Zt)=>Nt!==Dr[Zt])||Pn.pageIndex!==An},Xn=new WeakSet,gv=function(Pn=!1){if(!this.annotationElementId)return;if(nr(this,mn,ry).call(this),!Pn&&(this.width===0||this.height===0)){setTimeout(()=>nr(this,Xn,gv).call(this,!0),0);return}const lr=_i._internalPadding*this.parentScale;It(this,tn).rect=this.getRect(lr,lr)},$o(_i,"_freeTextDefaultContent",""),$o(_i,"_internalPadding",0),$o(_i,"_defaultColor",null),$o(_i,"_defaultFontSize",10),$o(_i,"_type","freetext");let ct=_i;et.FreeTextEditor=ct},(_e,et,rt)=>{var Zt,rn,km,En,T1,jn,dr,cr,wr,Rr,On,Mr,ts,Jr,jr,ss,Lr,hr,or,Tr,Zr,qr,Cr,C1,ds,Hy,Ms,_v,ns,yv,Yn,qn,Er,kr,Us,lo,rr,vv,Wt,jt,ln,xn,k1,Tn,xv;Object.defineProperty(et,"__esModule",{value:!0}),et.StampAnnotationElement=et.InkAnnotationElement=et.FreeTextAnnotationElement=et.AnnotationLayer=void 0;var at=rt(1),ut=rt(6),pt=rt(3),yt=rt(30),ct=rt(31),At=rt(32);const Pt=1e3,kt=9,Lt=new WeakSet;function Mt(Cn){return{width:Cn[2]-Cn[0],height:Cn[3]-Cn[1]}}class Qt{static create(un){switch(un.data.annotationType){case at.AnnotationType.LINK:return new sn(un);case at.AnnotationType.TEXT:return new tn(un);case at.AnnotationType.WIDGET:switch(un.data.fieldType){case"Tx":return new zt(un);case"Btn":return un.data.radioButton?new Ot(un):un.data.checkBox?new nn(un):new Kt(un);case"Ch":return new mn(un);case"Sig":return new Ht(un)}return new Bt(un);case at.AnnotationType.POPUP:return new hn(un);case at.AnnotationType.FREETEXT:return new vn(un);case at.AnnotationType.LINE:return new fn(un);case at.AnnotationType.SQUARE:return new Wn(un);case at.AnnotationType.CIRCLE:return new Xn(un);case at.AnnotationType.POLYLINE:return new Sn(un);case at.AnnotationType.CARET:return new gr(un);case at.AnnotationType.INK:return new br(un);case at.AnnotationType.POLYGON:return new _i(un);case at.AnnotationType.HIGHLIGHT:return new Pn(un);case at.AnnotationType.UNDERLINE:return new lr(un);case at.AnnotationType.SQUIGGLY:return new xr(un);case at.AnnotationType.STRIKEOUT:return new Dr(un);case at.AnnotationType.STAMP:return new $r(un);case at.AnnotationType.FILEATTACHMENT:return new An(un);default:return new Jt(un)}}}const $t=class $t{constructor(un,{isRenderable:Rt=!1,ignoreBorder:qt=!1,createQuadrilaterals:yn=!1}={}){Bn(this,Zt,!1);this.isRenderable=Rt,this.data=un.data,this.layer=un.layer,this.linkService=un.linkService,this.downloadManager=un.downloadManager,this.imageResourcesPath=un.imageResourcesPath,this.renderForms=un.renderForms,this.svgFactory=un.svgFactory,this.annotationStorage=un.annotationStorage,this.enableScripting=un.enableScripting,this.hasJSActions=un.hasJSActions,this._fieldObjects=un.fieldObjects,this.parent=un.parent,Rt&&(this.container=this._createContainer(qt)),yn&&this._createQuadrilaterals()}static _hasPopupData({titleObj:un,contentsObj:Rt,richText:qt}){return!!(un!=null&&un.str||Rt!=null&&Rt.str||qt!=null&&qt.str)}get hasPopupData(){return $t._hasPopupData(this.data)}_createContainer(un){const{data:Rt,parent:{page:qt,viewport:yn}}=this,Rn=document.createElement("section");Rn.setAttribute("data-annotation-id",Rt.id),this instanceof Bt||(Rn.tabIndex=Pt),Rn.style.zIndex=this.parent.zIndex++,this.data.popupRef&&Rn.setAttribute("aria-haspopup","dialog"),Rt.noRotate&&Rn.classList.add("norotate");const{pageWidth:zn,pageHeight:ir,pageX:Sr,pageY:Nr}=yn.rawDims;if(!Rt.rect||this instanceof hn){const{rotation:is}=Rt;return!Rt.hasOwnCanvas&&is!==0&&this.setRotation(is,Rn),Rn}const{width:Fr,height:ps}=Mt(Rt.rect),Gr=at.Util.normalizeRect([Rt.rect[0],qt.view[3]-Rt.rect[1]+qt.view[1],Rt.rect[2],qt.view[3]-Rt.rect[3]+qt.view[1]]);if(!un&&Rt.borderStyle.width>0){Rn.style.borderWidth=`${Rt.borderStyle.width}px`;const is=Rt.borderStyle.horizontalCornerRadius,fs=Rt.borderStyle.verticalCornerRadius;if(is>0||fs>0){const Gs=`calc(${is}px * var(--scale-factor)) / calc(${fs}px * var(--scale-factor))`;Rn.style.borderRadius=Gs}else if(this instanceof Ot){const Gs=`calc(${Fr}px * var(--scale-factor)) / calc(${ps}px * var(--scale-factor))`;Rn.style.borderRadius=Gs}switch(Rt.borderStyle.style){case at.AnnotationBorderStyleType.SOLID:Rn.style.borderStyle="solid";break;case at.AnnotationBorderStyleType.DASHED:Rn.style.borderStyle="dashed";break;case at.AnnotationBorderStyleType.BEVELED:(0,at.warn)("Unimplemented border style: beveled");break;case at.AnnotationBorderStyleType.INSET:(0,at.warn)("Unimplemented border style: inset");break;case at.AnnotationBorderStyleType.UNDERLINE:Rn.style.borderBottomStyle="solid";break}const zs=Rt.borderColor||null;zs?(yr(this,Zt,!0),Rn.style.borderColor=at.Util.makeHexColor(zs[0]|0,zs[1]|0,zs[2]|0)):Rn.style.borderWidth=0}Rn.style.left=`${100*(Gr[0]-Sr)/zn}%`,Rn.style.top=`${100*(Gr[1]-Nr)/ir}%`;const{rotation:Ur}=Rt;return Rt.hasOwnCanvas||Ur===0?(Rn.style.width=`${100*Fr/zn}%`,Rn.style.height=`${100*ps/ir}%`):this.setRotation(Ur,Rn),Rn}setRotation(un,Rt=this.container){if(!this.data.rect)return;const{pageWidth:qt,pageHeight:yn}=this.parent.viewport.rawDims,{width:Rn,height:zn}=Mt(this.data.rect);let ir,Sr;un%180===0?(ir=100*Rn/qt,Sr=100*zn/yn):(ir=100*zn/qt,Sr=100*Rn/yn),Rt.style.width=`${ir}%`,Rt.style.height=`${Sr}%`,Rt.setAttribute("data-main-rotation",(360-un)%360)}get _commonActions(){const un=(Rt,qt,yn)=>{const Rn=yn.detail[Rt],zn=Rn[0],ir=Rn.slice(1);yn.target.style[qt]=yt.ColorConverters[`${zn}_HTML`](ir),this.annotationStorage.setValue(this.data.id,{[qt]:yt.ColorConverters[`${zn}_rgb`](ir)})};return(0,at.shadow)(this,"_commonActions",{display:Rt=>{const{display:qt}=Rt.detail,yn=qt%2===1;this.container.style.visibility=yn?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:yn,noPrint:qt===1||qt===2})},print:Rt=>{this.annotationStorage.setValue(this.data.id,{noPrint:!Rt.detail.print})},hidden:Rt=>{const{hidden:qt}=Rt.detail;this.container.style.visibility=qt?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:qt,noView:qt})},focus:Rt=>{setTimeout(()=>Rt.target.focus({preventScroll:!1}),0)},userName:Rt=>{Rt.target.title=Rt.detail.userName},readonly:Rt=>{Rt.target.disabled=Rt.detail.readonly},required:Rt=>{this._setRequired(Rt.target,Rt.detail.required)},bgColor:Rt=>{un("bgColor","backgroundColor",Rt)},fillColor:Rt=>{un("fillColor","backgroundColor",Rt)},fgColor:Rt=>{un("fgColor","color",Rt)},textColor:Rt=>{un("textColor","color",Rt)},borderColor:Rt=>{un("borderColor","borderColor",Rt)},strokeColor:Rt=>{un("strokeColor","borderColor",Rt)},rotation:Rt=>{const qt=Rt.detail.rotation;this.setRotation(qt),this.annotationStorage.setValue(this.data.id,{rotation:qt})}})}_dispatchEventFromSandbox(un,Rt){const qt=this._commonActions;for(const yn of Object.keys(Rt.detail)){const Rn=un[yn]||qt[yn];Rn==null||Rn(Rt)}}_setDefaultPropertiesFromJS(un){if(!this.enableScripting)return;const Rt=this.annotationStorage.getRawValue(this.data.id);if(!Rt)return;const qt=this._commonActions;for(const[yn,Rn]of Object.entries(Rt)){const zn=qt[yn];if(zn){const ir={detail:{[yn]:Rn},target:un};zn(ir),delete Rt[yn]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:un}=this.data;if(!un)return;const[Rt,qt,yn,Rn]=this.data.rect;if(un.length===1){const[,{x:fs,y:zs},{x:Gs,y:go}]=un[0];if(yn===fs&&Rn===zs&&Rt===Gs&&qt===go)return}const{style:zn}=this.container;let ir;if(It(this,Zt)){const{borderColor:fs,borderWidth:zs}=zn;zn.borderWidth=0,ir=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${fs}" stroke-width="${zs}">`],this.container.classList.add("hasBorder")}const Sr=yn-Rt,Nr=Rn-qt,{svgFactory:Fr}=this,ps=Fr.createElement("svg");ps.classList.add("quadrilateralsContainer"),ps.setAttribute("width",0),ps.setAttribute("height",0);const Gr=Fr.createElement("defs");ps.append(Gr);const Ur=Fr.createElement("clipPath"),is=`clippath_${this.data.id}`;Ur.setAttribute("id",is),Ur.setAttribute("clipPathUnits","objectBoundingBox"),Gr.append(Ur);for(const[,{x:fs,y:zs},{x:Gs,y:go}]of un){const Ao=Fr.createElement("rect"),oo=(Gs-Rt)/Sr,Cl=(Rn-zs)/Nr,eu=(fs-Gs)/Sr,yl=(zs-go)/Nr;Ao.setAttribute("x",oo),Ao.setAttribute("y",Cl),Ao.setAttribute("width",eu),Ao.setAttribute("height",yl),Ur.append(Ao),ir==null||ir.push(`<rect vector-effect="non-scaling-stroke" x="${oo}" y="${Cl}" width="${eu}" height="${yl}"/>`)}It(this,Zt)&&(ir.push("</g></svg>')"),zn.backgroundImage=ir.join("")),this.container.append(ps),this.container.style.clipPath=`url(#${is})`}_createPopup(){const{container:un,data:Rt}=this;un.setAttribute("aria-haspopup","dialog");const qt=new hn({data:{color:Rt.color,titleObj:Rt.titleObj,modificationDate:Rt.modificationDate,contentsObj:Rt.contentsObj,richText:Rt.richText,parentRect:Rt.rect,borderStyle:0,id:`popup_${Rt.id}`,rotation:Rt.rotation},parent:this.parent,elements:[this]});this.parent.div.append(qt.render())}render(){(0,at.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(un,Rt=null){const qt=[];if(this._fieldObjects){const yn=this._fieldObjects[un];if(yn)for(const{page:Rn,id:zn,exportValues:ir}of yn){if(Rn===-1||zn===Rt)continue;const Sr=typeof ir=="string"?ir:null,Nr=document.querySelector(`[data-element-id="${zn}"]`);if(Nr&&!Lt.has(Nr)){(0,at.warn)(`_getElementsByName - element not allowed: ${zn}`);continue}qt.push({id:zn,exportValue:Sr,domElement:Nr})}return qt}for(const yn of document.getElementsByName(un)){const{exportValue:Rn}=yn,zn=yn.getAttribute("data-element-id");zn!==Rt&&Lt.has(yn)&&qt.push({id:zn,exportValue:Rn,domElement:yn})}return qt}show(){var un;this.container&&(this.container.hidden=!1),(un=this.popup)==null||un.maybeShow()}hide(){var un;this.container&&(this.container.hidden=!0),(un=this.popup)==null||un.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const un=this.getElementsToTriggerPopup();if(Array.isArray(un))for(const Rt of un)Rt.classList.add("highlightArea");else un.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:un,data:{id:Rt}}=this;this.container.addEventListener("dblclick",()=>{var qt;(qt=this.linkService.eventBus)==null||qt.dispatch("switchannotationeditormode",{source:this,mode:un,editId:Rt})})}};Zt=new WeakMap;let Jt=$t;class sn extends Jt{constructor(Rt,qt=null){super(Rt,{isRenderable:!0,ignoreBorder:!!(qt!=null&&qt.ignoreBorder),createQuadrilaterals:!0});Bn(this,rn);Bn(this,En);this.isTooltipOnly=Rt.data.isTooltipOnly}render(){const{data:Rt,linkService:qt}=this,yn=document.createElement("a");yn.setAttribute("data-element-id",Rt.id);let Rn=!1;return Rt.url?(qt.addLinkAttributes(yn,Rt.url,Rt.newWindow),Rn=!0):Rt.action?(this._bindNamedAction(yn,Rt.action),Rn=!0):Rt.attachment?(this._bindAttachment(yn,Rt.attachment),Rn=!0):Rt.setOCGState?(nr(this,En,T1).call(this,yn,Rt.setOCGState),Rn=!0):Rt.dest?(this._bindLink(yn,Rt.dest),Rn=!0):(Rt.actions&&(Rt.actions.Action||Rt.actions["Mouse Up"]||Rt.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(yn,Rt),Rn=!0),Rt.resetForm?(this._bindResetFormAction(yn,Rt.resetForm),Rn=!0):this.isTooltipOnly&&!Rn&&(this._bindLink(yn,""),Rn=!0)),this.container.classList.add("linkAnnotation"),Rn&&this.container.append(yn),this.container}_bindLink(Rt,qt){Rt.href=this.linkService.getDestinationHash(qt),Rt.onclick=()=>(qt&&this.linkService.goToDestination(qt),!1),(qt||qt==="")&&nr(this,rn,km).call(this)}_bindNamedAction(Rt,qt){Rt.href=this.linkService.getAnchorUrl(""),Rt.onclick=()=>(this.linkService.executeNamedAction(qt),!1),nr(this,rn,km).call(this)}_bindAttachment(Rt,qt){Rt.href=this.linkService.getAnchorUrl(""),Rt.onclick=()=>{var yn;return(yn=this.downloadManager)==null||yn.openOrDownloadData(this.container,qt.content,qt.filename),!1},nr(this,rn,km).call(this)}_bindJSAction(Rt,qt){Rt.href=this.linkService.getAnchorUrl("");const yn=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Rn of Object.keys(qt.actions)){const zn=yn.get(Rn);zn&&(Rt[zn]=()=>{var ir;return(ir=this.linkService.eventBus)==null||ir.dispatch("dispatcheventinsandbox",{source:this,detail:{id:qt.id,name:Rn}}),!1})}Rt.onclick||(Rt.onclick=()=>!1),nr(this,rn,km).call(this)}_bindResetFormAction(Rt,qt){const yn=Rt.onclick;if(yn||(Rt.href=this.linkService.getAnchorUrl("")),nr(this,rn,km).call(this),!this._fieldObjects){(0,at.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),yn||(Rt.onclick=()=>!1);return}Rt.onclick=()=>{var ps;yn==null||yn();const{fields:Rn,refs:zn,include:ir}=qt,Sr=[];if(Rn.length!==0||zn.length!==0){const Gr=new Set(zn);for(const Ur of Rn){const is=this._fieldObjects[Ur]||[];for(const{id:fs}of is)Gr.add(fs)}for(const Ur of Object.values(this._fieldObjects))for(const is of Ur)Gr.has(is.id)===ir&&Sr.push(is)}else for(const Gr of Object.values(this._fieldObjects))Sr.push(...Gr);const Nr=this.annotationStorage,Fr=[];for(const Gr of Sr){const{id:Ur}=Gr;switch(Fr.push(Ur),Gr.type){case"text":{const fs=Gr.defaultValue||"";Nr.setValue(Ur,{value:fs});break}case"checkbox":case"radiobutton":{const fs=Gr.defaultValue===Gr.exportValues;Nr.setValue(Ur,{value:fs});break}case"combobox":case"listbox":{const fs=Gr.defaultValue||"";Nr.setValue(Ur,{value:fs});break}default:continue}const is=document.querySelector(`[data-element-id="${Ur}"]`);if(is){if(!Lt.has(is)){(0,at.warn)(`_bindResetFormAction - element not allowed: ${Ur}`);continue}}else continue;is.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((ps=this.linkService.eventBus)==null||ps.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:Fr,name:"ResetForm"}})),!1}}}rn=new WeakSet,km=function(){this.container.setAttribute("data-internal-link","")},En=new WeakSet,T1=function(Rt,qt){Rt.href=this.linkService.getAnchorUrl(""),Rt.onclick=()=>(this.linkService.executeSetOCGState(qt),!1),nr(this,rn,km).call(this)};class tn extends Jt{constructor(un){super(un,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const un=document.createElement("img");return un.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",un.alt="[{{type}} Annotation]",un.dataset.l10nId="text_annotation_type",un.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(un),this.container}}class Bt extends Jt{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(un){var Rt;this.data.hasOwnCanvas&&(((Rt=un.previousSibling)==null?void 0:Rt.nodeName)==="CANVAS"&&(un.previousSibling.hidden=!0),un.hidden=!1)}_getKeyModifier(un){const{isWin:Rt,isMac:qt}=at.FeatureTest.platform;return Rt&&un.ctrlKey||qt&&un.metaKey}_setEventListener(un,Rt,qt,yn,Rn){qt.includes("mouse")?un.addEventListener(qt,zn=>{var ir;(ir=this.linkService.eventBus)==null||ir.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:yn,value:Rn(zn),shift:zn.shiftKey,modifier:this._getKeyModifier(zn)}})}):un.addEventListener(qt,zn=>{var ir;if(qt==="blur"){if(!Rt.focused||!zn.relatedTarget)return;Rt.focused=!1}else if(qt==="focus"){if(Rt.focused)return;Rt.focused=!0}Rn&&((ir=this.linkService.eventBus)==null||ir.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:yn,value:Rn(zn)}}))})}_setEventListeners(un,Rt,qt,yn){var Rn,zn,ir;for(const[Sr,Nr]of qt)(Nr==="Action"||(Rn=this.data.actions)!=null&&Rn[Nr])&&((Nr==="Focus"||Nr==="Blur")&&(Rt||(Rt={focused:!1})),this._setEventListener(un,Rt,Sr,Nr,yn),Nr==="Focus"&&!((zn=this.data.actions)!=null&&zn.Blur)?this._setEventListener(un,Rt,"blur","Blur",null):Nr==="Blur"&&!((ir=this.data.actions)!=null&&ir.Focus)&&this._setEventListener(un,Rt,"focus","Focus",null))}_setBackgroundColor(un){const Rt=this.data.backgroundColor||null;un.style.backgroundColor=Rt===null?"transparent":at.Util.makeHexColor(Rt[0],Rt[1],Rt[2])}_setTextStyle(un){const Rt=["left","center","right"],{fontColor:qt}=this.data.defaultAppearanceData,yn=this.data.defaultAppearanceData.fontSize||kt,Rn=un.style;let zn;const ir=2,Sr=Nr=>Math.round(10*Nr)/10;if(this.data.multiLine){const Nr=Math.abs(this.data.rect[3]-this.data.rect[1]-ir),Fr=Math.round(Nr/(at.LINE_FACTOR*yn))||1,ps=Nr/Fr;zn=Math.min(yn,Sr(ps/at.LINE_FACTOR))}else{const Nr=Math.abs(this.data.rect[3]-this.data.rect[1]-ir);zn=Math.min(yn,Sr(Nr/at.LINE_FACTOR))}Rn.fontSize=`calc(${zn}px * var(--scale-factor))`,Rn.color=at.Util.makeHexColor(qt[0],qt[1],qt[2]),this.data.textAlignment!==null&&(Rn.textAlign=Rt[this.data.textAlignment])}_setRequired(un,Rt){Rt?un.setAttribute("required",!0):un.removeAttribute("required"),un.setAttribute("aria-required",Rt)}}class zt extends Bt{constructor(un){const Rt=un.renderForms||!un.data.hasAppearance&&!!un.data.fieldValue;super(un,{isRenderable:Rt})}setPropertyOnSiblings(un,Rt,qt,yn){const Rn=this.annotationStorage;for(const zn of this._getElementsByName(un.name,un.id))zn.domElement&&(zn.domElement[Rt]=qt),Rn.setValue(zn.id,{[yn]:qt})}render(){var yn,Rn;const un=this.annotationStorage,Rt=this.data.id;this.container.classList.add("textWidgetAnnotation");let qt=null;if(this.renderForms){const zn=un.getValue(Rt,{value:this.data.fieldValue});let ir=zn.value||"";const Sr=un.getValue(Rt,{charLimit:this.data.maxLen}).charLimit;Sr&&ir.length>Sr&&(ir=ir.slice(0,Sr));let Nr=zn.formattedValue||((yn=this.data.textContent)==null?void 0:yn.join(`
`))||null;Nr&&this.data.comb&&(Nr=Nr.replaceAll(/\s+/g,""));const Fr={userValue:ir,formattedValue:Nr,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(qt=document.createElement("textarea"),qt.textContent=Nr??ir,this.data.doNotScroll&&(qt.style.overflowY="hidden")):(qt=document.createElement("input"),qt.type="text",qt.setAttribute("value",Nr??ir),this.data.doNotScroll&&(qt.style.overflowX="hidden")),this.data.hasOwnCanvas&&(qt.hidden=!0),Lt.add(qt),qt.setAttribute("data-element-id",Rt),qt.disabled=this.data.readOnly,qt.name=this.data.fieldName,qt.tabIndex=Pt,this._setRequired(qt,this.data.required),Sr&&(qt.maxLength=Sr),qt.addEventListener("input",Gr=>{un.setValue(Rt,{value:Gr.target.value}),this.setPropertyOnSiblings(qt,"value",Gr.target.value,"value"),Fr.formattedValue=null}),qt.addEventListener("resetform",Gr=>{const Ur=this.data.defaultFieldValue??"";qt.value=Fr.userValue=Ur,Fr.formattedValue=null});let ps=Gr=>{const{formattedValue:Ur}=Fr;Ur!=null&&(Gr.target.value=Ur),Gr.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){qt.addEventListener("focus",Ur=>{if(Fr.focused)return;const{target:is}=Ur;Fr.userValue&&(is.value=Fr.userValue),Fr.lastCommittedValue=is.value,Fr.commitKey=1,Fr.focused=!0}),qt.addEventListener("updatefromsandbox",Ur=>{this.showElementAndHideCanvas(Ur.target);const is={value(fs){Fr.userValue=fs.detail.value??"",un.setValue(Rt,{value:Fr.userValue.toString()}),fs.target.value=Fr.userValue},formattedValue(fs){const{formattedValue:zs}=fs.detail;Fr.formattedValue=zs,zs!=null&&fs.target!==document.activeElement&&(fs.target.value=zs),un.setValue(Rt,{formattedValue:zs})},selRange(fs){fs.target.setSelectionRange(...fs.detail.selRange)},charLimit:fs=>{var Ao;const{charLimit:zs}=fs.detail,{target:Gs}=fs;if(zs===0){Gs.removeAttribute("maxLength");return}Gs.setAttribute("maxLength",zs);let go=Fr.userValue;!go||go.length<=zs||(go=go.slice(0,zs),Gs.value=Fr.userValue=go,un.setValue(Rt,{value:go}),(Ao=this.linkService.eventBus)==null||Ao.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Rt,name:"Keystroke",value:go,willCommit:!0,commitKey:1,selStart:Gs.selectionStart,selEnd:Gs.selectionEnd}}))}};this._dispatchEventFromSandbox(is,Ur)}),qt.addEventListener("keydown",Ur=>{var zs;Fr.commitKey=1;let is=-1;if(Ur.key==="Escape"?is=0:Ur.key==="Enter"&&!this.data.multiLine?is=2:Ur.key==="Tab"&&(Fr.commitKey=3),is===-1)return;const{value:fs}=Ur.target;Fr.lastCommittedValue!==fs&&(Fr.lastCommittedValue=fs,Fr.userValue=fs,(zs=this.linkService.eventBus)==null||zs.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Rt,name:"Keystroke",value:fs,willCommit:!0,commitKey:is,selStart:Ur.target.selectionStart,selEnd:Ur.target.selectionEnd}}))});const Gr=ps;ps=null,qt.addEventListener("blur",Ur=>{var fs;if(!Fr.focused||!Ur.relatedTarget)return;Fr.focused=!1;const{value:is}=Ur.target;Fr.userValue=is,Fr.lastCommittedValue!==is&&((fs=this.linkService.eventBus)==null||fs.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Rt,name:"Keystroke",value:is,willCommit:!0,commitKey:Fr.commitKey,selStart:Ur.target.selectionStart,selEnd:Ur.target.selectionEnd}})),Gr(Ur)}),(Rn=this.data.actions)!=null&&Rn.Keystroke&&qt.addEventListener("beforeinput",Ur=>{var Cl;Fr.lastCommittedValue=null;const{data:is,target:fs}=Ur,{value:zs,selectionStart:Gs,selectionEnd:go}=fs;let Ao=Gs,oo=go;switch(Ur.inputType){case"deleteWordBackward":{const eu=zs.substring(0,Gs).match(/\w*[^\w]*$/);eu&&(Ao-=eu[0].length);break}case"deleteWordForward":{const eu=zs.substring(Gs).match(/^[^\w]*\w*/);eu&&(oo+=eu[0].length);break}case"deleteContentBackward":Gs===go&&(Ao-=1);break;case"deleteContentForward":Gs===go&&(oo+=1);break}Ur.preventDefault(),(Cl=this.linkService.eventBus)==null||Cl.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Rt,name:"Keystroke",value:zs,change:is||"",willCommit:!1,selStart:Ao,selEnd:oo}})}),this._setEventListeners(qt,Fr,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Ur=>Ur.target.value)}if(ps&&qt.addEventListener("blur",ps),this.data.comb){const Ur=(this.data.rect[2]-this.data.rect[0])/Sr;qt.classList.add("comb"),qt.style.letterSpacing=`calc(${Ur}px * var(--scale-factor) - 1ch)`}}else qt=document.createElement("div"),qt.textContent=this.data.fieldValue,qt.style.verticalAlign="middle",qt.style.display="table-cell";return this._setTextStyle(qt),this._setBackgroundColor(qt),this._setDefaultPropertiesFromJS(qt),this.container.append(qt),this.container}}class Ht extends Bt{constructor(un){super(un,{isRenderable:!!un.data.hasOwnCanvas})}}class nn extends Bt{constructor(un){super(un,{isRenderable:un.renderForms})}render(){const un=this.annotationStorage,Rt=this.data,qt=Rt.id;let yn=un.getValue(qt,{value:Rt.exportValue===Rt.fieldValue}).value;typeof yn=="string"&&(yn=yn!=="Off",un.setValue(qt,{value:yn})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const Rn=document.createElement("input");return Lt.add(Rn),Rn.setAttribute("data-element-id",qt),Rn.disabled=Rt.readOnly,this._setRequired(Rn,this.data.required),Rn.type="checkbox",Rn.name=Rt.fieldName,yn&&Rn.setAttribute("checked",!0),Rn.setAttribute("exportValue",Rt.exportValue),Rn.tabIndex=Pt,Rn.addEventListener("change",zn=>{const{name:ir,checked:Sr}=zn.target;for(const Nr of this._getElementsByName(ir,qt)){const Fr=Sr&&Nr.exportValue===Rt.exportValue;Nr.domElement&&(Nr.domElement.checked=Fr),un.setValue(Nr.id,{value:Fr})}un.setValue(qt,{value:Sr})}),Rn.addEventListener("resetform",zn=>{const ir=Rt.defaultFieldValue||"Off";zn.target.checked=ir===Rt.exportValue}),this.enableScripting&&this.hasJSActions&&(Rn.addEventListener("updatefromsandbox",zn=>{const ir={value(Sr){Sr.target.checked=Sr.detail.value!=="Off",un.setValue(qt,{value:Sr.target.checked})}};this._dispatchEventFromSandbox(ir,zn)}),this._setEventListeners(Rn,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],zn=>zn.target.checked)),this._setBackgroundColor(Rn),this._setDefaultPropertiesFromJS(Rn),this.container.append(Rn),this.container}}class Ot extends Bt{constructor(un){super(un,{isRenderable:un.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const un=this.annotationStorage,Rt=this.data,qt=Rt.id;let yn=un.getValue(qt,{value:Rt.fieldValue===Rt.buttonValue}).value;typeof yn=="string"&&(yn=yn!==Rt.buttonValue,un.setValue(qt,{value:yn}));const Rn=document.createElement("input");if(Lt.add(Rn),Rn.setAttribute("data-element-id",qt),Rn.disabled=Rt.readOnly,this._setRequired(Rn,this.data.required),Rn.type="radio",Rn.name=Rt.fieldName,yn&&Rn.setAttribute("checked",!0),Rn.tabIndex=Pt,Rn.addEventListener("change",zn=>{const{name:ir,checked:Sr}=zn.target;for(const Nr of this._getElementsByName(ir,qt))un.setValue(Nr.id,{value:!1});un.setValue(qt,{value:Sr})}),Rn.addEventListener("resetform",zn=>{const ir=Rt.defaultFieldValue;zn.target.checked=ir!=null&&ir===Rt.buttonValue}),this.enableScripting&&this.hasJSActions){const zn=Rt.buttonValue;Rn.addEventListener("updatefromsandbox",ir=>{const Sr={value:Nr=>{const Fr=zn===Nr.detail.value;for(const ps of this._getElementsByName(Nr.target.name)){const Gr=Fr&&ps.id===qt;ps.domElement&&(ps.domElement.checked=Gr),un.setValue(ps.id,{value:Gr})}}};this._dispatchEventFromSandbox(Sr,ir)}),this._setEventListeners(Rn,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ir=>ir.target.checked)}return this._setBackgroundColor(Rn),this._setDefaultPropertiesFromJS(Rn),this.container.append(Rn),this.container}}class Kt extends sn{constructor(un){super(un,{ignoreBorder:un.data.hasAppearance})}render(){const un=super.render();un.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(un.title=this.data.alternativeText);const Rt=un.lastChild;return this.enableScripting&&this.hasJSActions&&Rt&&(this._setDefaultPropertiesFromJS(Rt),Rt.addEventListener("updatefromsandbox",qt=>{this._dispatchEventFromSandbox({},qt)})),un}}class mn extends Bt{constructor(un){super(un,{isRenderable:un.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const un=this.annotationStorage,Rt=this.data.id,qt=un.getValue(Rt,{value:this.data.fieldValue}),yn=document.createElement("select");Lt.add(yn),yn.setAttribute("data-element-id",Rt),yn.disabled=this.data.readOnly,this._setRequired(yn,this.data.required),yn.name=this.data.fieldName,yn.tabIndex=Pt;let Rn=this.data.combo&&this.data.options.length>0;this.data.combo||(yn.size=this.data.options.length,this.data.multiSelect&&(yn.multiple=!0)),yn.addEventListener("resetform",Fr=>{const ps=this.data.defaultFieldValue;for(const Gr of yn.options)Gr.selected=Gr.value===ps});for(const Fr of this.data.options){const ps=document.createElement("option");ps.textContent=Fr.displayValue,ps.value=Fr.exportValue,qt.value.includes(Fr.exportValue)&&(ps.setAttribute("selected",!0),Rn=!1),yn.append(ps)}let zn=null;if(Rn){const Fr=document.createElement("option");Fr.value=" ",Fr.setAttribute("hidden",!0),Fr.setAttribute("selected",!0),yn.prepend(Fr),zn=()=>{Fr.remove(),yn.removeEventListener("input",zn),zn=null},yn.addEventListener("input",zn)}const ir=Fr=>{const ps=Fr?"value":"textContent",{options:Gr,multiple:Ur}=yn;return Ur?Array.prototype.filter.call(Gr,is=>is.selected).map(is=>is[ps]):Gr.selectedIndex===-1?null:Gr[Gr.selectedIndex][ps]};let Sr=ir(!1);const Nr=Fr=>{const ps=Fr.target.options;return Array.prototype.map.call(ps,Gr=>({displayValue:Gr.textContent,exportValue:Gr.value}))};return this.enableScripting&&this.hasJSActions?(yn.addEventListener("updatefromsandbox",Fr=>{const ps={value(Gr){zn==null||zn();const Ur=Gr.detail.value,is=new Set(Array.isArray(Ur)?Ur:[Ur]);for(const fs of yn.options)fs.selected=is.has(fs.value);un.setValue(Rt,{value:ir(!0)}),Sr=ir(!1)},multipleSelection(Gr){yn.multiple=!0},remove(Gr){const Ur=yn.options,is=Gr.detail.remove;Ur[is].selected=!1,yn.remove(is),Ur.length>0&&Array.prototype.findIndex.call(Ur,zs=>zs.selected)===-1&&(Ur[0].selected=!0),un.setValue(Rt,{value:ir(!0),items:Nr(Gr)}),Sr=ir(!1)},clear(Gr){for(;yn.length!==0;)yn.remove(0);un.setValue(Rt,{value:null,items:[]}),Sr=ir(!1)},insert(Gr){const{index:Ur,displayValue:is,exportValue:fs}=Gr.detail.insert,zs=yn.children[Ur],Gs=document.createElement("option");Gs.textContent=is,Gs.value=fs,zs?zs.before(Gs):yn.append(Gs),un.setValue(Rt,{value:ir(!0),items:Nr(Gr)}),Sr=ir(!1)},items(Gr){const{items:Ur}=Gr.detail;for(;yn.length!==0;)yn.remove(0);for(const is of Ur){const{displayValue:fs,exportValue:zs}=is,Gs=document.createElement("option");Gs.textContent=fs,Gs.value=zs,yn.append(Gs)}yn.options.length>0&&(yn.options[0].selected=!0),un.setValue(Rt,{value:ir(!0),items:Nr(Gr)}),Sr=ir(!1)},indices(Gr){const Ur=new Set(Gr.detail.indices);for(const is of Gr.target.options)is.selected=Ur.has(is.index);un.setValue(Rt,{value:ir(!0)}),Sr=ir(!1)},editable(Gr){Gr.target.disabled=!Gr.detail.editable}};this._dispatchEventFromSandbox(ps,Fr)}),yn.addEventListener("input",Fr=>{var Gr;const ps=ir(!0);un.setValue(Rt,{value:ps}),Fr.preventDefault(),(Gr=this.linkService.eventBus)==null||Gr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Rt,name:"Keystroke",value:Sr,changeEx:ps,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(yn,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],Fr=>Fr.target.value)):yn.addEventListener("input",function(Fr){un.setValue(Rt,{value:ir(!0)})}),this.data.combo&&this._setTextStyle(yn),this._setBackgroundColor(yn),this._setDefaultPropertiesFromJS(yn),this.container.append(yn),this.container}}class hn extends Jt{constructor(un){const{data:Rt,elements:qt}=un;super(un,{isRenderable:Jt._hasPopupData(Rt)}),this.elements=qt}render(){this.container.classList.add("popupAnnotation");const un=new Yt({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),Rt=[];for(const qt of this.elements)qt.popup=un,Rt.push(qt.data.id),qt.addHighlightArea();return this.container.setAttribute("aria-controls",Rt.map(qt=>`${at.AnnotationPrefix}${qt}`).join(",")),this.container}}class Yt{constructor({container:un,color:Rt,elements:qt,titleObj:yn,modificationDate:Rn,contentsObj:zn,richText:ir,parent:Sr,rect:Nr,parentRect:Fr,open:ps}){Bn(this,Cr);Bn(this,ds);Bn(this,Ms);Bn(this,ns);Bn(this,jn,null);Bn(this,dr,nr(this,Cr,C1).bind(this));Bn(this,cr,nr(this,ns,yv).bind(this));Bn(this,wr,nr(this,Ms,_v).bind(this));Bn(this,Rr,nr(this,ds,Hy).bind(this));Bn(this,On,null);Bn(this,Mr,null);Bn(this,ts,null);Bn(this,Jr,null);Bn(this,jr,null);Bn(this,ss,null);Bn(this,Lr,!1);Bn(this,hr,null);Bn(this,or,null);Bn(this,Tr,null);Bn(this,Zr,null);Bn(this,qr,!1);var Ur;yr(this,Mr,un),yr(this,Zr,yn),yr(this,ts,zn),yr(this,Tr,ir),yr(this,jr,Sr),yr(this,On,Rt),yr(this,or,Nr),yr(this,ss,Fr),yr(this,Jr,qt);const Gr=ut.PDFDateString.toDateObject(Rn);Gr&&yr(this,jn,Sr.l10n.get("annotation_date_string",{date:Gr.toLocaleDateString(),time:Gr.toLocaleTimeString()})),this.trigger=qt.flatMap(is=>is.getElementsToTriggerPopup());for(const is of this.trigger)is.addEventListener("click",It(this,Rr)),is.addEventListener("mouseenter",It(this,wr)),is.addEventListener("mouseleave",It(this,cr)),is.classList.add("popupTriggerArea");for(const is of qt)(Ur=is.container)==null||Ur.addEventListener("keydown",It(this,dr));It(this,Mr).hidden=!0,ps&&nr(this,ds,Hy).call(this)}render(){if(It(this,hr))return;const{page:{view:un},viewport:{rawDims:{pageWidth:Rt,pageHeight:qt,pageX:yn,pageY:Rn}}}=It(this,jr),zn=yr(this,hr,document.createElement("div"));if(zn.className="popup",It(this,On)){const Ao=zn.style.outlineColor=at.Util.makeHexColor(...It(this,On));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?zn.style.backgroundColor=`color-mix(in srgb, ${Ao} 30%, white)`:zn.style.backgroundColor=at.Util.makeHexColor(...It(this,On).map(Cl=>Math.floor(.7*(255-Cl)+Cl)))}const ir=document.createElement("span");ir.className="header";const Sr=document.createElement("h1");if(ir.append(Sr),{dir:Sr.dir,str:Sr.textContent}=It(this,Zr),zn.append(ir),It(this,jn)){const Ao=document.createElement("span");Ao.classList.add("popupDate"),It(this,jn).then(oo=>{Ao.textContent=oo}),ir.append(Ao)}const Nr=It(this,ts),Fr=It(this,Tr);if(Fr!=null&&Fr.str&&(!(Nr!=null&&Nr.str)||Nr.str===Fr.str))At.XfaLayer.render({xfaHtml:Fr.html,intent:"richText",div:zn}),zn.lastChild.classList.add("richText","popupContent");else{const Ao=this._formatContents(Nr);zn.append(Ao)}let ps=!!It(this,ss),Gr=ps?It(this,ss):It(this,or);for(const Ao of It(this,Jr))if(!Gr||at.Util.intersect(Ao.data.rect,Gr)!==null){Gr=Ao.data.rect,ps=!0;break}const Ur=at.Util.normalizeRect([Gr[0],un[3]-Gr[1]+un[1],Gr[2],un[3]-Gr[3]+un[1]]),fs=ps?Gr[2]-Gr[0]+5:0,zs=Ur[0]+fs,Gs=Ur[1],{style:go}=It(this,Mr);go.left=`${100*(zs-yn)/Rt}%`,go.top=`${100*(Gs-Rn)/qt}%`,It(this,Mr).append(zn)}_formatContents({str:un,dir:Rt}){const qt=document.createElement("p");qt.classList.add("popupContent"),qt.dir=Rt;const yn=un.split(/(?:\r\n?|\n)/);for(let Rn=0,zn=yn.length;Rn<zn;++Rn){const ir=yn[Rn];qt.append(document.createTextNode(ir)),Rn<zn-1&&qt.append(document.createElement("br"))}return qt}forceHide(){yr(this,qr,this.isVisible),It(this,qr)&&(It(this,Mr).hidden=!0)}maybeShow(){It(this,qr)&&(yr(this,qr,!1),It(this,Mr).hidden=!1)}get isVisible(){return It(this,Mr).hidden===!1}}jn=new WeakMap,dr=new WeakMap,cr=new WeakMap,wr=new WeakMap,Rr=new WeakMap,On=new WeakMap,Mr=new WeakMap,ts=new WeakMap,Jr=new WeakMap,jr=new WeakMap,ss=new WeakMap,Lr=new WeakMap,hr=new WeakMap,or=new WeakMap,Tr=new WeakMap,Zr=new WeakMap,qr=new WeakMap,Cr=new WeakSet,C1=function(un){un.altKey||un.shiftKey||un.ctrlKey||un.metaKey||(un.key==="Enter"||un.key==="Escape"&&It(this,Lr))&&nr(this,ds,Hy).call(this)},ds=new WeakSet,Hy=function(){yr(this,Lr,!It(this,Lr)),It(this,Lr)?(nr(this,Ms,_v).call(this),It(this,Mr).addEventListener("click",It(this,Rr)),It(this,Mr).addEventListener("keydown",It(this,dr))):(nr(this,ns,yv).call(this),It(this,Mr).removeEventListener("click",It(this,Rr)),It(this,Mr).removeEventListener("keydown",It(this,dr)))},Ms=new WeakSet,_v=function(){It(this,hr)||this.render(),this.isVisible?It(this,Lr)&&It(this,Mr).classList.add("focused"):(It(this,Mr).hidden=!1,It(this,Mr).style.zIndex=parseInt(It(this,Mr).style.zIndex)+1e3)},ns=new WeakSet,yv=function(){It(this,Mr).classList.remove("focused"),!(It(this,Lr)||!this.isVisible)&&(It(this,Mr).hidden=!0,It(this,Mr).style.zIndex=parseInt(It(this,Mr).style.zIndex)-1e3)};class vn extends Jt{constructor(un){super(un,{isRenderable:!0,ignoreBorder:!0}),this.textContent=un.data.textContent,this.textPosition=un.data.textPosition,this.annotationEditorType=at.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const un=document.createElement("div");un.classList.add("annotationTextContent"),un.setAttribute("role","comment");for(const Rt of this.textContent){const qt=document.createElement("span");qt.textContent=Rt,un.append(qt)}this.container.append(un)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}et.FreeTextAnnotationElement=vn;class fn extends Jt{constructor(Rt){super(Rt,{isRenderable:!0,ignoreBorder:!0});Bn(this,Yn,null)}render(){this.container.classList.add("lineAnnotation");const Rt=this.data,{width:qt,height:yn}=Mt(Rt.rect),Rn=this.svgFactory.create(qt,yn,!0),zn=yr(this,Yn,this.svgFactory.createElement("svg:line"));return zn.setAttribute("x1",Rt.rect[2]-Rt.lineCoordinates[0]),zn.setAttribute("y1",Rt.rect[3]-Rt.lineCoordinates[1]),zn.setAttribute("x2",Rt.rect[2]-Rt.lineCoordinates[2]),zn.setAttribute("y2",Rt.rect[3]-Rt.lineCoordinates[3]),zn.setAttribute("stroke-width",Rt.borderStyle.width||1),zn.setAttribute("stroke","transparent"),zn.setAttribute("fill","transparent"),Rn.append(zn),this.container.append(Rn),!Rt.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return It(this,Yn)}addHighlightArea(){this.container.classList.add("highlightArea")}}Yn=new WeakMap;class Wn extends Jt{constructor(Rt){super(Rt,{isRenderable:!0,ignoreBorder:!0});Bn(this,qn,null)}render(){this.container.classList.add("squareAnnotation");const Rt=this.data,{width:qt,height:yn}=Mt(Rt.rect),Rn=this.svgFactory.create(qt,yn,!0),zn=Rt.borderStyle.width,ir=yr(this,qn,this.svgFactory.createElement("svg:rect"));return ir.setAttribute("x",zn/2),ir.setAttribute("y",zn/2),ir.setAttribute("width",qt-zn),ir.setAttribute("height",yn-zn),ir.setAttribute("stroke-width",zn||1),ir.setAttribute("stroke","transparent"),ir.setAttribute("fill","transparent"),Rn.append(ir),this.container.append(Rn),!Rt.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return It(this,qn)}addHighlightArea(){this.container.classList.add("highlightArea")}}qn=new WeakMap;class Xn extends Jt{constructor(Rt){super(Rt,{isRenderable:!0,ignoreBorder:!0});Bn(this,Er,null)}render(){this.container.classList.add("circleAnnotation");const Rt=this.data,{width:qt,height:yn}=Mt(Rt.rect),Rn=this.svgFactory.create(qt,yn,!0),zn=Rt.borderStyle.width,ir=yr(this,Er,this.svgFactory.createElement("svg:ellipse"));return ir.setAttribute("cx",qt/2),ir.setAttribute("cy",yn/2),ir.setAttribute("rx",qt/2-zn/2),ir.setAttribute("ry",yn/2-zn/2),ir.setAttribute("stroke-width",zn||1),ir.setAttribute("stroke","transparent"),ir.setAttribute("fill","transparent"),Rn.append(ir),this.container.append(Rn),!Rt.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return It(this,Er)}addHighlightArea(){this.container.classList.add("highlightArea")}}Er=new WeakMap;class Sn extends Jt{constructor(Rt){super(Rt,{isRenderable:!0,ignoreBorder:!0});Bn(this,kr,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const Rt=this.data,{width:qt,height:yn}=Mt(Rt.rect),Rn=this.svgFactory.create(qt,yn,!0);let zn=[];for(const Sr of Rt.vertices){const Nr=Sr.x-Rt.rect[0],Fr=Rt.rect[3]-Sr.y;zn.push(Nr+","+Fr)}zn=zn.join(" ");const ir=yr(this,kr,this.svgFactory.createElement(this.svgElementName));return ir.setAttribute("points",zn),ir.setAttribute("stroke-width",Rt.borderStyle.width||1),ir.setAttribute("stroke","transparent"),ir.setAttribute("fill","transparent"),Rn.append(ir),this.container.append(Rn),!Rt.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return It(this,kr)}addHighlightArea(){this.container.classList.add("highlightArea")}}kr=new WeakMap;class _i extends Sn{constructor(un){super(un),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class gr extends Jt{constructor(un){super(un,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class br extends Jt{constructor(Rt){super(Rt,{isRenderable:!0,ignoreBorder:!0});Bn(this,Us,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=at.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const Rt=this.data,{width:qt,height:yn}=Mt(Rt.rect),Rn=this.svgFactory.create(qt,yn,!0);for(const zn of Rt.inkLists){let ir=[];for(const Nr of zn){const Fr=Nr.x-Rt.rect[0],ps=Rt.rect[3]-Nr.y;ir.push(`${Fr},${ps}`)}ir=ir.join(" ");const Sr=this.svgFactory.createElement(this.svgElementName);It(this,Us).push(Sr),Sr.setAttribute("points",ir),Sr.setAttribute("stroke-width",Rt.borderStyle.width||1),Sr.setAttribute("stroke","transparent"),Sr.setAttribute("fill","transparent"),!Rt.popupRef&&this.hasPopupData&&this._createPopup(),Rn.append(Sr)}return this.container.append(Rn),this.container}getElementsToTriggerPopup(){return It(this,Us)}addHighlightArea(){this.container.classList.add("highlightArea")}}Us=new WeakMap,et.InkAnnotationElement=br;class Pn extends Jt{constructor(un){super(un,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class lr extends Jt{constructor(un){super(un,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class xr extends Jt{constructor(un){super(un,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Dr extends Jt{constructor(un){super(un,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class $r extends Jt{constructor(un){super(un,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}et.StampAnnotationElement=$r;class An extends Jt{constructor(Rt){var Rn;super(Rt,{isRenderable:!0});Bn(this,rr);Bn(this,lo,null);const{filename:qt,content:yn}=this.data.file;this.filename=(0,ut.getFilenameFromUrl)(qt,!0),this.content=yn,(Rn=this.linkService.eventBus)==null||Rn.dispatch("fileattachmentannotation",{source:this,filename:qt,content:yn})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:Rt,data:qt}=this;let yn;qt.hasAppearance||qt.fillAlpha===0?yn=document.createElement("div"):(yn=document.createElement("img"),yn.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(qt.name)?"paperclip":"pushpin"}.svg`,qt.fillAlpha&&qt.fillAlpha<1&&(yn.style=`filter: opacity(${Math.round(qt.fillAlpha*100)}%);`)),yn.addEventListener("dblclick",nr(this,rr,vv).bind(this)),yr(this,lo,yn);const{isMac:Rn}=at.FeatureTest.platform;return Rt.addEventListener("keydown",zn=>{zn.key==="Enter"&&(Rn?zn.metaKey:zn.ctrlKey)&&nr(this,rr,vv).call(this)}),!qt.popupRef&&this.hasPopupData?this._createPopup():yn.classList.add("popupTriggerArea"),Rt.append(yn),Rt}getElementsToTriggerPopup(){return It(this,lo)}addHighlightArea(){this.container.classList.add("highlightArea")}}lo=new WeakMap,rr=new WeakSet,vv=function(){var Rt;(Rt=this.downloadManager)==null||Rt.openOrDownloadData(this.container,this.content,this.filename)};class Nt{constructor({div:un,accessibilityManager:Rt,annotationCanvasMap:qt,l10n:yn,page:Rn,viewport:zn}){Bn(this,xn);Bn(this,Tn);Bn(this,Wt,null);Bn(this,jt,null);Bn(this,ln,new Map);this.div=un,yr(this,Wt,Rt),yr(this,jt,qt),this.l10n=yn,this.page=Rn,this.viewport=zn,this.zIndex=0,this.l10n||(this.l10n=ct.NullL10n)}async render(un){const{annotations:Rt}=un,qt=this.div;(0,ut.setLayerDimensions)(qt,this.viewport);const yn=new Map,Rn={data:null,layer:qt,linkService:un.linkService,downloadManager:un.downloadManager,imageResourcesPath:un.imageResourcesPath||"",renderForms:un.renderForms!==!1,svgFactory:new ut.DOMSVGFactory,annotationStorage:un.annotationStorage||new pt.AnnotationStorage,enableScripting:un.enableScripting===!0,hasJSActions:un.hasJSActions,fieldObjects:un.fieldObjects,parent:this,elements:null};for(const zn of Rt){if(zn.noHTML)continue;const ir=zn.annotationType===at.AnnotationType.POPUP;if(ir){const Fr=yn.get(zn.id);if(!Fr)continue;Rn.elements=Fr}else{const{width:Fr,height:ps}=Mt(zn.rect);if(Fr<=0||ps<=0)continue}Rn.data=zn;const Sr=Qt.create(Rn);if(!Sr.isRenderable)continue;if(!ir&&zn.popupRef){const Fr=yn.get(zn.popupRef);Fr?Fr.push(Sr):yn.set(zn.popupRef,[Sr])}Sr.annotationEditorType>0&&It(this,ln).set(Sr.data.id,Sr);const Nr=Sr.render();zn.hidden&&(Nr.style.visibility="hidden"),nr(this,xn,k1).call(this,Nr,zn.id)}nr(this,Tn,xv).call(this),await this.l10n.translate(qt)}update({viewport:un}){const Rt=this.div;this.viewport=un,(0,ut.setLayerDimensions)(Rt,{rotation:un.rotation}),nr(this,Tn,xv).call(this),Rt.hidden=!1}getEditableAnnotations(){return Array.from(It(this,ln).values())}getEditableAnnotation(un){return It(this,ln).get(un)}}Wt=new WeakMap,jt=new WeakMap,ln=new WeakMap,xn=new WeakSet,k1=function(un,Rt){var yn;const qt=un.firstChild||un;qt.id=`${at.AnnotationPrefix}${Rt}`,this.div.append(un),(yn=It(this,Wt))==null||yn.moveElementInDOM(this.div,un,qt,!1)},Tn=new WeakSet,xv=function(){if(!It(this,jt))return;const un=this.div;for(const[Rt,qt]of It(this,jt)){const yn=un.querySelector(`[data-annotation-id="${Rt}"]`);if(!yn)continue;const{firstChild:Rn}=yn;Rn?Rn.nodeName==="CANVAS"?Rn.replaceWith(qt):Rn.before(qt):yn.append(qt)}It(this,jt).clear()},et.AnnotationLayer=Nt},(_e,et)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.ColorConverters=void 0;function rt(pt){return Math.floor(Math.max(0,Math.min(1,pt))*255).toString(16).padStart(2,"0")}function at(pt){return Math.max(0,Math.min(255,255*pt))}class ut{static CMYK_G([yt,ct,At,Pt]){return["G",1-Math.min(1,.3*yt+.59*At+.11*ct+Pt)]}static G_CMYK([yt]){return["CMYK",0,0,0,1-yt]}static G_RGB([yt]){return["RGB",yt,yt,yt]}static G_rgb([yt]){return yt=at(yt),[yt,yt,yt]}static G_HTML([yt]){const ct=rt(yt);return`#${ct}${ct}${ct}`}static RGB_G([yt,ct,At]){return["G",.3*yt+.59*ct+.11*At]}static RGB_rgb(yt){return yt.map(at)}static RGB_HTML(yt){return`#${yt.map(rt).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([yt,ct,At,Pt]){return["RGB",1-Math.min(1,yt+Pt),1-Math.min(1,At+Pt),1-Math.min(1,ct+Pt)]}static CMYK_rgb([yt,ct,At,Pt]){return[at(1-Math.min(1,yt+Pt)),at(1-Math.min(1,At+Pt)),at(1-Math.min(1,ct+Pt))]}static CMYK_HTML(yt){const ct=this.CMYK_RGB(yt).slice(1);return this.RGB_HTML(ct)}static RGB_CMYK([yt,ct,At]){const Pt=1-yt,kt=1-ct,Lt=1-At,Mt=Math.min(Pt,kt,Lt);return["CMYK",Pt,kt,Lt,Mt]}}et.ColorConverters=ut},(_e,et)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.NullL10n=void 0,et.getL10nFallback=at;const rt={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};rt.print_progress_percent="{{progress}}%";function at(yt,ct){switch(yt){case"find_match_count":yt=`find_match_count[${ct.total===1?"one":"other"}]`;break;case"find_match_count_limit":yt=`find_match_count_limit[${ct.limit===1?"one":"other"}]`;break}return rt[yt]||""}function ut(yt,ct){return ct?yt.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(At,Pt)=>Pt in ct?ct[Pt]:"{{"+Pt+"}}"):yt}const pt={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(yt,ct=null,At=at(yt,ct)){return ut(At,ct)},async translate(yt){}};et.NullL10n=pt},(_e,et,rt)=>{Object.defineProperty(et,"__esModule",{value:!0}),et.XfaLayer=void 0;var at=rt(25);class ut{static setupStorage(yt,ct,At,Pt,kt){const Lt=Pt.getValue(ct,{value:null});switch(At.name){case"textarea":if(Lt.value!==null&&(yt.textContent=Lt.value),kt==="print")break;yt.addEventListener("input",Mt=>{Pt.setValue(ct,{value:Mt.target.value})});break;case"input":if(At.attributes.type==="radio"||At.attributes.type==="checkbox"){if(Lt.value===At.attributes.xfaOn?yt.setAttribute("checked",!0):Lt.value===At.attributes.xfaOff&&yt.removeAttribute("checked"),kt==="print")break;yt.addEventListener("change",Mt=>{Pt.setValue(ct,{value:Mt.target.checked?Mt.target.getAttribute("xfaOn"):Mt.target.getAttribute("xfaOff")})})}else{if(Lt.value!==null&&yt.setAttribute("value",Lt.value),kt==="print")break;yt.addEventListener("input",Mt=>{Pt.setValue(ct,{value:Mt.target.value})})}break;case"select":if(Lt.value!==null){yt.setAttribute("value",Lt.value);for(const Mt of At.children)Mt.attributes.value===Lt.value?Mt.attributes.selected=!0:Mt.attributes.hasOwnProperty("selected")&&delete Mt.attributes.selected}yt.addEventListener("input",Mt=>{const Qt=Mt.target.options,Jt=Qt.selectedIndex===-1?"":Qt[Qt.selectedIndex].value;Pt.setValue(ct,{value:Jt})});break}}static setAttributes({html:yt,element:ct,storage:At=null,intent:Pt,linkService:kt}){const{attributes:Lt}=ct,Mt=yt instanceof HTMLAnchorElement;Lt.type==="radio"&&(Lt.name=`${Lt.name}-${Pt}`);for(const[Qt,Jt]of Object.entries(Lt))if(Jt!=null)switch(Qt){case"class":Jt.length&&yt.setAttribute(Qt,Jt.join(" "));break;case"dataId":break;case"id":yt.setAttribute("data-element-id",Jt);break;case"style":Object.assign(yt.style,Jt);break;case"textContent":yt.textContent=Jt;break;default:(!Mt||Qt!=="href"&&Qt!=="newWindow")&&yt.setAttribute(Qt,Jt)}Mt&&kt.addLinkAttributes(yt,Lt.href,Lt.newWindow),At&&Lt.dataId&&this.setupStorage(yt,Lt.dataId,ct,At)}static render(yt){var sn;const ct=yt.annotationStorage,At=yt.linkService,Pt=yt.xfaHtml,kt=yt.intent||"display",Lt=document.createElement(Pt.name);Pt.attributes&&this.setAttributes({html:Lt,element:Pt,intent:kt,linkService:At});const Mt=[[Pt,-1,Lt]],Qt=yt.div;if(Qt.append(Lt),yt.viewport){const tn=`matrix(${yt.viewport.transform.join(",")})`;Qt.style.transform=tn}kt!=="richText"&&Qt.setAttribute("class","xfaLayer xfaFont");const Jt=[];for(;Mt.length>0;){const[tn,Bt,zt]=Mt.at(-1);if(Bt+1===tn.children.length){Mt.pop();continue}const Ht=tn.children[++Mt.at(-1)[1]];if(Ht===null)continue;const{name:nn}=Ht;if(nn==="#text"){const Kt=document.createTextNode(Ht.value);Jt.push(Kt),zt.append(Kt);continue}const Ot=(sn=Ht==null?void 0:Ht.attributes)!=null&&sn.xmlns?document.createElementNS(Ht.attributes.xmlns,nn):document.createElement(nn);if(zt.append(Ot),Ht.attributes&&this.setAttributes({html:Ot,element:Ht,storage:ct,intent:kt,linkService:At}),Ht.children&&Ht.children.length>0)Mt.push([Ht,-1,Ot]);else if(Ht.value){const Kt=document.createTextNode(Ht.value);at.XfaText.shouldBuildText(nn)&&Jt.push(Kt),Ot.append(Kt)}}for(const tn of Qt.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))tn.setAttribute("readOnly",!0);return{textDivs:Jt}}static update(yt){const ct=`matrix(${yt.viewport.transform.join(",")})`;yt.div.style.transform=ct,yt.div.hidden=!1}}et.XfaLayer=ut},(_e,et,rt)=>{var Pt,kt,Lt,Mt,Qt,Jt,sn,tn,Bt,zt,Ht,nn,Ot,Kt,mn,P1,Yt,R1,fn,M1,Xn,I1,_i,bv,br,D1,lr,wv,Dr,L1,An,F1,Zt,O1,rn,z1,En,N1,jn,jp,cr,Ev,Rr,Wy,Mr,qy,Jr,l_,ss,Sv,hr,Gy,Tr,B1,qr,Av,ws,j1,Ts,$1,Pr,Tv,tr,Xy,qn,c_;Object.defineProperty(et,"__esModule",{value:!0}),et.InkEditor=void 0;var at=rt(1),ut=rt(4),pt=rt(29),yt=rt(6),ct=rt(5);const kr=class kr extends ut.AnnotationEditor{constructor(rr){super({...rr,name:"inkEditor"});Bn(this,mn);Bn(this,Yt);Bn(this,fn);Bn(this,Xn);Bn(this,_i);Bn(this,br);Bn(this,lr);Bn(this,Dr);Bn(this,An);Bn(this,Zt);Bn(this,rn);Bn(this,En);Bn(this,jn);Bn(this,cr);Bn(this,Rr);Bn(this,Mr);Bn(this,Jr);Bn(this,ss);Bn(this,hr);Bn(this,Ts);Bn(this,Pr);Bn(this,tr);Bn(this,qn);Bn(this,Pt,0);Bn(this,kt,0);Bn(this,Lt,this.canvasPointermove.bind(this));Bn(this,Mt,this.canvasPointerleave.bind(this));Bn(this,Qt,this.canvasPointerup.bind(this));Bn(this,Jt,this.canvasPointerdown.bind(this));Bn(this,sn,new Path2D);Bn(this,tn,!1);Bn(this,Bt,!1);Bn(this,zt,!1);Bn(this,Ht,null);Bn(this,nn,0);Bn(this,Ot,0);Bn(this,Kt,null);this.color=rr.color||null,this.thickness=rr.thickness||null,this.opacity=rr.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(rr){ut.AnnotationEditor.initialize(rr,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(rr,_n){switch(rr){case at.AnnotationEditorParamsType.INK_THICKNESS:kr._defaultThickness=_n;break;case at.AnnotationEditorParamsType.INK_COLOR:kr._defaultColor=_n;break;case at.AnnotationEditorParamsType.INK_OPACITY:kr._defaultOpacity=_n/100;break}}updateParams(rr,_n){switch(rr){case at.AnnotationEditorParamsType.INK_THICKNESS:nr(this,mn,P1).call(this,_n);break;case at.AnnotationEditorParamsType.INK_COLOR:nr(this,Yt,R1).call(this,_n);break;case at.AnnotationEditorParamsType.INK_OPACITY:nr(this,fn,M1).call(this,_n);break}}static get defaultPropertiesToUpdate(){return[[at.AnnotationEditorParamsType.INK_THICKNESS,kr._defaultThickness],[at.AnnotationEditorParamsType.INK_COLOR,kr._defaultColor||ut.AnnotationEditor._defaultLineColor],[at.AnnotationEditorParamsType.INK_OPACITY,Math.round(kr._defaultOpacity*100)]]}get propertiesToUpdate(){return[[at.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||kr._defaultThickness],[at.AnnotationEditorParamsType.INK_COLOR,this.color||kr._defaultColor||ut.AnnotationEditor._defaultLineColor],[at.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??kr._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(nr(this,Rr,Wy).call(this),nr(this,Mr,qy).call(this)),this.isAttachedToDOM||(this.parent.add(this),nr(this,Jr,l_).call(this)),nr(this,qn,c_).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,It(this,Ht).disconnect(),yr(this,Ht,null),super.remove())}setParent(rr){!this.parent&&rr?this._uiManager.removeShouldRescale(this):this.parent&&rr===null&&this._uiManager.addShouldRescale(this),super.setParent(rr)}onScaleChanging(){const[rr,_n]=this.parentDimensions,Wt=this.width*rr,jt=this.height*_n;this.setDimensions(Wt,jt)}enableEditMode(){It(this,tn)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",It(this,Jt)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",It(this,Jt)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){It(this,tn)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),yr(this,tn,!0),this.div.classList.add("disabled"),nr(this,qn,c_).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(rr){this._focusEventsAllowed&&(super.focusin(rr),this.enableEditMode())}canvasPointerdown(rr){rr.button!==0||!this.isInEditMode()||It(this,tn)||(this.setInForeground(),rr.preventDefault(),rr.type!=="mouse"&&this.div.focus(),nr(this,br,D1).call(this,rr.offsetX,rr.offsetY))}canvasPointermove(rr){rr.preventDefault(),nr(this,lr,wv).call(this,rr.offsetX,rr.offsetY)}canvasPointerup(rr){rr.preventDefault(),nr(this,cr,Ev).call(this,rr)}canvasPointerleave(rr){nr(this,cr,Ev).call(this,rr)}get isResizable(){return!this.isEmpty()&&It(this,tn)}render(){if(this.div)return this.div;let rr,_n;this.width&&(rr=this.x,_n=this.y),super.render(),ut.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(Nn=>{var Tn;return(Tn=this.div)==null?void 0:Tn.setAttribute("aria-label",Nn)});const[Wt,jt,ln,xn]=nr(this,Xn,I1).call(this);if(this.setAt(Wt,jt,0,0),this.setDims(ln,xn),nr(this,Rr,Wy).call(this),this.width){const[Nn,Tn]=this.parentDimensions;this.setAspectRatio(this.width*Nn,this.height*Tn),this.setAt(rr*Nn,_n*Tn,this.width*Nn,this.height*Tn),yr(this,zt,!0),nr(this,Jr,l_).call(this),this.setDims(this.width*Nn,this.height*Tn),nr(this,jn,jp).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return nr(this,Mr,qy).call(this),this.div}setDimensions(rr,_n){const Wt=Math.round(rr),jt=Math.round(_n);if(It(this,nn)===Wt&&It(this,Ot)===jt)return;yr(this,nn,Wt),yr(this,Ot,jt),this.canvas.style.visibility="hidden";const[ln,xn]=this.parentDimensions;this.width=rr/ln,this.height=_n/xn,this.fixAndSetPosition(),It(this,tn)&&nr(this,ss,Sv).call(this,rr,_n),nr(this,Jr,l_).call(this),nr(this,jn,jp).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(rr,_n,Wt){var Rn,zn,ir;if(rr instanceof pt.InkAnnotationElement)return null;const jt=super.deserialize(rr,_n,Wt);jt.thickness=rr.thickness,jt.color=at.Util.makeHexColor(...rr.color),jt.opacity=rr.opacity;const[ln,xn]=jt.pageDimensions,Nn=jt.width*ln,Tn=jt.height*xn,Kn=jt.parentScale,Cn=rr.thickness/2;yr(jt,tn,!0),yr(jt,nn,Math.round(Nn)),yr(jt,Ot,Math.round(Tn));const{paths:un,rect:Rt,rotation:qt}=rr;for(let{bezier:Sr}of un){Sr=nr(Rn=kr,ws,j1).call(Rn,Sr,Rt,qt);const Nr=[];jt.paths.push(Nr);let Fr=Kn*(Sr[0]-Cn),ps=Kn*(Sr[1]-Cn);for(let Ur=2,is=Sr.length;Ur<is;Ur+=6){const fs=Kn*(Sr[Ur]-Cn),zs=Kn*(Sr[Ur+1]-Cn),Gs=Kn*(Sr[Ur+2]-Cn),go=Kn*(Sr[Ur+3]-Cn),Ao=Kn*(Sr[Ur+4]-Cn),oo=Kn*(Sr[Ur+5]-Cn);Nr.push([[Fr,ps],[fs,zs],[Gs,go],[Ao,oo]]),Fr=Ao,ps=oo}const Gr=nr(this,Tr,B1).call(this,Nr);jt.bezierPath2D.push(Gr)}const yn=nr(zn=jt,Pr,Tv).call(zn);return yr(jt,kt,Math.max(ut.AnnotationEditor.MIN_SIZE,yn[2]-yn[0])),yr(jt,Pt,Math.max(ut.AnnotationEditor.MIN_SIZE,yn[3]-yn[1])),nr(ir=jt,ss,Sv).call(ir,Nn,Tn),jt}serialize(){if(this.isEmpty())return null;const rr=this.getRect(0,0),_n=ut.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:at.AnnotationEditorType.INK,color:_n,thickness:this.thickness,opacity:this.opacity,paths:nr(this,Ts,$1).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,rr),pageIndex:this.pageIndex,rect:rr,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};Pt=new WeakMap,kt=new WeakMap,Lt=new WeakMap,Mt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,sn=new WeakMap,tn=new WeakMap,Bt=new WeakMap,zt=new WeakMap,Ht=new WeakMap,nn=new WeakMap,Ot=new WeakMap,Kt=new WeakMap,mn=new WeakSet,P1=function(rr){const _n=this.thickness;this.addCommands({cmd:()=>{this.thickness=rr,nr(this,qn,c_).call(this)},undo:()=>{this.thickness=_n,nr(this,qn,c_).call(this)},mustExec:!0,type:at.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},Yt=new WeakSet,R1=function(rr){const _n=this.color;this.addCommands({cmd:()=>{this.color=rr,nr(this,jn,jp).call(this)},undo:()=>{this.color=_n,nr(this,jn,jp).call(this)},mustExec:!0,type:at.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},fn=new WeakSet,M1=function(rr){rr/=100;const _n=this.opacity;this.addCommands({cmd:()=>{this.opacity=rr,nr(this,jn,jp).call(this)},undo:()=>{this.opacity=_n,nr(this,jn,jp).call(this)},mustExec:!0,type:at.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Xn=new WeakSet,I1=function(){const{parentRotation:rr,parentDimensions:[_n,Wt]}=this;switch(rr){case 90:return[0,Wt,Wt,_n];case 180:return[_n,Wt,_n,Wt];case 270:return[_n,0,Wt,_n];default:return[0,0,_n,Wt]}},_i=new WeakSet,bv=function(){const{ctx:rr,color:_n,opacity:Wt,thickness:jt,parentScale:ln,scaleFactor:xn}=this;rr.lineWidth=jt*ln/xn,rr.lineCap="round",rr.lineJoin="round",rr.miterLimit=10,rr.strokeStyle=`${_n}${(0,ct.opacityToHex)(Wt)}`},br=new WeakSet,D1=function(rr,_n){this.canvas.addEventListener("contextmenu",yt.noContextMenu),this.canvas.addEventListener("pointerleave",It(this,Mt)),this.canvas.addEventListener("pointermove",It(this,Lt)),this.canvas.addEventListener("pointerup",It(this,Qt)),this.canvas.removeEventListener("pointerdown",It(this,Jt)),this.isEditing=!0,It(this,zt)||(yr(this,zt,!0),nr(this,Jr,l_).call(this),this.thickness||(this.thickness=kr._defaultThickness),this.color||(this.color=kr._defaultColor||ut.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=kr._defaultOpacity)),this.currentPath.push([rr,_n]),yr(this,Bt,!1),nr(this,_i,bv).call(this),yr(this,Kt,()=>{nr(this,Zt,O1).call(this),It(this,Kt)&&window.requestAnimationFrame(It(this,Kt))}),window.requestAnimationFrame(It(this,Kt))},lr=new WeakSet,wv=function(rr,_n){const[Wt,jt]=this.currentPath.at(-1);if(this.currentPath.length>1&&rr===Wt&&_n===jt)return;const ln=this.currentPath;let xn=It(this,sn);if(ln.push([rr,_n]),yr(this,Bt,!0),ln.length<=2){xn.moveTo(...ln[0]),xn.lineTo(rr,_n);return}ln.length===3&&(yr(this,sn,xn=new Path2D),xn.moveTo(...ln[0])),nr(this,rn,z1).call(this,xn,...ln.at(-3),...ln.at(-2),rr,_n)},Dr=new WeakSet,L1=function(){if(this.currentPath.length===0)return;const rr=this.currentPath.at(-1);It(this,sn).lineTo(...rr)},An=new WeakSet,F1=function(rr,_n){yr(this,Kt,null),rr=Math.min(Math.max(rr,0),this.canvas.width),_n=Math.min(Math.max(_n,0),this.canvas.height),nr(this,lr,wv).call(this,rr,_n),nr(this,Dr,L1).call(this);let Wt;if(this.currentPath.length!==1)Wt=nr(this,En,N1).call(this);else{const Tn=[rr,_n];Wt=[[Tn,Tn.slice(),Tn.slice(),Tn]]}const jt=It(this,sn),ln=this.currentPath;this.currentPath=[],yr(this,sn,new Path2D);const xn=()=>{this.allRawPaths.push(ln),this.paths.push(Wt),this.bezierPath2D.push(jt),this.rebuild()},Nn=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(nr(this,Rr,Wy).call(this),nr(this,Mr,qy).call(this)),nr(this,qn,c_).call(this))};this.addCommands({cmd:xn,undo:Nn,mustExec:!0})},Zt=new WeakSet,O1=function(){if(!It(this,Bt))return;yr(this,Bt,!1);const rr=Math.ceil(this.thickness*this.parentScale),_n=this.currentPath.slice(-3),Wt=_n.map(xn=>xn[0]),jt=_n.map(xn=>xn[1]);Math.min(...Wt)-rr,Math.max(...Wt)+rr,Math.min(...jt)-rr,Math.max(...jt)+rr;const{ctx:ln}=this;ln.save(),ln.clearRect(0,0,this.canvas.width,this.canvas.height);for(const xn of this.bezierPath2D)ln.stroke(xn);ln.stroke(It(this,sn)),ln.restore()},rn=new WeakSet,z1=function(rr,_n,Wt,jt,ln,xn,Nn){const Tn=(_n+jt)/2,Kn=(Wt+ln)/2,Cn=(jt+xn)/2,un=(ln+Nn)/2;rr.bezierCurveTo(Tn+2*(jt-Tn)/3,Kn+2*(ln-Kn)/3,Cn+2*(jt-Cn)/3,un+2*(ln-un)/3,Cn,un)},En=new WeakSet,N1=function(){const rr=this.currentPath;if(rr.length<=2)return[[rr[0],rr[0],rr.at(-1),rr.at(-1)]];const _n=[];let Wt,[jt,ln]=rr[0];for(Wt=1;Wt<rr.length-2;Wt++){const[Rt,qt]=rr[Wt],[yn,Rn]=rr[Wt+1],zn=(Rt+yn)/2,ir=(qt+Rn)/2,Sr=[jt+2*(Rt-jt)/3,ln+2*(qt-ln)/3],Nr=[zn+2*(Rt-zn)/3,ir+2*(qt-ir)/3];_n.push([[jt,ln],Sr,Nr,[zn,ir]]),[jt,ln]=[zn,ir]}const[xn,Nn]=rr[Wt],[Tn,Kn]=rr[Wt+1],Cn=[jt+2*(xn-jt)/3,ln+2*(Nn-ln)/3],un=[Tn+2*(xn-Tn)/3,Kn+2*(Nn-Kn)/3];return _n.push([[jt,ln],Cn,un,[Tn,Kn]]),_n},jn=new WeakSet,jp=function(){if(this.isEmpty()){nr(this,hr,Gy).call(this);return}nr(this,_i,bv).call(this);const{canvas:rr,ctx:_n}=this;_n.setTransform(1,0,0,1,0,0),_n.clearRect(0,0,rr.width,rr.height),nr(this,hr,Gy).call(this);for(const Wt of this.bezierPath2D)_n.stroke(Wt)},cr=new WeakSet,Ev=function(rr){this.canvas.removeEventListener("pointerleave",It(this,Mt)),this.canvas.removeEventListener("pointermove",It(this,Lt)),this.canvas.removeEventListener("pointerup",It(this,Qt)),this.canvas.addEventListener("pointerdown",It(this,Jt)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",yt.noContextMenu)},10),nr(this,An,F1).call(this,rr.offsetX,rr.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Rr=new WeakSet,Wy=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",ut.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(rr=>{var _n;return(_n=this.canvas)==null?void 0:_n.setAttribute("aria-label",rr)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Mr=new WeakSet,qy=function(){yr(this,Ht,new ResizeObserver(rr=>{const _n=rr[0].contentRect;_n.width&&_n.height&&this.setDimensions(_n.width,_n.height)})),It(this,Ht).observe(this.div)},Jr=new WeakSet,l_=function(){if(!It(this,zt))return;const[rr,_n]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*rr),this.canvas.height=Math.ceil(this.height*_n),nr(this,hr,Gy).call(this)},ss=new WeakSet,Sv=function(rr,_n){const Wt=nr(this,tr,Xy).call(this),jt=(rr-Wt)/It(this,kt),ln=(_n-Wt)/It(this,Pt);this.scaleFactor=Math.min(jt,ln)},hr=new WeakSet,Gy=function(){const rr=nr(this,tr,Xy).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+rr,this.translationY*this.scaleFactor+rr)},Tr=new WeakSet,B1=function(rr){const _n=new Path2D;for(let Wt=0,jt=rr.length;Wt<jt;Wt++){const[ln,xn,Nn,Tn]=rr[Wt];Wt===0&&_n.moveTo(...ln),_n.bezierCurveTo(xn[0],xn[1],Nn[0],Nn[1],Tn[0],Tn[1])}return _n},qr=new WeakSet,Av=function(rr,_n,Wt){const[jt,ln,xn,Nn]=_n;switch(Wt){case 0:for(let Tn=0,Kn=rr.length;Tn<Kn;Tn+=2)rr[Tn]+=jt,rr[Tn+1]=Nn-rr[Tn+1];break;case 90:for(let Tn=0,Kn=rr.length;Tn<Kn;Tn+=2){const Cn=rr[Tn];rr[Tn]=rr[Tn+1]+jt,rr[Tn+1]=Cn+ln}break;case 180:for(let Tn=0,Kn=rr.length;Tn<Kn;Tn+=2)rr[Tn]=xn-rr[Tn],rr[Tn+1]+=ln;break;case 270:for(let Tn=0,Kn=rr.length;Tn<Kn;Tn+=2){const Cn=rr[Tn];rr[Tn]=xn-rr[Tn+1],rr[Tn+1]=Nn-Cn}break;default:throw new Error("Invalid rotation")}return rr},ws=new WeakSet,j1=function(rr,_n,Wt){const[jt,ln,xn,Nn]=_n;switch(Wt){case 0:for(let Tn=0,Kn=rr.length;Tn<Kn;Tn+=2)rr[Tn]-=jt,rr[Tn+1]=Nn-rr[Tn+1];break;case 90:for(let Tn=0,Kn=rr.length;Tn<Kn;Tn+=2){const Cn=rr[Tn];rr[Tn]=rr[Tn+1]-ln,rr[Tn+1]=Cn-jt}break;case 180:for(let Tn=0,Kn=rr.length;Tn<Kn;Tn+=2)rr[Tn]=xn-rr[Tn],rr[Tn+1]-=ln;break;case 270:for(let Tn=0,Kn=rr.length;Tn<Kn;Tn+=2){const Cn=rr[Tn];rr[Tn]=Nn-rr[Tn+1],rr[Tn+1]=xn-Cn}break;default:throw new Error("Invalid rotation")}return rr},Ts=new WeakSet,$1=function(rr,_n,Wt,jt){var Kn,Cn;const ln=[],xn=this.thickness/2,Nn=rr*_n+xn,Tn=rr*Wt+xn;for(const un of this.paths){const Rt=[],qt=[];for(let yn=0,Rn=un.length;yn<Rn;yn++){const[zn,ir,Sr,Nr]=un[yn],Fr=rr*zn[0]+Nn,ps=rr*zn[1]+Tn,Gr=rr*ir[0]+Nn,Ur=rr*ir[1]+Tn,is=rr*Sr[0]+Nn,fs=rr*Sr[1]+Tn,zs=rr*Nr[0]+Nn,Gs=rr*Nr[1]+Tn;yn===0&&(Rt.push(Fr,ps),qt.push(Fr,ps)),Rt.push(Gr,Ur,is,fs,zs,Gs),qt.push(Gr,Ur),yn===Rn-1&&qt.push(zs,Gs)}ln.push({bezier:nr(Kn=kr,qr,Av).call(Kn,Rt,jt,this.rotation),points:nr(Cn=kr,qr,Av).call(Cn,qt,jt,this.rotation)})}return ln},Pr=new WeakSet,Tv=function(){let rr=1/0,_n=-1/0,Wt=1/0,jt=-1/0;for(const ln of this.paths)for(const[xn,Nn,Tn,Kn]of ln){const Cn=at.Util.bezierBoundingBox(...xn,...Nn,...Tn,...Kn);rr=Math.min(rr,Cn[0]),Wt=Math.min(Wt,Cn[1]),_n=Math.max(_n,Cn[2]),jt=Math.max(jt,Cn[3])}return[rr,Wt,_n,jt]},tr=new WeakSet,Xy=function(){return It(this,tn)?Math.ceil(this.thickness*this.parentScale):0},qn=new WeakSet,c_=function(rr=!1){if(this.isEmpty())return;if(!It(this,tn)){nr(this,jn,jp).call(this);return}const _n=nr(this,Pr,Tv).call(this),Wt=nr(this,tr,Xy).call(this);yr(this,kt,Math.max(ut.AnnotationEditor.MIN_SIZE,_n[2]-_n[0])),yr(this,Pt,Math.max(ut.AnnotationEditor.MIN_SIZE,_n[3]-_n[1]));const jt=Math.ceil(Wt+It(this,kt)*this.scaleFactor),ln=Math.ceil(Wt+It(this,Pt)*this.scaleFactor),[xn,Nn]=this.parentDimensions;this.width=jt/xn,this.height=ln/Nn,this.setAspectRatio(jt,ln);const Tn=this.translationX,Kn=this.translationY;this.translationX=-_n[0],this.translationY=-_n[1],nr(this,Jr,l_).call(this),nr(this,jn,jp).call(this),yr(this,nn,jt),yr(this,Ot,ln),this.setDims(jt,ln);const Cn=rr?Wt/this.scaleFactor/2:0;this.translate(Tn-this.translationX-Cn,Kn-this.translationY-Cn)},Bn(kr,Tr),Bn(kr,qr),Bn(kr,ws),$o(kr,"_defaultColor",null),$o(kr,"_defaultOpacity",1),$o(kr,"_defaultThickness",1),$o(kr,"_type","ink");let At=kr;et.InkEditor=At},(_e,et,rt)=>{var At,Pt,kt,Lt,Mt,Qt,Jt,sn,tn,Bt,zt,sy,nn,oy,Kt,Zy,hn,Cv,vn,U1,Wn,V1,Sn,kv,gr,Ky,Pn,H1;Object.defineProperty(et,"__esModule",{value:!0}),et.StampEditor=void 0;var at=rt(1),ut=rt(4),pt=rt(6),yt=rt(29);const xr=class xr extends ut.AnnotationEditor{constructor(An){super({...An,name:"stampEditor"});Bn(this,zt);Bn(this,nn);Bn(this,Kt);Bn(this,hn);Bn(this,vn);Bn(this,Wn);Bn(this,Sn);Bn(this,gr);Bn(this,Pn);Bn(this,At,null);Bn(this,Pt,null);Bn(this,kt,null);Bn(this,Lt,null);Bn(this,Mt,null);Bn(this,Qt,null);Bn(this,Jt,null);Bn(this,sn,null);Bn(this,tn,!1);Bn(this,Bt,!1);yr(this,Lt,An.bitmapUrl),yr(this,Mt,An.bitmapFile)}static initialize(An){ut.AnnotationEditor.initialize(An)}static get supportedTypes(){const An=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,at.shadow)(this,"supportedTypes",An.map(Nt=>`image/${Nt}`))}static get supportedTypesStr(){return(0,at.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(An){return this.supportedTypes.includes(An)}static paste(An,Nt){Nt.pasteEditor(at.AnnotationEditorType.STAMP,{bitmapFile:An.getAsFile()})}remove(){var An,Nt;It(this,Pt)&&(yr(this,At,null),this._uiManager.imageManager.deleteId(It(this,Pt)),(An=It(this,Qt))==null||An.remove(),yr(this,Qt,null),(Nt=It(this,Jt))==null||Nt.disconnect(),yr(this,Jt,null)),super.remove()}rebuild(){if(!this.parent){It(this,Pt)&&nr(this,Kt,Zy).call(this);return}super.rebuild(),this.div!==null&&(It(this,Pt)&&nr(this,Kt,Zy).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(It(this,kt)||It(this,At)||It(this,Lt)||It(this,Mt))}get isResizable(){return!0}render(){if(this.div)return this.div;let An,Nt;if(this.width&&(An=this.x,Nt=this.y),super.render(),this.div.hidden=!0,It(this,At)?nr(this,hn,Cv).call(this):nr(this,Kt,Zy).call(this),this.width){const[Zt,$t]=this.parentDimensions;this.setAt(An*Zt,Nt*$t,this.width*Zt,this.height*$t)}return this.div}static deserialize(An,Nt,Zt){if(An instanceof yt.StampAnnotationElement)return null;const $t=super.deserialize(An,Nt,Zt),{rect:rn,bitmapUrl:an,bitmapId:En,isSvg:Mn,accessibilityData:jn}=An;En&&Zt.imageManager.isValidId(En)?yr($t,Pt,En):yr($t,Lt,an),yr($t,tn,Mn);const[dr,cr]=$t.pageDimensions;return $t.width=(rn[2]-rn[0])/dr,$t.height=(rn[3]-rn[1])/cr,jn&&($t.altTextData=jn),$t}serialize(An=!1,Nt=null){if(this.isEmpty())return null;const Zt={annotationType:at.AnnotationEditorType.STAMP,bitmapId:It(this,Pt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:It(this,tn),structTreeParentId:this._structTreeParentId};if(An)return Zt.bitmapUrl=nr(this,gr,Ky).call(this,!0),Zt.accessibilityData=this.altTextData,Zt;const{decorative:$t,altText:rn}=this.altTextData;if(!$t&&rn&&(Zt.accessibilityData={type:"Figure",alt:rn}),Nt===null)return Zt;Nt.stamps||(Nt.stamps=new Map);const an=It(this,tn)?(Zt.rect[2]-Zt.rect[0])*(Zt.rect[3]-Zt.rect[1]):null;if(!Nt.stamps.has(It(this,Pt)))Nt.stamps.set(It(this,Pt),{area:an,serialized:Zt}),Zt.bitmap=nr(this,gr,Ky).call(this,!1);else if(It(this,tn)){const En=Nt.stamps.get(It(this,Pt));an>En.area&&(En.area=an,En.serialized.bitmap.close(),En.serialized.bitmap=nr(this,gr,Ky).call(this,!1))}return Zt}};At=new WeakMap,Pt=new WeakMap,kt=new WeakMap,Lt=new WeakMap,Mt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,sn=new WeakMap,tn=new WeakMap,Bt=new WeakMap,zt=new WeakSet,sy=function(An,Nt=!1){if(!An){this.remove();return}yr(this,At,An.bitmap),Nt||(yr(this,Pt,An.id),yr(this,tn,An.isSvg)),nr(this,hn,Cv).call(this)},nn=new WeakSet,oy=function(){yr(this,kt,null),this._uiManager.enableWaiting(!1),It(this,Qt)&&this.div.focus()},Kt=new WeakSet,Zy=function(){if(It(this,Pt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(It(this,Pt)).then(Nt=>nr(this,zt,sy).call(this,Nt,!0)).finally(()=>nr(this,nn,oy).call(this));return}if(It(this,Lt)){const Nt=It(this,Lt);yr(this,Lt,null),this._uiManager.enableWaiting(!0),yr(this,kt,this._uiManager.imageManager.getFromUrl(Nt).then(Zt=>nr(this,zt,sy).call(this,Zt)).finally(()=>nr(this,nn,oy).call(this)));return}if(It(this,Mt)){const Nt=It(this,Mt);yr(this,Mt,null),this._uiManager.enableWaiting(!0),yr(this,kt,this._uiManager.imageManager.getFromFile(Nt).then(Zt=>nr(this,zt,sy).call(this,Zt)).finally(()=>nr(this,nn,oy).call(this)));return}const An=document.createElement("input");An.type="file",An.accept=xr.supportedTypesStr,yr(this,kt,new Promise(Nt=>{An.addEventListener("change",async()=>{if(!An.files||An.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const Zt=await this._uiManager.imageManager.getFromFile(An.files[0]);nr(this,zt,sy).call(this,Zt)}Nt()}),An.addEventListener("cancel",()=>{this.remove(),Nt()})}).finally(()=>nr(this,nn,oy).call(this))),An.click()},hn=new WeakSet,Cv=function(){const{div:An}=this;let{width:Nt,height:Zt}=It(this,At);const[$t,rn]=this.pageDimensions,an=.75;if(this.width)Nt=this.width*$t,Zt=this.height*rn;else if(Nt>an*$t||Zt>an*rn){const dr=Math.min(an*$t/Nt,an*rn/Zt);Nt*=dr,Zt*=dr}const[En,Mn]=this.parentDimensions;this.setDims(Nt*En/$t,Zt*Mn/rn),this._uiManager.enableWaiting(!1);const jn=yr(this,Qt,document.createElement("canvas"));An.append(jn),An.hidden=!1,nr(this,Sn,kv).call(this,Nt,Zt),nr(this,Pn,H1).call(this),It(this,Bt)||(this.parent.addUndoableEditor(this),yr(this,Bt,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},vn=new WeakSet,U1=function(An,Nt){var an;const[Zt,$t]=this.parentDimensions;this.width=An/Zt,this.height=Nt/$t,this.setDims(An,Nt),(an=this._initialOptions)!=null&&an.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,It(this,sn)!==null&&clearTimeout(It(this,sn)),yr(this,sn,setTimeout(()=>{yr(this,sn,null),nr(this,Sn,kv).call(this,An,Nt)},200))},Wn=new WeakSet,V1=function(An,Nt){const{width:Zt,height:$t}=It(this,At);let rn=Zt,an=$t,En=It(this,At);for(;rn>2*An||an>2*Nt;){const Mn=rn,jn=an;rn>2*An&&(rn=rn>=16384?Math.floor(rn/2)-1:Math.ceil(rn/2)),an>2*Nt&&(an=an>=16384?Math.floor(an/2)-1:Math.ceil(an/2));const dr=new OffscreenCanvas(rn,an);dr.getContext("2d").drawImage(En,0,0,Mn,jn,0,0,rn,an),En=dr.transferToImageBitmap()}return En},Sn=new WeakSet,kv=function(An,Nt){An=Math.ceil(An),Nt=Math.ceil(Nt);const Zt=It(this,Qt);if(!Zt||Zt.width===An&&Zt.height===Nt)return;Zt.width=An,Zt.height=Nt;const $t=It(this,tn)?It(this,At):nr(this,Wn,V1).call(this,An,Nt),rn=Zt.getContext("2d");rn.filter=this._uiManager.hcmFilter,rn.drawImage($t,0,0,$t.width,$t.height,0,0,An,Nt)},gr=new WeakSet,Ky=function(An){if(An){if(It(this,tn)){const $t=this._uiManager.imageManager.getSvgUrl(It(this,Pt));if($t)return $t}const Nt=document.createElement("canvas");return{width:Nt.width,height:Nt.height}=It(this,At),Nt.getContext("2d").drawImage(It(this,At),0,0),Nt.toDataURL()}if(It(this,tn)){const[Nt,Zt]=this.pageDimensions,$t=Math.round(this.width*Nt*pt.PixelsPerInch.PDF_TO_CSS_UNITS),rn=Math.round(this.height*Zt*pt.PixelsPerInch.PDF_TO_CSS_UNITS),an=new OffscreenCanvas($t,rn);return an.getContext("2d").drawImage(It(this,At),0,0,It(this,At).width,It(this,At).height,0,0,$t,rn),an.transferToImageBitmap()}return structuredClone(It(this,At))},Pn=new WeakSet,H1=function(){yr(this,Jt,new ResizeObserver(An=>{const Nt=An[0].contentRect;Nt.width&&Nt.height&&nr(this,vn,U1).call(this,Nt.width,Nt.height)})),It(this,Jt).observe(this.div)},$o(xr,"_type","stamp");let ct=xr;et.StampEditor=ct}],__webpack_module_cache__={};function __w_pdfjs_require__(_e){var et=__webpack_module_cache__[_e];if(et!==void 0)return et.exports;var rt=__webpack_module_cache__[_e]={exports:{}};return __webpack_modules__[_e](rt,rt.exports,__w_pdfjs_require__),rt.exports}var __webpack_exports__={};return(()=>{var _e=__webpack_exports__;Object.defineProperty(_e,"__esModule",{value:!0}),Object.defineProperty(_e,"AbortException",{enumerable:!0,get:function(){return et.AbortException}}),Object.defineProperty(_e,"AnnotationEditorLayer",{enumerable:!0,get:function(){return pt.AnnotationEditorLayer}}),Object.defineProperty(_e,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return et.AnnotationEditorParamsType}}),Object.defineProperty(_e,"AnnotationEditorType",{enumerable:!0,get:function(){return et.AnnotationEditorType}}),Object.defineProperty(_e,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return yt.AnnotationEditorUIManager}}),Object.defineProperty(_e,"AnnotationLayer",{enumerable:!0,get:function(){return ct.AnnotationLayer}}),Object.defineProperty(_e,"AnnotationMode",{enumerable:!0,get:function(){return et.AnnotationMode}}),Object.defineProperty(_e,"CMapCompressionType",{enumerable:!0,get:function(){return et.CMapCompressionType}}),Object.defineProperty(_e,"DOMSVGFactory",{enumerable:!0,get:function(){return at.DOMSVGFactory}}),Object.defineProperty(_e,"FeatureTest",{enumerable:!0,get:function(){return et.FeatureTest}}),Object.defineProperty(_e,"GlobalWorkerOptions",{enumerable:!0,get:function(){return At.GlobalWorkerOptions}}),Object.defineProperty(_e,"ImageKind",{enumerable:!0,get:function(){return et.ImageKind}}),Object.defineProperty(_e,"InvalidPDFException",{enumerable:!0,get:function(){return et.InvalidPDFException}}),Object.defineProperty(_e,"MissingPDFException",{enumerable:!0,get:function(){return et.MissingPDFException}}),Object.defineProperty(_e,"OPS",{enumerable:!0,get:function(){return et.OPS}}),Object.defineProperty(_e,"PDFDataRangeTransport",{enumerable:!0,get:function(){return rt.PDFDataRangeTransport}}),Object.defineProperty(_e,"PDFDateString",{enumerable:!0,get:function(){return at.PDFDateString}}),Object.defineProperty(_e,"PDFWorker",{enumerable:!0,get:function(){return rt.PDFWorker}}),Object.defineProperty(_e,"PasswordResponses",{enumerable:!0,get:function(){return et.PasswordResponses}}),Object.defineProperty(_e,"PermissionFlag",{enumerable:!0,get:function(){return et.PermissionFlag}}),Object.defineProperty(_e,"PixelsPerInch",{enumerable:!0,get:function(){return at.PixelsPerInch}}),Object.defineProperty(_e,"PromiseCapability",{enumerable:!0,get:function(){return et.PromiseCapability}}),Object.defineProperty(_e,"RenderingCancelledException",{enumerable:!0,get:function(){return at.RenderingCancelledException}}),Object.defineProperty(_e,"SVGGraphics",{enumerable:!0,get:function(){return rt.SVGGraphics}}),Object.defineProperty(_e,"UnexpectedResponseException",{enumerable:!0,get:function(){return et.UnexpectedResponseException}}),Object.defineProperty(_e,"Util",{enumerable:!0,get:function(){return et.Util}}),Object.defineProperty(_e,"VerbosityLevel",{enumerable:!0,get:function(){return et.VerbosityLevel}}),Object.defineProperty(_e,"XfaLayer",{enumerable:!0,get:function(){return Pt.XfaLayer}}),Object.defineProperty(_e,"build",{enumerable:!0,get:function(){return rt.build}}),Object.defineProperty(_e,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return et.createValidAbsoluteUrl}}),Object.defineProperty(_e,"getDocument",{enumerable:!0,get:function(){return rt.getDocument}}),Object.defineProperty(_e,"getFilenameFromUrl",{enumerable:!0,get:function(){return at.getFilenameFromUrl}}),Object.defineProperty(_e,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return at.getPdfFilenameFromUrl}}),Object.defineProperty(_e,"getXfaPageViewport",{enumerable:!0,get:function(){return at.getXfaPageViewport}}),Object.defineProperty(_e,"isDataScheme",{enumerable:!0,get:function(){return at.isDataScheme}}),Object.defineProperty(_e,"isPdfFile",{enumerable:!0,get:function(){return at.isPdfFile}}),Object.defineProperty(_e,"loadScript",{enumerable:!0,get:function(){return at.loadScript}}),Object.defineProperty(_e,"noContextMenu",{enumerable:!0,get:function(){return at.noContextMenu}}),Object.defineProperty(_e,"normalizeUnicode",{enumerable:!0,get:function(){return et.normalizeUnicode}}),Object.defineProperty(_e,"renderTextLayer",{enumerable:!0,get:function(){return ut.renderTextLayer}}),Object.defineProperty(_e,"setLayerDimensions",{enumerable:!0,get:function(){return at.setLayerDimensions}}),Object.defineProperty(_e,"shadow",{enumerable:!0,get:function(){return et.shadow}}),Object.defineProperty(_e,"updateTextLayer",{enumerable:!0,get:function(){return ut.updateTextLayer}}),Object.defineProperty(_e,"version",{enumerable:!0,get:function(){return rt.version}});var et=__w_pdfjs_require__(1),rt=__w_pdfjs_require__(2),at=__w_pdfjs_require__(6),ut=__w_pdfjs_require__(26),pt=__w_pdfjs_require__(27),yt=__w_pdfjs_require__(5),ct=__w_pdfjs_require__(29),At=__w_pdfjs_require__(14),Pt=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;(function(_e){var et=reactExports,rt=pdfExports;function at(Ut){var dn=Object.create(null);return Ut&&Object.keys(Ut).forEach(function(In){if(In!=="default"){var $n=Object.getOwnPropertyDescriptor(Ut,In);Object.defineProperty(dn,In,$n.get?$n:{enumerable:!0,get:function(){return Ut[In]}})}}),dn.default=Ut,Object.freeze(dn)}var ut,pt=at(et),yt=at(rt);_e.AnnotationType=void 0,(ut=_e.AnnotationType||(_e.AnnotationType={}))[ut.Text=1]="Text",ut[ut.Link=2]="Link",ut[ut.FreeText=3]="FreeText",ut[ut.Line=4]="Line",ut[ut.Square=5]="Square",ut[ut.Circle=6]="Circle",ut[ut.Polygon=7]="Polygon",ut[ut.Polyline=8]="Polyline",ut[ut.Highlight=9]="Highlight",ut[ut.Underline=10]="Underline",ut[ut.Squiggly=11]="Squiggly",ut[ut.StrikeOut=12]="StrikeOut",ut[ut.Stamp=13]="Stamp",ut[ut.Caret=14]="Caret",ut[ut.Ink=15]="Ink",ut[ut.Popup=16]="Popup",ut[ut.FileAttachment=17]="FileAttachment";var ct=function(Ut,dn){return ct=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(In,$n){In.__proto__=$n}||function(In,$n){for(var Zn in $n)Object.prototype.hasOwnProperty.call($n,Zn)&&(In[Zn]=$n[Zn])},ct(Ut,dn)};function At(Ut,dn){if(typeof dn!="function"&&dn!==null)throw new TypeError("Class extends value "+String(dn)+" is not a constructor or null");function In(){this.constructor=Ut}ct(Ut,dn),Ut.prototype=dn===null?Object.create(dn):(In.prototype=dn.prototype,new In)}var Pt,kt=function(){return kt=Object.assign||function(Ut){for(var dn,In=1,$n=arguments.length;In<$n;In++)for(var Zn in dn=arguments[In])Object.prototype.hasOwnProperty.call(dn,Zn)&&(Ut[Zn]=dn[Zn]);return Ut},kt.apply(this,arguments)};_e.TextDirection=void 0,(Pt=_e.TextDirection||(_e.TextDirection={})).RightToLeft="RTL",Pt.LeftToRight="LTR";var Lt,Mt=pt.createContext({currentTheme:"light",direction:_e.TextDirection.LeftToRight,setCurrentTheme:function(){}}),Qt=function(Ut){var dn=[];return Object.keys(Ut).forEach(function(In){In&&Ut[In]&&dn.push(In)}),dn.join(" ")},Jt=typeof window<"u"?pt.useLayoutEffect:pt.useEffect,sn=function(Ut){var dn=pt.useRef(null),In=Ut.once,$n=Ut.threshold,Zn=Ut.onVisibilityChanged;return Jt(function(){var Jn=dn.current;if(Jn){var fr=new IntersectionObserver(function(sr){sr.forEach(function(Un){var pr=Un.isIntersecting,ur=Un.intersectionRatio;Zn({isVisible:pr,ratio:ur}),pr&&In&&(fr.unobserve(Jn),fr.disconnect())})},{threshold:$n||0});return fr.observe(Jn),function(){fr.unobserve(Jn),fr.disconnect()}}},[]),dn},tn=function(Ut){var dn=Ut.children,In=Ut.ignoreDirection,$n=In!==void 0&&In,Zn=Ut.size,Jn=Zn===void 0?24:Zn,fr=pt.useContext(Mt).direction,sr=!$n&&fr===_e.TextDirection.RightToLeft,Un="".concat(Jn||24,"px");return pt.createElement("svg",{"aria-hidden":"true",className:Qt({"rpv-core__icon":!0,"rpv-core__icon--rtl":sr}),focusable:"false",height:Un,viewBox:"0 0 24 24",width:Un},dn)},Bt=function(){return pt.createElement(tn,{size:16},pt.createElement("path",{d:"M23.5,0.499l-16.5,23l-6.5-6.5"}))},zt=function(Ut){var dn=Ut.children,In=Ut.testId,$n=Ut.onClick,Zn=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft,Jn=In?{"data-testid":In}:{};return pt.createElement("button",kt({className:Qt({"rpv-core__primary-button":!0,"rpv-core__primary-button--rtl":Zn}),type:"button",onClick:$n},Jn),dn)},Ht=function(Ut){var dn=Ut.size,In=dn===void 0?"4rem":dn,$n=Ut.testId,Zn=pt.useState(!1),Jn=Zn[0],fr=Zn[1],sr=$n?{"data-testid":$n}:{},Un=sn({onVisibilityChanged:function(pr){fr(pr.isVisible)}});return pt.createElement("div",kt({},sr,{className:Qt({"rpv-core__spinner":!0,"rpv-core__spinner--animating":Jn}),ref:Un,style:{height:In,width:In}}))},nn=function(Ut){var dn=Ut.ariaLabel,In=dn===void 0?"":dn,$n=Ut.autoFocus,Zn=$n!==void 0&&$n,Jn=Ut.placeholder,fr=Jn===void 0?"":Jn,sr=Ut.testId,Un=Ut.type,pr=Un===void 0?"text":Un,ur=Ut.value,zr=ur===void 0?"":ur,Vr=Ut.onChange,Br=Ut.onKeyDown,Qr=Br===void 0?function(){}:Br,Kr=pt.useContext(Mt).direction,Or=pt.useRef(),Js=Kr===_e.TextDirection.RightToLeft,Ns={ref:Or,"data-testid":"","aria-label":In,className:Qt({"rpv-core__textbox":!0,"rpv-core__textbox--rtl":Js}),placeholder:fr,value:zr,onChange:function(Is){return Vr(Is.target.value)},onKeyDown:Qr};return sr&&(Ns["data-testid"]=sr),Jt(function(){if(Zn){var Is=Or.current;if(Is){var Vs=window.scrollX,Es=window.scrollY;Is.focus(),window.scrollTo(Vs,Es)}}},[]),pr==="text"?pt.createElement("input",kt({type:"text"},Ns)):pt.createElement("input",kt({type:"password"},Ns))};(function(Ut){Ut[Ut.ExitFullScreen=0]="ExitFullScreen",Ut[Ut.FullScreenChange=1]="FullScreenChange",Ut[Ut.FullScreenElement=2]="FullScreenElement",Ut[Ut.FullScreenEnabled=3]="FullScreenEnabled",Ut[Ut.RequestFullScreen=4]="RequestFullScreen"})(Lt||(Lt={}));var Ot,Kt={ExitFullScreen:"exitFullscreen",FullScreenChange:"fullscreenchange",FullScreenElement:"fullscreenElement",FullScreenEnabled:"fullscreenEnabled",RequestFullScreen:"requestFullscreen"},mn={ExitFullScreen:"webkitExitFullscreen",FullScreenChange:"webkitfullscreenchange",FullScreenElement:"webkitFullscreenElement",FullScreenEnabled:"webkitFullscreenEnabled",RequestFullScreen:"webkitRequestFullscreen"},hn={ExitFullScreen:"msExitFullscreen",FullScreenChange:"msFullscreenChange",FullScreenElement:"msFullscreenElement",FullScreenEnabled:"msFullscreenEnabled",RequestFullScreen:"msRequestFullscreen"},Yt=typeof window<"u",vn=Yt&&(Lt.FullScreenEnabled in document&&Kt||mn.FullScreenEnabled in document&&mn||hn.FullScreenEnabled in document&&hn)||Kt,fn=function(){return Yt&&vn.FullScreenEnabled in document&&document[vn.FullScreenEnabled]===!0},Wn=function(Ut){return Yt?Ut[vn.ExitFullScreen]():Promise.resolve({})},Xn=function(){return Yt?document[vn.FullScreenElement]:null},Sn=function(Ut,dn){var In=pt.useRef(),$n=function(){In.current&&clearTimeout(In.current)};return pt.useEffect(function(){return function(){return $n()}},[]),pt.useCallback(function(){for(var Zn=[],Jn=0;Jn<arguments.length;Jn++)Zn[Jn]=arguments[Jn];$n(),In.current=setTimeout(function(){Ut.apply(void 0,Zn)},dn)},[Ut,dn])},_i=function(){var Ut=pt.useRef(!1);return pt.useEffect(function(){return Ut.current=!0,function(){Ut.current=!1}},[]),Ut},gr=function(Ut){var dn=pt.useRef(Ut);return pt.useEffect(function(){dn.current=Ut},[Ut]),dn.current};(function(Ut){Ut.NotRenderedYet="NotRenderedYet",Ut.Rendering="Rendering",Ut.Rendered="Rendered"})(Ot||(Ot={}));var br,Pn=-9999,lr=function(Ut){var dn=Ut.doc,In=dn.numPages,$n=dn.loadingTask.docId,Zn=pt.useMemo(function(){return Array(In).fill(null).map(function(sr,Un){return{pageIndex:Un,renderStatus:Ot.NotRenderedYet,visibility:Pn}})},[$n]),Jn=pt.useRef({currentRenderingPage:-1,startRange:0,endRange:In-1,visibilities:Zn}),fr=function(sr,Un){Jn.current.visibilities[sr].visibility=Un};return{getHighestPriorityPage:function(){var sr=Jn.current.visibilities.slice(Jn.current.startRange,Jn.current.endRange+1).filter(function(Vr){return Vr.visibility>Pn});if(!sr.length)return-1;for(var Un=sr[0].pageIndex,pr=sr[sr.length-1].pageIndex,ur=sr.length,zr=0;zr<ur;zr++){if(sr[zr].renderStatus===Ot.Rendering)return-1;if(sr[zr].renderStatus===Ot.NotRenderedYet)return sr[zr].pageIndex}return pr+1<In&&Jn.current.visibilities[pr+1].renderStatus!==Ot.Rendered?pr+1:Un-1>=0&&Jn.current.visibilities[Un-1].renderStatus!==Ot.Rendered?Un-1:-1},isInRange:function(sr){return sr>=Jn.current.startRange&&sr<=Jn.current.endRange},markNotRendered:function(){for(var sr=0;sr<In;sr++)Jn.current.visibilities[sr].renderStatus=Ot.NotRenderedYet},markRendered:function(sr){Jn.current.visibilities[sr].renderStatus=Ot.Rendered},markRendering:function(sr){Jn.current.currentRenderingPage!==-1&&Jn.current.currentRenderingPage!==sr&&Jn.current.visibilities[Jn.current.currentRenderingPage].renderStatus===Ot.Rendering&&(Jn.current.visibilities[Jn.current.currentRenderingPage].renderStatus=Ot.NotRenderedYet),Jn.current.visibilities[sr].renderStatus=Ot.Rendering,Jn.current.currentRenderingPage=sr},setOutOfRange:function(sr){fr(sr,Pn)},setRange:function(sr,Un){Jn.current.startRange=sr,Jn.current.endRange=Un;for(var pr=0;pr<In;pr++)(pr<sr||pr>Un)&&(Jn.current.visibilities[pr].visibility=Pn,Jn.current.visibilities[pr].renderStatus=Ot.NotRenderedYet)},setVisibility:fr}},xr={core:{askingPassword:{requirePasswordToOpen:"This document requires a password to open",submit:"Submit"},wrongPassword:{tryAgain:"The password is wrong. Please try again"},pageLabel:"Page {{pageIndex}}"}},Dr=pt.createContext({l10n:xr,setL10n:function(){}}),$r=0,An=function(){return $r++},Nt=function(Ut,dn,In){var $n=function(Zn){var Jn=dn.current;if(Jn){var fr=Zn.target;if(fr instanceof Element&&fr.shadowRoot){var sr=Zn.composedPath();sr.length>0&&!Jn.contains(sr[0])&&In()}else Jn.contains(fr)||In()}};pt.useEffect(function(){if(Ut){var Zn={capture:!0};return document.addEventListener("click",$n,Zn),function(){document.removeEventListener("click",$n,Zn)}}},[])},Zt=function(Ut){var dn=function(In){In.key==="Escape"&&Ut()};pt.useEffect(function(){return document.addEventListener("keyup",dn),function(){document.removeEventListener("keyup",dn)}},[])},$t=function(Ut){var dn=Ut.ariaControlsSuffix,In=Ut.children,$n=Ut.closeOnClickOutside,Zn=Ut.closeOnEscape,Jn=Ut.onToggle,fr=pt.useRef(),sr=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft;return pt.useEffect(function(){var Un=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",function(){document.body.style.overflow=Un}},[]),Zt(function(){fr.current&&Zn&&Jn()}),Nt($n,fr,Jn),Jt(function(){var Un=fr.current;if(Un){var pr=.75*document.body.clientHeight;Un.getBoundingClientRect().height>=pr&&(Un.style.overflow="auto",Un.style.maxHeight="".concat(pr,"px"))}},[]),pt.createElement("div",{"aria-modal":"true",className:Qt({"rpv-core__modal-body":!0,"rpv-core__modal-body--rtl":sr}),id:"rpv-core__modal-body-".concat(dn),ref:fr,role:"dialog",tabIndex:-1},In)},rn=function(Ut){var dn=Ut.children;return pt.createElement("div",{className:"rpv-core__modal-overlay"},dn)};_e.ToggleStatus=void 0,(br=_e.ToggleStatus||(_e.ToggleStatus={})).Close="Close",br.Open="Open",br.Toggle="Toggle";var an,En=function(Ut){var dn=pt.useState(Ut),In=dn[0],$n=dn[1];return{opened:In,toggle:function(Zn){switch(Zn){case _e.ToggleStatus.Close:$n(!1);break;case _e.ToggleStatus.Open:$n(!0);break;case _e.ToggleStatus.Toggle:default:$n(function(Jn){return!Jn})}}}},Mn=function(Ut){var dn=Ut.content,In=Ut.isOpened,$n=In!==void 0&&In,Zn=Ut.target,Jn=En($n),fr=Jn.opened,sr=Jn.toggle;return pt.createElement(pt.Fragment,null,Zn&&Zn(sr,fr),fr&&dn(sr))};_e.Position=void 0,(an=_e.Position||(_e.Position={})).TopLeft="TOP_LEFT",an.TopCenter="TOP_CENTER",an.TopRight="TOP_RIGHT",an.RightTop="RIGHT_TOP",an.RightCenter="RIGHT_CENTER",an.RightBottom="RIGHT_BOTTOM",an.BottomLeft="BOTTOM_LEFT",an.BottomCenter="BOTTOM_CENTER",an.BottomRight="BOTTOM_RIGHT",an.LeftTop="LEFT_TOP",an.LeftCenter="LEFT_CENTER",an.LeftBottom="LEFT_BOTTOM";var jn,dr,cr,wr,Rr,On,Mr,ts,Jr=function(Ut,dn,In,$n,Zn){Jt(function(){var Jn=dn.current,fr=Ut.current,sr=In.current;if(fr&&Jn&&sr){var Un=sr.getBoundingClientRect(),pr=function(Vr,Br,Qr,Kr){var Or=Br.getBoundingClientRect(),Js=Vr.getBoundingClientRect(),Ns=Js.height,Is=Js.width,Vs=0,Es=0;switch(Qr){case _e.Position.TopLeft:Vs=Or.top-Ns,Es=Or.left;break;case _e.Position.TopCenter:Vs=Or.top-Ns,Es=Or.left+Or.width/2-Is/2;break;case _e.Position.TopRight:Vs=Or.top-Ns,Es=Or.left+Or.width-Is;break;case _e.Position.RightTop:Vs=Or.top,Es=Or.left+Or.width;break;case _e.Position.RightCenter:Vs=Or.top+Or.height/2-Ns/2,Es=Or.left+Or.width;break;case _e.Position.RightBottom:Vs=Or.top+Or.height-Ns,Es=Or.left+Or.width;break;case _e.Position.BottomLeft:Vs=Or.top+Or.height,Es=Or.left;break;case _e.Position.BottomCenter:Vs=Or.top+Or.height,Es=Or.left+Or.width/2-Is/2;break;case _e.Position.BottomRight:Vs=Or.top+Or.height,Es=Or.left+Or.width-Is;break;case _e.Position.LeftTop:Vs=Or.top,Es=Or.left-Is;break;case _e.Position.LeftCenter:Vs=Or.top+Or.height/2-Ns/2,Es=Or.left-Is;break;case _e.Position.LeftBottom:Vs=Or.top+Or.height-Ns,Es=Or.left-Is}return{left:Es+(Kr.left||0),top:Vs+(Kr.top||0)}}(fr,Jn,$n,Zn),ur=pr.top,zr=pr.left;fr.style.top="".concat(ur-Un.top,"px"),fr.style.left="".concat(zr-Un.left,"px")}},[])},jr=function(Ut){var dn,In=Ut.customClassName,$n=Ut.position;return pt.createElement("div",{className:Qt((dn={"rpv-core__arrow":!0,"rpv-core__arrow--tl":$n===_e.Position.TopLeft,"rpv-core__arrow--tc":$n===_e.Position.TopCenter,"rpv-core__arrow--tr":$n===_e.Position.TopRight,"rpv-core__arrow--rt":$n===_e.Position.RightTop,"rpv-core__arrow--rc":$n===_e.Position.RightCenter,"rpv-core__arrow--rb":$n===_e.Position.RightBottom,"rpv-core__arrow--bl":$n===_e.Position.BottomLeft,"rpv-core__arrow--bc":$n===_e.Position.BottomCenter,"rpv-core__arrow--br":$n===_e.Position.BottomRight,"rpv-core__arrow--lt":$n===_e.Position.LeftTop,"rpv-core__arrow--lc":$n===_e.Position.LeftCenter,"rpv-core__arrow--lb":$n===_e.Position.LeftBottom},dn["".concat(In)]=In!=="",dn))})},ss=function(Ut){var dn=Ut.ariaControlsSuffix,In=Ut.children,$n=Ut.closeOnClickOutside,Zn=Ut.offset,Jn=Ut.position,fr=Ut.targetRef,sr=Ut.onClose,Un=pt.useRef(),pr=pt.useRef(),ur=pt.useRef(),zr=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft;Nt($n,Un,sr),Jr(Un,fr,ur,Jn,Zn),Jt(function(){var Br=pr.current;if(Br){var Qr=.75*document.body.clientHeight;Br.getBoundingClientRect().height>=Qr&&(Br.style.overflow="auto",Br.style.maxHeight="".concat(Qr,"px"))}},[]);var Vr="rpv-core__popover-body-inner-".concat(dn);return pt.createElement(pt.Fragment,null,pt.createElement("div",{ref:ur,style:{left:0,position:"absolute",top:0}}),pt.createElement("div",{"aria-describedby":Vr,className:Qt({"rpv-core__popover-body":!0,"rpv-core__popover-body--rtl":zr}),id:"rpv-core__popover-body-".concat(dn),ref:Un,role:"dialog",tabIndex:-1},pt.createElement(jr,{customClassName:"rpv-core__popover-body-arrow",position:Jn}),pt.createElement("div",{id:Vr,ref:pr},In)))},Lr=function(Ut){var dn=Ut.closeOnEscape,In=Ut.onClose,$n=pt.useRef();return Zt(function(){$n.current&&dn&&In()}),pt.createElement("div",{className:"rpv-core__popover-overlay",ref:$n})},hr=function(Ut){var dn=Ut.ariaControlsSuffix,In=Ut.children,$n=Ut.contentRef,Zn=Ut.offset,Jn=Ut.position,fr=Ut.targetRef,sr=pt.useRef(),Un=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft;return Jr($n,fr,sr,Jn,Zn),pt.createElement(pt.Fragment,null,pt.createElement("div",{ref:sr,style:{left:0,position:"absolute",top:0}}),pt.createElement("div",{className:Qt({"rpv-core__tooltip-body":!0,"rpv-core__tooltip-body--rtl":Un}),id:"rpv-core__tooltip-body-".concat(dn),ref:$n,role:"tooltip"},pt.createElement(jr,{customClassName:"rpv-core__tooltip-body-arrow",position:Jn}),pt.createElement("div",{className:"rpv-core__tooltip-body-content"},In)))};_e.FullScreenMode=void 0,(jn=_e.FullScreenMode||(_e.FullScreenMode={})).Normal="Normal",jn.Entering="Entering",jn.Entered="Entered",jn.EnteredCompletely="EnteredCompletely",jn.Exitting="Exitting",jn.Exited="Exited",_e.LayerRenderStatus=void 0,(dr=_e.LayerRenderStatus||(_e.LayerRenderStatus={}))[dr.PreRender=0]="PreRender",dr[dr.DidRender=1]="DidRender",_e.PageMode=void 0,(cr=_e.PageMode||(_e.PageMode={})).Attachments="UseAttachments",cr.Bookmarks="UseOutlines",cr.ContentGroup="UseOC",cr.Default="UserNone",cr.FullScreen="FullScreen",cr.Thumbnails="UseThumbs",_e.PasswordStatus=void 0,(wr=_e.PasswordStatus||(_e.PasswordStatus={})).RequiredPassword="RequiredPassword",wr.WrongPassword="WrongPassword",_e.RotateDirection=void 0,(Rr=_e.RotateDirection||(_e.RotateDirection={})).Backward="Backward",Rr.Forward="Forward",_e.ScrollMode=void 0,(On=_e.ScrollMode||(_e.ScrollMode={})).Page="Page",On.Horizontal="Horizontal",On.Vertical="Vertical",On.Wrapped="Wrapped",_e.SpecialZoomLevel=void 0,(Mr=_e.SpecialZoomLevel||(_e.SpecialZoomLevel={})).ActualSize="ActualSize",Mr.PageFit="PageFit",Mr.PageWidth="PageWidth",_e.ViewMode=void 0,(ts=_e.ViewMode||(_e.ViewMode={})).DualPage="DualPage",ts.DualPageWithCover="DualPageWithCover",ts.SinglePage="SinglePage";var or,Tr=function(Ut,dn){return Ut.reduce(function(In,$n,Zn){return Zn%dn?In[In.length-1].push($n):In.push([$n]),In},[])},Zr=function(Ut,dn){switch(dn[1].name){case"XYZ":return{bottomOffset:function(In,$n){return dn[3]===null?$n:dn[3]},leftOffset:function(In,$n){return dn[2]===null?0:dn[2]},pageIndex:Ut,scaleTo:dn[4]};case"Fit":case"FitB":return{bottomOffset:0,leftOffset:0,pageIndex:Ut,scaleTo:_e.SpecialZoomLevel.PageFit};case"FitH":case"FitBH":return{bottomOffset:dn[2],leftOffset:0,pageIndex:Ut,scaleTo:_e.SpecialZoomLevel.PageWidth};default:return{bottomOffset:0,leftOffset:0,pageIndex:Ut,scaleTo:1}}},qr=new Map,Cr=new Map,ws=function(Ut,dn){return"".concat(Ut.loadingTask.docId,"___").concat(dn.num,"R").concat(dn.gen===0?"":dn.gen)},ds=function(Ut,dn,In){qr.set(ws(Ut,dn),In)},Ts=function(Ut,dn){if(!Ut)return Promise.reject("The document is not loaded yet");var In="".concat(Ut.loadingTask.docId,"___").concat(dn),$n=Cr.get(In);return $n?Promise.resolve($n):new Promise(function(Zn,Jn){Ut.getPage(dn+1).then(function(fr){Cr.set(In,fr),fr.ref&&ds(Ut,fr.ref,dn),Zn(fr)})})},Ms=function(Ut,dn){return new Promise(function(In){new Promise(function($n){typeof dn=="string"?Ut.getDestination(dn).then(function(Zn){$n(Zn)}):$n(dn)}).then(function($n){if(typeof $n[0]=="object"&&$n[0]!==null){var Zn=$n[0],Jn=function(sr,Un){var pr=ws(sr,Un);return qr.has(pr)?qr.get(pr):null}(Ut,Zn);Jn===null?Ut.getPageIndex(Zn).then(function(sr){ds(Ut,Zn,sr),Ms(Ut,dn).then(function(Un){return In(Un)})}):In(Zr(Jn,$n))}else{var fr=Zr($n[0],$n);In(fr)}})})};(function(Ut){Ut[Ut.Solid=1]="Solid",Ut[Ut.Dashed=2]="Dashed",Ut[Ut.Beveled=3]="Beveled",Ut[Ut.Inset=4]="Inset",Ut[Ut.Underline=5]="Underline"})(or||(or={}));var Pr,ns=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"),tr=function(Ut,dn,In,$n){var Zn=parseInt(Ut,10);return Zn>=dn&&Zn<=In?Zn:$n},Yn=function(Ut){return Ut.contentsObj?Ut.contentsObj.str:Ut.contents||""},qn=function(Ut){return Ut.titleObj?Ut.titleObj.str:Ut.title||""},Er=function(Ut){var dn=Ut.annotation,In=pt.useContext(Mt).direction,$n=qn(dn),Zn=Yn(dn),Jn=In===_e.TextDirection.RightToLeft,fr=pt.useRef(),sr="";if(dn.modificationDate){var Un=function(pr){var ur=ns.exec(pr);if(!ur)return null;var zr=parseInt(ur[1],10),Vr=tr(ur[2],1,12,1)-1,Br=tr(ur[3],1,31,1),Qr=tr(ur[4],0,23,0),Kr=tr(ur[5],0,59,0),Or=tr(ur[6],0,59,0),Js=ur[7]||"Z",Ns=tr(ur[8],0,23,0),Is=tr(ur[9],0,59,0);switch(Js){case"-":Qr+=Ns,Kr+=Is;break;case"+":Qr-=Ns,Kr-=Is}return new Date(Date.UTC(zr,Vr,Br,Qr,Kr,Or))}(dn.modificationDate);sr=Un?"".concat(Un.toLocaleDateString(),", ").concat(Un.toLocaleTimeString()):""}return pt.useLayoutEffect(function(){if(fr.current){var pr=document.querySelector('[data-annotation-id="'.concat(dn.id,'"]'));if(pr){var ur=pr;return ur.style.zIndex+=1,function(){ur.style.zIndex="".concat(parseInt(ur.style.zIndex,10)-1)}}}},[]),pt.createElement("div",{ref:fr,className:Qt({"rpv-core__annotation-popup-wrapper":!0,"rpv-core__annotation-popup-wrapper--rtl":Jn}),style:{top:dn.annotationType===_e.AnnotationType.Popup?"":"100%"}},$n&&pt.createElement(pt.Fragment,null,pt.createElement("div",{className:Qt({"rpv-core__annotation-popup-title":!0,"rpv-core__annotation-popup-title--ltr":!Jn,"rpv-core__annotation-popup-title--rtl":Jn})},$n),pt.createElement("div",{className:"rpv-core__annotation-popup-date"},sr)),Zn&&pt.createElement("div",{className:"rpv-core__annotation-popup-content"},Zn.split(`
`).map(function(pr,ur){return pt.createElement(pt.Fragment,{key:ur},pr,pt.createElement("br",null))})))};(function(Ut){Ut.Click="Click",Ut.Hover="Hover"})(Pr||(Pr={}));var kr,Us=function(Ut){var dn,In=Ut.annotation,$n=Ut.children,Zn=Ut.ignoreBorder,Jn=Ut.hasPopup,fr=Ut.isRenderable,sr=Ut.page,Un=Ut.viewport,pr=In.rect,ur=function(){var Bs=En(!1),fo=Bs.opened,po=Bs.toggle,_o=pt.useState(Pr.Hover),xo=_o[0],wo=_o[1];return{opened:fo,closeOnHover:function(){xo===Pr.Hover&&po(_e.ToggleStatus.Close)},openOnHover:function(){xo===Pr.Hover&&po(_e.ToggleStatus.Open)},toggleOnClick:function(){switch(xo){case Pr.Click:fo&&wo(Pr.Hover),po(_e.ToggleStatus.Toggle);break;case Pr.Hover:wo(Pr.Click),po(_e.ToggleStatus.Open)}}}}(),zr=ur.closeOnHover,Vr=ur.opened,Br=ur.openOnHover,Qr=ur.toggleOnClick,Kr=(dn=[pr[0],sr.view[3]+sr.view[1]-pr[1],pr[2],sr.view[3]+sr.view[1]-pr[3]],[Math.min(dn[0],dn[2]),Math.min(dn[1],dn[3]),Math.max(dn[0],dn[2]),Math.max(dn[1],dn[3])]),Or=pr[2]-pr[0],Js=pr[3]-pr[1],Ns={borderColor:"",borderRadius:"",borderStyle:"",borderWidth:""};if(!Zn&&In.borderStyle.width>0){switch(In.borderStyle.style){case or.Dashed:Ns.borderStyle="dashed";break;case or.Solid:Ns.borderStyle="solid";break;case or.Underline:Ns=Object.assign({borderBottomStyle:"solid"},Ns);case or.Beveled:case or.Inset:}var Is=In.borderStyle.width;Ns.borderWidth="".concat(Is,"px"),In.borderStyle.style!==or.Underline&&(Or-=2*Is,Js-=2*Is);var Vs=In.borderStyle,Es=Vs.horizontalCornerRadius,Xs=Vs.verticalCornerRadius;(Es>0||Xs>0)&&(Ns.borderRadius="".concat(Es,"px / ").concat(Xs,"px")),In.color?Ns.borderColor="rgb(".concat(0|In.color[0],", ").concat(0|In.color[1],", ").concat(0|In.color[2],")"):Ns.borderWidth="0"}return pt.createElement(pt.Fragment,null,fr&&$n({popup:{opened:Vr,closeOnHover:zr,openOnHover:Br,toggleOnClick:Qr},slot:{attrs:{style:Object.assign({height:"".concat(Js,"px"),left:"".concat(Kr[0],"px"),top:"".concat(Kr[1],"px"),transform:"matrix(".concat(Un.transform.join(","),")"),transformOrigin:"-".concat(Kr[0],"px -").concat(Kr[1],"px"),width:"".concat(Or,"px")},Ns)},children:pt.createElement(pt.Fragment,null,Jn&&Vr&&pt.createElement(Er,{annotation:In}))}}))},lo=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr);return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Un){return pt.createElement("div",kt({},Un.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--caret","data-annotation-id":dn.id,onClick:Un.popup.toggleOnClick,onMouseEnter:Un.popup.openOnHover,onMouseLeave:Un.popup.closeOnHover}),Un.slot.children)})},rr=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr),Un=dn.rect,pr=Un[2]-Un[0],ur=Un[3]-Un[1],zr=dn.borderStyle.width;return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Vr){return pt.createElement("div",kt({},Vr.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--circle","data-annotation-id":dn.id,onClick:Vr.popup.toggleOnClick,onMouseEnter:Vr.popup.openOnHover,onMouseLeave:Vr.popup.closeOnHover}),pt.createElement("svg",{height:"".concat(ur,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(pr," ").concat(ur),width:"".concat(pr,"px")},pt.createElement("circle",{cy:ur/2,fill:"none",rx:pr/2-zr/2,ry:ur/2-zr/2,stroke:"transparent",strokeWidth:zr||1})),Vr.slot.children)})},_n=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=qn(dn),Jn=Yn(dn),fr=!(dn.hasPopup!==!1||!Zn&&!Jn),sr=function(){var Un,pr,ur,zr,Vr=dn.file;Vr&&(Un=Vr.filename,pr=Vr.content,ur=typeof pr=="string"?"":URL.createObjectURL(new Blob([pr],{type:""})),(zr=document.createElement("a")).style.display="none",zr.href=ur||Un,zr.setAttribute("download",function(Br){var Qr=Br.split("/").pop();return Qr?Qr.split("#")[0].split("?")[0]:Br}(Un)),document.body.appendChild(zr),zr.click(),document.body.removeChild(zr),ur&&URL.revokeObjectURL(ur))};return pt.createElement(Us,{annotation:dn,hasPopup:fr,ignoreBorder:!0,isRenderable:!0,page:In,viewport:$n},function(Un){return pt.createElement("div",kt({},Un.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--file-attachment","data-annotation-id":dn.id,onClick:Un.popup.toggleOnClick,onDoubleClick:sr,onMouseEnter:Un.popup.openOnHover,onMouseLeave:Un.popup.closeOnHover}),Un.slot.children)})},Wt=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr);return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Un){return pt.createElement("div",kt({},Un.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--free-text","data-annotation-id":dn.id,onClick:Un.popup.toggleOnClick,onMouseEnter:Un.popup.openOnHover,onMouseLeave:Un.popup.closeOnHover}),Un.slot.children)})},jt=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=qn(dn),Jn=Yn(dn),fr=!(!Zn&&!Jn),sr=!dn.parentType||["Circle","Ink","Line","Polygon","PolyLine","Square"].indexOf(dn.parentType)!==-1;return Jt(function(){if(dn.parentId){var Un=document.querySelector('[data-annotation-id="'.concat(dn.parentId,'"]')),pr=document.querySelector('[data-annotation-id="'.concat(dn.id,'"]'));if(Un&&pr){var ur=parseFloat(Un.style.left),zr=parseFloat(Un.style.top)+parseFloat(Un.style.height);pr.style.left="".concat(ur,"px"),pr.style.top="".concat(zr,"px"),pr.style.transformOrigin="-".concat(ur,"px -").concat(zr,"px")}}},[]),pt.createElement(Us,{annotation:dn,hasPopup:sr,ignoreBorder:!1,isRenderable:fr,page:In,viewport:$n},function(Un){return pt.createElement("div",kt({},Un.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--popup","data-annotation-id":dn.id}),pt.createElement(Er,{annotation:dn}))})},ln=function(Ut){var dn=Ut.annotation,In=Ut.childAnnotation,$n=Ut.page,Zn=Ut.viewport,Jn=dn.hasPopup===!1,fr=qn(dn),sr=Yn(dn),Un=!!(dn.hasPopup||fr||sr);if(dn.quadPoints&&dn.quadPoints.length>0){var pr=dn.quadPoints.map(function(ur){return Object.assign({},dn,{rect:[ur[2].x,ur[2].y,ur[1].x,ur[1].y],quadPoints:[]})});return pt.createElement(pt.Fragment,null,pr.map(function(ur,zr){return pt.createElement(ln,{key:zr,annotation:ur,childAnnotation:In,page:$n,viewport:Zn})}))}return pt.createElement(Us,{annotation:dn,hasPopup:Jn,ignoreBorder:!0,isRenderable:Un,page:$n,viewport:Zn},function(ur){return pt.createElement(pt.Fragment,null,pt.createElement("div",kt({},ur.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--highlight","data-annotation-id":dn.id,onClick:ur.popup.toggleOnClick,onMouseEnter:ur.popup.openOnHover,onMouseLeave:ur.popup.closeOnHover}),ur.slot.children),In&&In.annotationType===_e.AnnotationType.Popup&&ur.popup.opened&&pt.createElement(jt,{annotation:In,page:$n,viewport:Zn}))})},xn=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr),Un=dn.rect,pr=Un[2]-Un[0],ur=Un[3]-Un[1],zr=dn.borderStyle.width;return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Vr){return pt.createElement("div",kt({},Vr.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--ink","data-annotation-id":dn.id,onClick:Vr.popup.toggleOnClick,onMouseEnter:Vr.popup.openOnHover,onMouseLeave:Vr.popup.closeOnHover}),dn.inkLists&&dn.inkLists.length&&pt.createElement("svg",{height:"".concat(ur,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(pr," ").concat(ur),width:"".concat(pr,"px")},dn.inkLists.map(function(Br,Qr){return pt.createElement("polyline",{key:Qr,fill:"none",stroke:"transparent",strokeWidth:zr||1,points:Br.map(function(Kr){return"".concat(Kr.x-Un[0],",").concat(Un[3]-Kr.y)}).join(" ")})})),Vr.slot.children)})},Nn=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr),Un=dn.rect,pr=Un[2]-Un[0],ur=Un[3]-Un[1],zr=dn.borderStyle.width;return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Vr){return pt.createElement("div",kt({},Vr.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--line","data-annotation-id":dn.id,onClick:Vr.popup.toggleOnClick,onMouseEnter:Vr.popup.openOnHover,onMouseLeave:Vr.popup.closeOnHover}),pt.createElement("svg",{height:"".concat(ur,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(pr," ").concat(ur),width:"".concat(pr,"px")},pt.createElement("line",{stroke:"transparent",strokeWidth:zr||1,x1:Un[2]-dn.lineCoordinates[0],x2:Un[2]-dn.lineCoordinates[2],y1:Un[3]-dn.lineCoordinates[1],y2:Un[3]-dn.lineCoordinates[3]})),Vr.slot.children)})},Tn=/^([^\w]*)(javascript|data|vbscript)/im,Kn=/&#(\w+)(^\w|;)?/g,Cn=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,un=/^([^:]+):/gm,Rt=function(Ut,dn){dn===void 0&&(dn="about:blank");var In,$n=(In=Ut||"",In.replace(Kn,function(sr,Un){return String.fromCharCode(Un)})).replace(Cn,"").trim();if(!$n)return dn;var Zn=$n[0];if(Zn==="."||Zn==="/")return $n;var Jn=$n.match(un);if(!Jn)return $n;var fr=Jn[0];return Tn.test(fr)?dn:$n},qt=function(Ut){var dn,In=Ut.annotation,$n=Ut.annotationContainerRef,Zn=Ut.doc,Jn=Ut.outlines,fr=Ut.page,sr=Ut.pageIndex,Un=Ut.scale,pr=Ut.viewport,ur=Ut.onExecuteNamedAction,zr=Ut.onJumpFromLinkAnnotation,Vr=Ut.onJumpToDest,Br=pt.useRef(),Qr=Jn&&Jn.length&&In.dest&&typeof In.dest=="string"?(dn=Jn.find(function(Ns){return Ns.dest===In.dest}))===null||dn===void 0?void 0:dn.title:"",Kr=!!(In.url||In.dest||In.action||In.unsafeUrl),Or={};if(In.url||In.unsafeUrl){var Js=Rt(In.url||In.unsafeUrl,"");Js?Or={"data-target":"external",href:Js,rel:"noopener noreferrer nofollow",target:In.newWindow?"_blank":"",title:Js}:Kr=!1}else Or={href:"","data-annotation-link":In.id,onClick:function(Ns){Ns.preventDefault(),In.action?ur(In.action):Ms(Zn,In.dest).then(function(Is){var Vs=Br.current,Es=$n.current;if(Vs&&Es){var Xs=Vs.getBoundingClientRect();Es.style.setProperty("height","100%"),Es.style.setProperty("width","100%");var Bs=Es.getBoundingClientRect();Es.style.removeProperty("height"),Es.style.removeProperty("width");var fo=(Xs.left-Bs.left)/Un,po=(Bs.bottom-Xs.bottom+Xs.height)/Un;zr({bottomOffset:po,label:Qr,leftOffset:fo,pageIndex:sr})}Vr(Is)})}};return Qr&&(Or=Object.assign({},Or,{title:Qr,"aria-label":Qr})),pt.createElement(Us,{annotation:In,hasPopup:!1,ignoreBorder:!1,isRenderable:Kr,page:fr,viewport:pr},function(Ns){return pt.createElement("div",kt({},Ns.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--link","data-annotation-id":In.id,"data-testid":"core__annotation--link-".concat(In.id)}),pt.createElement("a",kt({ref:Br},Or)))})},yn=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr),Un=dn.rect,pr=Un[2]-Un[0],ur=Un[3]-Un[1],zr=dn.borderStyle.width;return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Vr){return pt.createElement("div",kt({},Vr.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--polygon","data-annotation-id":dn.id,onClick:Vr.popup.toggleOnClick,onMouseEnter:Vr.popup.openOnHover,onMouseLeave:Vr.popup.closeOnHover}),dn.vertices&&dn.vertices.length&&pt.createElement("svg",{height:"".concat(ur,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(pr," ").concat(ur),width:"".concat(pr,"px")},pt.createElement("polygon",{fill:"none",stroke:"transparent",strokeWidth:zr||1,points:dn.vertices.map(function(Br){return"".concat(Br.x-Un[0],",").concat(Un[3]-Br.y)}).join(" ")})),Vr.slot.children)})},Rn=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr),Un=dn.rect,pr=Un[2]-Un[0],ur=Un[3]-Un[1],zr=dn.borderStyle.width;return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Vr){return pt.createElement("div",kt({},Vr.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--polyline","data-annotation-id":dn.id,onClick:Vr.popup.toggleOnClick,onMouseEnter:Vr.popup.openOnHover,onMouseLeave:Vr.popup.closeOnHover}),dn.vertices&&dn.vertices.length&&pt.createElement("svg",{height:"".concat(ur,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(pr," ").concat(ur),width:"".concat(pr,"px")},pt.createElement("polyline",{fill:"none",stroke:"transparent",strokeWidth:zr||1,points:dn.vertices.map(function(Br){return"".concat(Br.x-Un[0],",").concat(Un[3]-Br.y)}).join(" ")})),Vr.slot.children)})},zn=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr),Un=dn.rect,pr=Un[2]-Un[0],ur=Un[3]-Un[1],zr=dn.borderStyle.width;return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Vr){return pt.createElement("div",kt({},Vr.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--square","data-annotation-id":dn.id,onClick:Vr.popup.toggleOnClick,onMouseEnter:Vr.popup.openOnHover,onMouseLeave:Vr.popup.closeOnHover}),pt.createElement("svg",{height:"".concat(ur,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(pr," ").concat(ur),width:"".concat(pr,"px")},pt.createElement("rect",{height:ur-zr,fill:"none",stroke:"transparent",strokeWidth:zr||1,x:zr/2,y:zr/2,width:pr-zr})),Vr.slot.children)})},ir=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr);return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Un){return pt.createElement("div",kt({},Un.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--squiggly","data-annotation-id":dn.id,onClick:Un.popup.toggleOnClick,onMouseEnter:Un.popup.openOnHover,onMouseLeave:Un.popup.closeOnHover}),Un.slot.children)})},Sr=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr);return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Un){return pt.createElement("div",kt({},Un.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--stamp","data-annotation-id":dn.id,onClick:Un.popup.toggleOnClick,onMouseEnter:Un.popup.openOnHover,onMouseLeave:Un.popup.closeOnHover}),Un.slot.children)})},Nr=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr);return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Un){return pt.createElement("div",kt({},Un.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--strike-out","data-annotation-id":dn.id,onClick:Un.popup.toggleOnClick,onMouseEnter:Un.popup.openOnHover,onMouseLeave:Un.popup.closeOnHover}),Un.slot.children)})},Fr=function(){return pt.createElement(tn,{size:16},pt.createElement("path",{d:"M.5,16.5a1,1,0,0,0,1,1h2v4l4-4h15a1,1,0,0,0,1-1V3.5a1,1,0,0,0-1-1H1.5a1,1,0,0,0-1,1Z"}),pt.createElement("path",{d:"M7.25,9.75A.25.25,0,1,1,7,10a.25.25,0,0,1,.25-.25"}),pt.createElement("path",{d:"M12,9.75a.25.25,0,1,1-.25.25A.25.25,0,0,1,12,9.75"}),pt.createElement("path",{d:"M16.75,9.75a.25.25,0,1,1-.25.25.25.25,0,0,1,.25-.25"}))},ps=function(){return pt.createElement(tn,{size:16},pt.createElement("path",{d:"M0.500 12.001 A11.500 11.500 0 1 0 23.500 12.001 A11.500 11.500 0 1 0 0.500 12.001 Z"}),pt.createElement("path",{d:"M6.000 12.001 A6.000 6.000 0 1 0 18.000 12.001 A6.000 6.000 0 1 0 6.000 12.001 Z"}),pt.createElement("path",{d:"M21.423 5.406L17.415 9.414"}),pt.createElement("path",{d:"M14.587 6.585L18.607 2.565"}),pt.createElement("path",{d:"M5.405 21.424L9.413 17.416"}),pt.createElement("path",{d:"M6.585 14.588L2.577 18.596"}),pt.createElement("path",{d:"M18.602 21.419L14.595 17.412"}),pt.createElement("path",{d:"M17.419 14.58L21.428 18.589"}),pt.createElement("path",{d:"M2.582 5.399L6.588 9.406"}),pt.createElement("path",{d:"M9.421 6.581L5.412 2.572"}))},Gr=function(){return pt.createElement(tn,{size:16},pt.createElement("path",{d:"M4.000 18.500 A1.500 1.500 0 1 0 7.000 18.500 A1.500 1.500 0 1 0 4.000 18.500 Z"}),pt.createElement("path",{d:"M20.5.5l-9.782,9.783a7,7,0,1,0,3,3L17,10h1.5V8.5L19,8h1.5V6.5L21,6h1.5V4.5l1-1V.5Z"}))},Ur=function(){return pt.createElement(tn,{size:16},pt.createElement("path",{d:"M2.000 2.500 L22.000 2.500 L22.000 23.500 L2.000 23.500 Z"}),pt.createElement("path",{d:"M6 4.5L6 0.5"}),pt.createElement("path",{d:"M18 4.5L18 0.5"}),pt.createElement("path",{d:"M10 4.5L10 0.5"}),pt.createElement("path",{d:"M14 4.5L14 0.5"}))},is=function(){return pt.createElement(tn,{size:16},pt.createElement("path",{d:"M17.5 0.498L17.5 23.498"}),pt.createElement("path",{d:"M10.5 0.498L10.5 23.498"}),pt.createElement("path",{d:"M23.5.5H6.5a6,6,0,0,0,0,12h4"}))},fs=function(){return pt.createElement(tn,{size:16},pt.createElement("path",{d:"M2.5 22.995L12 6.005 21.5 22.995 2.5 22.995z"}))},zs=function(Ut){var dn=Ut.annotation,In=Ut.childAnnotation,$n=Ut.page,Zn=Ut.viewport,Jn=dn.hasPopup===!1,fr=qn(dn),sr=Yn(dn),Un=!!(dn.hasPopup||fr||sr),pr=dn.name?dn.name.toLowerCase():"";return pt.createElement(Us,{annotation:dn,hasPopup:Jn,ignoreBorder:!1,isRenderable:Un,page:$n,viewport:Zn},function(ur){return pt.createElement(pt.Fragment,null,pt.createElement("div",kt({},ur.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--text","data-annotation-id":dn.id,onClick:ur.popup.toggleOnClick,onMouseEnter:ur.popup.openOnHover,onMouseLeave:ur.popup.closeOnHover}),pr&&pt.createElement("div",{className:"rpv-core__annotation-text-icon"},pr==="check"&&pt.createElement(Bt,null),pr==="comment"&&pt.createElement(Fr,null),pr==="help"&&pt.createElement(ps,null),pr==="insert"&&pt.createElement(fs,null),pr==="key"&&pt.createElement(Gr,null),pr==="note"&&pt.createElement(Ur,null),(pr==="newparagraph"||pr==="paragraph")&&pt.createElement(is,null)),ur.slot.children),In&&In.annotationType===_e.AnnotationType.Popup&&ur.popup.opened&&pt.createElement(jt,{annotation:In,page:$n,viewport:Zn}))})},Gs=function(Ut){var dn=Ut.annotation,In=Ut.page,$n=Ut.viewport,Zn=dn.hasPopup===!1,Jn=qn(dn),fr=Yn(dn),sr=!!(dn.hasPopup||Jn||fr);return pt.createElement(Us,{annotation:dn,hasPopup:Zn,ignoreBorder:!0,isRenderable:sr,page:In,viewport:$n},function(Un){return pt.createElement("div",kt({},Un.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--underline","data-annotation-id":dn.id,onClick:Un.popup.toggleOnClick,onMouseEnter:Un.popup.openOnHover,onMouseLeave:Un.popup.closeOnHover}),Un.slot.children)})},go=function(Ut){var dn=Ut.annotations,In=Ut.doc,$n=Ut.outlines,Zn=Ut.page,Jn=Ut.pageIndex,fr=Ut.plugins,sr=Ut.rotation,Un=Ut.scale,pr=Ut.onExecuteNamedAction,ur=Ut.onJumpFromLinkAnnotation,zr=Ut.onJumpToDest,Vr=pt.useRef(),Br=Zn.getViewport({rotation:sr,scale:Un}).clone({dontFlip:!0}),Qr=dn.filter(function(Kr){return!Kr.parentId});return Jt(function(){var Kr=Vr.current;Kr&&fr.forEach(function(Or){Or.onAnnotationLayerRender&&Or.onAnnotationLayerRender({annotations:Qr,container:Kr,pageIndex:Jn,rotation:sr,scale:Un})})},[]),pt.createElement("div",{ref:Vr,className:"rpv-core__annotation-layer","data-testid":"core__annotation-layer-".concat(Jn)},Qr.map(function(Kr){var Or=dn.find(function(Js){return Js.parentId===Kr.id});switch(Kr.annotationType){case _e.AnnotationType.Caret:return pt.createElement(lo,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Circle:return pt.createElement(rr,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.FileAttachment:return pt.createElement(_n,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.FreeText:return pt.createElement(Wt,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Highlight:return pt.createElement(ln,{key:Kr.id,annotation:Kr,childAnnotation:Or,page:Zn,viewport:Br});case _e.AnnotationType.Ink:return pt.createElement(xn,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Line:return pt.createElement(Nn,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Link:return pt.createElement(qt,{key:Kr.id,annotation:Kr,annotationContainerRef:Vr,doc:In,outlines:$n,page:Zn,pageIndex:Jn,scale:Un,viewport:Br,onExecuteNamedAction:pr,onJumpFromLinkAnnotation:ur,onJumpToDest:zr});case _e.AnnotationType.Polygon:return pt.createElement(yn,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Polyline:return pt.createElement(Rn,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Popup:return pt.createElement(jt,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Square:return pt.createElement(zn,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Squiggly:return pt.createElement(ir,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Stamp:return pt.createElement(Sr,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.StrikeOut:return pt.createElement(Nr,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});case _e.AnnotationType.Text:return pt.createElement(zs,{key:Kr.id,annotation:Kr,childAnnotation:Or,page:Zn,viewport:Br});case _e.AnnotationType.Underline:return pt.createElement(Gs,{key:Kr.id,annotation:Kr,page:Zn,viewport:Br});default:return pt.createElement(pt.Fragment,{key:Kr.id})}}))},Ao=function(Ut){var dn=Ut.page,In=Ut.renderAnnotations,$n=_i(),Zn=pt.useState({loading:!0,annotations:[]}),Jn=Zn[0],fr=Zn[1];return pt.useEffect(function(){dn.getAnnotations({intent:"display"}).then(function(sr){$n.current&&fr({loading:!1,annotations:sr})})},[]),Jn.loading?pt.createElement(pt.Fragment,null):In(Jn.annotations)},oo=function(Ut){var dn=Ut.doc,In=Ut.outlines,$n=Ut.page,Zn=Ut.pageIndex,Jn=Ut.plugins,fr=Ut.rotation,sr=Ut.scale,Un=Ut.onExecuteNamedAction,pr=Ut.onJumpFromLinkAnnotation,ur=Ut.onJumpToDest;return pt.createElement(Ao,{page:$n,renderAnnotations:function(zr){return pt.createElement(go,{annotations:zr,doc:dn,outlines:In,page:$n,pageIndex:Zn,plugins:Jn,rotation:fr,scale:sr,onExecuteNamedAction:Un,onJumpFromLinkAnnotation:pr,onJumpToDest:ur})}})},Cl=function(Ut,dn){var In=Ut%dn;return In===0?Ut:Math.floor(Ut-In)},eu=function(Ut){var dn=Ut.canvasLayerRef,In=Ut.height,$n=Ut.page,Zn=Ut.pageIndex,Jn=Ut.plugins,fr=Ut.rotation,sr=Ut.scale,Un=Ut.width,pr=Ut.onRenderCanvasCompleted,ur=pt.useRef();return Jt(function(){var zr=ur.current;zr&&zr.cancel();var Vr=dn.current;Vr.removeAttribute("data-testid"),Jn.forEach(function(Bs){Bs.onCanvasLayerRender&&Bs.onCanvasLayerRender({ele:Vr,pageIndex:Zn,rotation:fr,scale:sr,status:_e.LayerRenderStatus.PreRender})});var Br=$n.getViewport({rotation:fr,scale:sr}),Qr=window.devicePixelRatio||1,Kr=Math.sqrt(16777216/(Br.width*Br.height)),Or=Qr>Kr;Or?Vr.style.transform="scale(1, 1)":Vr.style.removeProperty("transform");var Js=Math.min(Kr,Qr),Ns=function(Bs,fo){var po,_o;if(Math.floor(Bs)===Bs)return[Bs,1];var xo=1/Bs;if(xo>fo)return[1,fo];if(Math.floor(xo)===xo)return[1,xo];for(var wo=Bs>1?xo:Bs,Io=0,Do=1,Yo=1,Bo=1;;){var Lo=Io+Yo,Xo=Do+Bo;if(Xo>fo)break;wo<=Lo/Xo?(Yo=(po=[Lo,Xo])[0],Bo=po[1]):(Io=(_o=[Lo,Xo])[0],Do=_o[1])}return wo<(Io/Do+Yo/Bo)/2?wo===Bs?[Io,Do]:[Do,Io]:wo===Bs?[Yo,Bo]:[Bo,Yo]}(Js,8),Is=Ns[0],Vs=Ns[1];Vr.width=Cl(Br.width*Js,Is),Vr.height=Cl(Br.height*Js,Is),Vr.style.width="".concat(Cl(Br.width,Vs),"px"),Vr.style.height="".concat(Cl(Br.height,Vs),"px"),Vr.hidden=!0;var Es=Vr.getContext("2d",{alpha:!1}),Xs=Or||Qr!==1?[Js,0,0,Js,0,0]:null;return ur.current=$n.render({canvasContext:Es,transform:Xs,viewport:Br}),ur.current.promise.then(function(){Vr.hidden=!1,Vr.setAttribute("data-testid","core__canvas-layer-".concat(Zn)),Jn.forEach(function(Bs){Bs.onCanvasLayerRender&&Bs.onCanvasLayerRender({ele:Vr,pageIndex:Zn,rotation:fr,scale:sr,status:_e.LayerRenderStatus.DidRender})}),pr()},function(){pr()}),function(){Vr&&(Vr.width=0,Vr.height=0)}},[]),pt.createElement("div",{className:"rpv-core__canvas-layer",style:{height:"".concat(In,"px"),width:"".concat(Un,"px")}},pt.createElement("canvas",{ref:dn}))},yl=function(Ut){var dn=Ut.height,In=Ut.page,$n=Ut.rotation,Zn=Ut.scale,Jn=Ut.width,fr=pt.useRef();return Jt(function(){var sr=fr.current,Un=In.getViewport({rotation:$n,scale:Zn});In.getOperatorList().then(function(pr){(function(){var ur=fr.current;ur&&(ur.innerHTML="")})(),new yt.SVGGraphics(In.commonObjs,In.objs).getSVG(pr,Un).then(function(ur){ur.style.height="".concat(dn,"px"),ur.style.width="".concat(Jn,"px"),sr.appendChild(ur)})})},[]),pt.createElement("div",{className:"rpv-core__svg-layer",ref:fr})},Gl=function(Ut){var dn=Ut.containerRef,In=Ut.page,$n=Ut.pageIndex,Zn=Ut.plugins,Jn=Ut.rotation,fr=Ut.scale,sr=Ut.onRenderTextCompleted,Un=pt.useRef(),pr=function(){var ur=dn.current;ur&&([].slice.call(ur.querySelectorAll(".rpv-core__text-layer-text")).forEach(function(zr){return ur.removeChild(zr)}),[].slice.call(ur.querySelectorAll('br[role="presentation"]')).forEach(function(zr){return ur.removeChild(zr)}))};return Jt(function(){var ur=Un.current;ur&&ur.cancel();var zr=dn.current;if(zr){zr.removeAttribute("data-testid");var Vr=In.getViewport({rotation:Jn,scale:fr});return Zn.forEach(function(Br){Br.onTextLayerRender&&Br.onTextLayerRender({ele:zr,pageIndex:$n,scale:fr,status:_e.LayerRenderStatus.PreRender})}),In.getTextContent().then(function(Br){pr(),Un.current=yt.renderTextLayer({container:zr,textContent:Br,textContentSource:Br,viewport:Vr}),Un.current.promise.then(function(){zr.setAttribute("data-testid","core__text-layer-".concat($n)),[].slice.call(zr.children).forEach(function(Qr){Qr.classList.contains("rpv-core__text-layer-text--not")||Qr.classList.add("rpv-core__text-layer-text")}),Zn.forEach(function(Qr){Qr.onTextLayerRender&&Qr.onTextLayerRender({ele:zr,pageIndex:$n,scale:fr,status:_e.LayerRenderStatus.DidRender})}),sr()},function(){zr.removeAttribute("data-testid"),sr()})}),function(){var Br;pr(),(Br=Un.current)===null||Br===void 0||Br.cancel()}}},[]),pt.createElement("div",{className:"rpv-core__text-layer",ref:dn})},h_=function(Ut){var dn=Ut.doc,In=Ut.measureRef,$n=Ut.outlines,Zn=Ut.pageIndex,Jn=Ut.pageRotation,fr=Ut.pageSize,sr=Ut.plugins,Un=Ut.renderPage,pr=Ut.renderQueueKey,ur=Ut.rotation,zr=Ut.scale,Vr=Ut.shouldRender,Br=Ut.viewMode,Qr=Ut.onExecuteNamedAction,Kr=Ut.onJumpFromLinkAnnotation,Or=Ut.onJumpToDest,Js=Ut.onRenderCompleted,Ns=Ut.onRotatePage,Is=_i(),Vs=pt.useState(null),Es=Vs[0],Xs=Vs[1],Bs=pt.useState(!1),fo=Bs[0],po=Bs[1],_o=pt.useState(!1),xo=_o[0],wo=_o[1],Io=pt.useRef(),Do=pt.useRef(),Yo=Math.abs(ur+Jn)%180==0,Bo=fr.pageWidth*zr,Lo=fr.pageHeight*zr,Xo=Yo?Bo:Lo,Fo=Yo?Lo:Bo,$a=(fr.rotation+ur+Jn)%360,bu=pt.useRef(0),nu=Un||function(na){return pt.createElement(pt.Fragment,null,na.canvasLayer.children,na.textLayer.children,na.annotationLayer.children)};return pt.useEffect(function(){Xs(null),po(!1),wo(!1)},[Jn,ur,zr]),pt.useEffect(function(){Vr&&Is.current&&!Es&&Ts(dn,Zn).then(function(na){Is.current&&(bu.current=pr,Xs(na))})},[Vr,Es]),pt.useEffect(function(){fo&&xo&&(pr!==bu.current?(Xs(null),po(!1),wo(!1)):Js(Zn))},[fo,xo]),pt.createElement("div",{className:Qt({"rpv-core__page-layer":!0,"rpv-core__page-layer--dual":Br===_e.ViewMode.DualPage,"rpv-core__page-layer--dual-cover":Br===_e.ViewMode.DualPageWithCover,"rpv-core__page-layer--single":Br===_e.ViewMode.SinglePage}),"data-testid":"core__page-layer-".concat(Zn),ref:In,style:{height:"".concat(Fo,"px"),width:"".concat(Xo,"px")}},Es?pt.createElement(pt.Fragment,null,nu({annotationLayer:{attrs:{},children:pt.createElement(oo,{doc:dn,outlines:$n,page:Es,pageIndex:Zn,plugins:sr,rotation:$a,scale:zr,onExecuteNamedAction:Qr,onJumpFromLinkAnnotation:Kr,onJumpToDest:Or})},canvasLayer:{attrs:{},children:pt.createElement(eu,{canvasLayerRef:Io,height:Fo,page:Es,pageIndex:Zn,plugins:sr,rotation:$a,scale:zr,width:Xo,onRenderCanvasCompleted:function(){Is.current&&po(!0)}})},canvasLayerRendered:fo,doc:dn,height:Fo,pageIndex:Zn,rotation:$a,scale:zr,svgLayer:{attrs:{},children:pt.createElement(yl,{height:Fo,page:Es,rotation:$a,scale:zr,width:Xo})},textLayer:{attrs:{},children:pt.createElement(Gl,{containerRef:Do,page:Es,pageIndex:Zn,plugins:sr,rotation:$a,scale:zr,onRenderTextCompleted:function(){Is.current&&wo(!0)}})},textLayerRendered:xo,width:Xo,markRendered:Js,onRotatePage:function(na){return Ns(Zn,na)}}),sr.map(function(na,Ml){return na.renderPageLayer?pt.createElement(pt.Fragment,{key:Ml},na.renderPageLayer({canvasLayerRef:Io,canvasLayerRendered:fo,doc:dn,height:Fo,pageIndex:Zn,rotation:$a,scale:zr,textLayerRef:Do,textLayerRendered:xo,width:Xo})):pt.createElement(pt.Fragment,{key:Ml})})):pt.createElement(Ht,{testId:"core__page-layer-loading-".concat(Zn)}))},tu=function(Ut,dn){var In=dn.rect;return Ut.height!==In.height||Ut.width!==In.width?In:Ut};(function(Ut){Ut.Horizontal="Horizontal",Ut.Vertical="Vertical",Ut.Both="Both"})(kr||(kr={}));var Xl=function(Ut){return 1-Math.pow(1-Ut,4)},ku=1e-4,Bu={left:0,top:0},Zo={capture:!1,passive:!0},_p=function(Ut){var dn=Ut.elementRef,In=Ut.enableSmoothScroll,$n=Ut.isRtl,Zn=Ut.scrollDirection,Jn=Ut.onSmoothScroll,fr=pt.useState(Bu),sr=fr[0],Un=fr[1],pr=pt.useState(dn.current),ur=pr[0],zr=pr[1],Vr=$n?-1:1,Br=pt.useRef(Zn);Br.current=Zn;var Qr=pt.useRef(Bu),Kr=pt.useRef(!0),Or=pt.useCallback(function(){Kr.current=!0,In&&Un(Qr.current),Jn(!1)},[]),Js=pt.useCallback(function(){if(ur){switch(Br.current){case kr.Horizontal:Qr.current={left:Vr*ur.scrollLeft,top:0};break;case kr.Both:Qr.current={left:Vr*ur.scrollLeft,top:ur.scrollTop};break;case kr.Vertical:default:Qr.current={left:0,top:ur.scrollTop}}In&&!Kr.current||Un(Qr.current)}},[ur]);Jt(function(){zr(dn.current)}),Jt(function(){if(ur)return ur.addEventListener("scroll",Js,Zo),function(){ur.removeEventListener("scroll",Js,Zo)}},[ur]);var Ns=pt.useCallback(function(Is,Vs){var Es=dn.current;if(!Es)return Promise.resolve();var Xs={left:0,top:0};switch(Br.current){case kr.Horizontal:Xs.left=Vr*Is.left;break;case kr.Both:Xs.left=Vr*Is.left,Xs.top=Is.top;break;case kr.Vertical:default:Xs.top=Is.top}return Vs?(Kr.current=!1,Jn(!0),new Promise(function(Bs,fo){(function(po,_o,xo,wo,Io,Do){Io===void 0&&(Io=function(Ml){return Ml}),Do===void 0&&(Do=function(){});var Yo=0,Bo=0,Lo=!1;switch(_o){case kr.Horizontal:Bo=po.scrollLeft,Yo=0;case kr.Both:Bo=po.scrollLeft,Yo=po.scrollTop;break;case kr.Vertical:default:Bo=0,Yo=po.scrollTop}var Xo=function(){Lo||(Lo=!0,po.scrollLeft=xo.left,po.scrollTop=xo.top,Do())};if(Math.abs(Yo-xo.top)<=ku&&_o===kr.Vertical)Xo();else if(Math.abs(Bo-xo.left)<=ku&&_o===kr.Horizontal)Xo();else{var Fo,$a=-1,bu=Bo-xo.left,nu=Yo-xo.top,na=function(Ml){$a===-1&&($a=Ml);var pu=Ml-$a,js=Math.min(pu/wo,1),Fs=Io(js),_s={left:Bo-bu*Fs,top:Yo-nu*Fs};switch(_o){case kr.Horizontal:po.scrollLeft=_s.left;break;case kr.Both:po.scrollLeft=_s.left,po.scrollTop=_s.top;break;case kr.Vertical:default:po.scrollTop=_s.top}Math.abs(_s.top-xo.top)<=ku&&Math.abs(_s.left-xo.left)<=ku&&!Lo&&(window.cancelAnimationFrame(Fo),Xo()),pu<wo?Fo=window.requestAnimationFrame(na):window.cancelAnimationFrame(Fo)};Fo=window.requestAnimationFrame(na)}})(Es,Br.current,Xs,400,Xl,function(){Or(),Bs()})})):new Promise(function(Bs,fo){switch(Br.current){case kr.Horizontal:Es.scrollLeft=Xs.left;break;case kr.Both:Es.scrollLeft=Xs.left,Es.scrollTop=Xs.top;break;case kr.Vertical:default:Es.scrollTop=Xs.top}Bs()})},[dn]);return{scrollOffset:sr,scrollTo:Ns}},Pl=function(Ut,dn,In){return Math.max(Ut,Math.min(In,dn))},Ko=function(Ut,dn){if(dn!==_e.ViewMode.DualPageWithCover)return 0;if(!function(Zn){var Jn=Zn.length;if(Jn===1)return!1;for(var fr=1;fr<Jn;fr++)if(Zn[fr].height!==Zn[0].height||Zn[fr].width!==Zn[0].width)return!0;return!1}(Ut))return 2*Ut[0].width;var In=Tr(Ut.slice(1),2).map(function(Zn){return Zn.length===2?Zn[0].width+Zn[1].width:Zn[0].width}),$n=[Ut[0].width].concat(In);return Math.max.apply(Math,$n)},$p={left:0,top:0},hu={left:0,top:0},yp={left:0,top:0},du={left:0,top:0},d_={height:0,width:0},vp={left:0,top:0},ju="data-virtual-index",$u=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],To=function(Ut){var dn=Ut.enableSmoothScroll,In=Ut.isRtl,$n=Ut.numberOfItems,Zn=Ut.parentRef,Jn=Ut.setRenderRange,fr=Ut.sizes,sr=Ut.scrollMode,Un=Ut.viewMode,pr=pt.useState(!1),ur=pr[0],zr=pr[1],Vr=pt.useCallback(function(js){return zr(js)},[]),Br=pt.useRef(sr);Br.current=sr;var Qr=pt.useRef(Un);Qr.current=Un;var Kr=sr===_e.ScrollMode.Wrapped||Un===_e.ViewMode.DualPageWithCover||Un===_e.ViewMode.DualPage?kr.Both:sr===_e.ScrollMode.Horizontal?kr.Horizontal:kr.Vertical,Or=_p({elementRef:Zn,enableSmoothScroll:dn,isRtl:In,scrollDirection:Kr,onSmoothScroll:Vr}),Js=Or.scrollOffset,Ns=Or.scrollTo,Is=function(js){var Fs=js.elementRef,_s=pt.useState(Fs.current),Cs=_s[0],Ss=_s[1],Ws=pt.useRef(!1),Zs=pt.useReducer(tu,{height:0,width:0}),ks=Zs[0],ls=Zs[1];return Jt(function(){Fs.current!==Cs&&Ss(Fs.current)}),Jt(function(){if(Cs&&!Ws.current){Ws.current=!0;var Ys=Cs.getBoundingClientRect(),ao=Ys.height,to=Ys.width;ls({rect:{height:ao,width:to}})}},[Cs]),pt.useEffect(function(){if(Cs){var Ys=new ResizeObserver(function(ao,to){ao.forEach(function(Ro){if(Ro.target===Cs){var $s=Ro.contentRect,xl=$s.height,vs=$s.width;ls({rect:{height:xl,width:vs}})}})});return Ys.observe(Cs),function(){Ys.unobserve(Cs)}}},[Cs]),ks}({elementRef:Zn}),Vs=pt.useRef({scrollOffset:vp,measurements:[]});Vs.current.scrollOffset=Js;var Es=pt.useMemo(function(){return Array($n).fill(-1)},[]),Xs=pt.useState(Es),Bs=Xs[0],fo=Xs[1],po=pt.useMemo(function(){var js=new IntersectionObserver(function(Fs){Fs.forEach(function(_s){var Cs=_s.isIntersecting?_s.intersectionRatio:-1,Ss=_s.target.getAttribute(ju);if(Ss){var Ws=parseInt(Ss,10);0<=Ws&&Ws<$n&&fo(function(Zs){return Zs[Ws]=Cs,function(ks,ls,Ys){if(Ys||arguments.length===2)for(var ao,to=0,Ro=ls.length;to<Ro;to++)!ao&&to in ls||(ao||(ao=Array.prototype.slice.call(ls,0,to)),ao[to]=ls[to]);return ks.concat(ao||Array.prototype.slice.call(ls))}([],Zs,!0)})}})},{threshold:$u});return js},[]),_o=pt.useMemo(function(){return sr===_e.ScrollMode.Page&&Un===_e.ViewMode.SinglePage?function(js,Fs,_s){for(var Cs=[],Ss=0;Ss<js;Ss++){var Ws={height:Math.max(Fs.height,_s[Ss].height),width:Math.max(Fs.width,_s[Ss].width)},Zs=Ss===0?du:Cs[Ss-1].end,ks={left:Zs.left+Ws.width,top:Zs.top+Ws.height};Cs[Ss]={index:Ss,start:Zs,size:Ws,end:ks,visibility:-1}}return Cs}($n,Is,fr):Un===_e.ViewMode.DualPageWithCover?function(js,Fs,_s,Cs){for(var Ss=[],Ws=0,Zs=0,ks=yp,ls=0;ls<js;ls++){var Ys=ls===0?{height:Cs===_e.ScrollMode.Page?Math.max(Fs.height,_s[ls].height):_s[ls].height,width:Cs===_e.ScrollMode.Page?Math.max(Fs.width,_s[ls].width):_s[ls].width}:{height:Cs===_e.ScrollMode.Page?Math.max(Fs.height,_s[ls].height):_s[ls].height,width:Math.max(Fs.width/2,_s[ls].width)};Cs===_e.ScrollMode.Page?ks=ls===0?yp:{left:ls%2==0?Ys.width:0,top:Math.floor((ls-1)/2)*Ys.height+Ss[0].end.top}:ls===0?(ks=yp,Ws=_s[0].height,Zs=0):ls%2==1?(ks={left:0,top:Ws+=Zs},Zs=ls===js-1?_s[ls].height:Math.max(_s[ls].height,_s[ls+1].height)):ks={left:Ss[ls-1].end.left,top:Ws};var ao={left:ks.left+Ys.width,top:ks.top+Ys.height};Ss[ls]={index:ls,start:ks,size:Ys,end:ao,visibility:-1}}return Ss}($n,Is,fr,sr):Un===_e.ViewMode.DualPage?function(js,Fs,_s,Cs){for(var Ss=[],Ws=0,Zs=0,ks=hu,ls=0;ls<js;ls++){var Ys={height:Cs===_e.ScrollMode.Page?Math.max(Fs.height,_s[ls].height):_s[ls].height,width:Math.max(Fs.width/2,_s[ls].width)};Cs===_e.ScrollMode.Page?ks={left:ls%2==0?0:Ys.width,top:Math.floor(ls/2)*Ys.height}:ls%2==0?(ks={left:0,top:Ws+=Zs},Zs=ls===js-1?_s[ls].height:Math.max(_s[ls].height,_s[ls+1].height)):ks={left:Ss[ls-1].end.left,top:Ws};var ao={left:ks.left+Ys.width,top:ks.top+Ys.height};Ss[ls]={index:ls,start:ks,size:Ys,end:ao,visibility:-1}}return Ss}($n,Is,fr,sr):function(js,Fs,_s,Cs){for(var Ss=[],Ws=0,Zs={left:0,top:0},ks=0,ls=$p,Ys=0;Ys<js;Ys++){var ao=_s[Ys];if(Ys===0)Ws=ao.width,Zs={left:0,top:0},ks=ao.height;else switch(Cs){case _e.ScrollMode.Wrapped:(Ws+=ao.width)<Fs.width?(ls={left:Ss[Ys-1].end.left,top:Zs.top},ks=Math.max(ks,ao.height)):(Ws=ao.width,Zs={left:(ls={left:Zs.left,top:Zs.top+ks}).left,top:ls.top},ks=ao.height);break;case _e.ScrollMode.Horizontal:case _e.ScrollMode.Vertical:default:ls=Ss[Ys-1].end}var to={left:ls.left+ao.width,top:ls.top+ao.height};Ss[Ys]={index:Ys,start:ls,size:ao,end:to,visibility:-1}}return Ss}($n,Is,fr,sr)},[sr,fr,Un,Is]),xo=_o[$n-1]?{height:_o[$n-1].end.top,width:_o[$n-1].end.left}:d_;Vs.current.measurements=_o;var wo=pt.useMemo(function(){var js=function(Ys,ao,to,Ro){var $s=0;switch(Ys){case kr.Horizontal:$s=Ro.left;break;case kr.Vertical:default:$s=Ro.top}var xl=ao.length-1,vs=function(Co,Ol,fu,Il){for(;Co<=Ol;){var Pu=(Co+Ol)/2|0,Qu=Il(Pu);if(Qu<fu)Co=Pu+1;else{if(!(Qu>fu))return Pu;Ol=Pu-1}}return Co>0?Co-1:0}(0,xl,$s,function(Co){switch(Ys){case kr.Horizontal:return ao[Co].start.left;case kr.Both:case kr.Vertical:default:return ao[Co].start.top}});if(Ys===kr.Both)for(var ro=ao[vs].start.top;vs-1>=0&&ao[vs-1].start.top===ro&&ao[vs-1].start.left>=Ro.left;)vs--;for(var Eo=vs;Eo<=xl;){var Po={top:ao[Eo].start.top-Ro.top,left:ao[Eo].start.left-Ro.left},Uo={height:to.height-Po.top,width:to.width-Po.left};if(Ys===kr.Horizontal&&Uo.width<0||Ys===kr.Vertical&&Uo.height<0||Ys===kr.Both&&(Uo.width<0||Uo.height<0))break;Eo++}return{start:vs,end:Eo}}(Kr,_o,Is,Js),Fs=js.start,_s=js.end,Cs=Bs.slice(Pl(0,$n,Fs),Pl(0,$n,_s)),Ss=Fs+Cs.reduce(function(Ys,ao,to,Ro){return ao>Ro[Ys]?to:Ys},0),Ws=Ss=Pl(0,$n-1,Ss),Zs=Jn({endPage:_s,numPages:$n,startPage:Fs}),ks=Zs.startPage,ls=Zs.endPage;switch(ks=Math.max(ks,0),ls=Math.min(ls,$n-1),Un){case _e.ViewMode.DualPageWithCover:Ss>0&&(Ws=Ss%2==1?Ss:Ss-1),ks=ks===0?0:ks%2==1?ks:ks-1,$n-(ls=ls%2==1?ls-1:ls)<=2&&(ls=$n-1);break;case _e.ViewMode.DualPage:Ws=Ss%2==0?Ss:Ss-1,ks=ks%2==0?ks:ks-1,ls=ls%2==1?ls:ls-1;break;case _e.ViewMode.SinglePage:default:Ws=Ss}return{startPage:ks,endPage:ls,maxVisbilityIndex:Ws}},[_o,Is,Js,Un,Bs]),Io=wo.startPage,Do=wo.endPage,Yo=wo.maxVisbilityIndex,Bo=pt.useMemo(function(){for(var js=[],Fs=function(Cs){var Ss=_o[Cs],Ws=kt(kt({},Ss),{visibility:Bs[Cs]!==void 0?Bs[Cs]:-1,measureRef:function(Zs){Zs&&(Zs.setAttribute(ju,"".concat(Cs)),po.observe(Zs))}});js.push(Ws)},_s=Io;_s<=Do;_s++)Fs(_s);return js},[Io,Do,Bs,_o]),Lo=pt.useCallback(function(js,Fs){var _s=Vs.current.measurements[Pl(0,$n-1,js)],Cs=Br.current===_e.ScrollMode.Page?vp:Fs;return _s?Ns({left:Cs.left+_s.start.left,top:Cs.top+_s.start.top},dn):Promise.resolve()},[Ns,dn]),Xo=pt.useCallback(function(js,Fs){var _s=Vs.current.measurements,Cs=_s[js].start,Ss=_s.find(function(Zs){return Zs.start.top-Cs.top>1e-12});if(!Ss)return Promise.resolve();var Ws=Ss.index;switch(Qr.current){case _e.ViewMode.DualPage:Ws=Ws%2==0?Ws:Ws+1;break;case _e.ViewMode.DualPageWithCover:Ws=Ws%2==1?Ws:Ws+1}return Lo(Ws,Fs)},[]),Fo=pt.useCallback(function(js,Fs){for(var _s=Vs.current.measurements,Cs=_s[js].start,Ss=js,Ws=!1,Zs=$n-1;Zs>=0;Zs--)if(Cs.top-_s[Zs].start.top>1e-12){Ws=!0,Ss=_s[Zs].index;break}if(!Ws)return Promise.resolve();switch(Qr.current){case _e.ViewMode.DualPage:Ss=Ss%2==0?Ss:Ss-1;break;case _e.ViewMode.DualPageWithCover:Ss=Ss%2==0?Ss-1:Ss}return Ss===js&&(Ss=js-1),Lo(Ss,Fs)},[]),$a=pt.useCallback(function(js,Fs){if(Qr.current===_e.ViewMode.DualPageWithCover||Qr.current===_e.ViewMode.DualPage)return Xo(js,Fs);switch(Br.current){case _e.ScrollMode.Wrapped:return Xo(js,Fs);case _e.ScrollMode.Horizontal:case _e.ScrollMode.Vertical:default:return Lo(js+1,Fs)}},[]),bu=pt.useCallback(function(js,Fs){if(Qr.current===_e.ViewMode.DualPageWithCover||Qr.current===_e.ViewMode.DualPage)return Fo(js,Fs);switch(Br.current){case _e.ScrollMode.Wrapped:return Fo(js,Fs);case _e.ScrollMode.Horizontal:case _e.ScrollMode.Vertical:default:return Lo(js-1,Fs)}},[]),nu=pt.useCallback(function(){return function(js,Fs){switch(Fs){case _e.ScrollMode.Horizontal:return{position:"relative",height:"100%",width:"".concat(js.width,"px")};case _e.ScrollMode.Vertical:default:return{position:"relative",height:"".concat(js.height,"px"),width:"100%"}}}(xo,Br.current)},[xo]),na=pt.useCallback(function(js){return function(Fs,_s,Cs){return Cs!==_e.ScrollMode.Page?{}:{height:"".concat(_s.height,"px"),width:"100%",position:"absolute",top:0,transform:"translateY(".concat(Fs.start.top,"px)")}}(js,Is,Br.current)},[Is]),Ml=pt.useCallback(function(js){return function(Fs,_s,Cs,Ss,Ws){var Zs,ks,ls,Ys,ao,to,Ro,$s=_s?"right":"left",xl=_s?-1:1,vs=Cs.length,ro=Fs.start.left*xl,Eo=Fs.size,Po=Eo.height,Uo=Eo.width;if(Ss===_e.ViewMode.DualPageWithCover){var Co=Ws===_e.ScrollMode.Page?0:Fs.start.top;return Fs.index===0||vs%2==0&&Fs.index===vs-1?((Zs={height:"".concat(Po,"px"),minWidth:"".concat(Ko(Cs,Ss),"px"),width:"100%"})[$s]=0,Zs.position="absolute",Zs.top=0,Zs.transform="translate(".concat(ro,"px, ").concat(Co,"px)"),Zs):((ks={height:"".concat(Po,"px"),width:"".concat(Uo,"px")})[$s]=0,ks.position="absolute",ks.top=0,ks.transform="translate(".concat(ro,"px, ").concat(Co,"px)"),ks)}if(Ss===_e.ViewMode.DualPage)return(ls={height:"".concat(Po,"px"),width:"".concat(Uo,"px")})[$s]=0,ls.position="absolute",ls.top=0,ls.transform="translate(".concat(ro,"px, ").concat(Ws===_e.ScrollMode.Page?0:Fs.start.top,"px)"),ls;switch(Ws){case _e.ScrollMode.Horizontal:return(Ys={height:"100%",width:"".concat(Uo,"px")})[$s]=0,Ys.position="absolute",Ys.top=0,Ys.transform="translateX(".concat(ro,"px)"),Ys;case _e.ScrollMode.Page:return(ao={height:"".concat(Po,"px"),width:"".concat(Uo,"px")})[$s]=0,ao.position="absolute",ao.top=0,ao;case _e.ScrollMode.Wrapped:return(to={height:"".concat(Po,"px"),width:"".concat(Uo,"px")})[$s]=0,to.position="absolute",to.top=0,to.transform="translate(".concat(ro,"px, ").concat(Fs.start.top,"px)"),to;case _e.ScrollMode.Vertical:default:return(Ro={height:"".concat(Po,"px"),width:"100%"})[$s]=0,Ro.position="absolute",Ro.top=0,Ro.transform="translateY(".concat(Fs.start.top,"px)"),Ro}}(js,In,fr,Qr.current,Br.current)},[In,fr]),pu=pt.useCallback(function(js,Fs){var _s=Vs.current,Cs=_s.measurements,Ss=_s.scrollOffset,Ws=Cs[Pl(0,$n-1,Fs)];if(Ws){var Zs=Br.current===_e.ScrollMode.Page?{left:Ws.start.left,top:Ws.start.top}:{left:Ss.left*js,top:Ss.top*js};return Ns(Zs,!1)}return Promise.resolve()},[]);return pt.useEffect(function(){return function(){po.disconnect()}},[]),{boundingClientRect:Is,isSmoothScrolling:ur,startPage:Io,endPage:Do,maxVisbilityIndex:Yo,virtualItems:Bo,getContainerStyles:nu,getItemContainerStyles:na,getItemStyles:Ml,scrollToItem:Lo,scrollToNextItem:$a,scrollToPreviousItem:bu,zoom:pu}},xp=function(Ut,dn,In,$n,Zn,Jn){var fr=In;switch(!0){case(Zn===_e.ViewMode.DualPageWithCover&&Jn>=3):case(Zn===_e.ViewMode.DualPage&&Jn>=3):fr=2*In;break;default:fr=In}switch($n){case _e.SpecialZoomLevel.ActualSize:return 1;case _e.SpecialZoomLevel.PageFit:return Math.min((Ut.clientWidth-17)/fr,(Ut.clientHeight-16)/dn);case _e.SpecialZoomLevel.PageWidth:return(Ut.clientWidth-17)/fr}},dm=function(Ut){var dn,In,$n=Ut.getCurrentPage,Zn=(dn=50,In=pt.useRef([]),pt.useEffect(function(){return function(){In.current=[]}},[]),{push:function(pr){var ur=In.current;ur.length+1>dn&&ur.shift(),ur.push(pr),In.current=ur},map:function(pr){return In.current.map(function(ur){return pr(ur)})},pop:function(){var pr=In.current;if(pr.length===0)return null;var ur=pr.pop();return In.current=pr,ur}}),Jn=function(pr){var ur=pt.useRef([]);return pt.useEffect(function(){return function(){ur.current=[]}},[]),{dequeue:function(){var zr=ur.current;if(zr.length===0)return null;var Vr=zr.shift();return ur.current=zr,Vr||null},enqueue:function(zr){var Vr=ur.current;Vr.length+1>pr&&Vr.pop(),ur.current=[zr].concat(Vr)},map:function(zr){return ur.current.map(function(Vr){return zr(Vr)})}}}(50),fr=function(){var pr=Jn.dequeue();return pr&&Zn.push(pr),pr&&pr.pageIndex===$n()?fr():pr},sr=function(){var pr=Zn.pop();return pr&&Jn.enqueue(pr),pr&&pr.pageIndex===$n()?sr():pr},Un=pt.useCallback(function(pr){Zn.push(pr)},[]);return{getNextDestination:fr,getPreviousDestination:sr,markVisitedDestination:Un}},Zu=function(Ut){var dn=[];return Ut.map(function(In){dn=dn.concat(In).concat(function($n){var Zn=[];return $n.items&&$n.items.length>0&&(Zn=Zn.concat(Zu($n.items))),Zn}(In))}),dn},Up={capture:!1,passive:!0},Vp={height:0,width:0},Ku={height:0,width:0},Hp=function(Ut){var dn=Ut.getCurrentPage,In=Ut.getCurrentScrollMode,$n=Ut.jumpToPage,Zn=Ut.targetRef,Jn=pt.useState(_e.FullScreenMode.Normal),fr=Jn[0],sr=Jn[1],Un=function(){var Bs=pt.useState(Vp),fo=Bs[0],po=Bs[1],_o=Sn(function(){po({height:window.innerHeight,width:window.innerWidth})},100);return Jt(function(){return window.addEventListener("resize",_o,Up),function(){window.removeEventListener("resize",_o,Up)}},[]),fo}(),pr=pt.useState(Ku),ur=pr[0],zr=pr[1],Vr=pt.useRef(Ku),Br=pt.useRef(dn()),Qr=pt.useRef(Ku),Kr=pt.useState(Zn.current),Or=Kr[0],Js=Kr[1],Ns=pt.useRef();Jt(function(){Zn.current!==Or&&Js(Zn.current)},[]),Jt(function(){if(Or){var Bs=new ResizeObserver(function(fo){fo.forEach(function(po){var _o=po.target.getBoundingClientRect(),xo=_o.height,wo=_o.width;zr({height:xo,width:wo})})});return Bs.observe(Or),function(){Bs.unobserve(Or),Bs.disconnect()}}},[Or]);var Is=pt.useCallback(function(Bs){var fo=Xn();return fo&&fo!==Bs?(sr(_e.FullScreenMode.Normal),Wn(fo)):Promise.resolve()},[]),Vs=pt.useCallback(function(Bs){Bs&&fn()&&(Js(Bs),Is(Bs).then(function(){Ns.current=Bs,sr(_e.FullScreenMode.Entering),function(fo){Yt&&fo[vn.RequestFullScreen]()}(Bs)}))},[]),Es=pt.useCallback(function(){Xn()&&(sr(_e.FullScreenMode.Exitting),Wn(document))},[]),Xs=pt.useCallback(function(){Or&&Xn()!==Or&&sr(_e.FullScreenMode.Exitting)},[Or]);return pt.useEffect(function(){switch(fr){case _e.FullScreenMode.Entering:Ns.current&&(Ns.current.style.backgroundColor="var(--rpv-core__full-screen-target-background-color)"),Br.current=dn(),Vr.current={height:window.innerHeight,width:window.innerWidth};break;case _e.FullScreenMode.Entered:In()===_e.ScrollMode.Page?$n(Br.current).then(function(){sr(_e.FullScreenMode.EnteredCompletely)}):sr(_e.FullScreenMode.EnteredCompletely);break;case _e.FullScreenMode.Exitting:Ns.current&&(Ns.current.style.backgroundColor="",Ns.current=null),Br.current=dn();break;case _e.FullScreenMode.Exited:sr(_e.FullScreenMode.Normal),In()===_e.ScrollMode.Page&&$n(Br.current)}},[fr]),pt.useEffect(function(){if(fr!==_e.FullScreenMode.Normal)return fr===_e.FullScreenMode.Entering&&Un.height===ur.height&&Un.width===ur.width&&Un.height>0&&Un.width>0&&(Qr.current.height===0||Un.height==Qr.current.height)?(Qr.current={height:window.innerHeight,width:window.innerWidth},void sr(_e.FullScreenMode.Entered)):void(fr===_e.FullScreenMode.Exitting&&Vr.current.height===Un.height&&Vr.current.width===Un.width&&Un.height>0&&Un.width>0&&sr(_e.FullScreenMode.Exited))},[fr,Un,ur]),pt.useEffect(function(){var Bs;return Bs=Xs,Yt&&document.addEventListener(vn.FullScreenChange,Bs),function(){(function(fo){Yt&&document.removeEventListener(vn.FullScreenChange,fo)})(Xs)}},[Or]),{enterFullScreenMode:Vs,exitFullScreenMode:Es,fullScreenMode:fr}},np={buildPageStyles:function(){return{}},transformSize:function(Ut){return Ut.size}},Yu={left:0,top:0},p_=function(Ut){var dn=Ut.currentFile,In=Ut.defaultScale,$n=Ut.doc,Zn=Ut.enableSmoothScroll,Jn=Ut.initialPage,fr=Ut.initialRotation,sr=Ut.initialScale,Un=Ut.pageLayout,pr=Ut.pageSizes,ur=Ut.plugins,zr=Ut.renderPage,Vr=Ut.scrollMode,Br=Ut.setRenderRange,Qr=Ut.viewMode,Kr=Ut.viewerState,Or=Ut.onDocumentLoad,Js=Ut.onOpenFile,Ns=Ut.onPageChange,Is=Ut.onRotate,Vs=Ut.onRotatePage,Es=Ut.onZoom,Xs=$n.numPages,Bs=$n.loadingTask.docId,fo=pt.useContext(Dr).l10n,po=pt.useContext(Mt),_o=po.direction===_e.TextDirection.RightToLeft,xo=pt.useRef(),wo=pt.useRef(),Io=pt.useState(Jn),Do=Io[0],Yo=Io[1],Bo=pt.useRef(null),Lo=dm({getCurrentPage:function(){return vs.current.pageIndex}}),Xo=pt.useState(fr),Fo=Xo[0],$a=Xo[1],bu=gr(Fo),nu=pt.useState(!1),na=nu[0],Ml=nu[1],pu=pt.useState(new Map),js=pu[0],Fs=pu[1],_s=pt.useState(Vr),Cs=_s[0],Ss=_s[1],Ws=gr(Cs),Zs=pt.useState(Qr),ks=Zs[0],ls=Zs[1],Ys=gr(ks),ao=function(Xr){var Ks=_i(),so=pt.useState([]),io=so[0],ho=so[1];return pt.useEffect(function(){Xr.getOutline().then(function(uo){if(Ks.current&&uo!==null){var Jo=Zu(uo);ho(Jo)}})},[]),io}($n),to=pt.useState(sr),Ro=to[0],$s=to[1],xl=gr(Ro),vs=pt.useRef(Kr),ro=pt.useRef(typeof In=="string"?In:null),Eo=pt.useRef(-1),Po=pt.useRef(-1),Uo=pt.useRef(Jn),Co=Hp({getCurrentPage:function(){return vs.current.pageIndex},getCurrentScrollMode:function(){return vs.current.scrollMode},jumpToPage:function(Xr){return Zl(Xr)},targetRef:wo}),Ol=pt.useState(-1),fu=Ol[0],Il=Ol[1],Pu=pt.useState(0),Qu=Pu[0],fm=Pu[1],_a=lr({doc:$n});pt.useEffect(function(){return function(){qr.clear(),Cr.clear()}},[Bs]);var sp=pt.useMemo(function(){return Object.assign({},np,Un)},[]),wp=pt.useMemo(function(){return Array(Xs).fill(0).map(function(Xr,Ks){var so=[pr[Ks].pageHeight,pr[Ks].pageWidth],io=Math.abs(Fo)%180==0?{height:so[0],width:so[1]}:{height:so[1],width:so[0]},ho={height:io.height*Ro,width:io.width*Ro};return sp.transformSize({numPages:Xs,pageIndex:Ks,size:ho})})},[Fo,Ro]),So=To({enableSmoothScroll:Zn,isRtl:_o,numberOfItems:Xs,parentRef:wo,scrollMode:Cs,setRenderRange:Br,sizes:wp,viewMode:ks}),Ep=Sn(function(){!ro.current||vs.current.fullScreenMode!==_e.FullScreenMode.Normal||Jn>0&&Uo.current===Jn||iu(ro.current)},200);(function(Xr){var Ks=Xr.targetRef,so=Xr.onResize;Jt(function(){var io=new ResizeObserver(function(uo){uo.forEach(function(Jo){so(Jo.target)})}),ho=Ks.current;if(ho)return io.observe(ho),function(){io.unobserve(ho)}},[])})({targetRef:wo,onResize:Ep});var mu=function(Xr){var Ks=Xr;ur.forEach(function(so){so.onViewerStateChange&&(Ks=so.onViewerStateChange(Ks))}),vs.current=Ks},op=function(){return wo.current},ap=function(){return vs.current},Rm=pt.useCallback(function(Xr){Lo.markVisitedDestination(Xr)},[]),Sp=pt.useCallback(function(Xr){var Ks=Xr.pageIndex,so=Xr.bottomOffset,io=Xr.leftOffset,ho=Xr.scaleTo,uo=wo.current,Jo=vs.current;return uo&&Jo?new Promise(function(Mo,Kl){Ts($n,Ks).then(function(El){var ru=El.getViewport({scale:1}),up=0,Ip=(typeof so=="function"?so(ru.width,ru.height):so)||0,Ru=(typeof io=="function"?io(ru.width,ru.height):io)||0,zl=Jo.scale;switch(ho){case _e.SpecialZoomLevel.PageFit:up=0,Ru=0,iu(_e.SpecialZoomLevel.PageFit);break;case _e.SpecialZoomLevel.PageWidth:zl=xp(uo,pr[Ks].pageHeight,pr[Ks].pageWidth,_e.SpecialZoomLevel.PageWidth,Qr,Xs),up=(ru.height-Ip)*zl,Ru*=zl,iu(zl);break;default:up=(ru.height-Ip)*zl,Ru*=zl}switch(Jo.scrollMode){case _e.ScrollMode.Horizontal:So.scrollToItem(Ks,{left:Ru,top:0}).then(function(){Mo()});break;case _e.ScrollMode.Vertical:default:So.scrollToItem(Ks,{left:0,top:up}).then(function(){Mo()})}})}):Promise.resolve()},[]),bo=pt.useCallback(function(Xr){return Lo.markVisitedDestination(Xr),Sp(Xr)},[]),qp=pt.useCallback(function(){var Xr=Lo.getNextDestination();return Xr?Sp(Xr):Promise.resolve()},[]),m_=pt.useCallback(function(){var Xr=Lo.getPreviousDestination();return Xr?Sp(Xr):Promise.resolve()},[]),Mm=pt.useCallback(function(){return So.scrollToNextItem(vs.current.pageIndex,Yu)},[]),Zl=pt.useCallback(function(Xr){return 0<=Xr&&Xr<Xs?So.scrollToItem(Xr,Yu):Promise.resolve()},[]),Im=pt.useCallback(function(){return So.scrollToPreviousItem(vs.current.pageIndex,Yu)},[]),Ap=pt.useCallback(function(Xr){var Ks,so;(Ks=Xr.name,so=Ks.split(/\./).pop(),so?so.toLowerCase():"").toLowerCase()==="pdf"&&new Promise(function(io){var ho=new FileReader;ho.readAsArrayBuffer(Xr),ho.onload=function(){var uo=new Uint8Array(ho.result);io(uo)}}).then(function(io){Js(Xr.name,io)})},[Js]),mm=pt.useCallback(function(Xr){var Ks=Xr===_e.RotateDirection.Backward?-90:90,so=vs.current.rotation,io=so===360||so===-360?Ks:so+Ks;_a.markNotRendered(),$a(io),mu(kt(kt({},vs.current),{rotation:io})),Is({direction:Xr,doc:$n,rotation:io})},[]),Gp=pt.useCallback(function(Xr,Ks){var so=Ks===_e.RotateDirection.Backward?-90:90,io=vs.current.pagesRotation,ho=(io.has(Xr)?io.get(Xr):fr)+so,uo=io.set(Xr,ho);Fs(uo),Ml(function(Jo){return!Jo}),mu(kt(kt({},vs.current),{pagesRotation:uo,rotatedPage:Xr})),Vs({direction:Ks,doc:$n,pageIndex:Xr,rotation:ho}),_a.markRendering(Xr),Il(Xr)},[]),Tp=pt.useCallback(function(Xr){mu(kt(kt({},vs.current),{scrollMode:Xr})),Ss(Xr)},[]),Cp=pt.useCallback(function(Xr){mu(kt(kt({},vs.current),{viewMode:Xr})),ls(Xr)},[]),iu=pt.useCallback(function(Xr){var Ks=wo.current,so=vs.current.pageIndex;if(!(so<0||so>=Xs)){var io=pr[so].pageHeight,ho=pr[so].pageWidth,uo=Ks?typeof Xr=="string"?xp(Ks,io,ho,Xr,vs.current.viewMode,Xs):Xr:1;ro.current=typeof Xr=="string"?Xr:null,uo!==vs.current.scale&&(fm(function(Jo){return Jo+1}),_a.markNotRendered(),$s(uo),Es({doc:$n,scale:uo}),mu(kt(kt({},vs.current),{scale:uo})))}},[]),lp=pt.useCallback(function(Xr){Co.enterFullScreenMode(Xr)},[]),cp=pt.useCallback(function(){Co.exitFullScreenMode()},[]);pt.useEffect(function(){mu(kt(kt({},vs.current),{fullScreenMode:Co.fullScreenMode}))},[Co.fullScreenMode]),pt.useEffect(function(){var Xr={enterFullScreenMode:lp,exitFullScreenMode:cp,getPagesContainer:op,getViewerState:ap,jumpToDestination:bo,jumpToNextDestination:qp,jumpToPreviousDestination:m_,jumpToNextPage:Mm,jumpToPreviousPage:Im,jumpToPage:Zl,openFile:Ap,rotate:mm,rotatePage:Gp,setViewerState:mu,switchScrollMode:Tp,switchViewMode:Cp,zoom:iu};return ur.forEach(function(Ks){Ks.install&&Ks.install(Xr)}),function(){ur.forEach(function(Ks){Ks.uninstall&&Ks.uninstall(Xr)})}},[Bs]),pt.useEffect(function(){Or({doc:$n,file:dn}),ur.forEach(function(Xr){Xr.onDocumentLoad&&Xr.onDocumentLoad({doc:$n,file:dn})})},[Bs]);var kp,Uu,_h,Pp=So.boundingClientRect;kp=function(){Jn&&Zl(Jn)},Uu=Pp.height>0&&Pp.width>0,_h=pt.useRef(!1),Jt(function(){Uu&&!_h.current&&(_h.current=!0,kp())},[kp,Uu]),Jt(function(){var Xr=vs.current.pageIndex;Xr>-1&&Ws!==Cs&&So.scrollToItem(Xr,Yu).then(function(){Co.fullScreenMode===_e.FullScreenMode.EnteredCompletely&&(Zn||_a.markNotRendered(),Eo.current=-1)})},[Cs]),Jt(function(){var Xr=vs.current.pageIndex;Xr>-1&&bu!==Fo&&So.scrollToItem(Xr,Yu)},[Fo]),Jt(function(){xl!=0&&xl!=vs.current.scale&&So.zoom(vs.current.scale/xl,vs.current.pageIndex).then(function(){Co.fullScreenMode===_e.FullScreenMode.EnteredCompletely&&(Po.current=-1)})},[Ro]),Jt(function(){if(Ys!==vs.current.viewMode){var Xr=So.startPage,Ks=So.endPage,so=So.virtualItems;_a.markNotRendered(),_a.setRange(Xr,Ks);for(var io=function(uo){var Jo=so.find(function(Mo){return Mo.index===uo});Jo&&_a.setVisibility(uo,Jo.visibility)},ho=Xr;ho<=Ks;ho++)io(ho);Rp()}},[ks]),Jt(function(){var Xr=vs.current.pageIndex;Xr>-1&&Ys!==ks&&So.scrollToItem(Xr,Yu)},[ks]),Jt(function(){var Xr=vs.current.pageIndex;Xr>0&&Xr===Jn&&Uo.current===Jn&&ro.current&&(Uo.current=-1,iu(ro.current))},[Do]),pt.useEffect(function(){So.isSmoothScrolling||Bo.current!==null&&Bo.current===Do||(Bo.current=Do,Ns({currentPage:Do,doc:$n}))},[Do,So.isSmoothScrolling]),pt.useEffect(function(){Co.fullScreenMode===_e.FullScreenMode.Entering&&vs.current.scrollMode===_e.ScrollMode.Page&&(Eo.current=vs.current.pageIndex),Co.fullScreenMode===_e.FullScreenMode.EnteredCompletely&&vs.current.scrollMode===_e.ScrollMode.Page&&Zn&&(Eo.current=-1),Co.fullScreenMode===_e.FullScreenMode.EnteredCompletely&&ro.current&&(Po.current=vs.current.pageIndex,iu(ro.current))},[Co.fullScreenMode]),pt.useEffect(function(){if(Co.fullScreenMode!==_e.FullScreenMode.Entering&&Co.fullScreenMode!==_e.FullScreenMode.Exitting&&!So.isSmoothScrolling){var Xr=So.startPage,Ks=So.endPage,so=So.maxVisbilityIndex,io=So.virtualItems,ho=so,uo=Co.fullScreenMode===_e.FullScreenMode.Entered||Co.fullScreenMode===_e.FullScreenMode.EnteredCompletely;if(!(uo&&ho!==Eo.current&&Eo.current>-1||uo&&ho!==Po.current&&Po.current>-1)){Yo(ho),mu(kt(kt({},vs.current),{pageIndex:ho})),_a.setRange(Xr,Ks);for(var Jo=function(Kl){var El=io.find(function(ru){return ru.index===Kl});El&&_a.setVisibility(Kl,El.visibility)},Mo=Xr;Mo<=Ks;Mo++)Jo(Mo);Rp()}}},[So.startPage,So.endPage,So.isSmoothScrolling,So.maxVisbilityIndex,Co.fullScreenMode,na,Fo,Ro]);var Xp=pt.useCallback(function(Xr){_a.markRendered(Xr),Rp()},[Qu]),Rp=function(){var Xr=_a.getHighestPriorityPage();Xr>-1&&_a.isInRange(Xr)&&(_a.markRendering(Xr),Il(Xr))},g_=function(Xr){var Ks=Do-1,so=Do+1;switch(Xr){case"FirstPage":Zl(0);break;case"LastPage":Zl(Xs-1);break;case"NextPage":so<Xs&&Zl(so);break;case"PrevPage":Ks>=0&&Zl(Ks)}},Dm=pt.useCallback(function(){var Xr=So.virtualItems,Ks=[];switch(ks){case _e.ViewMode.DualPage:Ks=Tr(Xr,2);break;case _e.ViewMode.DualPageWithCover:Xr.length&&(Ks=Xr[0].index===0?[[Xr[0]]].concat(Tr(Xr.slice(1),2)):Tr(Xr,2));break;case _e.ViewMode.SinglePage:default:Ks=Tr(Xr,1)}var so=fo&&fo.core?fo.core.pageLabel:"Page {{pageIndex}}",io={attrs:{className:"rpv-core__inner-container","data-testid":"core__inner-container",ref:xo,style:{height:"100%"}},children:pt.createElement(pt.Fragment,null),subSlot:{attrs:{"data-testid":"core__inner-pages",className:Qt({"rpv-core__inner-pages":!0,"rpv-core__inner-pages--horizontal":Cs===_e.ScrollMode.Horizontal,"rpv-core__inner-pages--rtl":_o,"rpv-core__inner-pages--single":Cs===_e.ScrollMode.Page,"rpv-core__inner-pages--vertical":Cs===_e.ScrollMode.Vertical,"rpv-core__inner-pages--wrapped":Cs===_e.ScrollMode.Wrapped}),ref:wo,style:{height:"100%",position:"relative"}},children:pt.createElement("div",{"data-testid":"core__inner-current-page-".concat(Do),style:Object.assign({"--scale-factor":Ro},So.getContainerStyles())},Ks.map(function(ho){return pt.createElement("div",{className:Qt({"rpv-core__inner-page-container":!0,"rpv-core__inner-page-container--single":Cs===_e.ScrollMode.Page}),style:So.getItemContainerStyles(ho[0]),key:"".concat(ho[0].index,"-").concat(ks)},ho.map(function(uo){var Jo=ks===_e.ViewMode.DualPageWithCover&&(uo.index===0||Xs%2==0&&uo.index===Xs-1);return pt.createElement("div",{"aria-label":so.replace("{{pageIndex}}","".concat(uo.index+1)),className:Qt({"rpv-core__inner-page":!0,"rpv-core__inner-page--dual-even":ks===_e.ViewMode.DualPage&&uo.index%2==0,"rpv-core__inner-page--dual-odd":ks===_e.ViewMode.DualPage&&uo.index%2==1,"rpv-core__inner-page--dual-cover":Jo,"rpv-core__inner-page--dual-cover-even":ks===_e.ViewMode.DualPageWithCover&&!Jo&&uo.index%2==0,"rpv-core__inner-page--dual-cover-odd":ks===_e.ViewMode.DualPageWithCover&&!Jo&&uo.index%2==1,"rpv-core__inner-page--single":ks===_e.ViewMode.SinglePage&&Cs===_e.ScrollMode.Page}),role:"region",key:"".concat(uo.index,"-").concat(ks),style:Object.assign({},So.getItemStyles(uo),sp.buildPageStyles({numPages:Xs,pageIndex:uo.index,scrollMode:Cs,viewMode:ks}))},pt.createElement(h_,{doc:$n,measureRef:uo.measureRef,outlines:ao,pageIndex:uo.index,pageRotation:js.has(uo.index)?js.get(uo.index):0,pageSize:pr[uo.index],plugins:ur,renderPage:zr,renderQueueKey:Qu,rotation:Fo,scale:Ro,shouldRender:fu===uo.index,viewMode:ks,onExecuteNamedAction:g_,onJumpFromLinkAnnotation:Rm,onJumpToDest:bo,onRenderCompleted:Xp,onRotatePage:Gp}))}))}))}};return ur.forEach(function(ho){ho.renderViewer&&(io=ho.renderViewer({containerRef:xo,doc:$n,pagesContainerRef:wo,pagesRotation:js,pageSizes:pr,rotation:Fo,slot:io,themeContext:po,jumpToPage:Zl,openFile:Ap,rotate:mm,rotatePage:Gp,switchScrollMode:Tp,switchViewMode:Cp,zoom:iu}))}),io},[ur,So]),Mp=pt.useCallback(function(Xr){return pt.createElement("div",kt({},Xr.attrs,{style:Xr.attrs&&Xr.attrs.style?Xr.attrs.style:{}}),Xr.children,Xr.subSlot&&Mp(Xr.subSlot))},[]);return Mp(Dm())},pm=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],f_=function(Ut){var dn=Ut.defaultScale,In=Ut.doc,$n=Ut.render,Zn=Ut.scrollMode,Jn=Ut.viewMode,fr=pt.useRef(),sr=pt.useState({pageSizes:[],scale:0}),Un=sr[0],pr=sr[1];return pt.useLayoutEffect(function(){var ur=Array(In.numPages).fill(0).map(function(zr,Vr){return new Promise(function(Br,Qr){Ts(In,Vr).then(function(Kr){var Or=Kr.getViewport({scale:1});Br({pageHeight:Or.height,pageWidth:Or.width,rotation:Or.rotation})})})});Promise.all(ur).then(function(zr){var Vr=fr.current;if(Vr&&zr.length!==0){var Br=zr[0].pageWidth,Qr=zr[0].pageHeight,Kr=Vr.parentElement,Or=(Kr.clientWidth-45)/Br,Js=(Kr.clientHeight-45)/Qr,Ns=Or;switch(Zn){case _e.ScrollMode.Horizontal:Ns=Math.min(Or,Js);break;case _e.ScrollMode.Vertical:default:Ns=Or}var Is,Vs,Es=dn?typeof dn=="string"?xp(Kr,Qr,Br,dn,Jn,In.numPages):dn:(Is=Ns,(Vs=pm.findIndex(function(Xs){return Xs>=Is}))===-1||Vs===0?Is:pm[Vs-1]);pr({pageSizes:zr,scale:Es})}})},[In.loadingTask.docId]),Un.pageSizes.length===0||Un.scale===0?pt.createElement("div",{className:"rpv-core__page-size-calculator","data-testid":"core__page-size-calculating",ref:fr},pt.createElement(Ht,null)):$n(Un.pageSizes,Un.scale)},xu=function(){},Ju=function(Ut){function dn(In,$n){var Zn=Ut.call(this)||this;return Zn.verifyPassword=In,Zn.passwordStatus=$n,Zn}return At(dn,Ut),dn}(xu),Fl=function(Ut){var dn=Ut.passwordStatus,In=Ut.renderProtectedView,$n=Ut.verifyPassword,Zn=Ut.onDocumentAskPassword,Jn=pt.useContext(Dr).l10n,fr=pt.useState(""),sr=fr[0],Un=fr[1],pr=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft,ur=function(){return $n(sr)};return pt.useEffect(function(){Zn&&Zn({verifyPassword:$n})},[]),In?In({passwordStatus:dn,verifyPassword:$n}):pt.createElement("div",{className:"rpv-core__asking-password-wrapper"},pt.createElement("div",{className:Qt({"rpv-core__asking-password":!0,"rpv-core__asking-password--rtl":pr})},pt.createElement("div",{className:"rpv-core__asking-password-message"},dn===_e.PasswordStatus.RequiredPassword&&Jn.core.askingPassword.requirePasswordToOpen,dn===_e.PasswordStatus.WrongPassword&&Jn.core.wrongPassword.tryAgain),pt.createElement("div",{className:"rpv-core__asking-password-body"},pt.createElement("div",{className:Qt({"rpv-core__asking-password-input":!0,"rpv-core__asking-password-input--ltr":!pr,"rpv-core__asking-password-input--rtl":pr})},pt.createElement(nn,{testId:"core__asking-password-input",type:"password",value:sr,onChange:Un,onKeyDown:function(zr){zr.key==="Enter"&&ur()}})),pt.createElement(zt,{onClick:ur},Jn.core.askingPassword.submit))))},Rl=function(Ut){function dn(In){var $n=Ut.call(this)||this;return $n.doc=In,$n}return At(dn,Ut),dn}(xu),bp=function(Ut){function dn(In){var $n=Ut.call(this)||this;return $n.error=In,$n}return At(dn,Ut),dn}(xu),ip=function(Ut){function dn(In){var $n=Ut.call(this)||this;return $n.percentages=In,$n}return At(dn,Ut),dn}(xu),Wp=function(Ut){var dn=Ut.characterMap,In=Ut.file,$n=Ut.httpHeaders,Zn=Ut.render,Jn=Ut.renderError,fr=Ut.renderLoader,sr=Ut.renderProtectedView,Un=Ut.transformGetDocumentParams,pr=Ut.withCredentials,ur=Ut.onDocumentAskPassword,zr=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft,Vr=pt.useState(new ip(0)),Br=Vr[0],Qr=Vr[1],Kr=pt.useRef(""),Or=_i();return pt.useEffect(function(){Kr.current="",Qr(new ip(0));var Js=new yt.PDFWorker({name:"PDFWorker_".concat(Date.now())}),Ns=Object.assign({httpHeaders:$n,withCredentials:pr,worker:Js},typeof In=="string"?{url:In}:{data:In},dn?{cMapUrl:dn.url,cMapPacked:dn.isCompressed}:{}),Is=Un?Un(Ns):Ns,Vs=yt.getDocument(Is);return Vs.onPassword=function(Es,Xs){switch(Xs){case yt.PasswordResponses.NEED_PASSWORD:Or.current&&Qr(new Ju(Es,_e.PasswordStatus.RequiredPassword));break;case yt.PasswordResponses.INCORRECT_PASSWORD:Or.current&&Qr(new Ju(Es,_e.PasswordStatus.WrongPassword))}},Vs.onProgress=function(Es){var Xs=Es.total>0?Math.min(100,100*Es.loaded/Es.total):100;Or.current&&Kr.current===""&&Qr(new ip(Xs))},Vs.promise.then(function(Es){Kr.current=Es.loadingTask.docId,Or.current&&Qr(new Rl(Es))},function(Es){return Or.current&&!Js.destroyed&&Qr(new bp({message:Es.message||"Cannot load document",name:Es.name}))}),function(){Vs.destroy(),Js.destroy()}},[In]),Br instanceof Ju?pt.createElement(Fl,{passwordStatus:Br.passwordStatus,renderProtectedView:sr,verifyPassword:Br.verifyPassword,onDocumentAskPassword:ur}):Br instanceof Rl?Zn(Br.doc):Br instanceof bp?Jn?Jn(Br.error):pt.createElement("div",{className:Qt({"rpv-core__doc-error":!0,"rpv-core__doc-error--rtl":zr})},pt.createElement("div",{className:"rpv-core__doc-error-text"},Br.error.message)):pt.createElement("div",{"data-testid":"core__doc-loading",className:Qt({"rpv-core__doc-loading":!0,"rpv-core__doc-loading--rtl":zr})},fr?fr(Br.percentages):pt.createElement(Ht,null))},Pm=function(Ut,dn){var In=pt.useMemo(function(){return Ut==="auto"?typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":Ut},[]),$n=pt.useState(In),Zn=$n[0],Jn=$n[1],fr=gr(Zn);return pt.useEffect(function(){if(Ut==="auto"){var sr=window.matchMedia("(prefers-color-scheme: dark)"),Un=function(pr){Jn(pr.matches?"dark":"light")};return sr.addEventListener("change",Un),function(){return sr.removeEventListener("change",Un)}}},[]),pt.useEffect(function(){Zn!==fr&&dn&&dn(Zn)},[Zn]),pt.useEffect(function(){Ut!==Zn&&Jn(Ut)},[Ut]),{currentTheme:Zn,setCurrentTheme:Jn}},rp=function(Ut){return{startPage:Ut.startPage-3,endPage:Ut.endPage+3}};_e.Button=function(Ut){var dn=Ut.children,In=Ut.testId,$n=Ut.onClick,Zn=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft,Jn=In?{"data-testid":In}:{};return pt.createElement("button",kt({className:Qt({"rpv-core__button":!0,"rpv-core__button--rtl":Zn}),type:"button",onClick:$n},Jn),dn)},_e.Icon=tn,_e.LazyRender=function(Ut){var dn=Ut.attrs,In=Ut.children,$n=Ut.testId,Zn=pt.useState(!1),Jn=Zn[0],fr=Zn[1],sr=$n?kt(kt({},dn),{"data-testid":$n}):dn,Un=sn({once:!0,onVisibilityChanged:function(pr){pr.isVisible&&fr(!0)}});return pt.createElement("div",kt({ref:Un},sr),Jn&&In)},_e.LocalizationContext=Dr,_e.Menu=function(Ut){var dn=Ut.children,In=pt.useRef(),$n=pt.useRef([]),Zn=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft,Jn=function(sr){if(In.current)switch(sr.key){case"Tab":sr.preventDefault();break;case"ArrowDown":sr.preventDefault(),fr(function(Un,pr){return pr+1});break;case"ArrowUp":sr.preventDefault(),fr(function(Un,pr){return pr-1});break;case"End":sr.preventDefault(),fr(function(Un,pr){return Un.length-1});break;case"Home":sr.preventDefault(),fr(function(Un,pr){return 0})}},fr=function(sr){if(In.current){var Un=$n.current,pr=Un.findIndex(function(zr){return zr.getAttribute("tabindex")==="0"}),ur=Math.min(Un.length-1,Math.max(0,sr(Un,pr)));pr>=0&&pr<=Un.length-1&&Un[pr].setAttribute("tabindex","-1"),Un[ur].setAttribute("tabindex","0"),Un[ur].focus()}};return Jt(function(){var sr=In.current;if(sr){var Un=function(pr){var ur=[];return pr.querySelectorAll('.rpv-core__menu-item[role="menuitem"]').forEach(function(zr){if(zr instanceof HTMLElement){var Vr=zr.parentElement;(Vr===pr||window.getComputedStyle(Vr).display!=="none")&&ur.push(zr)}}),ur}(sr);$n.current=Un}},[]),Jt(function(){return document.addEventListener("keydown",Jn),function(){document.removeEventListener("keydown",Jn)}},[]),pt.createElement("div",{ref:In,"aria-orientation":"vertical",className:Qt({"rpv-core__menu":!0,"rpv-core__menu--rtl":Zn}),role:"menu",tabIndex:0},dn)},_e.MenuDivider=function(){return pt.createElement("div",{"aria-orientation":"horizontal",className:"rpv-core__menu-divider",role:"separator"})},_e.MenuItem=function(Ut){var dn=Ut.checked,In=dn!==void 0&&dn,$n=Ut.children,Zn=Ut.icon,Jn=Zn===void 0?null:Zn,fr=Ut.isDisabled,sr=fr!==void 0&&fr,Un=Ut.testId,pr=Ut.onClick,ur=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft,zr=Un?{"data-testid":Un}:{};return pt.createElement("button",kt({className:Qt({"rpv-core__menu-item":!0,"rpv-core__menu-item--disabled":sr,"rpv-core__menu-item--ltr":!ur,"rpv-core__menu-item--rtl":ur}),role:"menuitem",tabIndex:-1,type:"button",onClick:pr},zr),pt.createElement("div",{className:Qt({"rpv-core__menu-item-icon":!0,"rpv-core__menu-item-icon--ltr":!ur,"rpv-core__menu-item-icon--rtl":ur})},Jn),pt.createElement("div",{className:Qt({"rpv-core__menu-item-label":!0,"rpv-core__menu-item-label--ltr":!ur,"rpv-core__menu-item-label--rtl":ur})},$n),pt.createElement("div",{className:Qt({"rpv-core__menu-item-check":!0,"rpv-core__menu-item-check--ltr":!ur,"rpv-core__menu-item-check--rtl":ur})},In&&pt.createElement(Bt,null)))},_e.MinimalButton=function(Ut){var dn=Ut.ariaLabel,In=dn===void 0?"":dn,$n=Ut.ariaKeyShortcuts,Zn=$n===void 0?"":$n,Jn=Ut.children,fr=Ut.isDisabled,sr=fr!==void 0&&fr,Un=Ut.isSelected,pr=Un!==void 0&&Un,ur=Ut.testId,zr=Ut.onClick,Vr=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft,Br=ur?{"data-testid":ur}:{};return pt.createElement("button",kt({"aria-label":In},Zn&&{"aria-keyshortcuts":Zn},sr&&{"aria-disabled":!0},{className:Qt({"rpv-core__minimal-button":!0,"rpv-core__minimal-button--disabled":sr,"rpv-core__minimal-button--rtl":Vr,"rpv-core__minimal-button--selected":pr}),type:"button",onClick:zr},Br),Jn)},_e.Modal=function(Ut){var dn=Ut.ariaControlsSuffix,In=Ut.closeOnClickOutside,$n=Ut.closeOnEscape,Zn=Ut.content,Jn=Ut.isOpened,fr=Jn!==void 0&&Jn,sr=Ut.target,Un=dn||"".concat(An());return pt.createElement(Mn,{target:sr?function(pr,ur){return pt.createElement("div",{"aria-expanded":ur?"true":"false","aria-haspopup":"dialog","aria-controls":"rpv-core__modal-body-".concat(Un)},sr(pr,ur))}:null,content:function(pr){return pt.createElement(rn,null,pt.createElement($t,{ariaControlsSuffix:Un,closeOnClickOutside:In,closeOnEscape:$n,onToggle:pr},Zn(pr)))},isOpened:fr})},_e.Popover=function(Ut){var dn=Ut.ariaHasPopup,In=dn===void 0?"dialog":dn,$n=Ut.ariaControlsSuffix,Zn=Ut.closeOnClickOutside,Jn=Ut.closeOnEscape,fr=Ut.content,sr=Ut.lockScroll,Un=sr===void 0||sr,pr=Ut.offset,ur=Ut.position,zr=Ut.target,Vr=En(!1),Br=Vr.opened,Qr=Vr.toggle,Kr=pt.useRef(),Or=pt.useMemo(function(){return $n||"".concat(An())},[]);return pt.createElement("div",{ref:Kr,"aria-expanded":Br?"true":"false","aria-haspopup":In,"aria-controls":"rpv-core__popver-body-".concat(Or)},zr(Qr,Br),Br&&pt.createElement(pt.Fragment,null,Un&&pt.createElement(Lr,{closeOnEscape:Jn,onClose:Qr}),pt.createElement(ss,{ariaControlsSuffix:Or,closeOnClickOutside:Zn,offset:pr,position:ur,targetRef:Kr,onClose:Qr},fr(Qr))))},_e.PrimaryButton=zt,_e.ProgressBar=function(Ut){var dn=Ut.progress,In=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft;return pt.createElement("div",{className:Qt({"rpv-core__progress-bar":!0,"rpv-core__progress-bar--rtl":In})},pt.createElement("div",{className:"rpv-core__progress-bar-progress",style:{width:"".concat(dn,"%")}},dn,"%"))},_e.Separator=function(){return pt.createElement("div",{className:"rpv-core__separator"})},_e.Spinner=Ht,_e.Splitter=function(Ut){var dn=Ut.constrain,In=pt.useContext(Mt).direction===_e.TextDirection.RightToLeft,$n=pt.useRef(),Zn=pt.useRef(),Jn=pt.useRef(),fr=pt.useRef(0),sr=pt.useRef(0),Un=pt.useRef(0),pr=pt.useRef(0),ur={capture:!0},zr=function(Br){var Qr=$n.current,Kr=Zn.current,Or=Jn.current;if(Qr&&Kr&&Or){var Js=pr.current,Ns=Br.clientX-fr.current,Is=Un.current+(In?-Ns:Ns),Vs=Qr.parentElement.getBoundingClientRect().width,Es=100*Is/Vs;if(Qr.classList.add("rpv-core__splitter--resizing"),dn){var Xs=Vs-Is-Js;if(!dn({firstHalfPercentage:Es,firstHalfSize:Is,secondHalfPercentage:100*Xs/Vs,secondHalfSize:Xs}))return}Kr.style.width="".concat(Es,"%"),document.body.classList.add("rpv-core__splitter-body--resizing"),Kr.classList.add("rpv-core__splitter-sibling--resizing"),Or.classList.add("rpv-core__splitter-sibling--resizing")}},Vr=function(Br){var Qr=$n.current,Kr=Zn.current,Or=Jn.current;Qr&&Kr&&Or&&(document.body.classList.remove("rpv-core__splitter-body--resizing"),Qr.classList.remove("rpv-core__splitter--resizing"),Kr.classList.remove("rpv-core__splitter-sibling--resizing"),Or.classList.remove("rpv-core__splitter-sibling--resizing"),document.removeEventListener("mousemove",zr,ur),document.removeEventListener("mouseup",Vr,ur))};return pt.useEffect(function(){var Br=$n.current;Br&&(pr.current=Br.getBoundingClientRect().width,Zn.current=Br.previousElementSibling,Jn.current=Br.nextElementSibling)},[]),pt.createElement("div",{ref:$n,className:"rpv-core__splitter",onMouseDown:function(Br){var Qr=Zn.current;Qr&&(fr.current=Br.clientX,sr.current=Br.clientY,Un.current=Qr.getBoundingClientRect().width,document.addEventListener("mousemove",zr,ur),document.addEventListener("mouseup",Vr,ur))}})},_e.TextBox=nn,_e.ThemeContext=Mt,_e.Tooltip=function(Ut){var dn=Ut.ariaControlsSuffix,In=Ut.content,$n=Ut.offset,Zn=Ut.position,Jn=Ut.target,fr=En(!1),sr=fr.opened,Un=fr.toggle,pr=pt.useRef(),ur=pt.useRef(),zr=pt.useMemo(function(){return dn||"".concat(An())},[]);Zt(function(){pr.current&&document.activeElement&&pr.current.contains(document.activeElement)&&Br()});var Vr=function(){Un(_e.ToggleStatus.Open)},Br=function(){Un(_e.ToggleStatus.Close)};return pt.createElement(pt.Fragment,null,pt.createElement("div",{ref:pr,"aria-describedby":"rpv-core__tooltip-body-".concat(zr),onBlur:function(Qr){Qr.relatedTarget instanceof HTMLElement&&Qr.currentTarget.parentElement&&Qr.currentTarget.parentElement.contains(Qr.relatedTarget)?ur.current&&(ur.current.style.display="none"):Br()},onFocus:Vr,onMouseEnter:Vr,onMouseLeave:Br},Jn),sr&&pt.createElement(hr,{ariaControlsSuffix:zr,contentRef:ur,offset:$n,position:Zn,targetRef:pr},In()))},_e.Viewer=function(Ut){var dn=Ut.characterMap,In=Ut.defaultScale,$n=Ut.enableSmoothScroll,Zn=$n===void 0||$n,Jn=Ut.fileUrl,fr=Ut.httpHeaders,sr=fr===void 0?{}:fr,Un=Ut.initialPage,pr=Un===void 0?0:Un,ur=Ut.pageLayout,zr=Ut.initialRotation,Vr=zr===void 0?0:zr,Br=Ut.localization,Qr=Ut.plugins,Kr=Qr===void 0?[]:Qr,Or=Ut.renderError,Js=Ut.renderLoader,Ns=Ut.renderPage,Is=Ut.renderProtectedView,Vs=Ut.scrollMode,Es=Vs===void 0?_e.ScrollMode.Vertical:Vs,Xs=Ut.setRenderRange,Bs=Xs===void 0?rp:Xs,fo=Ut.transformGetDocumentParams,po=Ut.theme,_o=po===void 0?{direction:_e.TextDirection.LeftToRight,theme:"light"}:po,xo=Ut.viewMode,wo=xo===void 0?_e.ViewMode.SinglePage:xo,Io=Ut.withCredentials,Do=Io!==void 0&&Io,Yo=Ut.onDocumentAskPassword,Bo=Ut.onDocumentLoad,Lo=Bo===void 0?function(){}:Bo,Xo=Ut.onPageChange,Fo=Xo===void 0?function(){}:Xo,$a=Ut.onRotate,bu=$a===void 0?function(){}:$a,nu=Ut.onRotatePage,na=nu===void 0?function(){}:nu,Ml=Ut.onSwitchTheme,pu=Ml===void 0?function(){}:Ml,js=Ut.onZoom,Fs=js===void 0?function(){}:js,_s=pt.useState({data:Jn,name:typeof Jn=="string"?Jn:"",shouldLoad:!1}),Cs=_s[0],Ss=_s[1],Ws=function(Eo,Po){Ss({data:Po,name:Eo,shouldLoad:!0})},Zs=pt.useState(!1),ks=Zs[0],ls=Zs[1],Ys=gr(Cs);pt.useEffect(function(){var Eo,Po,Uo,Co;Eo=Ys.data,Co=typeof(Po=Jn),(Uo=typeof Eo)=="string"&&Co==="string"&&Eo===Po||Uo==="object"&&Co==="object"&&Eo.length===Po.length&&Eo.every(function(Ol,fu){return Ol===Po[fu]})||Ss({data:Jn,name:typeof Jn=="string"?Jn:"",shouldLoad:ks})},[Jn,ks]);var ao=sn({onVisibilityChanged:function(Eo){ls(Eo.isVisible),Eo.isVisible&&Ss(function(Po){return Object.assign({},Po,{shouldLoad:!0})})}}),to=typeof _o=="string"?{direction:_e.TextDirection.LeftToRight,theme:_o}:_o,Ro=pt.useState(Br||xr),$s=Ro[0],xl=Ro[1],vs={l10n:$s,setL10n:xl},ro=Object.assign({},{direction:to.direction},Pm(to.theme||"light",pu));return pt.useEffect(function(){Br&&xl(Br)},[Br]),pt.createElement(Dr.Provider,{value:vs},pt.createElement(Mt.Provider,{value:ro},pt.createElement("div",{ref:ao,className:"rpv-core__viewer rpv-core__viewer--".concat(ro.currentTheme),"data-testid":"core__viewer",style:{height:"100%",width:"100%"}},Cs.shouldLoad&&pt.createElement(Wp,{characterMap:dn,file:Cs.data,httpHeaders:sr,render:function(Eo){return pt.createElement(f_,{defaultScale:In,doc:Eo,render:function(Po,Uo){return pt.createElement(p_,{currentFile:{data:Cs.data,name:Cs.name},defaultScale:In,doc:Eo,enableSmoothScroll:Zn,initialPage:pr,initialRotation:Vr,initialScale:Uo,pageLayout:ur,pageSizes:Po,plugins:Kr,renderPage:Ns,scrollMode:Es,setRenderRange:Bs,viewMode:wo,viewerState:{file:Cs,fullScreenMode:_e.FullScreenMode.Normal,pageIndex:-1,pageHeight:Po[0].pageHeight,pageWidth:Po[0].pageWidth,pagesRotation:new Map,rotation:Vr,scale:Uo,scrollMode:Es,viewMode:wo},onDocumentLoad:Lo,onOpenFile:Ws,onPageChange:Fo,onRotate:bu,onRotatePage:na,onZoom:Fs})},scrollMode:Es,viewMode:wo})},renderError:Or,renderLoader:Js,renderProtectedView:Is,transformGetDocumentParams:fo,withCredentials:Do,onDocumentAskPassword:Yo}))))},_e.Worker=function(Ut){var dn=Ut.children,In=Ut.workerUrl;return yt.GlobalWorkerOptions.workerSrc=In,pt.createElement(pt.Fragment,null,dn)},_e.chunk=Tr,_e.classNames=Qt,_e.createStore=function(Ut){var dn=Ut||{},In={},$n=function(Jn,fr){var sr;dn=kt(kt({},dn),((sr={})[Jn]=fr,sr)),(In[Jn]||[]).forEach(function(Un){return Un(dn[Jn])})},Zn=function(Jn){return dn[Jn]};return{subscribe:function(Jn,fr){In[Jn]=(In[Jn]||[]).concat(fr)},unsubscribe:function(Jn,fr){In[Jn]=(In[Jn]||[]).filter(function(sr){return sr!==fr})},update:function(Jn,fr){$n(Jn,fr)},updateCurrentValue:function(Jn,fr){var sr=Zn(Jn);sr!==void 0&&$n(Jn,fr(sr))},get:function(Jn){return Zn(Jn)}}},_e.getDestination=Ms,_e.getPage=Ts,_e.isFullScreenEnabled=fn,_e.isMac=function(){return typeof window<"u"&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)},_e.useDebounceCallback=Sn,_e.useIntersectionObserver=sn,_e.useIsMounted=_i,_e.useIsomorphicLayoutEffect=Jt,_e.usePrevious=gr,_e.useRenderQueue=lr})(core_min);/**
 * A React component to view a PDF document
 *
 * @see https://react-pdf-viewer.dev
 * @license https://react-pdf-viewer.dev/license
 * @copyright 2019-2023 Nguyen Huu Phuoc <me@phuoc.ng>
 */lib.exports=core_min;var libExports=lib.exports;let e={data:""},t=_e=>typeof window=="object"?((_e?_e.querySelector("#_goober"):window._goober)||Object.assign((_e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:_e||e,l=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,a=/\/\*[^]*?\*\/|  +/g,n$1=/\n+/g,o=(_e,et)=>{let rt="",at="",ut="";for(let pt in _e){let yt=_e[pt];pt[0]=="@"?pt[1]=="i"?rt=pt+" "+yt+";":at+=pt[1]=="f"?o(yt,pt):pt+"{"+o(yt,pt[1]=="k"?"":et)+"}":typeof yt=="object"?at+=o(yt,et?et.replace(/([^,])+/g,ct=>pt.replace(/(^:.*)|([^,])+/g,At=>/&/.test(At)?At.replace(/&/g,ct):ct?ct+" "+At:At)):pt):yt!=null&&(pt=/^--/.test(pt)?pt:pt.replace(/[A-Z]/g,"-$&").toLowerCase(),ut+=o.p?o.p(pt,yt):pt+":"+yt+";")}return rt+(et&&ut?et+"{"+ut+"}":ut)+at},c={},s=_e=>{if(typeof _e=="object"){let et="";for(let rt in _e)et+=rt+s(_e[rt]);return et}return _e},i$1=(_e,et,rt,at,ut)=>{let pt=s(_e),yt=c[pt]||(c[pt]=(At=>{let Pt=0,kt=11;for(;Pt<At.length;)kt=101*kt+At.charCodeAt(Pt++)>>>0;return"go"+kt})(pt));if(!c[yt]){let At=pt!==_e?_e:(Pt=>{let kt,Lt,Mt=[{}];for(;kt=l.exec(Pt.replace(a,""));)kt[4]?Mt.shift():kt[3]?(Lt=kt[3].replace(n$1," ").trim(),Mt.unshift(Mt[0][Lt]=Mt[0][Lt]||{})):Mt[0][kt[1]]=kt[2].replace(n$1," ").trim();return Mt[0]})(_e);c[yt]=o(ut?{["@keyframes "+yt]:At}:At,rt?"":"."+yt)}let ct=rt&&c.g?c.g:null;return rt&&(c.g=c[yt]),((At,Pt,kt,Lt)=>{Lt?Pt.data=Pt.data.replace(Lt,At):Pt.data.indexOf(At)===-1&&(Pt.data=kt?At+Pt.data:Pt.data+At)})(c[yt],et,at,ct),yt},p=(_e,et,rt)=>_e.reduce((at,ut,pt)=>{let yt=et[pt];if(yt&&yt.call){let ct=yt(rt),At=ct&&ct.props&&ct.props.className||/^go/.test(ct)&&ct;yt=At?"."+At:ct&&typeof ct=="object"?ct.props?"":o(ct,""):ct===!1?"":ct}return at+ut+(yt??"")},"");function u$1(_e){let et=this||{},rt=_e.call?_e(et.p):_e;return i$1(rt.unshift?rt.raw?p(rt,[].slice.call(arguments,1),et.p):rt.reduce((at,ut)=>Object.assign(at,ut&&ut.call?ut(et.p):ut),{}):rt,t(et.target),et.g,et.o,et.k)}let d,f,g;u$1.bind({g:1});let h$1=u$1.bind({k:1});function m(_e,et,rt,at){o.p=et,d=_e,f=rt,g=at}function j(_e,et){let rt=this||{};return function(){let at=arguments;function ut(pt,yt){let ct=Object.assign({},pt),At=ct.className||ut.className;rt.p=Object.assign({theme:f&&f()},ct),rt.o=/ *go\d+/.test(At),ct.className=u$1.apply(rt,at)+(At?" "+At:""),et&&(ct.ref=yt);let Pt=_e;return _e[0]&&(Pt=ct.as||_e,delete ct.as),g&&Pt[0]&&g(ct),d(Pt,ct)}return et?et(ut):ut}}var W=_e=>typeof _e=="function",T=(_e,et)=>W(_e)?_e(et):_e,U=(()=>{let _e=0;return()=>(++_e).toString()})(),b=(()=>{let _e;return()=>{if(_e===void 0&&typeof window<"u"){let et=matchMedia("(prefers-reduced-motion: reduce)");_e=!et||et.matches}return _e}})(),Q=20,S=new Map,X=1e3,$=_e=>{if(S.has(_e))return;let et=setTimeout(()=>{S.delete(_e),u({type:4,toastId:_e})},X);S.set(_e,et)},J=_e=>{let et=S.get(_e);et&&clearTimeout(et)},v=(_e,et)=>{switch(et.type){case 0:return{..._e,toasts:[et.toast,..._e.toasts].slice(0,Q)};case 1:return et.toast.id&&J(et.toast.id),{..._e,toasts:_e.toasts.map(pt=>pt.id===et.toast.id?{...pt,...et.toast}:pt)};case 2:let{toast:rt}=et;return _e.toasts.find(pt=>pt.id===rt.id)?v(_e,{type:1,toast:rt}):v(_e,{type:0,toast:rt});case 3:let{toastId:at}=et;return at?$(at):_e.toasts.forEach(pt=>{$(pt.id)}),{..._e,toasts:_e.toasts.map(pt=>pt.id===at||at===void 0?{...pt,visible:!1}:pt)};case 4:return et.toastId===void 0?{..._e,toasts:[]}:{..._e,toasts:_e.toasts.filter(pt=>pt.id!==et.toastId)};case 5:return{..._e,pausedAt:et.time};case 6:let ut=et.time-(_e.pausedAt||0);return{..._e,pausedAt:void 0,toasts:_e.toasts.map(pt=>({...pt,pauseDuration:pt.pauseDuration+ut}))}}},A=[],P={toasts:[],pausedAt:void 0},u=_e=>{P=v(P,_e),A.forEach(et=>{et(P)})},Y={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},I=(_e={})=>{let[et,rt]=reactExports.useState(P);reactExports.useEffect(()=>(A.push(rt),()=>{let ut=A.indexOf(rt);ut>-1&&A.splice(ut,1)}),[et]);let at=et.toasts.map(ut=>{var pt,yt;return{..._e,..._e[ut.type],...ut,duration:ut.duration||((pt=_e[ut.type])==null?void 0:pt.duration)||(_e==null?void 0:_e.duration)||Y[ut.type],style:{..._e.style,...(yt=_e[ut.type])==null?void 0:yt.style,...ut.style}}});return{...et,toasts:at}},G=(_e,et="blank",rt)=>({createdAt:Date.now(),visible:!0,type:et,ariaProps:{role:"status","aria-live":"polite"},message:_e,pauseDuration:0,...rt,id:(rt==null?void 0:rt.id)||U()}),h=_e=>(et,rt)=>{let at=G(et,_e,rt);return u({type:2,toast:at}),at.id},n=(_e,et)=>h("blank")(_e,et);n.error=h("error");n.success=h("success");n.loading=h("loading");n.custom=h("custom");n.dismiss=_e=>{u({type:3,toastId:_e})};n.remove=_e=>u({type:4,toastId:_e});n.promise=(_e,et,rt)=>{let at=n.loading(et.loading,{...rt,...rt==null?void 0:rt.loading});return _e.then(ut=>(n.success(T(et.success,ut),{id:at,...rt,...rt==null?void 0:rt.success}),ut)).catch(ut=>{n.error(T(et.error,ut),{id:at,...rt,...rt==null?void 0:rt.error})}),_e};var Z=(_e,et)=>{u({type:1,toast:{id:_e,height:et}})},ee=()=>{u({type:5,time:Date.now()})},D=_e=>{let{toasts:et,pausedAt:rt}=I(_e);reactExports.useEffect(()=>{if(rt)return;let pt=Date.now(),yt=et.map(ct=>{if(ct.duration===1/0)return;let At=(ct.duration||0)+ct.pauseDuration-(pt-ct.createdAt);if(At<0){ct.visible&&n.dismiss(ct.id);return}return setTimeout(()=>n.dismiss(ct.id),At)});return()=>{yt.forEach(ct=>ct&&clearTimeout(ct))}},[et,rt]);let at=reactExports.useCallback(()=>{rt&&u({type:6,time:Date.now()})},[rt]),ut=reactExports.useCallback((pt,yt)=>{let{reverseOrder:ct=!1,gutter:At=8,defaultPosition:Pt}=yt||{},kt=et.filter(Qt=>(Qt.position||Pt)===(pt.position||Pt)&&Qt.height),Lt=kt.findIndex(Qt=>Qt.id===pt.id),Mt=kt.filter((Qt,Jt)=>Jt<Lt&&Qt.visible).length;return kt.filter(Qt=>Qt.visible).slice(...ct?[Mt+1]:[0,Mt]).reduce((Qt,Jt)=>Qt+(Jt.height||0)+At,0)},[et]);return{toasts:et,handlers:{updateHeight:Z,startPause:ee,endPause:at,calculateOffset:ut}}},oe=h$1`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,re$1=h$1`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,se=h$1`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,_=j("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${_e=>_e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${oe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${re$1} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${_e=>_e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${se} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,ne=h$1`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,V=j("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${_e=>_e.secondary||"#e0e0e0"};
  border-right-color: ${_e=>_e.primary||"#616161"};
  animation: ${ne} 1s linear infinite;
`,pe=h$1`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,de=h$1`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,w=j("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${_e=>_e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${pe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${de} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${_e=>_e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,ue=j("div")`
  position: absolute;
`,le=j("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Te=h$1`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,fe=j("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Te} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,M=({toast:_e})=>{let{icon:et,type:rt,iconTheme:at}=_e;return et!==void 0?typeof et=="string"?reactExports.createElement(fe,null,et):et:rt==="blank"?null:reactExports.createElement(le,null,reactExports.createElement(V,{...at}),rt!=="loading"&&reactExports.createElement(ue,null,rt==="error"?reactExports.createElement(_,{...at}):reactExports.createElement(w,{...at})))},ye=_e=>`
0% {transform: translate3d(0,${_e*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,ge=_e=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${_e*-150}%,-1px) scale(.6); opacity:0;}
`,he="0%{opacity:0;} 100%{opacity:1;}",xe="0%{opacity:1;} 100%{opacity:0;}",be=j("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Se=j("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Ae=(_e,et)=>{let rt=_e.includes("top")?1:-1,[at,ut]=b()?[he,xe]:[ye(rt),ge(rt)];return{animation:et?`${h$1(at)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${h$1(ut)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},F=reactExports.memo(({toast:_e,position:et,style:rt,children:at})=>{let ut=_e.height?Ae(_e.position||et||"top-center",_e.visible):{opacity:0},pt=reactExports.createElement(M,{toast:_e}),yt=reactExports.createElement(Se,{..._e.ariaProps},T(_e.message,_e));return reactExports.createElement(be,{className:_e.className,style:{...ut,...rt,..._e.style}},typeof at=="function"?at({icon:pt,message:yt}):reactExports.createElement(reactExports.Fragment,null,pt,yt))});m(reactExports.createElement);var Ee=({id:_e,className:et,style:rt,onHeightUpdate:at,children:ut})=>{let pt=reactExports.useCallback(yt=>{if(yt){let ct=()=>{let At=yt.getBoundingClientRect().height;at(_e,At)};ct(),new MutationObserver(ct).observe(yt,{subtree:!0,childList:!0,characterData:!0})}},[_e,at]);return reactExports.createElement("div",{ref:pt,className:et,style:rt},ut)},Re=(_e,et)=>{let rt=_e.includes("top"),at=rt?{top:0}:{bottom:0},ut=_e.includes("center")?{justifyContent:"center"}:_e.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:b()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${et*(rt?1:-1)}px)`,...at,...ut}},ve=u$1`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,O=16,Ie=({reverseOrder:_e,position:et="top-center",toastOptions:rt,gutter:at,children:ut,containerStyle:pt,containerClassName:yt})=>{let{toasts:ct,handlers:At}=D(rt);return reactExports.createElement("div",{style:{position:"fixed",zIndex:9999,top:O,left:O,right:O,bottom:O,pointerEvents:"none",...pt},className:yt,onMouseEnter:At.startPause,onMouseLeave:At.endPause},ct.map(Pt=>{let kt=Pt.position||et,Lt=At.calculateOffset(Pt,{reverseOrder:_e,gutter:at,defaultPosition:et}),Mt=Re(kt,Lt);return reactExports.createElement(Ee,{id:Pt.id,key:Pt.id,onHeightUpdate:At.updateHeight,className:Pt.visible?ve:"",style:Mt},Pt.type==="custom"?T(Pt.message,Pt):ut?ut(Pt):reactExports.createElement(F,{toast:Pt,position:kt}))}))},_t=n;const useSendMessage=()=>{const[_e,et]=reactExports.useState(!1),{messages:rt,setMessages:at,selectedConversation:ut}=useConversation();return{sendMessage:async yt=>{et(!0);try{const At=await(await fetch(`/api/messages/send/${ut._id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:yt})})).json();if(At.error)throw new Error(At.error);at([...rt,At])}catch(ct){_t.error(ct.message)}finally{et(!1)}},loading:_e}};var define_process_env_default={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(_e){const et=[];let rt=0;for(let at=0;at<_e.length;at++){let ut=_e.charCodeAt(at);ut<128?et[rt++]=ut:ut<2048?(et[rt++]=ut>>6|192,et[rt++]=ut&63|128):(ut&64512)===55296&&at+1<_e.length&&(_e.charCodeAt(at+1)&64512)===56320?(ut=65536+((ut&1023)<<10)+(_e.charCodeAt(++at)&1023),et[rt++]=ut>>18|240,et[rt++]=ut>>12&63|128,et[rt++]=ut>>6&63|128,et[rt++]=ut&63|128):(et[rt++]=ut>>12|224,et[rt++]=ut>>6&63|128,et[rt++]=ut&63|128)}return et},byteArrayToString=function(_e){const et=[];let rt=0,at=0;for(;rt<_e.length;){const ut=_e[rt++];if(ut<128)et[at++]=String.fromCharCode(ut);else if(ut>191&&ut<224){const pt=_e[rt++];et[at++]=String.fromCharCode((ut&31)<<6|pt&63)}else if(ut>239&&ut<365){const pt=_e[rt++],yt=_e[rt++],ct=_e[rt++],At=((ut&7)<<18|(pt&63)<<12|(yt&63)<<6|ct&63)-65536;et[at++]=String.fromCharCode(55296+(At>>10)),et[at++]=String.fromCharCode(56320+(At&1023))}else{const pt=_e[rt++],yt=_e[rt++];et[at++]=String.fromCharCode((ut&15)<<12|(pt&63)<<6|yt&63)}}return et.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(_e,et){if(!Array.isArray(_e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const rt=et?this.byteToCharMapWebSafe_:this.byteToCharMap_,at=[];for(let ut=0;ut<_e.length;ut+=3){const pt=_e[ut],yt=ut+1<_e.length,ct=yt?_e[ut+1]:0,At=ut+2<_e.length,Pt=At?_e[ut+2]:0,kt=pt>>2,Lt=(pt&3)<<4|ct>>4;let Mt=(ct&15)<<2|Pt>>6,Qt=Pt&63;At||(Qt=64,yt||(Mt=64)),at.push(rt[kt],rt[Lt],rt[Mt],rt[Qt])}return at.join("")},encodeString(_e,et){return this.HAS_NATIVE_SUPPORT&&!et?btoa(_e):this.encodeByteArray(stringToByteArray$1(_e),et)},decodeString(_e,et){return this.HAS_NATIVE_SUPPORT&&!et?atob(_e):byteArrayToString(this.decodeStringToByteArray(_e,et))},decodeStringToByteArray(_e,et){this.init_();const rt=et?this.charToByteMapWebSafe_:this.charToByteMap_,at=[];for(let ut=0;ut<_e.length;){const pt=rt[_e.charAt(ut++)],ct=ut<_e.length?rt[_e.charAt(ut)]:0;++ut;const Pt=ut<_e.length?rt[_e.charAt(ut)]:64;++ut;const Lt=ut<_e.length?rt[_e.charAt(ut)]:64;if(++ut,pt==null||ct==null||Pt==null||Lt==null)throw new DecodeBase64StringError;const Mt=pt<<2|ct>>4;if(at.push(Mt),Pt!==64){const Qt=ct<<4&240|Pt>>2;if(at.push(Qt),Lt!==64){const Jt=Pt<<6&192|Lt;at.push(Jt)}}}return at},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let _e=0;_e<this.ENCODED_VALS.length;_e++)this.byteToCharMap_[_e]=this.ENCODED_VALS.charAt(_e),this.charToByteMap_[this.byteToCharMap_[_e]]=_e,this.byteToCharMapWebSafe_[_e]=this.ENCODED_VALS_WEBSAFE.charAt(_e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[_e]]=_e,_e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(_e)]=_e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(_e)]=_e)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(_e){const et=stringToByteArray$1(_e);return base64.encodeByteArray(et,!0)},base64urlEncodeWithoutPadding=function(_e){return base64Encode(_e).replace(/\./g,"")},base64Decode=function(_e){try{return base64.decodeString(_e,!0)}catch(et){console.error("base64Decode failed: ",et)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof define_process_env_default>"u")return;const _e=define_process_env_default.__FIREBASE_DEFAULTS__;if(_e)return JSON.parse(_e)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let _e;try{_e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const et=_e&&base64Decode(_e[1]);return et&&JSON.parse(et)},getDefaults=()=>{try{return getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(_e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${_e}`);return}},getDefaultEmulatorHost=_e=>{var et,rt;return(rt=(et=getDefaults())===null||et===void 0?void 0:et.emulatorHosts)===null||rt===void 0?void 0:rt[_e]},getDefaultEmulatorHostnameAndPort=_e=>{const et=getDefaultEmulatorHost(_e);if(!et)return;const rt=et.lastIndexOf(":");if(rt<=0||rt+1===et.length)throw new Error(`Invalid host ${et} with no separate hostname and port!`);const at=parseInt(et.substring(rt+1),10);return et[0]==="["?[et.substring(1,rt-1),at]:[et.substring(0,rt),at]},getDefaultAppConfig=()=>{var _e;return(_e=getDefaults())===null||_e===void 0?void 0:_e.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((et,rt)=>{this.resolve=et,this.reject=rt})}wrapCallback(et){return(rt,at)=>{rt?this.reject(rt):this.resolve(at),typeof et=="function"&&(this.promise.catch(()=>{}),et.length===1?et(rt):et(rt,at))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(_e,et){if(_e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const rt={alg:"none",type:"JWT"},at=et||"demo-project",ut=_e.iat||0,pt=_e.sub||_e.user_id;if(!pt)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const yt=Object.assign({iss:`https://securetoken.google.com/${at}`,aud:at,iat:ut,exp:ut+3600,auth_time:ut,sub:pt,user_id:pt,firebase:{sign_in_provider:"custom",identities:{}}},_e);return[base64urlEncodeWithoutPadding(JSON.stringify(rt)),base64urlEncodeWithoutPadding(JSON.stringify(yt)),""].join(".")}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((_e,et)=>{try{let rt=!0;const at="validate-browser-context-for-indexeddb-analytics-module",ut=self.indexedDB.open(at);ut.onsuccess=()=>{ut.result.close(),rt||self.indexedDB.deleteDatabase(at),_e(!0)},ut.onupgradeneeded=()=>{rt=!1},ut.onerror=()=>{var pt;et(((pt=ut.error)===null||pt===void 0?void 0:pt.message)||"")}}catch(rt){et(rt)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(et,rt,at){super(rt),this.code=et,this.customData=at,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(et,rt,at){this.service=et,this.serviceName=rt,this.errors=at}create(et,...rt){const at=rt[0]||{},ut=`${this.service}/${et}`,pt=this.errors[et],yt=pt?replaceTemplate(pt,at):"Error",ct=`${this.serviceName}: ${yt} (${ut}).`;return new FirebaseError(ut,ct,at)}}function replaceTemplate(_e,et){return _e.replace(PATTERN,(rt,at)=>{const ut=et[at];return ut!=null?String(ut):`<${at}?>`})}const PATTERN=/\{\$([^}]+)}/g;function deepEqual(_e,et){if(_e===et)return!0;const rt=Object.keys(_e),at=Object.keys(et);for(const ut of rt){if(!at.includes(ut))return!1;const pt=_e[ut],yt=et[ut];if(isObject$1(pt)&&isObject$1(yt)){if(!deepEqual(pt,yt))return!1}else if(pt!==yt)return!1}for(const ut of at)if(!rt.includes(ut))return!1;return!0}function isObject$1(_e){return _e!==null&&typeof _e=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(_e){return _e&&_e._delegate?_e._delegate:_e}class Component{constructor(et,rt,at){this.name=et,this.instanceFactory=rt,this.type=at,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(et){return this.instantiationMode=et,this}setMultipleInstances(et){return this.multipleInstances=et,this}setServiceProps(et){return this.serviceProps=et,this}setInstanceCreatedCallback(et){return this.onInstanceCreated=et,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(et,rt){this.name=et,this.container=rt,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(et){const rt=this.normalizeInstanceIdentifier(et);if(!this.instancesDeferred.has(rt)){const at=new Deferred;if(this.instancesDeferred.set(rt,at),this.isInitialized(rt)||this.shouldAutoInitialize())try{const ut=this.getOrInitializeService({instanceIdentifier:rt});ut&&at.resolve(ut)}catch{}}return this.instancesDeferred.get(rt).promise}getImmediate(et){var rt;const at=this.normalizeInstanceIdentifier(et==null?void 0:et.identifier),ut=(rt=et==null?void 0:et.optional)!==null&&rt!==void 0?rt:!1;if(this.isInitialized(at)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:at})}catch(pt){if(ut)return null;throw pt}else{if(ut)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(et){if(et.name!==this.name)throw Error(`Mismatching Component ${et.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=et,!!this.shouldAutoInitialize()){if(isComponentEager(et))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[rt,at]of this.instancesDeferred.entries()){const ut=this.normalizeInstanceIdentifier(rt);try{const pt=this.getOrInitializeService({instanceIdentifier:ut});at.resolve(pt)}catch{}}}}clearInstance(et=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(et),this.instancesOptions.delete(et),this.instances.delete(et)}async delete(){const et=Array.from(this.instances.values());await Promise.all([...et.filter(rt=>"INTERNAL"in rt).map(rt=>rt.INTERNAL.delete()),...et.filter(rt=>"_delete"in rt).map(rt=>rt._delete())])}isComponentSet(){return this.component!=null}isInitialized(et=DEFAULT_ENTRY_NAME$1){return this.instances.has(et)}getOptions(et=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(et)||{}}initialize(et={}){const{options:rt={}}=et,at=this.normalizeInstanceIdentifier(et.instanceIdentifier);if(this.isInitialized(at))throw Error(`${this.name}(${at}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const ut=this.getOrInitializeService({instanceIdentifier:at,options:rt});for(const[pt,yt]of this.instancesDeferred.entries()){const ct=this.normalizeInstanceIdentifier(pt);at===ct&&yt.resolve(ut)}return ut}onInit(et,rt){var at;const ut=this.normalizeInstanceIdentifier(rt),pt=(at=this.onInitCallbacks.get(ut))!==null&&at!==void 0?at:new Set;pt.add(et),this.onInitCallbacks.set(ut,pt);const yt=this.instances.get(ut);return yt&&et(yt,ut),()=>{pt.delete(et)}}invokeOnInitCallbacks(et,rt){const at=this.onInitCallbacks.get(rt);if(at)for(const ut of at)try{ut(et,rt)}catch{}}getOrInitializeService({instanceIdentifier:et,options:rt={}}){let at=this.instances.get(et);if(!at&&this.component&&(at=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(et),options:rt}),this.instances.set(et,at),this.instancesOptions.set(et,rt),this.invokeOnInitCallbacks(at,et),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,et,at)}catch{}return at||null}normalizeInstanceIdentifier(et=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?et:DEFAULT_ENTRY_NAME$1:et}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(_e){return _e===DEFAULT_ENTRY_NAME$1?void 0:_e}function isComponentEager(_e){return _e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(et){this.name=et,this.providers=new Map}addComponent(et){const rt=this.getProvider(et.name);if(rt.isComponentSet())throw new Error(`Component ${et.name} has already been registered with ${this.name}`);rt.setComponent(et)}addOrOverwriteComponent(et){this.getProvider(et.name).isComponentSet()&&this.providers.delete(et.name),this.addComponent(et)}getProvider(et){if(this.providers.has(et))return this.providers.get(et);const rt=new Provider(et,this);return this.providers.set(et,rt),rt}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(_e){_e[_e.DEBUG=0]="DEBUG",_e[_e.VERBOSE=1]="VERBOSE",_e[_e.INFO=2]="INFO",_e[_e.WARN=3]="WARN",_e[_e.ERROR=4]="ERROR",_e[_e.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(_e,et,...rt)=>{if(et<_e.logLevel)return;const at=new Date().toISOString(),ut=ConsoleMethod[et];if(ut)console[ut](`[${at}]  ${_e.name}:`,...rt);else throw new Error(`Attempted to log a message with an invalid logType (value: ${et})`)};class Logger{constructor(et){this.name=et,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(et){if(!(et in LogLevel))throw new TypeError(`Invalid value "${et}" assigned to \`logLevel\``);this._logLevel=et}setLogLevel(et){this._logLevel=typeof et=="string"?levelStringToEnum[et]:et}get logHandler(){return this._logHandler}set logHandler(et){if(typeof et!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=et}get userLogHandler(){return this._userLogHandler}set userLogHandler(et){this._userLogHandler=et}debug(...et){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...et),this._logHandler(this,LogLevel.DEBUG,...et)}log(...et){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...et),this._logHandler(this,LogLevel.VERBOSE,...et)}info(...et){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...et),this._logHandler(this,LogLevel.INFO,...et)}warn(...et){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...et),this._logHandler(this,LogLevel.WARN,...et)}error(...et){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...et),this._logHandler(this,LogLevel.ERROR,...et)}}const instanceOfAny=(_e,et)=>et.some(rt=>_e instanceof rt);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(_e){const et=new Promise((rt,at)=>{const ut=()=>{_e.removeEventListener("success",pt),_e.removeEventListener("error",yt)},pt=()=>{rt(wrap(_e.result)),ut()},yt=()=>{at(_e.error),ut()};_e.addEventListener("success",pt),_e.addEventListener("error",yt)});return et.then(rt=>{rt instanceof IDBCursor&&cursorRequestMap.set(rt,_e)}).catch(()=>{}),reverseTransformCache.set(et,_e),et}function cacheDonePromiseForTransaction(_e){if(transactionDoneMap.has(_e))return;const et=new Promise((rt,at)=>{const ut=()=>{_e.removeEventListener("complete",pt),_e.removeEventListener("error",yt),_e.removeEventListener("abort",yt)},pt=()=>{rt(),ut()},yt=()=>{at(_e.error||new DOMException("AbortError","AbortError")),ut()};_e.addEventListener("complete",pt),_e.addEventListener("error",yt),_e.addEventListener("abort",yt)});transactionDoneMap.set(_e,et)}let idbProxyTraps={get(_e,et,rt){if(_e instanceof IDBTransaction){if(et==="done")return transactionDoneMap.get(_e);if(et==="objectStoreNames")return _e.objectStoreNames||transactionStoreNamesMap.get(_e);if(et==="store")return rt.objectStoreNames[1]?void 0:rt.objectStore(rt.objectStoreNames[0])}return wrap(_e[et])},set(_e,et,rt){return _e[et]=rt,!0},has(_e,et){return _e instanceof IDBTransaction&&(et==="done"||et==="store")?!0:et in _e}};function replaceTraps(_e){idbProxyTraps=_e(idbProxyTraps)}function wrapFunction(_e){return _e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(et,...rt){const at=_e.call(unwrap(this),et,...rt);return transactionStoreNamesMap.set(at,et.sort?et.sort():[et]),wrap(at)}:getCursorAdvanceMethods().includes(_e)?function(...et){return _e.apply(unwrap(this),et),wrap(cursorRequestMap.get(this))}:function(...et){return wrap(_e.apply(unwrap(this),et))}}function transformCachableValue(_e){return typeof _e=="function"?wrapFunction(_e):(_e instanceof IDBTransaction&&cacheDonePromiseForTransaction(_e),instanceOfAny(_e,getIdbProxyableTypes())?new Proxy(_e,idbProxyTraps):_e)}function wrap(_e){if(_e instanceof IDBRequest)return promisifyRequest(_e);if(transformCache.has(_e))return transformCache.get(_e);const et=transformCachableValue(_e);return et!==_e&&(transformCache.set(_e,et),reverseTransformCache.set(et,_e)),et}const unwrap=_e=>reverseTransformCache.get(_e);function openDB(_e,et,{blocked:rt,upgrade:at,blocking:ut,terminated:pt}={}){const yt=indexedDB.open(_e,et),ct=wrap(yt);return at&&yt.addEventListener("upgradeneeded",At=>{at(wrap(yt.result),At.oldVersion,At.newVersion,wrap(yt.transaction),At)}),rt&&yt.addEventListener("blocked",At=>rt(At.oldVersion,At.newVersion,At)),ct.then(At=>{pt&&At.addEventListener("close",()=>pt()),ut&&At.addEventListener("versionchange",Pt=>ut(Pt.oldVersion,Pt.newVersion,Pt))}).catch(()=>{}),ct}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(_e,et){if(!(_e instanceof IDBDatabase&&!(et in _e)&&typeof et=="string"))return;if(cachedMethods.get(et))return cachedMethods.get(et);const rt=et.replace(/FromIndex$/,""),at=et!==rt,ut=writeMethods.includes(rt);if(!(rt in(at?IDBIndex:IDBObjectStore).prototype)||!(ut||readMethods.includes(rt)))return;const pt=async function(yt,...ct){const At=this.transaction(yt,ut?"readwrite":"readonly");let Pt=At.store;return at&&(Pt=Pt.index(ct.shift())),(await Promise.all([Pt[rt](...ct),ut&&At.done]))[0]};return cachedMethods.set(et,pt),pt}replaceTraps(_e=>({..._e,get:(et,rt,at)=>getMethod(et,rt)||_e.get(et,rt,at),has:(et,rt)=>!!getMethod(et,rt)||_e.has(et,rt)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(et){this.container=et}getPlatformInfoString(){return this.container.getProviders().map(rt=>{if(isVersionServiceProvider(rt)){const at=rt.getImmediate();return`${at.library}/${at.version}`}else return null}).filter(rt=>rt).join(" ")}}function isVersionServiceProvider(_e){const et=_e.getComponent();return(et==null?void 0:et.type)==="VERSION"}const name$q="@firebase/app",version$1$1="0.10.17";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3="@firebase/firestore",name$2="@firebase/vertexai",name$1$1="@firebase/firestore-compat",name$r="firebase",version$2="11.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3]:"fire-fst",[name$1$1]:"fire-fst-compat",[name$2]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(_e,et){try{_e.container.addComponent(et)}catch(rt){logger.debug(`Component ${et.name} failed to register with FirebaseApp ${_e.name}`,rt)}}function _registerComponent(_e){const et=_e.name;if(_components.has(et))return logger.debug(`There were multiple attempts to register component ${et}.`),!1;_components.set(et,_e);for(const rt of _apps.values())_addComponent(rt,_e);for(const rt of _serverApps.values())_addComponent(rt,_e);return!0}function _getProvider(_e,et){const rt=_e.container.getProvider("heartbeat").getImmediate({optional:!0});return rt&&rt.triggerHeartbeat(),_e.container.getProvider(et)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(et,rt,at){this._isDeleted=!1,this._options=Object.assign({},et),this._config=Object.assign({},rt),this._name=rt.name,this._automaticDataCollectionEnabled=rt.automaticDataCollectionEnabled,this._container=at,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(et){this.checkDestroyed(),this._automaticDataCollectionEnabled=et}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(et){this._isDeleted=et}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION=version$2;function initializeApp(_e,et={}){let rt=_e;typeof et!="object"&&(et={name:et});const at=Object.assign({name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!1},et),ut=at.name;if(typeof ut!="string"||!ut)throw ERROR_FACTORY.create("bad-app-name",{appName:String(ut)});if(rt||(rt=getDefaultAppConfig()),!rt)throw ERROR_FACTORY.create("no-options");const pt=_apps.get(ut);if(pt){if(deepEqual(rt,pt.options)&&deepEqual(at,pt.config))return pt;throw ERROR_FACTORY.create("duplicate-app",{appName:ut})}const yt=new ComponentContainer(ut);for(const At of _components.values())yt.addComponent(At);const ct=new FirebaseAppImpl(rt,at,yt);return _apps.set(ut,ct),ct}function getApp(_e=DEFAULT_ENTRY_NAME){const et=_apps.get(_e);if(!et&&_e===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!et)throw ERROR_FACTORY.create("no-app",{appName:_e});return et}function registerVersion(_e,et,rt){var at;let ut=(at=PLATFORM_LOG_STRING[_e])!==null&&at!==void 0?at:_e;rt&&(ut+=`-${rt}`);const pt=ut.match(/\s|\//),yt=et.match(/\s|\//);if(pt||yt){const ct=[`Unable to register library "${ut}" with version "${et}":`];pt&&ct.push(`library name "${ut}" contains illegal characters (whitespace or "/")`),pt&&yt&&ct.push("and"),yt&&ct.push(`version name "${et}" contains illegal characters (whitespace or "/")`),logger.warn(ct.join(" "));return}_registerComponent(new Component(`${ut}-version`,()=>({library:ut,version:et}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebase-heartbeat-database",DB_VERSION=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME,DB_VERSION,{upgrade:(_e,et)=>{switch(et){case 0:try{_e.createObjectStore(STORE_NAME)}catch(rt){console.warn(rt)}}}}).catch(_e=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:_e.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(_e){try{const rt=(await getDbPromise()).transaction(STORE_NAME),at=await rt.objectStore(STORE_NAME).get(computeKey(_e));return await rt.done,at}catch(et){if(et instanceof FirebaseError)logger.warn(et.message);else{const rt=ERROR_FACTORY.create("idb-get",{originalErrorMessage:et==null?void 0:et.message});logger.warn(rt.message)}}}async function writeHeartbeatsToIndexedDB(_e,et){try{const at=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await at.objectStore(STORE_NAME).put(et,computeKey(_e)),await at.done}catch(rt){if(rt instanceof FirebaseError)logger.warn(rt.message);else{const at=ERROR_FACTORY.create("idb-set",{originalErrorMessage:rt==null?void 0:rt.message});logger.warn(at.message)}}}function computeKey(_e){return`${_e.name}!${_e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,STORED_HEARTBEAT_RETENTION_MAX_MILLIS=30*24*60*60*1e3;class HeartbeatServiceImpl{constructor(et){this.container=et,this._heartbeatsCache=null;const rt=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(rt),this._heartbeatsCachePromise=this._storage.read().then(at=>(this._heartbeatsCache=at,at))}async triggerHeartbeat(){var et,rt;try{const ut=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),pt=getUTCDateString();return((et=this._heartbeatsCache)===null||et===void 0?void 0:et.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((rt=this._heartbeatsCache)===null||rt===void 0?void 0:rt.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===pt||this._heartbeatsCache.heartbeats.some(yt=>yt.date===pt)?void 0:(this._heartbeatsCache.heartbeats.push({date:pt,agent:ut}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(yt=>{const ct=new Date(yt.date).valueOf();return Date.now()-ct<=STORED_HEARTBEAT_RETENTION_MAX_MILLIS}),this._storage.overwrite(this._heartbeatsCache))}catch(at){logger.warn(at)}}async getHeartbeatsHeader(){var et;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((et=this._heartbeatsCache)===null||et===void 0?void 0:et.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const rt=getUTCDateString(),{heartbeatsToSend:at,unsentEntries:ut}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),pt=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:at}));return this._heartbeatsCache.lastSentHeartbeatDate=rt,ut.length>0?(this._heartbeatsCache.heartbeats=ut,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),pt}catch(rt){return logger.warn(rt),""}}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(_e,et=MAX_HEADER_BYTES){const rt=[];let at=_e.slice();for(const ut of _e){const pt=rt.find(yt=>yt.agent===ut.agent);if(pt){if(pt.dates.push(ut.date),countBytes(rt)>et){pt.dates.pop();break}}else if(rt.push({agent:ut.agent,dates:[ut.date]}),countBytes(rt)>et){rt.pop();break}at=at.slice(1)}return{heartbeatsToSend:rt,unsentEntries:at}}class HeartbeatStorageImpl{constructor(et){this.app=et,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const rt=await readHeartbeatsFromIndexedDB(this.app);return rt!=null&&rt.heartbeats?rt:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(et){var rt;if(await this._canUseIndexedDBPromise){const ut=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(rt=et.lastSentHeartbeatDate)!==null&&rt!==void 0?rt:ut.lastSentHeartbeatDate,heartbeats:et.heartbeats})}else return}async add(et){var rt;if(await this._canUseIndexedDBPromise){const ut=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(rt=et.lastSentHeartbeatDate)!==null&&rt!==void 0?rt:ut.lastSentHeartbeatDate,heartbeats:[...ut.heartbeats,...et.heartbeats]})}else return}}function countBytes(_e){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:_e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(_e){_registerComponent(new Component("platform-logger",et=>new PlatformLoggerServiceImpl(et),"PRIVATE")),_registerComponent(new Component("heartbeat",et=>new HeartbeatServiceImpl(et),"PRIVATE")),registerVersion(name$q,version$1$1,_e),registerVersion(name$q,version$1$1,"esm2017"),registerVersion("fire-js","")}registerCoreComponents("");var name$1="firebase",version$1="11.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$1,version$1,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=2*60*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StorageError extends FirebaseError{constructor(et,rt,at=0){super(prependCode(et),`Firebase Storage: ${rt} (${prependCode(et)})`),this.status_=at,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(et){this.status_=et}_codeEquals(et){return prependCode(et)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(et){this.customData.serverResponse=et,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode;(function(_e){_e.UNKNOWN="unknown",_e.OBJECT_NOT_FOUND="object-not-found",_e.BUCKET_NOT_FOUND="bucket-not-found",_e.PROJECT_NOT_FOUND="project-not-found",_e.QUOTA_EXCEEDED="quota-exceeded",_e.UNAUTHENTICATED="unauthenticated",_e.UNAUTHORIZED="unauthorized",_e.UNAUTHORIZED_APP="unauthorized-app",_e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",_e.INVALID_CHECKSUM="invalid-checksum",_e.CANCELED="canceled",_e.INVALID_EVENT_NAME="invalid-event-name",_e.INVALID_URL="invalid-url",_e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",_e.NO_DEFAULT_BUCKET="no-default-bucket",_e.CANNOT_SLICE_BLOB="cannot-slice-blob",_e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",_e.NO_DOWNLOAD_URL="no-download-url",_e.INVALID_ARGUMENT="invalid-argument",_e.INVALID_ARGUMENT_COUNT="invalid-argument-count",_e.APP_DELETED="app-deleted",_e.INVALID_ROOT_OPERATION="invalid-root-operation",_e.INVALID_FORMAT="invalid-format",_e.INTERNAL_ERROR="internal-error",_e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(StorageErrorCode||(StorageErrorCode={}));function prependCode(_e){return"storage/"+_e}function unknown(){const _e="An unknown error occurred, please check the error payload for server response.";return new StorageError(StorageErrorCode.UNKNOWN,_e)}function objectNotFound(_e){return new StorageError(StorageErrorCode.OBJECT_NOT_FOUND,"Object '"+_e+"' does not exist.")}function quotaExceeded(_e){return new StorageError(StorageErrorCode.QUOTA_EXCEEDED,"Quota for bucket '"+_e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function unauthenticated(){const _e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new StorageError(StorageErrorCode.UNAUTHENTICATED,_e)}function unauthorizedApp(){return new StorageError(StorageErrorCode.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function unauthorized(_e){return new StorageError(StorageErrorCode.UNAUTHORIZED,"User does not have permission to access '"+_e+"'.")}function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}function invalidUrl(_e){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+_e+"'.")}function invalidDefaultBucket(_e){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+_e+"'.")}function noDefaultBucket(){return new StorageError(StorageErrorCode.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+CONFIG_STORAGE_BUCKET_KEY+"' property when initializing the app?")}function cannotSliceBlob(){return new StorageError(StorageErrorCode.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function noDownloadURL(){return new StorageError(StorageErrorCode.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function missingPolyFill(_e){return new StorageError(StorageErrorCode.UNSUPPORTED_ENVIRONMENT,`${_e} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function invalidArgument(_e){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,_e)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(_e){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+_e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function invalidFormat(_e,et){return new StorageError(StorageErrorCode.INVALID_FORMAT,"String does not match format '"+_e+"': "+et)}function internalError(_e){throw new StorageError(StorageErrorCode.INTERNAL_ERROR,"Internal error: "+_e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Location{constructor(et,rt){this.bucket=et,this.path_=rt}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const et=encodeURIComponent;return"/b/"+et(this.bucket)+"/o/"+et(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(et,rt){let at;try{at=Location.makeFromUrl(et,rt)}catch{return new Location(et,"")}if(at.path==="")return at;throw invalidDefaultBucket(et)}static makeFromUrl(et,rt){let at=null;const ut="([A-Za-z0-9.\\-_]+)";function pt(nn){nn.path.charAt(nn.path.length-1)==="/"&&(nn.path_=nn.path_.slice(0,-1))}const yt="(/(.*))?$",ct=new RegExp("^gs://"+ut+yt,"i"),At={bucket:1,path:3};function Pt(nn){nn.path_=decodeURIComponent(nn.path)}const kt="v[A-Za-z0-9_]+",Lt=rt.replace(/[.]/g,"\\."),Mt="(/([^?#]*).*)?$",Qt=new RegExp(`^https?://${Lt}/${kt}/b/${ut}/o${Mt}`,"i"),Jt={bucket:1,path:3},sn=rt===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":rt,tn="([^?#]*)",Bt=new RegExp(`^https?://${sn}/${ut}/${tn}`,"i"),Ht=[{regex:ct,indices:At,postModify:pt},{regex:Qt,indices:Jt,postModify:Pt},{regex:Bt,indices:{bucket:1,path:2},postModify:Pt}];for(let nn=0;nn<Ht.length;nn++){const Ot=Ht[nn],Kt=Ot.regex.exec(et);if(Kt){const mn=Kt[Ot.indices.bucket];let hn=Kt[Ot.indices.path];hn||(hn=""),at=new Location(mn,hn),Ot.postModify(at);break}}if(at==null)throw invalidUrl(et);return at}}class FailRequest{constructor(et){this.promise_=Promise.reject(et)}getPromise(){return this.promise_}cancel(et=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function start(_e,et,rt){let at=1,ut=null,pt=null,yt=!1,ct=0;function At(){return ct===2}let Pt=!1;function kt(...tn){Pt||(Pt=!0,et.apply(null,tn))}function Lt(tn){ut=setTimeout(()=>{ut=null,_e(Qt,At())},tn)}function Mt(){pt&&clearTimeout(pt)}function Qt(tn,...Bt){if(Pt){Mt();return}if(tn){Mt(),kt.call(null,tn,...Bt);return}if(At()||yt){Mt(),kt.call(null,tn,...Bt);return}at<64&&(at*=2);let Ht;ct===1?(ct=2,Ht=0):Ht=(at+Math.random())*1e3,Lt(Ht)}let Jt=!1;function sn(tn){Jt||(Jt=!0,Mt(),!Pt&&(ut!==null?(tn||(ct=2),clearTimeout(ut),Lt(0)):tn||(ct=1)))}return Lt(0),pt=setTimeout(()=>{yt=!0,sn(!0)},rt),sn}function stop(_e){_e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isJustDef(_e){return _e!==void 0}function isNonArrayObject(_e){return typeof _e=="object"&&!Array.isArray(_e)}function isString(_e){return typeof _e=="string"||_e instanceof String}function isNativeBlob(_e){return isNativeBlobDefined()&&_e instanceof Blob}function isNativeBlobDefined(){return typeof Blob<"u"}function validateNumber(_e,et,rt,at){if(at<et)throw invalidArgument(`Invalid value for '${_e}'. Expected ${et} or greater.`);if(at>rt)throw invalidArgument(`Invalid value for '${_e}'. Expected ${rt} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function makeUrl(_e,et,rt){let at=et;return rt==null&&(at=`https://${et}`),`${rt}://${at}/v0${_e}`}function makeQueryString(_e){const et=encodeURIComponent;let rt="?";for(const at in _e)if(_e.hasOwnProperty(at)){const ut=et(at)+"="+et(_e[at]);rt=rt+ut+"&"}return rt=rt.slice(0,-1),rt}var ErrorCode;(function(_e){_e[_e.NO_ERROR=0]="NO_ERROR",_e[_e.NETWORK_ERROR=1]="NETWORK_ERROR",_e[_e.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isRetryStatusCode(_e,et){const rt=_e>=500&&_e<600,ut=[408,429].indexOf(_e)!==-1,pt=et.indexOf(_e)!==-1;return rt||ut||pt}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NetworkRequest{constructor(et,rt,at,ut,pt,yt,ct,At,Pt,kt,Lt,Mt=!0){this.url_=et,this.method_=rt,this.headers_=at,this.body_=ut,this.successCodes_=pt,this.additionalRetryCodes_=yt,this.callback_=ct,this.errorCallback_=At,this.timeout_=Pt,this.progressCallback_=kt,this.connectionFactory_=Lt,this.retry=Mt,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Qt,Jt)=>{this.resolve_=Qt,this.reject_=Jt,this.start_()})}start_(){const et=(at,ut)=>{if(ut){at(!1,new RequestEndStatus(!1,null,!0));return}const pt=this.connectionFactory_();this.pendingConnection_=pt;const yt=ct=>{const At=ct.loaded,Pt=ct.lengthComputable?ct.total:-1;this.progressCallback_!==null&&this.progressCallback_(At,Pt)};this.progressCallback_!==null&&pt.addUploadProgressListener(yt),pt.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&pt.removeUploadProgressListener(yt),this.pendingConnection_=null;const ct=pt.getErrorCode()===ErrorCode.NO_ERROR,At=pt.getStatus();if(!ct||isRetryStatusCode(At,this.additionalRetryCodes_)&&this.retry){const kt=pt.getErrorCode()===ErrorCode.ABORT;at(!1,new RequestEndStatus(!1,null,kt));return}const Pt=this.successCodes_.indexOf(At)!==-1;at(!0,new RequestEndStatus(Pt,pt))})},rt=(at,ut)=>{const pt=this.resolve_,yt=this.reject_,ct=ut.connection;if(ut.wasSuccessCode)try{const At=this.callback_(ct,ct.getResponse());isJustDef(At)?pt(At):pt()}catch(At){yt(At)}else if(ct!==null){const At=unknown();At.serverResponse=ct.getErrorText(),this.errorCallback_?yt(this.errorCallback_(ct,At)):yt(At)}else if(ut.canceled){const At=this.appDelete_?appDeleted():canceled();yt(At)}else{const At=retryLimitExceeded();yt(At)}};this.canceled_?rt(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(et,rt,this.timeout_)}getPromise(){return this.promise_}cancel(et){this.canceled_=!0,this.appDelete_=et||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RequestEndStatus{constructor(et,rt,at){this.wasSuccessCode=et,this.connection=rt,this.canceled=!!at}}function addAuthHeader_(_e,et){et!==null&&et.length>0&&(_e.Authorization="Firebase "+et)}function addVersionHeader_(_e,et){_e["X-Firebase-Storage-Version"]="webjs/"+(et??"AppManager")}function addGmpidHeader_(_e,et){et&&(_e["X-Firebase-GMPID"]=et)}function addAppCheckHeader_(_e,et){et!==null&&(_e["X-Firebase-AppCheck"]=et)}function makeRequest(_e,et,rt,at,ut,pt,yt=!0){const ct=makeQueryString(_e.urlParams),At=_e.url+ct,Pt=Object.assign({},_e.headers);return addGmpidHeader_(Pt,et),addAuthHeader_(Pt,rt),addVersionHeader_(Pt,pt),addAppCheckHeader_(Pt,at),new NetworkRequest(At,_e.method,Pt,_e.body,_e.successCodes,_e.additionalRetryCodes,_e.handler,_e.errorHandler,_e.timeout,_e.progressCallback,ut,yt)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getBlobBuilder(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function getBlob$1(..._e){const et=getBlobBuilder();if(et!==void 0){const rt=new et;for(let at=0;at<_e.length;at++)rt.append(_e[at]);return rt.getBlob()}else{if(isNativeBlobDefined())return new Blob(_e);throw new StorageError(StorageErrorCode.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function sliceBlob(_e,et,rt){return _e.webkitSlice?_e.webkitSlice(et,rt):_e.mozSlice?_e.mozSlice(et,rt):_e.slice?_e.slice(et,rt):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodeBase64(_e){if(typeof atob>"u")throw missingPolyFill("base-64");return atob(_e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const StringFormat={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class StringData{constructor(et,rt){this.data=et,this.contentType=rt||null}}function dataFromString(_e,et){switch(_e){case StringFormat.RAW:return new StringData(utf8Bytes_(et));case StringFormat.BASE64:case StringFormat.BASE64URL:return new StringData(base64Bytes_(_e,et));case StringFormat.DATA_URL:return new StringData(dataURLBytes_(et),dataURLContentType_(et))}throw unknown()}function utf8Bytes_(_e){const et=[];for(let rt=0;rt<_e.length;rt++){let at=_e.charCodeAt(rt);if(at<=127)et.push(at);else if(at<=2047)et.push(192|at>>6,128|at&63);else if((at&64512)===55296)if(!(rt<_e.length-1&&(_e.charCodeAt(rt+1)&64512)===56320))et.push(239,191,189);else{const pt=at,yt=_e.charCodeAt(++rt);at=65536|(pt&1023)<<10|yt&1023,et.push(240|at>>18,128|at>>12&63,128|at>>6&63,128|at&63)}else(at&64512)===56320?et.push(239,191,189):et.push(224|at>>12,128|at>>6&63,128|at&63)}return new Uint8Array(et)}function percentEncodedBytes_(_e){let et;try{et=decodeURIComponent(_e)}catch{throw invalidFormat(StringFormat.DATA_URL,"Malformed data URL.")}return utf8Bytes_(et)}function base64Bytes_(_e,et){switch(_e){case StringFormat.BASE64:{const ut=et.indexOf("-")!==-1,pt=et.indexOf("_")!==-1;if(ut||pt)throw invalidFormat(_e,"Invalid character '"+(ut?"-":"_")+"' found: is it base64url encoded?");break}case StringFormat.BASE64URL:{const ut=et.indexOf("+")!==-1,pt=et.indexOf("/")!==-1;if(ut||pt)throw invalidFormat(_e,"Invalid character '"+(ut?"+":"/")+"' found: is it base64 encoded?");et=et.replace(/-/g,"+").replace(/_/g,"/");break}}let rt;try{rt=decodeBase64(et)}catch(ut){throw ut.message.includes("polyfill")?ut:invalidFormat(_e,"Invalid character found")}const at=new Uint8Array(rt.length);for(let ut=0;ut<rt.length;ut++)at[ut]=rt.charCodeAt(ut);return at}class DataURLParts{constructor(et){this.base64=!1,this.contentType=null;const rt=et.match(/^data:([^,]+)?,/);if(rt===null)throw invalidFormat(StringFormat.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const at=rt[1]||null;at!=null&&(this.base64=endsWith(at,";base64"),this.contentType=this.base64?at.substring(0,at.length-7):at),this.rest=et.substring(et.indexOf(",")+1)}}function dataURLBytes_(_e){const et=new DataURLParts(_e);return et.base64?base64Bytes_(StringFormat.BASE64,et.rest):percentEncodedBytes_(et.rest)}function dataURLContentType_(_e){return new DataURLParts(_e).contentType}function endsWith(_e,et){return _e.length>=et.length?_e.substring(_e.length-et.length)===et:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FbsBlob{constructor(et,rt){let at=0,ut="";isNativeBlob(et)?(this.data_=et,at=et.size,ut=et.type):et instanceof ArrayBuffer?(rt?this.data_=new Uint8Array(et):(this.data_=new Uint8Array(et.byteLength),this.data_.set(new Uint8Array(et))),at=this.data_.length):et instanceof Uint8Array&&(rt?this.data_=et:(this.data_=new Uint8Array(et.length),this.data_.set(et)),at=et.length),this.size_=at,this.type_=ut}size(){return this.size_}type(){return this.type_}slice(et,rt){if(isNativeBlob(this.data_)){const at=this.data_,ut=sliceBlob(at,et,rt);return ut===null?null:new FbsBlob(ut)}else{const at=new Uint8Array(this.data_.buffer,et,rt-et);return new FbsBlob(at,!0)}}static getBlob(...et){if(isNativeBlobDefined()){const rt=et.map(at=>at instanceof FbsBlob?at.data_:at);return new FbsBlob(getBlob$1.apply(null,rt))}else{const rt=et.map(yt=>isString(yt)?dataFromString(StringFormat.RAW,yt).data:yt.data_);let at=0;rt.forEach(yt=>{at+=yt.byteLength});const ut=new Uint8Array(at);let pt=0;return rt.forEach(yt=>{for(let ct=0;ct<yt.length;ct++)ut[pt++]=yt[ct]}),new FbsBlob(ut,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jsonObjectOrNull(_e){let et;try{et=JSON.parse(_e)}catch{return null}return isNonArrayObject(et)?et:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parent(_e){if(_e.length===0)return null;const et=_e.lastIndexOf("/");return et===-1?"":_e.slice(0,et)}function child(_e,et){const rt=et.split("/").filter(at=>at.length>0).join("/");return _e.length===0?rt:_e+"/"+rt}function lastComponent(_e){const et=_e.lastIndexOf("/",_e.length-2);return et===-1?_e:_e.slice(et+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function noXform_(_e,et){return et}class Mapping{constructor(et,rt,at,ut){this.server=et,this.local=rt||et,this.writable=!!at,this.xform=ut||noXform_}}let mappings_=null;function xformPath(_e){return!isString(_e)||_e.length<2?_e:lastComponent(_e)}function getMappings(){if(mappings_)return mappings_;const _e=[];_e.push(new Mapping("bucket")),_e.push(new Mapping("generation")),_e.push(new Mapping("metageneration")),_e.push(new Mapping("name","fullPath",!0));function et(pt,yt){return xformPath(yt)}const rt=new Mapping("name");rt.xform=et,_e.push(rt);function at(pt,yt){return yt!==void 0?Number(yt):yt}const ut=new Mapping("size");return ut.xform=at,_e.push(ut),_e.push(new Mapping("timeCreated")),_e.push(new Mapping("updated")),_e.push(new Mapping("md5Hash",null,!0)),_e.push(new Mapping("cacheControl",null,!0)),_e.push(new Mapping("contentDisposition",null,!0)),_e.push(new Mapping("contentEncoding",null,!0)),_e.push(new Mapping("contentLanguage",null,!0)),_e.push(new Mapping("contentType",null,!0)),_e.push(new Mapping("metadata","customMetadata",!0)),mappings_=_e,mappings_}function addRef(_e,et){function rt(){const at=_e.bucket,ut=_e.fullPath,pt=new Location(at,ut);return et._makeStorageReference(pt)}Object.defineProperty(_e,"ref",{get:rt})}function fromResource(_e,et,rt){const at={};at.type="file";const ut=rt.length;for(let pt=0;pt<ut;pt++){const yt=rt[pt];at[yt.local]=yt.xform(at,et[yt.server])}return addRef(at,_e),at}function fromResourceString(_e,et,rt){const at=jsonObjectOrNull(et);return at===null?null:fromResource(_e,at,rt)}function downloadUrlFromResourceString(_e,et,rt,at){const ut=jsonObjectOrNull(et);if(ut===null||!isString(ut.downloadTokens))return null;const pt=ut.downloadTokens;if(pt.length===0)return null;const yt=encodeURIComponent;return pt.split(",").map(Pt=>{const kt=_e.bucket,Lt=_e.fullPath,Mt="/b/"+yt(kt)+"/o/"+yt(Lt),Qt=makeUrl(Mt,rt,at),Jt=makeQueryString({alt:"media",token:Pt});return Qt+Jt})[0]}function toResourceString(_e,et){const rt={},at=et.length;for(let ut=0;ut<at;ut++){const pt=et[ut];pt.writable&&(rt[pt.server]=_e[pt.local])}return JSON.stringify(rt)}class RequestInfo{constructor(et,rt,at,ut){this.url=et,this.method=rt,this.handler=at,this.timeout=ut,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function handlerCheck(_e){if(!_e)throw unknown()}function metadataHandler(_e,et){function rt(at,ut){const pt=fromResourceString(_e,ut,et);return handlerCheck(pt!==null),pt}return rt}function downloadUrlHandler(_e,et){function rt(at,ut){const pt=fromResourceString(_e,ut,et);return handlerCheck(pt!==null),downloadUrlFromResourceString(pt,ut,_e.host,_e._protocol)}return rt}function sharedErrorHandler(_e){function et(rt,at){let ut;return rt.getStatus()===401?rt.getErrorText().includes("Firebase App Check token is invalid")?ut=unauthorizedApp():ut=unauthenticated():rt.getStatus()===402?ut=quotaExceeded(_e.bucket):rt.getStatus()===403?ut=unauthorized(_e.path):ut=at,ut.status=rt.getStatus(),ut.serverResponse=at.serverResponse,ut}return et}function objectErrorHandler(_e){const et=sharedErrorHandler(_e);function rt(at,ut){let pt=et(at,ut);return at.getStatus()===404&&(pt=objectNotFound(_e.path)),pt.serverResponse=ut.serverResponse,pt}return rt}function getDownloadUrl(_e,et,rt){const at=et.fullServerUrl(),ut=makeUrl(at,_e.host,_e._protocol),pt="GET",yt=_e.maxOperationRetryTime,ct=new RequestInfo(ut,pt,downloadUrlHandler(_e,rt),yt);return ct.errorHandler=objectErrorHandler(et),ct}function determineContentType_(_e,et){return _e&&_e.contentType||et&&et.type()||"application/octet-stream"}function metadataForUpload_(_e,et,rt){const at=Object.assign({},rt);return at.fullPath=_e.path,at.size=et.size(),at.contentType||(at.contentType=determineContentType_(null,et)),at}function multipartUpload(_e,et,rt,at,ut){const pt=et.bucketOnlyServerUrl(),yt={"X-Goog-Upload-Protocol":"multipart"};function ct(){let Ht="";for(let nn=0;nn<2;nn++)Ht=Ht+Math.random().toString().slice(2);return Ht}const At=ct();yt["Content-Type"]="multipart/related; boundary="+At;const Pt=metadataForUpload_(et,at,ut),kt=toResourceString(Pt,rt),Lt="--"+At+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+kt+`\r
--`+At+`\r
Content-Type: `+Pt.contentType+`\r
\r
`,Mt=`\r
--`+At+"--",Qt=FbsBlob.getBlob(Lt,at,Mt);if(Qt===null)throw cannotSliceBlob();const Jt={name:Pt.fullPath},sn=makeUrl(pt,_e.host,_e._protocol),tn="POST",Bt=_e.maxUploadRetryTime,zt=new RequestInfo(sn,tn,metadataHandler(_e,rt),Bt);return zt.urlParams=Jt,zt.headers=yt,zt.body=Qt.uploadData(),zt.errorHandler=sharedErrorHandler(et),zt}class XhrConnection{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ErrorCode.NO_ERROR,this.sendPromise_=new Promise(et=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ErrorCode.ABORT,et()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ErrorCode.NETWORK_ERROR,et()}),this.xhr_.addEventListener("load",()=>{et()})})}send(et,rt,at,ut){if(this.sent_)throw internalError("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(rt,et,!0),ut!==void 0)for(const pt in ut)ut.hasOwnProperty(pt)&&this.xhr_.setRequestHeader(pt,ut[pt].toString());return at!==void 0?this.xhr_.send(at):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw internalError("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw internalError("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw internalError("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw internalError("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(et){return this.xhr_.getResponseHeader(et)}addUploadProgressListener(et){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",et)}removeUploadProgressListener(et){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",et)}}class XhrTextConnection extends XhrConnection{initXhr(){this.xhr_.responseType="text"}}function newTextConnection(){return new XhrTextConnection}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Reference{constructor(et,rt){this._service=et,rt instanceof Location?this._location=rt:this._location=Location.makeFromUrl(rt,et.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(et,rt){return new Reference(et,rt)}get root(){const et=new Location(this._location.bucket,"");return this._newRef(this._service,et)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const et=parent(this._location.path);if(et===null)return null;const rt=new Location(this._location.bucket,et);return new Reference(this._service,rt)}_throwIfRoot(et){if(this._location.path==="")throw invalidRootOperation(et)}}function uploadBytes$1(_e,et,rt){_e._throwIfRoot("uploadBytes");const at=multipartUpload(_e.storage,_e._location,getMappings(),new FbsBlob(et,!0),rt);return _e.storage.makeRequestWithTokens(at,newTextConnection).then(ut=>({metadata:ut,ref:_e}))}function getDownloadURL$1(_e){_e._throwIfRoot("getDownloadURL");const et=getDownloadUrl(_e.storage,_e._location,getMappings());return _e.storage.makeRequestWithTokens(et,newTextConnection).then(rt=>{if(rt===null)throw noDownloadURL();return rt})}function _getChild$1(_e,et){const rt=child(_e._location.path,et),at=new Location(_e._location.bucket,rt);return new Reference(_e.storage,at)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isUrl(_e){return/^[A-Za-z]+:\/\//.test(_e)}function refFromURL(_e,et){return new Reference(_e,et)}function refFromPath(_e,et){if(_e instanceof FirebaseStorageImpl){const rt=_e;if(rt._bucket==null)throw noDefaultBucket();const at=new Reference(rt,rt._bucket);return et!=null?refFromPath(at,et):at}else return et!==void 0?_getChild$1(_e,et):_e}function ref$1(_e,et){if(et&&isUrl(et)){if(_e instanceof FirebaseStorageImpl)return refFromURL(_e,et);throw invalidArgument("To use ref(service, url), the first argument must be a Storage instance.")}else return refFromPath(_e,et)}function extractBucket(_e,et){const rt=et==null?void 0:et[CONFIG_STORAGE_BUCKET_KEY];return rt==null?null:Location.makeFromBucketSpec(rt,_e)}function connectStorageEmulator$1(_e,et,rt,at={}){_e.host=`${et}:${rt}`,_e._protocol="http";const{mockUserToken:ut}=at;ut&&(_e._overrideAuthToken=typeof ut=="string"?ut:createMockUserToken(ut,_e.app.options.projectId))}class FirebaseStorageImpl{constructor(et,rt,at,ut,pt){this.app=et,this._authProvider=rt,this._appCheckProvider=at,this._url=ut,this._firebaseVersion=pt,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,ut!=null?this._bucket=Location.makeFromBucketSpec(ut,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(et){this._host=et,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,et):this._bucket=extractBucket(et,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(et){validateNumber("time",0,Number.POSITIVE_INFINITY,et),this._maxUploadRetryTime=et}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(et){validateNumber("time",0,Number.POSITIVE_INFINITY,et),this._maxOperationRetryTime=et}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const et=this._authProvider.getImmediate({optional:!0});if(et){const rt=await et.getToken();if(rt!==null)return rt.accessToken}return null}async _getAppCheckToken(){const et=this._appCheckProvider.getImmediate({optional:!0});return et?(await et.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(et=>et.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(et){return new Reference(this,et)}_makeRequest(et,rt,at,ut,pt=!0){if(this._deleted)return new FailRequest(appDeleted());{const yt=makeRequest(et,this._appId,at,ut,rt,this._firebaseVersion,pt);return this._requests.add(yt),yt.getPromise().then(()=>this._requests.delete(yt),()=>this._requests.delete(yt)),yt}}async makeRequestWithTokens(et,rt){const[at,ut]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(et,rt,at,ut).getPromise()}}const name="@firebase/storage",version="0.13.4";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const STORAGE_TYPE="storage";function uploadBytes(_e,et,rt){return _e=getModularInstance(_e),uploadBytes$1(_e,et,rt)}function getDownloadURL(_e){return _e=getModularInstance(_e),getDownloadURL$1(_e)}function ref(_e,et){return _e=getModularInstance(_e),ref$1(_e,et)}function getStorage(_e=getApp(),et){_e=getModularInstance(_e);const at=_getProvider(_e,STORAGE_TYPE).getImmediate({identifier:et}),ut=getDefaultEmulatorHostnameAndPort("storage");return ut&&connectStorageEmulator(at,...ut),at}function connectStorageEmulator(_e,et,rt,at={}){connectStorageEmulator$1(_e,et,rt,at)}function factory(_e,{instanceIdentifier:et}){const rt=_e.getProvider("app").getImmediate(),at=_e.getProvider("auth-internal"),ut=_e.getProvider("app-check-internal");return new FirebaseStorageImpl(rt,at,ut,et,SDK_VERSION)}function registerStorage(){_registerComponent(new Component(STORAGE_TYPE,factory,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version,""),registerVersion(name,version,"esm2017")}registerStorage();const firebaseConfig={apiKey:"AIzaSyCN-j--c24WDwOj7E-BPlq7KnYBSKQEYkg",authDomain:"college-management-19336.firebaseapp.com",projectId:"college-management-19336",storageBucket:"college-management-19336.appspot.com",messagingSenderId:"793585418128",appId:"1:793585418128:web:97cac6ff6593e3a7c7bd15"},app=initializeApp(firebaseConfig),storage=getStorage(app),byteToHex=[];for(let _e=0;_e<256;++_e)byteToHex.push((_e+256).toString(16).slice(1));function unsafeStringify(_e,et=0){return(byteToHex[_e[et+0]]+byteToHex[_e[et+1]]+byteToHex[_e[et+2]]+byteToHex[_e[et+3]]+"-"+byteToHex[_e[et+4]]+byteToHex[_e[et+5]]+"-"+byteToHex[_e[et+6]]+byteToHex[_e[et+7]]+"-"+byteToHex[_e[et+8]]+byteToHex[_e[et+9]]+"-"+byteToHex[_e[et+10]]+byteToHex[_e[et+11]]+byteToHex[_e[et+12]]+byteToHex[_e[et+13]]+byteToHex[_e[et+14]]+byteToHex[_e[et+15]]).toLowerCase()}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");getRandomValues=crypto.getRandomValues.bind(crypto)}return getRandomValues(rnds8)}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(_e,et,rt){if(native.randomUUID&&!et&&!_e)return native.randomUUID();_e=_e||{};const at=_e.random||(_e.rng||rng)();if(at[6]=at[6]&15|64,at[8]=at[8]&63|128,et){rt=rt||0;for(let ut=0;ut<16;++ut)et[rt+ut]=at[ut];return et}return unsafeStringify(at)}const AuthContext=reactExports.createContext(),useAuthContext=()=>reactExports.useContext(AuthContext),AuthContextProvider=({children:_e})=>{const[et,rt]=reactExports.useState(JSON.parse(localStorage.getItem("chat-user"))||null);return jsxRuntimeExports.jsx(AuthContext.Provider,{value:{authUser:et,setAuthUser:rt},children:_e})};function IoMdAddCircle(_e){return GenIcon({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 48C141.125 48 48 141.125 48 256s93.125 208 208 208 208-93.125 208-208S370.875 48 256 48zm107 229h-86v86h-42v-86h-86v-42h86v-86h42v86h86v42z"},child:[]}]})(_e)}const MessageInput=()=>{const[_e,et]=reactExports.useState(""),[rt,at]=reactExports.useState([]),[ut,pt]=reactExports.useState(0),[yt,ct]=reactExports.useState(!1),{selectedConversation:At}=useConversation(),{authUser:Pt}=useAuthContext(),[kt,Lt]=reactExports.useState({paperSize:"A4",copies:1}),{loading:Mt,sendMessage:Qt}=useSendMessage(),Jt=nn=>{const Kt=Array.from(nn.target.files).map(mn=>({file:mn,preview:mn.type.startsWith("image/")?URL.createObjectURL(mn):null,textContent:null}));Kt.forEach((mn,hn)=>{if(mn.file.type==="text/plain"){const Yt=new FileReader;Yt.onload=()=>{Kt[hn].textContent=Yt.result,at([...Kt])},Yt.readAsText(mn.file)}}),at(Kt),ct(!0),pt(0)},sn=nn=>{const{name:Ot,value:Kt}=nn.target;Lt(mn=>({...mn,[Ot]:Kt}))},tn=async nn=>{nn.preventDefault(),_e&&(await Qt(_e),et(""))},Bt=async()=>{const nn=[];try{for(const mn of rt){const hn=mn.file,Yt=ref(storage,`files/${hn.name}-${v4()}`),vn=await uploadBytes(Yt,hn),fn=await getDownloadURL(vn.ref);nn.push({file_url:fn,paper_size:kt.paperSize,copies:kt.copies})}const Ot=await fetch("/api/files/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(nn)});if(!Ot.ok)throw new Error(`HTTP error! status: ${Ot.status}`);const Kt=await Ot.json();if(console.log("Files uploaded successfully to the server:",Kt.map(mn=>mn.file_url)),Kt){const mn={userId:Pt._id,pdfId:[],quantity:0,shopId:At._id};mn.pdfId=Kt.map(Yt=>Yt.file_url.toString()),mn.quantity=kt.copies,console.log("Order body:",mn),await Qt("ThisIsAFileCode"+JSON.stringify(Kt));const hn=await fetch("/api/users/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(mn)});console.log("Order created successfully:",hn)}}catch(Ot){console.error("Error uploading files:",Ot)}},zt=()=>{ct(!1),at([])},Ht=nn=>{pt(nn==="prev"?Ot=>Ot===0?rt.length-1:Ot-1:Ot=>Ot===rt.length-1?0:Ot+1)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("form",{className:"px-4 my-3",onSubmit:tn,children:jsxRuntimeExports.jsxs("div",{className:"w-full relative",children:[jsxRuntimeExports.jsx("input",{type:"text",className:"border text-sm rounded-lg block w-full p-2.5 pr-20 bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Send a message",value:_e,onChange:nn=>et(nn.target.value)}),jsxRuntimeExports.jsxs("div",{className:"absolute inset-y-0 end-0 flex items-center pe-3 gap-3",children:[jsxRuntimeExports.jsxs("label",{htmlFor:"file-upload",className:"flex items-center justify-center cursor-pointer text-gray-400 hover:text-blue-500",children:[jsxRuntimeExports.jsx(IoMdAddCircle,{}),jsxRuntimeExports.jsx("input",{id:"file-upload",type:"file",multiple:!0,className:"hidden",onChange:Jt})]}),jsxRuntimeExports.jsx("button",{type:"submit",className:"flex items-center justify-center text-gray-400 hover:text-blue-500",children:Mt?jsxRuntimeExports.jsx("div",{className:"loading loading-spinner"}):jsxRuntimeExports.jsx(BsSend,{className:"text-lg"})})]})]})}),yt&&rt.length>0&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-gray-800 z-50 text-white rounded-lg p-5 w-96",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold",children:"File Options"}),jsxRuntimeExports.jsx("button",{onClick:zt,className:"text-gray-400 hover:text-red-500",children:jsxRuntimeExports.jsx(BsX,{className:"text-xl"})})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm mb-2 truncate",children:[jsxRuntimeExports.jsx("strong",{children:"File:"})," ",rt[ut].file.name]}),jsxRuntimeExports.jsx("div",{className:"mb-4 h-[30vh] overflow-auto border border-gray-600 rounded-lg bg-gray-700",children:rt[ut].file.type.startsWith("image/")?jsxRuntimeExports.jsx("img",{src:rt[ut].preview,alt:"Preview",className:"w-full h-auto rounded-t-lg"}):rt[ut].file.type==="application/pdf"?jsxRuntimeExports.jsx(libExports.Worker,{workerUrl:"https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js",children:jsxRuntimeExports.jsx(libExports.Viewer,{fileUrl:URL.createObjectURL(rt[ut].file),className:"w-full h-[28vh]"})}):rt[ut].textContent?jsxRuntimeExports.jsx("textarea",{value:rt[ut].textContent,readOnly:!0,className:"w-full h-[28vh] bg-gray-700 border-none text-white p-2"}):jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400 p-2",children:"No preview available for this file type."})}),rt.length>1&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ht("prev"),className:"bg-gray-700 hover:bg-gray-600 text-white rounded-lg px-3 py-1",children:jsxRuntimeExports.jsx(BsChevronLeft,{})}),jsxRuntimeExports.jsx("button",{onClick:()=>Ht("next"),className:"bg-gray-700 hover:bg-gray-600 text-white rounded-lg px-3 py-1",children:jsxRuntimeExports.jsx(BsChevronRight,{})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm mb-1",children:"Paper Size"}),jsxRuntimeExports.jsxs("select",{name:"paperSize",value:kt.paperSize,onChange:sn,className:"block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white",children:[jsxRuntimeExports.jsx("option",{value:"A4",children:"A4"}),jsxRuntimeExports.jsx("option",{value:"A3",children:"A3"}),jsxRuntimeExports.jsx("option",{value:"Letter",children:"Letter"})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm mb-1",children:"Number of Copies"}),jsxRuntimeExports.jsx("input",{type:"number",name:"copies",value:kt.copies,min:"1",onChange:sn,className:"block w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{alert(`Printing ${kt.copies} copies on ${kt.paperSize} paper.`),zt(),Bt()},className:"w-full bg-blue-500 hover:bg-blue-600 text-white rounded-lg py-2",children:"Create Print Order"})]})]})})]})},useGetMessages=()=>{const[_e,et]=reactExports.useState(!1),{messages:rt,setMessages:at,selectedConversation:ut}=useConversation();return reactExports.useEffect(()=>{const pt=async()=>{et(!0);try{const ct=await(await fetch(`/api/messages/${ut._id}`)).json();if(ct.error)throw new Error(ct.error);at(ct)}catch(yt){_t.error(yt.message)}finally{et(!1)}};ut!=null&&ut._id&&pt()},[ut==null?void 0:ut._id,at]),{messages:rt,loading:_e}},MessageSkeleton=()=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-3 items-center",children:[jsxRuntimeExports.jsx("div",{className:"skeleton w-10 h-10 rounded-full shrink-0"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1",children:[jsxRuntimeExports.jsx("div",{className:"skeleton h-4 w-40"}),jsxRuntimeExports.jsx("div",{className:"skeleton h-4 w-40"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 items-center justify-end",children:[jsxRuntimeExports.jsx("div",{className:"flex flex-col gap-1",children:jsxRuntimeExports.jsx("div",{className:"skeleton h-4 w-40"})}),jsxRuntimeExports.jsx("div",{className:"skeleton w-10 h-10 rounded-full shrink-0"})]})]});function extractTime(_e){const et=new Date(_e),rt=padZero(et.getHours()),at=padZero(et.getMinutes());return`${rt}:${at}`}function padZero(_e){return _e.toString().padStart(2,"0")}const Message=({message:_e})=>{const{authUser:et}=useAuthContext(),{selectedConversation:rt}=useConversation(),at=_e.senderId===et._id,ut=extractTime(_e.createdAt),pt=at?"chat-end":"chat-start",yt=at?et.profilePic:rt==null?void 0:rt.profilePic,ct=at?"bg-blue-500":"",At=_e.shouldShake?"shake":"";return reactExports.useEffect(()=>{(async()=>{try{const Lt=await(await fetch(`/api/messages/${_e._id}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();console.log("updateMessage data",Lt)}catch(kt){console.error("Error in updateMessage:",kt)}})()},[]),jsxRuntimeExports.jsxs("div",{className:`chat ${pt}`,children:[jsxRuntimeExports.jsx("div",{className:"chat-image avatar",children:jsxRuntimeExports.jsx("div",{className:"w-10 rounded-full",children:jsxRuntimeExports.jsx("img",{alt:"Profile Pic",src:yt})})}),jsxRuntimeExports.jsx("div",{className:`chat-bubble text-white ${ct} ${At} pb-2`,children:_e.message.startsWith("ThisIsAFileCode")?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{children:"  Order Created"}),jsxRuntimeExports.jsx("div",{className:"flex flex-col gap-2",children:JSON.parse(_e.message.replace("ThisIsAFileCode","")).map((Pt,kt)=>jsxRuntimeExports.jsxs("div",{className:"mt-2 bg-white overflow-hidden h-52 relative flex w-44 md:w-72 lg:w-72 rounded-t-xl rounded-b-lg",children:[jsxRuntimeExports.jsx("div",{className:"absolute ",children:Pt.file_url&&(Pt.file_url.includes(".jpg")||Pt.file_url.includes(".jpeg")||Pt.file_url.includes(".png")||Pt.file_url.includes(".gif")?jsxRuntimeExports.jsx("img",{src:Pt.file_url,alt:"Uploaded Preview",className:" cursor-pointer h-52   md:w-72 lg:w-72 w-44 object-cover rounded shadow hover:opacity-80 transition-opacity duration-300"}):Pt.file_url.includes(".pdf")?jsxRuntimeExports.jsx("iframe",{src:Pt.file_url,className:"w-full border cursor-pointer h-52 rounded shadow hover:opacity-80 transition-opacity duration-300",title:"PDF Preview",href:Pt.file_url}):null)}),jsxRuntimeExports.jsx("a",{href:Pt.file_url,target:"_blank",rel:"noopener noreferrer",className:"text-white-500 z-10 w-full bg-white border-t border-blue-500 px-5 py-3 mt-auto truncate underline text-blue-500",children:"File"})]},kt))})]}):_e.message}),jsxRuntimeExports.jsx("div",{className:"chat-footer opacity-50 text-xs flex gap-1 items-center",children:ut})]})},PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0";PACKET_TYPES.close="1";PACKET_TYPES.ping="2";PACKET_TYPES.pong="3";PACKET_TYPES.message="4";PACKET_TYPES.upgrade="5";PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(_e=>{PACKET_TYPES_REVERSE[PACKET_TYPES[_e]]=_e});const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",withNativeArrayBuffer$2=typeof ArrayBuffer=="function",isView$1=_e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(_e):_e&&_e.buffer instanceof ArrayBuffer,encodePacket=({type:_e,data:et},rt,at)=>withNativeBlob$1&&et instanceof Blob?rt?at(et):encodeBlobAsBase64(et,at):withNativeArrayBuffer$2&&(et instanceof ArrayBuffer||isView$1(et))?rt?at(et):encodeBlobAsBase64(new Blob([et]),at):at(PACKET_TYPES[_e]+(et||"")),encodeBlobAsBase64=(_e,et)=>{const rt=new FileReader;return rt.onload=function(){const at=rt.result.split(",")[1];et("b"+(at||""))},rt.readAsDataURL(_e)};function toArray(_e){return _e instanceof Uint8Array?_e:_e instanceof ArrayBuffer?new Uint8Array(_e):new Uint8Array(_e.buffer,_e.byteOffset,_e.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(_e,et){if(withNativeBlob$1&&_e.data instanceof Blob)return _e.data.arrayBuffer().then(toArray).then(et);if(withNativeArrayBuffer$2&&(_e.data instanceof ArrayBuffer||isView$1(_e.data)))return et(toArray(_e.data));encodePacket(_e,!1,rt=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),et(TEXT_ENCODER.encode(rt))})}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let _e=0;_e<chars.length;_e++)lookup$1[chars.charCodeAt(_e)]=_e;const decode$1=_e=>{let et=_e.length*.75,rt=_e.length,at,ut=0,pt,yt,ct,At;_e[_e.length-1]==="="&&(et--,_e[_e.length-2]==="="&&et--);const Pt=new ArrayBuffer(et),kt=new Uint8Array(Pt);for(at=0;at<rt;at+=4)pt=lookup$1[_e.charCodeAt(at)],yt=lookup$1[_e.charCodeAt(at+1)],ct=lookup$1[_e.charCodeAt(at+2)],At=lookup$1[_e.charCodeAt(at+3)],kt[ut++]=pt<<2|yt>>4,kt[ut++]=(yt&15)<<4|ct>>2,kt[ut++]=(ct&3)<<6|At&63;return Pt},withNativeArrayBuffer$1=typeof ArrayBuffer=="function",decodePacket=(_e,et)=>{if(typeof _e!="string")return{type:"message",data:mapBinary(_e,et)};const rt=_e.charAt(0);return rt==="b"?{type:"message",data:decodeBase64Packet(_e.substring(1),et)}:PACKET_TYPES_REVERSE[rt]?_e.length>1?{type:PACKET_TYPES_REVERSE[rt],data:_e.substring(1)}:{type:PACKET_TYPES_REVERSE[rt]}:ERROR_PACKET},decodeBase64Packet=(_e,et)=>{if(withNativeArrayBuffer$1){const rt=decode$1(_e);return mapBinary(rt,et)}else return{base64:!0,data:_e}},mapBinary=(_e,et)=>{switch(et){case"blob":return _e instanceof Blob?_e:new Blob([_e]);case"arraybuffer":default:return _e instanceof ArrayBuffer?_e:_e.buffer}},SEPARATOR="",encodePayload=(_e,et)=>{const rt=_e.length,at=new Array(rt);let ut=0;_e.forEach((pt,yt)=>{encodePacket(pt,!1,ct=>{at[yt]=ct,++ut===rt&&et(at.join(SEPARATOR))})})},decodePayload=(_e,et)=>{const rt=_e.split(SEPARATOR),at=[];for(let ut=0;ut<rt.length;ut++){const pt=decodePacket(rt[ut],et);if(at.push(pt),pt.type==="error")break}return at};function createPacketEncoderStream(){return new TransformStream({transform(_e,et){encodePacketToBinary(_e,rt=>{const at=rt.length;let ut;if(at<126)ut=new Uint8Array(1),new DataView(ut.buffer).setUint8(0,at);else if(at<65536){ut=new Uint8Array(3);const pt=new DataView(ut.buffer);pt.setUint8(0,126),pt.setUint16(1,at)}else{ut=new Uint8Array(9);const pt=new DataView(ut.buffer);pt.setUint8(0,127),pt.setBigUint64(1,BigInt(at))}_e.data&&typeof _e.data!="string"&&(ut[0]|=128),et.enqueue(ut),et.enqueue(rt)})}})}let TEXT_DECODER;function totalLength(_e){return _e.reduce((et,rt)=>et+rt.length,0)}function concatChunks(_e,et){if(_e[0].length===et)return _e.shift();const rt=new Uint8Array(et);let at=0;for(let ut=0;ut<et;ut++)rt[ut]=_e[0][at++],at===_e[0].length&&(_e.shift(),at=0);return _e.length&&at<_e[0].length&&(_e[0]=_e[0].slice(at)),rt}function createPacketDecoderStream(_e,et){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const rt=[];let at=0,ut=-1,pt=!1;return new TransformStream({transform(yt,ct){for(rt.push(yt);;){if(at===0){if(totalLength(rt)<1)break;const At=concatChunks(rt,1);pt=(At[0]&128)===128,ut=At[0]&127,ut<126?at=3:ut===126?at=1:at=2}else if(at===1){if(totalLength(rt)<2)break;const At=concatChunks(rt,2);ut=new DataView(At.buffer,At.byteOffset,At.length).getUint16(0),at=3}else if(at===2){if(totalLength(rt)<8)break;const At=concatChunks(rt,8),Pt=new DataView(At.buffer,At.byteOffset,At.length),kt=Pt.getUint32(0);if(kt>Math.pow(2,21)-1){ct.enqueue(ERROR_PACKET);break}ut=kt*Math.pow(2,32)+Pt.getUint32(4),at=3}else{if(totalLength(rt)<ut)break;const At=concatChunks(rt,ut);ct.enqueue(decodePacket(pt?At:TEXT_DECODER.decode(At),et)),at=0}if(ut===0||ut>_e){ct.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(_e){if(_e)return mixin(_e)}function mixin(_e){for(var et in Emitter.prototype)_e[et]=Emitter.prototype[et];return _e}Emitter.prototype.on=Emitter.prototype.addEventListener=function(_e,et){return this._callbacks=this._callbacks||{},(this._callbacks["$"+_e]=this._callbacks["$"+_e]||[]).push(et),this};Emitter.prototype.once=function(_e,et){function rt(){this.off(_e,rt),et.apply(this,arguments)}return rt.fn=et,this.on(_e,rt),this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(_e,et){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var rt=this._callbacks["$"+_e];if(!rt)return this;if(arguments.length==1)return delete this._callbacks["$"+_e],this;for(var at,ut=0;ut<rt.length;ut++)if(at=rt[ut],at===et||at.fn===et){rt.splice(ut,1);break}return rt.length===0&&delete this._callbacks["$"+_e],this};Emitter.prototype.emit=function(_e){this._callbacks=this._callbacks||{};for(var et=new Array(arguments.length-1),rt=this._callbacks["$"+_e],at=1;at<arguments.length;at++)et[at-1]=arguments[at];if(rt){rt=rt.slice(0);for(var at=0,ut=rt.length;at<ut;++at)rt[at].apply(this,et)}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(_e){return this._callbacks=this._callbacks||{},this._callbacks["$"+_e]||[]};Emitter.prototype.hasListeners=function(_e){return!!this.listeners(_e).length};const globalThisShim=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function pick(_e,...et){return et.reduce((rt,at)=>(_e.hasOwnProperty(at)&&(rt[at]=_e[at]),rt),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(_e,et){et.useNativeTimers?(_e.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),_e.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(_e.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),_e.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(_e){return typeof _e=="string"?utf8Length(_e):Math.ceil((_e.byteLength||_e.size)*BASE64_OVERHEAD)}function utf8Length(_e){let et=0,rt=0;for(let at=0,ut=_e.length;at<ut;at++)et=_e.charCodeAt(at),et<128?rt+=1:et<2048?rt+=2:et<55296||et>=57344?rt+=3:(at++,rt+=4);return rt}function encode$1(_e){let et="";for(let rt in _e)_e.hasOwnProperty(rt)&&(et.length&&(et+="&"),et+=encodeURIComponent(rt)+"="+encodeURIComponent(_e[rt]));return et}function decode(_e){let et={},rt=_e.split("&");for(let at=0,ut=rt.length;at<ut;at++){let pt=rt[at].split("=");et[decodeURIComponent(pt[0])]=decodeURIComponent(pt[1])}return et}class TransportError extends Error{constructor(et,rt,at){super(et),this.description=rt,this.context=at,this.type="TransportError"}}class Transport extends Emitter{constructor(et){super(),this.writable=!1,installTimerFunctions(this,et),this.opts=et,this.query=et.query,this.socket=et.socket}onError(et,rt,at){return super.emitReserved("error",new TransportError(et,rt,at)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(et){this.readyState==="open"&&this.write(et)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(et){const rt=decodePacket(et,this.socket.binaryType);this.onPacket(rt)}onPacket(et){super.emitReserved("packet",et)}onClose(et){this.readyState="closed",super.emitReserved("close",et)}pause(et){}createUri(et,rt={}){return et+"://"+this._hostname()+this._port()+this.opts.path+this._query(rt)}_hostname(){const et=this.opts.hostname;return et.indexOf(":")===-1?et:"["+et+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(et){const rt=encode$1(et);return rt.length?"?"+rt:""}}const alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={};let seed=0,i=0,prev;function encode(_e){let et="";do et=alphabet[_e%length]+et,_e=Math.floor(_e/length);while(_e>0);return et}function yeast(){const _e=encode(+new Date);return _e!==prev?(seed=0,prev=_e):_e+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;let value=!1;try{value=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch(_e){}const hasCORS=value;function XHR(_e){const et=_e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!et||hasCORS))return new XMLHttpRequest}catch{}if(!et)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function createCookieJar(){}function empty(){}const hasXHR2=function(){return new XHR({xdomain:!1}).responseType!=null}();class Polling extends Transport{constructor(et){if(super(et),this.polling=!1,typeof location<"u"){const at=location.protocol==="https:";let ut=location.port;ut||(ut=at?"443":"80"),this.xd=typeof location<"u"&&et.hostname!==location.hostname||ut!==et.port}const rt=et&&et.forceBase64;this.supportsBinary=hasXHR2&&!rt,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(et){this.readyState="pausing";const rt=()=>{this.readyState="paused",et()};if(this.polling||!this.writable){let at=0;this.polling&&(at++,this.once("pollComplete",function(){--at||rt()})),this.writable||(at++,this.once("drain",function(){--at||rt()}))}else rt()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(et){const rt=at=>{if(this.readyState==="opening"&&at.type==="open"&&this.onOpen(),at.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(at)};decodePayload(et,this.socket.binaryType).forEach(rt),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const et=()=>{this.write([{type:"close"}])};this.readyState==="open"?et():this.once("open",et)}write(et){this.writable=!1,encodePayload(et,rt=>{this.doWrite(rt,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const et=this.opts.secure?"https":"http",rt=this.query||{};return this.opts.timestampRequests!==!1&&(rt[this.opts.timestampParam]=yeast()),!this.supportsBinary&&!rt.sid&&(rt.b64=1),this.createUri(et,rt)}request(et={}){return Object.assign(et,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request$1(this.uri(),et)}doWrite(et,rt){const at=this.request({method:"POST",data:et});at.on("success",rt),at.on("error",(ut,pt)=>{this.onError("xhr post error",ut,pt)})}doPoll(){const et=this.request();et.on("data",this.onData.bind(this)),et.on("error",(rt,at)=>{this.onError("xhr poll error",rt,at)}),this.pollXhr=et}}let Request$1=class Yy extends Emitter{constructor(et,rt){super(),installTimerFunctions(this,rt),this.opts=rt,this.method=rt.method||"GET",this.uri=et,this.data=rt.data!==void 0?rt.data:null,this.create()}create(){var et;const rt=pick(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");rt.xdomain=!!this.opts.xd;const at=this.xhr=new XHR(rt);try{at.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){at.setDisableHeaderCheck&&at.setDisableHeaderCheck(!0);for(let ut in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(ut)&&at.setRequestHeader(ut,this.opts.extraHeaders[ut])}}catch{}if(this.method==="POST")try{at.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{at.setRequestHeader("Accept","*/*")}catch{}(et=this.opts.cookieJar)===null||et===void 0||et.addCookies(at),"withCredentials"in at&&(at.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(at.timeout=this.opts.requestTimeout),at.onreadystatechange=()=>{var ut;at.readyState===3&&((ut=this.opts.cookieJar)===null||ut===void 0||ut.parseCookies(at)),at.readyState===4&&(at.status===200||at.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof at.status=="number"?at.status:0)},0))},at.send(this.data)}catch(ut){this.setTimeoutFn(()=>{this.onError(ut)},0);return}typeof document<"u"&&(this.index=Yy.requestsCount++,Yy.requests[this.index]=this)}onError(et){this.emitReserved("error",et,this.xhr),this.cleanup(!0)}cleanup(et){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=empty,et)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Yy.requests[this.index],this.xhr=null}}onLoad(){const et=this.xhr.responseText;et!==null&&(this.emitReserved("data",et),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Request$1.requestsCount=0;Request$1.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",unloadHandler);else if(typeof addEventListener=="function"){const _e="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(_e,unloadHandler,!1)}}function unloadHandler(){for(let _e in Request$1.requests)Request$1.requests.hasOwnProperty(_e)&&Request$1.requests[_e].abort()}const nextTick=typeof Promise=="function"&&typeof Promise.resolve=="function"?et=>Promise.resolve().then(et):(et,rt)=>rt(et,0),WebSocket=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class WS extends Transport{constructor(et){super(et),this.supportsBinary=!et.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const et=this.uri(),rt=this.opts.protocols,at=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(at.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?rt?new WebSocket(et,rt):new WebSocket(et):new WebSocket(et,rt,at)}catch(ut){return this.emitReserved("error",ut)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=et=>this.onClose({description:"websocket connection closed",context:et}),this.ws.onmessage=et=>this.onData(et.data),this.ws.onerror=et=>this.onError("websocket error",et)}write(et){this.writable=!1;for(let rt=0;rt<et.length;rt++){const at=et[rt],ut=rt===et.length-1;encodePacket(at,this.supportsBinary,pt=>{const yt={};try{usingBrowserWebSocket&&this.ws.send(pt)}catch{}ut&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const et=this.opts.secure?"wss":"ws",rt=this.query||{};return this.opts.timestampRequests&&(rt[this.opts.timestampParam]=yeast()),this.supportsBinary||(rt.b64=1),this.createUri(et,rt)}check(){return!!WebSocket}}class WT extends Transport{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(et=>{this.onError("webtransport error",et)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(et=>{const rt=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),at=et.readable.pipeThrough(rt).getReader(),ut=createPacketEncoderStream();ut.readable.pipeTo(et.writable),this.writer=ut.writable.getWriter();const pt=()=>{at.read().then(({done:ct,value:At})=>{ct||(this.onPacket(At),pt())}).catch(ct=>{})};pt();const yt={type:"open"};this.query.sid&&(yt.data=`{"sid":"${this.query.sid}"}`),this.writer.write(yt).then(()=>this.onOpen())})}))}write(et){this.writable=!1;for(let rt=0;rt<et.length;rt++){const at=et[rt],ut=rt===et.length-1;this.writer.write(at).then(()=>{ut&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var et;(et=this.transport)===null||et===void 0||et.close()}}const transports={websocket:WS,webtransport:WT,polling:Polling},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(_e){if(_e.length>2e3)throw"URI too long";const et=_e,rt=_e.indexOf("["),at=_e.indexOf("]");rt!=-1&&at!=-1&&(_e=_e.substring(0,rt)+_e.substring(rt,at).replace(/:/g,";")+_e.substring(at,_e.length));let ut=re.exec(_e||""),pt={},yt=14;for(;yt--;)pt[parts[yt]]=ut[yt]||"";return rt!=-1&&at!=-1&&(pt.source=et,pt.host=pt.host.substring(1,pt.host.length-1).replace(/;/g,":"),pt.authority=pt.authority.replace("[","").replace("]","").replace(/;/g,":"),pt.ipv6uri=!0),pt.pathNames=pathNames(pt,pt.path),pt.queryKey=queryKey(pt,pt.query),pt}function pathNames(_e,et){const rt=/\/{2,9}/g,at=et.replace(rt,"/").split("/");return(et.slice(0,1)=="/"||et.length===0)&&at.splice(0,1),et.slice(-1)=="/"&&at.splice(at.length-1,1),at}function queryKey(_e,et){const rt={};return et.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(at,ut,pt){ut&&(rt[ut]=pt)}),rt}let Socket$1=class u_ extends Emitter{constructor(et,rt={}){super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],et&&typeof et=="object"&&(rt=et,et=null),et?(et=parse(et),rt.hostname=et.host,rt.secure=et.protocol==="https"||et.protocol==="wss",rt.port=et.port,et.query&&(rt.query=et.query)):rt.host&&(rt.hostname=parse(rt.host).host),installTimerFunctions(this,rt),this.secure=rt.secure!=null?rt.secure:typeof location<"u"&&location.protocol==="https:",rt.hostname&&!rt.port&&(rt.port=this.secure?"443":"80"),this.hostname=rt.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=rt.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=rt.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},rt),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(et){const rt=Object.assign({},this.opts.query);rt.EIO=protocol$1,rt.transport=et,this.id&&(rt.sid=this.id);const at=Object.assign({},this.opts,{query:rt,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[et]);return new transports[et](at)}open(){let et;if(this.opts.rememberUpgrade&&u_.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)et="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else et=this.transports[0];this.readyState="opening";try{et=this.createTransport(et)}catch{this.transports.shift(),this.open();return}et.open(),this.setTransport(et)}setTransport(et){this.transport&&this.transport.removeAllListeners(),this.transport=et,et.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",rt=>this.onClose("transport close",rt))}probe(et){let rt=this.createTransport(et),at=!1;u_.priorWebsocketSuccess=!1;const ut=()=>{at||(rt.send([{type:"ping",data:"probe"}]),rt.once("packet",Lt=>{if(!at)if(Lt.type==="pong"&&Lt.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",rt),!rt)return;u_.priorWebsocketSuccess=rt.name==="websocket",this.transport.pause(()=>{at||this.readyState!=="closed"&&(kt(),this.setTransport(rt),rt.send([{type:"upgrade"}]),this.emitReserved("upgrade",rt),rt=null,this.upgrading=!1,this.flush())})}else{const Mt=new Error("probe error");Mt.transport=rt.name,this.emitReserved("upgradeError",Mt)}}))};function pt(){at||(at=!0,kt(),rt.close(),rt=null)}const yt=Lt=>{const Mt=new Error("probe error: "+Lt);Mt.transport=rt.name,pt(),this.emitReserved("upgradeError",Mt)};function ct(){yt("transport closed")}function At(){yt("socket closed")}function Pt(Lt){rt&&Lt.name!==rt.name&&pt()}const kt=()=>{rt.removeListener("open",ut),rt.removeListener("error",yt),rt.removeListener("close",ct),this.off("close",At),this.off("upgrading",Pt)};rt.once("open",ut),rt.once("error",yt),rt.once("close",ct),this.once("close",At),this.once("upgrading",Pt),this.upgrades.indexOf("webtransport")!==-1&&et!=="webtransport"?this.setTimeoutFn(()=>{at||rt.open()},200):rt.open()}onOpen(){if(this.readyState="open",u_.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let et=0;const rt=this.upgrades.length;for(;et<rt;et++)this.probe(this.upgrades[et])}}onPacket(et){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",et),this.emitReserved("heartbeat"),this.resetPingTimeout(),et.type){case"open":this.onHandshake(JSON.parse(et.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const rt=new Error("server error");rt.code=et.data,this.onError(rt);break;case"message":this.emitReserved("data",et.data),this.emitReserved("message",et.data);break}}onHandshake(et){this.emitReserved("handshake",et),this.id=et.sid,this.transport.query.sid=et.sid,this.upgrades=this.filterUpgrades(et.upgrades),this.pingInterval=et.pingInterval,this.pingTimeout=et.pingTimeout,this.maxPayload=et.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const et=this.getWritablePackets();this.transport.send(et),this.prevBufferLen=et.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let rt=1;for(let at=0;at<this.writeBuffer.length;at++){const ut=this.writeBuffer[at].data;if(ut&&(rt+=byteLength(ut)),at>0&&rt>this.maxPayload)return this.writeBuffer.slice(0,at);rt+=2}return this.writeBuffer}write(et,rt,at){return this.sendPacket("message",et,rt,at),this}send(et,rt,at){return this.sendPacket("message",et,rt,at),this}sendPacket(et,rt,at,ut){if(typeof rt=="function"&&(ut=rt,rt=void 0),typeof at=="function"&&(ut=at,at=null),this.readyState==="closing"||this.readyState==="closed")return;at=at||{},at.compress=at.compress!==!1;const pt={type:et,data:rt,options:at};this.emitReserved("packetCreate",pt),this.writeBuffer.push(pt),ut&&this.once("flush",ut),this.flush()}close(){const et=()=>{this.onClose("forced close"),this.transport.close()},rt=()=>{this.off("upgrade",rt),this.off("upgradeError",rt),et()},at=()=>{this.once("upgrade",rt),this.once("upgradeError",rt)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?at():et()}):this.upgrading?at():et()),this}onError(et){u_.priorWebsocketSuccess=!1,this.emitReserved("error",et),this.onClose("transport error",et)}onClose(et,rt){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",et,rt),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(et){const rt=[];let at=0;const ut=et.length;for(;at<ut;at++)~this.transports.indexOf(et[at])&&rt.push(et[at]);return rt}};Socket$1.protocol=protocol$1;function url(_e,et="",rt){let at=_e;rt=rt||typeof location<"u"&&location,_e==null&&(_e=rt.protocol+"//"+rt.host),typeof _e=="string"&&(_e.charAt(0)==="/"&&(_e.charAt(1)==="/"?_e=rt.protocol+_e:_e=rt.host+_e),/^(https?|wss?):\/\//.test(_e)||(typeof rt<"u"?_e=rt.protocol+"//"+_e:_e="https://"+_e),at=parse(_e)),at.port||(/^(http|ws)$/.test(at.protocol)?at.port="80":/^(http|ws)s$/.test(at.protocol)&&(at.port="443")),at.path=at.path||"/";const pt=at.host.indexOf(":")!==-1?"["+at.host+"]":at.host;return at.id=at.protocol+"://"+pt+":"+at.port+et,at.href=at.protocol+"://"+pt+(rt&&rt.port===at.port?"":":"+at.port),at}const withNativeArrayBuffer=typeof ArrayBuffer=="function",isView=_e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(_e):_e.buffer instanceof ArrayBuffer,toString=Object.prototype.toString,withNativeBlob=typeof Blob=="function"||typeof Blob<"u"&&toString.call(Blob)==="[object BlobConstructor]",withNativeFile=typeof File=="function"||typeof File<"u"&&toString.call(File)==="[object FileConstructor]";function isBinary(_e){return withNativeArrayBuffer&&(_e instanceof ArrayBuffer||isView(_e))||withNativeBlob&&_e instanceof Blob||withNativeFile&&_e instanceof File}function hasBinary(_e,et){if(!_e||typeof _e!="object")return!1;if(Array.isArray(_e)){for(let rt=0,at=_e.length;rt<at;rt++)if(hasBinary(_e[rt]))return!0;return!1}if(isBinary(_e))return!0;if(_e.toJSON&&typeof _e.toJSON=="function"&&arguments.length===1)return hasBinary(_e.toJSON(),!0);for(const rt in _e)if(Object.prototype.hasOwnProperty.call(_e,rt)&&hasBinary(_e[rt]))return!0;return!1}function deconstructPacket(_e){const et=[],rt=_e.data,at=_e;return at.data=_deconstructPacket(rt,et),at.attachments=et.length,{packet:at,buffers:et}}function _deconstructPacket(_e,et){if(!_e)return _e;if(isBinary(_e)){const rt={_placeholder:!0,num:et.length};return et.push(_e),rt}else if(Array.isArray(_e)){const rt=new Array(_e.length);for(let at=0;at<_e.length;at++)rt[at]=_deconstructPacket(_e[at],et);return rt}else if(typeof _e=="object"&&!(_e instanceof Date)){const rt={};for(const at in _e)Object.prototype.hasOwnProperty.call(_e,at)&&(rt[at]=_deconstructPacket(_e[at],et));return rt}return _e}function reconstructPacket(_e,et){return _e.data=_reconstructPacket(_e.data,et),delete _e.attachments,_e}function _reconstructPacket(_e,et){if(!_e)return _e;if(_e&&_e._placeholder===!0){if(typeof _e.num=="number"&&_e.num>=0&&_e.num<et.length)return et[_e.num];throw new Error("illegal attachments")}else if(Array.isArray(_e))for(let rt=0;rt<_e.length;rt++)_e[rt]=_reconstructPacket(_e[rt],et);else if(typeof _e=="object")for(const rt in _e)Object.prototype.hasOwnProperty.call(_e,rt)&&(_e[rt]=_reconstructPacket(_e[rt],et));return _e}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;(function(_e){_e[_e.CONNECT=0]="CONNECT",_e[_e.DISCONNECT=1]="DISCONNECT",_e[_e.EVENT=2]="EVENT",_e[_e.ACK=3]="ACK",_e[_e.CONNECT_ERROR=4]="CONNECT_ERROR",_e[_e.BINARY_EVENT=5]="BINARY_EVENT",_e[_e.BINARY_ACK=6]="BINARY_ACK"})(PacketType||(PacketType={}));class Encoder{constructor(et){this.replacer=et}encode(et){return(et.type===PacketType.EVENT||et.type===PacketType.ACK)&&hasBinary(et)?this.encodeAsBinary({type:et.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:et.nsp,data:et.data,id:et.id}):[this.encodeAsString(et)]}encodeAsString(et){let rt=""+et.type;return(et.type===PacketType.BINARY_EVENT||et.type===PacketType.BINARY_ACK)&&(rt+=et.attachments+"-"),et.nsp&&et.nsp!=="/"&&(rt+=et.nsp+","),et.id!=null&&(rt+=et.id),et.data!=null&&(rt+=JSON.stringify(et.data,this.replacer)),rt}encodeAsBinary(et){const rt=deconstructPacket(et),at=this.encodeAsString(rt.packet),ut=rt.buffers;return ut.unshift(at),ut}}function isObject(_e){return Object.prototype.toString.call(_e)==="[object Object]"}class Decoder extends Emitter{constructor(et){super(),this.reviver=et}add(et){let rt;if(typeof et=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");rt=this.decodeString(et);const at=rt.type===PacketType.BINARY_EVENT;at||rt.type===PacketType.BINARY_ACK?(rt.type=at?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(rt),rt.attachments===0&&super.emitReserved("decoded",rt)):super.emitReserved("decoded",rt)}else if(isBinary(et)||et.base64)if(this.reconstructor)rt=this.reconstructor.takeBinaryData(et),rt&&(this.reconstructor=null,super.emitReserved("decoded",rt));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+et)}decodeString(et){let rt=0;const at={type:Number(et.charAt(0))};if(PacketType[at.type]===void 0)throw new Error("unknown packet type "+at.type);if(at.type===PacketType.BINARY_EVENT||at.type===PacketType.BINARY_ACK){const pt=rt+1;for(;et.charAt(++rt)!=="-"&&rt!=et.length;);const yt=et.substring(pt,rt);if(yt!=Number(yt)||et.charAt(rt)!=="-")throw new Error("Illegal attachments");at.attachments=Number(yt)}if(et.charAt(rt+1)==="/"){const pt=rt+1;for(;++rt&&!(et.charAt(rt)===","||rt===et.length););at.nsp=et.substring(pt,rt)}else at.nsp="/";const ut=et.charAt(rt+1);if(ut!==""&&Number(ut)==ut){const pt=rt+1;for(;++rt;){const yt=et.charAt(rt);if(yt==null||Number(yt)!=yt){--rt;break}if(rt===et.length)break}at.id=Number(et.substring(pt,rt+1))}if(et.charAt(++rt)){const pt=this.tryParse(et.substr(rt));if(Decoder.isPayloadValid(at.type,pt))at.data=pt;else throw new Error("invalid payload")}return at}tryParse(et){try{return JSON.parse(et,this.reviver)}catch{return!1}}static isPayloadValid(et,rt){switch(et){case PacketType.CONNECT:return isObject(rt);case PacketType.DISCONNECT:return rt===void 0;case PacketType.CONNECT_ERROR:return typeof rt=="string"||isObject(rt);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(rt)&&(typeof rt[0]=="number"||typeof rt[0]=="string"&&RESERVED_EVENTS$1.indexOf(rt[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(rt)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class BinaryReconstructor{constructor(et){this.packet=et,this.buffers=[],this.reconPack=et}takeBinaryData(et){if(this.buffers.push(et),this.buffers.length===this.reconPack.attachments){const rt=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),rt}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const parser=Object.freeze(Object.defineProperty({__proto__:null,Decoder,Encoder,get PacketType(){return PacketType},protocol},Symbol.toStringTag,{value:"Module"}));function on(_e,et,rt){return _e.on(et,rt),function(){_e.off(et,rt)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(et,rt,at){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=et,this.nsp=rt,at&&at.auth&&(this.auth=at.auth),this._opts=Object.assign({},at),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const et=this.io;this.subs=[on(et,"open",this.onopen.bind(this)),on(et,"packet",this.onpacket.bind(this)),on(et,"error",this.onerror.bind(this)),on(et,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...et){return et.unshift("message"),this.emit.apply(this,et),this}emit(et,...rt){if(RESERVED_EVENTS.hasOwnProperty(et))throw new Error('"'+et.toString()+'" is a reserved event name');if(rt.unshift(et),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(rt),this;const at={type:PacketType.EVENT,data:rt};if(at.options={},at.options.compress=this.flags.compress!==!1,typeof rt[rt.length-1]=="function"){const yt=this.ids++,ct=rt.pop();this._registerAckCallback(yt,ct),at.id=yt}const ut=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!ut||!this.connected)||(this.connected?(this.notifyOutgoingListeners(at),this.packet(at)):this.sendBuffer.push(at)),this.flags={},this}_registerAckCallback(et,rt){var at;const ut=(at=this.flags.timeout)!==null&&at!==void 0?at:this._opts.ackTimeout;if(ut===void 0){this.acks[et]=rt;return}const pt=this.io.setTimeoutFn(()=>{delete this.acks[et];for(let yt=0;yt<this.sendBuffer.length;yt++)this.sendBuffer[yt].id===et&&this.sendBuffer.splice(yt,1);rt.call(this,new Error("operation has timed out"))},ut);this.acks[et]=(...yt)=>{this.io.clearTimeoutFn(pt),rt.apply(this,[null,...yt])}}emitWithAck(et,...rt){const at=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((ut,pt)=>{rt.push((yt,ct)=>at?yt?pt(yt):ut(ct):ut(yt)),this.emit(et,...rt)})}_addToQueue(et){let rt;typeof et[et.length-1]=="function"&&(rt=et.pop());const at={id:this._queueSeq++,tryCount:0,pending:!1,args:et,flags:Object.assign({fromQueue:!0},this.flags)};et.push((ut,...pt)=>at!==this._queue[0]?void 0:(ut!==null?at.tryCount>this._opts.retries&&(this._queue.shift(),rt&&rt(ut)):(this._queue.shift(),rt&&rt(null,...pt)),at.pending=!1,this._drainQueue())),this._queue.push(at),this._drainQueue()}_drainQueue(et=!1){if(!this.connected||this._queue.length===0)return;const rt=this._queue[0];rt.pending&&!et||(rt.pending=!0,rt.tryCount++,this.flags=rt.flags,this.emit.apply(this,rt.args))}packet(et){et.nsp=this.nsp,this.io._packet(et)}onopen(){typeof this.auth=="function"?this.auth(et=>{this._sendConnectPacket(et)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(et){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},et):et})}onerror(et){this.connected||this.emitReserved("connect_error",et)}onclose(et,rt){this.connected=!1,delete this.id,this.emitReserved("disconnect",et,rt)}onpacket(et){if(et.nsp===this.nsp)switch(et.type){case PacketType.CONNECT:et.data&&et.data.sid?this.onconnect(et.data.sid,et.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(et);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(et);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const at=new Error(et.data.message);at.data=et.data.data,this.emitReserved("connect_error",at);break}}onevent(et){const rt=et.data||[];et.id!=null&&rt.push(this.ack(et.id)),this.connected?this.emitEvent(rt):this.receiveBuffer.push(Object.freeze(rt))}emitEvent(et){if(this._anyListeners&&this._anyListeners.length){const rt=this._anyListeners.slice();for(const at of rt)at.apply(this,et)}super.emit.apply(this,et),this._pid&&et.length&&typeof et[et.length-1]=="string"&&(this._lastOffset=et[et.length-1])}ack(et){const rt=this;let at=!1;return function(...ut){at||(at=!0,rt.packet({type:PacketType.ACK,id:et,data:ut}))}}onack(et){const rt=this.acks[et.id];typeof rt=="function"&&(rt.apply(this,et.data),delete this.acks[et.id])}onconnect(et,rt){this.id=et,this.recovered=rt&&this._pid===rt,this._pid=rt,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(et=>this.emitEvent(et)),this.receiveBuffer=[],this.sendBuffer.forEach(et=>{this.notifyOutgoingListeners(et),this.packet(et)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(et=>et()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(et){return this.flags.compress=et,this}get volatile(){return this.flags.volatile=!0,this}timeout(et){return this.flags.timeout=et,this}onAny(et){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(et),this}prependAny(et){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(et),this}offAny(et){if(!this._anyListeners)return this;if(et){const rt=this._anyListeners;for(let at=0;at<rt.length;at++)if(et===rt[at])return rt.splice(at,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(et){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(et),this}prependAnyOutgoing(et){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(et),this}offAnyOutgoing(et){if(!this._anyOutgoingListeners)return this;if(et){const rt=this._anyOutgoingListeners;for(let at=0;at<rt.length;at++)if(et===rt[at])return rt.splice(at,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(et){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const rt=this._anyOutgoingListeners.slice();for(const at of rt)at.apply(this,et.data)}}}function Backoff(_e){_e=_e||{},this.ms=_e.min||100,this.max=_e.max||1e4,this.factor=_e.factor||2,this.jitter=_e.jitter>0&&_e.jitter<=1?_e.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var _e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var et=Math.random(),rt=Math.floor(et*this.jitter*_e);_e=Math.floor(et*10)&1?_e+rt:_e-rt}return Math.min(_e,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(_e){this.ms=_e};Backoff.prototype.setMax=function(_e){this.max=_e};Backoff.prototype.setJitter=function(_e){this.jitter=_e};class Manager extends Emitter{constructor(et,rt){var at;super(),this.nsps={},this.subs=[],et&&typeof et=="object"&&(rt=et,et=void 0),rt=rt||{},rt.path=rt.path||"/socket.io",this.opts=rt,installTimerFunctions(this,rt),this.reconnection(rt.reconnection!==!1),this.reconnectionAttempts(rt.reconnectionAttempts||1/0),this.reconnectionDelay(rt.reconnectionDelay||1e3),this.reconnectionDelayMax(rt.reconnectionDelayMax||5e3),this.randomizationFactor((at=rt.randomizationFactor)!==null&&at!==void 0?at:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(rt.timeout==null?2e4:rt.timeout),this._readyState="closed",this.uri=et;const ut=rt.parser||parser;this.encoder=new ut.Encoder,this.decoder=new ut.Decoder,this._autoConnect=rt.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(et){return arguments.length?(this._reconnection=!!et,this):this._reconnection}reconnectionAttempts(et){return et===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=et,this)}reconnectionDelay(et){var rt;return et===void 0?this._reconnectionDelay:(this._reconnectionDelay=et,(rt=this.backoff)===null||rt===void 0||rt.setMin(et),this)}randomizationFactor(et){var rt;return et===void 0?this._randomizationFactor:(this._randomizationFactor=et,(rt=this.backoff)===null||rt===void 0||rt.setJitter(et),this)}reconnectionDelayMax(et){var rt;return et===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=et,(rt=this.backoff)===null||rt===void 0||rt.setMax(et),this)}timeout(et){return arguments.length?(this._timeout=et,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(et){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const rt=this.engine,at=this;this._readyState="opening",this.skipReconnect=!1;const ut=on(rt,"open",function(){at.onopen(),et&&et()}),pt=ct=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",ct),et?et(ct):this.maybeReconnectOnOpen()},yt=on(rt,"error",pt);if(this._timeout!==!1){const ct=this._timeout,At=this.setTimeoutFn(()=>{ut(),pt(new Error("timeout")),rt.close()},ct);this.opts.autoUnref&&At.unref(),this.subs.push(()=>{this.clearTimeoutFn(At)})}return this.subs.push(ut),this.subs.push(yt),this}connect(et){return this.open(et)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const et=this.engine;this.subs.push(on(et,"ping",this.onping.bind(this)),on(et,"data",this.ondata.bind(this)),on(et,"error",this.onerror.bind(this)),on(et,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(et){try{this.decoder.add(et)}catch(rt){this.onclose("parse error",rt)}}ondecoded(et){nextTick(()=>{this.emitReserved("packet",et)},this.setTimeoutFn)}onerror(et){this.emitReserved("error",et)}socket(et,rt){let at=this.nsps[et];return at?this._autoConnect&&!at.active&&at.connect():(at=new Socket(this,et,rt),this.nsps[et]=at),at}_destroy(et){const rt=Object.keys(this.nsps);for(const at of rt)if(this.nsps[at].active)return;this._close()}_packet(et){const rt=this.encoder.encode(et);for(let at=0;at<rt.length;at++)this.engine.write(rt[at],et.options)}cleanup(){this.subs.forEach(et=>et()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(et,rt){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",et,rt),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const et=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const rt=this.backoff.duration();this._reconnecting=!0;const at=this.setTimeoutFn(()=>{et.skipReconnect||(this.emitReserved("reconnect_attempt",et.backoff.attempts),!et.skipReconnect&&et.open(ut=>{ut?(et._reconnecting=!1,et.reconnect(),this.emitReserved("reconnect_error",ut)):et.onreconnect()}))},rt);this.opts.autoUnref&&at.unref(),this.subs.push(()=>{this.clearTimeoutFn(at)})}}onreconnect(){const et=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",et)}}const cache={};function lookup(_e,et){typeof _e=="object"&&(et=_e,_e=void 0),et=et||{};const rt=url(_e,et.path||"/socket.io"),at=rt.source,ut=rt.id,pt=rt.path,yt=cache[ut]&&pt in cache[ut].nsps,ct=et.forceNew||et["force new connection"]||et.multiplex===!1||yt;let At;return ct?At=new Manager(at,et):(cache[ut]||(cache[ut]=new Manager(at,et)),At=cache[ut]),rt.query&&!et.query&&(et.query=rt.queryKey),At.socket(rt.path,et)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});const SocketContext=reactExports.createContext(),useSocketContext=()=>reactExports.useContext(SocketContext),SocketContextProvider=({children:_e})=>{const[et,rt]=reactExports.useState(null),[at,ut]=reactExports.useState([]),{authUser:pt}=useAuthContext();return reactExports.useEffect(()=>{if(pt){const yt=lookup("http://localhost:5000",{query:{userId:pt._id}});return rt(yt),yt.on("getOnlineUsers",ct=>{ut(ct)}),()=>yt.close()}else et&&(et.close(),rt(null))},[pt]),jsxRuntimeExports.jsx(SocketContext.Provider,{value:{socket:et,onlineUsers:at},children:_e})},notificationSound="/assets/notification-KoQ3t5UR.mp3",useListenMessages=_e=>{const{socket:et}=useSocketContext(),{messages:rt,setMessages:at}=useConversation();reactExports.useEffect(()=>(et==null||et.on("newMessage",ut=>{ut.shouldShake=!0,new Audio(notificationSound).play(),console.log("newMessage",ut),console.log("selectedConversation",_e),(_e==null?void 0:_e._id)===(ut==null?void 0:ut.senderId)&&at([...rt,ut])}),()=>et==null?void 0:et.off("newMessage")),[et,at,rt])},Messages=({selectedConversation:_e})=>{const{messages:et,loading:rt}=useGetMessages();useListenMessages(_e);const at=reactExports.useRef();return reactExports.useEffect(()=>{var ut;(ut=at.current)==null||ut.scrollIntoView({behavior:"smooth"})},[et]),jsxRuntimeExports.jsxs("div",{className:"flex-1 px-4 overflow-x-hidden h-full",style:{maxHeight:"calc(100vh - 150px)"},children:[!rt&&et.length>0&&et.map((ut,pt)=>jsxRuntimeExports.jsx("div",{ref:pt===et.length-1?at:null,children:jsxRuntimeExports.jsx(Message,{message:ut})},ut._id)),rt&&[...Array(3)].map((ut,pt)=>jsxRuntimeExports.jsx(MessageSkeleton,{},pt)),!rt&&et.length===0&&jsxRuntimeExports.jsx("p",{className:"text-center text-gray-500",children:"Send a message to start the conversation"})]})};function TiMessages(_e){return GenIcon({tag:"svg",attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M21 7h-3c0-1.65-1.35-3-3-3h-12c-1.65 0-3 1.35-3 3v7c0 1.65 1.35 3 3 3v3l3-3c0 1.65 1.35 3 3 3h8l3 3v-3h1c1.65 0 3-1.35 3-3v-7c0-1.65-1.35-3-3-3zm-18 8c-.542 0-1-.458-1-1v-7c0-.542.458-1 1-1h12c.542 0 1 .458 1 1v1h-6.5c-1.379 0-2.5 1.121-2.5 2.5v4.5h-4zm19 2c0 .542-.458 1-1 1h-12c-.542 0-1-.458-1-1v-6.5c0-.827.673-1.5 1.5-1.5h11.5c.542 0 1 .458 1 1v7z"},child:[]}]})(_e)}const MessageContainer=()=>{const{selectedConversation:_e,setSelectedConversation:et}=useConversation();return reactExports.useEffect(()=>()=>et(null),[et]),jsxRuntimeExports.jsx("div",{className:"flex-grow flex flex-col md:min-w-[450px] bg-gray-100",children:_e?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"bg-blue-600 text-white px-4 py-2 mb-2 rounded-b-lg",children:[jsxRuntimeExports.jsx("span",{className:"label-text",children:"To:"})," ",jsxRuntimeExports.jsx("span",{className:"font-bold",children:_e.fullName})]}),jsxRuntimeExports.jsx(Messages,{selectedConversation:_e}),jsxRuntimeExports.jsx(MessageInput,{})]}):jsxRuntimeExports.jsx(NoChatSelected,{})})},NoChatSelected=()=>{const{authUser:_e}=useAuthContext();return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-full h-full",children:jsxRuntimeExports.jsxs("div",{className:"px-4 text-center sm:text-lg md:text-xl text-gray-700 font-semibold flex flex-col items-center gap-4",children:[jsxRuntimeExports.jsxs("p",{children:["Welcome 👋 ",_e.fullName," ❄"]}),jsxRuntimeExports.jsx("p",{children:"Select a chat to start messaging"}),jsxRuntimeExports.jsx(TiMessages,{className:"text-5xl text-blue-600"})]})})},useGetConversations=()=>{const[_e,et]=reactExports.useState(!1),[rt,at]=reactExports.useState([]);return reactExports.useEffect(()=>{(async()=>{et(!0);try{const yt=await(await fetch("/api/users")).json();if(yt.error)throw new Error(yt.error);at(yt)}catch(pt){_t.error(pt.message)}finally{et(!1)}})()},[]),{loading:_e,conversations:rt}},funEmojis=["👾","⭐","🌟","🎉","🎊","🎈","🎁","🎂","🎄","🎃","🎗","🎟","🎫","🎖","🏆","🏅","🥇","🥈","🥉","⚽","🏀","🏈","⚾","🎾","🏐","🏉","🎱","🏓","🏸","🥅","🏒","🏑","🏏","⛳","🏹","🎣","🥊","🥋","🎽","⛸","🥌","🛷","🎿","⛷","🏂","🏋️","🤼","🤸","🤺","⛹️","🤾","🏌️","🏇","🧘"],getRandomEmoji=()=>funEmojis[Math.floor(Math.random()*funEmojis.length)],Conversation=({conversation:_e,lastIdx:et,emoji:rt})=>{const{selectedConversation:at,setSelectedConversation:ut}=useConversation(),{onlineUsers:pt}=useSocketContext(),yt=(at==null?void 0:at._id)===_e._id,ct=pt.includes(_e._id);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:`flex gap-4 items-center p-3 rounded-lg cursor-pointer transition-all duration-300 
				${yt?"bg-sky-500 text-white":"hover:bg-sky-100"}
			`,onClick:()=>ut(_e),children:[jsxRuntimeExports.jsx("div",{className:`avatar ${ct?"online":""}`,children:jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-gray-300 overflow-hidden",children:jsxRuntimeExports.jsx("img",{src:_e.profilePic,alt:`${_e.fullName}'s avatar`,className:"object-cover w-full h-full"})})}),jsxRuntimeExports.jsx("div",{className:"flex flex-col flex-1",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("p",{className:`font-bold ${yt?"text-white":"text-gray-800"} truncate`,children:_e.fullName}),jsxRuntimeExports.jsx("span",{className:`text-xl ${yt?"text-white":"text-gray-600"}`,children:rt})]})})]}),!et&&jsxRuntimeExports.jsx("div",{className:"divider border-t border-gray-300 mx-2"})]})},Conversations=()=>{const{loading:_e,conversations:et}=useGetConversations();return jsxRuntimeExports.jsxs("div",{className:"py-2 flex flex-col overflow-auto",children:[et.map((rt,at)=>jsxRuntimeExports.jsx(Conversation,{conversation:rt,emoji:getRandomEmoji(),lastIdx:at===et.length-1},rt._id)),_e?jsxRuntimeExports.jsx("span",{className:"loading loading-spinner mx-auto"}):null]})};function BiLogOut(_e){return GenIcon({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16 13v-2H7V8l-5 4 5 4v-3z"},child:[]},{tag:"path",attr:{d:"M20 3h-9c-1.103 0-2 .897-2 2v4h2V5h9v14h-9v-4H9v4c0 1.103.897 2 2 2h9c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2z"},child:[]}]})(_e)}const useLogout=()=>{const[_e,et]=reactExports.useState(!1),{setAuthUser:rt}=useAuthContext();return{loading:_e,logout:async()=>{et(!0);try{const pt=await(await fetch("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json"}})).json();if(pt.error)throw new Error(pt.error);localStorage.removeItem("chat-user"),rt(null)}catch(ut){_t.error(ut.message)}finally{et(!1)}}}},LogoutButton=()=>{const{loading:_e,logout:et}=useLogout();return jsxRuntimeExports.jsx("div",{className:"mt-auto",children:_e?jsxRuntimeExports.jsx("span",{className:"loading loading-spinner"}):jsxRuntimeExports.jsx(BiLogOut,{className:"w-6 h-6 text-black cursor-pointer",onClick:et})})};function IoSearchSharp(_e){return GenIcon({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 428 339.92 303.9a160.48 160.48 0 0 0 30.72-94.58C370.64 120.37 298.27 48 209.32 48S48 120.37 48 209.32s72.37 161.32 161.32 161.32a160.48 160.48 0 0 0 94.58-30.72L428 464zM209.32 319.69a110.38 110.38 0 1 1 110.37-110.37 110.5 110.5 0 0 1-110.37 110.37z"},child:[]}]})(_e)}const SearchInput=()=>{const[_e,et]=reactExports.useState(""),{setSelectedConversation:rt}=useConversation(),[at,ut]=reactExports.useState([]),pt=yt=>{if(yt.preventDefault(),ut([]),!_e)return;if(_e.length<3)return _t.error("Search term must be at least 3 characters long");(async()=>{try{const Pt=await(await fetch(`/api/users/${_e}`)).json();if(Pt.error)throw new Error(Pt.error);ut([Pt]),rt(Pt),et("")}catch(At){_t.error(At.message)}})()};return jsxRuntimeExports.jsxs("form",{onSubmit:pt,className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search…",className:"input input-bordered rounded-full",value:_e,onChange:yt=>et(yt.target.value)}),at.length>0&&jsxRuntimeExports.jsx("div",{className:"border-2 border-gray-300 cursor-pointer hover:bg-blue-500 hover:text-white rounded-md p-2 text-black",children:at.map(yt=>jsxRuntimeExports.jsx("div",{onClick:()=>{rt(yt),ut([]),console.log(yt)},children:yt.username},yt._id))})]}),jsxRuntimeExports.jsx("button",{type:"submit",className:"btn btn-circle bg-sky-500 text-white",children:jsxRuntimeExports.jsx(IoSearchSharp,{className:"w-6 h-6 outline-none"})})]})},Sidebar=()=>jsxRuntimeExports.jsxs("div",{className:"w-full md:w-fit border-r h-[100vh] border-gray-300 bg-white p-4 flex flex-col",children:[jsxRuntimeExports.jsx(SearchInput,{}),jsxRuntimeExports.jsx("div",{className:"divider border-t border-gray-300 my-4"}),jsxRuntimeExports.jsx(Conversations,{}),jsxRuntimeExports.jsx("div",{className:"mt-auto",children:jsxRuntimeExports.jsx(LogoutButton,{})})]}),Home=()=>{const[_e,et]=reactExports.useState(!1),[rt,at]=reactExports.useState(!1),{selectedConversation:ut,setSelectedConversation:pt}=useConversation();return reactExports.useEffect(()=>{const yt=()=>{window.innerWidth<768?at(!0):at(!1)};return yt(),window.addEventListener("resize",yt),()=>window.removeEventListener("resize",yt)},[]),reactExports.useEffect(()=>{const ct=new URLSearchParams(window.location.search).get("id");ct&&(async()=>{try{const kt=await(await fetch(`/api/users/user/${ct}`)).json();if(kt.error)throw new Error(kt.error);pt([kt]),pt(kt),setSearch("")}catch(Pt){toast.error(Pt.message)}})().then(()=>{console.log("Conversation fetched")})},[]),jsxRuntimeExports.jsxs("div",{className:"relative flex flex-col md:flex-row h-screen",children:[rt&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-blue-600 text-white p-2 shadow-md md:hidden",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold",children:"Chat App"}),jsxRuntimeExports.jsx("button",{className:"p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-white",onClick:()=>et(!0),children:jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16m-7 6h7"})})})]}),rt&&jsxRuntimeExports.jsxs("div",{className:`fixed inset-y-0 left-0 w-[95vw] bg-gray-800 text-white z-50 transform transition-transform duration-300 ease-in-out md:static md:translate-x-0 ${_e?"translate-x-0":"-translate-x-full"}`,children:[jsxRuntimeExports.jsx(Sidebar,{}),jsxRuntimeExports.jsx("button",{className:"absolute top-4 right-4 p-2 bg-gray-700 rounded-full text-white md:hidden",onClick:()=>et(!1),children:jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 bg-gray-100 h-[100vh] w-[100vw] rounded-xl",children:jsxRuntimeExports.jsxs("div",{className:"flex h-full rounded-lg overflow-hidden bg-gray-400 bg-clip-padding backdrop-filter backdrop-blur-lg bg-opacity-0",children:[!rt&&jsxRuntimeExports.jsx(Sidebar,{}),jsxRuntimeExports.jsx(MessageContainer,{})]})}),rt&&_e&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:()=>et(!1)})]})},useLogin=()=>{const[_e,et]=reactExports.useState(!1),{setAuthUser:rt}=useAuthContext();return{loading:_e,login:async(ut,pt)=>{if(handleInputErrors$1(ut,pt)){et(!0);try{const At=await(await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:ut,password:pt})})).json();if(At.error)throw new Error(At.error);localStorage.setItem("chat-user",JSON.stringify(At)),rt(At)}catch(ct){_t.error(ct.message)}finally{et(!1)}}}}};function handleInputErrors$1(_e,et){return!_e||!et?(_t.error("Please fill in all fields"),!1):!0}const Login=()=>{const[_e,et]=reactExports.useState(""),[rt,at]=reactExports.useState(""),{loading:ut,login:pt}=useLogin(),yt=async ct=>{ct.preventDefault(),await pt(_e,rt)};return jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center justify-center min-w-96 mx-auto",children:jsxRuntimeExports.jsxs("div",{className:"w-full p-6 rounded-lg shadow-md bg-gray-400 bg-clip-padding backdrop-filter backdrop-blur-lg bg-opacity-0",children:[jsxRuntimeExports.jsxs("h1",{className:"text-3xl font-semibold text-center text-gray-300",children:["Login",jsxRuntimeExports.jsx("span",{className:"text-blue-500",children:" PrintOnGo"})]}),jsxRuntimeExports.jsxs("form",{onSubmit:yt,children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"label p-2",children:jsxRuntimeExports.jsx("span",{className:"text-base label-text",children:"Username"})}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Enter username",className:"w-full input input-bordered h-10",value:_e,onChange:ct=>et(ct.target.value)})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"label",children:jsxRuntimeExports.jsx("span",{className:"text-base label-text",children:"Password"})}),jsxRuntimeExports.jsx("input",{type:"password",placeholder:"Enter Password",className:"w-full input input-bordered h-10",value:rt,onChange:ct=>at(ct.target.value)})]}),jsxRuntimeExports.jsxs(Link,{to:"/signup",className:"text-sm  hover:underline hover:text-blue-600 mt-2 inline-block",children:["Don't"," have an account?"]}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("button",{className:"btn btn-block btn-sm mt-2",disabled:ut,children:ut?jsxRuntimeExports.jsx("span",{className:"loading loading-spinner "}):"Login"})})]})]})})},useSignup=()=>{const[_e,et]=reactExports.useState(!1),{setAuthUser:rt}=useAuthContext();return{loading:_e,signup:async({fullName:ut,username:pt,password:yt,confirmPassword:ct,role:At,profilePic:Pt,latitude:kt,longitude:Lt})=>{if(handleInputErrors({fullName:ut,username:pt,password:yt,confirmPassword:ct,role:At,profilePic:Pt,latitude:kt,longitude:Lt})){et(!0);try{const Jt=await(await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullName:ut,username:pt,password:yt,confirmPassword:ct,role:At,profilePic:Pt,latitude:kt,longitude:Lt})})).json();if(Jt.error)throw new Error(Jt.error);localStorage.setItem("chat-user",JSON.stringify(Jt)),rt(Jt)}catch(Qt){_t.error(Qt.message)}finally{et(!1)}}}}};function handleInputErrors({fullName:_e,username:et,password:rt,confirmPassword:at}){return!_e||!et||!rt||!at?(_t.error("Please fill in all fields"),!1):rt!==at?(_t.error("Passwords do not match"),!1):rt.length<6?(_t.error("Password must be at least 6 characters"),!1):!0}const SignUp=()=>{const[_e,et]=reactExports.useState({fullName:"",username:"",password:"",confirmPassword:"",role:"user",profilePic:null,latitude:null,longitude:null}),{loading:rt,signup:at}=useSignup(),ut=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(At=>{et({..._e,latitude:At.coords.latitude,longitude:At.coords.longitude})},At=>{console.error("Error fetching location: ",At),alert("Unable to fetch location. Please check location permissions.")}):alert("Geolocation is not supported by this browser.")},pt=At=>{et({..._e,role:At.target.value})},yt=async At=>{const Pt=At.target.files[0];if(Pt){const kt=ref(storage,`files/${Pt.name}-${v4()}`);try{const Lt=await uploadBytes(kt,Pt),Mt=await getDownloadURL(Lt.ref);et({..._e,profilePic:Mt})}catch(Lt){console.error("Error uploading file:",Lt),alert("Error uploading file. Please try again.")}}},ct=async At=>{At.preventDefault(),console.log(_e),await at(_e)};return jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center justify-center min-w-96 mx-auto",children:jsxRuntimeExports.jsxs("div",{className:"w-full p-6 rounded-lg shadow-md bg-gray-400 bg-clip-padding backdrop-filter backdrop-blur-lg bg-opacity-0",children:[jsxRuntimeExports.jsxs("h1",{className:"text-3xl font-semibold text-center text-gray-300",children:["Sign Up ",jsxRuntimeExports.jsx("span",{className:"text-blue-500",children:" PrintOnGo"})]}),jsxRuntimeExports.jsxs("form",{onSubmit:ct,encType:"multipart/form-data",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"label p-2",children:jsxRuntimeExports.jsx("span",{className:"text-base label-text",children:"Full Name"})}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"John Doe",className:"w-full input input-bordered h-10",value:_e.fullName,onChange:At=>et({..._e,fullName:At.target.value})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"label p-2",children:jsxRuntimeExports.jsx("span",{className:"text-base label-text",children:"Username"})}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"johndoe",className:"w-full input input-bordered h-10",value:_e.username,onChange:At=>et({..._e,username:At.target.value})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"label",children:jsxRuntimeExports.jsx("span",{className:"text-base label-text",children:"Password"})}),jsxRuntimeExports.jsx("input",{type:"password",placeholder:"Enter Password",className:"w-full input input-bordered h-10",value:_e.password,onChange:At=>et({..._e,password:At.target.value})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"label",children:jsxRuntimeExports.jsx("span",{className:"text-base label-text",children:"Confirm Password"})}),jsxRuntimeExports.jsx("input",{type:"password",placeholder:"Confirm Password",className:"w-full input input-bordered h-10",value:_e.confirmPassword,onChange:At=>et({..._e,confirmPassword:At.target.value})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"label p-2",children:jsxRuntimeExports.jsx("span",{className:"text-base label-text",children:"Role"})}),jsxRuntimeExports.jsxs("select",{className:"w-full select select-bordered h-10",value:_e.role,onChange:pt,children:[jsxRuntimeExports.jsx("option",{value:"user",children:"User"}),jsxRuntimeExports.jsx("option",{value:"shop",children:"Shop"})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsx("button",{type:"button",className:"btn btn-sm border border-slate-700",onClick:ut,children:"Fetch Location"}),_e.latitude&&_e.longitude&&jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Location: ",_e.latitude,", ",_e.longitude]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-2",children:[jsxRuntimeExports.jsx("label",{className:"label p-2",children:jsxRuntimeExports.jsx("span",{className:"text-base label-text",children:"Profile Picture"})}),jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",className:"w-full file-input file-input-bordered h-10",onChange:yt})]}),jsxRuntimeExports.jsx(Link,{to:"/login",className:"text-sm hover:underline hover:text-blue-600 mt-2 inline-block",children:"Already have an account?"}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("button",{className:"btn btn-block btn-sm mt-2 border border-slate-700",disabled:rt,children:rt?jsxRuntimeExports.jsx("span",{className:"loading loading-spinner"}):"Sign Up"})})]})]})})};var maplibreGl={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(_e,et){(function(rt,at){_e.exports=at()})(commonjsGlobal,function(){var rt={},at={};function ut(yt,ct,At){if(at[yt]=At,yt==="index"){var Pt="var sharedModule = {}; ("+at.shared+")(sharedModule); ("+at.worker+")(sharedModule);",kt={};return at.shared(kt),at.index(rt,kt),typeof window<"u"&&rt.setWorkerUrl(window.URL.createObjectURL(new Blob([Pt],{type:"text/javascript"}))),rt}}ut("shared",["exports"],function(yt){function ct(it,nt,st,lt){return new(st||(st=Promise))(function(ft,vt){function xt(Ct){try{Et(lt.next(Ct))}catch(Dt){vt(Dt)}}function bt(Ct){try{Et(lt.throw(Ct))}catch(Dt){vt(Dt)}}function Et(Ct){var Dt;Ct.done?ft(Ct.value):(Dt=Ct.value,Dt instanceof st?Dt:new st(function(Vt){Vt(Dt)})).then(xt,bt)}Et((lt=lt.apply(it,nt||[])).next())})}function At(it){return it&&it.__esModule&&Object.prototype.hasOwnProperty.call(it,"default")?it.default:it}typeof SuppressedError=="function"&&SuppressedError;var Pt=kt;function kt(it,nt){this.x=it,this.y=nt}kt.prototype={clone:function(){return new kt(this.x,this.y)},add:function(it){return this.clone()._add(it)},sub:function(it){return this.clone()._sub(it)},multByPoint:function(it){return this.clone()._multByPoint(it)},divByPoint:function(it){return this.clone()._divByPoint(it)},mult:function(it){return this.clone()._mult(it)},div:function(it){return this.clone()._div(it)},rotate:function(it){return this.clone()._rotate(it)},rotateAround:function(it,nt){return this.clone()._rotateAround(it,nt)},matMult:function(it){return this.clone()._matMult(it)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(it){return this.x===it.x&&this.y===it.y},dist:function(it){return Math.sqrt(this.distSqr(it))},distSqr:function(it){var nt=it.x-this.x,st=it.y-this.y;return nt*nt+st*st},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(it){return Math.atan2(this.y-it.y,this.x-it.x)},angleWith:function(it){return this.angleWithSep(it.x,it.y)},angleWithSep:function(it,nt){return Math.atan2(this.x*nt-this.y*it,this.x*it+this.y*nt)},_matMult:function(it){var nt=it[2]*this.x+it[3]*this.y;return this.x=it[0]*this.x+it[1]*this.y,this.y=nt,this},_add:function(it){return this.x+=it.x,this.y+=it.y,this},_sub:function(it){return this.x-=it.x,this.y-=it.y,this},_mult:function(it){return this.x*=it,this.y*=it,this},_div:function(it){return this.x/=it,this.y/=it,this},_multByPoint:function(it){return this.x*=it.x,this.y*=it.y,this},_divByPoint:function(it){return this.x/=it.x,this.y/=it.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var it=this.y;return this.y=this.x,this.x=-it,this},_rotate:function(it){var nt=Math.cos(it),st=Math.sin(it),lt=st*this.x+nt*this.y;return this.x=nt*this.x-st*this.y,this.y=lt,this},_rotateAround:function(it,nt){var st=Math.cos(it),lt=Math.sin(it),ft=nt.y+lt*(this.x-nt.x)+st*(this.y-nt.y);return this.x=nt.x+st*(this.x-nt.x)-lt*(this.y-nt.y),this.y=ft,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},kt.convert=function(it){return it instanceof kt?it:Array.isArray(it)?new kt(it[0],it[1]):it};var Lt=At(Pt),Mt=Qt;function Qt(it,nt,st,lt){this.cx=3*it,this.bx=3*(st-it)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*nt,this.by=3*(lt-nt)-this.cy,this.ay=1-this.cy-this.by,this.p1x=it,this.p1y=nt,this.p2x=st,this.p2y=lt}Qt.prototype={sampleCurveX:function(it){return((this.ax*it+this.bx)*it+this.cx)*it},sampleCurveY:function(it){return((this.ay*it+this.by)*it+this.cy)*it},sampleCurveDerivativeX:function(it){return(3*this.ax*it+2*this.bx)*it+this.cx},solveCurveX:function(it,nt){if(nt===void 0&&(nt=1e-6),it<0)return 0;if(it>1)return 1;for(var st=it,lt=0;lt<8;lt++){var ft=this.sampleCurveX(st)-it;if(Math.abs(ft)<nt)return st;var vt=this.sampleCurveDerivativeX(st);if(Math.abs(vt)<1e-6)break;st-=ft/vt}var xt=0,bt=1;for(st=it,lt=0;lt<20&&(ft=this.sampleCurveX(st),!(Math.abs(ft-it)<nt));lt++)it>ft?xt=st:bt=st,st=.5*(bt-xt)+xt;return st},solve:function(it,nt){return this.sampleCurveY(this.solveCurveX(it,nt))}};var Jt=At(Mt);let sn,tn;function Bt(){return sn==null&&(sn=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),sn}function zt(){if(tn==null&&(tn=!1,Bt())){const nt=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(nt){for(let lt=0;lt<5*5;lt++){const ft=4*lt;nt.fillStyle=`rgb(${ft},${ft+1},${ft+2})`,nt.fillRect(lt%5,Math.floor(lt/5),1,1)}const st=nt.getImageData(0,0,5,5).data;for(let lt=0;lt<5*5*4;lt++)if(lt%4!=3&&st[lt]!==lt){tn=!0;break}}}return tn||!1}function Ht(it,nt,st,lt){const ft=new Jt(it,nt,st,lt);return vt=>ft.solve(vt)}const nn=Ht(.25,.1,.25,1);function Ot(it,nt,st){return Math.min(st,Math.max(nt,it))}function Kt(it,nt,st){const lt=st-nt,ft=((it-nt)%lt+lt)%lt+nt;return ft===nt?st:ft}function mn(it,...nt){for(const st of nt)for(const lt in st)it[lt]=st[lt];return it}let hn=1;function Yt(it,nt,st){const lt={};for(const ft in it)lt[ft]=nt.call(this,it[ft],ft,it);return lt}function vn(it,nt,st){const lt={};for(const ft in it)nt.call(this,it[ft],ft,it)&&(lt[ft]=it[ft]);return lt}function fn(it){return Array.isArray(it)?it.map(fn):typeof it=="object"&&it?Yt(it,fn):it}const Wn={};function Xn(it){Wn[it]||(typeof console<"u"&&console.warn(it),Wn[it]=!0)}function Sn(it,nt,st){return(st.y-it.y)*(nt.x-it.x)>(nt.y-it.y)*(st.x-it.x)}function _i(it){return typeof WorkerGlobalScope<"u"&&it!==void 0&&it instanceof WorkerGlobalScope}let gr=null;function br(it){return typeof ImageBitmap<"u"&&it instanceof ImageBitmap}const Pn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function lr(it,nt,st,lt,ft){return ct(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const vt=new VideoFrame(it,{timestamp:0});try{const xt=vt==null?void 0:vt.format;if(!xt||!xt.startsWith("BGR")&&!xt.startsWith("RGB"))throw new Error(`Unrecognized format ${xt}`);const bt=xt.startsWith("BGR"),Et=new Uint8ClampedArray(lt*ft*4);if(yield vt.copyTo(Et,function(Ct,Dt,Vt,en,cn){const gn=4*Math.max(-Dt,0),bn=(Math.max(0,Vt)-Vt)*en*4+gn,Ln=4*en,Vn=Math.max(0,Dt),vr=Math.max(0,Vt);return{rect:{x:Vn,y:vr,width:Math.min(Ct.width,Dt+en)-Vn,height:Math.min(Ct.height,Vt+cn)-vr},layout:[{offset:bn,stride:Ln}]}}(it,nt,st,lt,ft)),bt)for(let Ct=0;Ct<Et.length;Ct+=4){const Dt=Et[Ct];Et[Ct]=Et[Ct+2],Et[Ct+2]=Dt}return Et}finally{vt.close()}})}let xr,Dr;const $r="AbortError";function An(){return new Error($r)}const Nt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Zt(it){return Nt.REGISTERED_PROTOCOLS[it.substring(0,it.indexOf("://"))]}const $t="global-dispatcher";class rn extends Error{constructor(nt,st,lt,ft){super(`AJAXError: ${st} (${nt}): ${lt}`),this.status=nt,this.statusText=st,this.url=lt,this.body=ft}}const an=()=>_i(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,En=function(it,nt){if(/:\/\//.test(it.url)&&!/^https?:|^file:/.test(it.url)){const lt=Zt(it.url);if(lt)return lt(it,nt);if(_i(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:it,targetMapId:$t},nt)}if(!(/^file:/.test(st=it.url)||/^file:/.test(an())&&!/^\w+:/.test(st))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(lt,ft){return ct(this,void 0,void 0,function*(){const vt=new Request(lt.url,{method:lt.method||"GET",body:lt.body,credentials:lt.credentials,headers:lt.headers,cache:lt.cache,referrer:an(),signal:ft.signal});lt.type!=="json"||vt.headers.has("Accept")||vt.headers.set("Accept","application/json");const xt=yield fetch(vt);if(!xt.ok){const Ct=yield xt.blob();throw new rn(xt.status,xt.statusText,lt.url,Ct)}let bt;bt=lt.type==="arrayBuffer"||lt.type==="image"?xt.arrayBuffer():lt.type==="json"?xt.json():xt.text();const Et=yield bt;if(ft.signal.aborted)throw An();return{data:Et,cacheControl:xt.headers.get("Cache-Control"),expires:xt.headers.get("Expires")}})}(it,nt);if(_i(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:it,mustQueue:!0,targetMapId:$t},nt)}var st;return function(lt,ft){return new Promise((vt,xt)=>{var bt;const Et=new XMLHttpRequest;Et.open(lt.method||"GET",lt.url,!0),lt.type!=="arrayBuffer"&&lt.type!=="image"||(Et.responseType="arraybuffer");for(const Ct in lt.headers)Et.setRequestHeader(Ct,lt.headers[Ct]);lt.type==="json"&&(Et.responseType="text",!((bt=lt.headers)===null||bt===void 0)&&bt.Accept||Et.setRequestHeader("Accept","application/json")),Et.withCredentials=lt.credentials==="include",Et.onerror=()=>{xt(new Error(Et.statusText))},Et.onload=()=>{if(!ft.signal.aborted)if((Et.status>=200&&Et.status<300||Et.status===0)&&Et.response!==null){let Ct=Et.response;if(lt.type==="json")try{Ct=JSON.parse(Et.response)}catch(Dt){return void xt(Dt)}vt({data:Ct,cacheControl:Et.getResponseHeader("Cache-Control"),expires:Et.getResponseHeader("Expires")})}else{const Ct=new Blob([Et.response],{type:Et.getResponseHeader("Content-Type")});xt(new rn(Et.status,Et.statusText,lt.url,Ct))}},ft.signal.addEventListener("abort",()=>{Et.abort(),xt(An())}),Et.send(lt.body)})}(it,nt)};function Mn(it){if(!it||it.indexOf("://")<=0||it.indexOf("data:image/")===0||it.indexOf("blob:")===0)return!0;const nt=new URL(it),st=window.location;return nt.protocol===st.protocol&&nt.host===st.host}function jn(it,nt,st){st[it]&&st[it].indexOf(nt)!==-1||(st[it]=st[it]||[],st[it].push(nt))}function dr(it,nt,st){if(st&&st[it]){const lt=st[it].indexOf(nt);lt!==-1&&st[it].splice(lt,1)}}class cr{constructor(nt,st={}){mn(this,st),this.type=nt}}class wr extends cr{constructor(nt,st={}){super("error",mn({error:nt},st))}}class Rr{on(nt,st){return this._listeners=this._listeners||{},jn(nt,st,this._listeners),this}off(nt,st){return dr(nt,st,this._listeners),dr(nt,st,this._oneTimeListeners),this}once(nt,st){return st?(this._oneTimeListeners=this._oneTimeListeners||{},jn(nt,st,this._oneTimeListeners),this):new Promise(lt=>this.once(nt,lt))}fire(nt,st){typeof nt=="string"&&(nt=new cr(nt,st||{}));const lt=nt.type;if(this.listens(lt)){nt.target=this;const ft=this._listeners&&this._listeners[lt]?this._listeners[lt].slice():[];for(const bt of ft)bt.call(this,nt);const vt=this._oneTimeListeners&&this._oneTimeListeners[lt]?this._oneTimeListeners[lt].slice():[];for(const bt of vt)dr(lt,bt,this._oneTimeListeners),bt.call(this,nt);const xt=this._eventedParent;xt&&(mn(nt,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),xt.fire(nt))}else nt instanceof wr&&console.error(nt.error);return this}listens(nt){return this._listeners&&this._listeners[nt]&&this._listeners[nt].length>0||this._oneTimeListeners&&this._oneTimeListeners[nt]&&this._oneTimeListeners[nt].length>0||this._eventedParent&&this._eventedParent.listens(nt)}setEventedParent(nt,st){return this._eventedParent=nt,this._eventedParentData=st,this}}var On={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Mr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ts(it,nt){const st={};for(const lt in it)lt!=="ref"&&(st[lt]=it[lt]);return Mr.forEach(lt=>{lt in nt&&(st[lt]=nt[lt])}),st}function Jr(it,nt){if(Array.isArray(it)){if(!Array.isArray(nt)||it.length!==nt.length)return!1;for(let st=0;st<it.length;st++)if(!Jr(it[st],nt[st]))return!1;return!0}if(typeof it=="object"&&it!==null&&nt!==null){if(typeof nt!="object"||Object.keys(it).length!==Object.keys(nt).length)return!1;for(const st in it)if(!Jr(it[st],nt[st]))return!1;return!0}return it===nt}function jr(it,nt){it.push(nt)}function ss(it,nt,st){jr(st,{command:"addSource",args:[it,nt[it]]})}function Lr(it,nt,st){jr(nt,{command:"removeSource",args:[it]}),st[it]=!0}function hr(it,nt,st,lt){Lr(it,st,lt),ss(it,nt,st)}function or(it,nt,st){let lt;for(lt in it[st])if(Object.prototype.hasOwnProperty.call(it[st],lt)&&lt!=="data"&&!Jr(it[st][lt],nt[st][lt]))return!1;for(lt in nt[st])if(Object.prototype.hasOwnProperty.call(nt[st],lt)&&lt!=="data"&&!Jr(it[st][lt],nt[st][lt]))return!1;return!0}function Tr(it,nt,st,lt,ft,vt){it=it||{},nt=nt||{};for(const xt in it)Object.prototype.hasOwnProperty.call(it,xt)&&(Jr(it[xt],nt[xt])||st.push({command:vt,args:[lt,xt,nt[xt],ft]}));for(const xt in nt)Object.prototype.hasOwnProperty.call(nt,xt)&&!Object.prototype.hasOwnProperty.call(it,xt)&&(Jr(it[xt],nt[xt])||st.push({command:vt,args:[lt,xt,nt[xt],ft]}))}function Zr(it){return it.id}function qr(it,nt){return it[nt.id]=nt,it}class Cr{constructor(nt,st,lt,ft){this.message=(nt?`${nt}: `:"")+lt,ft&&(this.identifier=ft),st!=null&&st.__line__&&(this.line=st.__line__)}}function ws(it,...nt){for(const st of nt)for(const lt in st)it[lt]=st[lt];return it}class ds extends Error{constructor(nt,st){super(st),this.message=st,this.key=nt}}class Ts{constructor(nt,st=[]){this.parent=nt,this.bindings={};for(const[lt,ft]of st)this.bindings[lt]=ft}concat(nt){return new Ts(this,nt)}get(nt){if(this.bindings[nt])return this.bindings[nt];if(this.parent)return this.parent.get(nt);throw new Error(`${nt} not found in scope.`)}has(nt){return!!this.bindings[nt]||!!this.parent&&this.parent.has(nt)}}const Ms={kind:"null"},Pr={kind:"number"},ns={kind:"string"},tr={kind:"boolean"},Yn={kind:"color"},qn={kind:"object"},Er={kind:"value"},kr={kind:"collator"},Us={kind:"formatted"},lo={kind:"padding"},rr={kind:"resolvedImage"},_n={kind:"variableAnchorOffsetCollection"};function Wt(it,nt){return{kind:"array",itemType:it,N:nt}}function jt(it){if(it.kind==="array"){const nt=jt(it.itemType);return typeof it.N=="number"?`array<${nt}, ${it.N}>`:it.itemType.kind==="value"?"array":`array<${nt}>`}return it.kind}const ln=[Ms,Pr,ns,tr,Yn,Us,qn,Wt(Er),lo,rr,_n];function xn(it,nt){if(nt.kind==="error")return null;if(it.kind==="array"){if(nt.kind==="array"&&(nt.N===0&&nt.itemType.kind==="value"||!xn(it.itemType,nt.itemType))&&(typeof it.N!="number"||it.N===nt.N))return null}else{if(it.kind===nt.kind)return null;if(it.kind==="value"){for(const st of ln)if(!xn(st,nt))return null}}return`Expected ${jt(it)} but found ${jt(nt)} instead.`}function Nn(it,nt){return nt.some(st=>st.kind===it.kind)}function Tn(it,nt){return nt.some(st=>st==="null"?it===null:st==="array"?Array.isArray(it):st==="object"?it&&!Array.isArray(it)&&typeof it=="object":st===typeof it)}function Kn(it,nt){return it.kind==="array"&&nt.kind==="array"?it.itemType.kind===nt.itemType.kind&&typeof it.N=="number":it.kind===nt.kind}const Cn=.96422,un=.82521,Rt=4/29,qt=6/29,yn=3*qt*qt,Rn=qt*qt*qt,zn=Math.PI/180,ir=180/Math.PI;function Sr(it){return(it%=360)<0&&(it+=360),it}function Nr([it,nt,st,lt]){let ft,vt;const xt=ps((.2225045*(it=Fr(it))+.7168786*(nt=Fr(nt))+.0606169*(st=Fr(st)))/1);it===nt&&nt===st?ft=vt=xt:(ft=ps((.4360747*it+.3850649*nt+.1430804*st)/Cn),vt=ps((.0139322*it+.0971045*nt+.7141733*st)/un));const bt=116*xt-16;return[bt<0?0:bt,500*(ft-xt),200*(xt-vt),lt]}function Fr(it){return it<=.04045?it/12.92:Math.pow((it+.055)/1.055,2.4)}function ps(it){return it>Rn?Math.pow(it,1/3):it/yn+Rt}function Gr([it,nt,st,lt]){let ft=(it+16)/116,vt=isNaN(nt)?ft:ft+nt/500,xt=isNaN(st)?ft:ft-st/200;return ft=1*is(ft),vt=Cn*is(vt),xt=un*is(xt),[Ur(3.1338561*vt-1.6168667*ft-.4906146*xt),Ur(-.9787684*vt+1.9161415*ft+.033454*xt),Ur(.0719453*vt-.2289914*ft+1.4052427*xt),lt]}function Ur(it){return(it=it<=.00304?12.92*it:1.055*Math.pow(it,1/2.4)-.055)<0?0:it>1?1:it}function is(it){return it>qt?it*it*it:yn*(it-Rt)}function fs(it){return parseInt(it.padEnd(2,it),16)/255}function zs(it,nt){return Gs(nt?it/100:it,0,1)}function Gs(it,nt,st){return Math.min(Math.max(nt,it),st)}function go(it){return!it.some(Number.isNaN)}const Ao={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class oo{constructor(nt,st,lt,ft=1,vt=!0){this.r=nt,this.g=st,this.b=lt,this.a=ft,vt||(this.r*=ft,this.g*=ft,this.b*=ft,ft||this.overwriteGetter("rgb",[nt,st,lt,ft]))}static parse(nt){if(nt instanceof oo)return nt;if(typeof nt!="string")return;const st=function(lt){if((lt=lt.toLowerCase().trim())==="transparent")return[0,0,0,0];const ft=Ao[lt];if(ft){const[xt,bt,Et]=ft;return[xt/255,bt/255,Et/255,1]}if(lt.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(lt)){const xt=lt.length<6?1:2;let bt=1;return[fs(lt.slice(bt,bt+=xt)),fs(lt.slice(bt,bt+=xt)),fs(lt.slice(bt,bt+=xt)),fs(lt.slice(bt,bt+xt)||"ff")]}if(lt.startsWith("rgb")){const xt=lt.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(xt){const[bt,Et,Ct,Dt,Vt,en,cn,gn,bn,Ln,Vn,vr]=xt,er=[Dt||" ",cn||" ",Ln].join("");if(er==="  "||er==="  /"||er===",,"||er===",,,"){const _r=[Ct,en,bn].join(""),Ir=_r==="%%%"?100:_r===""?255:0;if(Ir){const Yr=[Gs(+Et/Ir,0,1),Gs(+Vt/Ir,0,1),Gs(+gn/Ir,0,1),Vn?zs(+Vn,vr):1];if(go(Yr))return Yr}}return}}const vt=lt.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(vt){const[xt,bt,Et,Ct,Dt,Vt,en,cn,gn]=vt,bn=[Et||" ",Dt||" ",en].join("");if(bn==="  "||bn==="  /"||bn===",,"||bn===",,,"){const Ln=[+bt,Gs(+Ct,0,100),Gs(+Vt,0,100),cn?zs(+cn,gn):1];if(go(Ln))return function([Vn,vr,er,_r]){function Ir(Yr){const gs=(Yr+Vn/30)%12,Hs=vr*Math.min(er,1-er);return er-Hs*Math.max(-1,Math.min(gs-3,9-gs,1))}return Vn=Sr(Vn),vr/=100,er/=100,[Ir(0),Ir(8),Ir(4),_r]}(Ln)}}}(nt);return st?new oo(...st,!1):void 0}get rgb(){const{r:nt,g:st,b:lt,a:ft}=this,vt=ft||1/0;return this.overwriteGetter("rgb",[nt/vt,st/vt,lt/vt,ft])}get hcl(){return this.overwriteGetter("hcl",function(nt){const[st,lt,ft,vt]=Nr(nt),xt=Math.sqrt(lt*lt+ft*ft);return[Math.round(1e4*xt)?Sr(Math.atan2(ft,lt)*ir):NaN,xt,st,vt]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nr(this.rgb))}overwriteGetter(nt,st){return Object.defineProperty(this,nt,{value:st}),st}toString(){const[nt,st,lt,ft]=this.rgb;return`rgba(${[nt,st,lt].map(vt=>Math.round(255*vt)).join(",")},${ft})`}}oo.black=new oo(0,0,0,1),oo.white=new oo(1,1,1,1),oo.transparent=new oo(0,0,0,0),oo.red=new oo(1,0,0,1);class Cl{constructor(nt,st,lt){this.sensitivity=nt?st?"variant":"case":st?"accent":"base",this.locale=lt,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(nt,st){return this.collator.compare(nt,st)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class eu{constructor(nt,st,lt,ft,vt){this.text=nt,this.image=st,this.scale=lt,this.fontStack=ft,this.textColor=vt}}class yl{constructor(nt){this.sections=nt}static fromString(nt){return new yl([new eu(nt,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(nt=>nt.text.length!==0||nt.image&&nt.image.name.length!==0)}static factory(nt){return nt instanceof yl?nt:yl.fromString(nt)}toString(){return this.sections.length===0?"":this.sections.map(nt=>nt.text).join("")}}class Gl{constructor(nt){this.values=nt.slice()}static parse(nt){if(nt instanceof Gl)return nt;if(typeof nt=="number")return new Gl([nt,nt,nt,nt]);if(Array.isArray(nt)&&!(nt.length<1||nt.length>4)){for(const st of nt)if(typeof st!="number")return;switch(nt.length){case 1:nt=[nt[0],nt[0],nt[0],nt[0]];break;case 2:nt=[nt[0],nt[1],nt[0],nt[1]];break;case 3:nt=[nt[0],nt[1],nt[2],nt[1]]}return new Gl(nt)}}toString(){return JSON.stringify(this.values)}}const h_=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class tu{constructor(nt){this.values=nt.slice()}static parse(nt){if(nt instanceof tu)return nt;if(Array.isArray(nt)&&!(nt.length<1)&&nt.length%2==0){for(let st=0;st<nt.length;st+=2){const lt=nt[st],ft=nt[st+1];if(typeof lt!="string"||!h_.has(lt)||!Array.isArray(ft)||ft.length!==2||typeof ft[0]!="number"||typeof ft[1]!="number")return}return new tu(nt)}}toString(){return JSON.stringify(this.values)}}class Xl{constructor(nt){this.name=nt.name,this.available=nt.available}toString(){return this.name}static fromString(nt){return nt?new Xl({name:nt,available:!1}):null}}function ku(it,nt,st,lt){return typeof it=="number"&&it>=0&&it<=255&&typeof nt=="number"&&nt>=0&&nt<=255&&typeof st=="number"&&st>=0&&st<=255?lt===void 0||typeof lt=="number"&&lt>=0&&lt<=1?null:`Invalid rgba value [${[it,nt,st,lt].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof lt=="number"?[it,nt,st,lt]:[it,nt,st]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bu(it){if(it===null||typeof it=="string"||typeof it=="boolean"||typeof it=="number"||it instanceof oo||it instanceof Cl||it instanceof yl||it instanceof Gl||it instanceof tu||it instanceof Xl)return!0;if(Array.isArray(it)){for(const nt of it)if(!Bu(nt))return!1;return!0}if(typeof it=="object"){for(const nt in it)if(!Bu(it[nt]))return!1;return!0}return!1}function Zo(it){if(it===null)return Ms;if(typeof it=="string")return ns;if(typeof it=="boolean")return tr;if(typeof it=="number")return Pr;if(it instanceof oo)return Yn;if(it instanceof Cl)return kr;if(it instanceof yl)return Us;if(it instanceof Gl)return lo;if(it instanceof tu)return _n;if(it instanceof Xl)return rr;if(Array.isArray(it)){const nt=it.length;let st;for(const lt of it){const ft=Zo(lt);if(st){if(st===ft)continue;st=Er;break}st=ft}return Wt(st||Er,nt)}return qn}function _p(it){const nt=typeof it;return it===null?"":nt==="string"||nt==="number"||nt==="boolean"?String(it):it instanceof oo||it instanceof yl||it instanceof Gl||it instanceof tu||it instanceof Xl?it.toString():JSON.stringify(it)}class Pl{constructor(nt,st){this.type=nt,this.value=st}static parse(nt,st){if(nt.length!==2)return st.error(`'literal' expression requires exactly one argument, but found ${nt.length-1} instead.`);if(!Bu(nt[1]))return st.error("invalid value");const lt=nt[1];let ft=Zo(lt);const vt=st.expectedType;return ft.kind!=="array"||ft.N!==0||!vt||vt.kind!=="array"||typeof vt.N=="number"&&vt.N!==0||(ft=vt),new Pl(ft,lt)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ko{constructor(nt){this.name="ExpressionEvaluationError",this.message=nt}toJSON(){return this.message}}const $p={string:ns,number:Pr,boolean:tr,object:qn};class hu{constructor(nt,st){this.type=nt,this.args=st}static parse(nt,st){if(nt.length<2)return st.error("Expected at least one argument.");let lt,ft=1;const vt=nt[0];if(vt==="array"){let bt,Et;if(nt.length>2){const Ct=nt[1];if(typeof Ct!="string"||!(Ct in $p)||Ct==="object")return st.error('The item type argument of "array" must be one of string, number, boolean',1);bt=$p[Ct],ft++}else bt=Er;if(nt.length>3){if(nt[2]!==null&&(typeof nt[2]!="number"||nt[2]<0||nt[2]!==Math.floor(nt[2])))return st.error('The length argument to "array" must be a positive integer literal',2);Et=nt[2],ft++}lt=Wt(bt,Et)}else{if(!$p[vt])throw new Error(`Types doesn't contain name = ${vt}`);lt=$p[vt]}const xt=[];for(;ft<nt.length;ft++){const bt=st.parse(nt[ft],ft,Er);if(!bt)return null;xt.push(bt)}return new hu(lt,xt)}evaluate(nt){for(let st=0;st<this.args.length;st++){const lt=this.args[st].evaluate(nt);if(!xn(this.type,Zo(lt)))return lt;if(st===this.args.length-1)throw new Ko(`Expected value to be of type ${jt(this.type)}, but found ${jt(Zo(lt))} instead.`)}throw new Error}eachChild(nt){this.args.forEach(nt)}outputDefined(){return this.args.every(nt=>nt.outputDefined())}}const yp={"to-boolean":tr,"to-color":Yn,"to-number":Pr,"to-string":ns};class du{constructor(nt,st){this.type=nt,this.args=st}static parse(nt,st){if(nt.length<2)return st.error("Expected at least one argument.");const lt=nt[0];if(!yp[lt])throw new Error(`Can't parse ${lt} as it is not part of the known types`);if((lt==="to-boolean"||lt==="to-string")&&nt.length!==2)return st.error("Expected one argument.");const ft=yp[lt],vt=[];for(let xt=1;xt<nt.length;xt++){const bt=st.parse(nt[xt],xt,Er);if(!bt)return null;vt.push(bt)}return new du(ft,vt)}evaluate(nt){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(nt);case"color":{let st,lt;for(const ft of this.args){if(st=ft.evaluate(nt),lt=null,st instanceof oo)return st;if(typeof st=="string"){const vt=nt.parseColor(st);if(vt)return vt}else if(Array.isArray(st)&&(lt=st.length<3||st.length>4?`Invalid rbga value ${JSON.stringify(st)}: expected an array containing either three or four numeric values.`:ku(st[0],st[1],st[2],st[3]),!lt))return new oo(st[0]/255,st[1]/255,st[2]/255,st[3])}throw new Ko(lt||`Could not parse color from value '${typeof st=="string"?st:JSON.stringify(st)}'`)}case"padding":{let st;for(const lt of this.args){st=lt.evaluate(nt);const ft=Gl.parse(st);if(ft)return ft}throw new Ko(`Could not parse padding from value '${typeof st=="string"?st:JSON.stringify(st)}'`)}case"variableAnchorOffsetCollection":{let st;for(const lt of this.args){st=lt.evaluate(nt);const ft=tu.parse(st);if(ft)return ft}throw new Ko(`Could not parse variableAnchorOffsetCollection from value '${typeof st=="string"?st:JSON.stringify(st)}'`)}case"number":{let st=null;for(const lt of this.args){if(st=lt.evaluate(nt),st===null)return 0;const ft=Number(st);if(!isNaN(ft))return ft}throw new Ko(`Could not convert ${JSON.stringify(st)} to number.`)}case"formatted":return yl.fromString(_p(this.args[0].evaluate(nt)));case"resolvedImage":return Xl.fromString(_p(this.args[0].evaluate(nt)));default:return _p(this.args[0].evaluate(nt))}}eachChild(nt){this.args.forEach(nt)}outputDefined(){return this.args.every(nt=>nt.outputDefined())}}const d_=["Unknown","Point","LineString","Polygon"];class vp{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?d_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(nt){let st=this._parseColorCache[nt];return st||(st=this._parseColorCache[nt]=oo.parse(nt)),st}}class ju{constructor(nt,st,lt=[],ft,vt=new Ts,xt=[]){this.registry=nt,this.path=lt,this.key=lt.map(bt=>`[${bt}]`).join(""),this.scope=vt,this.errors=xt,this.expectedType=ft,this._isConstant=st}parse(nt,st,lt,ft,vt={}){return st?this.concat(st,lt,ft)._parse(nt,vt):this._parse(nt,vt)}_parse(nt,st){function lt(ft,vt,xt){return xt==="assert"?new hu(vt,[ft]):xt==="coerce"?new du(vt,[ft]):ft}if(nt!==null&&typeof nt!="string"&&typeof nt!="boolean"&&typeof nt!="number"||(nt=["literal",nt]),Array.isArray(nt)){if(nt.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const ft=nt[0];if(typeof ft!="string")return this.error(`Expression name must be a string, but found ${typeof ft} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const vt=this.registry[ft];if(vt){let xt=vt.parse(nt,this);if(!xt)return null;if(this.expectedType){const bt=this.expectedType,Et=xt.type;if(bt.kind!=="string"&&bt.kind!=="number"&&bt.kind!=="boolean"&&bt.kind!=="object"&&bt.kind!=="array"||Et.kind!=="value")if(bt.kind!=="color"&&bt.kind!=="formatted"&&bt.kind!=="resolvedImage"||Et.kind!=="value"&&Et.kind!=="string")if(bt.kind!=="padding"||Et.kind!=="value"&&Et.kind!=="number"&&Et.kind!=="array")if(bt.kind!=="variableAnchorOffsetCollection"||Et.kind!=="value"&&Et.kind!=="array"){if(this.checkSubtype(bt,Et))return null}else xt=lt(xt,bt,st.typeAnnotation||"coerce");else xt=lt(xt,bt,st.typeAnnotation||"coerce");else xt=lt(xt,bt,st.typeAnnotation||"coerce");else xt=lt(xt,bt,st.typeAnnotation||"assert")}if(!(xt instanceof Pl)&&xt.type.kind!=="resolvedImage"&&this._isConstant(xt)){const bt=new vp;try{xt=new Pl(xt.type,xt.evaluate(bt))}catch(Et){return this.error(Et.message),null}}return xt}return this.error(`Unknown expression "${ft}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(nt===void 0?"'undefined' value invalid. Use null instead.":typeof nt=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof nt} instead.`)}concat(nt,st,lt){const ft=typeof nt=="number"?this.path.concat(nt):this.path,vt=lt?this.scope.concat(lt):this.scope;return new ju(this.registry,this._isConstant,ft,st||null,vt,this.errors)}error(nt,...st){const lt=`${this.key}${st.map(ft=>`[${ft}]`).join("")}`;this.errors.push(new ds(lt,nt))}checkSubtype(nt,st){const lt=xn(nt,st);return lt&&this.error(lt),lt}}class $u{constructor(nt,st){this.type=st.type,this.bindings=[].concat(nt),this.result=st}evaluate(nt){return this.result.evaluate(nt)}eachChild(nt){for(const st of this.bindings)nt(st[1]);nt(this.result)}static parse(nt,st){if(nt.length<4)return st.error(`Expected at least 3 arguments, but found ${nt.length-1} instead.`);const lt=[];for(let vt=1;vt<nt.length-1;vt+=2){const xt=nt[vt];if(typeof xt!="string")return st.error(`Expected string, but found ${typeof xt} instead.`,vt);if(/[^a-zA-Z0-9_]/.test(xt))return st.error("Variable names must contain only alphanumeric characters or '_'.",vt);const bt=st.parse(nt[vt+1],vt+1);if(!bt)return null;lt.push([xt,bt])}const ft=st.parse(nt[nt.length-1],nt.length-1,st.expectedType,lt);return ft?new $u(lt,ft):null}outputDefined(){return this.result.outputDefined()}}class To{constructor(nt,st){this.type=st.type,this.name=nt,this.boundExpression=st}static parse(nt,st){if(nt.length!==2||typeof nt[1]!="string")return st.error("'var' expression requires exactly one string literal argument.");const lt=nt[1];return st.scope.has(lt)?new To(lt,st.scope.get(lt)):st.error(`Unknown variable "${lt}". Make sure "${lt}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(nt){return this.boundExpression.evaluate(nt)}eachChild(){}outputDefined(){return!1}}class xp{constructor(nt,st,lt){this.type=nt,this.index=st,this.input=lt}static parse(nt,st){if(nt.length!==3)return st.error(`Expected 2 arguments, but found ${nt.length-1} instead.`);const lt=st.parse(nt[1],1,Pr),ft=st.parse(nt[2],2,Wt(st.expectedType||Er));return lt&&ft?new xp(ft.type.itemType,lt,ft):null}evaluate(nt){const st=this.index.evaluate(nt),lt=this.input.evaluate(nt);if(st<0)throw new Ko(`Array index out of bounds: ${st} < 0.`);if(st>=lt.length)throw new Ko(`Array index out of bounds: ${st} > ${lt.length-1}.`);if(st!==Math.floor(st))throw new Ko(`Array index must be an integer, but found ${st} instead.`);return lt[st]}eachChild(nt){nt(this.index),nt(this.input)}outputDefined(){return!1}}class dm{constructor(nt,st){this.type=tr,this.needle=nt,this.haystack=st}static parse(nt,st){if(nt.length!==3)return st.error(`Expected 2 arguments, but found ${nt.length-1} instead.`);const lt=st.parse(nt[1],1,Er),ft=st.parse(nt[2],2,Er);return lt&&ft?Nn(lt.type,[tr,ns,Pr,Ms,Er])?new dm(lt,ft):st.error(`Expected first argument to be of type boolean, string, number or null, but found ${jt(lt.type)} instead`):null}evaluate(nt){const st=this.needle.evaluate(nt),lt=this.haystack.evaluate(nt);if(!lt)return!1;if(!Tn(st,["boolean","string","number","null"]))throw new Ko(`Expected first argument to be of type boolean, string, number or null, but found ${jt(Zo(st))} instead.`);if(!Tn(lt,["string","array"]))throw new Ko(`Expected second argument to be of type array or string, but found ${jt(Zo(lt))} instead.`);return lt.indexOf(st)>=0}eachChild(nt){nt(this.needle),nt(this.haystack)}outputDefined(){return!0}}class Zu{constructor(nt,st,lt){this.type=Pr,this.needle=nt,this.haystack=st,this.fromIndex=lt}static parse(nt,st){if(nt.length<=2||nt.length>=5)return st.error(`Expected 3 or 4 arguments, but found ${nt.length-1} instead.`);const lt=st.parse(nt[1],1,Er),ft=st.parse(nt[2],2,Er);if(!lt||!ft)return null;if(!Nn(lt.type,[tr,ns,Pr,Ms,Er]))return st.error(`Expected first argument to be of type boolean, string, number or null, but found ${jt(lt.type)} instead`);if(nt.length===4){const vt=st.parse(nt[3],3,Pr);return vt?new Zu(lt,ft,vt):null}return new Zu(lt,ft)}evaluate(nt){const st=this.needle.evaluate(nt),lt=this.haystack.evaluate(nt);if(!Tn(st,["boolean","string","number","null"]))throw new Ko(`Expected first argument to be of type boolean, string, number or null, but found ${jt(Zo(st))} instead.`);let ft;if(this.fromIndex&&(ft=this.fromIndex.evaluate(nt)),Tn(lt,["string"])){const vt=lt.indexOf(st,ft);return vt===-1?-1:[...lt.slice(0,vt)].length}if(Tn(lt,["array"]))return lt.indexOf(st,ft);throw new Ko(`Expected second argument to be of type array or string, but found ${jt(Zo(lt))} instead.`)}eachChild(nt){nt(this.needle),nt(this.haystack),this.fromIndex&&nt(this.fromIndex)}outputDefined(){return!1}}class Up{constructor(nt,st,lt,ft,vt,xt){this.inputType=nt,this.type=st,this.input=lt,this.cases=ft,this.outputs=vt,this.otherwise=xt}static parse(nt,st){if(nt.length<5)return st.error(`Expected at least 4 arguments, but found only ${nt.length-1}.`);if(nt.length%2!=1)return st.error("Expected an even number of arguments.");let lt,ft;st.expectedType&&st.expectedType.kind!=="value"&&(ft=st.expectedType);const vt={},xt=[];for(let Ct=2;Ct<nt.length-1;Ct+=2){let Dt=nt[Ct];const Vt=nt[Ct+1];Array.isArray(Dt)||(Dt=[Dt]);const en=st.concat(Ct);if(Dt.length===0)return en.error("Expected at least one branch label.");for(const gn of Dt){if(typeof gn!="number"&&typeof gn!="string")return en.error("Branch labels must be numbers or strings.");if(typeof gn=="number"&&Math.abs(gn)>Number.MAX_SAFE_INTEGER)return en.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof gn=="number"&&Math.floor(gn)!==gn)return en.error("Numeric branch labels must be integer values.");if(lt){if(en.checkSubtype(lt,Zo(gn)))return null}else lt=Zo(gn);if(vt[String(gn)]!==void 0)return en.error("Branch labels must be unique.");vt[String(gn)]=xt.length}const cn=st.parse(Vt,Ct,ft);if(!cn)return null;ft=ft||cn.type,xt.push(cn)}const bt=st.parse(nt[1],1,Er);if(!bt)return null;const Et=st.parse(nt[nt.length-1],nt.length-1,ft);return Et?bt.type.kind!=="value"&&st.concat(1).checkSubtype(lt,bt.type)?null:new Up(lt,ft,bt,vt,xt,Et):null}evaluate(nt){const st=this.input.evaluate(nt);return(Zo(st)===this.inputType&&this.outputs[this.cases[st]]||this.otherwise).evaluate(nt)}eachChild(nt){nt(this.input),this.outputs.forEach(nt),nt(this.otherwise)}outputDefined(){return this.outputs.every(nt=>nt.outputDefined())&&this.otherwise.outputDefined()}}class Vp{constructor(nt,st,lt){this.type=nt,this.branches=st,this.otherwise=lt}static parse(nt,st){if(nt.length<4)return st.error(`Expected at least 3 arguments, but found only ${nt.length-1}.`);if(nt.length%2!=0)return st.error("Expected an odd number of arguments.");let lt;st.expectedType&&st.expectedType.kind!=="value"&&(lt=st.expectedType);const ft=[];for(let xt=1;xt<nt.length-1;xt+=2){const bt=st.parse(nt[xt],xt,tr);if(!bt)return null;const Et=st.parse(nt[xt+1],xt+1,lt);if(!Et)return null;ft.push([bt,Et]),lt=lt||Et.type}const vt=st.parse(nt[nt.length-1],nt.length-1,lt);if(!vt)return null;if(!lt)throw new Error("Can't infer output type");return new Vp(lt,ft,vt)}evaluate(nt){for(const[st,lt]of this.branches)if(st.evaluate(nt))return lt.evaluate(nt);return this.otherwise.evaluate(nt)}eachChild(nt){for(const[st,lt]of this.branches)nt(st),nt(lt);nt(this.otherwise)}outputDefined(){return this.branches.every(([nt,st])=>st.outputDefined())&&this.otherwise.outputDefined()}}class Ku{constructor(nt,st,lt,ft){this.type=nt,this.input=st,this.beginIndex=lt,this.endIndex=ft}static parse(nt,st){if(nt.length<=2||nt.length>=5)return st.error(`Expected 3 or 4 arguments, but found ${nt.length-1} instead.`);const lt=st.parse(nt[1],1,Er),ft=st.parse(nt[2],2,Pr);if(!lt||!ft)return null;if(!Nn(lt.type,[Wt(Er),ns,Er]))return st.error(`Expected first argument to be of type array or string, but found ${jt(lt.type)} instead`);if(nt.length===4){const vt=st.parse(nt[3],3,Pr);return vt?new Ku(lt.type,lt,ft,vt):null}return new Ku(lt.type,lt,ft)}evaluate(nt){const st=this.input.evaluate(nt),lt=this.beginIndex.evaluate(nt);let ft;if(this.endIndex&&(ft=this.endIndex.evaluate(nt)),Tn(st,["string"]))return[...st].slice(lt,ft).join("");if(Tn(st,["array"]))return st.slice(lt,ft);throw new Ko(`Expected first argument to be of type array or string, but found ${jt(Zo(st))} instead.`)}eachChild(nt){nt(this.input),nt(this.beginIndex),this.endIndex&&nt(this.endIndex)}outputDefined(){return!1}}function Hp(it,nt){const st=it.length-1;let lt,ft,vt=0,xt=st,bt=0;for(;vt<=xt;)if(bt=Math.floor((vt+xt)/2),lt=it[bt],ft=it[bt+1],lt<=nt){if(bt===st||nt<ft)return bt;vt=bt+1}else{if(!(lt>nt))throw new Ko("Input is not a number.");xt=bt-1}return 0}class np{constructor(nt,st,lt){this.type=nt,this.input=st,this.labels=[],this.outputs=[];for(const[ft,vt]of lt)this.labels.push(ft),this.outputs.push(vt)}static parse(nt,st){if(nt.length-1<4)return st.error(`Expected at least 4 arguments, but found only ${nt.length-1}.`);if((nt.length-1)%2!=0)return st.error("Expected an even number of arguments.");const lt=st.parse(nt[1],1,Pr);if(!lt)return null;const ft=[];let vt=null;st.expectedType&&st.expectedType.kind!=="value"&&(vt=st.expectedType);for(let xt=1;xt<nt.length;xt+=2){const bt=xt===1?-1/0:nt[xt],Et=nt[xt+1],Ct=xt,Dt=xt+1;if(typeof bt!="number")return st.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ct);if(ft.length&&ft[ft.length-1][0]>=bt)return st.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Ct);const Vt=st.parse(Et,Dt,vt);if(!Vt)return null;vt=vt||Vt.type,ft.push([bt,Vt])}return new np(vt,lt,ft)}evaluate(nt){const st=this.labels,lt=this.outputs;if(st.length===1)return lt[0].evaluate(nt);const ft=this.input.evaluate(nt);if(ft<=st[0])return lt[0].evaluate(nt);const vt=st.length;return ft>=st[vt-1]?lt[vt-1].evaluate(nt):lt[Hp(st,ft)].evaluate(nt)}eachChild(nt){nt(this.input);for(const st of this.outputs)nt(st)}outputDefined(){return this.outputs.every(nt=>nt.outputDefined())}}function Yu(it){return it&&it.__esModule&&Object.prototype.hasOwnProperty.call(it,"default")?it.default:it}var p_=pm;function pm(it,nt,st,lt){this.cx=3*it,this.bx=3*(st-it)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*nt,this.by=3*(lt-nt)-this.cy,this.ay=1-this.cy-this.by,this.p1x=it,this.p1y=nt,this.p2x=st,this.p2y=lt}pm.prototype={sampleCurveX:function(it){return((this.ax*it+this.bx)*it+this.cx)*it},sampleCurveY:function(it){return((this.ay*it+this.by)*it+this.cy)*it},sampleCurveDerivativeX:function(it){return(3*this.ax*it+2*this.bx)*it+this.cx},solveCurveX:function(it,nt){if(nt===void 0&&(nt=1e-6),it<0)return 0;if(it>1)return 1;for(var st=it,lt=0;lt<8;lt++){var ft=this.sampleCurveX(st)-it;if(Math.abs(ft)<nt)return st;var vt=this.sampleCurveDerivativeX(st);if(Math.abs(vt)<1e-6)break;st-=ft/vt}var xt=0,bt=1;for(st=it,lt=0;lt<20&&(ft=this.sampleCurveX(st),!(Math.abs(ft-it)<nt));lt++)it>ft?xt=st:bt=st,st=.5*(bt-xt)+xt;return st},solve:function(it,nt){return this.sampleCurveY(this.solveCurveX(it,nt))}};var f_=Yu(p_);function xu(it,nt,st){return it+st*(nt-it)}function Ju(it,nt,st){return it.map((lt,ft)=>xu(lt,nt[ft],st))}const Fl={number:xu,color:function(it,nt,st,lt="rgb"){switch(lt){case"rgb":{const[ft,vt,xt,bt]=Ju(it.rgb,nt.rgb,st);return new oo(ft,vt,xt,bt,!1)}case"hcl":{const[ft,vt,xt,bt]=it.hcl,[Et,Ct,Dt,Vt]=nt.hcl;let en,cn;if(isNaN(ft)||isNaN(Et))isNaN(ft)?isNaN(Et)?en=NaN:(en=Et,xt!==1&&xt!==0||(cn=Ct)):(en=ft,Dt!==1&&Dt!==0||(cn=vt));else{let vr=Et-ft;Et>ft&&vr>180?vr-=360:Et<ft&&ft-Et>180&&(vr+=360),en=ft+st*vr}const[gn,bn,Ln,Vn]=function([vr,er,_r,Ir]){return vr=isNaN(vr)?0:vr*zn,Gr([_r,Math.cos(vr)*er,Math.sin(vr)*er,Ir])}([en,cn??xu(vt,Ct,st),xu(xt,Dt,st),xu(bt,Vt,st)]);return new oo(gn,bn,Ln,Vn,!1)}case"lab":{const[ft,vt,xt,bt]=Gr(Ju(it.lab,nt.lab,st));return new oo(ft,vt,xt,bt,!1)}}},array:Ju,padding:function(it,nt,st){return new Gl(Ju(it.values,nt.values,st))},variableAnchorOffsetCollection:function(it,nt,st){const lt=it.values,ft=nt.values;if(lt.length!==ft.length)throw new Ko(`Cannot interpolate values of different length. from: ${it.toString()}, to: ${nt.toString()}`);const vt=[];for(let xt=0;xt<lt.length;xt+=2){if(lt[xt]!==ft[xt])throw new Ko(`Cannot interpolate values containing mismatched anchors. from[${xt}]: ${lt[xt]}, to[${xt}]: ${ft[xt]}`);vt.push(lt[xt]);const[bt,Et]=lt[xt+1],[Ct,Dt]=ft[xt+1];vt.push([xu(bt,Ct,st),xu(Et,Dt,st)])}return new tu(vt)}};class Rl{constructor(nt,st,lt,ft,vt){this.type=nt,this.operator=st,this.interpolation=lt,this.input=ft,this.labels=[],this.outputs=[];for(const[xt,bt]of vt)this.labels.push(xt),this.outputs.push(bt)}static interpolationFactor(nt,st,lt,ft){let vt=0;if(nt.name==="exponential")vt=bp(st,nt.base,lt,ft);else if(nt.name==="linear")vt=bp(st,1,lt,ft);else if(nt.name==="cubic-bezier"){const xt=nt.controlPoints;vt=new f_(xt[0],xt[1],xt[2],xt[3]).solve(bp(st,1,lt,ft))}return vt}static parse(nt,st){let[lt,ft,vt,...xt]=nt;if(!Array.isArray(ft)||ft.length===0)return st.error("Expected an interpolation type expression.",1);if(ft[0]==="linear")ft={name:"linear"};else if(ft[0]==="exponential"){const Ct=ft[1];if(typeof Ct!="number")return st.error("Exponential interpolation requires a numeric base.",1,1);ft={name:"exponential",base:Ct}}else{if(ft[0]!=="cubic-bezier")return st.error(`Unknown interpolation type ${String(ft[0])}`,1,0);{const Ct=ft.slice(1);if(Ct.length!==4||Ct.some(Dt=>typeof Dt!="number"||Dt<0||Dt>1))return st.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);ft={name:"cubic-bezier",controlPoints:Ct}}}if(nt.length-1<4)return st.error(`Expected at least 4 arguments, but found only ${nt.length-1}.`);if((nt.length-1)%2!=0)return st.error("Expected an even number of arguments.");if(vt=st.parse(vt,2,Pr),!vt)return null;const bt=[];let Et=null;lt==="interpolate-hcl"||lt==="interpolate-lab"?Et=Yn:st.expectedType&&st.expectedType.kind!=="value"&&(Et=st.expectedType);for(let Ct=0;Ct<xt.length;Ct+=2){const Dt=xt[Ct],Vt=xt[Ct+1],en=Ct+3,cn=Ct+4;if(typeof Dt!="number")return st.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',en);if(bt.length&&bt[bt.length-1][0]>=Dt)return st.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',en);const gn=st.parse(Vt,cn,Et);if(!gn)return null;Et=Et||gn.type,bt.push([Dt,gn])}return Kn(Et,Pr)||Kn(Et,Yn)||Kn(Et,lo)||Kn(Et,_n)||Kn(Et,Wt(Pr))?new Rl(Et,lt,ft,vt,bt):st.error(`Type ${jt(Et)} is not interpolatable.`)}evaluate(nt){const st=this.labels,lt=this.outputs;if(st.length===1)return lt[0].evaluate(nt);const ft=this.input.evaluate(nt);if(ft<=st[0])return lt[0].evaluate(nt);const vt=st.length;if(ft>=st[vt-1])return lt[vt-1].evaluate(nt);const xt=Hp(st,ft),bt=Rl.interpolationFactor(this.interpolation,ft,st[xt],st[xt+1]),Et=lt[xt].evaluate(nt),Ct=lt[xt+1].evaluate(nt);switch(this.operator){case"interpolate":return Fl[this.type.kind](Et,Ct,bt);case"interpolate-hcl":return Fl.color(Et,Ct,bt,"hcl");case"interpolate-lab":return Fl.color(Et,Ct,bt,"lab")}}eachChild(nt){nt(this.input);for(const st of this.outputs)nt(st)}outputDefined(){return this.outputs.every(nt=>nt.outputDefined())}}function bp(it,nt,st,lt){const ft=lt-st,vt=it-st;return ft===0?0:nt===1?vt/ft:(Math.pow(nt,vt)-1)/(Math.pow(nt,ft)-1)}class ip{constructor(nt,st){this.type=nt,this.args=st}static parse(nt,st){if(nt.length<2)return st.error("Expectected at least one argument.");let lt=null;const ft=st.expectedType;ft&&ft.kind!=="value"&&(lt=ft);const vt=[];for(const bt of nt.slice(1)){const Et=st.parse(bt,1+vt.length,lt,void 0,{typeAnnotation:"omit"});if(!Et)return null;lt=lt||Et.type,vt.push(Et)}if(!lt)throw new Error("No output type");const xt=ft&&vt.some(bt=>xn(ft,bt.type));return new ip(xt?Er:lt,vt)}evaluate(nt){let st,lt=null,ft=0;for(const vt of this.args)if(ft++,lt=vt.evaluate(nt),lt&&lt instanceof Xl&&!lt.available&&(st||(st=lt.name),lt=null,ft===this.args.length&&(lt=st)),lt!==null)break;return lt}eachChild(nt){this.args.forEach(nt)}outputDefined(){return this.args.every(nt=>nt.outputDefined())}}function Wp(it,nt){return it==="=="||it==="!="?nt.kind==="boolean"||nt.kind==="string"||nt.kind==="number"||nt.kind==="null"||nt.kind==="value":nt.kind==="string"||nt.kind==="number"||nt.kind==="value"}function Pm(it,nt,st,lt){return lt.compare(nt,st)===0}function rp(it,nt,st){const lt=it!=="=="&&it!=="!=";return class W1{constructor(vt,xt,bt){this.type=tr,this.lhs=vt,this.rhs=xt,this.collator=bt,this.hasUntypedArgument=vt.type.kind==="value"||xt.type.kind==="value"}static parse(vt,xt){if(vt.length!==3&&vt.length!==4)return xt.error("Expected two or three arguments.");const bt=vt[0];let Et=xt.parse(vt[1],1,Er);if(!Et)return null;if(!Wp(bt,Et.type))return xt.concat(1).error(`"${bt}" comparisons are not supported for type '${jt(Et.type)}'.`);let Ct=xt.parse(vt[2],2,Er);if(!Ct)return null;if(!Wp(bt,Ct.type))return xt.concat(2).error(`"${bt}" comparisons are not supported for type '${jt(Ct.type)}'.`);if(Et.type.kind!==Ct.type.kind&&Et.type.kind!=="value"&&Ct.type.kind!=="value")return xt.error(`Cannot compare types '${jt(Et.type)}' and '${jt(Ct.type)}'.`);lt&&(Et.type.kind==="value"&&Ct.type.kind!=="value"?Et=new hu(Ct.type,[Et]):Et.type.kind!=="value"&&Ct.type.kind==="value"&&(Ct=new hu(Et.type,[Ct])));let Dt=null;if(vt.length===4){if(Et.type.kind!=="string"&&Ct.type.kind!=="string"&&Et.type.kind!=="value"&&Ct.type.kind!=="value")return xt.error("Cannot use collator to compare non-string types.");if(Dt=xt.parse(vt[3],3,kr),!Dt)return null}return new W1(Et,Ct,Dt)}evaluate(vt){const xt=this.lhs.evaluate(vt),bt=this.rhs.evaluate(vt);if(lt&&this.hasUntypedArgument){const Et=Zo(xt),Ct=Zo(bt);if(Et.kind!==Ct.kind||Et.kind!=="string"&&Et.kind!=="number")throw new Ko(`Expected arguments for "${it}" to be (string, string) or (number, number), but found (${Et.kind}, ${Ct.kind}) instead.`)}if(this.collator&&!lt&&this.hasUntypedArgument){const Et=Zo(xt),Ct=Zo(bt);if(Et.kind!=="string"||Ct.kind!=="string")return nt(vt,xt,bt)}return this.collator?st(vt,xt,bt,this.collator.evaluate(vt)):nt(vt,xt,bt)}eachChild(vt){vt(this.lhs),vt(this.rhs),this.collator&&vt(this.collator)}outputDefined(){return!0}}}const Ut=rp("==",function(it,nt,st){return nt===st},Pm),dn=rp("!=",function(it,nt,st){return nt!==st},function(it,nt,st,lt){return!Pm(0,nt,st,lt)}),In=rp("<",function(it,nt,st){return nt<st},function(it,nt,st,lt){return lt.compare(nt,st)<0}),$n=rp(">",function(it,nt,st){return nt>st},function(it,nt,st,lt){return lt.compare(nt,st)>0}),Zn=rp("<=",function(it,nt,st){return nt<=st},function(it,nt,st,lt){return lt.compare(nt,st)<=0}),Jn=rp(">=",function(it,nt,st){return nt>=st},function(it,nt,st,lt){return lt.compare(nt,st)>=0});class fr{constructor(nt,st,lt){this.type=kr,this.locale=lt,this.caseSensitive=nt,this.diacriticSensitive=st}static parse(nt,st){if(nt.length!==2)return st.error("Expected one argument.");const lt=nt[1];if(typeof lt!="object"||Array.isArray(lt))return st.error("Collator options argument must be an object.");const ft=st.parse(lt["case-sensitive"]!==void 0&&lt["case-sensitive"],1,tr);if(!ft)return null;const vt=st.parse(lt["diacritic-sensitive"]!==void 0&&lt["diacritic-sensitive"],1,tr);if(!vt)return null;let xt=null;return lt.locale&&(xt=st.parse(lt.locale,1,ns),!xt)?null:new fr(ft,vt,xt)}evaluate(nt){return new Cl(this.caseSensitive.evaluate(nt),this.diacriticSensitive.evaluate(nt),this.locale?this.locale.evaluate(nt):null)}eachChild(nt){nt(this.caseSensitive),nt(this.diacriticSensitive),this.locale&&nt(this.locale)}outputDefined(){return!1}}class sr{constructor(nt,st,lt,ft,vt){this.type=ns,this.number=nt,this.locale=st,this.currency=lt,this.minFractionDigits=ft,this.maxFractionDigits=vt}static parse(nt,st){if(nt.length!==3)return st.error("Expected two arguments.");const lt=st.parse(nt[1],1,Pr);if(!lt)return null;const ft=nt[2];if(typeof ft!="object"||Array.isArray(ft))return st.error("NumberFormat options argument must be an object.");let vt=null;if(ft.locale&&(vt=st.parse(ft.locale,1,ns),!vt))return null;let xt=null;if(ft.currency&&(xt=st.parse(ft.currency,1,ns),!xt))return null;let bt=null;if(ft["min-fraction-digits"]&&(bt=st.parse(ft["min-fraction-digits"],1,Pr),!bt))return null;let Et=null;return ft["max-fraction-digits"]&&(Et=st.parse(ft["max-fraction-digits"],1,Pr),!Et)?null:new sr(lt,vt,xt,bt,Et)}evaluate(nt){return new Intl.NumberFormat(this.locale?this.locale.evaluate(nt):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(nt):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(nt):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(nt):void 0}).format(this.number.evaluate(nt))}eachChild(nt){nt(this.number),this.locale&&nt(this.locale),this.currency&&nt(this.currency),this.minFractionDigits&&nt(this.minFractionDigits),this.maxFractionDigits&&nt(this.maxFractionDigits)}outputDefined(){return!1}}class Un{constructor(nt){this.type=Us,this.sections=nt}static parse(nt,st){if(nt.length<2)return st.error("Expected at least one argument.");const lt=nt[1];if(!Array.isArray(lt)&&typeof lt=="object")return st.error("First argument must be an image or text section.");const ft=[];let vt=!1;for(let xt=1;xt<=nt.length-1;++xt){const bt=nt[xt];if(vt&&typeof bt=="object"&&!Array.isArray(bt)){vt=!1;let Et=null;if(bt["font-scale"]&&(Et=st.parse(bt["font-scale"],1,Pr),!Et))return null;let Ct=null;if(bt["text-font"]&&(Ct=st.parse(bt["text-font"],1,Wt(ns)),!Ct))return null;let Dt=null;if(bt["text-color"]&&(Dt=st.parse(bt["text-color"],1,Yn),!Dt))return null;const Vt=ft[ft.length-1];Vt.scale=Et,Vt.font=Ct,Vt.textColor=Dt}else{const Et=st.parse(nt[xt],1,Er);if(!Et)return null;const Ct=Et.type.kind;if(Ct!=="string"&&Ct!=="value"&&Ct!=="null"&&Ct!=="resolvedImage")return st.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");vt=!0,ft.push({content:Et,scale:null,font:null,textColor:null})}}return new Un(ft)}evaluate(nt){return new yl(this.sections.map(st=>{const lt=st.content.evaluate(nt);return Zo(lt)===rr?new eu("",lt,null,null,null):new eu(_p(lt),null,st.scale?st.scale.evaluate(nt):null,st.font?st.font.evaluate(nt).join(","):null,st.textColor?st.textColor.evaluate(nt):null)}))}eachChild(nt){for(const st of this.sections)nt(st.content),st.scale&&nt(st.scale),st.font&&nt(st.font),st.textColor&&nt(st.textColor)}outputDefined(){return!1}}class pr{constructor(nt){this.type=rr,this.input=nt}static parse(nt,st){if(nt.length!==2)return st.error("Expected two arguments.");const lt=st.parse(nt[1],1,ns);return lt?new pr(lt):st.error("No image name provided.")}evaluate(nt){const st=this.input.evaluate(nt),lt=Xl.fromString(st);return lt&&nt.availableImages&&(lt.available=nt.availableImages.indexOf(st)>-1),lt}eachChild(nt){nt(this.input)}outputDefined(){return!1}}class ur{constructor(nt){this.type=Pr,this.input=nt}static parse(nt,st){if(nt.length!==2)return st.error(`Expected 1 argument, but found ${nt.length-1} instead.`);const lt=st.parse(nt[1],1);return lt?lt.type.kind!=="array"&&lt.type.kind!=="string"&&lt.type.kind!=="value"?st.error(`Expected argument of type string or array, but found ${jt(lt.type)} instead.`):new ur(lt):null}evaluate(nt){const st=this.input.evaluate(nt);if(typeof st=="string")return[...st].length;if(Array.isArray(st))return st.length;throw new Ko(`Expected value to be of type string or array, but found ${jt(Zo(st))} instead.`)}eachChild(nt){nt(this.input)}outputDefined(){return!1}}const zr=8192;function Vr(it,nt){const st=(180+it[0])/360,lt=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+it[1]*Math.PI/360)))/360,ft=Math.pow(2,nt.z);return[Math.round(st*ft*zr),Math.round(lt*ft*zr)]}function Br(it,nt){const st=Math.pow(2,nt.z);return[(ft=(it[0]/zr+nt.x)/st,360*ft-180),(lt=(it[1]/zr+nt.y)/st,360/Math.PI*Math.atan(Math.exp((180-360*lt)*Math.PI/180))-90)];var lt,ft}function Qr(it,nt){it[0]=Math.min(it[0],nt[0]),it[1]=Math.min(it[1],nt[1]),it[2]=Math.max(it[2],nt[0]),it[3]=Math.max(it[3],nt[1])}function Kr(it,nt){return!(it[0]<=nt[0]||it[2]>=nt[2]||it[1]<=nt[1]||it[3]>=nt[3])}function Or(it,nt,st){const lt=it[0]-nt[0],ft=it[1]-nt[1],vt=it[0]-st[0],xt=it[1]-st[1];return lt*xt-vt*ft==0&&lt*vt<=0&&ft*xt<=0}function Js(it,nt,st,lt){return(ft=[lt[0]-st[0],lt[1]-st[1]])[0]*(vt=[nt[0]-it[0],nt[1]-it[1]])[1]-ft[1]*vt[0]!=0&&!(!Bs(it,nt,st,lt)||!Bs(st,lt,it,nt));var ft,vt}function Ns(it,nt,st){for(const lt of st)for(let ft=0;ft<lt.length-1;++ft)if(Js(it,nt,lt[ft],lt[ft+1]))return!0;return!1}function Is(it,nt,st=!1){let lt=!1;for(const bt of nt)for(let Et=0;Et<bt.length-1;Et++){if(Or(it,bt[Et],bt[Et+1]))return st;(vt=bt[Et])[1]>(ft=it)[1]!=(xt=bt[Et+1])[1]>ft[1]&&ft[0]<(xt[0]-vt[0])*(ft[1]-vt[1])/(xt[1]-vt[1])+vt[0]&&(lt=!lt)}var ft,vt,xt;return lt}function Vs(it,nt){for(const st of nt)if(Is(it,st))return!0;return!1}function Es(it,nt){for(const st of it)if(!Is(st,nt))return!1;for(let st=0;st<it.length-1;++st)if(Ns(it[st],it[st+1],nt))return!1;return!0}function Xs(it,nt){for(const st of nt)if(Es(it,st))return!0;return!1}function Bs(it,nt,st,lt){const ft=lt[0]-st[0],vt=lt[1]-st[1],xt=(it[0]-st[0])*vt-ft*(it[1]-st[1]),bt=(nt[0]-st[0])*vt-ft*(nt[1]-st[1]);return xt>0&&bt<0||xt<0&&bt>0}function fo(it,nt,st){const lt=[];for(let ft=0;ft<it.length;ft++){const vt=[];for(let xt=0;xt<it[ft].length;xt++){const bt=Vr(it[ft][xt],st);Qr(nt,bt),vt.push(bt)}lt.push(vt)}return lt}function po(it,nt,st){const lt=[];for(let ft=0;ft<it.length;ft++){const vt=fo(it[ft],nt,st);lt.push(vt)}return lt}function _o(it,nt,st,lt){if(it[0]<st[0]||it[0]>st[2]){const ft=.5*lt;let vt=it[0]-st[0]>ft?-lt:st[0]-it[0]>ft?lt:0;vt===0&&(vt=it[0]-st[2]>ft?-lt:st[2]-it[0]>ft?lt:0),it[0]+=vt}Qr(nt,it)}function xo(it,nt,st,lt){const ft=Math.pow(2,lt.z)*zr,vt=[lt.x*zr,lt.y*zr],xt=[];for(const bt of it)for(const Et of bt){const Ct=[Et.x+vt[0],Et.y+vt[1]];_o(Ct,nt,st,ft),xt.push(Ct)}return xt}function wo(it,nt,st,lt){const ft=Math.pow(2,lt.z)*zr,vt=[lt.x*zr,lt.y*zr],xt=[];for(const Et of it){const Ct=[];for(const Dt of Et){const Vt=[Dt.x+vt[0],Dt.y+vt[1]];Qr(nt,Vt),Ct.push(Vt)}xt.push(Ct)}if(nt[2]-nt[0]<=ft/2){(bt=nt)[0]=bt[1]=1/0,bt[2]=bt[3]=-1/0;for(const Et of xt)for(const Ct of Et)_o(Ct,nt,st,ft)}var bt;return xt}class Io{constructor(nt,st){this.type=tr,this.geojson=nt,this.geometries=st}static parse(nt,st){if(nt.length!==2)return st.error(`'within' expression requires exactly one argument, but found ${nt.length-1} instead.`);if(Bu(nt[1])){const lt=nt[1];if(lt.type==="FeatureCollection"){const ft=[];for(const vt of lt.features){const{type:xt,coordinates:bt}=vt.geometry;xt==="Polygon"&&ft.push(bt),xt==="MultiPolygon"&&ft.push(...bt)}if(ft.length)return new Io(lt,{type:"MultiPolygon",coordinates:ft})}else if(lt.type==="Feature"){const ft=lt.geometry.type;if(ft==="Polygon"||ft==="MultiPolygon")return new Io(lt,lt.geometry)}else if(lt.type==="Polygon"||lt.type==="MultiPolygon")return new Io(lt,lt)}return st.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(nt){if(nt.geometry()!=null&&nt.canonicalID()!=null){if(nt.geometryType()==="Point")return function(st,lt){const ft=[1/0,1/0,-1/0,-1/0],vt=[1/0,1/0,-1/0,-1/0],xt=st.canonicalID();if(lt.type==="Polygon"){const bt=fo(lt.coordinates,vt,xt),Et=xo(st.geometry(),ft,vt,xt);if(!Kr(ft,vt))return!1;for(const Ct of Et)if(!Is(Ct,bt))return!1}if(lt.type==="MultiPolygon"){const bt=po(lt.coordinates,vt,xt),Et=xo(st.geometry(),ft,vt,xt);if(!Kr(ft,vt))return!1;for(const Ct of Et)if(!Vs(Ct,bt))return!1}return!0}(nt,this.geometries);if(nt.geometryType()==="LineString")return function(st,lt){const ft=[1/0,1/0,-1/0,-1/0],vt=[1/0,1/0,-1/0,-1/0],xt=st.canonicalID();if(lt.type==="Polygon"){const bt=fo(lt.coordinates,vt,xt),Et=wo(st.geometry(),ft,vt,xt);if(!Kr(ft,vt))return!1;for(const Ct of Et)if(!Es(Ct,bt))return!1}if(lt.type==="MultiPolygon"){const bt=po(lt.coordinates,vt,xt),Et=wo(st.geometry(),ft,vt,xt);if(!Kr(ft,vt))return!1;for(const Ct of Et)if(!Xs(Ct,bt))return!1}return!0}(nt,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Do=class{constructor(it=[],nt=(st,lt)=>st<lt?-1:st>lt?1:0){if(this.data=it,this.length=this.data.length,this.compare=nt,this.length>0)for(let st=(this.length>>1)-1;st>=0;st--)this._down(st)}push(it){this.data.push(it),this._up(this.length++)}pop(){if(this.length===0)return;const it=this.data[0],nt=this.data.pop();return--this.length>0&&(this.data[0]=nt,this._down(0)),it}peek(){return this.data[0]}_up(it){const{data:nt,compare:st}=this,lt=nt[it];for(;it>0;){const ft=it-1>>1,vt=nt[ft];if(st(lt,vt)>=0)break;nt[it]=vt,it=ft}nt[it]=lt}_down(it){const{data:nt,compare:st}=this,lt=this.length>>1,ft=nt[it];for(;it<lt;){let vt=1+(it<<1);const xt=vt+1;if(xt<this.length&&st(nt[xt],nt[vt])<0&&(vt=xt),st(nt[vt],ft)>=0)break;nt[it]=nt[vt],it=vt}nt[it]=ft}};function Yo(it,nt,st,lt,ft){Bo(it,nt,st,lt||it.length-1,ft||Xo)}function Bo(it,nt,st,lt,ft){for(;lt>st;){if(lt-st>600){var vt=lt-st+1,xt=nt-st+1,bt=Math.log(vt),Et=.5*Math.exp(2*bt/3),Ct=.5*Math.sqrt(bt*Et*(vt-Et)/vt)*(xt-vt/2<0?-1:1);Bo(it,nt,Math.max(st,Math.floor(nt-xt*Et/vt+Ct)),Math.min(lt,Math.floor(nt+(vt-xt)*Et/vt+Ct)),ft)}var Dt=it[nt],Vt=st,en=lt;for(Lo(it,st,nt),ft(it[lt],Dt)>0&&Lo(it,st,lt);Vt<en;){for(Lo(it,Vt,en),Vt++,en--;ft(it[Vt],Dt)<0;)Vt++;for(;ft(it[en],Dt)>0;)en--}ft(it[st],Dt)===0?Lo(it,st,en):Lo(it,++en,lt),en<=nt&&(st=en+1),nt<=en&&(lt=en-1)}}function Lo(it,nt,st){var lt=it[nt];it[nt]=it[st],it[st]=lt}function Xo(it,nt){return it<nt?-1:it>nt?1:0}function Fo(it,nt){if(it.length<=1)return[it];const st=[];let lt,ft;for(const vt of it){const xt=bu(vt);xt!==0&&(vt.area=Math.abs(xt),ft===void 0&&(ft=xt<0),ft===xt<0?(lt&&st.push(lt),lt=[vt]):lt.push(vt))}if(lt&&st.push(lt),nt>1)for(let vt=0;vt<st.length;vt++)st[vt].length<=nt||(Yo(st[vt],nt,1,st[vt].length-1,$a),st[vt]=st[vt].slice(0,nt));return st}function $a(it,nt){return nt.area-it.area}function bu(it){let nt=0;for(let st,lt,ft=0,vt=it.length,xt=vt-1;ft<vt;xt=ft++)st=it[ft],lt=it[xt],nt+=(lt.x-st.x)*(st.y+lt.y);return nt}const nu=1/298.257223563,na=nu*(2-nu),Ml=Math.PI/180;class pu{constructor(nt){const st=6378.137*Ml*1e3,lt=Math.cos(nt*Ml),ft=1/(1-na*(1-lt*lt)),vt=Math.sqrt(ft);this.kx=st*vt*lt,this.ky=st*vt*ft*(1-na)}distance(nt,st){const lt=this.wrap(nt[0]-st[0])*this.kx,ft=(nt[1]-st[1])*this.ky;return Math.sqrt(lt*lt+ft*ft)}pointOnLine(nt,st){let lt,ft,vt,xt,bt=1/0;for(let Et=0;Et<nt.length-1;Et++){let Ct=nt[Et][0],Dt=nt[Et][1],Vt=this.wrap(nt[Et+1][0]-Ct)*this.kx,en=(nt[Et+1][1]-Dt)*this.ky,cn=0;Vt===0&&en===0||(cn=(this.wrap(st[0]-Ct)*this.kx*Vt+(st[1]-Dt)*this.ky*en)/(Vt*Vt+en*en),cn>1?(Ct=nt[Et+1][0],Dt=nt[Et+1][1]):cn>0&&(Ct+=Vt/this.kx*cn,Dt+=en/this.ky*cn)),Vt=this.wrap(st[0]-Ct)*this.kx,en=(st[1]-Dt)*this.ky;const gn=Vt*Vt+en*en;gn<bt&&(bt=gn,lt=Ct,ft=Dt,vt=Et,xt=cn)}return{point:[lt,ft],index:vt,t:Math.max(0,Math.min(1,xt))}}wrap(nt){for(;nt<-180;)nt+=360;for(;nt>180;)nt-=360;return nt}}function js(it,nt){return nt[0]-it[0]}function Fs(it){return it[1]-it[0]+1}function _s(it,nt){return it[1]>=it[0]&&it[1]<nt}function Cs(it,nt){if(it[0]>it[1])return[null,null];const st=Fs(it);if(nt){if(st===2)return[it,null];const ft=Math.floor(st/2);return[[it[0],it[0]+ft],[it[0]+ft,it[1]]]}if(st===1)return[it,null];const lt=Math.floor(st/2)-1;return[[it[0],it[0]+lt],[it[0]+lt+1,it[1]]]}function Ss(it,nt){if(!_s(nt,it.length))return[1/0,1/0,-1/0,-1/0];const st=[1/0,1/0,-1/0,-1/0];for(let lt=nt[0];lt<=nt[1];++lt)Qr(st,it[lt]);return st}function Ws(it){const nt=[1/0,1/0,-1/0,-1/0];for(const st of it)for(const lt of st)Qr(nt,lt);return nt}function Zs(it){return it[0]!==-1/0&&it[1]!==-1/0&&it[2]!==1/0&&it[3]!==1/0}function ks(it,nt,st){if(!Zs(it)||!Zs(nt))return NaN;let lt=0,ft=0;return it[2]<nt[0]&&(lt=nt[0]-it[2]),it[0]>nt[2]&&(lt=it[0]-nt[2]),it[1]>nt[3]&&(ft=it[1]-nt[3]),it[3]<nt[1]&&(ft=nt[1]-it[3]),st.distance([0,0],[lt,ft])}function ls(it,nt,st){const lt=st.pointOnLine(nt,it);return st.distance(it,lt.point)}function Ys(it,nt,st,lt,ft){const vt=Math.min(ls(it,[st,lt],ft),ls(nt,[st,lt],ft)),xt=Math.min(ls(st,[it,nt],ft),ls(lt,[it,nt],ft));return Math.min(vt,xt)}function ao(it,nt,st,lt,ft){if(!_s(nt,it.length)||!_s(lt,st.length))return 1/0;let vt=1/0;for(let xt=nt[0];xt<nt[1];++xt){const bt=it[xt],Et=it[xt+1];for(let Ct=lt[0];Ct<lt[1];++Ct){const Dt=st[Ct],Vt=st[Ct+1];if(Js(bt,Et,Dt,Vt))return 0;vt=Math.min(vt,Ys(bt,Et,Dt,Vt,ft))}}return vt}function to(it,nt,st,lt,ft){if(!_s(nt,it.length)||!_s(lt,st.length))return NaN;let vt=1/0;for(let xt=nt[0];xt<=nt[1];++xt)for(let bt=lt[0];bt<=lt[1];++bt)if(vt=Math.min(vt,ft.distance(it[xt],st[bt])),vt===0)return vt;return vt}function Ro(it,nt,st){if(Is(it,nt,!0))return 0;let lt=1/0;for(const ft of nt){const vt=ft[0],xt=ft[ft.length-1];if(vt!==xt&&(lt=Math.min(lt,ls(it,[xt,vt],st)),lt===0))return lt;const bt=st.pointOnLine(ft,it);if(lt=Math.min(lt,st.distance(it,bt.point)),lt===0)return lt}return lt}function $s(it,nt,st,lt){if(!_s(nt,it.length))return NaN;for(let vt=nt[0];vt<=nt[1];++vt)if(Is(it[vt],st,!0))return 0;let ft=1/0;for(let vt=nt[0];vt<nt[1];++vt){const xt=it[vt],bt=it[vt+1];for(const Et of st)for(let Ct=0,Dt=Et.length,Vt=Dt-1;Ct<Dt;Vt=Ct++){const en=Et[Vt],cn=Et[Ct];if(Js(xt,bt,en,cn))return 0;ft=Math.min(ft,Ys(xt,bt,en,cn,lt))}}return ft}function xl(it,nt){for(const st of it)for(const lt of st)if(Is(lt,nt,!0))return!0;return!1}function vs(it,nt,st,lt=1/0){const ft=Ws(it),vt=Ws(nt);if(lt!==1/0&&ks(ft,vt,st)>=lt)return lt;if(Kr(ft,vt)){if(xl(it,nt))return 0}else if(xl(nt,it))return 0;let xt=1/0;for(const bt of it)for(let Et=0,Ct=bt.length,Dt=Ct-1;Et<Ct;Dt=Et++){const Vt=bt[Dt],en=bt[Et];for(const cn of nt)for(let gn=0,bn=cn.length,Ln=bn-1;gn<bn;Ln=gn++){const Vn=cn[Ln],vr=cn[gn];if(Js(Vt,en,Vn,vr))return 0;xt=Math.min(xt,Ys(Vt,en,Vn,vr,st))}}return xt}function ro(it,nt,st,lt,ft,vt){if(!vt)return;const xt=ks(Ss(lt,vt),ft,st);xt<nt&&it.push([xt,vt,[0,0]])}function Eo(it,nt,st,lt,ft,vt,xt){if(!vt||!xt)return;const bt=ks(Ss(lt,vt),Ss(ft,xt),st);bt<nt&&it.push([bt,vt,xt])}function Po(it,nt,st,lt,ft=1/0){let vt=Math.min(lt.distance(it[0],st[0][0]),ft);if(vt===0)return vt;const xt=new Do([[0,[0,it.length-1],[0,0]]],js),bt=Ws(st);for(;xt.length>0;){const Et=xt.pop();if(Et[0]>=vt)continue;const Ct=Et[1],Dt=nt?50:100;if(Fs(Ct)<=Dt){if(!_s(Ct,it.length))return NaN;if(nt){const Vt=$s(it,Ct,st,lt);if(isNaN(Vt)||Vt===0)return Vt;vt=Math.min(vt,Vt)}else for(let Vt=Ct[0];Vt<=Ct[1];++Vt){const en=Ro(it[Vt],st,lt);if(vt=Math.min(vt,en),vt===0)return 0}}else{const Vt=Cs(Ct,nt);ro(xt,vt,lt,it,bt,Vt[0]),ro(xt,vt,lt,it,bt,Vt[1])}}return vt}function Uo(it,nt,st,lt,ft,vt=1/0){let xt=Math.min(vt,ft.distance(it[0],st[0]));if(xt===0)return xt;const bt=new Do([[0,[0,it.length-1],[0,st.length-1]]],js);for(;bt.length>0;){const Et=bt.pop();if(Et[0]>=xt)continue;const Ct=Et[1],Dt=Et[2],Vt=nt?50:100,en=lt?50:100;if(Fs(Ct)<=Vt&&Fs(Dt)<=en){if(!_s(Ct,it.length)&&_s(Dt,st.length))return NaN;let cn;if(nt&&lt)cn=ao(it,Ct,st,Dt,ft),xt=Math.min(xt,cn);else if(nt&&!lt){const gn=it.slice(Ct[0],Ct[1]+1);for(let bn=Dt[0];bn<=Dt[1];++bn)if(cn=ls(st[bn],gn,ft),xt=Math.min(xt,cn),xt===0)return xt}else if(!nt&&lt){const gn=st.slice(Dt[0],Dt[1]+1);for(let bn=Ct[0];bn<=Ct[1];++bn)if(cn=ls(it[bn],gn,ft),xt=Math.min(xt,cn),xt===0)return xt}else cn=to(it,Ct,st,Dt,ft),xt=Math.min(xt,cn)}else{const cn=Cs(Ct,nt),gn=Cs(Dt,lt);Eo(bt,xt,ft,it,st,cn[0],gn[0]),Eo(bt,xt,ft,it,st,cn[0],gn[1]),Eo(bt,xt,ft,it,st,cn[1],gn[0]),Eo(bt,xt,ft,it,st,cn[1],gn[1])}}return xt}function Co(it){return it.type==="MultiPolygon"?it.coordinates.map(nt=>({type:"Polygon",coordinates:nt})):it.type==="MultiLineString"?it.coordinates.map(nt=>({type:"LineString",coordinates:nt})):it.type==="MultiPoint"?it.coordinates.map(nt=>({type:"Point",coordinates:nt})):[it]}class Ol{constructor(nt,st){this.type=Pr,this.geojson=nt,this.geometries=st}static parse(nt,st){if(nt.length!==2)return st.error(`'distance' expression requires exactly one argument, but found ${nt.length-1} instead.`);if(Bu(nt[1])){const lt=nt[1];if(lt.type==="FeatureCollection")return new Ol(lt,lt.features.map(ft=>Co(ft.geometry)).flat());if(lt.type==="Feature")return new Ol(lt,Co(lt.geometry));if("type"in lt&&"coordinates"in lt)return new Ol(lt,Co(lt))}return st.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(nt){if(nt.geometry()!=null&&nt.canonicalID()!=null){if(nt.geometryType()==="Point")return function(st,lt){const ft=st.geometry(),vt=ft.flat().map(Et=>Br([Et.x,Et.y],st.canonical));if(ft.length===0)return NaN;const xt=new pu(vt[0][1]);let bt=1/0;for(const Et of lt){switch(Et.type){case"Point":bt=Math.min(bt,Uo(vt,!1,[Et.coordinates],!1,xt,bt));break;case"LineString":bt=Math.min(bt,Uo(vt,!1,Et.coordinates,!0,xt,bt));break;case"Polygon":bt=Math.min(bt,Po(vt,!1,Et.coordinates,xt,bt))}if(bt===0)return bt}return bt}(nt,this.geometries);if(nt.geometryType()==="LineString")return function(st,lt){const ft=st.geometry(),vt=ft.flat().map(Et=>Br([Et.x,Et.y],st.canonical));if(ft.length===0)return NaN;const xt=new pu(vt[0][1]);let bt=1/0;for(const Et of lt){switch(Et.type){case"Point":bt=Math.min(bt,Uo(vt,!0,[Et.coordinates],!1,xt,bt));break;case"LineString":bt=Math.min(bt,Uo(vt,!0,Et.coordinates,!0,xt,bt));break;case"Polygon":bt=Math.min(bt,Po(vt,!0,Et.coordinates,xt,bt))}if(bt===0)return bt}return bt}(nt,this.geometries);if(nt.geometryType()==="Polygon")return function(st,lt){const ft=st.geometry();if(ft.length===0||ft[0].length===0)return NaN;const vt=Fo(ft,0).map(Et=>Et.map(Ct=>Ct.map(Dt=>Br([Dt.x,Dt.y],st.canonical)))),xt=new pu(vt[0][0][0][1]);let bt=1/0;for(const Et of lt)for(const Ct of vt){switch(Et.type){case"Point":bt=Math.min(bt,Po([Et.coordinates],!1,Ct,xt,bt));break;case"LineString":bt=Math.min(bt,Po(Et.coordinates,!0,Ct,xt,bt));break;case"Polygon":bt=Math.min(bt,vs(Ct,Et.coordinates,xt,bt))}if(bt===0)return bt}return bt}(nt,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const fu={"==":Ut,"!=":dn,">":$n,"<":In,">=":Jn,"<=":Zn,array:hu,at:xp,boolean:hu,case:Vp,coalesce:ip,collator:fr,format:Un,image:pr,in:dm,"index-of":Zu,interpolate:Rl,"interpolate-hcl":Rl,"interpolate-lab":Rl,length:ur,let:$u,literal:Pl,match:Up,number:hu,"number-format":sr,object:hu,slice:Ku,step:np,string:hu,"to-boolean":du,"to-color":du,"to-number":du,"to-string":du,var:To,within:Io,distance:Ol};class Il{constructor(nt,st,lt,ft){this.name=nt,this.type=st,this._evaluate=lt,this.args=ft}evaluate(nt){return this._evaluate(nt,this.args)}eachChild(nt){this.args.forEach(nt)}outputDefined(){return!1}static parse(nt,st){const lt=nt[0],ft=Il.definitions[lt];if(!ft)return st.error(`Unknown expression "${lt}". If you wanted a literal array, use ["literal", [...]].`,0);const vt=Array.isArray(ft)?ft[0]:ft.type,xt=Array.isArray(ft)?[[ft[1],ft[2]]]:ft.overloads,bt=xt.filter(([Ct])=>!Array.isArray(Ct)||Ct.length===nt.length-1);let Et=null;for(const[Ct,Dt]of bt){Et=new ju(st.registry,sp,st.path,null,st.scope);const Vt=[];let en=!1;for(let cn=1;cn<nt.length;cn++){const gn=nt[cn],bn=Array.isArray(Ct)?Ct[cn-1]:Ct.type,Ln=Et.parse(gn,1+Vt.length,bn);if(!Ln){en=!0;break}Vt.push(Ln)}if(!en)if(Array.isArray(Ct)&&Ct.length!==Vt.length)Et.error(`Expected ${Ct.length} arguments, but found ${Vt.length} instead.`);else{for(let cn=0;cn<Vt.length;cn++){const gn=Array.isArray(Ct)?Ct[cn]:Ct.type,bn=Vt[cn];Et.concat(cn+1).checkSubtype(gn,bn.type)}if(Et.errors.length===0)return new Il(lt,vt,Dt,Vt)}}if(bt.length===1)st.errors.push(...Et.errors);else{const Ct=(bt.length?bt:xt).map(([Vt])=>{return en=Vt,Array.isArray(en)?`(${en.map(jt).join(", ")})`:`(${jt(en.type)}...)`;var en}).join(" | "),Dt=[];for(let Vt=1;Vt<nt.length;Vt++){const en=st.parse(nt[Vt],1+Dt.length);if(!en)return null;Dt.push(jt(en.type))}st.error(`Expected arguments of type ${Ct}, but found (${Dt.join(", ")}) instead.`)}return null}static register(nt,st){Il.definitions=st;for(const lt in st)nt[lt]=Il}}function Pu(it,[nt,st,lt,ft]){nt=nt.evaluate(it),st=st.evaluate(it),lt=lt.evaluate(it);const vt=ft?ft.evaluate(it):1,xt=ku(nt,st,lt,vt);if(xt)throw new Ko(xt);return new oo(nt/255,st/255,lt/255,vt,!1)}function Qu(it,nt){return it in nt}function fm(it,nt){const st=nt[it];return st===void 0?null:st}function _a(it){return{type:it}}function sp(it){if(it instanceof To)return sp(it.boundExpression);if(it instanceof Il&&it.name==="error"||it instanceof fr||it instanceof Io||it instanceof Ol)return!1;const nt=it instanceof du||it instanceof hu;let st=!0;return it.eachChild(lt=>{st=nt?st&&sp(lt):st&&lt instanceof Pl}),!!st&&wp(it)&&Ep(it,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function wp(it){if(it instanceof Il&&(it.name==="get"&&it.args.length===1||it.name==="feature-state"||it.name==="has"&&it.args.length===1||it.name==="properties"||it.name==="geometry-type"||it.name==="id"||/^filter-/.test(it.name))||it instanceof Io||it instanceof Ol)return!1;let nt=!0;return it.eachChild(st=>{nt&&!wp(st)&&(nt=!1)}),nt}function So(it){if(it instanceof Il&&it.name==="feature-state")return!1;let nt=!0;return it.eachChild(st=>{nt&&!So(st)&&(nt=!1)}),nt}function Ep(it,nt){if(it instanceof Il&&nt.indexOf(it.name)>=0)return!1;let st=!0;return it.eachChild(lt=>{st&&!Ep(lt,nt)&&(st=!1)}),st}function mu(it){return{result:"success",value:it}}function op(it){return{result:"error",value:it}}function ap(it){return it["property-type"]==="data-driven"||it["property-type"]==="cross-faded-data-driven"}function Rm(it){return!!it.expression&&it.expression.parameters.indexOf("zoom")>-1}function Sp(it){return!!it.expression&&it.expression.interpolated}function bo(it){return it instanceof Number?"number":it instanceof String?"string":it instanceof Boolean?"boolean":Array.isArray(it)?"array":it===null?"null":typeof it}function qp(it){return typeof it=="object"&&it!==null&&!Array.isArray(it)}function m_(it){return it}function Mm(it,nt){const st=nt.type==="color",lt=it.stops&&typeof it.stops[0][0]=="object",ft=lt||!(lt||it.property!==void 0),vt=it.type||(Sp(nt)?"exponential":"interval");if(st||nt.type==="padding"){const Dt=st?oo.parse:Gl.parse;(it=ws({},it)).stops&&(it.stops=it.stops.map(Vt=>[Vt[0],Dt(Vt[1])])),it.default=Dt(it.default?it.default:nt.default)}if(it.colorSpace&&(xt=it.colorSpace)!=="rgb"&&xt!=="hcl"&&xt!=="lab")throw new Error(`Unknown color space: "${it.colorSpace}"`);var xt;let bt,Et,Ct;if(vt==="exponential")bt=mm;else if(vt==="interval")bt=Ap;else if(vt==="categorical"){bt=Im,Et=Object.create(null);for(const Dt of it.stops)Et[Dt[0]]=Dt[1];Ct=typeof it.stops[0][0]}else{if(vt!=="identity")throw new Error(`Unknown function type "${vt}"`);bt=Gp}if(lt){const Dt={},Vt=[];for(let gn=0;gn<it.stops.length;gn++){const bn=it.stops[gn],Ln=bn[0].zoom;Dt[Ln]===void 0&&(Dt[Ln]={zoom:Ln,type:it.type,property:it.property,default:it.default,stops:[]},Vt.push(Ln)),Dt[Ln].stops.push([bn[0].value,bn[1]])}const en=[];for(const gn of Vt)en.push([Dt[gn].zoom,Mm(Dt[gn],nt)]);const cn={name:"linear"};return{kind:"composite",interpolationType:cn,interpolationFactor:Rl.interpolationFactor.bind(void 0,cn),zoomStops:en.map(gn=>gn[0]),evaluate:({zoom:gn},bn)=>mm({stops:en,base:it.base},nt,gn).evaluate(gn,bn)}}if(ft){const Dt=vt==="exponential"?{name:"exponential",base:it.base!==void 0?it.base:1}:null;return{kind:"camera",interpolationType:Dt,interpolationFactor:Rl.interpolationFactor.bind(void 0,Dt),zoomStops:it.stops.map(Vt=>Vt[0]),evaluate:({zoom:Vt})=>bt(it,nt,Vt,Et,Ct)}}return{kind:"source",evaluate(Dt,Vt){const en=Vt&&Vt.properties?Vt.properties[it.property]:void 0;return en===void 0?Zl(it.default,nt.default):bt(it,nt,en,Et,Ct)}}}function Zl(it,nt,st){return it!==void 0?it:nt!==void 0?nt:st!==void 0?st:void 0}function Im(it,nt,st,lt,ft){return Zl(typeof st===ft?lt[st]:void 0,it.default,nt.default)}function Ap(it,nt,st){if(bo(st)!=="number")return Zl(it.default,nt.default);const lt=it.stops.length;if(lt===1||st<=it.stops[0][0])return it.stops[0][1];if(st>=it.stops[lt-1][0])return it.stops[lt-1][1];const ft=Hp(it.stops.map(vt=>vt[0]),st);return it.stops[ft][1]}function mm(it,nt,st){const lt=it.base!==void 0?it.base:1;if(bo(st)!=="number")return Zl(it.default,nt.default);const ft=it.stops.length;if(ft===1||st<=it.stops[0][0])return it.stops[0][1];if(st>=it.stops[ft-1][0])return it.stops[ft-1][1];const vt=Hp(it.stops.map(Dt=>Dt[0]),st),xt=function(Dt,Vt,en,cn){const gn=cn-en,bn=Dt-en;return gn===0?0:Vt===1?bn/gn:(Math.pow(Vt,bn)-1)/(Math.pow(Vt,gn)-1)}(st,lt,it.stops[vt][0],it.stops[vt+1][0]),bt=it.stops[vt][1],Et=it.stops[vt+1][1],Ct=Fl[nt.type]||m_;return typeof bt.evaluate=="function"?{evaluate(...Dt){const Vt=bt.evaluate.apply(void 0,Dt),en=Et.evaluate.apply(void 0,Dt);if(Vt!==void 0&&en!==void 0)return Ct(Vt,en,xt,it.colorSpace)}}:Ct(bt,Et,xt,it.colorSpace)}function Gp(it,nt,st){switch(nt.type){case"color":st=oo.parse(st);break;case"formatted":st=yl.fromString(st.toString());break;case"resolvedImage":st=Xl.fromString(st.toString());break;case"padding":st=Gl.parse(st);break;default:bo(st)===nt.type||nt.type==="enum"&&nt.values[st]||(st=void 0)}return Zl(st,it.default,nt.default)}Il.register(fu,{error:[{kind:"error"},[ns],(it,[nt])=>{throw new Ko(nt.evaluate(it))}],typeof:[ns,[Er],(it,[nt])=>jt(Zo(nt.evaluate(it)))],"to-rgba":[Wt(Pr,4),[Yn],(it,[nt])=>{const[st,lt,ft,vt]=nt.evaluate(it).rgb;return[255*st,255*lt,255*ft,vt]}],rgb:[Yn,[Pr,Pr,Pr],Pu],rgba:[Yn,[Pr,Pr,Pr,Pr],Pu],has:{type:tr,overloads:[[[ns],(it,[nt])=>Qu(nt.evaluate(it),it.properties())],[[ns,qn],(it,[nt,st])=>Qu(nt.evaluate(it),st.evaluate(it))]]},get:{type:Er,overloads:[[[ns],(it,[nt])=>fm(nt.evaluate(it),it.properties())],[[ns,qn],(it,[nt,st])=>fm(nt.evaluate(it),st.evaluate(it))]]},"feature-state":[Er,[ns],(it,[nt])=>fm(nt.evaluate(it),it.featureState||{})],properties:[qn,[],it=>it.properties()],"geometry-type":[ns,[],it=>it.geometryType()],id:[Er,[],it=>it.id()],zoom:[Pr,[],it=>it.globals.zoom],"heatmap-density":[Pr,[],it=>it.globals.heatmapDensity||0],"line-progress":[Pr,[],it=>it.globals.lineProgress||0],accumulated:[Er,[],it=>it.globals.accumulated===void 0?null:it.globals.accumulated],"+":[Pr,_a(Pr),(it,nt)=>{let st=0;for(const lt of nt)st+=lt.evaluate(it);return st}],"*":[Pr,_a(Pr),(it,nt)=>{let st=1;for(const lt of nt)st*=lt.evaluate(it);return st}],"-":{type:Pr,overloads:[[[Pr,Pr],(it,[nt,st])=>nt.evaluate(it)-st.evaluate(it)],[[Pr],(it,[nt])=>-nt.evaluate(it)]]},"/":[Pr,[Pr,Pr],(it,[nt,st])=>nt.evaluate(it)/st.evaluate(it)],"%":[Pr,[Pr,Pr],(it,[nt,st])=>nt.evaluate(it)%st.evaluate(it)],ln2:[Pr,[],()=>Math.LN2],pi:[Pr,[],()=>Math.PI],e:[Pr,[],()=>Math.E],"^":[Pr,[Pr,Pr],(it,[nt,st])=>Math.pow(nt.evaluate(it),st.evaluate(it))],sqrt:[Pr,[Pr],(it,[nt])=>Math.sqrt(nt.evaluate(it))],log10:[Pr,[Pr],(it,[nt])=>Math.log(nt.evaluate(it))/Math.LN10],ln:[Pr,[Pr],(it,[nt])=>Math.log(nt.evaluate(it))],log2:[Pr,[Pr],(it,[nt])=>Math.log(nt.evaluate(it))/Math.LN2],sin:[Pr,[Pr],(it,[nt])=>Math.sin(nt.evaluate(it))],cos:[Pr,[Pr],(it,[nt])=>Math.cos(nt.evaluate(it))],tan:[Pr,[Pr],(it,[nt])=>Math.tan(nt.evaluate(it))],asin:[Pr,[Pr],(it,[nt])=>Math.asin(nt.evaluate(it))],acos:[Pr,[Pr],(it,[nt])=>Math.acos(nt.evaluate(it))],atan:[Pr,[Pr],(it,[nt])=>Math.atan(nt.evaluate(it))],min:[Pr,_a(Pr),(it,nt)=>Math.min(...nt.map(st=>st.evaluate(it)))],max:[Pr,_a(Pr),(it,nt)=>Math.max(...nt.map(st=>st.evaluate(it)))],abs:[Pr,[Pr],(it,[nt])=>Math.abs(nt.evaluate(it))],round:[Pr,[Pr],(it,[nt])=>{const st=nt.evaluate(it);return st<0?-Math.round(-st):Math.round(st)}],floor:[Pr,[Pr],(it,[nt])=>Math.floor(nt.evaluate(it))],ceil:[Pr,[Pr],(it,[nt])=>Math.ceil(nt.evaluate(it))],"filter-==":[tr,[ns,Er],(it,[nt,st])=>it.properties()[nt.value]===st.value],"filter-id-==":[tr,[Er],(it,[nt])=>it.id()===nt.value],"filter-type-==":[tr,[ns],(it,[nt])=>it.geometryType()===nt.value],"filter-<":[tr,[ns,Er],(it,[nt,st])=>{const lt=it.properties()[nt.value],ft=st.value;return typeof lt==typeof ft&&lt<ft}],"filter-id-<":[tr,[Er],(it,[nt])=>{const st=it.id(),lt=nt.value;return typeof st==typeof lt&&st<lt}],"filter->":[tr,[ns,Er],(it,[nt,st])=>{const lt=it.properties()[nt.value],ft=st.value;return typeof lt==typeof ft&&lt>ft}],"filter-id->":[tr,[Er],(it,[nt])=>{const st=it.id(),lt=nt.value;return typeof st==typeof lt&&st>lt}],"filter-<=":[tr,[ns,Er],(it,[nt,st])=>{const lt=it.properties()[nt.value],ft=st.value;return typeof lt==typeof ft&&lt<=ft}],"filter-id-<=":[tr,[Er],(it,[nt])=>{const st=it.id(),lt=nt.value;return typeof st==typeof lt&&st<=lt}],"filter->=":[tr,[ns,Er],(it,[nt,st])=>{const lt=it.properties()[nt.value],ft=st.value;return typeof lt==typeof ft&&lt>=ft}],"filter-id->=":[tr,[Er],(it,[nt])=>{const st=it.id(),lt=nt.value;return typeof st==typeof lt&&st>=lt}],"filter-has":[tr,[Er],(it,[nt])=>nt.value in it.properties()],"filter-has-id":[tr,[],it=>it.id()!==null&&it.id()!==void 0],"filter-type-in":[tr,[Wt(ns)],(it,[nt])=>nt.value.indexOf(it.geometryType())>=0],"filter-id-in":[tr,[Wt(Er)],(it,[nt])=>nt.value.indexOf(it.id())>=0],"filter-in-small":[tr,[ns,Wt(Er)],(it,[nt,st])=>st.value.indexOf(it.properties()[nt.value])>=0],"filter-in-large":[tr,[ns,Wt(Er)],(it,[nt,st])=>function(lt,ft,vt,xt){for(;vt<=xt;){const bt=vt+xt>>1;if(ft[bt]===lt)return!0;ft[bt]>lt?xt=bt-1:vt=bt+1}return!1}(it.properties()[nt.value],st.value,0,st.value.length-1)],all:{type:tr,overloads:[[[tr,tr],(it,[nt,st])=>nt.evaluate(it)&&st.evaluate(it)],[_a(tr),(it,nt)=>{for(const st of nt)if(!st.evaluate(it))return!1;return!0}]]},any:{type:tr,overloads:[[[tr,tr],(it,[nt,st])=>nt.evaluate(it)||st.evaluate(it)],[_a(tr),(it,nt)=>{for(const st of nt)if(st.evaluate(it))return!0;return!1}]]},"!":[tr,[tr],(it,[nt])=>!nt.evaluate(it)],"is-supported-script":[tr,[ns],(it,[nt])=>{const st=it.globals&&it.globals.isSupportedScript;return!st||st(nt.evaluate(it))}],upcase:[ns,[ns],(it,[nt])=>nt.evaluate(it).toUpperCase()],downcase:[ns,[ns],(it,[nt])=>nt.evaluate(it).toLowerCase()],concat:[ns,_a(Er),(it,nt)=>nt.map(st=>_p(st.evaluate(it))).join("")],"resolved-locale":[ns,[kr],(it,[nt])=>nt.evaluate(it).resolvedLocale()]});class Tp{constructor(nt,st){var lt;this.expression=nt,this._warningHistory={},this._evaluator=new vp,this._defaultValue=st?(lt=st).type==="color"&&qp(lt.default)?new oo(0,0,0,0):lt.type==="color"?oo.parse(lt.default)||null:lt.type==="padding"?Gl.parse(lt.default)||null:lt.type==="variableAnchorOffsetCollection"?tu.parse(lt.default)||null:lt.default===void 0?null:lt.default:null,this._enumValues=st&&st.type==="enum"?st.values:null}evaluateWithoutErrorHandling(nt,st,lt,ft,vt,xt){return this._evaluator.globals=nt,this._evaluator.feature=st,this._evaluator.featureState=lt,this._evaluator.canonical=ft,this._evaluator.availableImages=vt||null,this._evaluator.formattedSection=xt,this.expression.evaluate(this._evaluator)}evaluate(nt,st,lt,ft,vt,xt){this._evaluator.globals=nt,this._evaluator.feature=st||null,this._evaluator.featureState=lt||null,this._evaluator.canonical=ft,this._evaluator.availableImages=vt||null,this._evaluator.formattedSection=xt||null;try{const bt=this.expression.evaluate(this._evaluator);if(bt==null||typeof bt=="number"&&bt!=bt)return this._defaultValue;if(this._enumValues&&!(bt in this._enumValues))throw new Ko(`Expected value to be one of ${Object.keys(this._enumValues).map(Et=>JSON.stringify(Et)).join(", ")}, but found ${JSON.stringify(bt)} instead.`);return bt}catch(bt){return this._warningHistory[bt.message]||(this._warningHistory[bt.message]=!0,typeof console<"u"&&console.warn(bt.message)),this._defaultValue}}}function Cp(it){return Array.isArray(it)&&it.length>0&&typeof it[0]=="string"&&it[0]in fu}function iu(it,nt){const st=new ju(fu,sp,[],nt?function(ft){const vt={color:Yn,string:ns,number:Pr,enum:ns,boolean:tr,formatted:Us,padding:lo,resolvedImage:rr,variableAnchorOffsetCollection:_n};return ft.type==="array"?Wt(vt[ft.value]||Er,ft.length):vt[ft.type]}(nt):void 0),lt=st.parse(it,void 0,void 0,void 0,nt&&nt.type==="string"?{typeAnnotation:"coerce"}:void 0);return lt?mu(new Tp(lt,nt)):op(st.errors)}class lp{constructor(nt,st){this.kind=nt,this._styleExpression=st,this.isStateDependent=nt!=="constant"&&!So(st.expression)}evaluateWithoutErrorHandling(nt,st,lt,ft,vt,xt){return this._styleExpression.evaluateWithoutErrorHandling(nt,st,lt,ft,vt,xt)}evaluate(nt,st,lt,ft,vt,xt){return this._styleExpression.evaluate(nt,st,lt,ft,vt,xt)}}class cp{constructor(nt,st,lt,ft){this.kind=nt,this.zoomStops=lt,this._styleExpression=st,this.isStateDependent=nt!=="camera"&&!So(st.expression),this.interpolationType=ft}evaluateWithoutErrorHandling(nt,st,lt,ft,vt,xt){return this._styleExpression.evaluateWithoutErrorHandling(nt,st,lt,ft,vt,xt)}evaluate(nt,st,lt,ft,vt,xt){return this._styleExpression.evaluate(nt,st,lt,ft,vt,xt)}interpolationFactor(nt,st,lt){return this.interpolationType?Rl.interpolationFactor(this.interpolationType,nt,st,lt):0}}function kp(it,nt){const st=iu(it,nt);if(st.result==="error")return st;const lt=st.value.expression,ft=wp(lt);if(!ft&&!ap(nt))return op([new ds("","data expressions not supported")]);const vt=Ep(lt,["zoom"]);if(!vt&&!Rm(nt))return op([new ds("","zoom expressions not supported")]);const xt=_h(lt);return xt||vt?xt instanceof ds?op([xt]):xt instanceof Rl&&!Sp(nt)?op([new ds("",'"interpolate" expressions cannot be used with this property')]):mu(xt?new cp(ft?"camera":"composite",st.value,xt.labels,xt instanceof Rl?xt.interpolation:void 0):new lp(ft?"constant":"source",st.value)):op([new ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Uu{constructor(nt,st){this._parameters=nt,this._specification=st,ws(this,Mm(this._parameters,this._specification))}static deserialize(nt){return new Uu(nt._parameters,nt._specification)}static serialize(nt){return{_parameters:nt._parameters,_specification:nt._specification}}}function _h(it){let nt=null;if(it instanceof $u)nt=_h(it.result);else if(it instanceof ip){for(const st of it.args)if(nt=_h(st),nt)break}else(it instanceof np||it instanceof Rl)&&it.input instanceof Il&&it.input.name==="zoom"&&(nt=it);return nt instanceof ds||it.eachChild(st=>{const lt=_h(st);lt instanceof ds?nt=lt:!nt&&lt?nt=new ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):nt&&lt&&nt!==lt&&(nt=new ds("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),nt}function Pp(it){if(it===!0||it===!1)return!0;if(!Array.isArray(it)||it.length===0)return!1;switch(it[0]){case"has":return it.length>=2&&it[1]!=="$id"&&it[1]!=="$type";case"in":return it.length>=3&&(typeof it[1]!="string"||Array.isArray(it[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return it.length!==3||Array.isArray(it[1])||Array.isArray(it[2]);case"any":case"all":for(const nt of it.slice(1))if(!Pp(nt)&&typeof nt!="boolean")return!1;return!0;default:return!0}}const Xp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rp(it){if(it==null)return{filter:()=>!0,needGeometry:!1};Pp(it)||(it=Mp(it));const nt=iu(it,Xp);if(nt.result==="error")throw new Error(nt.value.map(st=>`${st.key}: ${st.message}`).join(", "));return{filter:(st,lt,ft)=>nt.value.evaluate(st,lt,{},ft),needGeometry:Dm(it)}}function g_(it,nt){return it<nt?-1:it>nt?1:0}function Dm(it){if(!Array.isArray(it))return!1;if(it[0]==="within"||it[0]==="distance")return!0;for(let nt=1;nt<it.length;nt++)if(Dm(it[nt]))return!0;return!1}function Mp(it){if(!it)return!0;const nt=it[0];return it.length<=1?nt!=="any":nt==="=="?Xr(it[1],it[2],"=="):nt==="!="?io(Xr(it[1],it[2],"==")):nt==="<"||nt===">"||nt==="<="||nt===">="?Xr(it[1],it[2],nt):nt==="any"?(st=it.slice(1),["any"].concat(st.map(Mp))):nt==="all"?["all"].concat(it.slice(1).map(Mp)):nt==="none"?["all"].concat(it.slice(1).map(Mp).map(io)):nt==="in"?Ks(it[1],it.slice(2)):nt==="!in"?io(Ks(it[1],it.slice(2))):nt==="has"?so(it[1]):nt!=="!has"||io(so(it[1]));var st}function Xr(it,nt,st){switch(it){case"$type":return[`filter-type-${st}`,nt];case"$id":return[`filter-id-${st}`,nt];default:return[`filter-${st}`,it,nt]}}function Ks(it,nt){if(nt.length===0)return!1;switch(it){case"$type":return["filter-type-in",["literal",nt]];case"$id":return["filter-id-in",["literal",nt]];default:return nt.length>200&&!nt.some(st=>typeof st!=typeof nt[0])?["filter-in-large",it,["literal",nt.sort(g_)]]:["filter-in-small",it,["literal",nt]]}}function so(it){switch(it){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",it]}}function io(it){return["!",it]}function ho(it){const nt=typeof it;if(nt==="number"||nt==="boolean"||nt==="string"||it==null)return JSON.stringify(it);if(Array.isArray(it)){let ft="[";for(const vt of it)ft+=`${ho(vt)},`;return`${ft}]`}const st=Object.keys(it).sort();let lt="{";for(let ft=0;ft<st.length;ft++)lt+=`${JSON.stringify(st[ft])}:${ho(it[st[ft]])},`;return`${lt}}`}function uo(it){let nt="";for(const st of Mr)nt+=`/${ho(it[st])}`;return nt}function Jo(it){const nt=it.value;return nt?[new Cr(it.key,nt,"constants have been deprecated as of v8")]:[]}function Mo(it){return it instanceof Number||it instanceof String||it instanceof Boolean?it.valueOf():it}function Kl(it){if(Array.isArray(it))return it.map(Kl);if(it instanceof Object&&!(it instanceof Number||it instanceof String||it instanceof Boolean)){const nt={};for(const st in it)nt[st]=Kl(it[st]);return nt}return Mo(it)}function El(it){const nt=it.key,st=it.value,lt=it.valueSpec||{},ft=it.objectElementValidators||{},vt=it.style,xt=it.styleSpec,bt=it.validateSpec;let Et=[];const Ct=bo(st);if(Ct!=="object")return[new Cr(nt,st,`object expected, ${Ct} found`)];for(const Dt in st){const Vt=Dt.split(".")[0],en=lt[Vt]||lt["*"];let cn;if(ft[Vt])cn=ft[Vt];else if(lt[Vt])cn=bt;else if(ft["*"])cn=ft["*"];else{if(!lt["*"]){Et.push(new Cr(nt,st[Dt],`unknown property "${Dt}"`));continue}cn=bt}Et=Et.concat(cn({key:(nt&&`${nt}.`)+Dt,value:st[Dt],valueSpec:en,style:vt,styleSpec:xt,object:st,objectKey:Dt,validateSpec:bt},st))}for(const Dt in lt)ft[Dt]||lt[Dt].required&&lt[Dt].default===void 0&&st[Dt]===void 0&&Et.push(new Cr(nt,st,`missing required property "${Dt}"`));return Et}function ru(it){const nt=it.value,st=it.valueSpec,lt=it.style,ft=it.styleSpec,vt=it.key,xt=it.arrayElementValidator||it.validateSpec;if(bo(nt)!=="array")return[new Cr(vt,nt,`array expected, ${bo(nt)} found`)];if(st.length&&nt.length!==st.length)return[new Cr(vt,nt,`array length ${st.length} expected, length ${nt.length} found`)];if(st["min-length"]&&nt.length<st["min-length"])return[new Cr(vt,nt,`array length at least ${st["min-length"]} expected, length ${nt.length} found`)];let bt={type:st.value,values:st.values};ft.$version<7&&(bt.function=st.function),bo(st.value)==="object"&&(bt=st.value);let Et=[];for(let Ct=0;Ct<nt.length;Ct++)Et=Et.concat(xt({array:nt,arrayIndex:Ct,value:nt[Ct],valueSpec:bt,validateSpec:it.validateSpec,style:lt,styleSpec:ft,key:`${vt}[${Ct}]`}));return Et}function up(it){const nt=it.key,st=it.value,lt=it.valueSpec;let ft=bo(st);return ft==="number"&&st!=st&&(ft="NaN"),ft!=="number"?[new Cr(nt,st,`number expected, ${ft} found`)]:"minimum"in lt&&st<lt.minimum?[new Cr(nt,st,`${st} is less than the minimum value ${lt.minimum}`)]:"maximum"in lt&&st>lt.maximum?[new Cr(nt,st,`${st} is greater than the maximum value ${lt.maximum}`)]:[]}function Ip(it){const nt=it.valueSpec,st=Mo(it.value.type);let lt,ft,vt,xt={};const bt=st!=="categorical"&&it.value.property===void 0,Et=!bt,Ct=bo(it.value.stops)==="array"&&bo(it.value.stops[0])==="array"&&bo(it.value.stops[0][0])==="object",Dt=El({key:it.key,value:it.value,valueSpec:it.styleSpec.function,validateSpec:it.validateSpec,style:it.style,styleSpec:it.styleSpec,objectElementValidators:{stops:function(cn){if(st==="identity")return[new Cr(cn.key,cn.value,'identity function may not have a "stops" property')];let gn=[];const bn=cn.value;return gn=gn.concat(ru({key:cn.key,value:bn,valueSpec:cn.valueSpec,validateSpec:cn.validateSpec,style:cn.style,styleSpec:cn.styleSpec,arrayElementValidator:Vt})),bo(bn)==="array"&&bn.length===0&&gn.push(new Cr(cn.key,bn,"array must have at least one stop")),gn},default:function(cn){return cn.validateSpec({key:cn.key,value:cn.value,valueSpec:nt,validateSpec:cn.validateSpec,style:cn.style,styleSpec:cn.styleSpec})}}});return st==="identity"&&bt&&Dt.push(new Cr(it.key,it.value,'missing required property "property"')),st==="identity"||it.value.stops||Dt.push(new Cr(it.key,it.value,'missing required property "stops"')),st==="exponential"&&it.valueSpec.expression&&!Sp(it.valueSpec)&&Dt.push(new Cr(it.key,it.value,"exponential functions not supported")),it.styleSpec.$version>=8&&(Et&&!ap(it.valueSpec)?Dt.push(new Cr(it.key,it.value,"property functions not supported")):bt&&!Rm(it.valueSpec)&&Dt.push(new Cr(it.key,it.value,"zoom functions not supported"))),st!=="categorical"&&!Ct||it.value.property!==void 0||Dt.push(new Cr(it.key,it.value,'"property" property is required')),Dt;function Vt(cn){let gn=[];const bn=cn.value,Ln=cn.key;if(bo(bn)!=="array")return[new Cr(Ln,bn,`array expected, ${bo(bn)} found`)];if(bn.length!==2)return[new Cr(Ln,bn,`array length 2 expected, length ${bn.length} found`)];if(Ct){if(bo(bn[0])!=="object")return[new Cr(Ln,bn,`object expected, ${bo(bn[0])} found`)];if(bn[0].zoom===void 0)return[new Cr(Ln,bn,"object stop key must have zoom")];if(bn[0].value===void 0)return[new Cr(Ln,bn,"object stop key must have value")];if(vt&&vt>Mo(bn[0].zoom))return[new Cr(Ln,bn[0].zoom,"stop zoom values must appear in ascending order")];Mo(bn[0].zoom)!==vt&&(vt=Mo(bn[0].zoom),ft=void 0,xt={}),gn=gn.concat(El({key:`${Ln}[0]`,value:bn[0],valueSpec:{zoom:{}},validateSpec:cn.validateSpec,style:cn.style,styleSpec:cn.styleSpec,objectElementValidators:{zoom:up,value:en}}))}else gn=gn.concat(en({key:`${Ln}[0]`,value:bn[0],valueSpec:{},validateSpec:cn.validateSpec,style:cn.style,styleSpec:cn.styleSpec},bn));return Cp(Kl(bn[1]))?gn.concat([new Cr(`${Ln}[1]`,bn[1],"expressions are not allowed in function stops.")]):gn.concat(cn.validateSpec({key:`${Ln}[1]`,value:bn[1],valueSpec:nt,validateSpec:cn.validateSpec,style:cn.style,styleSpec:cn.styleSpec}))}function en(cn,gn){const bn=bo(cn.value),Ln=Mo(cn.value),Vn=cn.value!==null?cn.value:gn;if(lt){if(bn!==lt)return[new Cr(cn.key,Vn,`${bn} stop domain type must match previous stop domain type ${lt}`)]}else lt=bn;if(bn!=="number"&&bn!=="string"&&bn!=="boolean")return[new Cr(cn.key,Vn,"stop domain value must be a number, string, or boolean")];if(bn!=="number"&&st!=="categorical"){let vr=`number expected, ${bn} found`;return ap(nt)&&st===void 0&&(vr+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Cr(cn.key,Vn,vr)]}return st!=="categorical"||bn!=="number"||isFinite(Ln)&&Math.floor(Ln)===Ln?st!=="categorical"&&bn==="number"&&ft!==void 0&&Ln<ft?[new Cr(cn.key,Vn,"stop domain values must appear in ascending order")]:(ft=Ln,st==="categorical"&&Ln in xt?[new Cr(cn.key,Vn,"stop domain values must be unique")]:(xt[Ln]=!0,[])):[new Cr(cn.key,Vn,`integer expected, found ${Ln}`)]}}function Ru(it){const nt=(it.expressionContext==="property"?kp:iu)(Kl(it.value),it.valueSpec);if(nt.result==="error")return nt.value.map(lt=>new Cr(`${it.key}${lt.key}`,it.value,lt.message));const st=nt.value.expression||nt.value._styleExpression.expression;if(it.expressionContext==="property"&&it.propertyKey==="text-font"&&!st.outputDefined())return[new Cr(it.key,it.value,`Invalid data expression for "${it.propertyKey}". Output values must be contained as literals within the expression.`)];if(it.expressionContext==="property"&&it.propertyType==="layout"&&!So(st))return[new Cr(it.key,it.value,'"feature-state" data expressions are not supported with layout properties.')];if(it.expressionContext==="filter"&&!So(st))return[new Cr(it.key,it.value,'"feature-state" data expressions are not supported with filters.')];if(it.expressionContext&&it.expressionContext.indexOf("cluster")===0){if(!Ep(st,["zoom","feature-state"]))return[new Cr(it.key,it.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(it.expressionContext==="cluster-initial"&&!wp(st))return[new Cr(it.key,it.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zl(it){const nt=it.key,st=it.value,lt=it.valueSpec,ft=[];return Array.isArray(lt.values)?lt.values.indexOf(Mo(st))===-1&&ft.push(new Cr(nt,st,`expected one of [${lt.values.join(", ")}], ${JSON.stringify(st)} found`)):Object.keys(lt.values).indexOf(Mo(st))===-1&&ft.push(new Cr(nt,st,`expected one of [${Object.keys(lt.values).join(", ")}], ${JSON.stringify(st)} found`)),ft}function __(it){return Pp(Kl(it.value))?Ru(ws({},it,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lm(it)}function Lm(it){const nt=it.value,st=it.key;if(bo(nt)!=="array")return[new Cr(st,nt,`array expected, ${bo(nt)} found`)];const lt=it.styleSpec;let ft,vt=[];if(nt.length<1)return[new Cr(st,nt,"filter array must have at least 1 element")];switch(vt=vt.concat(zl({key:`${st}[0]`,value:nt[0],valueSpec:lt.filter_operator,style:it.style,styleSpec:it.styleSpec})),Mo(nt[0])){case"<":case"<=":case">":case">=":nt.length>=2&&Mo(nt[1])==="$type"&&vt.push(new Cr(st,nt,`"$type" cannot be use with operator "${nt[0]}"`));case"==":case"!=":nt.length!==3&&vt.push(new Cr(st,nt,`filter array for operator "${nt[0]}" must have 3 elements`));case"in":case"!in":nt.length>=2&&(ft=bo(nt[1]),ft!=="string"&&vt.push(new Cr(`${st}[1]`,nt[1],`string expected, ${ft} found`)));for(let xt=2;xt<nt.length;xt++)ft=bo(nt[xt]),Mo(nt[1])==="$type"?vt=vt.concat(zl({key:`${st}[${xt}]`,value:nt[xt],valueSpec:lt.geometry_type,style:it.style,styleSpec:it.styleSpec})):ft!=="string"&&ft!=="number"&&ft!=="boolean"&&vt.push(new Cr(`${st}[${xt}]`,nt[xt],`string, number, or boolean expected, ${ft} found`));break;case"any":case"all":case"none":for(let xt=1;xt<nt.length;xt++)vt=vt.concat(Lm({key:`${st}[${xt}]`,value:nt[xt],style:it.style,styleSpec:it.styleSpec}));break;case"has":case"!has":ft=bo(nt[1]),nt.length!==2?vt.push(new Cr(st,nt,`filter array for "${nt[0]}" operator must have 2 elements`)):ft!=="string"&&vt.push(new Cr(`${st}[1]`,nt[1],`string expected, ${ft} found`))}return vt}function y_(it,nt){const st=it.key,lt=it.validateSpec,ft=it.style,vt=it.styleSpec,xt=it.value,bt=it.objectKey,Et=vt[`${nt}_${it.layerType}`];if(!Et)return[];const Ct=bt.match(/^(.*)-transition$/);if(nt==="paint"&&Ct&&Et[Ct[1]]&&Et[Ct[1]].transition)return lt({key:st,value:xt,valueSpec:vt.transition,style:ft,styleSpec:vt});const Dt=it.valueSpec||Et[bt];if(!Dt)return[new Cr(st,xt,`unknown property "${bt}"`)];let Vt;if(bo(xt)==="string"&&ap(Dt)&&!Dt.tokens&&(Vt=/^{([^}]+)}$/.exec(xt)))return[new Cr(st,xt,`"${bt}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Vt[1])} }\`.`)];const en=[];return it.layerType==="symbol"&&(bt==="text-field"&&ft&&!ft.glyphs&&en.push(new Cr(st,xt,'use of "text-field" requires a style "glyphs" property')),bt==="text-font"&&qp(Kl(xt))&&Mo(xt.type)==="identity"&&en.push(new Cr(st,xt,'"text-font" does not support identity functions'))),en.concat(lt({key:it.key,value:xt,valueSpec:Dt,style:ft,styleSpec:vt,expressionContext:"property",propertyType:nt,propertyKey:bt}))}function Fm(it){return y_(it,"paint")}function v_(it){return y_(it,"layout")}function x_(it){let nt=[];const st=it.value,lt=it.key,ft=it.style,vt=it.styleSpec;st.type||st.ref||nt.push(new Cr(lt,st,'either "type" or "ref" is required'));let xt=Mo(st.type);const bt=Mo(st.ref);if(st.id){const Et=Mo(st.id);for(let Ct=0;Ct<it.arrayIndex;Ct++){const Dt=ft.layers[Ct];Mo(Dt.id)===Et&&nt.push(new Cr(lt,st.id,`duplicate layer id "${st.id}", previously used at line ${Dt.id.__line__}`))}}if("ref"in st){let Et;["type","source","source-layer","filter","layout"].forEach(Ct=>{Ct in st&&nt.push(new Cr(lt,st[Ct],`"${Ct}" is prohibited for ref layers`))}),ft.layers.forEach(Ct=>{Mo(Ct.id)===bt&&(Et=Ct)}),Et?Et.ref?nt.push(new Cr(lt,st.ref,"ref cannot reference another ref layer")):xt=Mo(Et.type):nt.push(new Cr(lt,st.ref,`ref layer "${bt}" not found`))}else if(xt!=="background")if(st.source){const Et=ft.sources&&ft.sources[st.source],Ct=Et&&Mo(Et.type);Et?Ct==="vector"&&xt==="raster"?nt.push(new Cr(lt,st.source,`layer "${st.id}" requires a raster source`)):Ct!=="raster-dem"&&xt==="hillshade"?nt.push(new Cr(lt,st.source,`layer "${st.id}" requires a raster-dem source`)):Ct==="raster"&&xt!=="raster"?nt.push(new Cr(lt,st.source,`layer "${st.id}" requires a vector source`)):Ct!=="vector"||st["source-layer"]?Ct==="raster-dem"&&xt!=="hillshade"?nt.push(new Cr(lt,st.source,"raster-dem source can only be used with layer type 'hillshade'.")):xt!=="line"||!st.paint||!st.paint["line-gradient"]||Ct==="geojson"&&Et.lineMetrics||nt.push(new Cr(lt,st,`layer "${st.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):nt.push(new Cr(lt,st,`layer "${st.id}" must specify a "source-layer"`)):nt.push(new Cr(lt,st.source,`source "${st.source}" not found`))}else nt.push(new Cr(lt,st,'missing required property "source"'));return nt=nt.concat(El({key:lt,value:st,valueSpec:vt.layer,style:it.style,styleSpec:it.styleSpec,validateSpec:it.validateSpec,objectElementValidators:{"*":()=>[],type:()=>it.validateSpec({key:`${lt}.type`,value:st.type,valueSpec:vt.layer.type,style:it.style,styleSpec:it.styleSpec,validateSpec:it.validateSpec,object:st,objectKey:"type"}),filter:__,layout:Et=>El({layer:st,key:Et.key,value:Et.value,style:Et.style,styleSpec:Et.styleSpec,validateSpec:Et.validateSpec,objectElementValidators:{"*":Ct=>v_(ws({layerType:xt},Ct))}}),paint:Et=>El({layer:st,key:Et.key,value:Et.value,style:Et.style,styleSpec:Et.styleSpec,validateSpec:Et.validateSpec,objectElementValidators:{"*":Ct=>Fm(ws({layerType:xt},Ct))}})}})),nt}function Dp(it){const nt=it.value,st=it.key,lt=bo(nt);return lt!=="string"?[new Cr(st,nt,`string expected, ${lt} found`)]:[]}const Om={promoteId:function({key:it,value:nt}){if(bo(nt)==="string")return Dp({key:it,value:nt});{const st=[];for(const lt in nt)st.push(...Dp({key:`${it}.${lt}`,value:nt[lt]}));return st}}};function gm(it){const nt=it.value,st=it.key,lt=it.styleSpec,ft=it.style,vt=it.validateSpec;if(!nt.type)return[new Cr(st,nt,'"type" is required')];const xt=Mo(nt.type);let bt;switch(xt){case"vector":case"raster":return bt=El({key:st,value:nt,valueSpec:lt[`source_${xt.replace("-","_")}`],style:it.style,styleSpec:lt,objectElementValidators:Om,validateSpec:vt}),bt;case"raster-dem":return bt=function(Et){var Ct;const Dt=(Ct=Et.sourceName)!==null&&Ct!==void 0?Ct:"",Vt=Et.value,en=Et.styleSpec,cn=en.source_raster_dem,gn=Et.style;let bn=[];const Ln=bo(Vt);if(Vt===void 0)return bn;if(Ln!=="object")return bn.push(new Cr("source_raster_dem",Vt,`object expected, ${Ln} found`)),bn;const Vn=Mo(Vt.encoding)==="custom",vr=["redFactor","greenFactor","blueFactor","baseShift"],er=Et.value.encoding?`"${Et.value.encoding}"`:"Default";for(const _r in Vt)!Vn&&vr.includes(_r)?bn.push(new Cr(_r,Vt[_r],`In "${Dt}": "${_r}" is only valid when "encoding" is set to "custom". ${er} encoding found`)):cn[_r]?bn=bn.concat(Et.validateSpec({key:_r,value:Vt[_r],valueSpec:cn[_r],validateSpec:Et.validateSpec,style:gn,styleSpec:en})):bn.push(new Cr(_r,Vt[_r],`unknown property "${_r}"`));return bn}({sourceName:st,value:nt,style:it.style,styleSpec:lt,validateSpec:vt}),bt;case"geojson":if(bt=El({key:st,value:nt,valueSpec:lt.source_geojson,style:ft,styleSpec:lt,validateSpec:vt,objectElementValidators:Om}),nt.cluster)for(const Et in nt.clusterProperties){const[Ct,Dt]=nt.clusterProperties[Et],Vt=typeof Ct=="string"?[Ct,["accumulated"],["get",Et]]:Ct;bt.push(...Ru({key:`${st}.${Et}.map`,value:Dt,validateSpec:vt,expressionContext:"cluster-map"})),bt.push(...Ru({key:`${st}.${Et}.reduce`,value:Vt,validateSpec:vt,expressionContext:"cluster-reduce"}))}return bt;case"video":return El({key:st,value:nt,valueSpec:lt.source_video,style:ft,validateSpec:vt,styleSpec:lt});case"image":return El({key:st,value:nt,valueSpec:lt.source_image,style:ft,validateSpec:vt,styleSpec:lt});case"canvas":return[new Cr(st,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zl({key:`${st}.type`,value:nt.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:ft,validateSpec:vt,styleSpec:lt})}}function b_(it){const nt=it.value,st=it.styleSpec,lt=st.light,ft=it.style;let vt=[];const xt=bo(nt);if(nt===void 0)return vt;if(xt!=="object")return vt=vt.concat([new Cr("light",nt,`object expected, ${xt} found`)]),vt;for(const bt in nt){const Et=bt.match(/^(.*)-transition$/);vt=vt.concat(Et&&lt[Et[1]]&&lt[Et[1]].transition?it.validateSpec({key:bt,value:nt[bt],valueSpec:st.transition,validateSpec:it.validateSpec,style:ft,styleSpec:st}):lt[bt]?it.validateSpec({key:bt,value:nt[bt],valueSpec:lt[bt],validateSpec:it.validateSpec,style:ft,styleSpec:st}):[new Cr(bt,nt[bt],`unknown property "${bt}"`)])}return vt}function w_(it){const nt=it.value,st=it.styleSpec,lt=st.sky,ft=it.style,vt=bo(nt);if(nt===void 0)return[];if(vt!=="object")return[new Cr("sky",nt,`object expected, ${vt} found`)];let xt=[];for(const bt in nt)xt=xt.concat(lt[bt]?it.validateSpec({key:bt,value:nt[bt],valueSpec:lt[bt],style:ft,styleSpec:st}):[new Cr(bt,nt[bt],`unknown property "${bt}"`)]);return xt}function E_(it){const nt=it.value,st=it.styleSpec,lt=st.terrain,ft=it.style;let vt=[];const xt=bo(nt);if(nt===void 0)return vt;if(xt!=="object")return vt=vt.concat([new Cr("terrain",nt,`object expected, ${xt} found`)]),vt;for(const bt in nt)vt=vt.concat(lt[bt]?it.validateSpec({key:bt,value:nt[bt],valueSpec:lt[bt],validateSpec:it.validateSpec,style:ft,styleSpec:st}):[new Cr(bt,nt[bt],`unknown property "${bt}"`)]);return vt}function S_(it){let nt=[];const st=it.value,lt=it.key;if(Array.isArray(st)){const ft=[],vt=[];for(const xt in st)st[xt].id&&ft.includes(st[xt].id)&&nt.push(new Cr(lt,st,`all the sprites' ids must be unique, but ${st[xt].id} is duplicated`)),ft.push(st[xt].id),st[xt].url&&vt.includes(st[xt].url)&&nt.push(new Cr(lt,st,`all the sprites' URLs must be unique, but ${st[xt].url} is duplicated`)),vt.push(st[xt].url),nt=nt.concat(El({key:`${lt}[${xt}]`,value:st[xt],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:it.validateSpec}));return nt}return Dp({key:lt,value:st})}const zm={"*":()=>[],array:ru,boolean:function(it){const nt=it.value,st=it.key,lt=bo(nt);return lt!=="boolean"?[new Cr(st,nt,`boolean expected, ${lt} found`)]:[]},number:up,color:function(it){const nt=it.key,st=it.value,lt=bo(st);return lt!=="string"?[new Cr(nt,st,`color expected, ${lt} found`)]:oo.parse(String(st))?[]:[new Cr(nt,st,`color expected, "${st}" found`)]},constants:Jo,enum:zl,filter:__,function:Ip,layer:x_,object:El,source:gm,light:b_,sky:w_,terrain:E_,projection:function(it){const nt=it.value,st=it.styleSpec,lt=st.projection,ft=it.style,vt=bo(nt);if(nt===void 0)return[];if(vt!=="object")return[new Cr("projection",nt,`object expected, ${vt} found`)];let xt=[];for(const bt in nt)xt=xt.concat(lt[bt]?it.validateSpec({key:bt,value:nt[bt],valueSpec:lt[bt],style:ft,styleSpec:st}):[new Cr(bt,nt[bt],`unknown property "${bt}"`)]);return xt},string:Dp,formatted:function(it){return Dp(it).length===0?[]:Ru(it)},resolvedImage:function(it){return Dp(it).length===0?[]:Ru(it)},padding:function(it){const nt=it.key,st=it.value;if(bo(st)==="array"){if(st.length<1||st.length>4)return[new Cr(nt,st,`padding requires 1 to 4 values; ${st.length} values found`)];const lt={type:"number"};let ft=[];for(let vt=0;vt<st.length;vt++)ft=ft.concat(it.validateSpec({key:`${nt}[${vt}]`,value:st[vt],validateSpec:it.validateSpec,valueSpec:lt}));return ft}return up({key:nt,value:st,valueSpec:{}})},variableAnchorOffsetCollection:function(it){const nt=it.key,st=it.value,lt=bo(st),ft=it.styleSpec;if(lt!=="array"||st.length<1||st.length%2!=0)return[new Cr(nt,st,"variableAnchorOffsetCollection requires a non-empty array of even length")];let vt=[];for(let xt=0;xt<st.length;xt+=2)vt=vt.concat(zl({key:`${nt}[${xt}]`,value:st[xt],valueSpec:ft.layout_symbol["text-anchor"]})),vt=vt.concat(ru({key:`${nt}[${xt+1}]`,value:st[xt+1],valueSpec:{length:2,value:"number"},validateSpec:it.validateSpec,style:it.style,styleSpec:ft}));return vt},sprite:S_};function Zp(it){const nt=it.value,st=it.valueSpec,lt=it.styleSpec;return it.validateSpec=Zp,st.expression&&qp(Mo(nt))?Ip(it):st.expression&&Cp(Kl(nt))?Ru(it):st.type&&zm[st.type]?zm[st.type](it):El(ws({},it,{valueSpec:st.type?lt[st.type]:st}))}function ay(it){const nt=it.value,st=it.key,lt=Dp(it);return lt.length||(nt.indexOf("{fontstack}")===-1&&lt.push(new Cr(st,nt,'"glyphs" url must include a "{fontstack}" token')),nt.indexOf("{range}")===-1&&lt.push(new Cr(st,nt,'"glyphs" url must include a "{range}" token'))),lt}function wu(it,nt=On){let st=[];return st=st.concat(Zp({key:"",value:it,valueSpec:nt.$root,styleSpec:nt,style:it,validateSpec:Zp,objectElementValidators:{glyphs:ay,"*":()=>[]}})),it.constants&&(st=st.concat(Jo({key:"constants",value:it.constants,style:it,styleSpec:nt,validateSpec:Zp}))),A_(st)}function Vu(it){return function(nt){return it({...nt,validateSpec:Zp})}}function A_(it){return[].concat(it).sort((nt,st)=>nt.line-st.line)}function Mu(it){return function(...nt){return A_(it.apply(this,nt))}}wu.source=Mu(Vu(gm)),wu.sprite=Mu(Vu(S_)),wu.glyphs=Mu(Vu(ay)),wu.light=Mu(Vu(b_)),wu.sky=Mu(Vu(w_)),wu.terrain=Mu(Vu(E_)),wu.layer=Mu(Vu(x_)),wu.filter=Mu(Vu(__)),wu.paintProperty=Mu(Vu(Fm)),wu.layoutProperty=Mu(Vu(v_));const Lp=wu,Jy=Lp.light,Qy=Lp.sky,ly=Lp.paintProperty,cy=Lp.layoutProperty;function T_(it,nt){let st=!1;if(nt&&nt.length)for(const lt of nt)it.fire(new wr(new Error(lt.message))),st=!0;return st}class Kp{constructor(nt,st,lt){const ft=this.cells=[];if(nt instanceof ArrayBuffer){this.arrayBuffer=nt;const xt=new Int32Array(this.arrayBuffer);nt=xt[0],this.d=(st=xt[1])+2*(lt=xt[2]);for(let Et=0;Et<this.d*this.d;Et++){const Ct=xt[3+Et],Dt=xt[3+Et+1];ft.push(Ct===Dt?null:xt.subarray(Ct,Dt))}const bt=xt[3+ft.length+1];this.keys=xt.subarray(xt[3+ft.length],bt),this.bboxes=xt.subarray(bt),this.insert=this._insertReadonly}else{this.d=st+2*lt;for(let xt=0;xt<this.d*this.d;xt++)ft.push([]);this.keys=[],this.bboxes=[]}this.n=st,this.extent=nt,this.padding=lt,this.scale=st/nt,this.uid=0;const vt=lt/st*nt;this.min=-vt,this.max=nt+vt}insert(nt,st,lt,ft,vt){this._forEachCell(st,lt,ft,vt,this._insertCell,this.uid++,void 0,void 0),this.keys.push(nt),this.bboxes.push(st),this.bboxes.push(lt),this.bboxes.push(ft),this.bboxes.push(vt)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(nt,st,lt,ft,vt,xt){this.cells[vt].push(xt)}query(nt,st,lt,ft,vt){const xt=this.min,bt=this.max;if(nt<=xt&&st<=xt&&bt<=lt&&bt<=ft&&!vt)return Array.prototype.slice.call(this.keys);{const Et=[];return this._forEachCell(nt,st,lt,ft,this._queryCell,Et,{},vt),Et}}_queryCell(nt,st,lt,ft,vt,xt,bt,Et){const Ct=this.cells[vt];if(Ct!==null){const Dt=this.keys,Vt=this.bboxes;for(let en=0;en<Ct.length;en++){const cn=Ct[en];if(bt[cn]===void 0){const gn=4*cn;(Et?Et(Vt[gn+0],Vt[gn+1],Vt[gn+2],Vt[gn+3]):nt<=Vt[gn+2]&&st<=Vt[gn+3]&&lt>=Vt[gn+0]&&ft>=Vt[gn+1])?(bt[cn]=!0,xt.push(Dt[cn])):bt[cn]=!1}}}}_forEachCell(nt,st,lt,ft,vt,xt,bt,Et){const Ct=this._convertToCellCoord(nt),Dt=this._convertToCellCoord(st),Vt=this._convertToCellCoord(lt),en=this._convertToCellCoord(ft);for(let cn=Ct;cn<=Vt;cn++)for(let gn=Dt;gn<=en;gn++){const bn=this.d*gn+cn;if((!Et||Et(this._convertFromCellCoord(cn),this._convertFromCellCoord(gn),this._convertFromCellCoord(cn+1),this._convertFromCellCoord(gn+1)))&&vt.call(this,nt,st,lt,ft,bn,xt,bt,Et))return}}_convertFromCellCoord(nt){return(nt-this.padding)/this.scale}_convertToCellCoord(nt){return Math.max(0,Math.min(this.d-1,Math.floor(nt*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const nt=this.cells,st=3+this.cells.length+1+1;let lt=0;for(let xt=0;xt<this.cells.length;xt++)lt+=this.cells[xt].length;const ft=new Int32Array(st+lt+this.keys.length+this.bboxes.length);ft[0]=this.extent,ft[1]=this.n,ft[2]=this.padding;let vt=st;for(let xt=0;xt<nt.length;xt++){const bt=nt[xt];ft[3+xt]=vt,ft.set(bt,vt),vt+=bt.length}return ft[3+nt.length]=vt,ft.set(this.keys,vt),vt+=this.keys.length,ft[3+nt.length+1]=vt,ft.set(this.bboxes,vt),vt+=this.bboxes.length,ft.buffer}static serialize(nt,st){const lt=nt.toArrayBuffer();return st&&st.push(lt),{buffer:lt}}static deserialize(nt){return new Kp(nt.buffer)}}const Eu={};function bs(it,nt,st={}){if(Eu[it])throw new Error(`${it} is already registered.`);Object.defineProperty(nt,"_classRegistryKey",{value:it,writeable:!1}),Eu[it]={klass:nt,omit:st.omit||[],shallow:st.shallow||[]}}bs("Object",Object),bs("TransferableGridIndex",Kp),bs("Color",oo),bs("Error",Error),bs("AJAXError",rn),bs("ResolvedImage",Xl),bs("StylePropertyFunction",Uu),bs("StyleExpression",Tp,{omit:["_evaluator"]}),bs("ZoomDependentExpression",cp),bs("ZoomConstantExpression",lp),bs("CompoundExpression",Il,{omit:["_evaluate"]});for(const it in fu)fu[it]._classRegistryKey||bs(`Expression_${it}`,fu[it]);function Nm(it){return it&&typeof ArrayBuffer<"u"&&(it instanceof ArrayBuffer||it.constructor&&it.constructor.name==="ArrayBuffer")}function C_(it){return it.$name||it.constructor._classRegistryKey}function uy(it){return!function(nt){if(nt===null||typeof nt!="object")return!1;const st=C_(nt);return!(!st||st==="Object")}(it)&&(it==null||typeof it=="boolean"||typeof it=="number"||typeof it=="string"||it instanceof Boolean||it instanceof Number||it instanceof String||it instanceof Date||it instanceof RegExp||it instanceof Blob||it instanceof Error||Nm(it)||br(it)||ArrayBuffer.isView(it)||it instanceof ImageData)}function Yp(it,nt){if(uy(it))return(Nm(it)||br(it))&&nt&&nt.push(it),ArrayBuffer.isView(it)&&nt&&nt.push(it.buffer),it instanceof ImageData&&nt&&nt.push(it.data.buffer),it;if(Array.isArray(it)){const vt=[];for(const xt of it)vt.push(Yp(xt,nt));return vt}if(typeof it!="object")throw new Error("can't serialize object of type "+typeof it);const st=C_(it);if(!st)throw new Error(`can't serialize object of unregistered class ${it.constructor.name}`);if(!Eu[st])throw new Error(`${st} is not registered.`);const{klass:lt}=Eu[st],ft=lt.serialize?lt.serialize(it,nt):{};if(lt.serialize){if(nt&&ft===nt[nt.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const vt in it){if(!it.hasOwnProperty(vt)||Eu[st].omit.indexOf(vt)>=0)continue;const xt=it[vt];ft[vt]=Eu[st].shallow.indexOf(vt)>=0?xt:Yp(xt,nt)}it instanceof Error&&(ft.message=it.message)}if(ft.$name)throw new Error("$name property is reserved for worker serialization logic.");return st!=="Object"&&(ft.$name=st),ft}function Jp(it){if(uy(it))return it;if(Array.isArray(it))return it.map(Jp);if(typeof it!="object")throw new Error("can't deserialize object of type "+typeof it);const nt=C_(it)||"Object";if(!Eu[nt])throw new Error(`can't deserialize unregistered class ${nt}`);const{klass:st}=Eu[nt];if(!st)throw new Error(`can't deserialize unregistered class ${nt}`);if(st.deserialize)return st.deserialize(it);const lt=Object.create(st.prototype);for(const ft of Object.keys(it)){if(ft==="$name")continue;const vt=it[ft];lt[ft]=Eu[nt].shallow.indexOf(ft)>=0?vt:Jp(vt)}return lt}class k_{constructor(){this.first=!0}update(nt,st){const lt=Math.floor(nt);return this.first?(this.first=!1,this.lastIntegerZoom=lt,this.lastIntegerZoomTime=0,this.lastZoom=nt,this.lastFloorZoom=lt,!0):(this.lastFloorZoom>lt?(this.lastIntegerZoom=lt+1,this.lastIntegerZoomTime=st):this.lastFloorZoom<lt&&(this.lastIntegerZoom=lt,this.lastIntegerZoomTime=st),nt!==this.lastZoom&&(this.lastZoom=nt,this.lastFloorZoom=lt,!0))}}const yo={"Latin-1 Supplement":it=>it>=128&&it<=255,"Hangul Jamo":it=>it>=4352&&it<=4607,Khmer:it=>it>=6016&&it<=6143,"General Punctuation":it=>it>=8192&&it<=8303,"Letterlike Symbols":it=>it>=8448&&it<=8527,"Number Forms":it=>it>=8528&&it<=8591,"Miscellaneous Technical":it=>it>=8960&&it<=9215,"Control Pictures":it=>it>=9216&&it<=9279,"Optical Character Recognition":it=>it>=9280&&it<=9311,"Enclosed Alphanumerics":it=>it>=9312&&it<=9471,"Geometric Shapes":it=>it>=9632&&it<=9727,"Miscellaneous Symbols":it=>it>=9728&&it<=9983,"Miscellaneous Symbols and Arrows":it=>it>=11008&&it<=11263,"Ideographic Description Characters":it=>it>=12272&&it<=12287,"CJK Symbols and Punctuation":it=>it>=12288&&it<=12351,Katakana:it=>it>=12448&&it<=12543,Kanbun:it=>it>=12688&&it<=12703,"CJK Strokes":it=>it>=12736&&it<=12783,"Enclosed CJK Letters and Months":it=>it>=12800&&it<=13055,"CJK Compatibility":it=>it>=13056&&it<=13311,"Yijing Hexagram Symbols":it=>it>=19904&&it<=19967,"Private Use Area":it=>it>=57344&&it<=63743,"Vertical Forms":it=>it>=65040&&it<=65055,"CJK Compatibility Forms":it=>it>=65072&&it<=65103,"Small Form Variants":it=>it>=65104&&it<=65135,"Halfwidth and Fullwidth Forms":it=>it>=65280&&it<=65519};function P_(it){for(const nt of it)if(M_(nt.charCodeAt(0)))return!0;return!1}function e0(it){for(const nt of it)if(!Qp(nt.charCodeAt(0)))return!1;return!0}function R_(it){const nt=it.map(st=>{try{return new RegExp(`\\p{sc=${st}}`,"u").source}catch{return null}}).filter(st=>st);return new RegExp(nt.join("|"),"u")}const t0=R_(["Arab","Dupl","Mong","Ougr","Syrc"]);function Qp(it){return!t0.test(String.fromCodePoint(it))}const hy=R_(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function M_(it){return!(it!==746&&it!==747&&(it<4352||!(yo["CJK Compatibility Forms"](it)&&!(it>=65097&&it<=65103)||yo["CJK Compatibility"](it)||yo["CJK Strokes"](it)||!(!yo["CJK Symbols and Punctuation"](it)||it>=12296&&it<=12305||it>=12308&&it<=12319||it===12336)||yo["Enclosed CJK Letters and Months"](it)||yo["Ideographic Description Characters"](it)||yo.Kanbun(it)||yo.Katakana(it)&&it!==12540||!(!yo["Halfwidth and Fullwidth Forms"](it)||it===65288||it===65289||it===65293||it>=65306&&it<=65310||it===65339||it===65341||it===65343||it>=65371&&it<=65503||it===65507||it>=65512&&it<=65519)||!(!yo["Small Form Variants"](it)||it>=65112&&it<=65118||it>=65123&&it<=65126)||yo["Vertical Forms"](it)||yo["Yijing Hexagram Symbols"](it)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(it))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(it))||hy.test(String.fromCodePoint(it)))))}function dy(it){return!(M_(it)||function(nt){return!!(yo["Latin-1 Supplement"](nt)&&(nt===167||nt===169||nt===174||nt===177||nt===188||nt===189||nt===190||nt===215||nt===247)||yo["General Punctuation"](nt)&&(nt===8214||nt===8224||nt===8225||nt===8240||nt===8241||nt===8251||nt===8252||nt===8258||nt===8263||nt===8264||nt===8265||nt===8273)||yo["Letterlike Symbols"](nt)||yo["Number Forms"](nt)||yo["Miscellaneous Technical"](nt)&&(nt>=8960&&nt<=8967||nt>=8972&&nt<=8991||nt>=8996&&nt<=9e3||nt===9003||nt>=9085&&nt<=9114||nt>=9150&&nt<=9165||nt===9167||nt>=9169&&nt<=9179||nt>=9186&&nt<=9215)||yo["Control Pictures"](nt)&&nt!==9251||yo["Optical Character Recognition"](nt)||yo["Enclosed Alphanumerics"](nt)||yo["Geometric Shapes"](nt)||yo["Miscellaneous Symbols"](nt)&&!(nt>=9754&&nt<=9759)||yo["Miscellaneous Symbols and Arrows"](nt)&&(nt>=11026&&nt<=11055||nt>=11088&&nt<=11097||nt>=11192&&nt<=11243)||yo["CJK Symbols and Punctuation"](nt)||yo.Katakana(nt)||yo["Private Use Area"](nt)||yo["CJK Compatibility Forms"](nt)||yo["Small Form Variants"](nt)||yo["Halfwidth and Fullwidth Forms"](nt)||nt===8734||nt===8756||nt===8757||nt>=9984&&nt<=10087||nt>=10102&&nt<=10131||nt===65532||nt===65533)}(it))}const n0=R_(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function I_(it){return n0.test(String.fromCodePoint(it))}function i0(it,nt){return!(!nt&&I_(it)||it>=2304&&it<=3583||it>=3840&&it<=4255||yo.Khmer(it))}function r0(it){for(const nt of it)if(I_(nt.charCodeAt(0)))return!0;return!1}const gu=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(it){this.pluginStatus=it.pluginStatus,this.pluginURL=it.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(it){this.applyArabicShaping=it.applyArabicShaping,this.processBidirectionalText=it.processBidirectionalText,this.processStyledBidirectionalText=it.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Vo{constructor(nt,st){this.zoom=nt,st?(this.now=st.now,this.fadeDuration=st.fadeDuration,this.zoomHistory=st.zoomHistory,this.transition=st.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new k_,this.transition={})}isSupportedScript(nt){return function(st,lt){for(const ft of st)if(!i0(ft.charCodeAt(0),lt))return!1;return!0}(nt,gu.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const nt=this.zoom,st=nt-Math.floor(nt),lt=this.crossFadingFactor();return nt>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:st+(1-st)*lt}:{fromScale:.5,toScale:1,t:1-(1-lt)*st}}}class _f{constructor(nt,st){this.property=nt,this.value=st,this.expression=function(lt,ft){if(qp(lt))return new Uu(lt,ft);if(Cp(lt)){const vt=kp(lt,ft);if(vt.result==="error")throw new Error(vt.value.map(xt=>`${xt.key}: ${xt.message}`).join(", "));return vt.value}{let vt=lt;return ft.type==="color"&&typeof lt=="string"?vt=oo.parse(lt):ft.type!=="padding"||typeof lt!="number"&&!Array.isArray(lt)?ft.type==="variableAnchorOffsetCollection"&&Array.isArray(lt)&&(vt=tu.parse(lt)):vt=Gl.parse(lt),{kind:"constant",evaluate:()=>vt}}}(st===void 0?nt.specification.default:st,nt.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(nt,st,lt){return this.property.possiblyEvaluate(this,nt,st,lt)}}class Bm{constructor(nt){this.property=nt,this.value=new _f(nt,void 0)}transitioned(nt,st){return new py(this.property,this.value,st,mn({},nt.transition,this.transition),nt.now)}untransitioned(){return new py(this.property,this.value,null,{},0)}}class jm{constructor(nt){this._properties=nt,this._values=Object.create(nt.defaultTransitionablePropertyValues)}getValue(nt){return fn(this._values[nt].value.value)}setValue(nt,st){Object.prototype.hasOwnProperty.call(this._values,nt)||(this._values[nt]=new Bm(this._values[nt].property)),this._values[nt].value=new _f(this._values[nt].property,st===null?void 0:fn(st))}getTransition(nt){return fn(this._values[nt].transition)}setTransition(nt,st){Object.prototype.hasOwnProperty.call(this._values,nt)||(this._values[nt]=new Bm(this._values[nt].property)),this._values[nt].transition=fn(st)||void 0}serialize(){const nt={};for(const st of Object.keys(this._values)){const lt=this.getValue(st);lt!==void 0&&(nt[st]=lt);const ft=this.getTransition(st);ft!==void 0&&(nt[`${st}-transition`]=ft)}return nt}transitioned(nt,st){const lt=new _m(this._properties);for(const ft of Object.keys(this._values))lt._values[ft]=this._values[ft].transitioned(nt,st._values[ft]);return lt}untransitioned(){const nt=new _m(this._properties);for(const st of Object.keys(this._values))nt._values[st]=this._values[st].untransitioned();return nt}}class py{constructor(nt,st,lt,ft,vt){this.property=nt,this.value=st,this.begin=vt+ft.delay||0,this.end=this.begin+ft.duration||0,nt.specification.transition&&(ft.delay||ft.duration)&&(this.prior=lt)}possiblyEvaluate(nt,st,lt){const ft=nt.now||0,vt=this.value.possiblyEvaluate(nt,st,lt),xt=this.prior;if(xt){if(ft>this.end)return this.prior=null,vt;if(this.value.isDataDriven())return this.prior=null,vt;if(ft<this.begin)return xt.possiblyEvaluate(nt,st,lt);{const bt=(ft-this.begin)/(this.end-this.begin);return this.property.interpolate(xt.possiblyEvaluate(nt,st,lt),vt,function(Et){if(Et<=0)return 0;if(Et>=1)return 1;const Ct=Et*Et,Dt=Ct*Et;return 4*(Et<.5?Dt:3*(Et-Ct)+Dt-.75)}(bt))}}return vt}}class _m{constructor(nt){this._properties=nt,this._values=Object.create(nt.defaultTransitioningPropertyValues)}possiblyEvaluate(nt,st,lt){const ft=new vm(this._properties);for(const vt of Object.keys(this._values))ft._values[vt]=this._values[vt].possiblyEvaluate(nt,st,lt);return ft}hasTransition(){for(const nt of Object.keys(this._values))if(this._values[nt].prior)return!0;return!1}}class ym{constructor(nt){this._properties=nt,this._values=Object.create(nt.defaultPropertyValues)}hasValue(nt){return this._values[nt].value!==void 0}getValue(nt){return fn(this._values[nt].value)}setValue(nt,st){this._values[nt]=new _f(this._values[nt].property,st===null?void 0:fn(st))}serialize(){const nt={};for(const st of Object.keys(this._values)){const lt=this.getValue(st);lt!==void 0&&(nt[st]=lt)}return nt}possiblyEvaluate(nt,st,lt){const ft=new vm(this._properties);for(const vt of Object.keys(this._values))ft._values[vt]=this._values[vt].possiblyEvaluate(nt,st,lt);return ft}}class Hu{constructor(nt,st,lt){this.property=nt,this.value=st,this.parameters=lt}isConstant(){return this.value.kind==="constant"}constantOr(nt){return this.value.kind==="constant"?this.value.value:nt}evaluate(nt,st,lt,ft){return this.property.evaluate(this.value,this.parameters,nt,st,lt,ft)}}class vm{constructor(nt){this._properties=nt,this._values=Object.create(nt.defaultPossiblyEvaluatedValues)}get(nt){return this._values[nt]}}class Ps{constructor(nt){this.specification=nt}possiblyEvaluate(nt,st){if(nt.isDataDriven())throw new Error("Value should not be data driven");return nt.expression.evaluate(st)}interpolate(nt,st,lt){const ft=Fl[this.specification.type];return ft?ft(nt,st,lt):nt}}class qs{constructor(nt,st){this.specification=nt,this.overrides=st}possiblyEvaluate(nt,st,lt,ft){return new Hu(this,nt.expression.kind==="constant"||nt.expression.kind==="camera"?{kind:"constant",value:nt.expression.evaluate(st,null,{},lt,ft)}:nt.expression,st)}interpolate(nt,st,lt){if(nt.value.kind!=="constant"||st.value.kind!=="constant")return nt;if(nt.value.value===void 0||st.value.value===void 0)return new Hu(this,{kind:"constant",value:void 0},nt.parameters);const ft=Fl[this.specification.type];if(ft){const vt=ft(nt.value.value,st.value.value,lt);return new Hu(this,{kind:"constant",value:vt},nt.parameters)}return nt}evaluate(nt,st,lt,ft,vt,xt){return nt.kind==="constant"?nt.value:nt.evaluate(st,lt,ft,vt,xt)}}class $m extends qs{possiblyEvaluate(nt,st,lt,ft){if(nt.value===void 0)return new Hu(this,{kind:"constant",value:void 0},st);if(nt.expression.kind==="constant"){const vt=nt.expression.evaluate(st,null,{},lt,ft),xt=nt.property.specification.type==="resolvedImage"&&typeof vt!="string"?vt.name:vt,bt=this._calculate(xt,xt,xt,st);return new Hu(this,{kind:"constant",value:bt},st)}if(nt.expression.kind==="camera"){const vt=this._calculate(nt.expression.evaluate({zoom:st.zoom-1}),nt.expression.evaluate({zoom:st.zoom}),nt.expression.evaluate({zoom:st.zoom+1}),st);return new Hu(this,{kind:"constant",value:vt},st)}return new Hu(this,nt.expression,st)}evaluate(nt,st,lt,ft,vt,xt){if(nt.kind==="source"){const bt=nt.evaluate(st,lt,ft,vt,xt);return this._calculate(bt,bt,bt,st)}return nt.kind==="composite"?this._calculate(nt.evaluate({zoom:Math.floor(st.zoom)-1},lt,ft),nt.evaluate({zoom:Math.floor(st.zoom)},lt,ft),nt.evaluate({zoom:Math.floor(st.zoom)+1},lt,ft),st):nt.value}_calculate(nt,st,lt,ft){return ft.zoom>ft.zoomHistory.lastIntegerZoom?{from:nt,to:st}:{from:lt,to:st}}interpolate(nt){return nt}}class Um{constructor(nt){this.specification=nt}possiblyEvaluate(nt,st,lt,ft){if(nt.value!==void 0){if(nt.expression.kind==="constant"){const vt=nt.expression.evaluate(st,null,{},lt,ft);return this._calculate(vt,vt,vt,st)}return this._calculate(nt.expression.evaluate(new Vo(Math.floor(st.zoom-1),st)),nt.expression.evaluate(new Vo(Math.floor(st.zoom),st)),nt.expression.evaluate(new Vo(Math.floor(st.zoom+1),st)),st)}}_calculate(nt,st,lt,ft){return ft.zoom>ft.zoomHistory.lastIntegerZoom?{from:nt,to:st}:{from:lt,to:st}}interpolate(nt){return nt}}class D_{constructor(nt){this.specification=nt}possiblyEvaluate(nt,st,lt,ft){return!!nt.expression.evaluate(st,null,{},lt,ft)}interpolate(){return!1}}class gt{constructor(nt){this.properties=nt,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const st in nt){const lt=nt[st];lt.specification.overridable&&this.overridableProperties.push(st);const ft=this.defaultPropertyValues[st]=new _f(lt,void 0),vt=this.defaultTransitionablePropertyValues[st]=new Bm(lt);this.defaultTransitioningPropertyValues[st]=vt.untransitioned(),this.defaultPossiblyEvaluatedValues[st]=ft.possiblyEvaluate({})}}}bs("DataDrivenProperty",qs),bs("DataConstantProperty",Ps),bs("CrossFadedDataDrivenProperty",$m),bs("CrossFadedProperty",Um),bs("ColorRampProperty",D_);const tt="-transition";class ot extends Rr{constructor(nt,st){if(super(),this.id=nt.id,this.type=nt.type,this._featureFilter={filter:()=>!0,needGeometry:!1},nt.type!=="custom"&&(this.metadata=nt.metadata,this.minzoom=nt.minzoom,this.maxzoom=nt.maxzoom,nt.type!=="background"&&(this.source=nt.source,this.sourceLayer=nt["source-layer"],this.filter=nt.filter),st.layout&&(this._unevaluatedLayout=new ym(st.layout)),st.paint)){this._transitionablePaint=new jm(st.paint);for(const lt in nt.paint)this.setPaintProperty(lt,nt.paint[lt],{validate:!1});for(const lt in nt.layout)this.setLayoutProperty(lt,nt.layout[lt],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vm(st.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(nt){return nt==="visibility"?this.visibility:this._unevaluatedLayout.getValue(nt)}setLayoutProperty(nt,st,lt={}){st!=null&&this._validate(cy,`layers.${this.id}.layout.${nt}`,nt,st,lt)||(nt!=="visibility"?this._unevaluatedLayout.setValue(nt,st):this.visibility=st)}getPaintProperty(nt){return nt.endsWith(tt)?this._transitionablePaint.getTransition(nt.slice(0,-11)):this._transitionablePaint.getValue(nt)}setPaintProperty(nt,st,lt={}){if(st!=null&&this._validate(ly,`layers.${this.id}.paint.${nt}`,nt,st,lt))return!1;if(nt.endsWith(tt))return this._transitionablePaint.setTransition(nt.slice(0,-11),st||void 0),!1;{const ft=this._transitionablePaint._values[nt],vt=ft.property.specification["property-type"]==="cross-faded-data-driven",xt=ft.value.isDataDriven(),bt=ft.value;this._transitionablePaint.setValue(nt,st),this._handleSpecialPaintPropertyUpdate(nt);const Et=this._transitionablePaint._values[nt].value;return Et.isDataDriven()||xt||vt||this._handleOverridablePaintPropertyUpdate(nt,bt,Et)}}_handleSpecialPaintPropertyUpdate(nt){}_handleOverridablePaintPropertyUpdate(nt,st,lt){return!1}isHidden(nt){return!!(this.minzoom&&nt<this.minzoom)||!!(this.maxzoom&&nt>=this.maxzoom)||this.visibility==="none"}updateTransitions(nt){this._transitioningPaint=this._transitionablePaint.transitioned(nt,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(nt,st){nt.getCrossfadeParameters&&(this._crossfadeParameters=nt.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(nt,void 0,st)),this.paint=this._transitioningPaint.possiblyEvaluate(nt,void 0,st)}serialize(){const nt={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(nt.layout=nt.layout||{},nt.layout.visibility=this.visibility),vn(nt,(st,lt)=>!(st===void 0||lt==="layout"&&!Object.keys(st).length||lt==="paint"&&!Object.keys(st).length))}_validate(nt,st,lt,ft,vt={}){return(!vt||vt.validate!==!1)&&T_(this,nt.call(Lp,{key:st,layerType:this.type,objectKey:lt,value:ft,styleSpec:On,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const nt in this.paint._values){const st=this.paint.get(nt);if(st instanceof Hu&&ap(st.property.specification)&&(st.value.kind==="source"||st.value.kind==="composite")&&st.value.isStateDependent)return!0}return!1}}const ht={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dt{constructor(nt,st){this._structArray=nt,this._pos1=st*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(nt,st){return nt._trim(),st&&(nt.isTransferred=!0,st.push(nt.arrayBuffer)),{length:nt.length,arrayBuffer:nt.arrayBuffer}}static deserialize(nt){const st=Object.create(this.prototype);return st.arrayBuffer=nt.arrayBuffer,st.length=nt.length,st.capacity=nt.arrayBuffer.byteLength/st.bytesPerElement,st._refreshViews(),st}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(nt){this.reserve(nt),this.length=nt}reserve(nt){if(nt>this.capacity){this.capacity=Math.max(nt,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const st=this.uint8;this._refreshViews(),st&&this.uint8.set(st)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function wt(it,nt=1){let st=0,lt=0;return{members:it.map(ft=>{const vt=ht[ft.type].BYTES_PER_ELEMENT,xt=st=St(st,Math.max(nt,vt)),bt=ft.components||1;return lt=Math.max(lt,vt),st+=vt*bt,{name:ft.name,type:ft.type,components:bt,offset:xt}}),size:St(st,Math.max(lt,nt)),alignment:nt}}function St(it,nt){return Math.ceil(it/nt)*nt}class Tt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(nt,st){const lt=this.length;return this.resize(lt+1),this.emplace(lt,nt,st)}emplace(nt,st,lt){const ft=2*nt;return this.int16[ft+0]=st,this.int16[ft+1]=lt,nt}}Tt.prototype.bytesPerElement=4,bs("StructArrayLayout2i4",Tt);class Ft extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(nt,st,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,nt,st,lt)}emplace(nt,st,lt,ft){const vt=3*nt;return this.int16[vt+0]=st,this.int16[vt+1]=lt,this.int16[vt+2]=ft,nt}}Ft.prototype.bytesPerElement=6,bs("StructArrayLayout3i6",Ft);class Gt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft){const vt=this.length;return this.resize(vt+1),this.emplace(vt,nt,st,lt,ft)}emplace(nt,st,lt,ft,vt){const xt=4*nt;return this.int16[xt+0]=st,this.int16[xt+1]=lt,this.int16[xt+2]=ft,this.int16[xt+3]=vt,nt}}Gt.prototype.bytesPerElement=8,bs("StructArrayLayout4i8",Gt);class Xt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt){const bt=this.length;return this.resize(bt+1),this.emplace(bt,nt,st,lt,ft,vt,xt)}emplace(nt,st,lt,ft,vt,xt,bt){const Et=6*nt;return this.int16[Et+0]=st,this.int16[Et+1]=lt,this.int16[Et+2]=ft,this.int16[Et+3]=vt,this.int16[Et+4]=xt,this.int16[Et+5]=bt,nt}}Xt.prototype.bytesPerElement=12,bs("StructArrayLayout2i4i12",Xt);class pn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt){const bt=this.length;return this.resize(bt+1),this.emplace(bt,nt,st,lt,ft,vt,xt)}emplace(nt,st,lt,ft,vt,xt,bt){const Et=4*nt,Ct=8*nt;return this.int16[Et+0]=st,this.int16[Et+1]=lt,this.uint8[Ct+4]=ft,this.uint8[Ct+5]=vt,this.uint8[Ct+6]=xt,this.uint8[Ct+7]=bt,nt}}pn.prototype.bytesPerElement=8,bs("StructArrayLayout2i4ub8",pn);class wn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(nt,st){const lt=this.length;return this.resize(lt+1),this.emplace(lt,nt,st)}emplace(nt,st,lt){const ft=2*nt;return this.float32[ft+0]=st,this.float32[ft+1]=lt,nt}}wn.prototype.bytesPerElement=8,bs("StructArrayLayout2f8",wn);class kn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt)}emplace(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt){const en=10*nt;return this.uint16[en+0]=st,this.uint16[en+1]=lt,this.uint16[en+2]=ft,this.uint16[en+3]=vt,this.uint16[en+4]=xt,this.uint16[en+5]=bt,this.uint16[en+6]=Et,this.uint16[en+7]=Ct,this.uint16[en+8]=Dt,this.uint16[en+9]=Vt,nt}}kn.prototype.bytesPerElement=20,bs("StructArrayLayout10ui20",kn);class Fn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en){const cn=this.length;return this.resize(cn+1),this.emplace(cn,nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en)}emplace(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn){const gn=12*nt;return this.int16[gn+0]=st,this.int16[gn+1]=lt,this.int16[gn+2]=ft,this.int16[gn+3]=vt,this.uint16[gn+4]=xt,this.uint16[gn+5]=bt,this.uint16[gn+6]=Et,this.uint16[gn+7]=Ct,this.int16[gn+8]=Dt,this.int16[gn+9]=Vt,this.int16[gn+10]=en,this.int16[gn+11]=cn,nt}}Fn.prototype.bytesPerElement=24,bs("StructArrayLayout4i4ui4i24",Fn);class Hn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(nt,st,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,nt,st,lt)}emplace(nt,st,lt,ft){const vt=3*nt;return this.float32[vt+0]=st,this.float32[vt+1]=lt,this.float32[vt+2]=ft,nt}}Hn.prototype.bytesPerElement=12,bs("StructArrayLayout3f12",Hn);class Gn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(nt){const st=this.length;return this.resize(st+1),this.emplace(st,nt)}emplace(nt,st){return this.uint32[1*nt+0]=st,nt}}Gn.prototype.bytesPerElement=4,bs("StructArrayLayout1ul4",Gn);class Qn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt,bt,Et,Ct){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,nt,st,lt,ft,vt,xt,bt,Et,Ct)}emplace(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt){const Vt=10*nt,en=5*nt;return this.int16[Vt+0]=st,this.int16[Vt+1]=lt,this.int16[Vt+2]=ft,this.int16[Vt+3]=vt,this.int16[Vt+4]=xt,this.int16[Vt+5]=bt,this.uint32[en+3]=Et,this.uint16[Vt+8]=Ct,this.uint16[Vt+9]=Dt,nt}}Qn.prototype.bytesPerElement=20,bs("StructArrayLayout6i1ul2ui20",Qn);class Dn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt){const bt=this.length;return this.resize(bt+1),this.emplace(bt,nt,st,lt,ft,vt,xt)}emplace(nt,st,lt,ft,vt,xt,bt){const Et=6*nt;return this.int16[Et+0]=st,this.int16[Et+1]=lt,this.int16[Et+2]=ft,this.int16[Et+3]=vt,this.int16[Et+4]=xt,this.int16[Et+5]=bt,nt}}Dn.prototype.bytesPerElement=12,bs("StructArrayLayout2i2i2i12",Dn);class ar extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt){const xt=this.length;return this.resize(xt+1),this.emplace(xt,nt,st,lt,ft,vt)}emplace(nt,st,lt,ft,vt,xt){const bt=4*nt,Et=8*nt;return this.float32[bt+0]=st,this.float32[bt+1]=lt,this.float32[bt+2]=ft,this.int16[Et+6]=vt,this.int16[Et+7]=xt,nt}}ar.prototype.bytesPerElement=16,bs("StructArrayLayout2f1f2i16",ar);class mr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt){const bt=this.length;return this.resize(bt+1),this.emplace(bt,nt,st,lt,ft,vt,xt)}emplace(nt,st,lt,ft,vt,xt,bt){const Et=16*nt,Ct=4*nt,Dt=8*nt;return this.uint8[Et+0]=st,this.uint8[Et+1]=lt,this.float32[Ct+1]=ft,this.float32[Ct+2]=vt,this.int16[Dt+6]=xt,this.int16[Dt+7]=bt,nt}}mr.prototype.bytesPerElement=16,bs("StructArrayLayout2ub2f2i16",mr);class Ar extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(nt,st,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,nt,st,lt)}emplace(nt,st,lt,ft){const vt=3*nt;return this.uint16[vt+0]=st,this.uint16[vt+1]=lt,this.uint16[vt+2]=ft,nt}}Ar.prototype.bytesPerElement=6,bs("StructArrayLayout3ui6",Ar);class Wr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn,bn,Ln,Vn){const vr=this.length;return this.resize(vr+1),this.emplace(vr,nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn,bn,Ln,Vn)}emplace(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn,bn,Ln,Vn,vr){const er=24*nt,_r=12*nt,Ir=48*nt;return this.int16[er+0]=st,this.int16[er+1]=lt,this.uint16[er+2]=ft,this.uint16[er+3]=vt,this.uint32[_r+2]=xt,this.uint32[_r+3]=bt,this.uint32[_r+4]=Et,this.uint16[er+10]=Ct,this.uint16[er+11]=Dt,this.uint16[er+12]=Vt,this.float32[_r+7]=en,this.float32[_r+8]=cn,this.uint8[Ir+36]=gn,this.uint8[Ir+37]=bn,this.uint8[Ir+38]=Ln,this.uint32[_r+10]=Vn,this.int16[er+22]=vr,nt}}Wr.prototype.bytesPerElement=48,bs("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Wr);class es extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn,bn,Ln,Vn,vr,er,_r,Ir,Yr,gs,Hs,hs,cs,Ls,As){const xs=this.length;return this.resize(xs+1),this.emplace(xs,nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn,bn,Ln,Vn,vr,er,_r,Ir,Yr,gs,Hs,hs,cs,Ls,As)}emplace(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn,bn,Ln,Vn,vr,er,_r,Ir,Yr,gs,Hs,hs,cs,Ls,As,xs){const Hr=32*nt,Os=16*nt;return this.int16[Hr+0]=st,this.int16[Hr+1]=lt,this.int16[Hr+2]=ft,this.int16[Hr+3]=vt,this.int16[Hr+4]=xt,this.int16[Hr+5]=bt,this.int16[Hr+6]=Et,this.int16[Hr+7]=Ct,this.uint16[Hr+8]=Dt,this.uint16[Hr+9]=Vt,this.uint16[Hr+10]=en,this.uint16[Hr+11]=cn,this.uint16[Hr+12]=gn,this.uint16[Hr+13]=bn,this.uint16[Hr+14]=Ln,this.uint16[Hr+15]=Vn,this.uint16[Hr+16]=vr,this.uint16[Hr+17]=er,this.uint16[Hr+18]=_r,this.uint16[Hr+19]=Ir,this.uint16[Hr+20]=Yr,this.uint16[Hr+21]=gs,this.uint16[Hr+22]=Hs,this.uint32[Os+12]=hs,this.float32[Os+13]=cs,this.float32[Os+14]=Ls,this.uint16[Hr+30]=As,this.uint16[Hr+31]=xs,nt}}es.prototype.bytesPerElement=64,bs("StructArrayLayout8i15ui1ul2f2ui64",es);class us extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(nt){const st=this.length;return this.resize(st+1),this.emplace(st,nt)}emplace(nt,st){return this.float32[1*nt+0]=st,nt}}us.prototype.bytesPerElement=4,bs("StructArrayLayout1f4",us);class ys extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(nt,st,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,nt,st,lt)}emplace(nt,st,lt,ft){const vt=3*nt;return this.uint16[6*nt+0]=st,this.float32[vt+1]=lt,this.float32[vt+2]=ft,nt}}ys.prototype.bytesPerElement=12,bs("StructArrayLayout1ui2f12",ys);class os extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(nt,st,lt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,nt,st,lt)}emplace(nt,st,lt,ft){const vt=4*nt;return this.uint32[2*nt+0]=st,this.uint16[vt+2]=lt,this.uint16[vt+3]=ft,nt}}os.prototype.bytesPerElement=8,bs("StructArrayLayout1ul2ui8",os);class rs extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(nt,st){const lt=this.length;return this.resize(lt+1),this.emplace(lt,nt,st)}emplace(nt,st,lt){const ft=2*nt;return this.uint16[ft+0]=st,this.uint16[ft+1]=lt,nt}}rs.prototype.bytesPerElement=4,bs("StructArrayLayout2ui4",rs);class Rs extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(nt){const st=this.length;return this.resize(st+1),this.emplace(st,nt)}emplace(nt,st){return this.uint16[1*nt+0]=st,nt}}Rs.prototype.bytesPerElement=2,bs("StructArrayLayout1ui2",Rs);class no extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(nt,st,lt,ft){const vt=this.length;return this.resize(vt+1),this.emplace(vt,nt,st,lt,ft)}emplace(nt,st,lt,ft,vt){const xt=4*nt;return this.float32[xt+0]=st,this.float32[xt+1]=lt,this.float32[xt+2]=ft,this.float32[xt+3]=vt,nt}}no.prototype.bytesPerElement=16,bs("StructArrayLayout4f16",no);class as extends dt{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Lt(this.anchorPointX,this.anchorPointY)}}as.prototype.size=20;class ms extends Qn{get(nt){return new as(this,nt)}}bs("CollisionBoxArray",ms);class Qs extends dt{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(nt){this._structArray.uint8[this._pos1+37]=nt}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(nt){this._structArray.uint8[this._pos1+38]=nt}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(nt){this._structArray.uint32[this._pos4+10]=nt}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Qs.prototype.size=48;class Ho extends Wr{get(nt){return new Qs(this,nt)}}bs("PlacedSymbolArray",Ho);class co extends dt{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(nt){this._structArray.uint32[this._pos4+12]=nt}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}co.prototype.size=64;class mo extends es{get(nt){return new co(this,nt)}}bs("SymbolInstanceArray",mo);class Wo extends us{getoffsetX(nt){return this.float32[1*nt+0]}}bs("GlyphOffsetArray",Wo);class Nl extends Ft{getx(nt){return this.int16[3*nt+0]}gety(nt){return this.int16[3*nt+1]}gettileUnitDistanceFromAnchor(nt){return this.int16[3*nt+2]}}bs("SymbolLineVertexArray",Nl);class Iu extends dt{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Iu.prototype.size=12;class qo extends ys{get(nt){return new Iu(this,nt)}}bs("TextAnchorOffsetArray",qo);class su extends dt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}su.prototype.size=8;class Yl extends os{get(nt){return new su(this,nt)}}bs("FeatureIndexArray",Yl);class Bl extends Tt{}class Jl extends Tt{}class Wu extends Tt{}class em extends Xt{}class Vm extends pn{}class tm extends wn{}class Su extends kn{}class Hm extends Fn{}class L_ extends Hn{}class Au extends Gn{}class Tu extends Dn{}class hp extends mr{}class Du extends Ar{}class Dl extends rs{}const $l=wt([{name:"a_pos",components:2,type:"Int16"}],4),{members:_u}=$l;class vo{constructor(nt=[]){this.segments=nt}prepareSegment(nt,st,lt,ft){let vt=this.segments[this.segments.length-1];return nt>vo.MAX_VERTEX_ARRAY_LENGTH&&Xn(`Max vertices per segment is ${vo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${nt}`),(!vt||vt.vertexLength+nt>vo.MAX_VERTEX_ARRAY_LENGTH||vt.sortKey!==ft)&&(vt={vertexOffset:st.length,primitiveOffset:lt.length,vertexLength:0,primitiveLength:0},ft!==void 0&&(vt.sortKey=ft),this.segments.push(vt)),vt}get(){return this.segments}destroy(){for(const nt of this.segments)for(const st in nt.vaos)nt.vaos[st].destroy()}static simpleSegment(nt,st,lt,ft){return new vo([{vertexOffset:nt,primitiveOffset:st,vertexLength:lt,primitiveLength:ft,vaos:{},sortKey:0}])}}function Fp(it,nt){return 256*(it=Ot(Math.floor(it),0,255))+Ot(Math.floor(nt),0,255)}vo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bs("SegmentVector",vo);const nm=wt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var im={exports:{}},fy={exports:{}};fy.exports=function(it,nt){var st,lt,ft,vt,xt,bt,Et,Ct;for(lt=it.length-(st=3&it.length),ft=nt,xt=3432918353,bt=461845907,Ct=0;Ct<lt;)Et=255&it.charCodeAt(Ct)|(255&it.charCodeAt(++Ct))<<8|(255&it.charCodeAt(++Ct))<<16|(255&it.charCodeAt(++Ct))<<24,++Ct,ft=27492+(65535&(vt=5*(65535&(ft=(ft^=Et=(65535&(Et=(Et=(65535&Et)*xt+(((Et>>>16)*xt&65535)<<16)&4294967295)<<15|Et>>>17))*bt+(((Et>>>16)*bt&65535)<<16)&4294967295)<<13|ft>>>19))+((5*(ft>>>16)&65535)<<16)&4294967295))+((58964+(vt>>>16)&65535)<<16);switch(Et=0,st){case 3:Et^=(255&it.charCodeAt(Ct+2))<<16;case 2:Et^=(255&it.charCodeAt(Ct+1))<<8;case 1:ft^=Et=(65535&(Et=(Et=(65535&(Et^=255&it.charCodeAt(Ct)))*xt+(((Et>>>16)*xt&65535)<<16)&4294967295)<<15|Et>>>17))*bt+(((Et>>>16)*bt&65535)<<16)&4294967295}return ft^=it.length,ft=2246822507*(65535&(ft^=ft>>>16))+((2246822507*(ft>>>16)&65535)<<16)&4294967295,ft=3266489909*(65535&(ft^=ft>>>13))+((3266489909*(ft>>>16)&65535)<<16)&4294967295,(ft^=ft>>>16)>>>0};var s0=fy.exports,my={exports:{}};my.exports=function(it,nt){for(var st,lt=it.length,ft=nt^lt,vt=0;lt>=4;)st=1540483477*(65535&(st=255&it.charCodeAt(vt)|(255&it.charCodeAt(++vt))<<8|(255&it.charCodeAt(++vt))<<16|(255&it.charCodeAt(++vt))<<24))+((1540483477*(st>>>16)&65535)<<16),ft=1540483477*(65535&ft)+((1540483477*(ft>>>16)&65535)<<16)^(st=1540483477*(65535&(st^=st>>>24))+((1540483477*(st>>>16)&65535)<<16)),lt-=4,++vt;switch(lt){case 3:ft^=(255&it.charCodeAt(vt+2))<<16;case 2:ft^=(255&it.charCodeAt(vt+1))<<8;case 1:ft=1540483477*(65535&(ft^=255&it.charCodeAt(vt)))+((1540483477*(ft>>>16)&65535)<<16)}return ft=1540483477*(65535&(ft^=ft>>>13))+((1540483477*(ft>>>16)&65535)<<16),(ft^=ft>>>15)>>>0};var dp=s0,gy=my.exports;im.exports=dp,im.exports.murmur3=dp,im.exports.murmur2=gy;var Wm=At(im.exports);class xm{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(nt,st,lt,ft){this.ids.push(qm(nt)),this.positions.push(st,lt,ft)}getPositions(nt){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const st=qm(nt);let lt=0,ft=this.ids.length-1;for(;lt<ft;){const xt=lt+ft>>1;this.ids[xt]>=st?ft=xt:lt=xt+1}const vt=[];for(;this.ids[lt]===st;)vt.push({index:this.positions[3*lt],start:this.positions[3*lt+1],end:this.positions[3*lt+2]}),lt++;return vt}static serialize(nt,st){const lt=new Float64Array(nt.ids),ft=new Uint32Array(nt.positions);return Gm(lt,ft,0,lt.length-1),st&&st.push(lt.buffer,ft.buffer),{ids:lt,positions:ft}}static deserialize(nt){const st=new xm;return st.ids=nt.ids,st.positions=nt.positions,st.indexed=!0,st}}function qm(it){const nt=+it;return!isNaN(nt)&&nt<=Number.MAX_SAFE_INTEGER?nt:Wm(String(it))}function Gm(it,nt,st,lt){for(;st<lt;){const ft=it[st+lt>>1];let vt=st-1,xt=lt+1;for(;;){do vt++;while(it[vt]<ft);do xt--;while(it[xt]>ft);if(vt>=xt)break;rm(it,vt,xt),rm(nt,3*vt,3*xt),rm(nt,3*vt+1,3*xt+1),rm(nt,3*vt+2,3*xt+2)}xt-st<lt-xt?(Gm(it,nt,st,xt),st=xt+1):(Gm(it,nt,xt+1,lt),lt=xt)}}function rm(it,nt,st){const lt=it[nt];it[nt]=it[st],it[st]=lt}bs("FeaturePositionMap",xm);class bm{constructor(nt,st){this.gl=nt.gl,this.location=st}}class _y extends bm{constructor(nt,st){super(nt,st),this.current=0}set(nt){this.current!==nt&&(this.current=nt,this.gl.uniform1f(this.location,nt))}}class Pv extends bm{constructor(nt,st){super(nt,st),this.current=[0,0,0,0]}set(nt){nt[0]===this.current[0]&&nt[1]===this.current[1]&&nt[2]===this.current[2]&&nt[3]===this.current[3]||(this.current=nt,this.gl.uniform4f(this.location,nt[0],nt[1],nt[2],nt[3]))}}class Rv extends bm{constructor(nt,st){super(nt,st),this.current=oo.transparent}set(nt){nt.r===this.current.r&&nt.g===this.current.g&&nt.b===this.current.b&&nt.a===this.current.a||(this.current=nt,this.gl.uniform4f(this.location,nt.r,nt.g,nt.b,nt.a))}}const q1=new Float32Array(16);function o0(it){return[Fp(255*it.r,255*it.g),Fp(255*it.b,255*it.a)]}class F_{constructor(nt,st,lt){this.value=nt,this.uniformNames=st.map(ft=>`u_${ft}`),this.type=lt}setUniform(nt,st,lt){nt.set(lt.constantOr(this.value))}getBinding(nt,st,lt){return this.type==="color"?new Rv(nt,st):new _y(nt,st)}}class Xm{constructor(nt,st){this.uniformNames=st.map(lt=>`u_${lt}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(nt,st){this.pixelRatioFrom=st.pixelRatio,this.pixelRatioTo=nt.pixelRatio,this.patternFrom=st.tlbr,this.patternTo=nt.tlbr}setUniform(nt,st,lt,ft){const vt=ft==="u_pattern_to"?this.patternTo:ft==="u_pattern_from"?this.patternFrom:ft==="u_pixel_ratio_to"?this.pixelRatioTo:ft==="u_pixel_ratio_from"?this.pixelRatioFrom:null;vt&&nt.set(vt)}getBinding(nt,st,lt){return lt.substr(0,9)==="u_pattern"?new Pv(nt,st):new _y(nt,st)}}class Op{constructor(nt,st,lt,ft){this.expression=nt,this.type=lt,this.maxValue=0,this.paintVertexAttributes=st.map(vt=>({name:`a_${vt}`,type:"Float32",components:lt==="color"?2:1,offset:0})),this.paintVertexArray=new ft}populatePaintArray(nt,st,lt,ft,vt){const xt=this.paintVertexArray.length,bt=this.expression.evaluate(new Vo(0),st,{},ft,[],vt);this.paintVertexArray.resize(nt),this._setPaintValue(xt,nt,bt)}updatePaintArray(nt,st,lt,ft){const vt=this.expression.evaluate({zoom:0},lt,ft);this._setPaintValue(nt,st,vt)}_setPaintValue(nt,st,lt){if(this.type==="color"){const ft=o0(lt);for(let vt=nt;vt<st;vt++)this.paintVertexArray.emplace(vt,ft[0],ft[1])}else{for(let ft=nt;ft<st;ft++)this.paintVertexArray.emplace(ft,lt);this.maxValue=Math.max(this.maxValue,Math.abs(lt))}}upload(nt){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=nt.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _d{constructor(nt,st,lt,ft,vt,xt){this.expression=nt,this.uniformNames=st.map(bt=>`u_${bt}_t`),this.type=lt,this.useIntegerZoom=ft,this.zoom=vt,this.maxValue=0,this.paintVertexAttributes=st.map(bt=>({name:`a_${bt}`,type:"Float32",components:lt==="color"?4:2,offset:0})),this.paintVertexArray=new xt}populatePaintArray(nt,st,lt,ft,vt){const xt=this.expression.evaluate(new Vo(this.zoom),st,{},ft,[],vt),bt=this.expression.evaluate(new Vo(this.zoom+1),st,{},ft,[],vt),Et=this.paintVertexArray.length;this.paintVertexArray.resize(nt),this._setPaintValue(Et,nt,xt,bt)}updatePaintArray(nt,st,lt,ft){const vt=this.expression.evaluate({zoom:this.zoom},lt,ft),xt=this.expression.evaluate({zoom:this.zoom+1},lt,ft);this._setPaintValue(nt,st,vt,xt)}_setPaintValue(nt,st,lt,ft){if(this.type==="color"){const vt=o0(lt),xt=o0(ft);for(let bt=nt;bt<st;bt++)this.paintVertexArray.emplace(bt,vt[0],vt[1],xt[0],xt[1])}else{for(let vt=nt;vt<st;vt++)this.paintVertexArray.emplace(vt,lt,ft);this.maxValue=Math.max(this.maxValue,Math.abs(lt),Math.abs(ft))}}upload(nt){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=nt.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(nt,st){const lt=this.useIntegerZoom?Math.floor(st.zoom):st.zoom,ft=Ot(this.expression.interpolationFactor(lt,this.zoom,this.zoom+1),0,1);nt.set(ft)}getBinding(nt,st,lt){return new _y(nt,st)}}class sm{constructor(nt,st,lt,ft,vt,xt){this.expression=nt,this.type=st,this.useIntegerZoom=lt,this.zoom=ft,this.layerId=xt,this.zoomInPaintVertexArray=new vt,this.zoomOutPaintVertexArray=new vt}populatePaintArray(nt,st,lt){const ft=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(nt),this.zoomOutPaintVertexArray.resize(nt),this._setPaintValues(ft,nt,st.patterns&&st.patterns[this.layerId],lt)}updatePaintArray(nt,st,lt,ft,vt){this._setPaintValues(nt,st,lt.patterns&&lt.patterns[this.layerId],vt)}_setPaintValues(nt,st,lt,ft){if(!ft||!lt)return;const{min:vt,mid:xt,max:bt}=lt,Et=ft[vt],Ct=ft[xt],Dt=ft[bt];if(Et&&Ct&&Dt)for(let Vt=nt;Vt<st;Vt++)this.zoomInPaintVertexArray.emplace(Vt,Ct.tl[0],Ct.tl[1],Ct.br[0],Ct.br[1],Et.tl[0],Et.tl[1],Et.br[0],Et.br[1],Ct.pixelRatio,Et.pixelRatio),this.zoomOutPaintVertexArray.emplace(Vt,Ct.tl[0],Ct.tl[1],Ct.br[0],Ct.br[1],Dt.tl[0],Dt.tl[1],Dt.br[0],Dt.br[1],Ct.pixelRatio,Dt.pixelRatio)}upload(nt){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=nt.createVertexBuffer(this.zoomInPaintVertexArray,nm.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=nt.createVertexBuffer(this.zoomOutPaintVertexArray,nm.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Mv{constructor(nt,st,lt){this.binders={},this._buffers=[];const ft=[];for(const vt in nt.paint._values){if(!lt(vt))continue;const xt=nt.paint.get(vt);if(!(xt instanceof Hu&&ap(xt.property.specification)))continue;const bt=G1(vt,nt.type),Et=xt.value,Ct=xt.property.specification.type,Dt=xt.property.useIntegerZoom,Vt=xt.property.specification["property-type"],en=Vt==="cross-faded"||Vt==="cross-faded-data-driven";if(Et.kind==="constant")this.binders[vt]=en?new Xm(Et.value,bt):new F_(Et.value,bt,Ct),ft.push(`/u_${vt}`);else if(Et.kind==="source"||en){const cn=Iv(vt,Ct,"source");this.binders[vt]=en?new sm(Et,Ct,Dt,st,cn,nt.id):new Op(Et,bt,Ct,cn),ft.push(`/a_${vt}`)}else{const cn=Iv(vt,Ct,"composite");this.binders[vt]=new _d(Et,bt,Ct,Dt,st,cn),ft.push(`/z_${vt}`)}}this.cacheKey=ft.sort().join("")}getMaxValue(nt){const st=this.binders[nt];return st instanceof Op||st instanceof _d?st.maxValue:0}populatePaintArrays(nt,st,lt,ft,vt){for(const xt in this.binders){const bt=this.binders[xt];(bt instanceof Op||bt instanceof _d||bt instanceof sm)&&bt.populatePaintArray(nt,st,lt,ft,vt)}}setConstantPatternPositions(nt,st){for(const lt in this.binders){const ft=this.binders[lt];ft instanceof Xm&&ft.setConstantPatternPositions(nt,st)}}updatePaintArrays(nt,st,lt,ft,vt){let xt=!1;for(const bt in nt){const Et=st.getPositions(bt);for(const Ct of Et){const Dt=lt.feature(Ct.index);for(const Vt in this.binders){const en=this.binders[Vt];if((en instanceof Op||en instanceof _d||en instanceof sm)&&en.expression.isStateDependent===!0){const cn=ft.paint.get(Vt);en.expression=cn.value,en.updatePaintArray(Ct.start,Ct.end,Dt,nt[bt],vt),xt=!0}}}}return xt}defines(){const nt=[];for(const st in this.binders){const lt=this.binders[st];(lt instanceof F_||lt instanceof Xm)&&nt.push(...lt.uniformNames.map(ft=>`#define HAS_UNIFORM_${ft}`))}return nt}getBinderAttributes(){const nt=[];for(const st in this.binders){const lt=this.binders[st];if(lt instanceof Op||lt instanceof _d)for(let ft=0;ft<lt.paintVertexAttributes.length;ft++)nt.push(lt.paintVertexAttributes[ft].name);else if(lt instanceof sm)for(let ft=0;ft<nm.members.length;ft++)nt.push(nm.members[ft].name)}return nt}getBinderUniforms(){const nt=[];for(const st in this.binders){const lt=this.binders[st];if(lt instanceof F_||lt instanceof Xm||lt instanceof _d)for(const ft of lt.uniformNames)nt.push(ft)}return nt}getPaintVertexBuffers(){return this._buffers}getUniforms(nt,st){const lt=[];for(const ft in this.binders){const vt=this.binders[ft];if(vt instanceof F_||vt instanceof Xm||vt instanceof _d){for(const xt of vt.uniformNames)if(st[xt]){const bt=vt.getBinding(nt,st[xt],xt);lt.push({name:xt,property:ft,binding:bt})}}}return lt}setUniforms(nt,st,lt,ft){for(const{name:vt,property:xt,binding:bt}of st)this.binders[xt].setUniform(bt,ft,lt.get(xt),vt)}updatePaintBuffers(nt){this._buffers=[];for(const st in this.binders){const lt=this.binders[st];if(nt&&lt instanceof sm){const ft=nt.fromScale===2?lt.zoomInPaintVertexBuffer:lt.zoomOutPaintVertexBuffer;ft&&this._buffers.push(ft)}else(lt instanceof Op||lt instanceof _d)&&lt.paintVertexBuffer&&this._buffers.push(lt.paintVertexBuffer)}}upload(nt){for(const st in this.binders){const lt=this.binders[st];(lt instanceof Op||lt instanceof _d||lt instanceof sm)&&lt.upload(nt)}this.updatePaintBuffers()}destroy(){for(const nt in this.binders){const st=this.binders[nt];(st instanceof Op||st instanceof _d||st instanceof sm)&&st.destroy()}}}class wm{constructor(nt,st,lt=()=>!0){this.programConfigurations={};for(const ft of nt)this.programConfigurations[ft.id]=new Mv(ft,st,lt);this.needsUpload=!1,this._featureMap=new xm,this._bufferOffset=0}populatePaintArrays(nt,st,lt,ft,vt,xt){for(const bt in this.programConfigurations)this.programConfigurations[bt].populatePaintArrays(nt,st,ft,vt,xt);st.id!==void 0&&this._featureMap.add(st.id,lt,this._bufferOffset,nt),this._bufferOffset=nt,this.needsUpload=!0}updatePaintArrays(nt,st,lt,ft){for(const vt of lt)this.needsUpload=this.programConfigurations[vt.id].updatePaintArrays(nt,this._featureMap,st,vt,ft)||this.needsUpload}get(nt){return this.programConfigurations[nt]}upload(nt){if(this.needsUpload){for(const st in this.programConfigurations)this.programConfigurations[st].upload(nt);this.needsUpload=!1}}destroy(){for(const nt in this.programConfigurations)this.programConfigurations[nt].destroy()}}function G1(it,nt){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[it]||[it.replace(`${nt}-`,"").replace(/-/g,"_")]}function Iv(it,nt,st){const lt={color:{source:wn,composite:no},number:{source:us,composite:wn}},ft=function(vt){return{"line-pattern":{source:Su,composite:Su},"fill-pattern":{source:Su,composite:Su},"fill-extrusion-pattern":{source:Su,composite:Su}}[vt]}(it);return ft&&ft[st]||lt[nt][st]}bs("ConstantBinder",F_),bs("CrossFadedConstantBinder",Xm),bs("SourceExpressionBinder",Op),bs("CrossFadedCompositeBinder",sm),bs("CompositeExpressionBinder",_d),bs("ProgramConfiguration",Mv,{omit:["_buffers"]}),bs("ProgramConfigurationSet",wm);const ba=8192,a0=Math.pow(2,14)-1,Dv=-a0-1;function Em(it){const nt=ba/it.extent,st=it.loadGeometry();for(let lt=0;lt<st.length;lt++){const ft=st[lt];for(let vt=0;vt<ft.length;vt++){const xt=ft[vt],bt=Math.round(xt.x*nt),Et=Math.round(xt.y*nt);xt.x=Ot(bt,Dv,a0),xt.y=Ot(Et,Dv,a0),(bt<xt.x||bt>xt.x+1||Et<xt.y||Et>xt.y+1)&&Xn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return st}function Sm(it,nt){return{type:it.type,id:it.id,properties:it.properties,geometry:nt?Em(it):[]}}function yy(it,nt,st,lt,ft){it.emplaceBack(2*nt+(lt+1)/2,2*st+(ft+1)/2)}class l0{constructor(nt){this.zoom=nt.zoom,this.overscaling=nt.overscaling,this.layers=nt.layers,this.layerIds=this.layers.map(st=>st.id),this.index=nt.index,this.hasPattern=!1,this.layoutVertexArray=new Jl,this.indexArray=new Du,this.segments=new vo,this.programConfigurations=new wm(nt.layers,nt.zoom),this.stateDependentLayerIds=this.layers.filter(st=>st.isStateDependent()).map(st=>st.id)}populate(nt,st,lt){const ft=this.layers[0],vt=[];let xt=null,bt=!1;ft.type==="circle"&&(xt=ft.layout.get("circle-sort-key"),bt=!xt.isConstant());for(const{feature:Et,id:Ct,index:Dt,sourceLayerIndex:Vt}of nt){const en=this.layers[0]._featureFilter.needGeometry,cn=Sm(Et,en);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),cn,lt))continue;const gn=bt?xt.evaluate(cn,{},lt):void 0,bn={id:Ct,properties:Et.properties,type:Et.type,sourceLayerIndex:Vt,index:Dt,geometry:en?cn.geometry:Em(Et),patterns:{},sortKey:gn};vt.push(bn)}bt&&vt.sort((Et,Ct)=>Et.sortKey-Ct.sortKey);for(const Et of vt){const{geometry:Ct,index:Dt,sourceLayerIndex:Vt}=Et,en=nt[Dt].feature;this.addFeature(Et,Ct,Dt,lt),st.featureIndex.insert(en,Ct,Dt,Vt,this.index)}}update(nt,st,lt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(nt,st,this.stateDependentLayers,lt)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(nt){this.uploaded||(this.layoutVertexBuffer=nt.createVertexBuffer(this.layoutVertexArray,_u),this.indexBuffer=nt.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(nt),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(nt,st,lt,ft){for(const vt of st)for(const xt of vt){const bt=xt.x,Et=xt.y;if(bt<0||bt>=ba||Et<0||Et>=ba)continue;const Ct=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,nt.sortKey),Dt=Ct.vertexLength;yy(this.layoutVertexArray,bt,Et,-1,-1),yy(this.layoutVertexArray,bt,Et,1,-1),yy(this.layoutVertexArray,bt,Et,1,1),yy(this.layoutVertexArray,bt,Et,-1,1),this.indexArray.emplaceBack(Dt,Dt+1,Dt+2),this.indexArray.emplaceBack(Dt,Dt+3,Dt+2),Ct.vertexLength+=4,Ct.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,nt,lt,{},ft)}}function Lv(it,nt){for(let st=0;st<it.length;st++)if(Zm(nt,it[st]))return!0;for(let st=0;st<nt.length;st++)if(Zm(it,nt[st]))return!0;return!!c0(it,nt)}function X1(it,nt,st){return!!Zm(it,nt)||!!u0(nt,it,st)}function Fv(it,nt){if(it.length===1)return zv(nt,it[0]);for(let st=0;st<nt.length;st++){const lt=nt[st];for(let ft=0;ft<lt.length;ft++)if(Zm(it,lt[ft]))return!0}for(let st=0;st<it.length;st++)if(zv(nt,it[st]))return!0;for(let st=0;st<nt.length;st++)if(c0(it,nt[st]))return!0;return!1}function Z1(it,nt,st){if(it.length>1){if(c0(it,nt))return!0;for(let lt=0;lt<nt.length;lt++)if(u0(nt[lt],it,st))return!0}for(let lt=0;lt<it.length;lt++)if(u0(it[lt],nt,st))return!0;return!1}function c0(it,nt){if(it.length===0||nt.length===0)return!1;for(let st=0;st<it.length-1;st++){const lt=it[st],ft=it[st+1];for(let vt=0;vt<nt.length-1;vt++)if(K1(lt,ft,nt[vt],nt[vt+1]))return!0}return!1}function K1(it,nt,st,lt){return Sn(it,st,lt)!==Sn(nt,st,lt)&&Sn(it,nt,st)!==Sn(it,nt,lt)}function u0(it,nt,st){const lt=st*st;if(nt.length===1)return it.distSqr(nt[0])<lt;for(let ft=1;ft<nt.length;ft++)if(Ov(it,nt[ft-1],nt[ft])<lt)return!0;return!1}function Ov(it,nt,st){const lt=nt.distSqr(st);if(lt===0)return it.distSqr(nt);const ft=((it.x-nt.x)*(st.x-nt.x)+(it.y-nt.y)*(st.y-nt.y))/lt;return it.distSqr(ft<0?nt:ft>1?st:st.sub(nt)._mult(ft)._add(nt))}function zv(it,nt){let st,lt,ft,vt=!1;for(let xt=0;xt<it.length;xt++){st=it[xt];for(let bt=0,Et=st.length-1;bt<st.length;Et=bt++)lt=st[bt],ft=st[Et],lt.y>nt.y!=ft.y>nt.y&&nt.x<(ft.x-lt.x)*(nt.y-lt.y)/(ft.y-lt.y)+lt.x&&(vt=!vt)}return vt}function Zm(it,nt){let st=!1;for(let lt=0,ft=it.length-1;lt<it.length;ft=lt++){const vt=it[lt],xt=it[ft];vt.y>nt.y!=xt.y>nt.y&&nt.x<(xt.x-vt.x)*(nt.y-vt.y)/(xt.y-vt.y)+vt.x&&(st=!st)}return st}function Y1(it,nt,st){const lt=st[0],ft=st[2];if(it.x<lt.x&&nt.x<lt.x||it.x>ft.x&&nt.x>ft.x||it.y<lt.y&&nt.y<lt.y||it.y>ft.y&&nt.y>ft.y)return!1;const vt=Sn(it,nt,st[0]);return vt!==Sn(it,nt,st[1])||vt!==Sn(it,nt,st[2])||vt!==Sn(it,nt,st[3])}function O_(it,nt,st){const lt=nt.paint.get(it).value;return lt.kind==="constant"?lt.value:st.programConfigurations.get(nt.id).getMaxValue(it)}function vy(it){return Math.sqrt(it[0]*it[0]+it[1]*it[1])}function xy(it,nt,st,lt,ft){if(!nt[0]&&!nt[1])return it;const vt=Lt.convert(nt)._mult(ft);st==="viewport"&&vt._rotate(-lt);const xt=[];for(let bt=0;bt<it.length;bt++)xt.push(it[bt].sub(vt));return xt}let Nv,Bv;bs("CircleBucket",l0,{omit:["layers"]});var J1={get paint(){return Bv=Bv||new gt({"circle-radius":new qs(On.paint_circle["circle-radius"]),"circle-color":new qs(On.paint_circle["circle-color"]),"circle-blur":new qs(On.paint_circle["circle-blur"]),"circle-opacity":new qs(On.paint_circle["circle-opacity"]),"circle-translate":new Ps(On.paint_circle["circle-translate"]),"circle-translate-anchor":new Ps(On.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ps(On.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ps(On.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qs(On.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qs(On.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qs(On.paint_circle["circle-stroke-opacity"])})},get layout(){return Nv=Nv||new gt({"circle-sort-key":new qs(On.layout_circle["circle-sort-key"])})}},ou=1e-6,Km=typeof Float32Array<"u"?Float32Array:Array;function h0(it){return it[0]=1,it[1]=0,it[2]=0,it[3]=0,it[4]=0,it[5]=1,it[6]=0,it[7]=0,it[8]=0,it[9]=0,it[10]=1,it[11]=0,it[12]=0,it[13]=0,it[14]=0,it[15]=1,it}function jv(it,nt,st){var lt=nt[0],ft=nt[1],vt=nt[2],xt=nt[3],bt=nt[4],Et=nt[5],Ct=nt[6],Dt=nt[7],Vt=nt[8],en=nt[9],cn=nt[10],gn=nt[11],bn=nt[12],Ln=nt[13],Vn=nt[14],vr=nt[15],er=st[0],_r=st[1],Ir=st[2],Yr=st[3];return it[0]=er*lt+_r*bt+Ir*Vt+Yr*bn,it[1]=er*ft+_r*Et+Ir*en+Yr*Ln,it[2]=er*vt+_r*Ct+Ir*cn+Yr*Vn,it[3]=er*xt+_r*Dt+Ir*gn+Yr*vr,it[4]=(er=st[4])*lt+(_r=st[5])*bt+(Ir=st[6])*Vt+(Yr=st[7])*bn,it[5]=er*ft+_r*Et+Ir*en+Yr*Ln,it[6]=er*vt+_r*Ct+Ir*cn+Yr*Vn,it[7]=er*xt+_r*Dt+Ir*gn+Yr*vr,it[8]=(er=st[8])*lt+(_r=st[9])*bt+(Ir=st[10])*Vt+(Yr=st[11])*bn,it[9]=er*ft+_r*Et+Ir*en+Yr*Ln,it[10]=er*vt+_r*Ct+Ir*cn+Yr*Vn,it[11]=er*xt+_r*Dt+Ir*gn+Yr*vr,it[12]=(er=st[12])*lt+(_r=st[13])*bt+(Ir=st[14])*Vt+(Yr=st[15])*bn,it[13]=er*ft+_r*Et+Ir*en+Yr*Ln,it[14]=er*vt+_r*Ct+Ir*cn+Yr*Vn,it[15]=er*xt+_r*Dt+Ir*gn+Yr*vr,it}Math.hypot||(Math.hypot=function(){for(var it=0,nt=arguments.length;nt--;)it+=arguments[nt]*arguments[nt];return Math.sqrt(it)});var z_,Q1=jv;function by(it,nt,st){var lt=nt[0],ft=nt[1],vt=nt[2],xt=nt[3];return it[0]=st[0]*lt+st[4]*ft+st[8]*vt+st[12]*xt,it[1]=st[1]*lt+st[5]*ft+st[9]*vt+st[13]*xt,it[2]=st[2]*lt+st[6]*ft+st[10]*vt+st[14]*xt,it[3]=st[3]*lt+st[7]*ft+st[11]*vt+st[15]*xt,it}z_=new Km(4),Km!=Float32Array&&(z_[0]=0,z_[1]=0,z_[2]=0,z_[3]=0);class ew extends ot{constructor(nt){super(nt,J1)}createBucket(nt){return new l0(nt)}queryRadius(nt){const st=nt;return O_("circle-radius",this,st)+O_("circle-stroke-width",this,st)+vy(this.paint.get("circle-translate"))}queryIntersectsFeature(nt,st,lt,ft,vt,xt,bt,Et){const Ct=xy(nt,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),xt.angle,bt),Dt=this.paint.get("circle-radius").evaluate(st,lt)+this.paint.get("circle-stroke-width").evaluate(st,lt),Vt=this.paint.get("circle-pitch-alignment")==="map",en=Vt?Ct:function(gn,bn){return gn.map(Ln=>$v(Ln,bn))}(Ct,Et),cn=Vt?Dt*bt:Dt;for(const gn of ft)for(const bn of gn){const Ln=Vt?bn:$v(bn,Et);let Vn=cn;const vr=by([],[bn.x,bn.y,0,1],Et);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Vn*=vr[3]/xt.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Vn*=xt.cameraToCenterDistance/vr[3]),X1(en,Ln,Vn))return!0}return!1}}function $v(it,nt){const st=by([],[it.x,it.y,0,1],nt);return new Lt(st[0]/st[3],st[1]/st[3])}class Uv extends l0{}let Vv;bs("HeatmapBucket",Uv,{omit:["layers"]});var tw={get paint(){return Vv=Vv||new gt({"heatmap-radius":new qs(On.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qs(On.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ps(On.paint_heatmap["heatmap-intensity"]),"heatmap-color":new D_(On.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ps(On.paint_heatmap["heatmap-opacity"])})}};function d0(it,{width:nt,height:st},lt,ft){if(ft){if(ft instanceof Uint8ClampedArray)ft=new Uint8Array(ft.buffer);else if(ft.length!==nt*st*lt)throw new RangeError(`mismatched image size. expected: ${ft.length} but got: ${nt*st*lt}`)}else ft=new Uint8Array(nt*st*lt);return it.width=nt,it.height=st,it.data=ft,it}function Hv(it,{width:nt,height:st},lt){if(nt===it.width&&st===it.height)return;const ft=d0({},{width:nt,height:st},lt);p0(it,ft,{x:0,y:0},{x:0,y:0},{width:Math.min(it.width,nt),height:Math.min(it.height,st)},lt),it.width=nt,it.height=st,it.data=ft.data}function p0(it,nt,st,lt,ft,vt){if(ft.width===0||ft.height===0)return nt;if(ft.width>it.width||ft.height>it.height||st.x>it.width-ft.width||st.y>it.height-ft.height)throw new RangeError("out of range source coordinates for image copy");if(ft.width>nt.width||ft.height>nt.height||lt.x>nt.width-ft.width||lt.y>nt.height-ft.height)throw new RangeError("out of range destination coordinates for image copy");const xt=it.data,bt=nt.data;if(xt===bt)throw new Error("srcData equals dstData, so image is already copied");for(let Et=0;Et<ft.height;Et++){const Ct=((st.y+Et)*it.width+st.x)*vt,Dt=((lt.y+Et)*nt.width+lt.x)*vt;for(let Vt=0;Vt<ft.width*vt;Vt++)bt[Dt+Vt]=xt[Ct+Vt]}return nt}class N_{constructor(nt,st){d0(this,nt,1,st)}resize(nt){Hv(this,nt,1)}clone(){return new N_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(nt,st,lt,ft,vt){p0(nt,st,lt,ft,vt,1)}}class Lu{constructor(nt,st){d0(this,nt,4,st)}resize(nt){Hv(this,nt,4)}replace(nt,st){st?this.data.set(nt):this.data=nt instanceof Uint8ClampedArray?new Uint8Array(nt.buffer):nt}clone(){return new Lu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(nt,st,lt,ft,vt){p0(nt,st,lt,ft,vt,4)}}function Wv(it){const nt={},st=it.resolution||256,lt=it.clips?it.clips.length:1,ft=it.image||new Lu({width:st,height:lt});if(Math.log(st)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${st}`);const vt=(xt,bt,Et)=>{nt[it.evaluationKey]=Et;const Ct=it.expression.evaluate(nt);ft.data[xt+bt+0]=Math.floor(255*Ct.r/Ct.a),ft.data[xt+bt+1]=Math.floor(255*Ct.g/Ct.a),ft.data[xt+bt+2]=Math.floor(255*Ct.b/Ct.a),ft.data[xt+bt+3]=Math.floor(255*Ct.a)};if(it.clips)for(let xt=0,bt=0;xt<lt;++xt,bt+=4*st)for(let Et=0,Ct=0;Et<st;Et++,Ct+=4){const Dt=Et/(st-1),{start:Vt,end:en}=it.clips[xt];vt(bt,Ct,Vt*(1-Dt)+en*Dt)}else for(let xt=0,bt=0;xt<st;xt++,bt+=4)vt(0,bt,xt/(st-1));return ft}bs("AlphaImage",N_),bs("RGBAImage",Lu);const f0="big-fb";class nw extends ot{createBucket(nt){return new Uv(nt)}constructor(nt){super(nt,tw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(nt){nt==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(f0)&&this.heatmapFbos.delete(f0)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let qv;var iw={get paint(){return qv=qv||new gt({"hillshade-illumination-direction":new Ps(On.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ps(On.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ps(On.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ps(On.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ps(On.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ps(On.paint_hillshade["hillshade-accent-color"])})}};class rw extends ot{constructor(nt){super(nt,iw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const sw=wt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ow}=sw;function Gv(it,nt,st=2){const lt=nt&&nt.length,ft=lt?nt[0]*st:it.length;let vt=Xv(it,0,ft,st,!0);const xt=[];if(!vt||vt.next===vt.prev)return xt;let bt,Et,Ct;if(lt&&(vt=function(Dt,Vt,en,cn){const gn=[];for(let bn=0,Ln=Vt.length;bn<Ln;bn++){const Vn=Xv(Dt,Vt[bn]*cn,bn<Ln-1?Vt[bn+1]*cn:Dt.length,cn,!1);Vn===Vn.next&&(Vn.steiner=!0),gn.push(fw(Vn))}gn.sort(hw);for(let bn=0;bn<gn.length;bn++)en=dw(gn[bn],en);return en}(it,nt,vt,st)),it.length>80*st){bt=1/0,Et=1/0;let Dt=-1/0,Vt=-1/0;for(let en=st;en<ft;en+=st){const cn=it[en],gn=it[en+1];cn<bt&&(bt=cn),gn<Et&&(Et=gn),cn>Dt&&(Dt=cn),gn>Vt&&(Vt=gn)}Ct=Math.max(Dt-bt,Vt-Et),Ct=Ct!==0?32767/Ct:0}return B_(vt,xt,st,bt,Et,Ct,0),xt}function Xv(it,nt,st,lt,ft){let vt;if(ft===function(xt,bt,Et,Ct){let Dt=0;for(let Vt=bt,en=Et-Ct;Vt<Et;Vt+=Ct)Dt+=(xt[en]-xt[Vt])*(xt[Vt+1]+xt[en+1]),en=Vt;return Dt}(it,nt,st,lt)>0)for(let xt=nt;xt<st;xt+=lt)vt=Yv(xt/lt|0,it[xt],it[xt+1],vt);else for(let xt=st-lt;xt>=nt;xt-=lt)vt=Yv(xt/lt|0,it[xt],it[xt+1],vt);return vt&&wy(vt,vt.next)&&($_(vt),vt=vt.next),vt}function Am(it,nt){if(!it)return it;nt||(nt=it);let st,lt=it;do if(st=!1,lt.steiner||!wy(lt,lt.next)&&xa(lt.prev,lt,lt.next)!==0)lt=lt.next;else{if($_(lt),lt=nt=lt.prev,lt===lt.next)break;st=!0}while(st||lt!==nt);return nt}function B_(it,nt,st,lt,ft,vt,xt){if(!it)return;!xt&&vt&&function(Et,Ct,Dt,Vt){let en=Et;do en.z===0&&(en.z=m0(en.x,en.y,Ct,Dt,Vt)),en.prevZ=en.prev,en.nextZ=en.next,en=en.next;while(en!==Et);en.prevZ.nextZ=null,en.prevZ=null,function(cn){let gn,bn=1;do{let Ln,Vn=cn;cn=null;let vr=null;for(gn=0;Vn;){gn++;let er=Vn,_r=0;for(let Yr=0;Yr<bn&&(_r++,er=er.nextZ,er);Yr++);let Ir=bn;for(;_r>0||Ir>0&&er;)_r!==0&&(Ir===0||!er||Vn.z<=er.z)?(Ln=Vn,Vn=Vn.nextZ,_r--):(Ln=er,er=er.nextZ,Ir--),vr?vr.nextZ=Ln:cn=Ln,Ln.prevZ=vr,vr=Ln;Vn=er}vr.nextZ=null,bn*=2}while(gn>1)}(en)}(it,lt,ft,vt);let bt=it;for(;it.prev!==it.next;){const Et=it.prev,Ct=it.next;if(vt?lw(it,lt,ft,vt):aw(it))nt.push(Et.i,it.i,Ct.i),$_(it),it=Ct.next,bt=Ct.next;else if((it=Ct)===bt){xt?xt===1?B_(it=cw(Am(it),nt),nt,st,lt,ft,vt,2):xt===2&&uw(it,nt,st,lt,ft,vt):B_(Am(it),nt,st,lt,ft,vt,1);break}}}function aw(it){const nt=it.prev,st=it,lt=it.next;if(xa(nt,st,lt)>=0)return!1;const ft=nt.x,vt=st.x,xt=lt.x,bt=nt.y,Et=st.y,Ct=lt.y,Dt=ft<vt?ft<xt?ft:xt:vt<xt?vt:xt,Vt=bt<Et?bt<Ct?bt:Ct:Et<Ct?Et:Ct,en=ft>vt?ft>xt?ft:xt:vt>xt?vt:xt,cn=bt>Et?bt>Ct?bt:Ct:Et>Ct?Et:Ct;let gn=lt.next;for(;gn!==nt;){if(gn.x>=Dt&&gn.x<=en&&gn.y>=Vt&&gn.y<=cn&&Ym(ft,bt,vt,Et,xt,Ct,gn.x,gn.y)&&xa(gn.prev,gn,gn.next)>=0)return!1;gn=gn.next}return!0}function lw(it,nt,st,lt){const ft=it.prev,vt=it,xt=it.next;if(xa(ft,vt,xt)>=0)return!1;const bt=ft.x,Et=vt.x,Ct=xt.x,Dt=ft.y,Vt=vt.y,en=xt.y,cn=bt<Et?bt<Ct?bt:Ct:Et<Ct?Et:Ct,gn=Dt<Vt?Dt<en?Dt:en:Vt<en?Vt:en,bn=bt>Et?bt>Ct?bt:Ct:Et>Ct?Et:Ct,Ln=Dt>Vt?Dt>en?Dt:en:Vt>en?Vt:en,Vn=m0(cn,gn,nt,st,lt),vr=m0(bn,Ln,nt,st,lt);let er=it.prevZ,_r=it.nextZ;for(;er&&er.z>=Vn&&_r&&_r.z<=vr;){if(er.x>=cn&&er.x<=bn&&er.y>=gn&&er.y<=Ln&&er!==ft&&er!==xt&&Ym(bt,Dt,Et,Vt,Ct,en,er.x,er.y)&&xa(er.prev,er,er.next)>=0||(er=er.prevZ,_r.x>=cn&&_r.x<=bn&&_r.y>=gn&&_r.y<=Ln&&_r!==ft&&_r!==xt&&Ym(bt,Dt,Et,Vt,Ct,en,_r.x,_r.y)&&xa(_r.prev,_r,_r.next)>=0))return!1;_r=_r.nextZ}for(;er&&er.z>=Vn;){if(er.x>=cn&&er.x<=bn&&er.y>=gn&&er.y<=Ln&&er!==ft&&er!==xt&&Ym(bt,Dt,Et,Vt,Ct,en,er.x,er.y)&&xa(er.prev,er,er.next)>=0)return!1;er=er.prevZ}for(;_r&&_r.z<=vr;){if(_r.x>=cn&&_r.x<=bn&&_r.y>=gn&&_r.y<=Ln&&_r!==ft&&_r!==xt&&Ym(bt,Dt,Et,Vt,Ct,en,_r.x,_r.y)&&xa(_r.prev,_r,_r.next)>=0)return!1;_r=_r.nextZ}return!0}function cw(it,nt){let st=it;do{const lt=st.prev,ft=st.next.next;!wy(lt,ft)&&Zv(lt,st,st.next,ft)&&j_(lt,ft)&&j_(ft,lt)&&(nt.push(lt.i,st.i,ft.i),$_(st),$_(st.next),st=it=ft),st=st.next}while(st!==it);return Am(st)}function uw(it,nt,st,lt,ft,vt){let xt=it;do{let bt=xt.next.next;for(;bt!==xt.prev;){if(xt.i!==bt.i&&mw(xt,bt)){let Et=Kv(xt,bt);return xt=Am(xt,xt.next),Et=Am(Et,Et.next),B_(xt,nt,st,lt,ft,vt,0),void B_(Et,nt,st,lt,ft,vt,0)}bt=bt.next}xt=xt.next}while(xt!==it)}function hw(it,nt){return it.x-nt.x}function dw(it,nt){const st=function(ft,vt){let xt=vt;const bt=ft.x,Et=ft.y;let Ct,Dt=-1/0;do{if(Et<=xt.y&&Et>=xt.next.y&&xt.next.y!==xt.y){const bn=xt.x+(Et-xt.y)*(xt.next.x-xt.x)/(xt.next.y-xt.y);if(bn<=bt&&bn>Dt&&(Dt=bn,Ct=xt.x<xt.next.x?xt:xt.next,bn===bt))return Ct}xt=xt.next}while(xt!==vt);if(!Ct)return null;const Vt=Ct,en=Ct.x,cn=Ct.y;let gn=1/0;xt=Ct;do{if(bt>=xt.x&&xt.x>=en&&bt!==xt.x&&Ym(Et<cn?bt:Dt,Et,en,cn,Et<cn?Dt:bt,Et,xt.x,xt.y)){const bn=Math.abs(Et-xt.y)/(bt-xt.x);j_(xt,ft)&&(bn<gn||bn===gn&&(xt.x>Ct.x||xt.x===Ct.x&&pw(Ct,xt)))&&(Ct=xt,gn=bn)}xt=xt.next}while(xt!==Vt);return Ct}(it,nt);if(!st)return nt;const lt=Kv(st,it);return Am(lt,lt.next),Am(st,st.next)}function pw(it,nt){return xa(it.prev,it,nt.prev)<0&&xa(nt.next,it,it.next)<0}function m0(it,nt,st,lt,ft){return(it=1431655765&((it=858993459&((it=252645135&((it=16711935&((it=(it-st)*ft|0)|it<<8))|it<<4))|it<<2))|it<<1))|(nt=1431655765&((nt=858993459&((nt=252645135&((nt=16711935&((nt=(nt-lt)*ft|0)|nt<<8))|nt<<4))|nt<<2))|nt<<1))<<1}function fw(it){let nt=it,st=it;do(nt.x<st.x||nt.x===st.x&&nt.y<st.y)&&(st=nt),nt=nt.next;while(nt!==it);return st}function Ym(it,nt,st,lt,ft,vt,xt,bt){return(ft-xt)*(nt-bt)>=(it-xt)*(vt-bt)&&(it-xt)*(lt-bt)>=(st-xt)*(nt-bt)&&(st-xt)*(vt-bt)>=(ft-xt)*(lt-bt)}function mw(it,nt){return it.next.i!==nt.i&&it.prev.i!==nt.i&&!function(st,lt){let ft=st;do{if(ft.i!==st.i&&ft.next.i!==st.i&&ft.i!==lt.i&&ft.next.i!==lt.i&&Zv(ft,ft.next,st,lt))return!0;ft=ft.next}while(ft!==st);return!1}(it,nt)&&(j_(it,nt)&&j_(nt,it)&&function(st,lt){let ft=st,vt=!1;const xt=(st.x+lt.x)/2,bt=(st.y+lt.y)/2;do ft.y>bt!=ft.next.y>bt&&ft.next.y!==ft.y&&xt<(ft.next.x-ft.x)*(bt-ft.y)/(ft.next.y-ft.y)+ft.x&&(vt=!vt),ft=ft.next;while(ft!==st);return vt}(it,nt)&&(xa(it.prev,it,nt.prev)||xa(it,nt.prev,nt))||wy(it,nt)&&xa(it.prev,it,it.next)>0&&xa(nt.prev,nt,nt.next)>0)}function xa(it,nt,st){return(nt.y-it.y)*(st.x-nt.x)-(nt.x-it.x)*(st.y-nt.y)}function wy(it,nt){return it.x===nt.x&&it.y===nt.y}function Zv(it,nt,st,lt){const ft=Sy(xa(it,nt,st)),vt=Sy(xa(it,nt,lt)),xt=Sy(xa(st,lt,it)),bt=Sy(xa(st,lt,nt));return ft!==vt&&xt!==bt||!(ft!==0||!Ey(it,st,nt))||!(vt!==0||!Ey(it,lt,nt))||!(xt!==0||!Ey(st,it,lt))||!(bt!==0||!Ey(st,nt,lt))}function Ey(it,nt,st){return nt.x<=Math.max(it.x,st.x)&&nt.x>=Math.min(it.x,st.x)&&nt.y<=Math.max(it.y,st.y)&&nt.y>=Math.min(it.y,st.y)}function Sy(it){return it>0?1:it<0?-1:0}function j_(it,nt){return xa(it.prev,it,it.next)<0?xa(it,nt,it.next)>=0&&xa(it,it.prev,nt)>=0:xa(it,nt,it.prev)<0||xa(it,it.next,nt)<0}function Kv(it,nt){const st=g0(it.i,it.x,it.y),lt=g0(nt.i,nt.x,nt.y),ft=it.next,vt=nt.prev;return it.next=nt,nt.prev=it,st.next=ft,ft.prev=st,lt.next=st,st.prev=lt,vt.next=lt,lt.prev=vt,lt}function Yv(it,nt,st,lt){const ft=g0(it,nt,st);return lt?(ft.next=lt.next,ft.prev=lt,lt.next.prev=ft,lt.next=ft):(ft.prev=ft,ft.next=ft),ft}function $_(it){it.next.prev=it.prev,it.prev.next=it.next,it.prevZ&&(it.prevZ.nextZ=it.nextZ),it.nextZ&&(it.nextZ.prevZ=it.prevZ)}function g0(it,nt,st){return{i:it,x:nt,y:st,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function _0(it,nt,st){const lt=st.patternDependencies;let ft=!1;for(const vt of nt){const xt=vt.paint.get(`${it}-pattern`);xt.isConstant()||(ft=!0);const bt=xt.constantOr(null);bt&&(ft=!0,lt[bt.to]=!0,lt[bt.from]=!0)}return ft}function y0(it,nt,st,lt,ft){const vt=ft.patternDependencies;for(const xt of nt){const bt=xt.paint.get(`${it}-pattern`).value;if(bt.kind!=="constant"){let Et=bt.evaluate({zoom:lt-1},st,{},ft.availableImages),Ct=bt.evaluate({zoom:lt},st,{},ft.availableImages),Dt=bt.evaluate({zoom:lt+1},st,{},ft.availableImages);Et=Et&&Et.name?Et.name:Et,Ct=Ct&&Ct.name?Ct.name:Ct,Dt=Dt&&Dt.name?Dt.name:Dt,vt[Et]=!0,vt[Ct]=!0,vt[Dt]=!0,st.patterns[xt.id]={min:Et,mid:Ct,max:Dt}}}return st}class v0{constructor(nt){this.zoom=nt.zoom,this.overscaling=nt.overscaling,this.layers=nt.layers,this.layerIds=this.layers.map(st=>st.id),this.index=nt.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wu,this.indexArray=new Du,this.indexArray2=new Dl,this.programConfigurations=new wm(nt.layers,nt.zoom),this.segments=new vo,this.segments2=new vo,this.stateDependentLayerIds=this.layers.filter(st=>st.isStateDependent()).map(st=>st.id)}populate(nt,st,lt){this.hasPattern=_0("fill",this.layers,st);const ft=this.layers[0].layout.get("fill-sort-key"),vt=!ft.isConstant(),xt=[];for(const{feature:bt,id:Et,index:Ct,sourceLayerIndex:Dt}of nt){const Vt=this.layers[0]._featureFilter.needGeometry,en=Sm(bt,Vt);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),en,lt))continue;const cn=vt?ft.evaluate(en,{},lt,st.availableImages):void 0,gn={id:Et,properties:bt.properties,type:bt.type,sourceLayerIndex:Dt,index:Ct,geometry:Vt?en.geometry:Em(bt),patterns:{},sortKey:cn};xt.push(gn)}vt&&xt.sort((bt,Et)=>bt.sortKey-Et.sortKey);for(const bt of xt){const{geometry:Et,index:Ct,sourceLayerIndex:Dt}=bt;if(this.hasPattern){const Vt=y0("fill",this.layers,bt,this.zoom,st);this.patternFeatures.push(Vt)}else this.addFeature(bt,Et,Ct,lt,{});st.featureIndex.insert(nt[Ct].feature,Et,Ct,Dt,this.index)}}update(nt,st,lt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(nt,st,this.stateDependentLayers,lt)}addFeatures(nt,st,lt){for(const ft of this.patternFeatures)this.addFeature(ft,ft.geometry,ft.index,st,lt)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(nt){this.uploaded||(this.layoutVertexBuffer=nt.createVertexBuffer(this.layoutVertexArray,ow),this.indexBuffer=nt.createIndexBuffer(this.indexArray),this.indexBuffer2=nt.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(nt),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(nt,st,lt,ft,vt){for(const xt of Fo(st,500)){let bt=0;for(const cn of xt)bt+=cn.length;const Et=this.segments.prepareSegment(bt,this.layoutVertexArray,this.indexArray),Ct=Et.vertexLength,Dt=[],Vt=[];for(const cn of xt){if(cn.length===0)continue;cn!==xt[0]&&Vt.push(Dt.length/2);const gn=this.segments2.prepareSegment(cn.length,this.layoutVertexArray,this.indexArray2),bn=gn.vertexLength;this.layoutVertexArray.emplaceBack(cn[0].x,cn[0].y),this.indexArray2.emplaceBack(bn+cn.length-1,bn),Dt.push(cn[0].x),Dt.push(cn[0].y);for(let Ln=1;Ln<cn.length;Ln++)this.layoutVertexArray.emplaceBack(cn[Ln].x,cn[Ln].y),this.indexArray2.emplaceBack(bn+Ln-1,bn+Ln),Dt.push(cn[Ln].x),Dt.push(cn[Ln].y);gn.vertexLength+=cn.length,gn.primitiveLength+=cn.length}const en=Gv(Dt,Vt);for(let cn=0;cn<en.length;cn+=3)this.indexArray.emplaceBack(Ct+en[cn],Ct+en[cn+1],Ct+en[cn+2]);Et.vertexLength+=bt,Et.primitiveLength+=en.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,nt,lt,vt,ft)}}let Jv,Qv;bs("FillBucket",v0,{omit:["layers","patternFeatures"]});var gw={get paint(){return Qv=Qv||new gt({"fill-antialias":new Ps(On.paint_fill["fill-antialias"]),"fill-opacity":new qs(On.paint_fill["fill-opacity"]),"fill-color":new qs(On.paint_fill["fill-color"]),"fill-outline-color":new qs(On.paint_fill["fill-outline-color"]),"fill-translate":new Ps(On.paint_fill["fill-translate"]),"fill-translate-anchor":new Ps(On.paint_fill["fill-translate-anchor"]),"fill-pattern":new $m(On.paint_fill["fill-pattern"])})},get layout(){return Jv=Jv||new gt({"fill-sort-key":new qs(On.layout_fill["fill-sort-key"])})}};class _w extends ot{constructor(nt){super(nt,gw)}recalculate(nt,st){super.recalculate(nt,st);const lt=this.paint._values["fill-outline-color"];lt.value.kind==="constant"&&lt.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(nt){return new v0(nt)}queryRadius(){return vy(this.paint.get("fill-translate"))}queryIntersectsFeature(nt,st,lt,ft,vt,xt,bt){return Fv(xy(nt,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),xt.angle,bt),ft)}isTileClipped(){return!0}}const yw=wt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),vw=wt([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xw}=yw;var om={},bw=Pt,ex=Jm;function Jm(it,nt,st,lt,ft){this.properties={},this.extent=st,this.type=0,this._pbf=it,this._geometry=-1,this._keys=lt,this._values=ft,it.readFields(ww,this,nt)}function ww(it,nt,st){it==1?nt.id=st.readVarint():it==2?function(lt,ft){for(var vt=lt.readVarint()+lt.pos;lt.pos<vt;){var xt=ft._keys[lt.readVarint()],bt=ft._values[lt.readVarint()];ft.properties[xt]=bt}}(st,nt):it==3?nt.type=st.readVarint():it==4&&(nt._geometry=st.pos)}function Ew(it){for(var nt,st,lt=0,ft=0,vt=it.length,xt=vt-1;ft<vt;xt=ft++)lt+=((st=it[xt]).x-(nt=it[ft]).x)*(nt.y+st.y);return lt}Jm.types=["Unknown","Point","LineString","Polygon"],Jm.prototype.loadGeometry=function(){var it=this._pbf;it.pos=this._geometry;for(var nt,st=it.readVarint()+it.pos,lt=1,ft=0,vt=0,xt=0,bt=[];it.pos<st;){if(ft<=0){var Et=it.readVarint();lt=7&Et,ft=Et>>3}if(ft--,lt===1||lt===2)vt+=it.readSVarint(),xt+=it.readSVarint(),lt===1&&(nt&&bt.push(nt),nt=[]),nt.push(new bw(vt,xt));else{if(lt!==7)throw new Error("unknown command "+lt);nt&&nt.push(nt[0].clone())}}return nt&&bt.push(nt),bt},Jm.prototype.bbox=function(){var it=this._pbf;it.pos=this._geometry;for(var nt=it.readVarint()+it.pos,st=1,lt=0,ft=0,vt=0,xt=1/0,bt=-1/0,Et=1/0,Ct=-1/0;it.pos<nt;){if(lt<=0){var Dt=it.readVarint();st=7&Dt,lt=Dt>>3}if(lt--,st===1||st===2)(ft+=it.readSVarint())<xt&&(xt=ft),ft>bt&&(bt=ft),(vt+=it.readSVarint())<Et&&(Et=vt),vt>Ct&&(Ct=vt);else if(st!==7)throw new Error("unknown command "+st)}return[xt,Et,bt,Ct]},Jm.prototype.toGeoJSON=function(it,nt,st){var lt,ft,vt=this.extent*Math.pow(2,st),xt=this.extent*it,bt=this.extent*nt,Et=this.loadGeometry(),Ct=Jm.types[this.type];function Dt(cn){for(var gn=0;gn<cn.length;gn++){var bn=cn[gn];cn[gn]=[360*(bn.x+xt)/vt-180,360/Math.PI*Math.atan(Math.exp((180-360*(bn.y+bt)/vt)*Math.PI/180))-90]}}switch(this.type){case 1:var Vt=[];for(lt=0;lt<Et.length;lt++)Vt[lt]=Et[lt][0];Dt(Et=Vt);break;case 2:for(lt=0;lt<Et.length;lt++)Dt(Et[lt]);break;case 3:for(Et=function(cn){var gn=cn.length;if(gn<=1)return[cn];for(var bn,Ln,Vn=[],vr=0;vr<gn;vr++){var er=Ew(cn[vr]);er!==0&&(Ln===void 0&&(Ln=er<0),Ln===er<0?(bn&&Vn.push(bn),bn=[cn[vr]]):bn.push(cn[vr]))}return bn&&Vn.push(bn),Vn}(Et),lt=0;lt<Et.length;lt++)for(ft=0;ft<Et[lt].length;ft++)Dt(Et[lt][ft])}Et.length===1?Et=Et[0]:Ct="Multi"+Ct;var en={type:"Feature",geometry:{type:Ct,coordinates:Et},properties:this.properties};return"id"in this&&(en.id=this.id),en};var Sw=ex,tx=nx;function nx(it,nt){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=it,this._keys=[],this._values=[],this._features=[],it.readFields(Aw,this,nt),this.length=this._features.length}function Aw(it,nt,st){it===15?nt.version=st.readVarint():it===1?nt.name=st.readString():it===5?nt.extent=st.readVarint():it===2?nt._features.push(st.pos):it===3?nt._keys.push(st.readString()):it===4&&nt._values.push(function(lt){for(var ft=null,vt=lt.readVarint()+lt.pos;lt.pos<vt;){var xt=lt.readVarint()>>3;ft=xt===1?lt.readString():xt===2?lt.readFloat():xt===3?lt.readDouble():xt===4?lt.readVarint64():xt===5?lt.readVarint():xt===6?lt.readSVarint():xt===7?lt.readBoolean():null}return ft}(st))}nx.prototype.feature=function(it){if(it<0||it>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[it];var nt=this._pbf.readVarint()+this._pbf.pos;return new Sw(this._pbf,nt,this.extent,this._keys,this._values)};var Tw=tx;function Cw(it,nt,st){if(it===3){var lt=new Tw(st,st.readVarint()+st.pos);lt.length&&(nt[lt.name]=lt)}}om.VectorTile=function(it,nt){this.layers=it.readFields(Cw,{},nt)},om.VectorTileFeature=ex,om.VectorTileLayer=tx;const kw=om.VectorTileFeature.types,x0=Math.pow(2,13);function U_(it,nt,st,lt,ft,vt,xt,bt){it.emplaceBack(nt,st,2*Math.floor(lt*x0)+xt,ft*x0*2,vt*x0*2,Math.round(bt))}class b0{constructor(nt){this.zoom=nt.zoom,this.overscaling=nt.overscaling,this.layers=nt.layers,this.layerIds=this.layers.map(st=>st.id),this.index=nt.index,this.hasPattern=!1,this.layoutVertexArray=new em,this.centroidVertexArray=new Bl,this.indexArray=new Du,this.programConfigurations=new wm(nt.layers,nt.zoom),this.segments=new vo,this.stateDependentLayerIds=this.layers.filter(st=>st.isStateDependent()).map(st=>st.id)}populate(nt,st,lt){this.features=[],this.hasPattern=_0("fill-extrusion",this.layers,st);for(const{feature:ft,id:vt,index:xt,sourceLayerIndex:bt}of nt){const Et=this.layers[0]._featureFilter.needGeometry,Ct=Sm(ft,Et);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),Ct,lt))continue;const Dt={id:vt,sourceLayerIndex:bt,index:xt,geometry:Et?Ct.geometry:Em(ft),properties:ft.properties,type:ft.type,patterns:{}};this.hasPattern?this.features.push(y0("fill-extrusion",this.layers,Dt,this.zoom,st)):this.addFeature(Dt,Dt.geometry,xt,lt,{}),st.featureIndex.insert(ft,Dt.geometry,xt,bt,this.index,!0)}}addFeatures(nt,st,lt){for(const ft of this.features){const{geometry:vt}=ft;this.addFeature(ft,vt,ft.index,st,lt)}}update(nt,st,lt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(nt,st,this.stateDependentLayers,lt)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(nt){this.uploaded||(this.layoutVertexBuffer=nt.createVertexBuffer(this.layoutVertexArray,xw),this.centroidVertexBuffer=nt.createVertexBuffer(this.centroidVertexArray,vw.members,!0),this.indexBuffer=nt.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(nt),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(nt,st,lt,ft,vt){for(const xt of Fo(st,500)){const bt={x:0,y:0,vertexCount:0};let Et=0;for(const gn of xt)Et+=gn.length;let Ct=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const gn of xt){if(gn.length===0||Rw(gn))continue;let bn=0;for(let Ln=0;Ln<gn.length;Ln++){const Vn=gn[Ln];if(Ln>=1){const vr=gn[Ln-1];if(!Pw(Vn,vr)){Ct.vertexLength+4>vo.MAX_VERTEX_ARRAY_LENGTH&&(Ct=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const er=Vn.sub(vr)._perp()._unit(),_r=vr.dist(Vn);bn+_r>32768&&(bn=0),U_(this.layoutVertexArray,Vn.x,Vn.y,er.x,er.y,0,0,bn),U_(this.layoutVertexArray,Vn.x,Vn.y,er.x,er.y,0,1,bn),bt.x+=2*Vn.x,bt.y+=2*Vn.y,bt.vertexCount+=2,bn+=_r,U_(this.layoutVertexArray,vr.x,vr.y,er.x,er.y,0,0,bn),U_(this.layoutVertexArray,vr.x,vr.y,er.x,er.y,0,1,bn),bt.x+=2*vr.x,bt.y+=2*vr.y,bt.vertexCount+=2;const Ir=Ct.vertexLength;this.indexArray.emplaceBack(Ir,Ir+2,Ir+1),this.indexArray.emplaceBack(Ir+1,Ir+2,Ir+3),Ct.vertexLength+=4,Ct.primitiveLength+=2}}}}if(Ct.vertexLength+Et>vo.MAX_VERTEX_ARRAY_LENGTH&&(Ct=this.segments.prepareSegment(Et,this.layoutVertexArray,this.indexArray)),kw[nt.type]!=="Polygon")continue;const Dt=[],Vt=[],en=Ct.vertexLength;for(const gn of xt)if(gn.length!==0){gn!==xt[0]&&Vt.push(Dt.length/2);for(let bn=0;bn<gn.length;bn++){const Ln=gn[bn];U_(this.layoutVertexArray,Ln.x,Ln.y,0,0,1,1,0),bt.x+=Ln.x,bt.y+=Ln.y,bt.vertexCount+=1,Dt.push(Ln.x),Dt.push(Ln.y)}}const cn=Gv(Dt,Vt);for(let gn=0;gn<cn.length;gn+=3)this.indexArray.emplaceBack(en+cn[gn],en+cn[gn+2],en+cn[gn+1]);Ct.primitiveLength+=cn.length/3,Ct.vertexLength+=Et;for(let gn=0;gn<bt.vertexCount;gn++){const bn=Math.floor(bt.x/bt.vertexCount),Ln=Math.floor(bt.y/bt.vertexCount);this.centroidVertexArray.emplaceBack(bn,Ln)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,nt,lt,vt,ft)}}function Pw(it,nt){return it.x===nt.x&&(it.x<0||it.x>ba)||it.y===nt.y&&(it.y<0||it.y>ba)}function Rw(it){return it.every(nt=>nt.x<0)||it.every(nt=>nt.x>ba)||it.every(nt=>nt.y<0)||it.every(nt=>nt.y>ba)}let ix;bs("FillExtrusionBucket",b0,{omit:["layers","features"]});var Mw={get paint(){return ix=ix||new gt({"fill-extrusion-opacity":new Ps(On["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qs(On["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ps(On["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ps(On["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $m(On["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qs(On["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qs(On["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ps(On["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Iw extends ot{constructor(nt){super(nt,Mw)}createBucket(nt){return new b0(nt)}queryRadius(){return vy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(nt,st,lt,ft,vt,xt,bt,Et){const Ct=xy(nt,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),xt.angle,bt),Dt=this.paint.get("fill-extrusion-height").evaluate(st,lt),Vt=this.paint.get("fill-extrusion-base").evaluate(st,lt),en=function(gn,bn,Ln,Vn){const vr=[];for(const er of gn){const _r=[er.x,er.y,0,1];by(_r,_r,bn),vr.push(new Lt(_r[0]/_r[3],_r[1]/_r[3]))}return vr}(Ct,Et),cn=function(gn,bn,Ln,Vn){const vr=[],er=[],_r=Vn[8]*bn,Ir=Vn[9]*bn,Yr=Vn[10]*bn,gs=Vn[11]*bn,Hs=Vn[8]*Ln,hs=Vn[9]*Ln,cs=Vn[10]*Ln,Ls=Vn[11]*Ln;for(const As of gn){const xs=[],Hr=[];for(const Os of As){const Ds=Os.x,eo=Os.y,No=Vn[0]*Ds+Vn[4]*eo+Vn[12],zo=Vn[1]*Ds+Vn[5]*eo+Vn[13],Sl=Vn[2]*Ds+Vn[6]*eo+Vn[14],qu=Vn[3]*Ds+Vn[7]*eo+Vn[15],Vl=Sl+Yr,Al=qu+gs,au=No+Hs,lu=zo+hs,cu=Sl+cs,ga=qu+Ls,Tl=new Lt((No+_r)/Al,(zo+Ir)/Al);Tl.z=Vl/Al,xs.push(Tl);const Ql=new Lt(au/ga,lu/ga);Ql.z=cu/ga,Hr.push(Ql)}vr.push(xs),er.push(Hr)}return[vr,er]}(ft,Vt,Dt,Et);return function(gn,bn,Ln){let Vn=1/0;Fv(Ln,bn)&&(Vn=rx(Ln,bn[0]));for(let vr=0;vr<bn.length;vr++){const er=bn[vr],_r=gn[vr];for(let Ir=0;Ir<er.length-1;Ir++){const Yr=er[Ir],gs=[Yr,er[Ir+1],_r[Ir+1],_r[Ir],Yr];Lv(Ln,gs)&&(Vn=Math.min(Vn,rx(Ln,gs)))}}return Vn!==1/0&&Vn}(cn[0],cn[1],en)}}function V_(it,nt){return it.x*nt.x+it.y*nt.y}function rx(it,nt){if(it.length===1){let st=0;const lt=nt[st++];let ft;for(;!ft||lt.equals(ft);)if(ft=nt[st++],!ft)return 1/0;for(;st<nt.length;st++){const vt=nt[st],xt=it[0],bt=ft.sub(lt),Et=vt.sub(lt),Ct=xt.sub(lt),Dt=V_(bt,bt),Vt=V_(bt,Et),en=V_(Et,Et),cn=V_(Ct,bt),gn=V_(Ct,Et),bn=Dt*en-Vt*Vt,Ln=(en*cn-Vt*gn)/bn,Vn=(Dt*gn-Vt*cn)/bn,vr=lt.z*(1-Ln-Vn)+ft.z*Ln+vt.z*Vn;if(isFinite(vr))return vr}return 1/0}{let st=1/0;for(const lt of nt)st=Math.min(st,lt.z);return st}}const Dw=wt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Lw}=Dw,Fw=wt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ow}=Fw,zw=om.VectorTileFeature.types,Nw=Math.cos(Math.PI/180*37.5),sx=Math.pow(2,14)/.5;class w0{constructor(nt){this.zoom=nt.zoom,this.overscaling=nt.overscaling,this.layers=nt.layers,this.layerIds=this.layers.map(st=>st.id),this.index=nt.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(st=>{this.gradients[st.id]={}}),this.layoutVertexArray=new Vm,this.layoutVertexArray2=new tm,this.indexArray=new Du,this.programConfigurations=new wm(nt.layers,nt.zoom),this.segments=new vo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(st=>st.isStateDependent()).map(st=>st.id)}populate(nt,st,lt){this.hasPattern=_0("line",this.layers,st);const ft=this.layers[0].layout.get("line-sort-key"),vt=!ft.isConstant(),xt=[];for(const{feature:bt,id:Et,index:Ct,sourceLayerIndex:Dt}of nt){const Vt=this.layers[0]._featureFilter.needGeometry,en=Sm(bt,Vt);if(!this.layers[0]._featureFilter.filter(new Vo(this.zoom),en,lt))continue;const cn=vt?ft.evaluate(en,{},lt):void 0,gn={id:Et,properties:bt.properties,type:bt.type,sourceLayerIndex:Dt,index:Ct,geometry:Vt?en.geometry:Em(bt),patterns:{},sortKey:cn};xt.push(gn)}vt&&xt.sort((bt,Et)=>bt.sortKey-Et.sortKey);for(const bt of xt){const{geometry:Et,index:Ct,sourceLayerIndex:Dt}=bt;if(this.hasPattern){const Vt=y0("line",this.layers,bt,this.zoom,st);this.patternFeatures.push(Vt)}else this.addFeature(bt,Et,Ct,lt,{});st.featureIndex.insert(nt[Ct].feature,Et,Ct,Dt,this.index)}}update(nt,st,lt){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(nt,st,this.stateDependentLayers,lt)}addFeatures(nt,st,lt){for(const ft of this.patternFeatures)this.addFeature(ft,ft.geometry,ft.index,st,lt)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(nt){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=nt.createVertexBuffer(this.layoutVertexArray2,Ow)),this.layoutVertexBuffer=nt.createVertexBuffer(this.layoutVertexArray,Lw),this.indexBuffer=nt.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(nt),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(nt){if(nt.properties&&Object.prototype.hasOwnProperty.call(nt.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(nt.properties,"mapbox_clip_end"))return{start:+nt.properties.mapbox_clip_start,end:+nt.properties.mapbox_clip_end}}addFeature(nt,st,lt,ft,vt){const xt=this.layers[0].layout,bt=xt.get("line-join").evaluate(nt,{}),Et=xt.get("line-cap"),Ct=xt.get("line-miter-limit"),Dt=xt.get("line-round-limit");this.lineClips=this.lineFeatureClips(nt);for(const Vt of st)this.addLine(Vt,nt,bt,Et,Ct,Dt);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,nt,lt,vt,ft)}addLine(nt,st,lt,ft,vt,xt){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Vn=0;Vn<nt.length-1;Vn++)this.totalDistance+=nt[Vn].dist(nt[Vn+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const bt=zw[st.type]==="Polygon";let Et=nt.length;for(;Et>=2&&nt[Et-1].equals(nt[Et-2]);)Et--;let Ct=0;for(;Ct<Et-1&&nt[Ct].equals(nt[Ct+1]);)Ct++;if(Et<(bt?3:2))return;lt==="bevel"&&(vt=1.05);const Dt=this.overscaling<=16?15*ba/(512*this.overscaling):0,Vt=this.segments.prepareSegment(10*Et,this.layoutVertexArray,this.indexArray);let en,cn,gn,bn,Ln;this.e1=this.e2=-1,bt&&(en=nt[Et-2],Ln=nt[Ct].sub(en)._unit()._perp());for(let Vn=Ct;Vn<Et;Vn++){if(gn=Vn===Et-1?bt?nt[Ct+1]:void 0:nt[Vn+1],gn&&nt[Vn].equals(gn))continue;Ln&&(bn=Ln),en&&(cn=en),en=nt[Vn],Ln=gn?gn.sub(en)._unit()._perp():bn,bn=bn||Ln;let vr=bn.add(Ln);vr.x===0&&vr.y===0||vr._unit();const er=bn.x*Ln.x+bn.y*Ln.y,_r=vr.x*Ln.x+vr.y*Ln.y,Ir=_r!==0?1/_r:1/0,Yr=2*Math.sqrt(2-2*_r),gs=_r<Nw&&cn&&gn,Hs=bn.x*Ln.y-bn.y*Ln.x>0;if(gs&&Vn>Ct){const Ls=en.dist(cn);if(Ls>2*Dt){const As=en.sub(en.sub(cn)._mult(Dt/Ls)._round());this.updateDistance(cn,As),this.addCurrentVertex(As,bn,0,0,Vt),cn=As}}const hs=cn&&gn;let cs=hs?lt:bt?"butt":ft;if(hs&&cs==="round"&&(Ir<xt?cs="miter":Ir<=2&&(cs="fakeround")),cs==="miter"&&Ir>vt&&(cs="bevel"),cs==="bevel"&&(Ir>2&&(cs="flipbevel"),Ir<vt&&(cs="miter")),cn&&this.updateDistance(cn,en),cs==="miter")vr._mult(Ir),this.addCurrentVertex(en,vr,0,0,Vt);else if(cs==="flipbevel"){if(Ir>100)vr=Ln.mult(-1);else{const Ls=Ir*bn.add(Ln).mag()/bn.sub(Ln).mag();vr._perp()._mult(Ls*(Hs?-1:1))}this.addCurrentVertex(en,vr,0,0,Vt),this.addCurrentVertex(en,vr.mult(-1),0,0,Vt)}else if(cs==="bevel"||cs==="fakeround"){const Ls=-Math.sqrt(Ir*Ir-1),As=Hs?Ls:0,xs=Hs?0:Ls;if(cn&&this.addCurrentVertex(en,bn,As,xs,Vt),cs==="fakeround"){const Hr=Math.round(180*Yr/Math.PI/20);for(let Os=1;Os<Hr;Os++){let Ds=Os/Hr;if(Ds!==.5){const No=Ds-.5;Ds+=Ds*No*(Ds-1)*((1.0904+er*(er*(3.55645-1.43519*er)-3.2452))*No*No+(.848013+er*(.215638*er-1.06021)))}const eo=Ln.sub(bn)._mult(Ds)._add(bn)._unit()._mult(Hs?-1:1);this.addHalfVertex(en,eo.x,eo.y,!1,Hs,0,Vt)}}gn&&this.addCurrentVertex(en,Ln,-As,-xs,Vt)}else if(cs==="butt")this.addCurrentVertex(en,vr,0,0,Vt);else if(cs==="square"){const Ls=cn?1:-1;this.addCurrentVertex(en,vr,Ls,Ls,Vt)}else cs==="round"&&(cn&&(this.addCurrentVertex(en,bn,0,0,Vt),this.addCurrentVertex(en,bn,1,1,Vt,!0)),gn&&(this.addCurrentVertex(en,Ln,-1,-1,Vt,!0),this.addCurrentVertex(en,Ln,0,0,Vt)));if(gs&&Vn<Et-1){const Ls=en.dist(gn);if(Ls>2*Dt){const As=en.add(gn.sub(en)._mult(Dt/Ls)._round());this.updateDistance(en,As),this.addCurrentVertex(As,Ln,0,0,Vt),en=As}}}}addCurrentVertex(nt,st,lt,ft,vt,xt=!1){const bt=st.y*ft-st.x,Et=-st.y-st.x*ft;this.addHalfVertex(nt,st.x+st.y*lt,st.y-st.x*lt,xt,!1,lt,vt),this.addHalfVertex(nt,bt,Et,xt,!0,-ft,vt),this.distance>sx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(nt,st,lt,ft,vt,xt))}addHalfVertex({x:nt,y:st},lt,ft,vt,xt,bt,Et){const Ct=.5*(this.lineClips?this.scaledDistance*(sx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((nt<<1)+(vt?1:0),(st<<1)+(xt?1:0),Math.round(63*lt)+128,Math.round(63*ft)+128,1+(bt===0?0:bt<0?-1:1)|(63&Ct)<<2,Ct>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Dt=Et.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Dt),Et.primitiveLength++),xt?this.e2=Dt:this.e1=Dt}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(nt,st){this.distance+=nt.dist(st),this.updateScaledDistance()}}let ox,ax;bs("LineBucket",w0,{omit:["layers","patternFeatures"]});var lx={get paint(){return ax=ax||new gt({"line-opacity":new qs(On.paint_line["line-opacity"]),"line-color":new qs(On.paint_line["line-color"]),"line-translate":new Ps(On.paint_line["line-translate"]),"line-translate-anchor":new Ps(On.paint_line["line-translate-anchor"]),"line-width":new qs(On.paint_line["line-width"]),"line-gap-width":new qs(On.paint_line["line-gap-width"]),"line-offset":new qs(On.paint_line["line-offset"]),"line-blur":new qs(On.paint_line["line-blur"]),"line-dasharray":new Um(On.paint_line["line-dasharray"]),"line-pattern":new $m(On.paint_line["line-pattern"]),"line-gradient":new D_(On.paint_line["line-gradient"])})},get layout(){return ox=ox||new gt({"line-cap":new Ps(On.layout_line["line-cap"]),"line-join":new qs(On.layout_line["line-join"]),"line-miter-limit":new Ps(On.layout_line["line-miter-limit"]),"line-round-limit":new Ps(On.layout_line["line-round-limit"]),"line-sort-key":new qs(On.layout_line["line-sort-key"])})}};class Bw extends qs{possiblyEvaluate(nt,st){return st=new Vo(Math.floor(st.zoom),{now:st.now,fadeDuration:st.fadeDuration,zoomHistory:st.zoomHistory,transition:st.transition}),super.possiblyEvaluate(nt,st)}evaluate(nt,st,lt,ft){return st=mn({},st,{zoom:Math.floor(st.zoom)}),super.evaluate(nt,st,lt,ft)}}let Ay;class jw extends ot{constructor(nt){super(nt,lx),this.gradientVersion=0,Ay||(Ay=new Bw(lx.paint.properties["line-width"].specification),Ay.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(nt){if(nt==="line-gradient"){const st=this.gradientExpression();this.stepInterpolant=!!function(lt){return lt._styleExpression!==void 0}(st)&&st._styleExpression.expression instanceof np,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(nt,st){super.recalculate(nt,st),this.paint._values["line-floorwidth"]=Ay.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,nt)}createBucket(nt){return new w0(nt)}queryRadius(nt){const st=nt,lt=cx(O_("line-width",this,st),O_("line-gap-width",this,st)),ft=O_("line-offset",this,st);return lt/2+Math.abs(ft)+vy(this.paint.get("line-translate"))}queryIntersectsFeature(nt,st,lt,ft,vt,xt,bt){const Et=xy(nt,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),xt.angle,bt),Ct=bt/2*cx(this.paint.get("line-width").evaluate(st,lt),this.paint.get("line-gap-width").evaluate(st,lt)),Dt=this.paint.get("line-offset").evaluate(st,lt);return Dt&&(ft=function(Vt,en){const cn=[];for(let gn=0;gn<Vt.length;gn++){const bn=Vt[gn],Ln=[];for(let Vn=0;Vn<bn.length;Vn++){const vr=bn[Vn-1],er=bn[Vn],_r=bn[Vn+1],Ir=Vn===0?new Lt(0,0):er.sub(vr)._unit()._perp(),Yr=Vn===bn.length-1?new Lt(0,0):_r.sub(er)._unit()._perp(),gs=Ir._add(Yr)._unit(),Hs=gs.x*Yr.x+gs.y*Yr.y;Hs!==0&&gs._mult(1/Hs),Ln.push(gs._mult(en)._add(er))}cn.push(Ln)}return cn}(ft,Dt*bt)),function(Vt,en,cn){for(let gn=0;gn<en.length;gn++){const bn=en[gn];if(Vt.length>=3){for(let Ln=0;Ln<bn.length;Ln++)if(Zm(Vt,bn[Ln]))return!0}if(Z1(Vt,bn,cn))return!0}return!1}(Et,ft,Ct)}isTileClipped(){return!0}}function cx(it,nt){return nt>0?nt+2*it:it}const $w=wt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Uw=wt([{name:"a_projected_pos",components:3,type:"Float32"}],4);wt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Vw=wt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);wt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ux=wt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hw=wt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ww(it,nt,st){return it.sections.forEach(lt=>{lt.text=function(ft,vt,xt){const bt=vt.layout.get("text-transform").evaluate(xt,{});return bt==="uppercase"?ft=ft.toLocaleUpperCase():bt==="lowercase"&&(ft=ft.toLocaleLowerCase()),gu.applyArabicShaping&&(ft=gu.applyArabicShaping(ft)),ft}(lt.text,nt,st)}),it}wt([{name:"triangle",components:3,type:"Uint16"}]),wt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),wt([{type:"Float32",name:"offsetX"}]),wt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),wt([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const H_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var _l=24,hx=Oo,dx=function(it,nt,st,lt,ft){var vt,xt,bt=8*ft-lt-1,Et=(1<<bt)-1,Ct=Et>>1,Dt=-7,Vt=st?ft-1:0,en=st?-1:1,cn=it[nt+Vt];for(Vt+=en,vt=cn&(1<<-Dt)-1,cn>>=-Dt,Dt+=bt;Dt>0;vt=256*vt+it[nt+Vt],Vt+=en,Dt-=8);for(xt=vt&(1<<-Dt)-1,vt>>=-Dt,Dt+=lt;Dt>0;xt=256*xt+it[nt+Vt],Vt+=en,Dt-=8);if(vt===0)vt=1-Ct;else{if(vt===Et)return xt?NaN:1/0*(cn?-1:1);xt+=Math.pow(2,lt),vt-=Ct}return(cn?-1:1)*xt*Math.pow(2,vt-lt)},px=function(it,nt,st,lt,ft,vt){var xt,bt,Et,Ct=8*vt-ft-1,Dt=(1<<Ct)-1,Vt=Dt>>1,en=ft===23?Math.pow(2,-24)-Math.pow(2,-77):0,cn=lt?0:vt-1,gn=lt?1:-1,bn=nt<0||nt===0&&1/nt<0?1:0;for(nt=Math.abs(nt),isNaN(nt)||nt===1/0?(bt=isNaN(nt)?1:0,xt=Dt):(xt=Math.floor(Math.log(nt)/Math.LN2),nt*(Et=Math.pow(2,-xt))<1&&(xt--,Et*=2),(nt+=xt+Vt>=1?en/Et:en*Math.pow(2,1-Vt))*Et>=2&&(xt++,Et/=2),xt+Vt>=Dt?(bt=0,xt=Dt):xt+Vt>=1?(bt=(nt*Et-1)*Math.pow(2,ft),xt+=Vt):(bt=nt*Math.pow(2,Vt-1)*Math.pow(2,ft),xt=0));ft>=8;it[st+cn]=255&bt,cn+=gn,bt/=256,ft-=8);for(xt=xt<<ft|bt,Ct+=ft;Ct>0;it[st+cn]=255&xt,cn+=gn,xt/=256,Ct-=8);it[st+cn-gn]|=128*bn};function Oo(it){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(it)?it:new Uint8Array(it||0),this.pos=0,this.type=0,this.length=this.buf.length}Oo.Varint=0,Oo.Fixed64=1,Oo.Bytes=2,Oo.Fixed32=5;var E0=4294967296,fx=1/E0,mx=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function zp(it){return it.type===Oo.Bytes?it.readVarint()+it.pos:it.pos+1}function Qm(it,nt,st){return st?4294967296*nt+(it>>>0):4294967296*(nt>>>0)+(it>>>0)}function gx(it,nt,st){var lt=nt<=16383?1:nt<=2097151?2:nt<=268435455?3:Math.floor(Math.log(nt)/(7*Math.LN2));st.realloc(lt);for(var ft=st.pos-1;ft>=it;ft--)st.buf[ft+lt]=st.buf[ft]}function qw(it,nt){for(var st=0;st<it.length;st++)nt.writeVarint(it[st])}function Gw(it,nt){for(var st=0;st<it.length;st++)nt.writeSVarint(it[st])}function Xw(it,nt){for(var st=0;st<it.length;st++)nt.writeFloat(it[st])}function Zw(it,nt){for(var st=0;st<it.length;st++)nt.writeDouble(it[st])}function Kw(it,nt){for(var st=0;st<it.length;st++)nt.writeBoolean(it[st])}function Yw(it,nt){for(var st=0;st<it.length;st++)nt.writeFixed32(it[st])}function Jw(it,nt){for(var st=0;st<it.length;st++)nt.writeSFixed32(it[st])}function Qw(it,nt){for(var st=0;st<it.length;st++)nt.writeFixed64(it[st])}function eE(it,nt){for(var st=0;st<it.length;st++)nt.writeSFixed64(it[st])}function Ty(it,nt){return(it[nt]|it[nt+1]<<8|it[nt+2]<<16)+16777216*it[nt+3]}function _g(it,nt,st){it[st]=nt,it[st+1]=nt>>>8,it[st+2]=nt>>>16,it[st+3]=nt>>>24}function _x(it,nt){return(it[nt]|it[nt+1]<<8|it[nt+2]<<16)+(it[nt+3]<<24)}Oo.prototype={destroy:function(){this.buf=null},readFields:function(it,nt,st){for(st=st||this.length;this.pos<st;){var lt=this.readVarint(),ft=lt>>3,vt=this.pos;this.type=7&lt,it(ft,nt,this),this.pos===vt&&this.skip(lt)}return nt},readMessage:function(it,nt){return this.readFields(it,nt,this.readVarint()+this.pos)},readFixed32:function(){var it=Ty(this.buf,this.pos);return this.pos+=4,it},readSFixed32:function(){var it=_x(this.buf,this.pos);return this.pos+=4,it},readFixed64:function(){var it=Ty(this.buf,this.pos)+Ty(this.buf,this.pos+4)*E0;return this.pos+=8,it},readSFixed64:function(){var it=Ty(this.buf,this.pos)+_x(this.buf,this.pos+4)*E0;return this.pos+=8,it},readFloat:function(){var it=dx(this.buf,this.pos,!0,23,4);return this.pos+=4,it},readDouble:function(){var it=dx(this.buf,this.pos,!0,52,8);return this.pos+=8,it},readVarint:function(it){var nt,st,lt=this.buf;return nt=127&(st=lt[this.pos++]),st<128?nt:(nt|=(127&(st=lt[this.pos++]))<<7,st<128?nt:(nt|=(127&(st=lt[this.pos++]))<<14,st<128?nt:(nt|=(127&(st=lt[this.pos++]))<<21,st<128?nt:function(ft,vt,xt){var bt,Et,Ct=xt.buf;if(bt=(112&(Et=Ct[xt.pos++]))>>4,Et<128||(bt|=(127&(Et=Ct[xt.pos++]))<<3,Et<128)||(bt|=(127&(Et=Ct[xt.pos++]))<<10,Et<128)||(bt|=(127&(Et=Ct[xt.pos++]))<<17,Et<128)||(bt|=(127&(Et=Ct[xt.pos++]))<<24,Et<128)||(bt|=(1&(Et=Ct[xt.pos++]))<<31,Et<128))return Qm(ft,bt,vt);throw new Error("Expected varint not more than 10 bytes")}(nt|=(15&(st=lt[this.pos]))<<28,it,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var it=this.readVarint();return it%2==1?(it+1)/-2:it/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var it=this.readVarint()+this.pos,nt=this.pos;return this.pos=it,it-nt>=12&&mx?function(st,lt,ft){return mx.decode(st.subarray(lt,ft))}(this.buf,nt,it):function(st,lt,ft){for(var vt="",xt=lt;xt<ft;){var bt,Et,Ct,Dt=st[xt],Vt=null,en=Dt>239?4:Dt>223?3:Dt>191?2:1;if(xt+en>ft)break;en===1?Dt<128&&(Vt=Dt):en===2?(192&(bt=st[xt+1]))==128&&(Vt=(31&Dt)<<6|63&bt)<=127&&(Vt=null):en===3?(Et=st[xt+2],(192&(bt=st[xt+1]))==128&&(192&Et)==128&&((Vt=(15&Dt)<<12|(63&bt)<<6|63&Et)<=2047||Vt>=55296&&Vt<=57343)&&(Vt=null)):en===4&&(Et=st[xt+2],Ct=st[xt+3],(192&(bt=st[xt+1]))==128&&(192&Et)==128&&(192&Ct)==128&&((Vt=(15&Dt)<<18|(63&bt)<<12|(63&Et)<<6|63&Ct)<=65535||Vt>=1114112)&&(Vt=null)),Vt===null?(Vt=65533,en=1):Vt>65535&&(Vt-=65536,vt+=String.fromCharCode(Vt>>>10&1023|55296),Vt=56320|1023&Vt),vt+=String.fromCharCode(Vt),xt+=en}return vt}(this.buf,nt,it)},readBytes:function(){var it=this.readVarint()+this.pos,nt=this.buf.subarray(this.pos,it);return this.pos=it,nt},readPackedVarint:function(it,nt){if(this.type!==Oo.Bytes)return it.push(this.readVarint(nt));var st=zp(this);for(it=it||[];this.pos<st;)it.push(this.readVarint(nt));return it},readPackedSVarint:function(it){if(this.type!==Oo.Bytes)return it.push(this.readSVarint());var nt=zp(this);for(it=it||[];this.pos<nt;)it.push(this.readSVarint());return it},readPackedBoolean:function(it){if(this.type!==Oo.Bytes)return it.push(this.readBoolean());var nt=zp(this);for(it=it||[];this.pos<nt;)it.push(this.readBoolean());return it},readPackedFloat:function(it){if(this.type!==Oo.Bytes)return it.push(this.readFloat());var nt=zp(this);for(it=it||[];this.pos<nt;)it.push(this.readFloat());return it},readPackedDouble:function(it){if(this.type!==Oo.Bytes)return it.push(this.readDouble());var nt=zp(this);for(it=it||[];this.pos<nt;)it.push(this.readDouble());return it},readPackedFixed32:function(it){if(this.type!==Oo.Bytes)return it.push(this.readFixed32());var nt=zp(this);for(it=it||[];this.pos<nt;)it.push(this.readFixed32());return it},readPackedSFixed32:function(it){if(this.type!==Oo.Bytes)return it.push(this.readSFixed32());var nt=zp(this);for(it=it||[];this.pos<nt;)it.push(this.readSFixed32());return it},readPackedFixed64:function(it){if(this.type!==Oo.Bytes)return it.push(this.readFixed64());var nt=zp(this);for(it=it||[];this.pos<nt;)it.push(this.readFixed64());return it},readPackedSFixed64:function(it){if(this.type!==Oo.Bytes)return it.push(this.readSFixed64());var nt=zp(this);for(it=it||[];this.pos<nt;)it.push(this.readSFixed64());return it},skip:function(it){var nt=7&it;if(nt===Oo.Varint)for(;this.buf[this.pos++]>127;);else if(nt===Oo.Bytes)this.pos=this.readVarint()+this.pos;else if(nt===Oo.Fixed32)this.pos+=4;else{if(nt!==Oo.Fixed64)throw new Error("Unimplemented type: "+nt);this.pos+=8}},writeTag:function(it,nt){this.writeVarint(it<<3|nt)},realloc:function(it){for(var nt=this.length||16;nt<this.pos+it;)nt*=2;if(nt!==this.length){var st=new Uint8Array(nt);st.set(this.buf),this.buf=st,this.length=nt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(it){this.realloc(4),_g(this.buf,it,this.pos),this.pos+=4},writeSFixed32:function(it){this.realloc(4),_g(this.buf,it,this.pos),this.pos+=4},writeFixed64:function(it){this.realloc(8),_g(this.buf,-1&it,this.pos),_g(this.buf,Math.floor(it*fx),this.pos+4),this.pos+=8},writeSFixed64:function(it){this.realloc(8),_g(this.buf,-1&it,this.pos),_g(this.buf,Math.floor(it*fx),this.pos+4),this.pos+=8},writeVarint:function(it){(it=+it||0)>268435455||it<0?function(nt,st){var lt,ft;if(nt>=0?(lt=nt%4294967296|0,ft=nt/4294967296|0):(ft=~(-nt/4294967296),4294967295^(lt=~(-nt%4294967296))?lt=lt+1|0:(lt=0,ft=ft+1|0)),nt>=18446744073709552e3||nt<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");st.realloc(10),function(vt,xt,bt){bt.buf[bt.pos++]=127&vt|128,vt>>>=7,bt.buf[bt.pos++]=127&vt|128,vt>>>=7,bt.buf[bt.pos++]=127&vt|128,vt>>>=7,bt.buf[bt.pos++]=127&vt|128,bt.buf[bt.pos]=127&(vt>>>=7)}(lt,0,st),function(vt,xt){var bt=(7&vt)<<4;xt.buf[xt.pos++]|=bt|((vt>>>=3)?128:0),vt&&(xt.buf[xt.pos++]=127&vt|((vt>>>=7)?128:0),vt&&(xt.buf[xt.pos++]=127&vt|((vt>>>=7)?128:0),vt&&(xt.buf[xt.pos++]=127&vt|((vt>>>=7)?128:0),vt&&(xt.buf[xt.pos++]=127&vt|((vt>>>=7)?128:0),vt&&(xt.buf[xt.pos++]=127&vt)))))}(ft,st)}(it,this):(this.realloc(4),this.buf[this.pos++]=127&it|(it>127?128:0),it<=127||(this.buf[this.pos++]=127&(it>>>=7)|(it>127?128:0),it<=127||(this.buf[this.pos++]=127&(it>>>=7)|(it>127?128:0),it<=127||(this.buf[this.pos++]=it>>>7&127))))},writeSVarint:function(it){this.writeVarint(it<0?2*-it-1:2*it)},writeBoolean:function(it){this.writeVarint(!!it)},writeString:function(it){it=String(it),this.realloc(4*it.length),this.pos++;var nt=this.pos;this.pos=function(lt,ft,vt){for(var xt,bt,Et=0;Et<ft.length;Et++){if((xt=ft.charCodeAt(Et))>55295&&xt<57344){if(!bt){xt>56319||Et+1===ft.length?(lt[vt++]=239,lt[vt++]=191,lt[vt++]=189):bt=xt;continue}if(xt<56320){lt[vt++]=239,lt[vt++]=191,lt[vt++]=189,bt=xt;continue}xt=bt-55296<<10|xt-56320|65536,bt=null}else bt&&(lt[vt++]=239,lt[vt++]=191,lt[vt++]=189,bt=null);xt<128?lt[vt++]=xt:(xt<2048?lt[vt++]=xt>>6|192:(xt<65536?lt[vt++]=xt>>12|224:(lt[vt++]=xt>>18|240,lt[vt++]=xt>>12&63|128),lt[vt++]=xt>>6&63|128),lt[vt++]=63&xt|128)}return vt}(this.buf,it,this.pos);var st=this.pos-nt;st>=128&&gx(nt,st,this),this.pos=nt-1,this.writeVarint(st),this.pos+=st},writeFloat:function(it){this.realloc(4),px(this.buf,it,this.pos,!0,23,4),this.pos+=4},writeDouble:function(it){this.realloc(8),px(this.buf,it,this.pos,!0,52,8),this.pos+=8},writeBytes:function(it){var nt=it.length;this.writeVarint(nt),this.realloc(nt);for(var st=0;st<nt;st++)this.buf[this.pos++]=it[st]},writeRawMessage:function(it,nt){this.pos++;var st=this.pos;it(nt,this);var lt=this.pos-st;lt>=128&&gx(st,lt,this),this.pos=st-1,this.writeVarint(lt),this.pos+=lt},writeMessage:function(it,nt,st){this.writeTag(it,Oo.Bytes),this.writeRawMessage(nt,st)},writePackedVarint:function(it,nt){nt.length&&this.writeMessage(it,qw,nt)},writePackedSVarint:function(it,nt){nt.length&&this.writeMessage(it,Gw,nt)},writePackedBoolean:function(it,nt){nt.length&&this.writeMessage(it,Kw,nt)},writePackedFloat:function(it,nt){nt.length&&this.writeMessage(it,Xw,nt)},writePackedDouble:function(it,nt){nt.length&&this.writeMessage(it,Zw,nt)},writePackedFixed32:function(it,nt){nt.length&&this.writeMessage(it,Yw,nt)},writePackedSFixed32:function(it,nt){nt.length&&this.writeMessage(it,Jw,nt)},writePackedFixed64:function(it,nt){nt.length&&this.writeMessage(it,Qw,nt)},writePackedSFixed64:function(it,nt){nt.length&&this.writeMessage(it,eE,nt)},writeBytesField:function(it,nt){this.writeTag(it,Oo.Bytes),this.writeBytes(nt)},writeFixed32Field:function(it,nt){this.writeTag(it,Oo.Fixed32),this.writeFixed32(nt)},writeSFixed32Field:function(it,nt){this.writeTag(it,Oo.Fixed32),this.writeSFixed32(nt)},writeFixed64Field:function(it,nt){this.writeTag(it,Oo.Fixed64),this.writeFixed64(nt)},writeSFixed64Field:function(it,nt){this.writeTag(it,Oo.Fixed64),this.writeSFixed64(nt)},writeVarintField:function(it,nt){this.writeTag(it,Oo.Varint),this.writeVarint(nt)},writeSVarintField:function(it,nt){this.writeTag(it,Oo.Varint),this.writeSVarint(nt)},writeStringField:function(it,nt){this.writeTag(it,Oo.Bytes),this.writeString(nt)},writeFloatField:function(it,nt){this.writeTag(it,Oo.Fixed32),this.writeFloat(nt)},writeDoubleField:function(it,nt){this.writeTag(it,Oo.Fixed64),this.writeDouble(nt)},writeBooleanField:function(it,nt){this.writeVarintField(it,!!nt)}};var S0=At(hx);const A0=3;function tE(it,nt,st){it===1&&st.readMessage(nE,nt)}function nE(it,nt,st){if(it===3){const{id:lt,bitmap:ft,width:vt,height:xt,left:bt,top:Et,advance:Ct}=st.readMessage(iE,{});nt.push({id:lt,bitmap:new N_({width:vt+2*A0,height:xt+2*A0},ft),metrics:{width:vt,height:xt,left:bt,top:Et,advance:Ct}})}}function iE(it,nt,st){it===1?nt.id=st.readVarint():it===2?nt.bitmap=st.readBytes():it===3?nt.width=st.readVarint():it===4?nt.height=st.readVarint():it===5?nt.left=st.readSVarint():it===6?nt.top=st.readSVarint():it===7&&(nt.advance=st.readVarint())}const yx=A0;function vx(it){let nt=0,st=0;for(const xt of it)nt+=xt.w*xt.h,st=Math.max(st,xt.w);it.sort((xt,bt)=>bt.h-xt.h);const lt=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(nt/.95)),st),h:1/0}];let ft=0,vt=0;for(const xt of it)for(let bt=lt.length-1;bt>=0;bt--){const Et=lt[bt];if(!(xt.w>Et.w||xt.h>Et.h)){if(xt.x=Et.x,xt.y=Et.y,vt=Math.max(vt,xt.y+xt.h),ft=Math.max(ft,xt.x+xt.w),xt.w===Et.w&&xt.h===Et.h){const Ct=lt.pop();bt<lt.length&&(lt[bt]=Ct)}else xt.h===Et.h?(Et.x+=xt.w,Et.w-=xt.w):xt.w===Et.w?(Et.y+=xt.h,Et.h-=xt.h):(lt.push({x:Et.x+xt.w,y:Et.y,w:Et.w-xt.w,h:xt.h}),Et.y+=xt.h,Et.h-=xt.h);break}}return{w:ft,h:vt,fill:nt/(ft*vt)||0}}const yu=1;class T0{constructor(nt,{pixelRatio:st,version:lt,stretchX:ft,stretchY:vt,content:xt,textFitWidth:bt,textFitHeight:Et}){this.paddedRect=nt,this.pixelRatio=st,this.stretchX=ft,this.stretchY=vt,this.content=xt,this.version=lt,this.textFitWidth=bt,this.textFitHeight=Et}get tl(){return[this.paddedRect.x+yu,this.paddedRect.y+yu]}get br(){return[this.paddedRect.x+this.paddedRect.w-yu,this.paddedRect.y+this.paddedRect.h-yu]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*yu)/this.pixelRatio,(this.paddedRect.h-2*yu)/this.pixelRatio]}}class xx{constructor(nt,st){const lt={},ft={};this.haveRenderCallbacks=[];const vt=[];this.addImages(nt,lt,vt),this.addImages(st,ft,vt);const{w:xt,h:bt}=vx(vt),Et=new Lu({width:xt||1,height:bt||1});for(const Ct in nt){const Dt=nt[Ct],Vt=lt[Ct].paddedRect;Lu.copy(Dt.data,Et,{x:0,y:0},{x:Vt.x+yu,y:Vt.y+yu},Dt.data)}for(const Ct in st){const Dt=st[Ct],Vt=ft[Ct].paddedRect,en=Vt.x+yu,cn=Vt.y+yu,gn=Dt.data.width,bn=Dt.data.height;Lu.copy(Dt.data,Et,{x:0,y:0},{x:en,y:cn},Dt.data),Lu.copy(Dt.data,Et,{x:0,y:bn-1},{x:en,y:cn-1},{width:gn,height:1}),Lu.copy(Dt.data,Et,{x:0,y:0},{x:en,y:cn+bn},{width:gn,height:1}),Lu.copy(Dt.data,Et,{x:gn-1,y:0},{x:en-1,y:cn},{width:1,height:bn}),Lu.copy(Dt.data,Et,{x:0,y:0},{x:en+gn,y:cn},{width:1,height:bn})}this.image=Et,this.iconPositions=lt,this.patternPositions=ft}addImages(nt,st,lt){for(const ft in nt){const vt=nt[ft],xt={x:0,y:0,w:vt.data.width+2*yu,h:vt.data.height+2*yu};lt.push(xt),st[ft]=new T0(xt,vt),vt.hasRenderCallback&&this.haveRenderCallbacks.push(ft)}}patchUpdatedImages(nt,st){nt.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const lt in nt.updatedImages)this.patchUpdatedImage(this.iconPositions[lt],nt.getImage(lt),st),this.patchUpdatedImage(this.patternPositions[lt],nt.getImage(lt),st)}patchUpdatedImage(nt,st,lt){if(!nt||!st||nt.version===st.version)return;nt.version=st.version;const[ft,vt]=nt.tl;lt.update(st.data,void 0,{x:ft,y:vt})}}var am;bs("ImagePosition",T0),bs("ImageAtlas",xx),yt.ah=void 0,(am=yt.ah||(yt.ah={}))[am.none=0]="none",am[am.horizontal=1]="horizontal",am[am.vertical=2]="vertical",am[am.horizontalOnly=3]="horizontalOnly";const W_=-17;class q_{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(nt,st){const lt=new q_;return lt.scale=nt||1,lt.fontStack=st,lt}static forImage(nt){const st=new q_;return st.imageName=nt,st}}class e_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(nt,st){const lt=new e_;for(let ft=0;ft<nt.sections.length;ft++){const vt=nt.sections[ft];vt.image?lt.addImageSection(vt):lt.addTextSection(vt,st)}return lt}length(){return this.text.length}getSection(nt){return this.sections[this.sectionIndex[nt]]}getSectionIndex(nt){return this.sectionIndex[nt]}getCharCode(nt){return this.text.charCodeAt(nt)}verticalizePunctuation(){this.text=function(nt){let st="";for(let lt=0;lt<nt.length;lt++){const ft=nt.charCodeAt(lt+1)||null,vt=nt.charCodeAt(lt-1)||null;st+=ft&&dy(ft)&&!H_[nt[lt+1]]||vt&&dy(vt)&&!H_[nt[lt-1]]||!H_[nt[lt]]?nt[lt]:H_[nt[lt]]}return st}(this.text)}trim(){let nt=0;for(let lt=0;lt<this.text.length&&ky[this.text.charCodeAt(lt)];lt++)nt++;let st=this.text.length;for(let lt=this.text.length-1;lt>=0&&lt>=nt&&ky[this.text.charCodeAt(lt)];lt--)st--;this.text=this.text.substring(nt,st),this.sectionIndex=this.sectionIndex.slice(nt,st)}substring(nt,st){const lt=new e_;return lt.text=this.text.substring(nt,st),lt.sectionIndex=this.sectionIndex.slice(nt,st),lt.sections=this.sections,lt}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((nt,st)=>Math.max(nt,this.sections[st].scale),0)}addTextSection(nt,st){this.text+=nt.text,this.sections.push(q_.forText(nt.scale,nt.fontStack||st));const lt=this.sections.length-1;for(let ft=0;ft<nt.text.length;++ft)this.sectionIndex.push(lt)}addImageSection(nt){const st=nt.image?nt.image.name:"";if(st.length===0)return void Xn("Can't add FormattedSection with an empty image.");const lt=this.getNextImageSectionCharCode();lt?(this.text+=String.fromCharCode(lt),this.sections.push(q_.forImage(st)),this.sectionIndex.push(this.sections.length-1)):Xn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Cy(it,nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn){const bn=e_.fromFeature(it,ft);let Ln;Vt===yt.ah.vertical&&bn.verticalizePunctuation();const{processBidirectionalText:Vn,processStyledBidirectionalText:vr}=gu;if(Vn&&bn.sections.length===1){Ln=[];const Ir=Vn(bn.toString(),C0(bn,Ct,vt,nt,lt,cn));for(const Yr of Ir){const gs=new e_;gs.text=Yr,gs.sections=bn.sections;for(let Hs=0;Hs<Yr.length;Hs++)gs.sectionIndex.push(0);Ln.push(gs)}}else if(vr){Ln=[];const Ir=vr(bn.text,bn.sectionIndex,C0(bn,Ct,vt,nt,lt,cn));for(const Yr of Ir){const gs=new e_;gs.text=Yr[0],gs.sectionIndex=Yr[1],gs.sections=bn.sections,Ln.push(gs)}}else Ln=function(Ir,Yr){const gs=[],Hs=Ir.text;let hs=0;for(const cs of Yr)gs.push(Ir.substring(hs,cs)),hs=cs;return hs<Hs.length&&gs.push(Ir.substring(hs,Hs.length)),gs}(bn,C0(bn,Ct,vt,nt,lt,cn));const er=[],_r={positionedLines:er,text:bn.toString(),top:Dt[1],bottom:Dt[1],left:Dt[0],right:Dt[0],writingMode:Vt,iconsInText:!1,verticalizable:!1};return function(Ir,Yr,gs,Hs,hs,cs,Ls,As,xs,Hr,Os,Ds){let eo=0,No=W_,zo=0,Sl=0;const qu=As==="right"?1:As==="left"?0:.5;let Vl=0;for(const ga of hs){ga.trim();const Tl=ga.getMaxScale(),Ql=(Tl-1)*_l,Hl={positionedGlyphs:[],lineOffset:0};Ir.positionedLines[Vl]=Hl;const uu=Hl.positionedGlyphs;let Wl=0;if(!ga.length()){No+=cs,++Vl;continue}for(let vu=0;vu<ga.length();vu++){const ko=ga.getSection(vu),jo=ga.getSectionIndex(vu),Go=ga.getCharCode(vu);let Cu=0,Qo=null,r_=null,fp=null,mp=_l;const Gu=!(xs===yt.ah.horizontal||!Os&&!M_(Go)||Os&&(ky[Go]||(Al=Go,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Al)))));if(ko.imageName){const zu=Hs[ko.imageName];if(!zu)continue;fp=ko.imageName,Ir.iconsInText=Ir.iconsInText||!0,r_=zu.paddedRect;const Ll=zu.displaySize;ko.scale=ko.scale*_l/Ds,Qo={width:Ll[0],height:Ll[1],left:yu,top:-yx,advance:Gu?Ll[1]:Ll[0]},Cu=Ql+(_l-Ll[1]*ko.scale),mp=Qo.advance;const Np=Gu?Ll[0]*ko.scale-_l*Tl:Ll[1]*ko.scale-_l*Tl;Np>0&&Np>Wl&&(Wl=Np)}else{const zu=gs[ko.fontStack],Ll=zu&&zu[Go];if(Ll&&Ll.rect)r_=Ll.rect,Qo=Ll.metrics;else{const Np=Yr[ko.fontStack],J_=Np&&Np[Go];if(!J_)continue;Qo=J_.metrics}Cu=(Tl-ko.scale)*_l}Gu?(Ir.verticalizable=!0,uu.push({glyph:Go,imageName:fp,x:eo,y:No+Cu,vertical:Gu,scale:ko.scale,fontStack:ko.fontStack,sectionIndex:jo,metrics:Qo,rect:r_}),eo+=mp*ko.scale+Hr):(uu.push({glyph:Go,imageName:fp,x:eo,y:No+Cu,vertical:Gu,scale:ko.scale,fontStack:ko.fontStack,sectionIndex:jo,metrics:Qo,rect:r_}),eo+=Qo.advance*ko.scale+Hr)}uu.length!==0&&(zo=Math.max(eo-Hr,zo),aE(uu,0,uu.length-1,qu,Wl)),eo=0;const Ou=cs*Tl+Wl;Hl.lineOffset=Math.max(Wl,Ql),No+=Ou,Sl=Math.max(Ou,Sl),++Vl}var Al;const au=No-W_,{horizontalAlign:lu,verticalAlign:cu}=k0(Ls);(function(ga,Tl,Ql,Hl,uu,Wl,Ou,vu,ko){const jo=(Tl-Ql)*uu;let Go=0;Go=Wl!==Ou?-vu*Hl-W_:(-Hl*ko+.5)*Ou;for(const Cu of ga)for(const Qo of Cu.positionedGlyphs)Qo.x+=jo,Qo.y+=Go})(Ir.positionedLines,qu,lu,cu,zo,Sl,cs,au,hs.length),Ir.top+=-cu*au,Ir.bottom=Ir.top+au,Ir.left+=-lu*zo,Ir.right=Ir.left+zo}(_r,nt,st,lt,Ln,xt,bt,Et,Vt,Ct,en,gn),!function(Ir){for(const Yr of Ir)if(Yr.positionedGlyphs.length!==0)return!1;return!0}(er)&&_r}const ky={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rE={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},sE={40:!0};function bx(it,nt,st,lt,ft,vt){if(nt.imageName){const xt=lt[nt.imageName];return xt?xt.displaySize[0]*nt.scale*_l/vt+ft:0}{const xt=st[nt.fontStack],bt=xt&&xt[it];return bt?bt.metrics.advance*nt.scale+ft:0}}function wx(it,nt,st,lt){const ft=Math.pow(it-nt,2);return lt?it<nt?ft/2:2*ft:ft+Math.abs(st)*st}function oE(it,nt,st){let lt=0;return it===10&&(lt-=1e4),st&&(lt+=150),it!==40&&it!==65288||(lt+=50),nt!==41&&nt!==65289||(lt+=50),lt}function Ex(it,nt,st,lt,ft,vt){let xt=null,bt=wx(nt,st,ft,vt);for(const Et of lt){const Ct=wx(nt-Et.x,st,ft,vt)+Et.badness;Ct<=bt&&(xt=Et,bt=Ct)}return{index:it,x:nt,priorBreak:xt,badness:bt}}function Sx(it){return it?Sx(it.priorBreak).concat(it.index):[]}function C0(it,nt,st,lt,ft,vt){if(!it)return[];const xt=[],bt=function(Vt,en,cn,gn,bn,Ln){let Vn=0;for(let vr=0;vr<Vt.length();vr++){const er=Vt.getSection(vr);Vn+=bx(Vt.getCharCode(vr),er,gn,bn,en,Ln)}return Vn/Math.max(1,Math.ceil(Vn/cn))}(it,nt,st,lt,ft,vt),Et=it.text.indexOf("​")>=0;let Ct=0;for(let Vt=0;Vt<it.length();Vt++){const en=it.getSection(Vt),cn=it.getCharCode(Vt);if(ky[cn]||(Ct+=bx(cn,en,lt,ft,nt,vt)),Vt<it.length()-1){const gn=!((Dt=cn)<11904)&&(!!yo["CJK Compatibility Forms"](Dt)||!!yo["CJK Compatibility"](Dt)||!!yo["CJK Strokes"](Dt)||!!yo["CJK Symbols and Punctuation"](Dt)||!!yo["Enclosed CJK Letters and Months"](Dt)||!!yo["Halfwidth and Fullwidth Forms"](Dt)||!!yo["Ideographic Description Characters"](Dt)||!!yo["Vertical Forms"](Dt)||hy.test(String.fromCodePoint(Dt)));(rE[cn]||gn||en.imageName||Vt!==it.length()-2&&sE[it.getCharCode(Vt+1)])&&xt.push(Ex(Vt+1,Ct,bt,xt,oE(cn,it.getCharCode(Vt+1),gn&&Et),!1))}}var Dt;return Sx(Ex(it.length(),Ct,bt,xt,0,!0))}function k0(it){let nt=.5,st=.5;switch(it){case"right":case"top-right":case"bottom-right":nt=1;break;case"left":case"top-left":case"bottom-left":nt=0}switch(it){case"bottom":case"bottom-right":case"bottom-left":st=1;break;case"top":case"top-right":case"top-left":st=0}return{horizontalAlign:nt,verticalAlign:st}}function aE(it,nt,st,lt,ft){if(!lt&&!ft)return;const vt=it[st],xt=(it[st].x+vt.metrics.advance*vt.scale)*lt;for(let bt=nt;bt<=st;bt++)it[bt].x-=xt,it[bt].y+=ft}function lE(it,nt,st){const{horizontalAlign:lt,verticalAlign:ft}=k0(st),vt=nt[0]-it.displaySize[0]*lt,xt=nt[1]-it.displaySize[1]*ft;return{image:it,top:xt,bottom:xt+it.displaySize[1],left:vt,right:vt+it.displaySize[0]}}function Ax(it){var nt,st;let lt=it.left,ft=it.top,vt=it.right-lt,xt=it.bottom-ft;const bt=(nt=it.image.textFitWidth)!==null&&nt!==void 0?nt:"stretchOrShrink",Et=(st=it.image.textFitHeight)!==null&&st!==void 0?st:"stretchOrShrink",Ct=(it.image.content[2]-it.image.content[0])/(it.image.content[3]-it.image.content[1]);if(Et==="proportional"){if(bt==="stretchOnly"&&vt/xt<Ct||bt==="proportional"){const Dt=Math.ceil(xt*Ct);lt*=Dt/vt,vt=Dt}}else if(bt==="proportional"&&Et==="stretchOnly"&&Ct!==0&&vt/xt>Ct){const Dt=Math.ceil(vt/Ct);ft*=Dt/xt,xt=Dt}return{x1:lt,y1:ft,x2:lt+vt,y2:ft+xt}}function Tx(it,nt,st,lt,ft,vt){const xt=it.image;let bt;if(xt.content){const Ln=xt.content,Vn=xt.pixelRatio||1;bt=[Ln[0]/Vn,Ln[1]/Vn,xt.displaySize[0]-Ln[2]/Vn,xt.displaySize[1]-Ln[3]/Vn]}const Et=nt.left*vt,Ct=nt.right*vt;let Dt,Vt,en,cn;st==="width"||st==="both"?(cn=ft[0]+Et-lt[3],Vt=ft[0]+Ct+lt[1]):(cn=ft[0]+(Et+Ct-xt.displaySize[0])/2,Vt=cn+xt.displaySize[0]);const gn=nt.top*vt,bn=nt.bottom*vt;return st==="height"||st==="both"?(Dt=ft[1]+gn-lt[0],en=ft[1]+bn+lt[2]):(Dt=ft[1]+(gn+bn-xt.displaySize[1])/2,en=Dt+xt.displaySize[1]),{image:xt,top:Dt,right:Vt,bottom:en,left:cn,collisionPadding:bt}}const G_=255,pp=128,lm=G_*pp;function Cx(it,nt){const{expression:st}=nt;if(st.kind==="constant")return{kind:"constant",layoutSize:st.evaluate(new Vo(it+1))};if(st.kind==="source")return{kind:"source"};{const{zoomStops:lt,interpolationType:ft}=st;let vt=0;for(;vt<lt.length&&lt[vt]<=it;)vt++;vt=Math.max(0,vt-1);let xt=vt;for(;xt<lt.length&&lt[xt]<it+1;)xt++;xt=Math.min(lt.length-1,xt);const bt=lt[vt],Et=lt[xt];return st.kind==="composite"?{kind:"composite",minZoom:bt,maxZoom:Et,interpolationType:ft}:{kind:"camera",minZoom:bt,maxZoom:Et,minSize:st.evaluate(new Vo(bt)),maxSize:st.evaluate(new Vo(Et)),interpolationType:ft}}}function P0(it,nt,st){let lt="never";const ft=it.get(nt);return ft?lt=ft:it.get(st)&&(lt="always"),lt}const cE=om.VectorTileFeature.types,uE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Py(it,nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en){const cn=bt?Math.min(lm,Math.round(bt[0])):0,gn=bt?Math.min(lm,Math.round(bt[1])):0;it.emplaceBack(nt,st,Math.round(32*lt),Math.round(32*ft),vt,xt,(cn<<1)+(Et?1:0),gn,16*Ct,16*Dt,256*Vt,256*en)}function R0(it,nt,st){it.emplaceBack(nt.x,nt.y,st),it.emplaceBack(nt.x,nt.y,st),it.emplaceBack(nt.x,nt.y,st),it.emplaceBack(nt.x,nt.y,st)}function hE(it){for(const nt of it.sections)if(r0(nt.text))return!0;return!1}class M0{constructor(nt){this.layoutVertexArray=new Hm,this.indexArray=new Du,this.programConfigurations=nt,this.segments=new vo,this.dynamicLayoutVertexArray=new L_,this.opacityVertexArray=new Au,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ho}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(nt,st,lt,ft){this.isEmpty()||(lt&&(this.layoutVertexBuffer=nt.createVertexBuffer(this.layoutVertexArray,$w.members),this.indexBuffer=nt.createIndexBuffer(this.indexArray,st),this.dynamicLayoutVertexBuffer=nt.createVertexBuffer(this.dynamicLayoutVertexArray,Uw.members,!0),this.opacityVertexBuffer=nt.createVertexBuffer(this.opacityVertexArray,uE,!0),this.opacityVertexBuffer.itemSize=1),(lt||ft)&&this.programConfigurations.upload(nt))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}bs("SymbolBuffers",M0);class I0{constructor(nt,st,lt){this.layoutVertexArray=new nt,this.layoutAttributes=st,this.indexArray=new lt,this.segments=new vo,this.collisionVertexArray=new hp}upload(nt){this.layoutVertexBuffer=nt.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=nt.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=nt.createVertexBuffer(this.collisionVertexArray,Vw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}bs("CollisionBuffers",I0);class t_{constructor(nt){this.collisionBoxArray=nt.collisionBoxArray,this.zoom=nt.zoom,this.overscaling=nt.overscaling,this.layers=nt.layers,this.layerIds=this.layers.map(xt=>xt.id),this.index=nt.index,this.pixelRatio=nt.pixelRatio,this.sourceLayerIndex=nt.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=h0([]),this.placementViewportMatrix=h0([]);const st=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cx(this.zoom,st["text-size"]),this.iconSizeData=Cx(this.zoom,st["icon-size"]);const lt=this.layers[0].layout,ft=lt.get("symbol-sort-key"),vt=lt.get("symbol-z-order");this.canOverlap=P0(lt,"text-overlap","text-allow-overlap")!=="never"||P0(lt,"icon-overlap","icon-allow-overlap")!=="never"||lt.get("text-ignore-placement")||lt.get("icon-ignore-placement"),this.sortFeaturesByKey=vt!=="viewport-y"&&!ft.isConstant(),this.sortFeaturesByY=(vt==="viewport-y"||vt==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,lt.get("symbol-placement")==="point"&&(this.writingModes=lt.get("text-writing-mode").map(xt=>yt.ah[xt])),this.stateDependentLayerIds=this.layers.filter(xt=>xt.isStateDependent()).map(xt=>xt.id),this.sourceID=nt.sourceID}createArrays(){this.text=new M0(new wm(this.layers,this.zoom,nt=>/^text/.test(nt))),this.icon=new M0(new wm(this.layers,this.zoom,nt=>/^icon/.test(nt))),this.glyphOffsetArray=new Wo,this.lineVertexArray=new Nl,this.symbolInstances=new mo,this.textAnchorOffsets=new qo}calculateGlyphDependencies(nt,st,lt,ft,vt){for(let xt=0;xt<nt.length;xt++)if(st[nt.charCodeAt(xt)]=!0,(lt||ft)&&vt){const bt=H_[nt.charAt(xt)];bt&&(st[bt.charCodeAt(0)]=!0)}}populate(nt,st,lt){const ft=this.layers[0],vt=ft.layout,xt=vt.get("text-font"),bt=vt.get("text-field"),Et=vt.get("icon-image"),Ct=(bt.value.kind!=="constant"||bt.value.value instanceof yl&&!bt.value.value.isEmpty()||bt.value.value.toString().length>0)&&(xt.value.kind!=="constant"||xt.value.value.length>0),Dt=Et.value.kind!=="constant"||!!Et.value.value||Object.keys(Et.parameters).length>0,Vt=vt.get("symbol-sort-key");if(this.features=[],!Ct&&!Dt)return;const en=st.iconDependencies,cn=st.glyphDependencies,gn=st.availableImages,bn=new Vo(this.zoom);for(const{feature:Ln,id:Vn,index:vr,sourceLayerIndex:er}of nt){const _r=ft._featureFilter.needGeometry,Ir=Sm(Ln,_r);if(!ft._featureFilter.filter(bn,Ir,lt))continue;let Yr,gs;if(_r||(Ir.geometry=Em(Ln)),Ct){const hs=ft.getValueAndResolveTokens("text-field",Ir,lt,gn),cs=yl.factory(hs),Ls=this.hasRTLText=this.hasRTLText||hE(cs);(!Ls||gu.getRTLTextPluginStatus()==="unavailable"||Ls&&gu.isParsed())&&(Yr=Ww(cs,ft,Ir))}if(Dt){const hs=ft.getValueAndResolveTokens("icon-image",Ir,lt,gn);gs=hs instanceof Xl?hs:Xl.fromString(hs)}if(!Yr&&!gs)continue;const Hs=this.sortFeaturesByKey?Vt.evaluate(Ir,{},lt):void 0;if(this.features.push({id:Vn,text:Yr,icon:gs,index:vr,sourceLayerIndex:er,geometry:Ir.geometry,properties:Ln.properties,type:cE[Ln.type],sortKey:Hs}),gs&&(en[gs.name]=!0),Yr){const hs=xt.evaluate(Ir,{},lt).join(","),cs=vt.get("text-rotation-alignment")!=="viewport"&&vt.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(yt.ah.vertical)>=0;for(const Ls of Yr.sections)if(Ls.image)en[Ls.image.name]=!0;else{const As=P_(Yr.toString()),xs=Ls.fontStack||hs,Hr=cn[xs]=cn[xs]||{};this.calculateGlyphDependencies(Ls.text,Hr,cs,this.allowVerticalPlacement,As)}}}vt.get("symbol-placement")==="line"&&(this.features=function(Ln){const Vn={},vr={},er=[];let _r=0;function Ir(hs){er.push(Ln[hs]),_r++}function Yr(hs,cs,Ls){const As=vr[hs];return delete vr[hs],vr[cs]=As,er[As].geometry[0].pop(),er[As].geometry[0]=er[As].geometry[0].concat(Ls[0]),As}function gs(hs,cs,Ls){const As=Vn[cs];return delete Vn[cs],Vn[hs]=As,er[As].geometry[0].shift(),er[As].geometry[0]=Ls[0].concat(er[As].geometry[0]),As}function Hs(hs,cs,Ls){const As=Ls?cs[0][cs[0].length-1]:cs[0][0];return`${hs}:${As.x}:${As.y}`}for(let hs=0;hs<Ln.length;hs++){const cs=Ln[hs],Ls=cs.geometry,As=cs.text?cs.text.toString():null;if(!As){Ir(hs);continue}const xs=Hs(As,Ls),Hr=Hs(As,Ls,!0);if(xs in vr&&Hr in Vn&&vr[xs]!==Vn[Hr]){const Os=gs(xs,Hr,Ls),Ds=Yr(xs,Hr,er[Os].geometry);delete Vn[xs],delete vr[Hr],vr[Hs(As,er[Ds].geometry,!0)]=Ds,er[Os].geometry=null}else xs in vr?Yr(xs,Hr,Ls):Hr in Vn?gs(xs,Hr,Ls):(Ir(hs),Vn[xs]=_r-1,vr[Hr]=_r-1)}return er.filter(hs=>hs.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ln,Vn)=>Ln.sortKey-Vn.sortKey)}update(nt,st,lt){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(nt,st,this.layers,lt),this.icon.programConfigurations.updatePaintArrays(nt,st,this.layers,lt))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(nt){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(nt),this.iconCollisionBox.upload(nt)),this.text.upload(nt,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(nt,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(nt,st){const lt=this.lineVertexArray.length;if(nt.segment!==void 0){let ft=nt.dist(st[nt.segment+1]),vt=nt.dist(st[nt.segment]);const xt={};for(let bt=nt.segment+1;bt<st.length;bt++)xt[bt]={x:st[bt].x,y:st[bt].y,tileUnitDistanceFromAnchor:ft},bt<st.length-1&&(ft+=st[bt+1].dist(st[bt]));for(let bt=nt.segment||0;bt>=0;bt--)xt[bt]={x:st[bt].x,y:st[bt].y,tileUnitDistanceFromAnchor:vt},bt>0&&(vt+=st[bt-1].dist(st[bt]));for(let bt=0;bt<st.length;bt++){const Et=xt[bt];this.lineVertexArray.emplaceBack(Et.x,Et.y,Et.tileUnitDistanceFromAnchor)}}return{lineStartIndex:lt,lineLength:this.lineVertexArray.length-lt}}addSymbols(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en){const cn=nt.indexArray,gn=nt.layoutVertexArray,bn=nt.segments.prepareSegment(4*st.length,gn,cn,this.canOverlap?xt.sortKey:void 0),Ln=this.glyphOffsetArray.length,Vn=bn.vertexLength,vr=this.allowVerticalPlacement&&bt===yt.ah.vertical?Math.PI/2:0,er=xt.text&&xt.text.sections;for(let _r=0;_r<st.length;_r++){const{tl:Ir,tr:Yr,bl:gs,br:Hs,tex:hs,pixelOffsetTL:cs,pixelOffsetBR:Ls,minFontScaleX:As,minFontScaleY:xs,glyphOffset:Hr,isSDF:Os,sectionIndex:Ds}=st[_r],eo=bn.vertexLength,No=Hr[1];Py(gn,Et.x,Et.y,Ir.x,No+Ir.y,hs.x,hs.y,lt,Os,cs.x,cs.y,As,xs),Py(gn,Et.x,Et.y,Yr.x,No+Yr.y,hs.x+hs.w,hs.y,lt,Os,Ls.x,cs.y,As,xs),Py(gn,Et.x,Et.y,gs.x,No+gs.y,hs.x,hs.y+hs.h,lt,Os,cs.x,Ls.y,As,xs),Py(gn,Et.x,Et.y,Hs.x,No+Hs.y,hs.x+hs.w,hs.y+hs.h,lt,Os,Ls.x,Ls.y,As,xs),R0(nt.dynamicLayoutVertexArray,Et,vr),cn.emplaceBack(eo,eo+1,eo+2),cn.emplaceBack(eo+1,eo+2,eo+3),bn.vertexLength+=4,bn.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Hr[0]),_r!==st.length-1&&Ds===st[_r+1].sectionIndex||nt.programConfigurations.populatePaintArrays(gn.length,xt,xt.index,{},en,er&&er[Ds])}nt.placedSymbolArray.emplaceBack(Et.x,Et.y,Ln,this.glyphOffsetArray.length-Ln,Vn,Ct,Dt,Et.segment,lt?lt[0]:0,lt?lt[1]:0,ft[0],ft[1],bt,0,!1,0,Vt)}_addCollisionDebugVertex(nt,st,lt,ft,vt,xt){return st.emplaceBack(0,0),nt.emplaceBack(lt.x,lt.y,ft,vt,Math.round(xt.x),Math.round(xt.y))}addCollisionDebugVertices(nt,st,lt,ft,vt,xt,bt){const Et=vt.segments.prepareSegment(4,vt.layoutVertexArray,vt.indexArray),Ct=Et.vertexLength,Dt=vt.layoutVertexArray,Vt=vt.collisionVertexArray,en=bt.anchorX,cn=bt.anchorY;this._addCollisionDebugVertex(Dt,Vt,xt,en,cn,new Lt(nt,st)),this._addCollisionDebugVertex(Dt,Vt,xt,en,cn,new Lt(lt,st)),this._addCollisionDebugVertex(Dt,Vt,xt,en,cn,new Lt(lt,ft)),this._addCollisionDebugVertex(Dt,Vt,xt,en,cn,new Lt(nt,ft)),Et.vertexLength+=4;const gn=vt.indexArray;gn.emplaceBack(Ct,Ct+1),gn.emplaceBack(Ct+1,Ct+2),gn.emplaceBack(Ct+2,Ct+3),gn.emplaceBack(Ct+3,Ct),Et.primitiveLength+=4}addDebugCollisionBoxes(nt,st,lt,ft){for(let vt=nt;vt<st;vt++){const xt=this.collisionBoxArray.get(vt);this.addCollisionDebugVertices(xt.x1,xt.y1,xt.x2,xt.y2,ft?this.textCollisionBox:this.iconCollisionBox,xt.anchorPoint,lt)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new I0(Tu,ux.members,Dl),this.iconCollisionBox=new I0(Tu,ux.members,Dl);for(let nt=0;nt<this.symbolInstances.length;nt++){const st=this.symbolInstances.get(nt);this.addDebugCollisionBoxes(st.textBoxStartIndex,st.textBoxEndIndex,st,!0),this.addDebugCollisionBoxes(st.verticalTextBoxStartIndex,st.verticalTextBoxEndIndex,st,!0),this.addDebugCollisionBoxes(st.iconBoxStartIndex,st.iconBoxEndIndex,st,!1),this.addDebugCollisionBoxes(st.verticalIconBoxStartIndex,st.verticalIconBoxEndIndex,st,!1)}}_deserializeCollisionBoxesForSymbol(nt,st,lt,ft,vt,xt,bt,Et,Ct){const Dt={};for(let Vt=st;Vt<lt;Vt++){const en=nt.get(Vt);Dt.textBox={x1:en.x1,y1:en.y1,x2:en.x2,y2:en.y2,anchorPointX:en.anchorPointX,anchorPointY:en.anchorPointY},Dt.textFeatureIndex=en.featureIndex;break}for(let Vt=ft;Vt<vt;Vt++){const en=nt.get(Vt);Dt.verticalTextBox={x1:en.x1,y1:en.y1,x2:en.x2,y2:en.y2,anchorPointX:en.anchorPointX,anchorPointY:en.anchorPointY},Dt.verticalTextFeatureIndex=en.featureIndex;break}for(let Vt=xt;Vt<bt;Vt++){const en=nt.get(Vt);Dt.iconBox={x1:en.x1,y1:en.y1,x2:en.x2,y2:en.y2,anchorPointX:en.anchorPointX,anchorPointY:en.anchorPointY},Dt.iconFeatureIndex=en.featureIndex;break}for(let Vt=Et;Vt<Ct;Vt++){const en=nt.get(Vt);Dt.verticalIconBox={x1:en.x1,y1:en.y1,x2:en.x2,y2:en.y2,anchorPointX:en.anchorPointX,anchorPointY:en.anchorPointY},Dt.verticalIconFeatureIndex=en.featureIndex;break}return Dt}deserializeCollisionBoxes(nt){this.collisionArrays=[];for(let st=0;st<this.symbolInstances.length;st++){const lt=this.symbolInstances.get(st);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(nt,lt.textBoxStartIndex,lt.textBoxEndIndex,lt.verticalTextBoxStartIndex,lt.verticalTextBoxEndIndex,lt.iconBoxStartIndex,lt.iconBoxEndIndex,lt.verticalIconBoxStartIndex,lt.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(nt,st){const lt=nt.placedSymbolArray.get(st),ft=lt.vertexStartIndex+4*lt.numGlyphs;for(let vt=lt.vertexStartIndex;vt<ft;vt+=4)nt.indexArray.emplaceBack(vt,vt+1,vt+2),nt.indexArray.emplaceBack(vt+1,vt+2,vt+3)}getSortedSymbolIndexes(nt){if(this.sortedAngle===nt&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const st=Math.sin(nt),lt=Math.cos(nt),ft=[],vt=[],xt=[];for(let bt=0;bt<this.symbolInstances.length;++bt){xt.push(bt);const Et=this.symbolInstances.get(bt);ft.push(0|Math.round(st*Et.anchorX+lt*Et.anchorY)),vt.push(Et.featureIndex)}return xt.sort((bt,Et)=>ft[bt]-ft[Et]||vt[Et]-vt[bt]),xt}addToSortKeyRanges(nt,st){const lt=this.sortKeyRanges[this.sortKeyRanges.length-1];lt&&lt.sortKey===st?lt.symbolInstanceEnd=nt+1:this.sortKeyRanges.push({sortKey:st,symbolInstanceStart:nt,symbolInstanceEnd:nt+1})}sortFeatures(nt){if(this.sortFeaturesByY&&this.sortedAngle!==nt&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(nt),this.sortedAngle=nt,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const st of this.symbolInstanceIndexes){const lt=this.symbolInstances.get(st);this.featureSortOrder.push(lt.featureIndex),[lt.rightJustifiedTextSymbolIndex,lt.centerJustifiedTextSymbolIndex,lt.leftJustifiedTextSymbolIndex].forEach((ft,vt,xt)=>{ft>=0&&xt.indexOf(ft)===vt&&this.addIndicesForPlacedSymbol(this.text,ft)}),lt.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,lt.verticalPlacedTextSymbolIndex),lt.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,lt.placedIconSymbolIndex),lt.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,lt.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let kx,Px;bs("SymbolBucket",t_,{omit:["layers","collisionBoxArray","features","compareText"]}),t_.MAX_GLYPHS=65535,t_.addDynamicAttributes=R0;var D0={get paint(){return Px=Px||new gt({"icon-opacity":new qs(On.paint_symbol["icon-opacity"]),"icon-color":new qs(On.paint_symbol["icon-color"]),"icon-halo-color":new qs(On.paint_symbol["icon-halo-color"]),"icon-halo-width":new qs(On.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qs(On.paint_symbol["icon-halo-blur"]),"icon-translate":new Ps(On.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ps(On.paint_symbol["icon-translate-anchor"]),"text-opacity":new qs(On.paint_symbol["text-opacity"]),"text-color":new qs(On.paint_symbol["text-color"],{runtimeType:Yn,getOverride:it=>it.textColor,hasOverride:it=>!!it.textColor}),"text-halo-color":new qs(On.paint_symbol["text-halo-color"]),"text-halo-width":new qs(On.paint_symbol["text-halo-width"]),"text-halo-blur":new qs(On.paint_symbol["text-halo-blur"]),"text-translate":new Ps(On.paint_symbol["text-translate"]),"text-translate-anchor":new Ps(On.paint_symbol["text-translate-anchor"])})},get layout(){return kx=kx||new gt({"symbol-placement":new Ps(On.layout_symbol["symbol-placement"]),"symbol-spacing":new Ps(On.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ps(On.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qs(On.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ps(On.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ps(On.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ps(On.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ps(On.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ps(On.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ps(On.layout_symbol["icon-rotation-alignment"]),"icon-size":new qs(On.layout_symbol["icon-size"]),"icon-text-fit":new Ps(On.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ps(On.layout_symbol["icon-text-fit-padding"]),"icon-image":new qs(On.layout_symbol["icon-image"]),"icon-rotate":new qs(On.layout_symbol["icon-rotate"]),"icon-padding":new qs(On.layout_symbol["icon-padding"]),"icon-keep-upright":new Ps(On.layout_symbol["icon-keep-upright"]),"icon-offset":new qs(On.layout_symbol["icon-offset"]),"icon-anchor":new qs(On.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ps(On.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ps(On.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ps(On.layout_symbol["text-rotation-alignment"]),"text-field":new qs(On.layout_symbol["text-field"]),"text-font":new qs(On.layout_symbol["text-font"]),"text-size":new qs(On.layout_symbol["text-size"]),"text-max-width":new qs(On.layout_symbol["text-max-width"]),"text-line-height":new Ps(On.layout_symbol["text-line-height"]),"text-letter-spacing":new qs(On.layout_symbol["text-letter-spacing"]),"text-justify":new qs(On.layout_symbol["text-justify"]),"text-radial-offset":new qs(On.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ps(On.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qs(On.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qs(On.layout_symbol["text-anchor"]),"text-max-angle":new Ps(On.layout_symbol["text-max-angle"]),"text-writing-mode":new Ps(On.layout_symbol["text-writing-mode"]),"text-rotate":new qs(On.layout_symbol["text-rotate"]),"text-padding":new Ps(On.layout_symbol["text-padding"]),"text-keep-upright":new Ps(On.layout_symbol["text-keep-upright"]),"text-transform":new qs(On.layout_symbol["text-transform"]),"text-offset":new qs(On.layout_symbol["text-offset"]),"text-allow-overlap":new Ps(On.layout_symbol["text-allow-overlap"]),"text-overlap":new Ps(On.layout_symbol["text-overlap"]),"text-ignore-placement":new Ps(On.layout_symbol["text-ignore-placement"]),"text-optional":new Ps(On.layout_symbol["text-optional"])})}};class Rx{constructor(nt){if(nt.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=nt.property.overrides?nt.property.overrides.runtimeType:Ms,this.defaultValue=nt}evaluate(nt){if(nt.formattedSection){const st=this.defaultValue.property.overrides;if(st&&st.hasOverride(nt.formattedSection))return st.getOverride(nt.formattedSection)}return nt.feature&&nt.featureState?this.defaultValue.evaluate(nt.feature,nt.featureState):this.defaultValue.property.specification.default}eachChild(nt){this.defaultValue.isConstant()||nt(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bs("FormatSectionOverride",Rx,{omit:["defaultValue"]});class Ry extends ot{constructor(nt){super(nt,D0)}recalculate(nt,st){if(super.recalculate(nt,st),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const lt=this.layout.get("text-writing-mode");if(lt){const ft=[];for(const vt of lt)ft.indexOf(vt)<0&&ft.push(vt);this.layout._values["text-writing-mode"]=ft}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(nt,st,lt,ft){const vt=this.layout.get(nt).evaluate(st,{},lt,ft),xt=this._unevaluatedLayout._values[nt];return xt.isDataDriven()||Cp(xt.value)||!vt?vt:function(bt,Et){return Et.replace(/{([^{}]+)}/g,(Ct,Dt)=>bt&&Dt in bt?String(bt[Dt]):"")}(st.properties,vt)}createBucket(nt){return new t_(nt)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const nt of D0.paint.overridableProperties){if(!Ry.hasPaintOverride(this.layout,nt))continue;const st=this.paint.get(nt),lt=new Rx(st),ft=new Tp(lt,st.property.specification);let vt=null;vt=st.value.kind==="constant"||st.value.kind==="source"?new lp("source",ft):new cp("composite",ft,st.value.zoomStops),this.paint._values[nt]=new Hu(st.property,vt,st.parameters)}}_handleOverridablePaintPropertyUpdate(nt,st,lt){return!(!this.layout||st.isDataDriven()||lt.isDataDriven())&&Ry.hasPaintOverride(this.layout,nt)}static hasPaintOverride(nt,st){const lt=nt.get("text-field"),ft=D0.paint.properties[st];let vt=!1;const xt=bt=>{for(const Et of bt)if(ft.overrides&&ft.overrides.hasOverride(Et))return void(vt=!0)};if(lt.value.kind==="constant"&&lt.value.value instanceof yl)xt(lt.value.value.sections);else if(lt.value.kind==="source"){const bt=Ct=>{vt||(Ct instanceof Pl&&Zo(Ct.value)===Us?xt(Ct.value.sections):Ct instanceof Un?xt(Ct.sections):Ct.eachChild(bt))},Et=lt.value;Et._styleExpression&&bt(Et._styleExpression.expression)}return vt}}let Mx;var dE={get paint(){return Mx=Mx||new gt({"background-color":new Ps(On.paint_background["background-color"]),"background-pattern":new Um(On.paint_background["background-pattern"]),"background-opacity":new Ps(On.paint_background["background-opacity"])})}};class pE extends ot{constructor(nt){super(nt,dE)}}let Ix;var fE={get paint(){return Ix=Ix||new gt({"raster-opacity":new Ps(On.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ps(On.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ps(On.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ps(On.paint_raster["raster-brightness-max"]),"raster-saturation":new Ps(On.paint_raster["raster-saturation"]),"raster-contrast":new Ps(On.paint_raster["raster-contrast"]),"raster-resampling":new Ps(On.paint_raster["raster-resampling"]),"raster-fade-duration":new Ps(On.paint_raster["raster-fade-duration"])})}};class mE extends ot{constructor(nt){super(nt,fE)}}class gE extends ot{constructor(nt){super(nt,{}),this.onAdd=st=>{this.implementation.onAdd&&this.implementation.onAdd(st,st.painter.context.gl)},this.onRemove=st=>{this.implementation.onRemove&&this.implementation.onRemove(st,st.painter.context.gl)},this.implementation=nt}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _E{constructor(nt){this._methodToThrottle=nt,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const L0=63710088e-1;class cm{constructor(nt,st){if(isNaN(nt)||isNaN(st))throw new Error(`Invalid LngLat object: (${nt}, ${st})`);if(this.lng=+nt,this.lat=+st,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cm(Kt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(nt){const st=Math.PI/180,lt=this.lat*st,ft=nt.lat*st,vt=Math.sin(lt)*Math.sin(ft)+Math.cos(lt)*Math.cos(ft)*Math.cos((nt.lng-this.lng)*st);return L0*Math.acos(Math.min(vt,1))}static convert(nt){if(nt instanceof cm)return nt;if(Array.isArray(nt)&&(nt.length===2||nt.length===3))return new cm(Number(nt[0]),Number(nt[1]));if(!Array.isArray(nt)&&typeof nt=="object"&&nt!==null)return new cm(Number("lng"in nt?nt.lng:nt.lon),Number(nt.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Dx=2*Math.PI*L0;function Lx(it){return Dx*Math.cos(it*Math.PI/180)}function Fx(it){return(180+it)/360}function Ox(it){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+it*Math.PI/360)))/360}function zx(it,nt){return it/Lx(nt)}function F0(it){return 360/Math.PI*Math.atan(Math.exp((180-360*it)*Math.PI/180))-90}class X_{constructor(nt,st,lt=0){this.x=+nt,this.y=+st,this.z=+lt}static fromLngLat(nt,st=0){const lt=cm.convert(nt);return new X_(Fx(lt.lng),Ox(lt.lat),zx(st,lt.lat))}toLngLat(){return new cm(360*this.x-180,F0(this.y))}toAltitude(){return this.z*Lx(F0(this.y))}meterInMercatorCoordinateUnits(){return 1/Dx*(nt=F0(this.y),1/Math.cos(nt*Math.PI/180));var nt}}function Nx(it,nt,st){var lt=2*Math.PI*6378137/256/Math.pow(2,st);return[it*lt-2*Math.PI*6378137/2,nt*lt-2*Math.PI*6378137/2]}class O0{constructor(nt,st,lt){if(!function(ft,vt,xt){return!(ft<0||ft>25||xt<0||xt>=Math.pow(2,ft)||vt<0||vt>=Math.pow(2,ft))}(nt,st,lt))throw new Error(`x=${st}, y=${lt}, z=${nt} outside of bounds. 0<=x<${Math.pow(2,nt)}, 0<=y<${Math.pow(2,nt)} 0<=z<=25 `);this.z=nt,this.x=st,this.y=lt,this.key=Z_(0,nt,nt,st,lt)}equals(nt){return this.z===nt.z&&this.x===nt.x&&this.y===nt.y}url(nt,st,lt){const ft=(xt=this.y,bt=this.z,Et=Nx(256*(vt=this.x),256*(xt=Math.pow(2,bt)-xt-1),bt),Ct=Nx(256*(vt+1),256*(xt+1),bt),Et[0]+","+Et[1]+","+Ct[0]+","+Ct[1]);var vt,xt,bt,Et,Ct;const Dt=function(Vt,en,cn){let gn,bn="";for(let Ln=Vt;Ln>0;Ln--)gn=1<<Ln-1,bn+=(en&gn?1:0)+(cn&gn?2:0);return bn}(this.z,this.x,this.y);return nt[(this.x+this.y)%nt.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(lt==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,st>1?"@2x":"").replace(/{quadkey}/g,Dt).replace(/{bbox-epsg-3857}/g,ft)}isChildOf(nt){const st=this.z-nt.z;return st>0&&nt.x===this.x>>st&&nt.y===this.y>>st}getTilePoint(nt){const st=Math.pow(2,this.z);return new Lt((nt.x*st-this.x)*ba,(nt.y*st-this.y)*ba)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Bx{constructor(nt,st){this.wrap=nt,this.canonical=st,this.key=Z_(nt,st.z,st.z,st.x,st.y)}}class Fu{constructor(nt,st,lt,ft,vt){if(nt<lt)throw new Error(`overscaledZ should be >= z; overscaledZ = ${nt}; z = ${lt}`);this.overscaledZ=nt,this.wrap=st,this.canonical=new O0(lt,+ft,+vt),this.key=Z_(st,nt,lt,ft,vt)}clone(){return new Fu(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(nt){return this.overscaledZ===nt.overscaledZ&&this.wrap===nt.wrap&&this.canonical.equals(nt.canonical)}scaledTo(nt){if(nt>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${nt}; overscaledZ = ${this.overscaledZ}`);const st=this.canonical.z-nt;return nt>this.canonical.z?new Fu(nt,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fu(nt,this.wrap,nt,this.canonical.x>>st,this.canonical.y>>st)}calculateScaledKey(nt,st){if(nt>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${nt}; overscaledZ = ${this.overscaledZ}`);const lt=this.canonical.z-nt;return nt>this.canonical.z?Z_(this.wrap*+st,nt,this.canonical.z,this.canonical.x,this.canonical.y):Z_(this.wrap*+st,nt,nt,this.canonical.x>>lt,this.canonical.y>>lt)}isChildOf(nt){if(nt.wrap!==this.wrap)return!1;const st=this.canonical.z-nt.canonical.z;return nt.overscaledZ===0||nt.overscaledZ<this.overscaledZ&&nt.canonical.x===this.canonical.x>>st&&nt.canonical.y===this.canonical.y>>st}children(nt){if(this.overscaledZ>=nt)return[new Fu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const st=this.canonical.z+1,lt=2*this.canonical.x,ft=2*this.canonical.y;return[new Fu(st,this.wrap,st,lt,ft),new Fu(st,this.wrap,st,lt+1,ft),new Fu(st,this.wrap,st,lt,ft+1),new Fu(st,this.wrap,st,lt+1,ft+1)]}isLessThan(nt){return this.wrap<nt.wrap||!(this.wrap>nt.wrap)&&(this.overscaledZ<nt.overscaledZ||!(this.overscaledZ>nt.overscaledZ)&&(this.canonical.x<nt.canonical.x||!(this.canonical.x>nt.canonical.x)&&this.canonical.y<nt.canonical.y))}wrapped(){return new Fu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(nt){return new Fu(this.overscaledZ,nt,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Bx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(nt){return this.canonical.getTilePoint(new X_(nt.x-this.wrap,nt.y))}}function Z_(it,nt,st,lt,ft){(it*=2)<0&&(it=-1*it-1);const vt=1<<st;return(vt*vt*it+vt*ft+lt).toString(36)+st.toString(36)+nt.toString(36)}bs("CanonicalTileID",O0),bs("OverscaledTileID",Fu,{omit:["posMatrix"]});class jx{constructor(nt,st,lt,ft=1,vt=1,xt=1,bt=0){if(this.uid=nt,st.height!==st.width)throw new RangeError("DEM tiles must be square");if(lt&&!["mapbox","terrarium","custom"].includes(lt))return void Xn(`"${lt}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=st.height;const Et=this.dim=st.height-2;switch(this.data=new Uint32Array(st.data.buffer),lt){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=ft,this.greenFactor=vt,this.blueFactor=xt,this.baseShift=bt;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let Ct=0;Ct<Et;Ct++)this.data[this._idx(-1,Ct)]=this.data[this._idx(0,Ct)],this.data[this._idx(Et,Ct)]=this.data[this._idx(Et-1,Ct)],this.data[this._idx(Ct,-1)]=this.data[this._idx(Ct,0)],this.data[this._idx(Ct,Et)]=this.data[this._idx(Ct,Et-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(Et,-1)]=this.data[this._idx(Et-1,0)],this.data[this._idx(-1,Et)]=this.data[this._idx(0,Et-1)],this.data[this._idx(Et,Et)]=this.data[this._idx(Et-1,Et-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Ct=0;Ct<Et;Ct++)for(let Dt=0;Dt<Et;Dt++){const Vt=this.get(Ct,Dt);Vt>this.max&&(this.max=Vt),Vt<this.min&&(this.min=Vt)}}get(nt,st){const lt=new Uint8Array(this.data.buffer),ft=4*this._idx(nt,st);return this.unpack(lt[ft],lt[ft+1],lt[ft+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(nt,st){if(nt<-1||nt>=this.dim+1||st<-1||st>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(st+1)*this.stride+(nt+1)}unpack(nt,st,lt){return nt*this.redFactor+st*this.greenFactor+lt*this.blueFactor-this.baseShift}getPixels(){return new Lu({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(nt,st,lt){if(this.dim!==nt.dim)throw new Error("dem dimension mismatch");let ft=st*this.dim,vt=st*this.dim+this.dim,xt=lt*this.dim,bt=lt*this.dim+this.dim;switch(st){case-1:ft=vt-1;break;case 1:vt=ft+1}switch(lt){case-1:xt=bt-1;break;case 1:bt=xt+1}const Et=-st*this.dim,Ct=-lt*this.dim;for(let Dt=xt;Dt<bt;Dt++)for(let Vt=ft;Vt<vt;Vt++)this.data[this._idx(Vt,Dt)]=nt.data[this._idx(Vt+Et,Dt+Ct)]}}bs("DEMData",jx);class $x{constructor(nt){this._stringToNumber={},this._numberToString=[];for(let st=0;st<nt.length;st++){const lt=nt[st];this._stringToNumber[lt]=st,this._numberToString[st]=lt}}encode(nt){return this._stringToNumber[nt]}decode(nt){if(nt>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${nt} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[nt]}}class Ux{constructor(nt,st,lt,ft,vt){this.type="Feature",this._vectorTileFeature=nt,nt._z=st,nt._x=lt,nt._y=ft,this.properties=nt.properties,this.id=vt}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(nt){this._geometry=nt}toJSON(){const nt={geometry:this.geometry};for(const st in this)st!=="_geometry"&&st!=="_vectorTileFeature"&&(nt[st]=this[st]);return nt}}class Vx{constructor(nt,st){this.tileID=nt,this.x=nt.canonical.x,this.y=nt.canonical.y,this.z=nt.canonical.z,this.grid=new Kp(ba,16,0),this.grid3D=new Kp(ba,16,0),this.featureIndexArray=new Yl,this.promoteId=st}insert(nt,st,lt,ft,vt,xt){const bt=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(lt,ft,vt);const Et=xt?this.grid3D:this.grid;for(let Ct=0;Ct<st.length;Ct++){const Dt=st[Ct],Vt=[1/0,1/0,-1/0,-1/0];for(let en=0;en<Dt.length;en++){const cn=Dt[en];Vt[0]=Math.min(Vt[0],cn.x),Vt[1]=Math.min(Vt[1],cn.y),Vt[2]=Math.max(Vt[2],cn.x),Vt[3]=Math.max(Vt[3],cn.y)}Vt[0]<ba&&Vt[1]<ba&&Vt[2]>=0&&Vt[3]>=0&&Et.insert(bt,Vt[0],Vt[1],Vt[2],Vt[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new om.VectorTile(new S0(this.rawTileData)).layers,this.sourceLayerCoder=new $x(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(nt,st,lt,ft){this.loadVTLayers();const vt=nt.params||{},xt=ba/nt.tileSize/nt.scale,bt=Rp(vt.filter),Et=nt.queryGeometry,Ct=nt.queryPadding*xt,Dt=Wx(Et),Vt=this.grid.query(Dt.minX-Ct,Dt.minY-Ct,Dt.maxX+Ct,Dt.maxY+Ct),en=Wx(nt.cameraQueryGeometry),cn=this.grid3D.query(en.minX-Ct,en.minY-Ct,en.maxX+Ct,en.maxY+Ct,(Ln,Vn,vr,er)=>function(_r,Ir,Yr,gs,Hs){for(const cs of _r)if(Ir<=cs.x&&Yr<=cs.y&&gs>=cs.x&&Hs>=cs.y)return!0;const hs=[new Lt(Ir,Yr),new Lt(Ir,Hs),new Lt(gs,Hs),new Lt(gs,Yr)];if(_r.length>2){for(const cs of hs)if(Zm(_r,cs))return!0}for(let cs=0;cs<_r.length-1;cs++)if(Y1(_r[cs],_r[cs+1],hs))return!0;return!1}(nt.cameraQueryGeometry,Ln-Ct,Vn-Ct,vr+Ct,er+Ct));for(const Ln of cn)Vt.push(Ln);Vt.sort(yE);const gn={};let bn;for(let Ln=0;Ln<Vt.length;Ln++){const Vn=Vt[Ln];if(Vn===bn)continue;bn=Vn;const vr=this.featureIndexArray.get(Vn);let er=null;this.loadMatchingFeature(gn,vr.bucketIndex,vr.sourceLayerIndex,vr.featureIndex,bt,vt.layers,vt.availableImages,st,lt,ft,(_r,Ir,Yr)=>(er||(er=Em(_r)),Ir.queryIntersectsFeature(Et,_r,Yr,er,this.z,nt.transform,xt,nt.pixelPosMatrix)))}return gn}loadMatchingFeature(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt){const en=this.bucketLayerIDs[st];if(xt&&!function(Ln,Vn){for(let vr=0;vr<Ln.length;vr++)if(Vn.indexOf(Ln[vr])>=0)return!0;return!1}(xt,en))return;const cn=this.sourceLayerCoder.decode(lt),gn=this.vtLayers[cn].feature(ft);if(vt.needGeometry){const Ln=Sm(gn,!0);if(!vt.filter(new Vo(this.tileID.overscaledZ),Ln,this.tileID.canonical))return}else if(!vt.filter(new Vo(this.tileID.overscaledZ),gn))return;const bn=this.getId(gn,cn);for(let Ln=0;Ln<en.length;Ln++){const Vn=en[Ln];if(xt&&xt.indexOf(Vn)<0)continue;const vr=Et[Vn];if(!vr)continue;let er={};bn&&Dt&&(er=Dt.getState(vr.sourceLayer||"_geojsonTileLayer",bn));const _r=mn({},Ct[Vn]);_r.paint=Hx(_r.paint,vr.paint,gn,er,bt),_r.layout=Hx(_r.layout,vr.layout,gn,er,bt);const Ir=!Vt||Vt(gn,vr,er);if(!Ir)continue;const Yr=new Ux(gn,this.z,this.x,this.y,bn);Yr.layer=_r;let gs=nt[Vn];gs===void 0&&(gs=nt[Vn]=[]),gs.push({featureIndex:ft,feature:Yr,intersectionZ:Ir})}}lookupSymbolFeatures(nt,st,lt,ft,vt,xt,bt,Et){const Ct={};this.loadVTLayers();const Dt=Rp(vt);for(const Vt of nt)this.loadMatchingFeature(Ct,lt,ft,Vt,Dt,xt,bt,Et,st);return Ct}hasLayer(nt){for(const st of this.bucketLayerIDs)for(const lt of st)if(nt===lt)return!0;return!1}getId(nt,st){let lt=nt.id;return this.promoteId&&(lt=nt.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[st]],typeof lt=="boolean"&&(lt=Number(lt))),lt}}function Hx(it,nt,st,lt,ft){return Yt(it,(vt,xt)=>{const bt=nt instanceof vm?nt.get(xt):null;return bt&&bt.evaluate?bt.evaluate(st,lt,ft):bt})}function Wx(it){let nt=1/0,st=1/0,lt=-1/0,ft=-1/0;for(const vt of it)nt=Math.min(nt,vt.x),st=Math.min(st,vt.y),lt=Math.max(lt,vt.x),ft=Math.max(ft,vt.y);return{minX:nt,minY:st,maxX:lt,maxY:ft}}function yE(it,nt){return nt-it}function qx(it,nt,st,lt,ft){const vt=[];for(let xt=0;xt<it.length;xt++){const bt=it[xt];let Et;for(let Ct=0;Ct<bt.length-1;Ct++){let Dt=bt[Ct],Vt=bt[Ct+1];Dt.x<nt&&Vt.x<nt||(Dt.x<nt?Dt=new Lt(nt,Dt.y+(nt-Dt.x)/(Vt.x-Dt.x)*(Vt.y-Dt.y))._round():Vt.x<nt&&(Vt=new Lt(nt,Dt.y+(nt-Dt.x)/(Vt.x-Dt.x)*(Vt.y-Dt.y))._round()),Dt.y<st&&Vt.y<st||(Dt.y<st?Dt=new Lt(Dt.x+(st-Dt.y)/(Vt.y-Dt.y)*(Vt.x-Dt.x),st)._round():Vt.y<st&&(Vt=new Lt(Dt.x+(st-Dt.y)/(Vt.y-Dt.y)*(Vt.x-Dt.x),st)._round()),Dt.x>=lt&&Vt.x>=lt||(Dt.x>=lt?Dt=new Lt(lt,Dt.y+(lt-Dt.x)/(Vt.x-Dt.x)*(Vt.y-Dt.y))._round():Vt.x>=lt&&(Vt=new Lt(lt,Dt.y+(lt-Dt.x)/(Vt.x-Dt.x)*(Vt.y-Dt.y))._round()),Dt.y>=ft&&Vt.y>=ft||(Dt.y>=ft?Dt=new Lt(Dt.x+(ft-Dt.y)/(Vt.y-Dt.y)*(Vt.x-Dt.x),ft)._round():Vt.y>=ft&&(Vt=new Lt(Dt.x+(ft-Dt.y)/(Vt.y-Dt.y)*(Vt.x-Dt.x),ft)._round()),Et&&Dt.equals(Et[Et.length-1])||(Et=[Dt],vt.push(Et)),Et.push(Vt)))))}}return vt}bs("FeatureIndex",Vx,{omit:["rawTileData","sourceLayerCoder"]});class um extends Lt{constructor(nt,st,lt,ft){super(nt,st),this.angle=lt,ft!==void 0&&(this.segment=ft)}clone(){return new um(this.x,this.y,this.angle,this.segment)}}function Gx(it,nt,st,lt,ft){if(nt.segment===void 0||st===0)return!0;let vt=nt,xt=nt.segment+1,bt=0;for(;bt>-st/2;){if(xt--,xt<0)return!1;bt-=it[xt].dist(vt),vt=it[xt]}bt+=it[xt].dist(it[xt+1]),xt++;const Et=[];let Ct=0;for(;bt<st/2;){const Dt=it[xt],Vt=it[xt+1];if(!Vt)return!1;let en=it[xt-1].angleTo(Dt)-Dt.angleTo(Vt);for(en=Math.abs((en+3*Math.PI)%(2*Math.PI)-Math.PI),Et.push({distance:bt,angleDelta:en}),Ct+=en;bt-Et[0].distance>lt;)Ct-=Et.shift().angleDelta;if(Ct>ft)return!1;xt++,bt+=Dt.dist(Vt)}return!0}function Xx(it){let nt=0;for(let st=0;st<it.length-1;st++)nt+=it[st].dist(it[st+1]);return nt}function Zx(it,nt,st){return it?.6*nt*st:0}function Kx(it,nt){return Math.max(it?it.right-it.left:0,nt?nt.right-nt.left:0)}function vE(it,nt,st,lt,ft,vt){const xt=Zx(st,ft,vt),bt=Kx(st,lt)*vt;let Et=0;const Ct=Xx(it)/2;for(let Dt=0;Dt<it.length-1;Dt++){const Vt=it[Dt],en=it[Dt+1],cn=Vt.dist(en);if(Et+cn>Ct){const gn=(Ct-Et)/cn,bn=Fl.number(Vt.x,en.x,gn),Ln=Fl.number(Vt.y,en.y,gn),Vn=new um(bn,Ln,en.angleTo(Vt),Dt);return Vn._round(),!xt||Gx(it,Vn,bt,xt,nt)?Vn:void 0}Et+=cn}}function xE(it,nt,st,lt,ft,vt,xt,bt,Et){const Ct=Zx(lt,vt,xt),Dt=Kx(lt,ft),Vt=Dt*xt,en=it[0].x===0||it[0].x===Et||it[0].y===0||it[0].y===Et;return nt-Vt<nt/4&&(nt=Vt+nt/4),Yx(it,en?nt/2*bt%nt:(Dt/2+2*vt)*xt*bt%nt,nt,Ct,st,Vt,en,!1,Et)}function Yx(it,nt,st,lt,ft,vt,xt,bt,Et){const Ct=vt/2,Dt=Xx(it);let Vt=0,en=nt-st,cn=[];for(let gn=0;gn<it.length-1;gn++){const bn=it[gn],Ln=it[gn+1],Vn=bn.dist(Ln),vr=Ln.angleTo(bn);for(;en+st<Vt+Vn;){en+=st;const er=(en-Vt)/Vn,_r=Fl.number(bn.x,Ln.x,er),Ir=Fl.number(bn.y,Ln.y,er);if(_r>=0&&_r<Et&&Ir>=0&&Ir<Et&&en-Ct>=0&&en+Ct<=Dt){const Yr=new um(_r,Ir,vr,gn);Yr._round(),lt&&!Gx(it,Yr,vt,lt,ft)||cn.push(Yr)}}Vt+=Vn}return bt||cn.length||xt||(cn=Yx(it,Vt/2,st,lt,ft,vt,xt,!0,Et)),cn}bs("Anchor",um);const n_=yu;function Jx(it,nt,st,lt){const ft=[],vt=it.image,xt=vt.pixelRatio,bt=vt.paddedRect.w-2*n_,Et=vt.paddedRect.h-2*n_;let Ct={x1:it.left,y1:it.top,x2:it.right,y2:it.bottom};const Dt=vt.stretchX||[[0,bt]],Vt=vt.stretchY||[[0,Et]],en=(Hr,Os)=>Hr+Os[1]-Os[0],cn=Dt.reduce(en,0),gn=Vt.reduce(en,0),bn=bt-cn,Ln=Et-gn;let Vn=0,vr=cn,er=0,_r=gn,Ir=0,Yr=bn,gs=0,Hs=Ln;if(vt.content&&lt){const Hr=vt.content,Os=Hr[2]-Hr[0],Ds=Hr[3]-Hr[1];(vt.textFitWidth||vt.textFitHeight)&&(Ct=Ax(it)),Vn=My(Dt,0,Hr[0]),er=My(Vt,0,Hr[1]),vr=My(Dt,Hr[0],Hr[2]),_r=My(Vt,Hr[1],Hr[3]),Ir=Hr[0]-Vn,gs=Hr[1]-er,Yr=Os-vr,Hs=Ds-_r}const hs=Ct.x1,cs=Ct.y1,Ls=Ct.x2-hs,As=Ct.y2-cs,xs=(Hr,Os,Ds,eo)=>{const No=Iy(Hr.stretch-Vn,vr,Ls,hs),zo=Dy(Hr.fixed-Ir,Yr,Hr.stretch,cn),Sl=Iy(Os.stretch-er,_r,As,cs),qu=Dy(Os.fixed-gs,Hs,Os.stretch,gn),Vl=Iy(Ds.stretch-Vn,vr,Ls,hs),Al=Dy(Ds.fixed-Ir,Yr,Ds.stretch,cn),au=Iy(eo.stretch-er,_r,As,cs),lu=Dy(eo.fixed-gs,Hs,eo.stretch,gn),cu=new Lt(No,Sl),ga=new Lt(Vl,Sl),Tl=new Lt(Vl,au),Ql=new Lt(No,au),Hl=new Lt(zo/xt,qu/xt),uu=new Lt(Al/xt,lu/xt),Wl=nt*Math.PI/180;if(Wl){const ko=Math.sin(Wl),jo=Math.cos(Wl),Go=[jo,-ko,ko,jo];cu._matMult(Go),ga._matMult(Go),Ql._matMult(Go),Tl._matMult(Go)}const Ou=Hr.stretch+Hr.fixed,vu=Os.stretch+Os.fixed;return{tl:cu,tr:ga,bl:Ql,br:Tl,tex:{x:vt.paddedRect.x+n_+Ou,y:vt.paddedRect.y+n_+vu,w:Ds.stretch+Ds.fixed-Ou,h:eo.stretch+eo.fixed-vu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hl,pixelOffsetBR:uu,minFontScaleX:Yr/xt/Ls,minFontScaleY:Hs/xt/As,isSDF:st}};if(lt&&(vt.stretchX||vt.stretchY)){const Hr=Qx(Dt,bn,cn),Os=Qx(Vt,Ln,gn);for(let Ds=0;Ds<Hr.length-1;Ds++){const eo=Hr[Ds],No=Hr[Ds+1];for(let zo=0;zo<Os.length-1;zo++)ft.push(xs(eo,Os[zo],No,Os[zo+1]))}}else ft.push(xs({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:bt+1},{fixed:0,stretch:Et+1}));return ft}function My(it,nt,st){let lt=0;for(const ft of it)lt+=Math.max(nt,Math.min(st,ft[1]))-Math.max(nt,Math.min(st,ft[0]));return lt}function Qx(it,nt,st){const lt=[{fixed:-n_,stretch:0}];for(const[ft,vt]of it){const xt=lt[lt.length-1];lt.push({fixed:ft-xt.stretch,stretch:xt.stretch}),lt.push({fixed:ft-xt.stretch,stretch:xt.stretch+(vt-ft)})}return lt.push({fixed:nt+n_,stretch:st}),lt}function Iy(it,nt,st,lt){return it/nt*st+lt}function Dy(it,nt,st,lt){return it-nt*st/lt}class Ly{constructor(nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt){var Vt;if(this.boxStartIndex=nt.length,Ct){let en=xt.top,cn=xt.bottom;const gn=xt.collisionPadding;gn&&(en-=gn[1],cn+=gn[3]);let bn=cn-en;bn>0&&(bn=Math.max(10,bn),this.circleDiameter=bn)}else{const en=!((Vt=xt.image)===null||Vt===void 0)&&Vt.content&&(xt.image.textFitWidth||xt.image.textFitHeight)?Ax(xt):{x1:xt.left,y1:xt.top,x2:xt.right,y2:xt.bottom};en.y1=en.y1*bt-Et[0],en.y2=en.y2*bt+Et[2],en.x1=en.x1*bt-Et[3],en.x2=en.x2*bt+Et[1];const cn=xt.collisionPadding;if(cn&&(en.x1-=cn[0]*bt,en.y1-=cn[1]*bt,en.x2+=cn[2]*bt,en.y2+=cn[3]*bt),Dt){const gn=new Lt(en.x1,en.y1),bn=new Lt(en.x2,en.y1),Ln=new Lt(en.x1,en.y2),Vn=new Lt(en.x2,en.y2),vr=Dt*Math.PI/180;gn._rotate(vr),bn._rotate(vr),Ln._rotate(vr),Vn._rotate(vr),en.x1=Math.min(gn.x,bn.x,Ln.x,Vn.x),en.x2=Math.max(gn.x,bn.x,Ln.x,Vn.x),en.y1=Math.min(gn.y,bn.y,Ln.y,Vn.y),en.y2=Math.max(gn.y,bn.y,Ln.y,Vn.y)}nt.emplaceBack(st.x,st.y,en.x1,en.y1,en.x2,en.y2,lt,ft,vt)}this.boxEndIndex=nt.length}}class bE{constructor(nt=[],st=(lt,ft)=>lt<ft?-1:lt>ft?1:0){if(this.data=nt,this.length=this.data.length,this.compare=st,this.length>0)for(let lt=(this.length>>1)-1;lt>=0;lt--)this._down(lt)}push(nt){this.data.push(nt),this._up(this.length++)}pop(){if(this.length===0)return;const nt=this.data[0],st=this.data.pop();return--this.length>0&&(this.data[0]=st,this._down(0)),nt}peek(){return this.data[0]}_up(nt){const{data:st,compare:lt}=this,ft=st[nt];for(;nt>0;){const vt=nt-1>>1,xt=st[vt];if(lt(ft,xt)>=0)break;st[nt]=xt,nt=vt}st[nt]=ft}_down(nt){const{data:st,compare:lt}=this,ft=this.length>>1,vt=st[nt];for(;nt<ft;){let xt=1+(nt<<1);const bt=xt+1;if(bt<this.length&&lt(st[bt],st[xt])<0&&(xt=bt),lt(st[xt],vt)>=0)break;st[nt]=st[xt],nt=xt}st[nt]=vt}}function wE(it,nt=1,st=!1){let lt=1/0,ft=1/0,vt=-1/0,xt=-1/0;const bt=it[0];for(let cn=0;cn<bt.length;cn++){const gn=bt[cn];(!cn||gn.x<lt)&&(lt=gn.x),(!cn||gn.y<ft)&&(ft=gn.y),(!cn||gn.x>vt)&&(vt=gn.x),(!cn||gn.y>xt)&&(xt=gn.y)}const Et=Math.min(vt-lt,xt-ft);let Ct=Et/2;const Dt=new bE([],EE);if(Et===0)return new Lt(lt,ft);for(let cn=lt;cn<vt;cn+=Et)for(let gn=ft;gn<xt;gn+=Et)Dt.push(new i_(cn+Ct,gn+Ct,Ct,it));let Vt=function(cn){let gn=0,bn=0,Ln=0;const Vn=cn[0];for(let vr=0,er=Vn.length,_r=er-1;vr<er;_r=vr++){const Ir=Vn[vr],Yr=Vn[_r],gs=Ir.x*Yr.y-Yr.x*Ir.y;bn+=(Ir.x+Yr.x)*gs,Ln+=(Ir.y+Yr.y)*gs,gn+=3*gs}return new i_(bn/gn,Ln/gn,0,cn)}(it),en=Dt.length;for(;Dt.length;){const cn=Dt.pop();(cn.d>Vt.d||!Vt.d)&&(Vt=cn,st&&console.log("found best %d after %d probes",Math.round(1e4*cn.d)/1e4,en)),cn.max-Vt.d<=nt||(Ct=cn.h/2,Dt.push(new i_(cn.p.x-Ct,cn.p.y-Ct,Ct,it)),Dt.push(new i_(cn.p.x+Ct,cn.p.y-Ct,Ct,it)),Dt.push(new i_(cn.p.x-Ct,cn.p.y+Ct,Ct,it)),Dt.push(new i_(cn.p.x+Ct,cn.p.y+Ct,Ct,it)),en+=4)}return st&&(console.log(`num probes: ${en}`),console.log(`best distance: ${Vt.d}`)),Vt.p}function EE(it,nt){return nt.max-it.max}function i_(it,nt,st,lt){this.p=new Lt(it,nt),this.h=st,this.d=function(ft,vt){let xt=!1,bt=1/0;for(let Et=0;Et<vt.length;Et++){const Ct=vt[Et];for(let Dt=0,Vt=Ct.length,en=Vt-1;Dt<Vt;en=Dt++){const cn=Ct[Dt],gn=Ct[en];cn.y>ft.y!=gn.y>ft.y&&ft.x<(gn.x-cn.x)*(ft.y-cn.y)/(gn.y-cn.y)+cn.x&&(xt=!xt),bt=Math.min(bt,Ov(ft,cn,gn))}}return(xt?1:-1)*Math.sqrt(bt)}(this.p,lt),this.max=this.d+this.h*Math.SQRT2}var Ul;yt.aq=void 0,(Ul=yt.aq||(yt.aq={}))[Ul.center=1]="center",Ul[Ul.left=2]="left",Ul[Ul.right=3]="right",Ul[Ul.top=4]="top",Ul[Ul.bottom=5]="bottom",Ul[Ul["top-left"]=6]="top-left",Ul[Ul["top-right"]=7]="top-right",Ul[Ul["bottom-left"]=8]="bottom-left",Ul[Ul["bottom-right"]=9]="bottom-right";const hm=7,z0=Number.POSITIVE_INFINITY;function _b(it,nt){return nt[1]!==z0?function(st,lt,ft){let vt=0,xt=0;switch(lt=Math.abs(lt),ft=Math.abs(ft),st){case"top-right":case"top-left":case"top":xt=ft-hm;break;case"bottom-right":case"bottom-left":case"bottom":xt=-ft+hm}switch(st){case"top-right":case"bottom-right":case"right":vt=-lt;break;case"top-left":case"bottom-left":case"left":vt=lt}return[vt,xt]}(it,nt[0],nt[1]):function(st,lt){let ft=0,vt=0;lt<0&&(lt=0);const xt=lt/Math.SQRT2;switch(st){case"top-right":case"top-left":vt=xt-hm;break;case"bottom-right":case"bottom-left":vt=-xt+hm;break;case"bottom":vt=-lt+hm;break;case"top":vt=lt-hm}switch(st){case"top-right":case"bottom-right":ft=-xt;break;case"top-left":case"bottom-left":ft=xt;break;case"left":ft=lt;break;case"right":ft=-lt}return[ft,vt]}(it,nt[0])}function e1(it,nt,st){var lt;const ft=it.layout,vt=(lt=ft.get("text-variable-anchor-offset"))===null||lt===void 0?void 0:lt.evaluate(nt,{},st);if(vt){const bt=vt.values,Et=[];for(let Ct=0;Ct<bt.length;Ct+=2){const Dt=Et[Ct]=bt[Ct],Vt=bt[Ct+1].map(en=>en*_l);Dt.startsWith("top")?Vt[1]-=hm:Dt.startsWith("bottom")&&(Vt[1]+=hm),Et[Ct+1]=Vt}return new tu(Et)}const xt=ft.get("text-variable-anchor");if(xt){let bt;bt=it._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[ft.get("text-radial-offset").evaluate(nt,{},st)*_l,z0]:ft.get("text-offset").evaluate(nt,{},st).map(Ct=>Ct*_l);const Et=[];for(const Ct of xt)Et.push(Ct,_b(Ct,bt));return new tu(Et)}return null}function N0(it){switch(it){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function SE(it,nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt){let Vt=vt.textMaxSize.evaluate(nt,{});Vt===void 0&&(Vt=xt);const en=it.layers[0].layout,cn=en.get("icon-offset").evaluate(nt,{},Dt),gn=n1(st.horizontal),bn=xt/24,Ln=it.tilePixelRatio*bn,Vn=it.tilePixelRatio*Vt/24,vr=it.tilePixelRatio*bt,er=it.tilePixelRatio*en.get("symbol-spacing"),_r=en.get("text-padding")*it.tilePixelRatio,Ir=function(Hr,Os,Ds,eo=1){const No=Hr.get("icon-padding").evaluate(Os,{},Ds),zo=No&&No.values;return[zo[0]*eo,zo[1]*eo,zo[2]*eo,zo[3]*eo]}(en,nt,Dt,it.tilePixelRatio),Yr=en.get("text-max-angle")/180*Math.PI,gs=en.get("text-rotation-alignment")!=="viewport"&&en.get("symbol-placement")!=="point",Hs=en.get("icon-rotation-alignment")==="map"&&en.get("symbol-placement")!=="point",hs=en.get("symbol-placement"),cs=er/2,Ls=en.get("icon-text-fit");let As;lt&&Ls!=="none"&&(it.allowVerticalPlacement&&st.vertical&&(As=Tx(lt,st.vertical,Ls,en.get("icon-text-fit-padding"),cn,bn)),gn&&(lt=Tx(lt,gn,Ls,en.get("icon-text-fit-padding"),cn,bn)));const xs=(Hr,Os)=>{Os.x<0||Os.x>=ba||Os.y<0||Os.y>=ba||function(Ds,eo,No,zo,Sl,qu,Vl,Al,au,lu,cu,ga,Tl,Ql,Hl,uu,Wl,Ou,vu,ko,jo,Go,Cu,Qo,r_){const fp=Ds.addToLineVertexArray(eo,No);let mp,Gu,zu,Ll,Np=0,J_=0,o1=0,a1=0,q0=-1,G0=-1;const Bp={};let l1=Wm("");if(Ds.allowVerticalPlacement&&zo.vertical){const _c=Al.layout.get("text-rotate").evaluate(jo,{},Qo)+90;zu=new Ly(au,eo,lu,cu,ga,zo.vertical,Tl,Ql,Hl,_c),Vl&&(Ll=new Ly(au,eo,lu,cu,ga,Vl,Wl,Ou,Hl,_c))}if(Sl){const _c=Al.layout.get("icon-rotate").evaluate(jo,{}),Nu=Al.layout.get("icon-text-fit")!=="none",Tm=Jx(Sl,_c,Cu,Nu),tp=Vl?Jx(Vl,_c,Cu,Nu):void 0;Gu=new Ly(au,eo,lu,cu,ga,Sl,Wl,Ou,!1,_c),Np=4*Tm.length;const Cm=Ds.iconSizeData;let gp=null;Cm.kind==="source"?(gp=[pp*Al.layout.get("icon-size").evaluate(jo,{})],gp[0]>lm&&Xn(`${Ds.layerIds[0]}: Value for "icon-size" is >= ${G_}. Reduce your "icon-size".`)):Cm.kind==="composite"&&(gp=[pp*Go.compositeIconSizes[0].evaluate(jo,{},Qo),pp*Go.compositeIconSizes[1].evaluate(jo,{},Qo)],(gp[0]>lm||gp[1]>lm)&&Xn(`${Ds.layerIds[0]}: Value for "icon-size" is >= ${G_}. Reduce your "icon-size".`)),Ds.addSymbols(Ds.icon,Tm,gp,ko,vu,jo,yt.ah.none,eo,fp.lineStartIndex,fp.lineLength,-1,Qo),q0=Ds.icon.placedSymbolArray.length-1,tp&&(J_=4*tp.length,Ds.addSymbols(Ds.icon,tp,gp,ko,vu,jo,yt.ah.vertical,eo,fp.lineStartIndex,fp.lineLength,-1,Qo),G0=Ds.icon.placedSymbolArray.length-1)}const c1=Object.keys(zo.horizontal);for(const _c of c1){const Nu=zo.horizontal[_c];if(!mp){l1=Wm(Nu.text);const tp=Al.layout.get("text-rotate").evaluate(jo,{},Qo);mp=new Ly(au,eo,lu,cu,ga,Nu,Tl,Ql,Hl,tp)}const Tm=Nu.positionedLines.length===1;if(o1+=t1(Ds,eo,Nu,qu,Al,Hl,jo,uu,fp,zo.vertical?yt.ah.horizontal:yt.ah.horizontalOnly,Tm?c1:[_c],Bp,q0,Go,Qo),Tm)break}zo.vertical&&(a1+=t1(Ds,eo,zo.vertical,qu,Al,Hl,jo,uu,fp,yt.ah.vertical,["vertical"],Bp,G0,Go,Qo));const CE=mp?mp.boxStartIndex:Ds.collisionBoxArray.length,kE=mp?mp.boxEndIndex:Ds.collisionBoxArray.length,PE=zu?zu.boxStartIndex:Ds.collisionBoxArray.length,RE=zu?zu.boxEndIndex:Ds.collisionBoxArray.length,ME=Gu?Gu.boxStartIndex:Ds.collisionBoxArray.length,IE=Gu?Gu.boxEndIndex:Ds.collisionBoxArray.length,DE=Ll?Ll.boxStartIndex:Ds.collisionBoxArray.length,LE=Ll?Ll.boxEndIndex:Ds.collisionBoxArray.length;let ep=-1;const Oy=(_c,Nu)=>_c&&_c.circleDiameter?Math.max(_c.circleDiameter,Nu):Nu;ep=Oy(mp,ep),ep=Oy(zu,ep),ep=Oy(Gu,ep),ep=Oy(Ll,ep);const u1=ep>-1?1:0;u1&&(ep*=r_/_l),Ds.glyphOffsetArray.length>=t_.MAX_GLYPHS&&Xn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jo.sortKey!==void 0&&Ds.addToSortKeyRanges(Ds.symbolInstances.length,jo.sortKey);const FE=e1(Al,jo,Qo),[OE,zE]=function(_c,Nu){const Tm=_c.length,tp=Nu==null?void 0:Nu.values;if((tp==null?void 0:tp.length)>0)for(let Cm=0;Cm<tp.length;Cm+=2){const gp=tp[Cm+1];_c.emplaceBack(yt.aq[tp[Cm]],gp[0],gp[1])}return[Tm,_c.length]}(Ds.textAnchorOffsets,FE);Ds.symbolInstances.emplaceBack(eo.x,eo.y,Bp.right>=0?Bp.right:-1,Bp.center>=0?Bp.center:-1,Bp.left>=0?Bp.left:-1,Bp.vertical||-1,q0,G0,l1,CE,kE,PE,RE,ME,IE,DE,LE,lu,o1,a1,Np,J_,u1,0,Tl,ep,OE,zE)}(it,Os,Hr,st,lt,ft,As,it.layers[0],it.collisionBoxArray,nt.index,nt.sourceLayerIndex,it.index,Ln,[_r,_r,_r,_r],gs,Et,vr,Ir,Hs,cn,nt,vt,Ct,Dt,xt)};if(hs==="line")for(const Hr of qx(nt.geometry,0,0,ba,ba)){const Os=xE(Hr,er,Yr,st.vertical||gn,lt,24,Vn,it.overscaling,ba);for(const Ds of Os)gn&&AE(it,gn.text,cs,Ds)||xs(Hr,Ds)}else if(hs==="line-center"){for(const Hr of nt.geometry)if(Hr.length>1){const Os=vE(Hr,Yr,st.vertical||gn,lt,24,Vn);Os&&xs(Hr,Os)}}else if(nt.type==="Polygon")for(const Hr of Fo(nt.geometry,0)){const Os=wE(Hr,16);xs(Hr[0],new um(Os.x,Os.y,0))}else if(nt.type==="LineString")for(const Hr of nt.geometry)xs(Hr,new um(Hr[0].x,Hr[0].y,0));else if(nt.type==="Point")for(const Hr of nt.geometry)for(const Os of Hr)xs([Os],new um(Os.x,Os.y,0))}function t1(it,nt,st,lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn){const bn=function(vr,er,_r,Ir,Yr,gs,Hs,hs){const cs=Ir.layout.get("text-rotate").evaluate(gs,{})*Math.PI/180,Ls=[];for(const As of er.positionedLines)for(const xs of As.positionedGlyphs){if(!xs.rect)continue;const Hr=xs.rect||{};let Os=yx+1,Ds=!0,eo=1,No=0;const zo=(Yr||hs)&&xs.vertical,Sl=xs.metrics.advance*xs.scale/2;if(hs&&er.verticalizable&&(No=As.lineOffset/2-(xs.imageName?-(_l-xs.metrics.width*xs.scale)/2:(xs.scale-1)*_l)),xs.imageName){const ko=Hs[xs.imageName];Ds=ko.sdf,eo=ko.pixelRatio,Os=yu/eo}const qu=Yr?[xs.x+Sl,xs.y]:[0,0];let Vl=Yr?[0,0]:[xs.x+Sl+_r[0],xs.y+_r[1]-No],Al=[0,0];zo&&(Al=Vl,Vl=[0,0]);const au=xs.metrics.isDoubleResolution?2:1,lu=(xs.metrics.left-Os)*xs.scale-Sl+Vl[0],cu=(-xs.metrics.top-Os)*xs.scale+Vl[1],ga=lu+Hr.w/au*xs.scale/eo,Tl=cu+Hr.h/au*xs.scale/eo,Ql=new Lt(lu,cu),Hl=new Lt(ga,cu),uu=new Lt(lu,Tl),Wl=new Lt(ga,Tl);if(zo){const ko=new Lt(-Sl,Sl-W_),jo=-Math.PI/2,Go=_l/2-Sl,Cu=new Lt(5-W_-Go,-(xs.imageName?Go:0)),Qo=new Lt(...Al);Ql._rotateAround(jo,ko)._add(Cu)._add(Qo),Hl._rotateAround(jo,ko)._add(Cu)._add(Qo),uu._rotateAround(jo,ko)._add(Cu)._add(Qo),Wl._rotateAround(jo,ko)._add(Cu)._add(Qo)}if(cs){const ko=Math.sin(cs),jo=Math.cos(cs),Go=[jo,-ko,ko,jo];Ql._matMult(Go),Hl._matMult(Go),uu._matMult(Go),Wl._matMult(Go)}const Ou=new Lt(0,0),vu=new Lt(0,0);Ls.push({tl:Ql,tr:Hl,bl:uu,br:Wl,tex:Hr,writingMode:er.writingMode,glyphOffset:qu,sectionIndex:xs.sectionIndex,isSDF:Ds,pixelOffsetTL:Ou,pixelOffsetBR:vu,minFontScaleX:0,minFontScaleY:0})}return Ls}(0,st,bt,ft,vt,xt,lt,it.allowVerticalPlacement),Ln=it.textSizeData;let Vn=null;Ln.kind==="source"?(Vn=[pp*ft.layout.get("text-size").evaluate(xt,{})],Vn[0]>lm&&Xn(`${it.layerIds[0]}: Value for "text-size" is >= ${G_}. Reduce your "text-size".`)):Ln.kind==="composite"&&(Vn=[pp*cn.compositeTextSizes[0].evaluate(xt,{},gn),pp*cn.compositeTextSizes[1].evaluate(xt,{},gn)],(Vn[0]>lm||Vn[1]>lm)&&Xn(`${it.layerIds[0]}: Value for "text-size" is >= ${G_}. Reduce your "text-size".`)),it.addSymbols(it.text,bn,Vn,bt,vt,xt,Ct,nt,Et.lineStartIndex,Et.lineLength,en,gn);for(const vr of Dt)Vt[vr]=it.text.placedSymbolArray.length-1;return 4*bn.length}function n1(it){for(const nt in it)return it[nt];return null}function AE(it,nt,st,lt){const ft=it.compareText;if(nt in ft){const vt=ft[nt];for(let xt=vt.length-1;xt>=0;xt--)if(lt.dist(vt[xt])<st)return!0}else ft[nt]=[];return ft[nt].push(lt),!1}const i1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class B0{static from(nt){if(!(nt instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[st,lt]=new Uint8Array(nt,0,2);if(st!==219)throw new Error("Data does not appear to be in a KDBush format.");const ft=lt>>4;if(ft!==1)throw new Error(`Got v${ft} data when expected v1.`);const vt=i1[15&lt];if(!vt)throw new Error("Unrecognized array type.");const[xt]=new Uint16Array(nt,2,1),[bt]=new Uint32Array(nt,4,1);return new B0(bt,xt,vt,nt)}constructor(nt,st=64,lt=Float64Array,ft){if(isNaN(nt)||nt<0)throw new Error(`Unpexpected numItems value: ${nt}.`);this.numItems=+nt,this.nodeSize=Math.min(Math.max(+st,2),65535),this.ArrayType=lt,this.IndexArrayType=nt<65536?Uint16Array:Uint32Array;const vt=i1.indexOf(this.ArrayType),xt=2*nt*this.ArrayType.BYTES_PER_ELEMENT,bt=nt*this.IndexArrayType.BYTES_PER_ELEMENT,Et=(8-bt%8)%8;if(vt<0)throw new Error(`Unexpected typed array class: ${lt}.`);ft&&ft instanceof ArrayBuffer?(this.data=ft,this.ids=new this.IndexArrayType(this.data,8,nt),this.coords=new this.ArrayType(this.data,8+bt+Et,2*nt),this._pos=2*nt,this._finished=!0):(this.data=new ArrayBuffer(8+xt+bt+Et),this.ids=new this.IndexArrayType(this.data,8,nt),this.coords=new this.ArrayType(this.data,8+bt+Et,2*nt),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+vt]),new Uint16Array(this.data,2,1)[0]=st,new Uint32Array(this.data,4,1)[0]=nt)}add(nt,st){const lt=this._pos>>1;return this.ids[lt]=lt,this.coords[this._pos++]=nt,this.coords[this._pos++]=st,lt}finish(){const nt=this._pos>>1;if(nt!==this.numItems)throw new Error(`Added ${nt} items when expected ${this.numItems}.`);return j0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(nt,st,lt,ft){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:vt,coords:xt,nodeSize:bt}=this,Et=[0,vt.length-1,0],Ct=[];for(;Et.length;){const Dt=Et.pop()||0,Vt=Et.pop()||0,en=Et.pop()||0;if(Vt-en<=bt){for(let Ln=en;Ln<=Vt;Ln++){const Vn=xt[2*Ln],vr=xt[2*Ln+1];Vn>=nt&&Vn<=lt&&vr>=st&&vr<=ft&&Ct.push(vt[Ln])}continue}const cn=en+Vt>>1,gn=xt[2*cn],bn=xt[2*cn+1];gn>=nt&&gn<=lt&&bn>=st&&bn<=ft&&Ct.push(vt[cn]),(Dt===0?nt<=gn:st<=bn)&&(Et.push(en),Et.push(cn-1),Et.push(1-Dt)),(Dt===0?lt>=gn:ft>=bn)&&(Et.push(cn+1),Et.push(Vt),Et.push(1-Dt))}return Ct}within(nt,st,lt){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:ft,coords:vt,nodeSize:xt}=this,bt=[0,ft.length-1,0],Et=[],Ct=lt*lt;for(;bt.length;){const Dt=bt.pop()||0,Vt=bt.pop()||0,en=bt.pop()||0;if(Vt-en<=xt){for(let Ln=en;Ln<=Vt;Ln++)s1(vt[2*Ln],vt[2*Ln+1],nt,st)<=Ct&&Et.push(ft[Ln]);continue}const cn=en+Vt>>1,gn=vt[2*cn],bn=vt[2*cn+1];s1(gn,bn,nt,st)<=Ct&&Et.push(ft[cn]),(Dt===0?nt-lt<=gn:st-lt<=bn)&&(bt.push(en),bt.push(cn-1),bt.push(1-Dt)),(Dt===0?nt+lt>=gn:st+lt>=bn)&&(bt.push(cn+1),bt.push(Vt),bt.push(1-Dt))}return Et}}function j0(it,nt,st,lt,ft,vt){if(ft-lt<=st)return;const xt=lt+ft>>1;r1(it,nt,xt,lt,ft,vt),j0(it,nt,st,lt,xt-1,1-vt),j0(it,nt,st,xt+1,ft,1-vt)}function r1(it,nt,st,lt,ft,vt){for(;ft>lt;){if(ft-lt>600){const Ct=ft-lt+1,Dt=st-lt+1,Vt=Math.log(Ct),en=.5*Math.exp(2*Vt/3),cn=.5*Math.sqrt(Vt*en*(Ct-en)/Ct)*(Dt-Ct/2<0?-1:1);r1(it,nt,st,Math.max(lt,Math.floor(st-Dt*en/Ct+cn)),Math.min(ft,Math.floor(st+(Ct-Dt)*en/Ct+cn)),vt)}const xt=nt[2*st+vt];let bt=lt,Et=ft;for(K_(it,nt,lt,st),nt[2*ft+vt]>xt&&K_(it,nt,lt,ft);bt<Et;){for(K_(it,nt,bt,Et),bt++,Et--;nt[2*bt+vt]<xt;)bt++;for(;nt[2*Et+vt]>xt;)Et--}nt[2*lt+vt]===xt?K_(it,nt,lt,Et):(Et++,K_(it,nt,Et,ft)),Et<=st&&(lt=Et+1),st<=Et&&(ft=Et-1)}}function K_(it,nt,st,lt){$0(it,st,lt),$0(nt,2*st,2*lt),$0(nt,2*st+1,2*lt+1)}function $0(it,nt,st){const lt=it[nt];it[nt]=it[st],it[st]=lt}function s1(it,nt,st,lt){const ft=it-st,vt=nt-lt;return ft*ft+vt*vt}var U0;yt.bg=void 0,(U0=yt.bg||(yt.bg={})).create="create",U0.load="load",U0.fullLoad="fullLoad";let Fy=null,Y_=[];const V0=1e3/60,H0="loadTime",W0="fullLoadTime",TE={mark(it){performance.mark(it)},frame(it){const nt=it;Fy!=null&&Y_.push(nt-Fy),Fy=nt},clearMetrics(){Fy=null,Y_=[],performance.clearMeasures(H0),performance.clearMeasures(W0);for(const it in yt.bg)performance.clearMarks(yt.bg[it])},getPerformanceMetrics(){performance.measure(H0,yt.bg.create,yt.bg.load),performance.measure(W0,yt.bg.create,yt.bg.fullLoad);const it=performance.getEntriesByName(H0)[0].duration,nt=performance.getEntriesByName(W0)[0].duration,st=Y_.length,lt=1/(Y_.reduce((vt,xt)=>vt+xt,0)/st/1e3),ft=Y_.filter(vt=>vt>V0).reduce((vt,xt)=>vt+(xt-V0)/V0,0);return{loadTime:it,fullLoadTime:nt,fps:lt,percentDroppedFrames:ft/(st+ft)*100,totalFrames:st}}};yt.$=class extends Gt{},yt.A=Km,yt.B=Qy,yt.C=function(it){if(gr==null){const nt=it.navigator?it.navigator.userAgent:null;gr=!!it.safari||!(!nt||!(/\b(iPad|iPhone|iPod)\b/.test(nt)||nt.match("Safari")&&!nt.match("Chrome")))}return gr},yt.D=Ps,yt.E=Rr,yt.F=class{constructor(it,nt){this.target=it,this.mapId=nt,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _E(()=>this.process()),this.subscription=function(st,lt,ft,vt){return st.addEventListener(lt,ft,!1),{unsubscribe:()=>{st.removeEventListener(lt,ft,!1)}}}(this.target,"message",st=>this.receive(st)),this.globalScope=_i(self)?it:window}registerMessageHandler(it,nt){this.messageHandlers[it]=nt}sendAsync(it,nt){return new Promise((st,lt)=>{const ft=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[ft]={resolve:st,reject:lt},nt&&nt.signal.addEventListener("abort",()=>{delete this.resolveRejects[ft];const bt={id:ft,type:"<cancel>",origin:location.origin,targetMapId:it.targetMapId,sourceMapId:this.mapId};this.target.postMessage(bt)},{once:!0});const vt=[],xt=Object.assign(Object.assign({},it),{id:ft,sourceMapId:this.mapId,origin:location.origin,data:Yp(it.data,vt)});this.target.postMessage(xt,{transfer:vt})})}receive(it){const nt=it.data,st=nt.id;if(!(nt.origin!=="file://"&&location.origin!=="file://"&&nt.origin!=="resource://android"&&location.origin!=="resource://android"&&nt.origin!==location.origin||nt.targetMapId&&this.mapId!==nt.targetMapId)){if(nt.type==="<cancel>"){delete this.tasks[st];const lt=this.abortControllers[st];return delete this.abortControllers[st],void(lt&&lt.abort())}if(_i(self)||nt.mustQueue)return this.tasks[st]=nt,this.taskQueue.push(st),void this.invoker.trigger();this.processTask(st,nt)}}process(){if(this.taskQueue.length===0)return;const it=this.taskQueue.shift(),nt=this.tasks[it];delete this.tasks[it],this.taskQueue.length>0&&this.invoker.trigger(),nt&&this.processTask(it,nt)}processTask(it,nt){return ct(this,void 0,void 0,function*(){if(nt.type==="<response>"){const ft=this.resolveRejects[it];return delete this.resolveRejects[it],ft?void(nt.error?ft.reject(Jp(nt.error)):ft.resolve(Jp(nt.data))):void 0}if(!this.messageHandlers[nt.type])return void this.completeTask(it,new Error(`Could not find a registered handler for ${nt.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const st=Jp(nt.data),lt=new AbortController;this.abortControllers[it]=lt;try{const ft=yield this.messageHandlers[nt.type](nt.sourceMapId,st,lt);this.completeTask(it,null,ft)}catch(ft){this.completeTask(it,ft)}})}completeTask(it,nt,st){const lt=[];delete this.abortControllers[it];const ft={id:it,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:nt?Yp(nt):null,data:Yp(st,lt)};this.target.postMessage(ft,{transfer:lt})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},yt.G=$t,yt.H=function(){var it=new Km(16);return Km!=Float32Array&&(it[1]=0,it[2]=0,it[3]=0,it[4]=0,it[6]=0,it[7]=0,it[8]=0,it[9]=0,it[11]=0,it[12]=0,it[13]=0,it[14]=0),it[0]=1,it[5]=1,it[10]=1,it[15]=1,it},yt.I=T0,yt.J=function(it,nt,st){var lt,ft,vt,xt,bt,Et,Ct,Dt,Vt,en,cn,gn,bn=st[0],Ln=st[1],Vn=st[2];return nt===it?(it[12]=nt[0]*bn+nt[4]*Ln+nt[8]*Vn+nt[12],it[13]=nt[1]*bn+nt[5]*Ln+nt[9]*Vn+nt[13],it[14]=nt[2]*bn+nt[6]*Ln+nt[10]*Vn+nt[14],it[15]=nt[3]*bn+nt[7]*Ln+nt[11]*Vn+nt[15]):(ft=nt[1],vt=nt[2],xt=nt[3],bt=nt[4],Et=nt[5],Ct=nt[6],Dt=nt[7],Vt=nt[8],en=nt[9],cn=nt[10],gn=nt[11],it[0]=lt=nt[0],it[1]=ft,it[2]=vt,it[3]=xt,it[4]=bt,it[5]=Et,it[6]=Ct,it[7]=Dt,it[8]=Vt,it[9]=en,it[10]=cn,it[11]=gn,it[12]=lt*bn+bt*Ln+Vt*Vn+nt[12],it[13]=ft*bn+Et*Ln+en*Vn+nt[13],it[14]=vt*bn+Ct*Ln+cn*Vn+nt[14],it[15]=xt*bn+Dt*Ln+gn*Vn+nt[15]),it},yt.K=function(it,nt,st){var lt=st[0],ft=st[1],vt=st[2];return it[0]=nt[0]*lt,it[1]=nt[1]*lt,it[2]=nt[2]*lt,it[3]=nt[3]*lt,it[4]=nt[4]*ft,it[5]=nt[5]*ft,it[6]=nt[6]*ft,it[7]=nt[7]*ft,it[8]=nt[8]*vt,it[9]=nt[9]*vt,it[10]=nt[10]*vt,it[11]=nt[11]*vt,it[12]=nt[12],it[13]=nt[13],it[14]=nt[14],it[15]=nt[15],it},yt.L=jv,yt.M=function(it,nt){const st={};for(let lt=0;lt<nt.length;lt++){const ft=nt[lt];ft in it&&(st[ft]=it[ft])}return st},yt.N=cm,yt.O=Fx,yt.P=Lt,yt.Q=Ox,yt.R=Lu,yt.S=Fu,yt.T=jm,yt.U=Bt,yt.V=zt,yt.W=lr,yt.X=ba,yt.Y=wt,yt.Z=X_,yt._=ct,yt.a=Nt,yt.a$=function(it,nt){var st=it[0],lt=it[1],ft=it[2],vt=it[3],xt=it[4],bt=it[5],Et=it[6],Ct=it[7],Dt=it[8],Vt=it[9],en=it[10],cn=it[11],gn=it[12],bn=it[13],Ln=it[14],Vn=it[15],vr=nt[0],er=nt[1],_r=nt[2],Ir=nt[3],Yr=nt[4],gs=nt[5],Hs=nt[6],hs=nt[7],cs=nt[8],Ls=nt[9],As=nt[10],xs=nt[11],Hr=nt[12],Os=nt[13],Ds=nt[14],eo=nt[15];return Math.abs(st-vr)<=ou*Math.max(1,Math.abs(st),Math.abs(vr))&&Math.abs(lt-er)<=ou*Math.max(1,Math.abs(lt),Math.abs(er))&&Math.abs(ft-_r)<=ou*Math.max(1,Math.abs(ft),Math.abs(_r))&&Math.abs(vt-Ir)<=ou*Math.max(1,Math.abs(vt),Math.abs(Ir))&&Math.abs(xt-Yr)<=ou*Math.max(1,Math.abs(xt),Math.abs(Yr))&&Math.abs(bt-gs)<=ou*Math.max(1,Math.abs(bt),Math.abs(gs))&&Math.abs(Et-Hs)<=ou*Math.max(1,Math.abs(Et),Math.abs(Hs))&&Math.abs(Ct-hs)<=ou*Math.max(1,Math.abs(Ct),Math.abs(hs))&&Math.abs(Dt-cs)<=ou*Math.max(1,Math.abs(Dt),Math.abs(cs))&&Math.abs(Vt-Ls)<=ou*Math.max(1,Math.abs(Vt),Math.abs(Ls))&&Math.abs(en-As)<=ou*Math.max(1,Math.abs(en),Math.abs(As))&&Math.abs(cn-xs)<=ou*Math.max(1,Math.abs(cn),Math.abs(xs))&&Math.abs(gn-Hr)<=ou*Math.max(1,Math.abs(gn),Math.abs(Hr))&&Math.abs(bn-Os)<=ou*Math.max(1,Math.abs(bn),Math.abs(Os))&&Math.abs(Ln-Ds)<=ou*Math.max(1,Math.abs(Ln),Math.abs(Ds))&&Math.abs(Vn-eo)<=ou*Math.max(1,Math.abs(Vn),Math.abs(eo))},yt.a0=vo,yt.a1=O0,yt.a2=Cr,yt.a3=it=>{const nt=window.document.createElement("video");return nt.muted=!0,new Promise(st=>{nt.onloadstart=()=>{st(nt)};for(const lt of it){const ft=window.document.createElement("source");Mn(lt)||(nt.crossOrigin="Anonymous"),ft.src=lt,nt.appendChild(ft)}})},yt.a4=function(){return hn++},yt.a5=ms,yt.a6=t_,yt.a7=Rp,yt.a8=Sm,yt.a9=Ux,yt.aA=function(it){if(it.type==="custom")return new gE(it);switch(it.type){case"background":return new pE(it);case"circle":return new ew(it);case"fill":return new _w(it);case"fill-extrusion":return new Iw(it);case"heatmap":return new nw(it);case"hillshade":return new rw(it);case"line":return new jw(it);case"raster":return new mE(it);case"symbol":return new Ry(it)}},yt.aB=fn,yt.aC=function(it,nt){if(!it)return[{command:"setStyle",args:[nt]}];let st=[];try{if(!Jr(it.version,nt.version))return[{command:"setStyle",args:[nt]}];Jr(it.center,nt.center)||st.push({command:"setCenter",args:[nt.center]}),Jr(it.zoom,nt.zoom)||st.push({command:"setZoom",args:[nt.zoom]}),Jr(it.bearing,nt.bearing)||st.push({command:"setBearing",args:[nt.bearing]}),Jr(it.pitch,nt.pitch)||st.push({command:"setPitch",args:[nt.pitch]}),Jr(it.sprite,nt.sprite)||st.push({command:"setSprite",args:[nt.sprite]}),Jr(it.glyphs,nt.glyphs)||st.push({command:"setGlyphs",args:[nt.glyphs]}),Jr(it.transition,nt.transition)||st.push({command:"setTransition",args:[nt.transition]}),Jr(it.light,nt.light)||st.push({command:"setLight",args:[nt.light]}),Jr(it.terrain,nt.terrain)||st.push({command:"setTerrain",args:[nt.terrain]}),Jr(it.sky,nt.sky)||st.push({command:"setSky",args:[nt.sky]}),Jr(it.projection,nt.projection)||st.push({command:"setProjection",args:[nt.projection]});const lt={},ft=[];(function(xt,bt,Et,Ct){let Dt;for(Dt in bt=bt||{},xt=xt||{})Object.prototype.hasOwnProperty.call(xt,Dt)&&(Object.prototype.hasOwnProperty.call(bt,Dt)||Lr(Dt,Et,Ct));for(Dt in bt)Object.prototype.hasOwnProperty.call(bt,Dt)&&(Object.prototype.hasOwnProperty.call(xt,Dt)?Jr(xt[Dt],bt[Dt])||(xt[Dt].type==="geojson"&&bt[Dt].type==="geojson"&&or(xt,bt,Dt)?jr(Et,{command:"setGeoJSONSourceData",args:[Dt,bt[Dt].data]}):hr(Dt,bt,Et,Ct)):ss(Dt,bt,Et))})(it.sources,nt.sources,ft,lt);const vt=[];it.layers&&it.layers.forEach(xt=>{"source"in xt&&lt[xt.source]?st.push({command:"removeLayer",args:[xt.id]}):vt.push(xt)}),st=st.concat(ft),function(xt,bt,Et){bt=bt||[];const Ct=(xt=xt||[]).map(Zr),Dt=bt.map(Zr),Vt=xt.reduce(qr,{}),en=bt.reduce(qr,{}),cn=Ct.slice(),gn=Object.create(null);let bn,Ln,Vn,vr,er;for(let _r=0,Ir=0;_r<Ct.length;_r++)bn=Ct[_r],Object.prototype.hasOwnProperty.call(en,bn)?Ir++:(jr(Et,{command:"removeLayer",args:[bn]}),cn.splice(cn.indexOf(bn,Ir),1));for(let _r=0,Ir=0;_r<Dt.length;_r++)bn=Dt[Dt.length-1-_r],cn[cn.length-1-_r]!==bn&&(Object.prototype.hasOwnProperty.call(Vt,bn)?(jr(Et,{command:"removeLayer",args:[bn]}),cn.splice(cn.lastIndexOf(bn,cn.length-Ir),1)):Ir++,vr=cn[cn.length-_r],jr(Et,{command:"addLayer",args:[en[bn],vr]}),cn.splice(cn.length-_r,0,bn),gn[bn]=!0);for(let _r=0;_r<Dt.length;_r++)if(bn=Dt[_r],Ln=Vt[bn],Vn=en[bn],!gn[bn]&&!Jr(Ln,Vn))if(Jr(Ln.source,Vn.source)&&Jr(Ln["source-layer"],Vn["source-layer"])&&Jr(Ln.type,Vn.type)){for(er in Tr(Ln.layout,Vn.layout,Et,bn,null,"setLayoutProperty"),Tr(Ln.paint,Vn.paint,Et,bn,null,"setPaintProperty"),Jr(Ln.filter,Vn.filter)||jr(Et,{command:"setFilter",args:[bn,Vn.filter]}),Jr(Ln.minzoom,Vn.minzoom)&&Jr(Ln.maxzoom,Vn.maxzoom)||jr(Et,{command:"setLayerZoomRange",args:[bn,Vn.minzoom,Vn.maxzoom]}),Ln)Object.prototype.hasOwnProperty.call(Ln,er)&&er!=="layout"&&er!=="paint"&&er!=="filter"&&er!=="metadata"&&er!=="minzoom"&&er!=="maxzoom"&&(er.indexOf("paint.")===0?Tr(Ln[er],Vn[er],Et,bn,er.slice(6),"setPaintProperty"):Jr(Ln[er],Vn[er])||jr(Et,{command:"setLayerProperty",args:[bn,er,Vn[er]]}));for(er in Vn)Object.prototype.hasOwnProperty.call(Vn,er)&&!Object.prototype.hasOwnProperty.call(Ln,er)&&er!=="layout"&&er!=="paint"&&er!=="filter"&&er!=="metadata"&&er!=="minzoom"&&er!=="maxzoom"&&(er.indexOf("paint.")===0?Tr(Ln[er],Vn[er],Et,bn,er.slice(6),"setPaintProperty"):Jr(Ln[er],Vn[er])||jr(Et,{command:"setLayerProperty",args:[bn,er,Vn[er]]}))}else jr(Et,{command:"removeLayer",args:[bn]}),vr=cn[cn.lastIndexOf(bn)+1],jr(Et,{command:"addLayer",args:[Vn,vr]})}(vt,nt.layers,st)}catch(lt){console.warn("Unable to compute style diff:",lt),st=[{command:"setStyle",args:[nt]}]}return st},yt.aD=function(it){const nt=[],st=it.id;return st===void 0&&nt.push({message:`layers.${st}: missing required property "id"`}),it.render===void 0&&nt.push({message:`layers.${st}: missing required method "render"`}),it.renderingMode&&it.renderingMode!=="2d"&&it.renderingMode!=="3d"&&nt.push({message:`layers.${st}: property "renderingMode" must be either "2d" or "3d"`}),nt},yt.aE=function it(nt,st){if(Array.isArray(nt)){if(!Array.isArray(st)||nt.length!==st.length)return!1;for(let lt=0;lt<nt.length;lt++)if(!it(nt[lt],st[lt]))return!1;return!0}if(typeof nt=="object"&&nt!==null&&st!==null){if(typeof st!="object"||Object.keys(nt).length!==Object.keys(st).length)return!1;for(const lt in nt)if(!it(nt[lt],st[lt]))return!1;return!0}return nt===st},yt.aF=Yt,yt.aG=vn,yt.aH=class extends bm{constructor(it,nt){super(it,nt),this.current=0}set(it){this.current!==it&&(this.current=it,this.gl.uniform1i(this.location,it))}},yt.aI=_y,yt.aJ=class extends bm{constructor(it,nt){super(it,nt),this.current=q1}set(it){if(it[12]!==this.current[12]||it[0]!==this.current[0])return this.current=it,void this.gl.uniformMatrix4fv(this.location,!1,it);for(let nt=1;nt<16;nt++)if(it[nt]!==this.current[nt]){this.current=it,this.gl.uniformMatrix4fv(this.location,!1,it);break}}},yt.aK=Pv,yt.aL=Rv,yt.aM=oo,yt.aN=class extends bm{constructor(it,nt){super(it,nt),this.current=[0,0,0]}set(it){it[0]===this.current[0]&&it[1]===this.current[1]&&it[2]===this.current[2]||(this.current=it,this.gl.uniform3f(this.location,it[0],it[1],it[2]))}},yt.aO=class extends bm{constructor(it,nt){super(it,nt),this.current=[0,0]}set(it){it[0]===this.current[0]&&it[1]===this.current[1]||(this.current=it,this.gl.uniform2f(this.location,it[0],it[1]))}},yt.aP=function(it,nt,st,lt,ft,vt,xt){var bt=1/(nt-st),Et=1/(lt-ft),Ct=1/(vt-xt);return it[0]=-2*bt,it[1]=0,it[2]=0,it[3]=0,it[4]=0,it[5]=-2*Et,it[6]=0,it[7]=0,it[8]=0,it[9]=0,it[10]=2*Ct,it[11]=0,it[12]=(nt+st)*bt,it[13]=(ft+lt)*Et,it[14]=(xt+vt)*Ct,it[15]=1,it},yt.aQ=Q1,yt.aR=class extends ar{},yt.aS=Hw,yt.aT=class extends Ar{},yt.aU=f0,yt.aV=function(it){return it<=1?1:Math.pow(2,Math.ceil(Math.log(it)/Math.LN2))},yt.aW=Wv,yt.aX=Bl,yt.aY=Du,yt.aZ=class extends Rs{},yt.a_=function(it,nt){return it[0]===nt[0]&&it[1]===nt[1]&&it[2]===nt[2]&&it[3]===nt[3]&&it[4]===nt[4]&&it[5]===nt[5]&&it[6]===nt[6]&&it[7]===nt[7]&&it[8]===nt[8]&&it[9]===nt[9]&&it[10]===nt[10]&&it[11]===nt[11]&&it[12]===nt[12]&&it[13]===nt[13]&&it[14]===nt[14]&&it[15]===nt[15]},yt.aa=function(it){const nt={};if(it.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(st,lt,ft,vt)=>{const xt=ft||vt;return nt[lt]=!xt||xt.toLowerCase(),""}),nt["max-age"]){const st=parseInt(nt["max-age"],10);isNaN(st)?delete nt["max-age"]:nt["max-age"]=st}return nt},yt.ab=function(it,nt){const st=[];for(const lt in it)lt in nt||st.push(lt);return st},yt.ac=Ot,yt.ad=function(it,nt,st){var lt=Math.sin(st),ft=Math.cos(st),vt=nt[0],xt=nt[1],bt=nt[2],Et=nt[3],Ct=nt[4],Dt=nt[5],Vt=nt[6],en=nt[7];return nt!==it&&(it[8]=nt[8],it[9]=nt[9],it[10]=nt[10],it[11]=nt[11],it[12]=nt[12],it[13]=nt[13],it[14]=nt[14],it[15]=nt[15]),it[0]=vt*ft+Ct*lt,it[1]=xt*ft+Dt*lt,it[2]=bt*ft+Vt*lt,it[3]=Et*ft+en*lt,it[4]=Ct*ft-vt*lt,it[5]=Dt*ft-xt*lt,it[6]=Vt*ft-bt*lt,it[7]=en*ft-Et*lt,it},yt.ae=function(it){var nt=new Km(16);return nt[0]=it[0],nt[1]=it[1],nt[2]=it[2],nt[3]=it[3],nt[4]=it[4],nt[5]=it[5],nt[6]=it[6],nt[7]=it[7],nt[8]=it[8],nt[9]=it[9],nt[10]=it[10],nt[11]=it[11],nt[12]=it[12],nt[13]=it[13],nt[14]=it[14],nt[15]=it[15],nt},yt.af=by,yt.ag=function(it,nt){let st=0,lt=0;if(it.kind==="constant")lt=it.layoutSize;else if(it.kind!=="source"){const{interpolationType:ft,minZoom:vt,maxZoom:xt}=it,bt=ft?Ot(Rl.interpolationFactor(ft,nt,vt,xt),0,1):0;it.kind==="camera"?lt=Fl.number(it.minSize,it.maxSize,bt):st=bt}return{uSizeT:st,uSize:lt}},yt.ai=function(it,{uSize:nt,uSizeT:st},{lowerSize:lt,upperSize:ft}){return it.kind==="source"?lt/pp:it.kind==="composite"?Fl.number(lt/pp,ft/pp,st):nt},yt.aj=R0,yt.ak=function(it,nt,st,lt){const ft=nt.y-it.y,vt=nt.x-it.x,xt=lt.y-st.y,bt=lt.x-st.x,Et=xt*vt-bt*ft;if(Et===0)return null;const Ct=(bt*(it.y-st.y)-xt*(it.x-st.x))/Et;return new Lt(it.x+Ct*vt,it.y+Ct*ft)},yt.al=qx,yt.am=Lv,yt.an=h0,yt.ao=function(it){let nt=1/0,st=1/0,lt=-1/0,ft=-1/0;for(const vt of it)nt=Math.min(nt,vt.x),st=Math.min(st,vt.y),lt=Math.max(lt,vt.x),ft=Math.max(ft,vt.y);return[nt,st,lt,ft]},yt.ap=_l,yt.ar=P0,yt.as=function(it,nt){var st=nt[0],lt=nt[1],ft=nt[2],vt=nt[3],xt=nt[4],bt=nt[5],Et=nt[6],Ct=nt[7],Dt=nt[8],Vt=nt[9],en=nt[10],cn=nt[11],gn=nt[12],bn=nt[13],Ln=nt[14],Vn=nt[15],vr=st*bt-lt*xt,er=st*Et-ft*xt,_r=st*Ct-vt*xt,Ir=lt*Et-ft*bt,Yr=lt*Ct-vt*bt,gs=ft*Ct-vt*Et,Hs=Dt*bn-Vt*gn,hs=Dt*Ln-en*gn,cs=Dt*Vn-cn*gn,Ls=Vt*Ln-en*bn,As=Vt*Vn-cn*bn,xs=en*Vn-cn*Ln,Hr=vr*xs-er*As+_r*Ls+Ir*cs-Yr*hs+gs*Hs;return Hr?(it[0]=(bt*xs-Et*As+Ct*Ls)*(Hr=1/Hr),it[1]=(ft*As-lt*xs-vt*Ls)*Hr,it[2]=(bn*gs-Ln*Yr+Vn*Ir)*Hr,it[3]=(en*Yr-Vt*gs-cn*Ir)*Hr,it[4]=(Et*cs-xt*xs-Ct*hs)*Hr,it[5]=(st*xs-ft*cs+vt*hs)*Hr,it[6]=(Ln*_r-gn*gs-Vn*er)*Hr,it[7]=(Dt*gs-en*_r+cn*er)*Hr,it[8]=(xt*As-bt*cs+Ct*Hs)*Hr,it[9]=(lt*cs-st*As-vt*Hs)*Hr,it[10]=(gn*Yr-bn*_r+Vn*vr)*Hr,it[11]=(Vt*_r-Dt*Yr-cn*vr)*Hr,it[12]=(bt*hs-xt*Ls-Et*Hs)*Hr,it[13]=(st*Ls-lt*hs+ft*Hs)*Hr,it[14]=(bn*er-gn*Ir-Ln*vr)*Hr,it[15]=(Dt*Ir-Vt*er+en*vr)*Hr,it):null},yt.at=N0,yt.au=k0,yt.av=B0,yt.aw=function(){const it={},nt=On.$version;for(const st in On.$root){const lt=On.$root[st];if(lt.required){let ft=null;ft=st==="version"?nt:lt.type==="array"?[]:{},ft!=null&&(it[st]=ft)}}return it},yt.ax=k_,yt.ay=an,yt.az=function(it){it=it.slice();const nt=Object.create(null);for(let st=0;st<it.length;st++)nt[it[st].id]=it[st];for(let st=0;st<it.length;st++)"ref"in it[st]&&(it[st]=ts(it[st],nt[it[st].ref]));return it},yt.b=br,yt.b0=function(it,nt){return it[0]=nt[0],it[1]=nt[1],it[2]=nt[2],it[3]=nt[3],it[4]=nt[4],it[5]=nt[5],it[6]=nt[6],it[7]=nt[7],it[8]=nt[8],it[9]=nt[9],it[10]=nt[10],it[11]=nt[11],it[12]=nt[12],it[13]=nt[13],it[14]=nt[14],it[15]=nt[15],it},yt.b1=function(it,nt,st){return it[0]=nt[0]*st[0],it[1]=nt[1]*st[1],it[2]=nt[2]*st[2],it[3]=nt[3]*st[3],it},yt.b2=function(it,nt){return it[0]*nt[0]+it[1]*nt[1]+it[2]*nt[2]+it[3]*nt[3]},yt.b3=Kt,yt.b4=Bx,yt.b5=zx,yt.b6=function(it,nt,st,lt,ft){var vt,xt=1/Math.tan(nt/2);return it[0]=xt/st,it[1]=0,it[2]=0,it[3]=0,it[4]=0,it[5]=xt,it[6]=0,it[7]=0,it[8]=0,it[9]=0,it[11]=-1,it[12]=0,it[13]=0,it[15]=0,ft!=null&&ft!==1/0?(it[10]=(ft+lt)*(vt=1/(lt-ft)),it[14]=2*ft*lt*vt):(it[10]=-1,it[14]=-2*lt),it},yt.b7=function(it,nt,st){var lt=Math.sin(st),ft=Math.cos(st),vt=nt[4],xt=nt[5],bt=nt[6],Et=nt[7],Ct=nt[8],Dt=nt[9],Vt=nt[10],en=nt[11];return nt!==it&&(it[0]=nt[0],it[1]=nt[1],it[2]=nt[2],it[3]=nt[3],it[12]=nt[12],it[13]=nt[13],it[14]=nt[14],it[15]=nt[15]),it[4]=vt*ft+Ct*lt,it[5]=xt*ft+Dt*lt,it[6]=bt*ft+Vt*lt,it[7]=Et*ft+en*lt,it[8]=Ct*ft-vt*lt,it[9]=Dt*ft-xt*lt,it[10]=Vt*ft-bt*lt,it[11]=en*ft-Et*lt,it},yt.b8=Ht,yt.b9=nn,yt.bA=hx,yt.bB=function(it){return it.message===$r},yt.bC=iu,yt.bD=gu,yt.ba=function(it){return it*Math.PI/180},yt.bb=function(it,nt){const{x:st,y:lt}=X_.fromLngLat(nt);return!(it<0||it>25||lt<0||lt>=1||st<0||st>=1)},yt.bc=function(it,nt){return it[0]=nt[0],it[1]=0,it[2]=0,it[3]=0,it[4]=0,it[5]=nt[1],it[6]=0,it[7]=0,it[8]=0,it[9]=0,it[10]=nt[2],it[11]=0,it[12]=0,it[13]=0,it[14]=0,it[15]=1,it},yt.bd=class extends Ft{},yt.be=L0,yt.bf=TE,yt.bh=rn,yt.bi=function(it,nt){Nt.REGISTERED_PROTOCOLS[it]=nt},yt.bj=function(it){delete Nt.REGISTERED_PROTOCOLS[it]},yt.bk=function(it,nt){const st={};for(let ft=0;ft<it.length;ft++){const vt=nt&&nt[it[ft].id]||uo(it[ft]);nt&&(nt[it[ft].id]=vt);let xt=st[vt];xt||(xt=st[vt]=[]),xt.push(it[ft])}const lt=[];for(const ft in st)lt.push(st[ft]);return lt},yt.bl=bs,yt.bm=$x,yt.bn=Vx,yt.bo=xx,yt.bp=function(it){it.bucket.createArrays(),it.bucket.tilePixelRatio=ba/(512*it.bucket.overscaling),it.bucket.compareText={},it.bucket.iconsNeedLinear=!1;const nt=it.bucket.layers[0],st=nt.layout,lt=nt._unevaluatedLayout._values,ft={layoutIconSize:lt["icon-size"].possiblyEvaluate(new Vo(it.bucket.zoom+1),it.canonical),layoutTextSize:lt["text-size"].possiblyEvaluate(new Vo(it.bucket.zoom+1),it.canonical),textMaxSize:lt["text-size"].possiblyEvaluate(new Vo(18))};if(it.bucket.textSizeData.kind==="composite"){const{minZoom:Ct,maxZoom:Dt}=it.bucket.textSizeData;ft.compositeTextSizes=[lt["text-size"].possiblyEvaluate(new Vo(Ct),it.canonical),lt["text-size"].possiblyEvaluate(new Vo(Dt),it.canonical)]}if(it.bucket.iconSizeData.kind==="composite"){const{minZoom:Ct,maxZoom:Dt}=it.bucket.iconSizeData;ft.compositeIconSizes=[lt["icon-size"].possiblyEvaluate(new Vo(Ct),it.canonical),lt["icon-size"].possiblyEvaluate(new Vo(Dt),it.canonical)]}const vt=st.get("text-line-height")*_l,xt=st.get("text-rotation-alignment")!=="viewport"&&st.get("symbol-placement")!=="point",bt=st.get("text-keep-upright"),Et=st.get("text-size");for(const Ct of it.bucket.features){const Dt=st.get("text-font").evaluate(Ct,{},it.canonical).join(","),Vt=Et.evaluate(Ct,{},it.canonical),en=ft.layoutTextSize.evaluate(Ct,{},it.canonical),cn=ft.layoutIconSize.evaluate(Ct,{},it.canonical),gn={horizontal:{},vertical:void 0},bn=Ct.text;let Ln,Vn=[0,0];if(bn){const _r=bn.toString(),Ir=st.get("text-letter-spacing").evaluate(Ct,{},it.canonical)*_l,Yr=e0(_r)?Ir:0,gs=st.get("text-anchor").evaluate(Ct,{},it.canonical),Hs=e1(nt,Ct,it.canonical);if(!Hs){const As=st.get("text-radial-offset").evaluate(Ct,{},it.canonical);Vn=As?_b(gs,[As*_l,z0]):st.get("text-offset").evaluate(Ct,{},it.canonical).map(xs=>xs*_l)}let hs=xt?"center":st.get("text-justify").evaluate(Ct,{},it.canonical);const cs=st.get("symbol-placement")==="point"?st.get("text-max-width").evaluate(Ct,{},it.canonical)*_l:1/0,Ls=()=>{it.bucket.allowVerticalPlacement&&P_(_r)&&(gn.vertical=Cy(bn,it.glyphMap,it.glyphPositions,it.imagePositions,Dt,cs,vt,gs,"left",Yr,Vn,yt.ah.vertical,!0,en,Vt))};if(!xt&&Hs){const As=new Set;if(hs==="auto")for(let Hr=0;Hr<Hs.values.length;Hr+=2)As.add(N0(Hs.values[Hr]));else As.add(hs);let xs=!1;for(const Hr of As)if(!gn.horizontal[Hr])if(xs)gn.horizontal[Hr]=gn.horizontal[0];else{const Os=Cy(bn,it.glyphMap,it.glyphPositions,it.imagePositions,Dt,cs,vt,"center",Hr,Yr,Vn,yt.ah.horizontal,!1,en,Vt);Os&&(gn.horizontal[Hr]=Os,xs=Os.positionedLines.length===1)}Ls()}else{hs==="auto"&&(hs=N0(gs));const As=Cy(bn,it.glyphMap,it.glyphPositions,it.imagePositions,Dt,cs,vt,gs,hs,Yr,Vn,yt.ah.horizontal,!1,en,Vt);As&&(gn.horizontal[hs]=As),Ls(),P_(_r)&&xt&&bt&&(gn.vertical=Cy(bn,it.glyphMap,it.glyphPositions,it.imagePositions,Dt,cs,vt,gs,hs,Yr,Vn,yt.ah.vertical,!1,en,Vt))}}let vr=!1;if(Ct.icon&&Ct.icon.name){const _r=it.imageMap[Ct.icon.name];_r&&(Ln=lE(it.imagePositions[Ct.icon.name],st.get("icon-offset").evaluate(Ct,{},it.canonical),st.get("icon-anchor").evaluate(Ct,{},it.canonical)),vr=!!_r.sdf,it.bucket.sdfIcons===void 0?it.bucket.sdfIcons=vr:it.bucket.sdfIcons!==vr&&Xn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_r.pixelRatio!==it.bucket.pixelRatio||st.get("icon-rotate").constantOr(1)!==0)&&(it.bucket.iconsNeedLinear=!0))}const er=n1(gn.horizontal)||gn.vertical;it.bucket.iconsInText=!!er&&er.iconsInText,(er||Ln)&&SE(it.bucket,Ct,gn,Ln,it.imageMap,ft,en,cn,Vn,vr,it.canonical)}it.showCollisionBoxes&&it.bucket.generateCollisionDebugBuffers()},yt.bq=w0,yt.br=v0,yt.bs=b0,yt.bt=om,yt.bu=S0,yt.bv=class{constructor(it){this._marks={start:[it.url,"start"].join("#"),end:[it.url,"end"].join("#"),measure:it.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let it=performance.getEntriesByName(this._marks.measure);return it.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),it=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),it}},yt.bw=function(it,nt,st,lt,ft){return ct(this,void 0,void 0,function*(){if(zt())try{return yield lr(it,nt,st,lt,ft)}catch{}return function(vt,xt,bt,Et,Ct){const Dt=vt.width,Vt=vt.height;xr&&Dr||(xr=new OffscreenCanvas(Dt,Vt),Dr=xr.getContext("2d",{willReadFrequently:!0})),xr.width=Dt,xr.height=Vt,Dr.drawImage(vt,0,0,Dt,Vt);const en=Dr.getImageData(xt,bt,Et,Ct);return Dr.clearRect(0,0,Dt,Vt),en.data}(it,nt,st,lt,ft)})},yt.bx=jx,yt.by=At,yt.bz=Pt,yt.c=An,yt.d=it=>ct(void 0,void 0,void 0,function*(){if(it.byteLength===0)return createImageBitmap(new ImageData(1,1));const nt=new Blob([new Uint8Array(it)],{type:"image/png"});try{return createImageBitmap(nt)}catch(st){throw new Error(`Could not load image because of ${st.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),yt.e=mn,yt.f=it=>new Promise((nt,st)=>{const lt=new Image;lt.onload=()=>{nt(lt),URL.revokeObjectURL(lt.src),lt.onload=null,window.requestAnimationFrame(()=>{lt.src=Pn})},lt.onerror=()=>st(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ft=new Blob([new Uint8Array(it)],{type:"image/png"});lt.src=it.byteLength?URL.createObjectURL(ft):Pn}),yt.g=Zt,yt.h=(it,nt)=>En(mn(it,{type:"json"}),nt),yt.i=_i,yt.j=wr,yt.k=cr,yt.l=(it,nt)=>En(mn(it,{type:"arrayBuffer"}),nt),yt.m=En,yt.n=function(it){return new S0(it).readFields(tE,[])},yt.o=N_,yt.p=vx,yt.q=gt,yt.r=Jy,yt.s=Mn,yt.t=T_,yt.u=Lp,yt.v=On,yt.w=Xn,yt.x=function([it,nt,st]){return nt+=90,nt*=Math.PI/180,st*=Math.PI/180,{x:it*Math.cos(nt)*Math.sin(st),y:it*Math.sin(nt)*Math.sin(st),z:it*Math.cos(st)}},yt.y=Fl,yt.z=Vo}),ut("worker",["./shared"],function(yt){class ct{constructor(Wt){this.keyCache={},Wt&&this.replace(Wt)}replace(Wt){this._layerConfigs={},this._layers={},this.update(Wt,[])}update(Wt,jt){for(const xn of Wt){this._layerConfigs[xn.id]=xn;const Nn=this._layers[xn.id]=yt.aA(xn);Nn._featureFilter=yt.a7(Nn.filter),this.keyCache[xn.id]&&delete this.keyCache[xn.id]}for(const xn of jt)delete this.keyCache[xn],delete this._layerConfigs[xn],delete this._layers[xn];this.familiesBySource={};const ln=yt.bk(Object.values(this._layerConfigs),this.keyCache);for(const xn of ln){const Nn=xn.map(qt=>this._layers[qt.id]),Tn=Nn[0];if(Tn.visibility==="none")continue;const Kn=Tn.source||"";let Cn=this.familiesBySource[Kn];Cn||(Cn=this.familiesBySource[Kn]={});const un=Tn.sourceLayer||"_geojsonTileLayer";let Rt=Cn[un];Rt||(Rt=Cn[un]=[]),Rt.push(Nn)}}}class At{constructor(Wt){const jt={},ln=[];for(const Kn in Wt){const Cn=Wt[Kn],un=jt[Kn]={};for(const Rt in Cn){const qt=Cn[+Rt];if(!qt||qt.bitmap.width===0||qt.bitmap.height===0)continue;const yn={x:0,y:0,w:qt.bitmap.width+2,h:qt.bitmap.height+2};ln.push(yn),un[Rt]={rect:yn,metrics:qt.metrics}}}const{w:xn,h:Nn}=yt.p(ln),Tn=new yt.o({width:xn||1,height:Nn||1});for(const Kn in Wt){const Cn=Wt[Kn];for(const un in Cn){const Rt=Cn[+un];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const qt=jt[Kn][un].rect;yt.o.copy(Rt.bitmap,Tn,{x:0,y:0},{x:qt.x+1,y:qt.y+1},Rt.bitmap)}}this.image=Tn,this.positions=jt}}yt.bl("GlyphAtlas",At);class Pt{constructor(Wt){this.tileID=new yt.S(Wt.tileID.overscaledZ,Wt.tileID.wrap,Wt.tileID.canonical.z,Wt.tileID.canonical.x,Wt.tileID.canonical.y),this.uid=Wt.uid,this.zoom=Wt.zoom,this.pixelRatio=Wt.pixelRatio,this.tileSize=Wt.tileSize,this.source=Wt.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Wt.showCollisionBoxes,this.collectResourceTiming=!!Wt.collectResourceTiming,this.returnDependencies=!!Wt.returnDependencies,this.promoteId=Wt.promoteId,this.inFlightDependencies=[]}parse(Wt,jt,ln,xn){return yt._(this,void 0,void 0,function*(){this.status="parsing",this.data=Wt,this.collisionBoxArray=new yt.a5;const Nn=new yt.bm(Object.keys(Wt.layers).sort()),Tn=new yt.bn(this.tileID,this.promoteId);Tn.bucketLayerIDs=[];const Kn={},Cn={featureIndex:Tn,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ln},un=jt.familiesBySource[this.source];for(const Ur in un){const is=Wt.layers[Ur];if(!is)continue;is.version===1&&yt.w(`Vector tile source "${this.source}" layer "${Ur}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fs=Nn.encode(Ur),zs=[];for(let Gs=0;Gs<is.length;Gs++){const go=is.feature(Gs),Ao=Tn.getId(go,Ur);zs.push({feature:go,id:Ao,index:Gs,sourceLayerIndex:fs})}for(const Gs of un[Ur]){const go=Gs[0];go.source!==this.source&&yt.w(`layer.source = ${go.source} does not equal this.source = ${this.source}`),go.minzoom&&this.zoom<Math.floor(go.minzoom)||go.maxzoom&&this.zoom>=go.maxzoom||go.visibility!=="none"&&(kt(Gs,this.zoom,ln),(Kn[go.id]=go.createBucket({index:Tn.bucketLayerIDs.length,layers:Gs,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fs,sourceID:this.source})).populate(zs,Cn,this.tileID.canonical),Tn.bucketLayerIDs.push(Gs.map(Ao=>Ao.id)))}}const Rt=yt.aF(Cn.glyphDependencies,Ur=>Object.keys(Ur).map(Number));this.inFlightDependencies.forEach(Ur=>Ur==null?void 0:Ur.abort()),this.inFlightDependencies=[];let qt=Promise.resolve({});if(Object.keys(Rt).length){const Ur=new AbortController;this.inFlightDependencies.push(Ur),qt=xn.sendAsync({type:"GG",data:{stacks:Rt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ur)}const yn=Object.keys(Cn.iconDependencies);let Rn=Promise.resolve({});if(yn.length){const Ur=new AbortController;this.inFlightDependencies.push(Ur),Rn=xn.sendAsync({type:"GI",data:{icons:yn,source:this.source,tileID:this.tileID,type:"icons"}},Ur)}const zn=Object.keys(Cn.patternDependencies);let ir=Promise.resolve({});if(zn.length){const Ur=new AbortController;this.inFlightDependencies.push(Ur),ir=xn.sendAsync({type:"GI",data:{icons:zn,source:this.source,tileID:this.tileID,type:"patterns"}},Ur)}const[Sr,Nr,Fr]=yield Promise.all([qt,Rn,ir]),ps=new At(Sr),Gr=new yt.bo(Nr,Fr);for(const Ur in Kn){const is=Kn[Ur];is instanceof yt.a6?(kt(is.layers,this.zoom,ln),yt.bp({bucket:is,glyphMap:Sr,glyphPositions:ps.positions,imageMap:Nr,imagePositions:Gr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):is.hasPattern&&(is instanceof yt.bq||is instanceof yt.br||is instanceof yt.bs)&&(kt(is.layers,this.zoom,ln),is.addFeatures(Cn,this.tileID.canonical,Gr.patternPositions))}return this.status="done",{buckets:Object.values(Kn).filter(Ur=>!Ur.isEmpty()),featureIndex:Tn,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ps.image,imageAtlas:Gr,glyphMap:this.returnDependencies?Sr:null,iconMap:this.returnDependencies?Nr:null,glyphPositions:this.returnDependencies?ps.positions:null}})}}function kt(_n,Wt,jt){const ln=new yt.z(Wt);for(const xn of _n)xn.recalculate(ln,jt)}class Lt{constructor(Wt,jt,ln){this.actor=Wt,this.layerIndex=jt,this.availableImages=ln,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Wt,jt){return yt._(this,void 0,void 0,function*(){const ln=yield yt.l(Wt.request,jt);try{return{vectorTile:new yt.bt.VectorTile(new yt.bu(ln.data)),rawData:ln.data,cacheControl:ln.cacheControl,expires:ln.expires}}catch(xn){const Nn=new Uint8Array(ln.data);let Tn=`Unable to parse the tile at ${Wt.request.url}, `;throw Tn+=Nn[0]===31&&Nn[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${xn.message}`,new Error(Tn)}})}loadTile(Wt){return yt._(this,void 0,void 0,function*(){const jt=Wt.uid,ln=!!(Wt&&Wt.request&&Wt.request.collectResourceTiming)&&new yt.bv(Wt.request),xn=new Pt(Wt);this.loading[jt]=xn;const Nn=new AbortController;xn.abort=Nn;try{const Tn=yield this.loadVectorTile(Wt,Nn);if(delete this.loading[jt],!Tn)return null;const Kn=Tn.rawData,Cn={};Tn.expires&&(Cn.expires=Tn.expires),Tn.cacheControl&&(Cn.cacheControl=Tn.cacheControl);const un={};if(ln){const qt=ln.finish();qt&&(un.resourceTiming=JSON.parse(JSON.stringify(qt)))}xn.vectorTile=Tn.vectorTile;const Rt=xn.parse(Tn.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[jt]=xn,this.fetching[jt]={rawTileData:Kn,cacheControl:Cn,resourceTiming:un};try{const qt=yield Rt;return yt.e({rawTileData:Kn.slice(0)},qt,Cn,un)}finally{delete this.fetching[jt]}}catch(Tn){throw delete this.loading[jt],xn.status="done",this.loaded[jt]=xn,Tn}})}reloadTile(Wt){return yt._(this,void 0,void 0,function*(){const jt=Wt.uid;if(!this.loaded||!this.loaded[jt])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ln=this.loaded[jt];if(ln.showCollisionBoxes=Wt.showCollisionBoxes,ln.status==="parsing"){const xn=yield ln.parse(ln.vectorTile,this.layerIndex,this.availableImages,this.actor);let Nn;if(this.fetching[jt]){const{rawTileData:Tn,cacheControl:Kn,resourceTiming:Cn}=this.fetching[jt];delete this.fetching[jt],Nn=yt.e({rawTileData:Tn.slice(0)},xn,Kn,Cn)}else Nn=xn;return Nn}if(ln.status==="done"&&ln.vectorTile)return ln.parse(ln.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Wt){return yt._(this,void 0,void 0,function*(){const jt=this.loading,ln=Wt.uid;jt&&jt[ln]&&jt[ln].abort&&(jt[ln].abort.abort(),delete jt[ln])})}removeTile(Wt){return yt._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Wt.uid]&&delete this.loaded[Wt.uid]})}}class Mt{constructor(){this.loaded={}}loadTile(Wt){return yt._(this,void 0,void 0,function*(){const{uid:jt,encoding:ln,rawImageData:xn,redFactor:Nn,greenFactor:Tn,blueFactor:Kn,baseShift:Cn}=Wt,un=xn.width+2,Rt=xn.height+2,qt=yt.b(xn)?new yt.R({width:un,height:Rt},yield yt.bw(xn,-1,-1,un,Rt)):xn,yn=new yt.bx(jt,qt,ln,Nn,Tn,Kn,Cn);return this.loaded=this.loaded||{},this.loaded[jt]=yn,yn})}removeTile(Wt){const jt=this.loaded,ln=Wt.uid;jt&&jt[ln]&&delete jt[ln]}}function Qt(_n,Wt){if(_n.length!==0){Jt(_n[0],Wt);for(var jt=1;jt<_n.length;jt++)Jt(_n[jt],!Wt)}}function Jt(_n,Wt){for(var jt=0,ln=0,xn=0,Nn=_n.length,Tn=Nn-1;xn<Nn;Tn=xn++){var Kn=(_n[xn][0]-_n[Tn][0])*(_n[Tn][1]+_n[xn][1]),Cn=jt+Kn;ln+=Math.abs(jt)>=Math.abs(Kn)?jt-Cn+Kn:Kn-Cn+jt,jt=Cn}jt+ln>=0!=!!Wt&&_n.reverse()}var sn=yt.by(function _n(Wt,jt){var ln,xn=Wt&&Wt.type;if(xn==="FeatureCollection")for(ln=0;ln<Wt.features.length;ln++)_n(Wt.features[ln],jt);else if(xn==="GeometryCollection")for(ln=0;ln<Wt.geometries.length;ln++)_n(Wt.geometries[ln],jt);else if(xn==="Feature")_n(Wt.geometry,jt);else if(xn==="Polygon")Qt(Wt.coordinates,jt);else if(xn==="MultiPolygon")for(ln=0;ln<Wt.coordinates.length;ln++)Qt(Wt.coordinates[ln],jt);return Wt});const tn=yt.bt.VectorTileFeature.prototype.toGeoJSON;var Bt={exports:{}},zt=yt.bz,Ht=yt.bt.VectorTileFeature,nn=Ot;function Ot(_n,Wt){this.options=Wt||{},this.features=_n,this.length=_n.length}function Kt(_n,Wt){this.id=typeof _n.id=="number"?_n.id:void 0,this.type=_n.type,this.rawGeometry=_n.type===1?[_n.geometry]:_n.geometry,this.properties=_n.tags,this.extent=Wt||4096}Ot.prototype.feature=function(_n){return new Kt(this.features[_n],this.options.extent)},Kt.prototype.loadGeometry=function(){var _n=this.rawGeometry;this.geometry=[];for(var Wt=0;Wt<_n.length;Wt++){for(var jt=_n[Wt],ln=[],xn=0;xn<jt.length;xn++)ln.push(new zt(jt[xn][0],jt[xn][1]));this.geometry.push(ln)}return this.geometry},Kt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _n=this.geometry,Wt=1/0,jt=-1/0,ln=1/0,xn=-1/0,Nn=0;Nn<_n.length;Nn++)for(var Tn=_n[Nn],Kn=0;Kn<Tn.length;Kn++){var Cn=Tn[Kn];Wt=Math.min(Wt,Cn.x),jt=Math.max(jt,Cn.x),ln=Math.min(ln,Cn.y),xn=Math.max(xn,Cn.y)}return[Wt,ln,jt,xn]},Kt.prototype.toGeoJSON=Ht.prototype.toGeoJSON;var mn=yt.bA,hn=nn;function Yt(_n){var Wt=new mn;return function(jt,ln){for(var xn in jt.layers)ln.writeMessage(3,vn,jt.layers[xn])}(_n,Wt),Wt.finish()}function vn(_n,Wt){var jt;Wt.writeVarintField(15,_n.version||1),Wt.writeStringField(1,_n.name||""),Wt.writeVarintField(5,_n.extent||4096);var ln={keys:[],values:[],keycache:{},valuecache:{}};for(jt=0;jt<_n.length;jt++)ln.feature=_n.feature(jt),Wt.writeMessage(2,fn,ln);var xn=ln.keys;for(jt=0;jt<xn.length;jt++)Wt.writeStringField(3,xn[jt]);var Nn=ln.values;for(jt=0;jt<Nn.length;jt++)Wt.writeMessage(4,gr,Nn[jt])}function fn(_n,Wt){var jt=_n.feature;jt.id!==void 0&&Wt.writeVarintField(1,jt.id),Wt.writeMessage(2,Wn,_n),Wt.writeVarintField(3,jt.type),Wt.writeMessage(4,_i,jt)}function Wn(_n,Wt){var jt=_n.feature,ln=_n.keys,xn=_n.values,Nn=_n.keycache,Tn=_n.valuecache;for(var Kn in jt.properties){var Cn=jt.properties[Kn],un=Nn[Kn];if(Cn!==null){un===void 0&&(ln.push(Kn),Nn[Kn]=un=ln.length-1),Wt.writeVarint(un);var Rt=typeof Cn;Rt!=="string"&&Rt!=="boolean"&&Rt!=="number"&&(Cn=JSON.stringify(Cn));var qt=Rt+":"+Cn,yn=Tn[qt];yn===void 0&&(xn.push(Cn),Tn[qt]=yn=xn.length-1),Wt.writeVarint(yn)}}}function Xn(_n,Wt){return(Wt<<3)+(7&_n)}function Sn(_n){return _n<<1^_n>>31}function _i(_n,Wt){for(var jt=_n.loadGeometry(),ln=_n.type,xn=0,Nn=0,Tn=jt.length,Kn=0;Kn<Tn;Kn++){var Cn=jt[Kn],un=1;ln===1&&(un=Cn.length),Wt.writeVarint(Xn(1,un));for(var Rt=ln===3?Cn.length-1:Cn.length,qt=0;qt<Rt;qt++){qt===1&&ln!==1&&Wt.writeVarint(Xn(2,Rt-1));var yn=Cn[qt].x-xn,Rn=Cn[qt].y-Nn;Wt.writeVarint(Sn(yn)),Wt.writeVarint(Sn(Rn)),xn+=yn,Nn+=Rn}ln===3&&Wt.writeVarint(Xn(7,1))}}function gr(_n,Wt){var jt=typeof _n;jt==="string"?Wt.writeStringField(1,_n):jt==="boolean"?Wt.writeBooleanField(7,_n):jt==="number"&&(_n%1!=0?Wt.writeDoubleField(3,_n):_n<0?Wt.writeSVarintField(6,_n):Wt.writeVarintField(5,_n))}Bt.exports=Yt,Bt.exports.fromVectorTileJs=Yt,Bt.exports.fromGeojsonVt=function(_n,Wt){Wt=Wt||{};var jt={};for(var ln in _n)jt[ln]=new hn(_n[ln].features,Wt),jt[ln].name=ln,jt[ln].version=Wt.version,jt[ln].extent=Wt.extent;return Yt({layers:jt})},Bt.exports.GeoJSONWrapper=hn;var br=yt.by(Bt.exports);const Pn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_n=>_n},lr=Math.fround||(xr=new Float32Array(1),_n=>(xr[0]=+_n,xr[0]));var xr;const Dr=3,$r=5,An=6;class Nt{constructor(Wt){this.options=Object.assign(Object.create(Pn),Wt),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Wt){const{log:jt,minZoom:ln,maxZoom:xn}=this.options;jt&&console.time("total time");const Nn=`prepare ${Wt.length} points`;jt&&console.time(Nn),this.points=Wt;const Tn=[];for(let Cn=0;Cn<Wt.length;Cn++){const un=Wt[Cn];if(!un.geometry)continue;const[Rt,qt]=un.geometry.coordinates,yn=lr(rn(Rt)),Rn=lr(an(qt));Tn.push(yn,Rn,1/0,Cn,-1,1),this.options.reduce&&Tn.push(0)}let Kn=this.trees[xn+1]=this._createTree(Tn);jt&&console.timeEnd(Nn);for(let Cn=xn;Cn>=ln;Cn--){const un=+Date.now();Kn=this.trees[Cn]=this._createTree(this._cluster(Kn,Cn)),jt&&console.log("z%d: %d clusters in %dms",Cn,Kn.numItems,+Date.now()-un)}return jt&&console.timeEnd("total time"),this}getClusters(Wt,jt){let ln=((Wt[0]+180)%360+360)%360-180;const xn=Math.max(-90,Math.min(90,Wt[1]));let Nn=Wt[2]===180?180:((Wt[2]+180)%360+360)%360-180;const Tn=Math.max(-90,Math.min(90,Wt[3]));if(Wt[2]-Wt[0]>=360)ln=-180,Nn=180;else if(ln>Nn){const qt=this.getClusters([ln,xn,180,Tn],jt),yn=this.getClusters([-180,xn,Nn,Tn],jt);return qt.concat(yn)}const Kn=this.trees[this._limitZoom(jt)],Cn=Kn.range(rn(ln),an(Tn),rn(Nn),an(xn)),un=Kn.data,Rt=[];for(const qt of Cn){const yn=this.stride*qt;Rt.push(un[yn+$r]>1?Zt(un,yn,this.clusterProps):this.points[un[yn+Dr]])}return Rt}getChildren(Wt){const jt=this._getOriginId(Wt),ln=this._getOriginZoom(Wt),xn="No cluster with the specified id.",Nn=this.trees[ln];if(!Nn)throw new Error(xn);const Tn=Nn.data;if(jt*this.stride>=Tn.length)throw new Error(xn);const Kn=this.options.radius/(this.options.extent*Math.pow(2,ln-1)),Cn=Nn.within(Tn[jt*this.stride],Tn[jt*this.stride+1],Kn),un=[];for(const Rt of Cn){const qt=Rt*this.stride;Tn[qt+4]===Wt&&un.push(Tn[qt+$r]>1?Zt(Tn,qt,this.clusterProps):this.points[Tn[qt+Dr]])}if(un.length===0)throw new Error(xn);return un}getLeaves(Wt,jt,ln){const xn=[];return this._appendLeaves(xn,Wt,jt=jt||10,ln=ln||0,0),xn}getTile(Wt,jt,ln){const xn=this.trees[this._limitZoom(Wt)],Nn=Math.pow(2,Wt),{extent:Tn,radius:Kn}=this.options,Cn=Kn/Tn,un=(ln-Cn)/Nn,Rt=(ln+1+Cn)/Nn,qt={features:[]};return this._addTileFeatures(xn.range((jt-Cn)/Nn,un,(jt+1+Cn)/Nn,Rt),xn.data,jt,ln,Nn,qt),jt===0&&this._addTileFeatures(xn.range(1-Cn/Nn,un,1,Rt),xn.data,Nn,ln,Nn,qt),jt===Nn-1&&this._addTileFeatures(xn.range(0,un,Cn/Nn,Rt),xn.data,-1,ln,Nn,qt),qt.features.length?qt:null}getClusterExpansionZoom(Wt){let jt=this._getOriginZoom(Wt)-1;for(;jt<=this.options.maxZoom;){const ln=this.getChildren(Wt);if(jt++,ln.length!==1)break;Wt=ln[0].properties.cluster_id}return jt}_appendLeaves(Wt,jt,ln,xn,Nn){const Tn=this.getChildren(jt);for(const Kn of Tn){const Cn=Kn.properties;if(Cn&&Cn.cluster?Nn+Cn.point_count<=xn?Nn+=Cn.point_count:Nn=this._appendLeaves(Wt,Cn.cluster_id,ln,xn,Nn):Nn<xn?Nn++:Wt.push(Kn),Wt.length===ln)break}return Nn}_createTree(Wt){const jt=new yt.av(Wt.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ln=0;ln<Wt.length;ln+=this.stride)jt.add(Wt[ln],Wt[ln+1]);return jt.finish(),jt.data=Wt,jt}_addTileFeatures(Wt,jt,ln,xn,Nn,Tn){for(const Kn of Wt){const Cn=Kn*this.stride,un=jt[Cn+$r]>1;let Rt,qt,yn;if(un)Rt=$t(jt,Cn,this.clusterProps),qt=jt[Cn],yn=jt[Cn+1];else{const ir=this.points[jt[Cn+Dr]];Rt=ir.properties;const[Sr,Nr]=ir.geometry.coordinates;qt=rn(Sr),yn=an(Nr)}const Rn={type:1,geometry:[[Math.round(this.options.extent*(qt*Nn-ln)),Math.round(this.options.extent*(yn*Nn-xn))]],tags:Rt};let zn;zn=un||this.options.generateId?jt[Cn+Dr]:this.points[jt[Cn+Dr]].id,zn!==void 0&&(Rn.id=zn),Tn.features.push(Rn)}}_limitZoom(Wt){return Math.max(this.options.minZoom,Math.min(Math.floor(+Wt),this.options.maxZoom+1))}_cluster(Wt,jt){const{radius:ln,extent:xn,reduce:Nn,minPoints:Tn}=this.options,Kn=ln/(xn*Math.pow(2,jt)),Cn=Wt.data,un=[],Rt=this.stride;for(let qt=0;qt<Cn.length;qt+=Rt){if(Cn[qt+2]<=jt)continue;Cn[qt+2]=jt;const yn=Cn[qt],Rn=Cn[qt+1],zn=Wt.within(Cn[qt],Cn[qt+1],Kn),ir=Cn[qt+$r];let Sr=ir;for(const Nr of zn){const Fr=Nr*Rt;Cn[Fr+2]>jt&&(Sr+=Cn[Fr+$r])}if(Sr>ir&&Sr>=Tn){let Nr,Fr=yn*ir,ps=Rn*ir,Gr=-1;const Ur=((qt/Rt|0)<<5)+(jt+1)+this.points.length;for(const is of zn){const fs=is*Rt;if(Cn[fs+2]<=jt)continue;Cn[fs+2]=jt;const zs=Cn[fs+$r];Fr+=Cn[fs]*zs,ps+=Cn[fs+1]*zs,Cn[fs+4]=Ur,Nn&&(Nr||(Nr=this._map(Cn,qt,!0),Gr=this.clusterProps.length,this.clusterProps.push(Nr)),Nn(Nr,this._map(Cn,fs)))}Cn[qt+4]=Ur,un.push(Fr/Sr,ps/Sr,1/0,Ur,-1,Sr),Nn&&un.push(Gr)}else{for(let Nr=0;Nr<Rt;Nr++)un.push(Cn[qt+Nr]);if(Sr>1)for(const Nr of zn){const Fr=Nr*Rt;if(!(Cn[Fr+2]<=jt)){Cn[Fr+2]=jt;for(let ps=0;ps<Rt;ps++)un.push(Cn[Fr+ps])}}}}return un}_getOriginId(Wt){return Wt-this.points.length>>5}_getOriginZoom(Wt){return(Wt-this.points.length)%32}_map(Wt,jt,ln){if(Wt[jt+$r]>1){const Tn=this.clusterProps[Wt[jt+An]];return ln?Object.assign({},Tn):Tn}const xn=this.points[Wt[jt+Dr]].properties,Nn=this.options.map(xn);return ln&&Nn===xn?Object.assign({},Nn):Nn}}function Zt(_n,Wt,jt){return{type:"Feature",id:_n[Wt+Dr],properties:$t(_n,Wt,jt),geometry:{type:"Point",coordinates:[(ln=_n[Wt],360*(ln-.5)),En(_n[Wt+1])]}};var ln}function $t(_n,Wt,jt){const ln=_n[Wt+$r],xn=ln>=1e4?`${Math.round(ln/1e3)}k`:ln>=1e3?Math.round(ln/100)/10+"k":ln,Nn=_n[Wt+An],Tn=Nn===-1?{}:Object.assign({},jt[Nn]);return Object.assign(Tn,{cluster:!0,cluster_id:_n[Wt+Dr],point_count:ln,point_count_abbreviated:xn})}function rn(_n){return _n/360+.5}function an(_n){const Wt=Math.sin(_n*Math.PI/180),jt=.5-.25*Math.log((1+Wt)/(1-Wt))/Math.PI;return jt<0?0:jt>1?1:jt}function En(_n){const Wt=(180-360*_n)*Math.PI/180;return 360*Math.atan(Math.exp(Wt))/Math.PI-90}function Mn(_n,Wt,jt,ln){let xn=ln;const Nn=Wt+(jt-Wt>>1);let Tn,Kn=jt-Wt;const Cn=_n[Wt],un=_n[Wt+1],Rt=_n[jt],qt=_n[jt+1];for(let yn=Wt+3;yn<jt;yn+=3){const Rn=jn(_n[yn],_n[yn+1],Cn,un,Rt,qt);if(Rn>xn)Tn=yn,xn=Rn;else if(Rn===xn){const zn=Math.abs(yn-Nn);zn<Kn&&(Tn=yn,Kn=zn)}}xn>ln&&(Tn-Wt>3&&Mn(_n,Wt,Tn,ln),_n[Tn+2]=xn,jt-Tn>3&&Mn(_n,Tn,jt,ln))}function jn(_n,Wt,jt,ln,xn,Nn){let Tn=xn-jt,Kn=Nn-ln;if(Tn!==0||Kn!==0){const Cn=((_n-jt)*Tn+(Wt-ln)*Kn)/(Tn*Tn+Kn*Kn);Cn>1?(jt=xn,ln=Nn):Cn>0&&(jt+=Tn*Cn,ln+=Kn*Cn)}return Tn=_n-jt,Kn=Wt-ln,Tn*Tn+Kn*Kn}function dr(_n,Wt,jt,ln){const xn={id:_n??null,type:Wt,geometry:jt,tags:ln,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Wt==="Point"||Wt==="MultiPoint"||Wt==="LineString")cr(xn,jt);else if(Wt==="Polygon")cr(xn,jt[0]);else if(Wt==="MultiLineString")for(const Nn of jt)cr(xn,Nn);else if(Wt==="MultiPolygon")for(const Nn of jt)cr(xn,Nn[0]);return xn}function cr(_n,Wt){for(let jt=0;jt<Wt.length;jt+=3)_n.minX=Math.min(_n.minX,Wt[jt]),_n.minY=Math.min(_n.minY,Wt[jt+1]),_n.maxX=Math.max(_n.maxX,Wt[jt]),_n.maxY=Math.max(_n.maxY,Wt[jt+1])}function wr(_n,Wt,jt,ln){if(!Wt.geometry)return;const xn=Wt.geometry.coordinates;if(xn&&xn.length===0)return;const Nn=Wt.geometry.type,Tn=Math.pow(jt.tolerance/((1<<jt.maxZoom)*jt.extent),2);let Kn=[],Cn=Wt.id;if(jt.promoteId?Cn=Wt.properties[jt.promoteId]:jt.generateId&&(Cn=ln||0),Nn==="Point")Rr(xn,Kn);else if(Nn==="MultiPoint")for(const un of xn)Rr(un,Kn);else if(Nn==="LineString")On(xn,Kn,Tn,!1);else if(Nn==="MultiLineString"){if(jt.lineMetrics){for(const un of xn)Kn=[],On(un,Kn,Tn,!1),_n.push(dr(Cn,"LineString",Kn,Wt.properties));return}Mr(xn,Kn,Tn,!1)}else if(Nn==="Polygon")Mr(xn,Kn,Tn,!0);else{if(Nn!=="MultiPolygon"){if(Nn==="GeometryCollection"){for(const un of Wt.geometry.geometries)wr(_n,{id:Cn,geometry:un,properties:Wt.properties},jt,ln);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const un of xn){const Rt=[];Mr(un,Rt,Tn,!0),Kn.push(Rt)}}_n.push(dr(Cn,Nn,Kn,Wt.properties))}function Rr(_n,Wt){Wt.push(ts(_n[0]),Jr(_n[1]),0)}function On(_n,Wt,jt,ln){let xn,Nn,Tn=0;for(let Cn=0;Cn<_n.length;Cn++){const un=ts(_n[Cn][0]),Rt=Jr(_n[Cn][1]);Wt.push(un,Rt,0),Cn>0&&(Tn+=ln?(xn*Rt-un*Nn)/2:Math.sqrt(Math.pow(un-xn,2)+Math.pow(Rt-Nn,2))),xn=un,Nn=Rt}const Kn=Wt.length-3;Wt[2]=1,Mn(Wt,0,Kn,jt),Wt[Kn+2]=1,Wt.size=Math.abs(Tn),Wt.start=0,Wt.end=Wt.size}function Mr(_n,Wt,jt,ln){for(let xn=0;xn<_n.length;xn++){const Nn=[];On(_n[xn],Nn,jt,ln),Wt.push(Nn)}}function ts(_n){return _n/360+.5}function Jr(_n){const Wt=Math.sin(_n*Math.PI/180),jt=.5-.25*Math.log((1+Wt)/(1-Wt))/Math.PI;return jt<0?0:jt>1?1:jt}function jr(_n,Wt,jt,ln,xn,Nn,Tn,Kn){if(ln/=Wt,Nn>=(jt/=Wt)&&Tn<ln)return _n;if(Tn<jt||Nn>=ln)return null;const Cn=[];for(const un of _n){const Rt=un.geometry;let qt=un.type;const yn=xn===0?un.minX:un.minY,Rn=xn===0?un.maxX:un.maxY;if(yn>=jt&&Rn<ln){Cn.push(un);continue}if(Rn<jt||yn>=ln)continue;let zn=[];if(qt==="Point"||qt==="MultiPoint")ss(Rt,zn,jt,ln,xn);else if(qt==="LineString")Lr(Rt,zn,jt,ln,xn,!1,Kn.lineMetrics);else if(qt==="MultiLineString")or(Rt,zn,jt,ln,xn,!1);else if(qt==="Polygon")or(Rt,zn,jt,ln,xn,!0);else if(qt==="MultiPolygon")for(const ir of Rt){const Sr=[];or(ir,Sr,jt,ln,xn,!0),Sr.length&&zn.push(Sr)}if(zn.length){if(Kn.lineMetrics&&qt==="LineString"){for(const ir of zn)Cn.push(dr(un.id,qt,ir,un.tags));continue}qt!=="LineString"&&qt!=="MultiLineString"||(zn.length===1?(qt="LineString",zn=zn[0]):qt="MultiLineString"),qt!=="Point"&&qt!=="MultiPoint"||(qt=zn.length===3?"Point":"MultiPoint"),Cn.push(dr(un.id,qt,zn,un.tags))}}return Cn.length?Cn:null}function ss(_n,Wt,jt,ln,xn){for(let Nn=0;Nn<_n.length;Nn+=3){const Tn=_n[Nn+xn];Tn>=jt&&Tn<=ln&&Tr(Wt,_n[Nn],_n[Nn+1],_n[Nn+2])}}function Lr(_n,Wt,jt,ln,xn,Nn,Tn){let Kn=hr(_n);const Cn=xn===0?Zr:qr;let un,Rt,qt=_n.start;for(let Sr=0;Sr<_n.length-3;Sr+=3){const Nr=_n[Sr],Fr=_n[Sr+1],ps=_n[Sr+2],Gr=_n[Sr+3],Ur=_n[Sr+4],is=xn===0?Nr:Fr,fs=xn===0?Gr:Ur;let zs=!1;Tn&&(un=Math.sqrt(Math.pow(Nr-Gr,2)+Math.pow(Fr-Ur,2))),is<jt?fs>jt&&(Rt=Cn(Kn,Nr,Fr,Gr,Ur,jt),Tn&&(Kn.start=qt+un*Rt)):is>ln?fs<ln&&(Rt=Cn(Kn,Nr,Fr,Gr,Ur,ln),Tn&&(Kn.start=qt+un*Rt)):Tr(Kn,Nr,Fr,ps),fs<jt&&is>=jt&&(Rt=Cn(Kn,Nr,Fr,Gr,Ur,jt),zs=!0),fs>ln&&is<=ln&&(Rt=Cn(Kn,Nr,Fr,Gr,Ur,ln),zs=!0),!Nn&&zs&&(Tn&&(Kn.end=qt+un*Rt),Wt.push(Kn),Kn=hr(_n)),Tn&&(qt+=un)}let yn=_n.length-3;const Rn=_n[yn],zn=_n[yn+1],ir=xn===0?Rn:zn;ir>=jt&&ir<=ln&&Tr(Kn,Rn,zn,_n[yn+2]),yn=Kn.length-3,Nn&&yn>=3&&(Kn[yn]!==Kn[0]||Kn[yn+1]!==Kn[1])&&Tr(Kn,Kn[0],Kn[1],Kn[2]),Kn.length&&Wt.push(Kn)}function hr(_n){const Wt=[];return Wt.size=_n.size,Wt.start=_n.start,Wt.end=_n.end,Wt}function or(_n,Wt,jt,ln,xn,Nn){for(const Tn of _n)Lr(Tn,Wt,jt,ln,xn,Nn,!1)}function Tr(_n,Wt,jt,ln){_n.push(Wt,jt,ln)}function Zr(_n,Wt,jt,ln,xn,Nn){const Tn=(Nn-Wt)/(ln-Wt);return Tr(_n,Nn,jt+(xn-jt)*Tn,1),Tn}function qr(_n,Wt,jt,ln,xn,Nn){const Tn=(Nn-jt)/(xn-jt);return Tr(_n,Wt+(ln-Wt)*Tn,Nn,1),Tn}function Cr(_n,Wt){const jt=[];for(let ln=0;ln<_n.length;ln++){const xn=_n[ln],Nn=xn.type;let Tn;if(Nn==="Point"||Nn==="MultiPoint"||Nn==="LineString")Tn=ws(xn.geometry,Wt);else if(Nn==="MultiLineString"||Nn==="Polygon"){Tn=[];for(const Kn of xn.geometry)Tn.push(ws(Kn,Wt))}else if(Nn==="MultiPolygon"){Tn=[];for(const Kn of xn.geometry){const Cn=[];for(const un of Kn)Cn.push(ws(un,Wt));Tn.push(Cn)}}jt.push(dr(xn.id,Nn,Tn,xn.tags))}return jt}function ws(_n,Wt){const jt=[];jt.size=_n.size,_n.start!==void 0&&(jt.start=_n.start,jt.end=_n.end);for(let ln=0;ln<_n.length;ln+=3)jt.push(_n[ln]+Wt,_n[ln+1],_n[ln+2]);return jt}function ds(_n,Wt){if(_n.transformed)return _n;const jt=1<<_n.z,ln=_n.x,xn=_n.y;for(const Nn of _n.features){const Tn=Nn.geometry,Kn=Nn.type;if(Nn.geometry=[],Kn===1)for(let Cn=0;Cn<Tn.length;Cn+=2)Nn.geometry.push(Ts(Tn[Cn],Tn[Cn+1],Wt,jt,ln,xn));else for(let Cn=0;Cn<Tn.length;Cn++){const un=[];for(let Rt=0;Rt<Tn[Cn].length;Rt+=2)un.push(Ts(Tn[Cn][Rt],Tn[Cn][Rt+1],Wt,jt,ln,xn));Nn.geometry.push(un)}}return _n.transformed=!0,_n}function Ts(_n,Wt,jt,ln,xn,Nn){return[Math.round(jt*(_n*ln-xn)),Math.round(jt*(Wt*ln-Nn))]}function Ms(_n,Wt,jt,ln,xn){const Nn=Wt===xn.maxZoom?0:xn.tolerance/((1<<Wt)*xn.extent),Tn={features:[],numPoints:0,numSimplified:0,numFeatures:_n.length,source:null,x:jt,y:ln,z:Wt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Kn of _n)Pr(Tn,Kn,Nn,xn);return Tn}function Pr(_n,Wt,jt,ln){const xn=Wt.geometry,Nn=Wt.type,Tn=[];if(_n.minX=Math.min(_n.minX,Wt.minX),_n.minY=Math.min(_n.minY,Wt.minY),_n.maxX=Math.max(_n.maxX,Wt.maxX),_n.maxY=Math.max(_n.maxY,Wt.maxY),Nn==="Point"||Nn==="MultiPoint")for(let Kn=0;Kn<xn.length;Kn+=3)Tn.push(xn[Kn],xn[Kn+1]),_n.numPoints++,_n.numSimplified++;else if(Nn==="LineString")ns(Tn,xn,_n,jt,!1,!1);else if(Nn==="MultiLineString"||Nn==="Polygon")for(let Kn=0;Kn<xn.length;Kn++)ns(Tn,xn[Kn],_n,jt,Nn==="Polygon",Kn===0);else if(Nn==="MultiPolygon")for(let Kn=0;Kn<xn.length;Kn++){const Cn=xn[Kn];for(let un=0;un<Cn.length;un++)ns(Tn,Cn[un],_n,jt,!0,un===0)}if(Tn.length){let Kn=Wt.tags||null;if(Nn==="LineString"&&ln.lineMetrics){Kn={};for(const un in Wt.tags)Kn[un]=Wt.tags[un];Kn.mapbox_clip_start=xn.start/xn.size,Kn.mapbox_clip_end=xn.end/xn.size}const Cn={geometry:Tn,type:Nn==="Polygon"||Nn==="MultiPolygon"?3:Nn==="LineString"||Nn==="MultiLineString"?2:1,tags:Kn};Wt.id!==null&&(Cn.id=Wt.id),_n.features.push(Cn)}}function ns(_n,Wt,jt,ln,xn,Nn){const Tn=ln*ln;if(ln>0&&Wt.size<(xn?Tn:ln))return void(jt.numPoints+=Wt.length/3);const Kn=[];for(let Cn=0;Cn<Wt.length;Cn+=3)(ln===0||Wt[Cn+2]>Tn)&&(jt.numSimplified++,Kn.push(Wt[Cn],Wt[Cn+1])),jt.numPoints++;xn&&function(Cn,un){let Rt=0;for(let qt=0,yn=Cn.length,Rn=yn-2;qt<yn;Rn=qt,qt+=2)Rt+=(Cn[qt]-Cn[Rn])*(Cn[qt+1]+Cn[Rn+1]);if(Rt>0===un)for(let qt=0,yn=Cn.length;qt<yn/2;qt+=2){const Rn=Cn[qt],zn=Cn[qt+1];Cn[qt]=Cn[yn-2-qt],Cn[qt+1]=Cn[yn-1-qt],Cn[yn-2-qt]=Rn,Cn[yn-1-qt]=zn}}(Kn,Nn),_n.push(Kn)}const tr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Yn{constructor(Wt,jt){const ln=(jt=this.options=function(Nn,Tn){for(const Kn in Tn)Nn[Kn]=Tn[Kn];return Nn}(Object.create(tr),jt)).debug;if(ln&&console.time("preprocess data"),jt.maxZoom<0||jt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(jt.promoteId&&jt.generateId)throw new Error("promoteId and generateId cannot be used together.");let xn=function(Nn,Tn){const Kn=[];if(Nn.type==="FeatureCollection")for(let Cn=0;Cn<Nn.features.length;Cn++)wr(Kn,Nn.features[Cn],Tn,Cn);else wr(Kn,Nn.type==="Feature"?Nn:{geometry:Nn},Tn);return Kn}(Wt,jt);this.tiles={},this.tileCoords=[],ln&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",jt.indexMaxZoom,jt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xn=function(Nn,Tn){const Kn=Tn.buffer/Tn.extent;let Cn=Nn;const un=jr(Nn,1,-1-Kn,Kn,0,-1,2,Tn),Rt=jr(Nn,1,1-Kn,2+Kn,0,-1,2,Tn);return(un||Rt)&&(Cn=jr(Nn,1,-Kn,1+Kn,0,-1,2,Tn)||[],un&&(Cn=Cr(un,1).concat(Cn)),Rt&&(Cn=Cn.concat(Cr(Rt,-1)))),Cn}(xn,jt),xn.length&&this.splitTile(xn,0,0,0),ln&&(xn.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Wt,jt,ln,xn,Nn,Tn,Kn){const Cn=[Wt,jt,ln,xn],un=this.options,Rt=un.debug;for(;Cn.length;){xn=Cn.pop(),ln=Cn.pop(),jt=Cn.pop(),Wt=Cn.pop();const qt=1<<jt,yn=qn(jt,ln,xn);let Rn=this.tiles[yn];if(!Rn&&(Rt>1&&console.time("creation"),Rn=this.tiles[yn]=Ms(Wt,jt,ln,xn,un),this.tileCoords.push({z:jt,x:ln,y:xn}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",jt,ln,xn,Rn.numFeatures,Rn.numPoints,Rn.numSimplified),console.timeEnd("creation"));const zs=`z${jt}`;this.stats[zs]=(this.stats[zs]||0)+1,this.total++}if(Rn.source=Wt,Nn==null){if(jt===un.indexMaxZoom||Rn.numPoints<=un.indexMaxPoints)continue}else{if(jt===un.maxZoom||jt===Nn)continue;if(Nn!=null){const zs=Nn-jt;if(ln!==Tn>>zs||xn!==Kn>>zs)continue}}if(Rn.source=null,Wt.length===0)continue;Rt>1&&console.time("clipping");const zn=.5*un.buffer/un.extent,ir=.5-zn,Sr=.5+zn,Nr=1+zn;let Fr=null,ps=null,Gr=null,Ur=null,is=jr(Wt,qt,ln-zn,ln+Sr,0,Rn.minX,Rn.maxX,un),fs=jr(Wt,qt,ln+ir,ln+Nr,0,Rn.minX,Rn.maxX,un);Wt=null,is&&(Fr=jr(is,qt,xn-zn,xn+Sr,1,Rn.minY,Rn.maxY,un),ps=jr(is,qt,xn+ir,xn+Nr,1,Rn.minY,Rn.maxY,un),is=null),fs&&(Gr=jr(fs,qt,xn-zn,xn+Sr,1,Rn.minY,Rn.maxY,un),Ur=jr(fs,qt,xn+ir,xn+Nr,1,Rn.minY,Rn.maxY,un),fs=null),Rt>1&&console.timeEnd("clipping"),Cn.push(Fr||[],jt+1,2*ln,2*xn),Cn.push(ps||[],jt+1,2*ln,2*xn+1),Cn.push(Gr||[],jt+1,2*ln+1,2*xn),Cn.push(Ur||[],jt+1,2*ln+1,2*xn+1)}}getTile(Wt,jt,ln){Wt=+Wt,jt=+jt,ln=+ln;const xn=this.options,{extent:Nn,debug:Tn}=xn;if(Wt<0||Wt>24)return null;const Kn=1<<Wt,Cn=qn(Wt,jt=jt+Kn&Kn-1,ln);if(this.tiles[Cn])return ds(this.tiles[Cn],Nn);Tn>1&&console.log("drilling down to z%d-%d-%d",Wt,jt,ln);let un,Rt=Wt,qt=jt,yn=ln;for(;!un&&Rt>0;)Rt--,qt>>=1,yn>>=1,un=this.tiles[qn(Rt,qt,yn)];return un&&un.source?(Tn>1&&(console.log("found parent tile z%d-%d-%d",Rt,qt,yn),console.time("drilling down")),this.splitTile(un.source,Rt,qt,yn,Wt,jt,ln),Tn>1&&console.timeEnd("drilling down"),this.tiles[Cn]?ds(this.tiles[Cn],Nn):null):null}}function qn(_n,Wt,jt){return 32*((1<<_n)*jt+Wt)+_n}function Er(_n,Wt){return Wt?_n.properties[Wt]:_n.id}function kr(_n,Wt){if(_n==null)return!0;if(_n.type==="Feature")return Er(_n,Wt)!=null;if(_n.type==="FeatureCollection"){const jt=new Set;for(const ln of _n.features){const xn=Er(ln,Wt);if(xn==null||jt.has(xn))return!1;jt.add(xn)}return!0}return!1}function Us(_n,Wt){const jt=new Map;if(_n!=null)if(_n.type==="Feature")jt.set(Er(_n,Wt),_n);else for(const ln of _n.features)jt.set(Er(ln,Wt),ln);return jt}class lo extends Lt{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Wt,jt){return yt._(this,void 0,void 0,function*(){const ln=Wt.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const xn=this._geoJSONIndex.getTile(ln.z,ln.x,ln.y);if(!xn)return null;const Nn=new class{constructor(Kn){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=yt.X,this.length=Kn.length,this._features=Kn}feature(Kn){return new class{constructor(Cn){this._feature=Cn,this.extent=yt.X,this.type=Cn.type,this.properties=Cn.tags,"id"in Cn&&!isNaN(Cn.id)&&(this.id=parseInt(Cn.id,10))}loadGeometry(){if(this._feature.type===1){const Cn=[];for(const un of this._feature.geometry)Cn.push([new yt.P(un[0],un[1])]);return Cn}{const Cn=[];for(const un of this._feature.geometry){const Rt=[];for(const qt of un)Rt.push(new yt.P(qt[0],qt[1]));Cn.push(Rt)}return Cn}}toGeoJSON(Cn,un,Rt){return tn.call(this,Cn,un,Rt)}}(this._features[Kn])}}(xn.features);let Tn=br(Nn);return Tn.byteOffset===0&&Tn.byteLength===Tn.buffer.byteLength||(Tn=new Uint8Array(Tn)),{vectorTile:Nn,rawData:Tn.buffer}})}loadData(Wt){return yt._(this,void 0,void 0,function*(){var jt;(jt=this._pendingRequest)===null||jt===void 0||jt.abort();const ln=!!(Wt&&Wt.request&&Wt.request.collectResourceTiming)&&new yt.bv(Wt.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Wt,this._pendingRequest),this._geoJSONIndex=Wt.cluster?new Nt(function({superclusterOptions:Tn,clusterProperties:Kn}){if(!Kn||!Tn)return Tn;const Cn={},un={},Rt={accumulated:null,zoom:0},qt={properties:null},yn=Object.keys(Kn);for(const Rn of yn){const[zn,ir]=Kn[Rn],Sr=yt.bC(ir),Nr=yt.bC(typeof zn=="string"?[zn,["accumulated"],["get",Rn]]:zn);Cn[Rn]=Sr.value,un[Rn]=Nr.value}return Tn.map=Rn=>{qt.properties=Rn;const zn={};for(const ir of yn)zn[ir]=Cn[ir].evaluate(Rt,qt);return zn},Tn.reduce=(Rn,zn)=>{qt.properties=zn;for(const ir of yn)Rt.accumulated=Rn[ir],Rn[ir]=un[ir].evaluate(Rt,qt)},Tn}(Wt)).load((yield this._pendingData).features):(xn=yield this._pendingData,new Yn(xn,Wt.geojsonVtOptions)),this.loaded={};const Nn={};if(ln){const Tn=ln.finish();Tn&&(Nn.resourceTiming={},Nn.resourceTiming[Wt.source]=JSON.parse(JSON.stringify(Tn)))}return Nn}catch(Nn){if(delete this._pendingRequest,yt.bB(Nn))return{abandoned:!0};throw Nn}var xn})}getData(){return yt._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Wt){const jt=this.loaded;return jt&&jt[Wt.uid]?super.reloadTile(Wt):this.loadTile(Wt)}loadAndProcessGeoJSON(Wt,jt){return yt._(this,void 0,void 0,function*(){let ln=yield this.loadGeoJSON(Wt,jt);if(delete this._pendingRequest,typeof ln!="object")throw new Error(`Input data given to '${Wt.source}' is not a valid GeoJSON object.`);if(sn(ln,!0),Wt.filter){const xn=yt.bC(Wt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xn.result==="error")throw new Error(xn.value.map(Tn=>`${Tn.key}: ${Tn.message}`).join(", "));ln={type:"FeatureCollection",features:ln.features.filter(Tn=>xn.value.evaluate({zoom:0},Tn))}}return ln})}loadGeoJSON(Wt,jt){return yt._(this,void 0,void 0,function*(){const{promoteId:ln}=Wt;if(Wt.request){const xn=yield yt.h(Wt.request,jt);return this._dataUpdateable=kr(xn.data,ln)?Us(xn.data,ln):void 0,xn.data}if(typeof Wt.data=="string")try{const xn=JSON.parse(Wt.data);return this._dataUpdateable=kr(xn,ln)?Us(xn,ln):void 0,xn}catch{throw new Error(`Input data given to '${Wt.source}' is not a valid GeoJSON object.`)}if(!Wt.dataDiff)throw new Error(`Input data given to '${Wt.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Wt.source}`);return function(xn,Nn,Tn){var Kn,Cn,un,Rt;if(Nn.removeAll&&xn.clear(),Nn.remove)for(const qt of Nn.remove)xn.delete(qt);if(Nn.add)for(const qt of Nn.add){const yn=Er(qt,Tn);yn!=null&&xn.set(yn,qt)}if(Nn.update)for(const qt of Nn.update){let yn=xn.get(qt.id);if(yn==null)continue;const Rn=!qt.removeAllProperties&&(((Kn=qt.removeProperties)===null||Kn===void 0?void 0:Kn.length)>0||((Cn=qt.addOrUpdateProperties)===null||Cn===void 0?void 0:Cn.length)>0);if((qt.newGeometry||qt.removeAllProperties||Rn)&&(yn=Object.assign({},yn),xn.set(qt.id,yn),Rn&&(yn.properties=Object.assign({},yn.properties))),qt.newGeometry&&(yn.geometry=qt.newGeometry),qt.removeAllProperties)yn.properties={};else if(((un=qt.removeProperties)===null||un===void 0?void 0:un.length)>0)for(const zn of qt.removeProperties)Object.prototype.hasOwnProperty.call(yn.properties,zn)&&delete yn.properties[zn];if(((Rt=qt.addOrUpdateProperties)===null||Rt===void 0?void 0:Rt.length)>0)for(const{key:zn,value:ir}of qt.addOrUpdateProperties)yn.properties[zn]=ir}}(this._dataUpdateable,Wt.dataDiff,ln),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Wt){return yt._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Wt){return this._geoJSONIndex.getClusterExpansionZoom(Wt.clusterId)}getClusterChildren(Wt){return this._geoJSONIndex.getChildren(Wt.clusterId)}getClusterLeaves(Wt){return this._geoJSONIndex.getLeaves(Wt.clusterId,Wt.limit,Wt.offset)}}class rr{constructor(Wt){this.self=Wt,this.actor=new yt.F(Wt),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(jt,ln)=>{if(this.externalWorkerSourceTypes[jt])throw new Error(`Worker source with name "${jt}" already registered.`);this.externalWorkerSourceTypes[jt]=ln},this.self.addProtocol=yt.bi,this.self.removeProtocol=yt.bj,this.self.registerRTLTextPlugin=jt=>{if(yt.bD.isParsed())throw new Error("RTL text plugin already registered.");yt.bD.setMethods(jt)},this.actor.registerMessageHandler("LDT",(jt,ln)=>this._getDEMWorkerSource(jt,ln.source).loadTile(ln)),this.actor.registerMessageHandler("RDT",(jt,ln)=>yt._(this,void 0,void 0,function*(){this._getDEMWorkerSource(jt,ln.source).removeTile(ln)})),this.actor.registerMessageHandler("GCEZ",(jt,ln)=>yt._(this,void 0,void 0,function*(){return this._getWorkerSource(jt,ln.type,ln.source).getClusterExpansionZoom(ln)})),this.actor.registerMessageHandler("GCC",(jt,ln)=>yt._(this,void 0,void 0,function*(){return this._getWorkerSource(jt,ln.type,ln.source).getClusterChildren(ln)})),this.actor.registerMessageHandler("GCL",(jt,ln)=>yt._(this,void 0,void 0,function*(){return this._getWorkerSource(jt,ln.type,ln.source).getClusterLeaves(ln)})),this.actor.registerMessageHandler("LD",(jt,ln)=>this._getWorkerSource(jt,ln.type,ln.source).loadData(ln)),this.actor.registerMessageHandler("GD",(jt,ln)=>this._getWorkerSource(jt,ln.type,ln.source).getData()),this.actor.registerMessageHandler("LT",(jt,ln)=>this._getWorkerSource(jt,ln.type,ln.source).loadTile(ln)),this.actor.registerMessageHandler("RT",(jt,ln)=>this._getWorkerSource(jt,ln.type,ln.source).reloadTile(ln)),this.actor.registerMessageHandler("AT",(jt,ln)=>this._getWorkerSource(jt,ln.type,ln.source).abortTile(ln)),this.actor.registerMessageHandler("RMT",(jt,ln)=>this._getWorkerSource(jt,ln.type,ln.source).removeTile(ln)),this.actor.registerMessageHandler("RS",(jt,ln)=>yt._(this,void 0,void 0,function*(){if(!this.workerSources[jt]||!this.workerSources[jt][ln.type]||!this.workerSources[jt][ln.type][ln.source])return;const xn=this.workerSources[jt][ln.type][ln.source];delete this.workerSources[jt][ln.type][ln.source],xn.removeSource!==void 0&&xn.removeSource(ln)})),this.actor.registerMessageHandler("RM",jt=>yt._(this,void 0,void 0,function*(){delete this.layerIndexes[jt],delete this.availableImages[jt],delete this.workerSources[jt],delete this.demWorkerSources[jt]})),this.actor.registerMessageHandler("SR",(jt,ln)=>yt._(this,void 0,void 0,function*(){this.referrer=ln})),this.actor.registerMessageHandler("SRPS",(jt,ln)=>this._syncRTLPluginState(jt,ln)),this.actor.registerMessageHandler("IS",(jt,ln)=>yt._(this,void 0,void 0,function*(){this.self.importScripts(ln)})),this.actor.registerMessageHandler("SI",(jt,ln)=>this._setImages(jt,ln)),this.actor.registerMessageHandler("UL",(jt,ln)=>yt._(this,void 0,void 0,function*(){this._getLayerIndex(jt).update(ln.layers,ln.removedIds)})),this.actor.registerMessageHandler("SL",(jt,ln)=>yt._(this,void 0,void 0,function*(){this._getLayerIndex(jt).replace(ln)}))}_setImages(Wt,jt){return yt._(this,void 0,void 0,function*(){this.availableImages[Wt]=jt;for(const ln in this.workerSources[Wt]){const xn=this.workerSources[Wt][ln];for(const Nn in xn)xn[Nn].availableImages=jt}})}_syncRTLPluginState(Wt,jt){return yt._(this,void 0,void 0,function*(){if(yt.bD.isParsed())return yt.bD.getState();if(jt.pluginStatus!=="loading")return yt.bD.setState(jt),jt;const ln=jt.pluginURL;if(this.self.importScripts(ln),yt.bD.isParsed()){const xn={pluginStatus:"loaded",pluginURL:ln};return yt.bD.setState(xn),xn}throw yt.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ln}`)})}_getAvailableImages(Wt){let jt=this.availableImages[Wt];return jt||(jt=[]),jt}_getLayerIndex(Wt){let jt=this.layerIndexes[Wt];return jt||(jt=this.layerIndexes[Wt]=new ct),jt}_getWorkerSource(Wt,jt,ln){if(this.workerSources[Wt]||(this.workerSources[Wt]={}),this.workerSources[Wt][jt]||(this.workerSources[Wt][jt]={}),!this.workerSources[Wt][jt][ln]){const xn={sendAsync:(Nn,Tn)=>(Nn.targetMapId=Wt,this.actor.sendAsync(Nn,Tn))};switch(jt){case"vector":this.workerSources[Wt][jt][ln]=new Lt(xn,this._getLayerIndex(Wt),this._getAvailableImages(Wt));break;case"geojson":this.workerSources[Wt][jt][ln]=new lo(xn,this._getLayerIndex(Wt),this._getAvailableImages(Wt));break;default:this.workerSources[Wt][jt][ln]=new this.externalWorkerSourceTypes[jt](xn,this._getLayerIndex(Wt),this._getAvailableImages(Wt))}}return this.workerSources[Wt][jt][ln]}_getDEMWorkerSource(Wt,jt){return this.demWorkerSources[Wt]||(this.demWorkerSources[Wt]={}),this.demWorkerSources[Wt][jt]||(this.demWorkerSources[Wt][jt]=new Mt),this.demWorkerSources[Wt][jt]}}return yt.i(self)&&(self.worker=new rr(self)),rr}),ut("index",["exports","./shared"],function(yt,ct){var At="4.7.1";let Pt,kt;const Lt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:gt=>new Promise((tt,ot)=>{const ht=requestAnimationFrame(tt);gt.signal.addEventListener("abort",()=>{cancelAnimationFrame(ht),ot(ct.c())})}),getImageData(gt,tt=0){return this.getImageCanvasContext(gt).getImageData(-tt,-tt,gt.width+2*tt,gt.height+2*tt)},getImageCanvasContext(gt){const tt=window.document.createElement("canvas"),ot=tt.getContext("2d",{willReadFrequently:!0});if(!ot)throw new Error("failed to create canvas 2d context");return tt.width=gt.width,tt.height=gt.height,ot.drawImage(gt,0,0,gt.width,gt.height),ot},resolveURL:gt=>(Pt||(Pt=document.createElement("a")),Pt.href=gt,Pt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(kt==null&&(kt=matchMedia("(prefers-reduced-motion: reduce)")),kt.matches)}};class Mt{static testProp(tt){if(!Mt.docStyle)return tt[0];for(let ot=0;ot<tt.length;ot++)if(tt[ot]in Mt.docStyle)return tt[ot];return tt[0]}static create(tt,ot,ht){const dt=window.document.createElement(tt);return ot!==void 0&&(dt.className=ot),ht&&ht.appendChild(dt),dt}static createNS(tt,ot){return window.document.createElementNS(tt,ot)}static disableDrag(){Mt.docStyle&&Mt.selectProp&&(Mt.userSelect=Mt.docStyle[Mt.selectProp],Mt.docStyle[Mt.selectProp]="none")}static enableDrag(){Mt.docStyle&&Mt.selectProp&&(Mt.docStyle[Mt.selectProp]=Mt.userSelect)}static setTransform(tt,ot){tt.style[Mt.transformProp]=ot}static addEventListener(tt,ot,ht,dt={}){tt.addEventListener(ot,ht,"passive"in dt?dt:dt.capture)}static removeEventListener(tt,ot,ht,dt={}){tt.removeEventListener(ot,ht,"passive"in dt?dt:dt.capture)}static suppressClickInternal(tt){tt.preventDefault(),tt.stopPropagation(),window.removeEventListener("click",Mt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Mt.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Mt.suppressClickInternal,!0)},0)}static getScale(tt){const ot=tt.getBoundingClientRect();return{x:ot.width/tt.offsetWidth||1,y:ot.height/tt.offsetHeight||1,boundingClientRect:ot}}static getPoint(tt,ot,ht){const dt=ot.boundingClientRect;return new ct.P((ht.clientX-dt.left)/ot.x-tt.clientLeft,(ht.clientY-dt.top)/ot.y-tt.clientTop)}static mousePos(tt,ot){const ht=Mt.getScale(tt);return Mt.getPoint(tt,ht,ot)}static touchPos(tt,ot){const ht=[],dt=Mt.getScale(tt);for(let mt=0;mt<ot.length;mt++)ht.push(Mt.getPoint(tt,dt,ot[mt]));return ht}static mouseButton(tt){return tt.button}static remove(tt){tt.parentNode&&tt.parentNode.removeChild(tt)}}Mt.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Mt.selectProp=Mt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Mt.transformProp=Mt.testProp(["transform","WebkitTransform"]);const Qt={supported:!1,testSupport:function(gt){!tn&&sn&&(Bt?zt(gt):Jt=gt)}};let Jt,sn,tn=!1,Bt=!1;function zt(gt){const tt=gt.createTexture();gt.bindTexture(gt.TEXTURE_2D,tt);try{if(gt.texImage2D(gt.TEXTURE_2D,0,gt.RGBA,gt.RGBA,gt.UNSIGNED_BYTE,sn),gt.isContextLost())return;Qt.supported=!0}catch{}gt.deleteTexture(tt),tn=!0}var Ht;typeof document<"u"&&(sn=document.createElement("img"),sn.onload=()=>{Jt&&zt(Jt),Jt=null,Bt=!0},sn.onerror=()=>{tn=!0,Jt=null},sn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(gt){let tt,ot,ht,dt;gt.resetRequestQueue=()=>{tt=[],ot=0,ht=0,dt={}},gt.addThrottleControl=Tt=>{const Ft=ht++;return dt[Ft]=Tt,Ft},gt.removeThrottleControl=Tt=>{delete dt[Tt],wt()},gt.getImage=(Tt,Ft,Gt=!0)=>new Promise((Xt,pn)=>{Qt.supported&&(Tt.headers||(Tt.headers={}),Tt.headers.accept="image/webp,*/*"),ct.e(Tt,{type:"image"}),tt.push({abortController:Ft,requestParameters:Tt,supportImageRefresh:Gt,state:"queued",onError:wn=>{pn(wn)},onSuccess:wn=>{Xt(wn)}}),wt()});const mt=Tt=>ct._(this,void 0,void 0,function*(){Tt.state="running";const{requestParameters:Ft,supportImageRefresh:Gt,onError:Xt,onSuccess:pn,abortController:wn}=Tt,kn=Gt===!1&&!ct.i(self)&&!ct.g(Ft.url)&&(!Ft.headers||Object.keys(Ft.headers).reduce((Gn,Qn)=>Gn&&Qn==="accept",!0));ot++;const Fn=kn?St(Ft,wn):ct.m(Ft,wn);try{const Gn=yield Fn;delete Tt.abortController,Tt.state="completed",Gn.data instanceof HTMLImageElement||ct.b(Gn.data)?pn(Gn):Gn.data&&pn({data:yield(Hn=Gn.data,typeof createImageBitmap=="function"?ct.d(Hn):ct.f(Hn)),cacheControl:Gn.cacheControl,expires:Gn.expires})}catch(Gn){delete Tt.abortController,Xt(Gn)}finally{ot--,wt()}var Hn}),wt=()=>{const Tt=(()=>{for(const Ft of Object.keys(dt))if(dt[Ft]())return!0;return!1})()?ct.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:ct.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Ft=ot;Ft<Tt&&tt.length>0;Ft++){const Gt=tt.shift();Gt.abortController.signal.aborted?Ft--:mt(Gt)}},St=(Tt,Ft)=>new Promise((Gt,Xt)=>{const pn=new Image,wn=Tt.url,kn=Tt.credentials;kn&&kn==="include"?pn.crossOrigin="use-credentials":(kn&&kn==="same-origin"||!ct.s(wn))&&(pn.crossOrigin="anonymous"),Ft.signal.addEventListener("abort",()=>{pn.src="",Xt(ct.c())}),pn.fetchPriority="high",pn.onload=()=>{pn.onerror=pn.onload=null,Gt({data:pn})},pn.onerror=()=>{pn.onerror=pn.onload=null,Ft.signal.aborted||Xt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},pn.src=wn})}(Ht||(Ht={})),Ht.resetRequestQueue();class nn{constructor(tt){this._transformRequestFn=tt}transformRequest(tt,ot){return this._transformRequestFn&&this._transformRequestFn(tt,ot)||{url:tt}}setTransformRequest(tt){this._transformRequestFn=tt}}function Ot(gt){var tt=new ct.A(3);return tt[0]=gt[0],tt[1]=gt[1],tt[2]=gt[2],tt}var Kt,mn=function(gt,tt,ot){return gt[0]=tt[0]-ot[0],gt[1]=tt[1]-ot[1],gt[2]=tt[2]-ot[2],gt};Kt=new ct.A(3),ct.A!=Float32Array&&(Kt[0]=0,Kt[1]=0,Kt[2]=0);var hn=function(gt){var tt=gt[0],ot=gt[1];return tt*tt+ot*ot};function Yt(gt){const tt=[];if(typeof gt=="string")tt.push({id:"default",url:gt});else if(gt&&gt.length>0){const ot=[];for(const{id:ht,url:dt}of gt){const mt=`${ht}${dt}`;ot.indexOf(mt)===-1&&(ot.push(mt),tt.push({id:ht,url:dt}))}}return tt}function vn(gt,tt,ot){const ht=gt.split("?");return ht[0]+=`${tt}${ot}`,ht.join("?")}(function(){var gt=new ct.A(2);ct.A!=Float32Array&&(gt[0]=0,gt[1]=0)})();class fn{constructor(tt,ot,ht,dt){this.context=tt,this.format=ht,this.texture=tt.gl.createTexture(),this.update(ot,dt)}update(tt,ot,ht){const{width:dt,height:mt}=tt,wt=!(this.size&&this.size[0]===dt&&this.size[1]===mt||ht),{context:St}=this,{gl:Tt}=St;if(this.useMipmap=!!(ot&&ot.useMipmap),Tt.bindTexture(Tt.TEXTURE_2D,this.texture),St.pixelStoreUnpackFlipY.set(!1),St.pixelStoreUnpack.set(1),St.pixelStoreUnpackPremultiplyAlpha.set(this.format===Tt.RGBA&&(!ot||ot.premultiply!==!1)),wt)this.size=[dt,mt],tt instanceof HTMLImageElement||tt instanceof HTMLCanvasElement||tt instanceof HTMLVideoElement||tt instanceof ImageData||ct.b(tt)?Tt.texImage2D(Tt.TEXTURE_2D,0,this.format,this.format,Tt.UNSIGNED_BYTE,tt):Tt.texImage2D(Tt.TEXTURE_2D,0,this.format,dt,mt,0,this.format,Tt.UNSIGNED_BYTE,tt.data);else{const{x:Ft,y:Gt}=ht||{x:0,y:0};tt instanceof HTMLImageElement||tt instanceof HTMLCanvasElement||tt instanceof HTMLVideoElement||tt instanceof ImageData||ct.b(tt)?Tt.texSubImage2D(Tt.TEXTURE_2D,0,Ft,Gt,Tt.RGBA,Tt.UNSIGNED_BYTE,tt):Tt.texSubImage2D(Tt.TEXTURE_2D,0,Ft,Gt,dt,mt,Tt.RGBA,Tt.UNSIGNED_BYTE,tt.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Tt.generateMipmap(Tt.TEXTURE_2D)}bind(tt,ot,ht){const{context:dt}=this,{gl:mt}=dt;mt.bindTexture(mt.TEXTURE_2D,this.texture),ht!==mt.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(ht=mt.LINEAR),tt!==this.filter&&(mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_MAG_FILTER,tt),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_MIN_FILTER,ht||tt),this.filter=tt),ot!==this.wrap&&(mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_WRAP_S,ot),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_WRAP_T,ot),this.wrap=ot)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:tt}=this.context;tt.deleteTexture(this.texture),this.texture=null}}function Wn(gt){const{userImage:tt}=gt;return!!(tt&&tt.render&&tt.render())&&(gt.data.replace(new Uint8Array(tt.data.buffer)),!0)}class Xn extends ct.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new ct.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(tt){if(this.loaded!==tt&&(this.loaded=tt,tt)){for(const{ids:ot,promiseResolve:ht}of this.requestors)ht(this._getImagesForIds(ot));this.requestors=[]}}getImage(tt){const ot=this.images[tt];if(ot&&!ot.data&&ot.spriteData){const ht=ot.spriteData;ot.data=new ct.R({width:ht.width,height:ht.height},ht.context.getImageData(ht.x,ht.y,ht.width,ht.height).data),ot.spriteData=null}return ot}addImage(tt,ot){if(this.images[tt])throw new Error(`Image id ${tt} already exist, use updateImage instead`);this._validate(tt,ot)&&(this.images[tt]=ot)}_validate(tt,ot){let ht=!0;const dt=ot.data||ot.spriteData;return this._validateStretch(ot.stretchX,dt&&dt.width)||(this.fire(new ct.j(new Error(`Image "${tt}" has invalid "stretchX" value`))),ht=!1),this._validateStretch(ot.stretchY,dt&&dt.height)||(this.fire(new ct.j(new Error(`Image "${tt}" has invalid "stretchY" value`))),ht=!1),this._validateContent(ot.content,ot)||(this.fire(new ct.j(new Error(`Image "${tt}" has invalid "content" value`))),ht=!1),ht}_validateStretch(tt,ot){if(!tt)return!0;let ht=0;for(const dt of tt){if(dt[0]<ht||dt[1]<dt[0]||ot<dt[1])return!1;ht=dt[1]}return!0}_validateContent(tt,ot){if(!tt)return!0;if(tt.length!==4)return!1;const ht=ot.spriteData,dt=ht&&ht.width||ot.data.width,mt=ht&&ht.height||ot.data.height;return!(tt[0]<0||dt<tt[0]||tt[1]<0||mt<tt[1]||tt[2]<0||dt<tt[2]||tt[3]<0||mt<tt[3]||tt[2]<tt[0]||tt[3]<tt[1])}updateImage(tt,ot,ht=!0){const dt=this.getImage(tt);if(ht&&(dt.data.width!==ot.data.width||dt.data.height!==ot.data.height))throw new Error(`size mismatch between old image (${dt.data.width}x${dt.data.height}) and new image (${ot.data.width}x${ot.data.height}).`);ot.version=dt.version+1,this.images[tt]=ot,this.updatedImages[tt]=!0}removeImage(tt){const ot=this.images[tt];delete this.images[tt],delete this.patterns[tt],ot.userImage&&ot.userImage.onRemove&&ot.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(tt){return new Promise((ot,ht)=>{let dt=!0;if(!this.isLoaded())for(const mt of tt)this.images[mt]||(dt=!1);this.isLoaded()||dt?ot(this._getImagesForIds(tt)):this.requestors.push({ids:tt,promiseResolve:ot})})}_getImagesForIds(tt){const ot={};for(const ht of tt){let dt=this.getImage(ht);dt||(this.fire(new ct.k("styleimagemissing",{id:ht})),dt=this.getImage(ht)),dt?ot[ht]={data:dt.data.clone(),pixelRatio:dt.pixelRatio,sdf:dt.sdf,version:dt.version,stretchX:dt.stretchX,stretchY:dt.stretchY,content:dt.content,textFitWidth:dt.textFitWidth,textFitHeight:dt.textFitHeight,hasRenderCallback:!!(dt.userImage&&dt.userImage.render)}:ct.w(`Image "${ht}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return ot}getPixelSize(){const{width:tt,height:ot}=this.atlasImage;return{width:tt,height:ot}}getPattern(tt){const ot=this.patterns[tt],ht=this.getImage(tt);if(!ht)return null;if(ot&&ot.position.version===ht.version)return ot.position;if(ot)ot.position.version=ht.version;else{const dt={w:ht.data.width+2,h:ht.data.height+2,x:0,y:0},mt=new ct.I(dt,ht);this.patterns[tt]={bin:dt,position:mt}}return this._updatePatternAtlas(),this.patterns[tt].position}bind(tt){const ot=tt.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new fn(tt,this.atlasImage,ot.RGBA),this.atlasTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE)}_updatePatternAtlas(){const tt=[];for(const mt in this.patterns)tt.push(this.patterns[mt].bin);const{w:ot,h:ht}=ct.p(tt),dt=this.atlasImage;dt.resize({width:ot||1,height:ht||1});for(const mt in this.patterns){const{bin:wt}=this.patterns[mt],St=wt.x+1,Tt=wt.y+1,Ft=this.getImage(mt).data,Gt=Ft.width,Xt=Ft.height;ct.R.copy(Ft,dt,{x:0,y:0},{x:St,y:Tt},{width:Gt,height:Xt}),ct.R.copy(Ft,dt,{x:0,y:Xt-1},{x:St,y:Tt-1},{width:Gt,height:1}),ct.R.copy(Ft,dt,{x:0,y:0},{x:St,y:Tt+Xt},{width:Gt,height:1}),ct.R.copy(Ft,dt,{x:Gt-1,y:0},{x:St-1,y:Tt},{width:1,height:Xt}),ct.R.copy(Ft,dt,{x:0,y:0},{x:St+Gt,y:Tt},{width:1,height:Xt})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(tt){for(const ot of tt){if(this.callbackDispatchedThisFrame[ot])continue;this.callbackDispatchedThisFrame[ot]=!0;const ht=this.getImage(ot);ht||ct.w(`Image with ID: "${ot}" was not found`),Wn(ht)&&this.updateImage(ot,ht)}}}const Sn=1e20;function _i(gt,tt,ot,ht,dt,mt,wt,St,Tt){for(let Ft=tt;Ft<tt+ht;Ft++)gr(gt,ot*mt+Ft,mt,dt,wt,St,Tt);for(let Ft=ot;Ft<ot+dt;Ft++)gr(gt,Ft*mt+tt,1,ht,wt,St,Tt)}function gr(gt,tt,ot,ht,dt,mt,wt){mt[0]=0,wt[0]=-Sn,wt[1]=Sn,dt[0]=gt[tt];for(let St=1,Tt=0,Ft=0;St<ht;St++){dt[St]=gt[tt+St*ot];const Gt=St*St;do{const Xt=mt[Tt];Ft=(dt[St]-dt[Xt]+Gt-Xt*Xt)/(St-Xt)/2}while(Ft<=wt[Tt]&&--Tt>-1);Tt++,mt[Tt]=St,wt[Tt]=Ft,wt[Tt+1]=Sn}for(let St=0,Tt=0;St<ht;St++){for(;wt[Tt+1]<St;)Tt++;const Ft=mt[Tt],Gt=St-Ft;gt[tt+St*ot]=dt[Ft]+Gt*Gt}}class br{constructor(tt,ot){this.requestManager=tt,this.localIdeographFontFamily=ot,this.entries={}}setURL(tt){this.url=tt}getGlyphs(tt){return ct._(this,void 0,void 0,function*(){const ot=[];for(const mt in tt)for(const wt of tt[mt])ot.push(this._getAndCacheGlyphsPromise(mt,wt));const ht=yield Promise.all(ot),dt={};for(const{stack:mt,id:wt,glyph:St}of ht)dt[mt]||(dt[mt]={}),dt[mt][wt]=St&&{id:St.id,bitmap:St.bitmap.clone(),metrics:St.metrics};return dt})}_getAndCacheGlyphsPromise(tt,ot){return ct._(this,void 0,void 0,function*(){let ht=this.entries[tt];ht||(ht=this.entries[tt]={glyphs:{},requests:{},ranges:{}});let dt=ht.glyphs[ot];if(dt!==void 0)return{stack:tt,id:ot,glyph:dt};if(dt=this._tinySDF(ht,tt,ot),dt)return ht.glyphs[ot]=dt,{stack:tt,id:ot,glyph:dt};const mt=Math.floor(ot/256);if(256*mt>65535)throw new Error("glyphs > 65535 not supported");if(ht.ranges[mt])return{stack:tt,id:ot,glyph:dt};if(!this.url)throw new Error("glyphsUrl is not set");if(!ht.requests[mt]){const St=br.loadGlyphRange(tt,mt,this.url,this.requestManager);ht.requests[mt]=St}const wt=yield ht.requests[mt];for(const St in wt)this._doesCharSupportLocalGlyph(+St)||(ht.glyphs[+St]=wt[+St]);return ht.ranges[mt]=!0,{stack:tt,id:ot,glyph:wt[ot]||null}})}_doesCharSupportLocalGlyph(tt){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(tt))}_tinySDF(tt,ot,ht){const dt=this.localIdeographFontFamily;if(!dt||!this._doesCharSupportLocalGlyph(ht))return;let mt=tt.tinySDF;if(!mt){let St="400";/bold/i.test(ot)?St="900":/medium/i.test(ot)?St="500":/light/i.test(ot)&&(St="200"),mt=tt.tinySDF=new br.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:dt,fontWeight:St})}const wt=mt.draw(String.fromCharCode(ht));return{id:ht,bitmap:new ct.o({width:wt.width||60,height:wt.height||60},wt.data),metrics:{width:wt.glyphWidth/2||24,height:wt.glyphHeight/2||24,left:wt.glyphLeft/2+.5||0,top:wt.glyphTop/2-27.5||-8,advance:wt.glyphAdvance/2||24,isDoubleResolution:!0}}}}br.loadGlyphRange=function(gt,tt,ot,ht){return ct._(this,void 0,void 0,function*(){const dt=256*tt,mt=dt+255,wt=ht.transformRequest(ot.replace("{fontstack}",gt).replace("{range}",`${dt}-${mt}`),"Glyphs"),St=yield ct.l(wt,new AbortController);if(!St||!St.data)throw new Error(`Could not load glyph range. range: ${tt}, ${dt}-${mt}`);const Tt={};for(const Ft of ct.n(St.data))Tt[Ft.id]=Ft;return Tt})},br.TinySDF=class{constructor({fontSize:gt=24,buffer:tt=3,radius:ot=8,cutoff:ht=.25,fontFamily:dt="sans-serif",fontWeight:mt="normal",fontStyle:wt="normal"}={}){this.buffer=tt,this.cutoff=ht,this.radius=ot;const St=this.size=gt+4*tt,Tt=this._createCanvas(St),Ft=this.ctx=Tt.getContext("2d",{willReadFrequently:!0});Ft.font=`${wt} ${mt} ${gt}px ${dt}`,Ft.textBaseline="alphabetic",Ft.textAlign="left",Ft.fillStyle="black",this.gridOuter=new Float64Array(St*St),this.gridInner=new Float64Array(St*St),this.f=new Float64Array(St),this.z=new Float64Array(St+1),this.v=new Uint16Array(St)}_createCanvas(gt){const tt=document.createElement("canvas");return tt.width=tt.height=gt,tt}draw(gt){const{width:tt,actualBoundingBoxAscent:ot,actualBoundingBoxDescent:ht,actualBoundingBoxLeft:dt,actualBoundingBoxRight:mt}=this.ctx.measureText(gt),wt=Math.ceil(ot),St=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(mt-dt))),Tt=Math.min(this.size-this.buffer,wt+Math.ceil(ht)),Ft=St+2*this.buffer,Gt=Tt+2*this.buffer,Xt=Math.max(Ft*Gt,0),pn=new Uint8ClampedArray(Xt),wn={data:pn,width:Ft,height:Gt,glyphWidth:St,glyphHeight:Tt,glyphTop:wt,glyphLeft:0,glyphAdvance:tt};if(St===0||Tt===0)return wn;const{ctx:kn,buffer:Fn,gridInner:Hn,gridOuter:Gn}=this;kn.clearRect(Fn,Fn,St,Tt),kn.fillText(gt,Fn,Fn+wt);const Qn=kn.getImageData(Fn,Fn,St,Tt);Gn.fill(Sn,0,Xt),Hn.fill(0,0,Xt);for(let Dn=0;Dn<Tt;Dn++)for(let ar=0;ar<St;ar++){const mr=Qn.data[4*(Dn*St+ar)+3]/255;if(mr===0)continue;const Ar=(Dn+Fn)*Ft+ar+Fn;if(mr===1)Gn[Ar]=0,Hn[Ar]=Sn;else{const Wr=.5-mr;Gn[Ar]=Wr>0?Wr*Wr:0,Hn[Ar]=Wr<0?Wr*Wr:0}}_i(Gn,0,0,Ft,Gt,Ft,this.f,this.v,this.z),_i(Hn,Fn,Fn,St,Tt,Ft,this.f,this.v,this.z);for(let Dn=0;Dn<Xt;Dn++){const ar=Math.sqrt(Gn[Dn])-Math.sqrt(Hn[Dn]);pn[Dn]=Math.round(255-255*(ar/this.radius+this.cutoff))}return wn}};class Pn{constructor(){this.specification=ct.v.light.position}possiblyEvaluate(tt,ot){return ct.x(tt.expression.evaluate(ot))}interpolate(tt,ot,ht){return{x:ct.y.number(tt.x,ot.x,ht),y:ct.y.number(tt.y,ot.y,ht),z:ct.y.number(tt.z,ot.z,ht)}}}let lr;class xr extends ct.E{constructor(tt){super(),lr=lr||new ct.q({anchor:new ct.D(ct.v.light.anchor),position:new Pn,color:new ct.D(ct.v.light.color),intensity:new ct.D(ct.v.light.intensity)}),this._transitionable=new ct.T(lr),this.setLight(tt),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(tt,ot={}){if(!this._validate(ct.r,tt,ot))for(const ht in tt){const dt=tt[ht];ht.endsWith("-transition")?this._transitionable.setTransition(ht.slice(0,-11),dt):this._transitionable.setValue(ht,dt)}}updateTransitions(tt){this._transitioning=this._transitionable.transitioned(tt,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(tt){this.properties=this._transitioning.possiblyEvaluate(tt)}_validate(tt,ot,ht){return(!ht||ht.validate!==!1)&&ct.t(this,tt.call(ct.u,{value:ot,style:{glyphs:!0,sprite:!0},styleSpec:ct.v}))}}const Dr=new ct.q({"sky-color":new ct.D(ct.v.sky["sky-color"]),"horizon-color":new ct.D(ct.v.sky["horizon-color"]),"fog-color":new ct.D(ct.v.sky["fog-color"]),"fog-ground-blend":new ct.D(ct.v.sky["fog-ground-blend"]),"horizon-fog-blend":new ct.D(ct.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new ct.D(ct.v.sky["sky-horizon-blend"]),"atmosphere-blend":new ct.D(ct.v.sky["atmosphere-blend"])});class $r extends ct.E{constructor(tt){super(),this._transitionable=new ct.T(Dr),this.setSky(tt),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new ct.z(0))}setSky(tt,ot={}){if(!this._validate(ct.B,tt,ot)){tt||(tt={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const ht in tt){const dt=tt[ht];ht.endsWith("-transition")?this._transitionable.setTransition(ht.slice(0,-11),dt):this._transitionable.setValue(ht,dt)}}}getSky(){return this._transitionable.serialize()}updateTransitions(tt){this._transitioning=this._transitionable.transitioned(tt,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(tt){this.properties=this._transitioning.possiblyEvaluate(tt)}_validate(tt,ot,ht={}){return(ht==null?void 0:ht.validate)!==!1&&ct.t(this,tt.call(ct.u,ct.e({value:ot,style:{glyphs:!0,sprite:!0},styleSpec:ct.v})))}calculateFogBlendOpacity(tt){return tt<60?0:tt<70?(tt-60)/10:1}}class An{constructor(tt,ot){this.width=tt,this.height=ot,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(tt,ot){const ht=tt.join(",")+String(ot);return this.dashEntry[ht]||(this.dashEntry[ht]=this.addDash(tt,ot)),this.dashEntry[ht]}getDashRanges(tt,ot,ht){const dt=[];let mt=tt.length%2==1?-tt[tt.length-1]*ht:0,wt=tt[0]*ht,St=!0;dt.push({left:mt,right:wt,isDash:St,zeroLength:tt[0]===0});let Tt=tt[0];for(let Ft=1;Ft<tt.length;Ft++){St=!St;const Gt=tt[Ft];mt=Tt*ht,Tt+=Gt,wt=Tt*ht,dt.push({left:mt,right:wt,isDash:St,zeroLength:Gt===0})}return dt}addRoundDash(tt,ot,ht){const dt=ot/2;for(let mt=-ht;mt<=ht;mt++){const wt=this.width*(this.nextRow+ht+mt);let St=0,Tt=tt[St];for(let Ft=0;Ft<this.width;Ft++){Ft/Tt.right>1&&(Tt=tt[++St]);const Gt=Math.abs(Ft-Tt.left),Xt=Math.abs(Ft-Tt.right),pn=Math.min(Gt,Xt);let wn;const kn=mt/ht*(dt+1);if(Tt.isDash){const Fn=dt-Math.abs(kn);wn=Math.sqrt(pn*pn+Fn*Fn)}else wn=dt-Math.sqrt(pn*pn+kn*kn);this.data[wt+Ft]=Math.max(0,Math.min(255,wn+128))}}}addRegularDash(tt){for(let St=tt.length-1;St>=0;--St){const Tt=tt[St],Ft=tt[St+1];Tt.zeroLength?tt.splice(St,1):Ft&&Ft.isDash===Tt.isDash&&(Ft.left=Tt.left,tt.splice(St,1))}const ot=tt[0],ht=tt[tt.length-1];ot.isDash===ht.isDash&&(ot.left=ht.left-this.width,ht.right=ot.right+this.width);const dt=this.width*this.nextRow;let mt=0,wt=tt[mt];for(let St=0;St<this.width;St++){St/wt.right>1&&(wt=tt[++mt]);const Tt=Math.abs(St-wt.left),Ft=Math.abs(St-wt.right),Gt=Math.min(Tt,Ft);this.data[dt+St]=Math.max(0,Math.min(255,(wt.isDash?Gt:-Gt)+128))}}addDash(tt,ot){const ht=ot?7:0,dt=2*ht+1;if(this.nextRow+dt>this.height)return ct.w("LineAtlas out of space"),null;let mt=0;for(let St=0;St<tt.length;St++)mt+=tt[St];if(mt!==0){const St=this.width/mt,Tt=this.getDashRanges(tt,this.width,St);ot?this.addRoundDash(Tt,St,ht):this.addRegularDash(Tt)}const wt={y:(this.nextRow+ht+.5)/this.height,height:2*ht/this.height,width:mt};return this.nextRow+=dt,this.dirty=!0,wt}bind(tt){const ot=tt.gl;this.texture?(ot.bindTexture(ot.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,ot.texSubImage2D(ot.TEXTURE_2D,0,0,0,this.width,this.height,ot.ALPHA,ot.UNSIGNED_BYTE,this.data))):(this.texture=ot.createTexture(),ot.bindTexture(ot.TEXTURE_2D,this.texture),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_S,ot.REPEAT),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_T,ot.REPEAT),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MIN_FILTER,ot.LINEAR),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MAG_FILTER,ot.LINEAR),ot.texImage2D(ot.TEXTURE_2D,0,ot.ALPHA,this.width,this.height,0,ot.ALPHA,ot.UNSIGNED_BYTE,this.data))}}const Nt="maplibre_preloaded_worker_pool";class Zt{constructor(){this.active={}}acquire(tt){if(!this.workers)for(this.workers=[];this.workers.length<Zt.workerCount;)this.workers.push(new Worker(ct.a.WORKER_URL));return this.active[tt]=!0,this.workers.slice()}release(tt){delete this.active[tt],this.numActive()===0&&(this.workers.forEach(ot=>{ot.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Nt]}numActive(){return Object.keys(this.active).length}}const $t=Math.floor(Lt.hardwareConcurrency/2);let rn,an;function En(){return rn||(rn=new Zt),rn}Zt.workerCount=ct.C(globalThis)?Math.max(Math.min($t,3),1):1;class Mn{constructor(tt,ot){this.workerPool=tt,this.actors=[],this.currentActor=0,this.id=ot;const ht=this.workerPool.acquire(ot);for(let dt=0;dt<ht.length;dt++){const mt=new ct.F(ht[dt],ot);mt.name=`Worker ${dt}`,this.actors.push(mt)}if(!this.actors.length)throw new Error("No actors found")}broadcast(tt,ot){const ht=[];for(const dt of this.actors)ht.push(dt.sendAsync({type:tt,data:ot}));return Promise.all(ht)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(tt=!0){this.actors.forEach(ot=>{ot.remove()}),this.actors=[],tt&&this.workerPool.release(this.id)}registerMessageHandler(tt,ot){for(const ht of this.actors)ht.registerMessageHandler(tt,ot)}}function jn(){return an||(an=new Mn(En(),ct.G),an.registerMessageHandler("GR",(gt,tt,ot)=>ct.m(tt,ot))),an}function dr(gt,tt){const ot=ct.H();return ct.J(ot,ot,[1,1,0]),ct.K(ot,ot,[.5*gt.width,.5*gt.height,1]),ct.L(ot,ot,gt.calculatePosMatrix(tt.toUnwrapped()))}function cr(gt,tt,ot,ht,dt,mt){const wt=function(Xt,pn,wn){if(Xt)for(const kn of Xt){const Fn=pn[kn];if(Fn&&Fn.source===wn&&Fn.type==="fill-extrusion")return!0}else for(const kn in pn){const Fn=pn[kn];if(Fn.source===wn&&Fn.type==="fill-extrusion")return!0}return!1}(dt&&dt.layers,tt,gt.id),St=mt.maxPitchScaleFactor(),Tt=gt.tilesIn(ht,St,wt);Tt.sort(wr);const Ft=[];for(const Xt of Tt)Ft.push({wrappedTileID:Xt.tileID.wrapped().key,queryResults:Xt.tile.queryRenderedFeatures(tt,ot,gt._state,Xt.queryGeometry,Xt.cameraQueryGeometry,Xt.scale,dt,mt,St,dr(gt.transform,Xt.tileID))});const Gt=function(Xt){const pn={},wn={};for(const kn of Xt){const Fn=kn.queryResults,Hn=kn.wrappedTileID,Gn=wn[Hn]=wn[Hn]||{};for(const Qn in Fn){const Dn=Fn[Qn],ar=Gn[Qn]=Gn[Qn]||{},mr=pn[Qn]=pn[Qn]||[];for(const Ar of Dn)ar[Ar.featureIndex]||(ar[Ar.featureIndex]=!0,mr.push(Ar))}}return pn}(Ft);for(const Xt in Gt)Gt[Xt].forEach(pn=>{const wn=pn.feature,kn=gt.getFeatureState(wn.layer["source-layer"],wn.id);wn.source=wn.layer.source,wn.layer["source-layer"]&&(wn.sourceLayer=wn.layer["source-layer"]),wn.state=kn});return Gt}function wr(gt,tt){const ot=gt.tileID,ht=tt.tileID;return ot.overscaledZ-ht.overscaledZ||ot.canonical.y-ht.canonical.y||ot.wrap-ht.wrap||ot.canonical.x-ht.canonical.x}function Rr(gt,tt,ot){return ct._(this,void 0,void 0,function*(){let ht=gt;if(gt.url?ht=(yield ct.h(tt.transformRequest(gt.url,"Source"),ot)).data:yield Lt.frameAsync(ot),!ht)return null;const dt=ct.M(ct.e(ht,gt),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in ht&&ht.vector_layers&&(dt.vectorLayerIds=ht.vector_layers.map(mt=>mt.id)),dt})}class On{constructor(tt,ot){tt&&(ot?this.setSouthWest(tt).setNorthEast(ot):Array.isArray(tt)&&(tt.length===4?this.setSouthWest([tt[0],tt[1]]).setNorthEast([tt[2],tt[3]]):this.setSouthWest(tt[0]).setNorthEast(tt[1])))}setNorthEast(tt){return this._ne=tt instanceof ct.N?new ct.N(tt.lng,tt.lat):ct.N.convert(tt),this}setSouthWest(tt){return this._sw=tt instanceof ct.N?new ct.N(tt.lng,tt.lat):ct.N.convert(tt),this}extend(tt){const ot=this._sw,ht=this._ne;let dt,mt;if(tt instanceof ct.N)dt=tt,mt=tt;else{if(!(tt instanceof On))return Array.isArray(tt)?tt.length===4||tt.every(Array.isArray)?this.extend(On.convert(tt)):this.extend(ct.N.convert(tt)):tt&&("lng"in tt||"lon"in tt)&&"lat"in tt?this.extend(ct.N.convert(tt)):this;if(dt=tt._sw,mt=tt._ne,!dt||!mt)return this}return ot||ht?(ot.lng=Math.min(dt.lng,ot.lng),ot.lat=Math.min(dt.lat,ot.lat),ht.lng=Math.max(mt.lng,ht.lng),ht.lat=Math.max(mt.lat,ht.lat)):(this._sw=new ct.N(dt.lng,dt.lat),this._ne=new ct.N(mt.lng,mt.lat)),this}getCenter(){return new ct.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ct.N(this.getWest(),this.getNorth())}getSouthEast(){return new ct.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(tt){const{lng:ot,lat:ht}=ct.N.convert(tt);let dt=this._sw.lng<=ot&&ot<=this._ne.lng;return this._sw.lng>this._ne.lng&&(dt=this._sw.lng>=ot&&ot>=this._ne.lng),this._sw.lat<=ht&&ht<=this._ne.lat&&dt}static convert(tt){return tt instanceof On?tt:tt&&new On(tt)}static fromLngLat(tt,ot=0){const ht=360*ot/40075017,dt=ht/Math.cos(Math.PI/180*tt.lat);return new On(new ct.N(tt.lng-dt,tt.lat-ht),new ct.N(tt.lng+dt,tt.lat+ht))}adjustAntiMeridian(){const tt=new ct.N(this._sw.lng,this._sw.lat),ot=new ct.N(this._ne.lng,this._ne.lat);return new On(tt,tt.lng>ot.lng?new ct.N(ot.lng+360,ot.lat):ot)}}class Mr{constructor(tt,ot,ht){this.bounds=On.convert(this.validateBounds(tt)),this.minzoom=ot||0,this.maxzoom=ht||24}validateBounds(tt){return Array.isArray(tt)&&tt.length===4?[Math.max(-180,tt[0]),Math.max(-90,tt[1]),Math.min(180,tt[2]),Math.min(90,tt[3])]:[-180,-90,180,90]}contains(tt){const ot=Math.pow(2,tt.z),ht=Math.floor(ct.O(this.bounds.getWest())*ot),dt=Math.floor(ct.Q(this.bounds.getNorth())*ot),mt=Math.ceil(ct.O(this.bounds.getEast())*ot),wt=Math.ceil(ct.Q(this.bounds.getSouth())*ot);return tt.x>=ht&&tt.x<mt&&tt.y>=dt&&tt.y<wt}}class ts extends ct.E{constructor(tt,ot,ht,dt){if(super(),this.id=tt,this.dispatcher=ht,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,ct.e(this,ct.M(ot,["url","scheme","tileSize","promoteId"])),this._options=ct.e({type:"vector"},ot),this._collectResourceTiming=ot.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(dt)}load(){return ct._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new ct.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const tt=yield Rr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),tt&&(ct.e(this,tt),tt.bounds&&(this.tileBounds=new Mr(tt.bounds,this.minzoom,this.maxzoom)),this.fire(new ct.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new ct.k("data",{dataType:"source",sourceDataType:"content"})))}catch(tt){this._tileJSONRequest=null,this.fire(new ct.j(tt))}})}loaded(){return this._loaded}hasTile(tt){return!this.tileBounds||this.tileBounds.contains(tt.canonical)}onAdd(tt){this.map=tt,this.load()}setSourceProperty(tt){this._tileJSONRequest&&this._tileJSONRequest.abort(),tt(),this.load()}setTiles(tt){return this.setSourceProperty(()=>{this._options.tiles=tt}),this}setUrl(tt){return this.setSourceProperty(()=>{this.url=tt,this._options.url=tt}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return ct.e({},this._options)}loadTile(tt){return ct._(this,void 0,void 0,function*(){const ot=tt.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),ht={request:this.map._requestManager.transformRequest(ot,"Tile"),uid:tt.uid,tileID:tt.tileID,zoom:tt.tileID.overscaledZ,tileSize:this.tileSize*tt.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};ht.request.collectResourceTiming=this._collectResourceTiming;let dt="RT";if(tt.actor&&tt.state!=="expired"){if(tt.state==="loading")return new Promise((mt,wt)=>{tt.reloadPromise={resolve:mt,reject:wt}})}else tt.actor=this.dispatcher.getActor(),dt="LT";tt.abortController=new AbortController;try{const mt=yield tt.actor.sendAsync({type:dt,data:ht},tt.abortController);if(delete tt.abortController,tt.aborted)return;this._afterTileLoadWorkerResponse(tt,mt)}catch(mt){if(delete tt.abortController,tt.aborted)return;if(mt&&mt.status!==404)throw mt;this._afterTileLoadWorkerResponse(tt,null)}})}_afterTileLoadWorkerResponse(tt,ot){if(ot&&ot.resourceTiming&&(tt.resourceTiming=ot.resourceTiming),ot&&this.map._refreshExpiredTiles&&tt.setExpiryData(ot),tt.loadVectorData(ot,this.map.painter),tt.reloadPromise){const ht=tt.reloadPromise;tt.reloadPromise=null,this.loadTile(tt).then(ht.resolve).catch(ht.reject)}}abortTile(tt){return ct._(this,void 0,void 0,function*(){tt.abortController&&(tt.abortController.abort(),delete tt.abortController),tt.actor&&(yield tt.actor.sendAsync({type:"AT",data:{uid:tt.uid,type:this.type,source:this.id}}))})}unloadTile(tt){return ct._(this,void 0,void 0,function*(){tt.unloadVectorData(),tt.actor&&(yield tt.actor.sendAsync({type:"RMT",data:{uid:tt.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Jr extends ct.E{constructor(tt,ot,ht,dt){super(),this.id=tt,this.dispatcher=ht,this.setEventedParent(dt),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=ct.e({type:"raster"},ot),ct.e(this,ct.M(ot,["url","scheme","tileSize"]))}load(){return ct._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new ct.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const tt=yield Rr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,tt&&(ct.e(this,tt),tt.bounds&&(this.tileBounds=new Mr(tt.bounds,this.minzoom,this.maxzoom)),this.fire(new ct.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new ct.k("data",{dataType:"source",sourceDataType:"content"})))}catch(tt){this._tileJSONRequest=null,this.fire(new ct.j(tt))}})}loaded(){return this._loaded}onAdd(tt){this.map=tt,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(tt){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),tt(),this.load()}setTiles(tt){return this.setSourceProperty(()=>{this._options.tiles=tt}),this}setUrl(tt){return this.setSourceProperty(()=>{this.url=tt,this._options.url=tt}),this}serialize(){return ct.e({},this._options)}hasTile(tt){return!this.tileBounds||this.tileBounds.contains(tt.canonical)}loadTile(tt){return ct._(this,void 0,void 0,function*(){const ot=tt.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);tt.abortController=new AbortController;try{const ht=yield Ht.getImage(this.map._requestManager.transformRequest(ot,"Tile"),tt.abortController,this.map._refreshExpiredTiles);if(delete tt.abortController,tt.aborted)return void(tt.state="unloaded");if(ht&&ht.data){this.map._refreshExpiredTiles&&ht.cacheControl&&ht.expires&&tt.setExpiryData({cacheControl:ht.cacheControl,expires:ht.expires});const dt=this.map.painter.context,mt=dt.gl,wt=ht.data;tt.texture=this.map.painter.getTileTexture(wt.width),tt.texture?tt.texture.update(wt,{useMipmap:!0}):(tt.texture=new fn(dt,wt,mt.RGBA,{useMipmap:!0}),tt.texture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE,mt.LINEAR_MIPMAP_NEAREST)),tt.state="loaded"}}catch(ht){if(delete tt.abortController,tt.aborted)tt.state="unloaded";else if(ht)throw tt.state="errored",ht}})}abortTile(tt){return ct._(this,void 0,void 0,function*(){tt.abortController&&(tt.abortController.abort(),delete tt.abortController)})}unloadTile(tt){return ct._(this,void 0,void 0,function*(){tt.texture&&this.map.painter.saveTileTexture(tt.texture)})}hasTransition(){return!1}}class jr extends Jr{constructor(tt,ot,ht,dt){super(tt,ot,ht,dt),this.type="raster-dem",this.maxzoom=22,this._options=ct.e({type:"raster-dem"},ot),this.encoding=ot.encoding||"mapbox",this.redFactor=ot.redFactor,this.greenFactor=ot.greenFactor,this.blueFactor=ot.blueFactor,this.baseShift=ot.baseShift}loadTile(tt){return ct._(this,void 0,void 0,function*(){const ot=tt.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),ht=this.map._requestManager.transformRequest(ot,"Tile");tt.neighboringTiles=this._getNeighboringTiles(tt.tileID),tt.abortController=new AbortController;try{const dt=yield Ht.getImage(ht,tt.abortController,this.map._refreshExpiredTiles);if(delete tt.abortController,tt.aborted)return void(tt.state="unloaded");if(dt&&dt.data){const mt=dt.data;this.map._refreshExpiredTiles&&dt.cacheControl&&dt.expires&&tt.setExpiryData({cacheControl:dt.cacheControl,expires:dt.expires});const wt=ct.b(mt)&&ct.U()?mt:yield this.readImageNow(mt),St={type:this.type,uid:tt.uid,source:this.id,rawImageData:wt,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!tt.actor||tt.state==="expired"){tt.actor=this.dispatcher.getActor();const Tt=yield tt.actor.sendAsync({type:"LDT",data:St});tt.dem=Tt,tt.needsHillshadePrepare=!0,tt.needsTerrainPrepare=!0,tt.state="loaded"}}}catch(dt){if(delete tt.abortController,tt.aborted)tt.state="unloaded";else if(dt)throw tt.state="errored",dt}})}readImageNow(tt){return ct._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&ct.V()){const ot=tt.width+2,ht=tt.height+2;try{return new ct.R({width:ot,height:ht},yield ct.W(tt,-1,-1,ot,ht))}catch{}}return Lt.getImageData(tt,1)})}_getNeighboringTiles(tt){const ot=tt.canonical,ht=Math.pow(2,ot.z),dt=(ot.x-1+ht)%ht,mt=ot.x===0?tt.wrap-1:tt.wrap,wt=(ot.x+1+ht)%ht,St=ot.x+1===ht?tt.wrap+1:tt.wrap,Tt={};return Tt[new ct.S(tt.overscaledZ,mt,ot.z,dt,ot.y).key]={backfilled:!1},Tt[new ct.S(tt.overscaledZ,St,ot.z,wt,ot.y).key]={backfilled:!1},ot.y>0&&(Tt[new ct.S(tt.overscaledZ,mt,ot.z,dt,ot.y-1).key]={backfilled:!1},Tt[new ct.S(tt.overscaledZ,tt.wrap,ot.z,ot.x,ot.y-1).key]={backfilled:!1},Tt[new ct.S(tt.overscaledZ,St,ot.z,wt,ot.y-1).key]={backfilled:!1}),ot.y+1<ht&&(Tt[new ct.S(tt.overscaledZ,mt,ot.z,dt,ot.y+1).key]={backfilled:!1},Tt[new ct.S(tt.overscaledZ,tt.wrap,ot.z,ot.x,ot.y+1).key]={backfilled:!1},Tt[new ct.S(tt.overscaledZ,St,ot.z,wt,ot.y+1).key]={backfilled:!1}),Tt}unloadTile(tt){return ct._(this,void 0,void 0,function*(){tt.demTexture&&this.map.painter.saveTileTexture(tt.demTexture),tt.fbo&&(tt.fbo.destroy(),delete tt.fbo),tt.dem&&delete tt.dem,delete tt.neighboringTiles,tt.state="unloaded",tt.actor&&(yield tt.actor.sendAsync({type:"RDT",data:{type:this.type,uid:tt.uid,source:this.id}}))})}}class ss extends ct.E{constructor(tt,ot,ht,dt){super(),this.id=tt,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=ht.getActor(),this.setEventedParent(dt),this._data=ot.data,this._options=ct.e({},ot),this._collectResourceTiming=ot.collectResourceTiming,ot.maxzoom!==void 0&&(this.maxzoom=ot.maxzoom),ot.type&&(this.type=ot.type),ot.attribution&&(this.attribution=ot.attribution),this.promoteId=ot.promoteId;const mt=ct.X/this.tileSize;ot.clusterMaxZoom!==void 0&&this.maxzoom<=ot.clusterMaxZoom&&ct.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${ot.clusterMaxZoom}".`),this.workerOptions=ct.e({source:this.id,cluster:ot.cluster||!1,geojsonVtOptions:{buffer:(ot.buffer!==void 0?ot.buffer:128)*mt,tolerance:(ot.tolerance!==void 0?ot.tolerance:.375)*mt,extent:ct.X,maxZoom:this.maxzoom,lineMetrics:ot.lineMetrics||!1,generateId:ot.generateId||!1},superclusterOptions:{maxZoom:ot.clusterMaxZoom!==void 0?ot.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,ot.clusterMinPoints||2),extent:ct.X,radius:(ot.clusterRadius||50)*mt,log:!1,generateId:ot.generateId||!1},clusterProperties:ot.clusterProperties,filter:ot.filter},ot.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return ct._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(tt){this.map=tt,this.load()}setData(tt){return this._data=tt,this._updateWorkerData(),this}updateData(tt){return this._updateWorkerData(tt),this}getData(){return ct._(this,void 0,void 0,function*(){const tt=ct.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:tt})})}setClusterOptions(tt){return this.workerOptions.cluster=tt.cluster,tt&&(tt.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=tt.clusterRadius),tt.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=tt.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(tt){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:tt,source:this.id}})}getClusterChildren(tt){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:tt,source:this.id}})}getClusterLeaves(tt,ot,ht){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:tt,limit:ot,offset:ht}})}_updateWorkerData(tt){return ct._(this,void 0,void 0,function*(){const ot=ct.e({type:this.type},this.workerOptions);tt?ot.dataDiff=tt:typeof this._data=="string"?(ot.request=this.map._requestManager.transformRequest(Lt.resolveURL(this._data),"Source"),ot.request.collectResourceTiming=this._collectResourceTiming):ot.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new ct.k("dataloading",{dataType:"source"}));try{const ht=yield this.actor.sendAsync({type:"LD",data:ot});if(this._pendingLoads--,this._removed||ht.abandoned)return void this.fire(new ct.k("dataabort",{dataType:"source"}));let dt=null;ht.resourceTiming&&ht.resourceTiming[this.id]&&(dt=ht.resourceTiming[this.id].slice(0));const mt={dataType:"source"};this._collectResourceTiming&&dt&&dt.length>0&&ct.e(mt,{resourceTiming:dt}),this.fire(new ct.k("data",Object.assign(Object.assign({},mt),{sourceDataType:"metadata"}))),this.fire(new ct.k("data",Object.assign(Object.assign({},mt),{sourceDataType:"content"})))}catch(ht){if(this._pendingLoads--,this._removed)return void this.fire(new ct.k("dataabort",{dataType:"source"}));this.fire(new ct.j(ht))}})}loaded(){return this._pendingLoads===0}loadTile(tt){return ct._(this,void 0,void 0,function*(){const ot=tt.actor?"RT":"LT";tt.actor=this.actor;const ht={type:this.type,uid:tt.uid,tileID:tt.tileID,zoom:tt.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};tt.abortController=new AbortController;const dt=yield this.actor.sendAsync({type:ot,data:ht},tt.abortController);delete tt.abortController,tt.unloadVectorData(),tt.aborted||tt.loadVectorData(dt,this.map.painter,ot==="RT")})}abortTile(tt){return ct._(this,void 0,void 0,function*(){tt.abortController&&(tt.abortController.abort(),delete tt.abortController),tt.aborted=!0})}unloadTile(tt){return ct._(this,void 0,void 0,function*(){tt.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:tt.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return ct.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Lr=ct.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class hr extends ct.E{constructor(tt,ot,ht,dt){super(),this.id=tt,this.dispatcher=ht,this.coordinates=ot.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(dt),this.options=ot}load(tt){return ct._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new ct.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const ot=yield Ht.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,ot&&ot.data&&(this.image=ot.data,tt&&(this.coordinates=tt),this._finishLoading())}catch(ot){this._request=null,this._loaded=!0,this.fire(new ct.j(ot))}})}loaded(){return this._loaded}updateImage(tt){return tt.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=tt.url,this.load(tt.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ct.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(tt){this.map=tt,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(tt){this.coordinates=tt;const ot=tt.map(ct.Z.fromLngLat);this.tileID=function(dt){let mt=1/0,wt=1/0,St=-1/0,Tt=-1/0;for(const pn of dt)mt=Math.min(mt,pn.x),wt=Math.min(wt,pn.y),St=Math.max(St,pn.x),Tt=Math.max(Tt,pn.y);const Ft=Math.max(St-mt,Tt-wt),Gt=Math.max(0,Math.floor(-Math.log(Ft)/Math.LN2)),Xt=Math.pow(2,Gt);return new ct.a1(Gt,Math.floor((mt+St)/2*Xt),Math.floor((wt+Tt)/2*Xt))}(ot),this.minzoom=this.maxzoom=this.tileID.z;const ht=ot.map(dt=>this.tileID.getTilePoint(dt)._round());return this._boundsArray=new ct.$,this._boundsArray.emplaceBack(ht[0].x,ht[0].y,0,0),this._boundsArray.emplaceBack(ht[1].x,ht[1].y,ct.X,0),this._boundsArray.emplaceBack(ht[3].x,ht[3].y,0,ct.X),this._boundsArray.emplaceBack(ht[2].x,ht[2].y,ct.X,ct.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new ct.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const tt=this.map.painter.context,ot=tt.gl;this.boundsBuffer||(this.boundsBuffer=tt.createVertexBuffer(this._boundsArray,Lr.members)),this.boundsSegments||(this.boundsSegments=ct.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new fn(tt,this.image,ot.RGBA),this.texture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE));let ht=!1;for(const dt in this.tiles){const mt=this.tiles[dt];mt.state!=="loaded"&&(mt.state="loaded",mt.texture=this.texture,ht=!0)}ht&&this.fire(new ct.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(tt){return ct._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(tt.tileID.canonical)?(this.tiles[String(tt.tileID.wrap)]=tt,tt.buckets={}):tt.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class or extends hr{constructor(tt,ot,ht,dt){super(tt,ot,ht,dt),this.roundZoom=!0,this.type="video",this.options=ot}load(){return ct._(this,void 0,void 0,function*(){this._loaded=!1;const tt=this.options;this.urls=[];for(const ot of tt.urls)this.urls.push(this.map._requestManager.transformRequest(ot,"Source").url);try{const ot=yield ct.a3(this.urls);if(this._loaded=!0,!ot)return;this.video=ot,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(ot){this.fire(new ct.j(ot))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(tt){if(this.video){const ot=this.video.seekable;tt<ot.start(0)||tt>ot.end(0)?this.fire(new ct.j(new ct.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${ot.start(0)} and ${ot.end(0)}-second mark.`))):this.video.currentTime=tt}}getVideo(){return this.video}onAdd(tt){this.map||(this.map=tt,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const tt=this.map.painter.context,ot=tt.gl;this.boundsBuffer||(this.boundsBuffer=tt.createVertexBuffer(this._boundsArray,Lr.members)),this.boundsSegments||(this.boundsSegments=ct.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE),ot.texSubImage2D(ot.TEXTURE_2D,0,0,0,ot.RGBA,ot.UNSIGNED_BYTE,this.video)):(this.texture=new fn(tt,this.video,ot.RGBA),this.texture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE));let ht=!1;for(const dt in this.tiles){const mt=this.tiles[dt];mt.state!=="loaded"&&(mt.state="loaded",mt.texture=this.texture,ht=!0)}ht&&this.fire(new ct.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Tr extends hr{constructor(tt,ot,ht,dt){super(tt,ot,ht,dt),ot.coordinates?Array.isArray(ot.coordinates)&&ot.coordinates.length===4&&!ot.coordinates.some(mt=>!Array.isArray(mt)||mt.length!==2||mt.some(wt=>typeof wt!="number"))||this.fire(new ct.j(new ct.a2(`sources.${tt}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new ct.j(new ct.a2(`sources.${tt}`,null,'missing required property "coordinates"'))),ot.animate&&typeof ot.animate!="boolean"&&this.fire(new ct.j(new ct.a2(`sources.${tt}`,null,'optional "animate" property must be a boolean value'))),ot.canvas?typeof ot.canvas=="string"||ot.canvas instanceof HTMLCanvasElement||this.fire(new ct.j(new ct.a2(`sources.${tt}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new ct.j(new ct.a2(`sources.${tt}`,null,'missing required property "canvas"'))),this.options=ot,this.animate=ot.animate===void 0||ot.animate}load(){return ct._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new ct.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(tt){this.map=tt,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let tt=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,tt=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,tt=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const ot=this.map.painter.context,ht=ot.gl;this.boundsBuffer||(this.boundsBuffer=ot.createVertexBuffer(this._boundsArray,Lr.members)),this.boundsSegments||(this.boundsSegments=ct.a0.simpleSegment(0,0,4,2)),this.texture?(tt||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new fn(ot,this.canvas,ht.RGBA,{premultiply:!0});let dt=!1;for(const mt in this.tiles){const wt=this.tiles[mt];wt.state!=="loaded"&&(wt.state="loaded",wt.texture=this.texture,dt=!0)}dt&&this.fire(new ct.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const tt of[this.canvas.width,this.canvas.height])if(isNaN(tt)||tt<=0)return!0;return!1}}const Zr={},qr=gt=>{switch(gt){case"geojson":return ss;case"image":return hr;case"raster":return Jr;case"raster-dem":return jr;case"vector":return ts;case"video":return or;case"canvas":return Tr}return Zr[gt]},Cr="RTLPluginLoaded";class ws extends ct.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=jn()}_syncState(tt){return this.status=tt,this.dispatcher.broadcast("SRPS",{pluginStatus:tt,pluginURL:this.url}).catch(ot=>{throw this.status="error",ot})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(tt){return ct._(this,arguments,void 0,function*(ot,ht=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Lt.resolveURL(ot),!this.url)throw new Error(`requested url ${ot} is invalid`);if(this.status==="unavailable"){if(!ht)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return ct._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new ct.k(Cr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ds=null;function Ts(){return ds||(ds=new ws),ds}class Ms{constructor(tt,ot){this.timeAdded=0,this.fadeEndTime=0,this.tileID=tt,this.uid=ct.a4(),this.uses=0,this.tileSize=ot,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(tt){const ot=tt+this.timeAdded;ot<this.fadeEndTime||(this.fadeEndTime=ot)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(tt){this.demTexture&&tt.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(tt,ot,ht){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",tt){tt.featureIndex&&(this.latestFeatureIndex=tt.featureIndex,tt.rawTileData?(this.latestRawTileData=tt.rawTileData,this.latestFeatureIndex.rawTileData=tt.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=tt.collisionBoxArray,this.buckets=function(dt,mt){const wt={};if(!mt)return wt;for(const St of dt){const Tt=St.layerIds.map(Ft=>mt.getLayer(Ft)).filter(Boolean);if(Tt.length!==0){St.layers=Tt,St.stateDependentLayerIds&&(St.stateDependentLayers=St.stateDependentLayerIds.map(Ft=>Tt.filter(Gt=>Gt.id===Ft)[0]));for(const Ft of Tt)wt[Ft.id]=St}}return wt}(tt.buckets,ot.style),this.hasSymbolBuckets=!1;for(const dt in this.buckets){const mt=this.buckets[dt];if(mt instanceof ct.a6){if(this.hasSymbolBuckets=!0,!ht)break;mt.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const dt in this.buckets){const mt=this.buckets[dt];if(mt instanceof ct.a6&&mt.hasRTLText){this.hasRTLText=!0,Ts().lazyLoad();break}}this.queryPadding=0;for(const dt in this.buckets){const mt=this.buckets[dt];this.queryPadding=Math.max(this.queryPadding,ot.style.getLayer(dt).queryRadius(mt))}tt.imageAtlas&&(this.imageAtlas=tt.imageAtlas),tt.glyphAtlasImage&&(this.glyphAtlasImage=tt.glyphAtlasImage)}else this.collisionBoxArray=new ct.a5}unloadVectorData(){for(const tt in this.buckets)this.buckets[tt].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(tt){return this.buckets[tt.id]}upload(tt){for(const ht in this.buckets){const dt=this.buckets[ht];dt.uploadPending()&&dt.upload(tt)}const ot=tt.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new fn(tt,this.imageAtlas.image,ot.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fn(tt,this.glyphAtlasImage,ot.ALPHA),this.glyphAtlasImage=null)}prepare(tt){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(tt,this.imageAtlasTexture)}queryRenderedFeatures(tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:dt,cameraQueryGeometry:mt,scale:wt,tileSize:this.tileSize,pixelPosMatrix:Gt,transform:Tt,params:St,queryPadding:this.queryPadding*Ft},tt,ot,ht):{}}querySourceFeatures(tt,ot){const ht=this.latestFeatureIndex;if(!ht||!ht.rawTileData)return;const dt=ht.loadVTLayers(),mt=ot&&ot.sourceLayer?ot.sourceLayer:"",wt=dt._geojsonTileLayer||dt[mt];if(!wt)return;const St=ct.a7(ot&&ot.filter),{z:Tt,x:Ft,y:Gt}=this.tileID.canonical,Xt={z:Tt,x:Ft,y:Gt};for(let pn=0;pn<wt.length;pn++){const wn=wt.feature(pn);if(St.needGeometry){const Hn=ct.a8(wn,!0);if(!St.filter(new ct.z(this.tileID.overscaledZ),Hn,this.tileID.canonical))continue}else if(!St.filter(new ct.z(this.tileID.overscaledZ),wn))continue;const kn=ht.getId(wn,mt),Fn=new ct.a9(wn,Tt,Ft,Gt,kn);Fn.tile=Xt,tt.push(Fn)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(tt){const ot=this.expirationTime;if(tt.cacheControl){const ht=ct.aa(tt.cacheControl);ht["max-age"]&&(this.expirationTime=Date.now()+1e3*ht["max-age"])}else tt.expires&&(this.expirationTime=new Date(tt.expires).getTime());if(this.expirationTime){const ht=Date.now();let dt=!1;if(this.expirationTime>ht)dt=!1;else if(ot)if(this.expirationTime<ot)dt=!0;else{const mt=this.expirationTime-ot;mt?this.expirationTime=ht+Math.max(mt,3e4):dt=!0}else dt=!0;dt?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(tt,ot){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(tt).length===0)return;const ht=this.latestFeatureIndex.loadVTLayers();for(const dt in this.buckets){if(!ot.style.hasLayer(dt))continue;const mt=this.buckets[dt],wt=mt.layers[0].sourceLayer||"_geojsonTileLayer",St=ht[wt],Tt=tt[wt];if(!St||!Tt||Object.keys(Tt).length===0)continue;mt.update(Tt,St,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Ft=ot&&ot.style&&ot.style.getLayer(dt);Ft&&(this.queryPadding=Math.max(this.queryPadding,Ft.queryRadius(mt)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Lt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(tt){this.symbolFadeHoldUntil=Lt.now()+tt}setDependencies(tt,ot){const ht={};for(const dt of ot)ht[dt]=!0;this.dependencies[tt]=ht}hasDependency(tt,ot){for(const ht of tt){const dt=this.dependencies[ht];if(dt){for(const mt of ot)if(dt[mt])return!0}}return!1}}class Pr{constructor(tt,ot){this.max=tt,this.onRemove=ot,this.reset()}reset(){for(const tt in this.data)for(const ot of this.data[tt])ot.timeout&&clearTimeout(ot.timeout),this.onRemove(ot.value);return this.data={},this.order=[],this}add(tt,ot,ht){const dt=tt.wrapped().key;this.data[dt]===void 0&&(this.data[dt]=[]);const mt={value:ot,timeout:void 0};if(ht!==void 0&&(mt.timeout=setTimeout(()=>{this.remove(tt,mt)},ht)),this.data[dt].push(mt),this.order.push(dt),this.order.length>this.max){const wt=this._getAndRemoveByKey(this.order[0]);wt&&this.onRemove(wt)}return this}has(tt){return tt.wrapped().key in this.data}getAndRemove(tt){return this.has(tt)?this._getAndRemoveByKey(tt.wrapped().key):null}_getAndRemoveByKey(tt){const ot=this.data[tt].shift();return ot.timeout&&clearTimeout(ot.timeout),this.data[tt].length===0&&delete this.data[tt],this.order.splice(this.order.indexOf(tt),1),ot.value}getByKey(tt){const ot=this.data[tt];return ot?ot[0].value:null}get(tt){return this.has(tt)?this.data[tt.wrapped().key][0].value:null}remove(tt,ot){if(!this.has(tt))return this;const ht=tt.wrapped().key,dt=ot===void 0?0:this.data[ht].indexOf(ot),mt=this.data[ht][dt];return this.data[ht].splice(dt,1),mt.timeout&&clearTimeout(mt.timeout),this.data[ht].length===0&&delete this.data[ht],this.onRemove(mt.value),this.order.splice(this.order.indexOf(ht),1),this}setMaxSize(tt){for(this.max=tt;this.order.length>this.max;){const ot=this._getAndRemoveByKey(this.order[0]);ot&&this.onRemove(ot)}return this}filter(tt){const ot=[];for(const ht in this.data)for(const dt of this.data[ht])tt(dt.value)||ot.push(dt);for(const ht of ot)this.remove(ht.value.tileID,ht)}}class ns{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(tt,ot,ht){const dt=String(ot);if(this.stateChanges[tt]=this.stateChanges[tt]||{},this.stateChanges[tt][dt]=this.stateChanges[tt][dt]||{},ct.e(this.stateChanges[tt][dt],ht),this.deletedStates[tt]===null){this.deletedStates[tt]={};for(const mt in this.state[tt])mt!==dt&&(this.deletedStates[tt][mt]=null)}else if(this.deletedStates[tt]&&this.deletedStates[tt][dt]===null){this.deletedStates[tt][dt]={};for(const mt in this.state[tt][dt])ht[mt]||(this.deletedStates[tt][dt][mt]=null)}else for(const mt in ht)this.deletedStates[tt]&&this.deletedStates[tt][dt]&&this.deletedStates[tt][dt][mt]===null&&delete this.deletedStates[tt][dt][mt]}removeFeatureState(tt,ot,ht){if(this.deletedStates[tt]===null)return;const dt=String(ot);if(this.deletedStates[tt]=this.deletedStates[tt]||{},ht&&ot!==void 0)this.deletedStates[tt][dt]!==null&&(this.deletedStates[tt][dt]=this.deletedStates[tt][dt]||{},this.deletedStates[tt][dt][ht]=null);else if(ot!==void 0)if(this.stateChanges[tt]&&this.stateChanges[tt][dt])for(ht in this.deletedStates[tt][dt]={},this.stateChanges[tt][dt])this.deletedStates[tt][dt][ht]=null;else this.deletedStates[tt][dt]=null;else this.deletedStates[tt]=null}getState(tt,ot){const ht=String(ot),dt=ct.e({},(this.state[tt]||{})[ht],(this.stateChanges[tt]||{})[ht]);if(this.deletedStates[tt]===null)return{};if(this.deletedStates[tt]){const mt=this.deletedStates[tt][ot];if(mt===null)return{};for(const wt in mt)delete dt[wt]}return dt}initializeTileState(tt,ot){tt.setFeatureState(this.state,ot)}coalesceChanges(tt,ot){const ht={};for(const dt in this.stateChanges){this.state[dt]=this.state[dt]||{};const mt={};for(const wt in this.stateChanges[dt])this.state[dt][wt]||(this.state[dt][wt]={}),ct.e(this.state[dt][wt],this.stateChanges[dt][wt]),mt[wt]=this.state[dt][wt];ht[dt]=mt}for(const dt in this.deletedStates){this.state[dt]=this.state[dt]||{};const mt={};if(this.deletedStates[dt]===null)for(const wt in this.state[dt])mt[wt]={},this.state[dt][wt]={};else for(const wt in this.deletedStates[dt]){if(this.deletedStates[dt][wt]===null)this.state[dt][wt]={};else for(const St of Object.keys(this.deletedStates[dt][wt]))delete this.state[dt][wt][St];mt[wt]=this.state[dt][wt]}ht[dt]=ht[dt]||{},ct.e(ht[dt],mt)}if(this.stateChanges={},this.deletedStates={},Object.keys(ht).length!==0)for(const dt in tt)tt[dt].setFeatureState(ht,ot)}}class tr extends ct.E{constructor(tt,ot,ht){super(),this.id=tt,this.dispatcher=ht,this.on("data",dt=>this._dataHandler(dt)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((dt,mt,wt,St)=>{const Tt=new(qr(mt.type))(dt,mt,wt,St);if(Tt.id!==dt)throw new Error(`Expected Source id to be ${dt} instead of ${Tt.id}`);return Tt})(tt,ot,ht,this),this._tiles={},this._cache=new Pr(0,dt=>this._unloadTile(dt)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ns,this._didEmitContent=!1,this._updated=!1}onAdd(tt){this.map=tt,this._maxTileCacheSize=tt?tt._maxTileCacheSize:null,this._maxTileCacheZoomLevels=tt?tt._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(tt)}onRemove(tt){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(tt)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const tt in this._tiles){const ot=this._tiles[tt];if(ot.state!=="loaded"&&ot.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const tt=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,tt&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(tt,ot,ht){return ct._(this,void 0,void 0,function*(){try{yield this._source.loadTile(tt),this._tileLoaded(tt,ot,ht)}catch(dt){tt.state="errored",dt.status!==404?this._source.fire(new ct.j(dt,{tile:tt})):this.update(this.transform,this.terrain)}})}_unloadTile(tt){this._source.unloadTile&&this._source.unloadTile(tt)}_abortTile(tt){this._source.abortTile&&this._source.abortTile(tt),this._source.fire(new ct.k("dataabort",{tile:tt,coord:tt.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(tt){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const ot in this._tiles){const ht=this._tiles[ot];ht.upload(tt),ht.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(tt=>tt.tileID).sort(Yn).map(tt=>tt.key)}getRenderableIds(tt){const ot=[];for(const ht in this._tiles)this._isIdRenderable(ht,tt)&&ot.push(this._tiles[ht]);return tt?ot.sort((ht,dt)=>{const mt=ht.tileID,wt=dt.tileID,St=new ct.P(mt.canonical.x,mt.canonical.y)._rotate(this.transform.angle),Tt=new ct.P(wt.canonical.x,wt.canonical.y)._rotate(this.transform.angle);return mt.overscaledZ-wt.overscaledZ||Tt.y-St.y||Tt.x-St.x}).map(ht=>ht.tileID.key):ot.map(ht=>ht.tileID).sort(Yn).map(ht=>ht.key)}hasRenderableParent(tt){const ot=this.findLoadedParent(tt,0);return!!ot&&this._isIdRenderable(ot.tileID.key)}_isIdRenderable(tt,ot){return this._tiles[tt]&&this._tiles[tt].hasData()&&!this._coveredTiles[tt]&&(ot||!this._tiles[tt].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const tt in this._tiles)this._tiles[tt].state!=="errored"&&this._reloadTile(tt,"reloading")}}_reloadTile(tt,ot){return ct._(this,void 0,void 0,function*(){const ht=this._tiles[tt];ht&&(ht.state!=="loading"&&(ht.state=ot),yield this._loadTile(ht,tt,ot))})}_tileLoaded(tt,ot,ht){tt.timeAdded=Lt.now(),ht==="expired"&&(tt.refreshedUponExpiration=!0),this._setTileReloadTimer(ot,tt),this.getSource().type==="raster-dem"&&tt.dem&&this._backfillDEM(tt),this._state.initializeTileState(tt,this.map?this.map.painter:null),tt.aborted||this._source.fire(new ct.k("data",{dataType:"source",tile:tt,coord:tt.tileID}))}_backfillDEM(tt){const ot=this.getRenderableIds();for(let dt=0;dt<ot.length;dt++){const mt=ot[dt];if(tt.neighboringTiles&&tt.neighboringTiles[mt]){const wt=this.getTileByID(mt);ht(tt,wt),ht(wt,tt)}}function ht(dt,mt){dt.needsHillshadePrepare=!0,dt.needsTerrainPrepare=!0;let wt=mt.tileID.canonical.x-dt.tileID.canonical.x;const St=mt.tileID.canonical.y-dt.tileID.canonical.y,Tt=Math.pow(2,dt.tileID.canonical.z),Ft=mt.tileID.key;wt===0&&St===0||Math.abs(St)>1||(Math.abs(wt)>1&&(Math.abs(wt+Tt)===1?wt+=Tt:Math.abs(wt-Tt)===1&&(wt-=Tt)),mt.dem&&dt.dem&&(dt.dem.backfillBorder(mt.dem,wt,St),dt.neighboringTiles&&dt.neighboringTiles[Ft]&&(dt.neighboringTiles[Ft].backfilled=!0)))}}getTile(tt){return this.getTileByID(tt.key)}getTileByID(tt){return this._tiles[tt]}_retainLoadedChildren(tt,ot,ht,dt){for(const mt in this._tiles){let wt=this._tiles[mt];if(dt[mt]||!wt.hasData()||wt.tileID.overscaledZ<=ot||wt.tileID.overscaledZ>ht)continue;let St=wt.tileID;for(;wt&&wt.tileID.overscaledZ>ot+1;){const Ft=wt.tileID.scaledTo(wt.tileID.overscaledZ-1);wt=this._tiles[Ft.key],wt&&wt.hasData()&&(St=Ft)}let Tt=St;for(;Tt.overscaledZ>ot;)if(Tt=Tt.scaledTo(Tt.overscaledZ-1),tt[Tt.key]){dt[St.key]=St;break}}}findLoadedParent(tt,ot){if(tt.key in this._loadedParentTiles){const ht=this._loadedParentTiles[tt.key];return ht&&ht.tileID.overscaledZ>=ot?ht:null}for(let ht=tt.overscaledZ-1;ht>=ot;ht--){const dt=tt.scaledTo(ht),mt=this._getLoadedTile(dt);if(mt)return mt}}findLoadedSibling(tt){return this._getLoadedTile(tt)}_getLoadedTile(tt){const ot=this._tiles[tt.key];return ot&&ot.hasData()?ot:this._cache.getByKey(tt.wrapped().key)}updateCacheSize(tt){const ot=Math.ceil(tt.width/this._source.tileSize)+1,ht=Math.ceil(tt.height/this._source.tileSize)+1,dt=Math.floor(ot*ht*(this._maxTileCacheZoomLevels===null?ct.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),mt=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,dt):dt;this._cache.setMaxSize(mt)}handleWrapJump(tt){const ot=Math.round((tt-(this._prevLng===void 0?tt:this._prevLng))/360);if(this._prevLng=tt,ot){const ht={};for(const dt in this._tiles){const mt=this._tiles[dt];mt.tileID=mt.tileID.unwrapTo(mt.tileID.wrap+ot),ht[mt.tileID.key]=mt}this._tiles=ht;for(const dt in this._timers)clearTimeout(this._timers[dt]),delete this._timers[dt];for(const dt in this._tiles)this._setTileReloadTimer(dt,this._tiles[dt])}}_updateCoveredAndRetainedTiles(tt,ot,ht,dt,mt,wt){const St={},Tt={},Ft=Object.keys(tt),Gt=Lt.now();for(const Xt of Ft){const pn=tt[Xt],wn=this._tiles[Xt];if(!wn||wn.fadeEndTime!==0&&wn.fadeEndTime<=Gt)continue;const kn=this.findLoadedParent(pn,ot),Fn=this.findLoadedSibling(pn),Hn=kn||Fn||null;Hn&&(this._addTile(Hn.tileID),St[Hn.tileID.key]=Hn.tileID),Tt[Xt]=pn}this._retainLoadedChildren(Tt,dt,ht,tt);for(const Xt in St)tt[Xt]||(this._coveredTiles[Xt]=!0,tt[Xt]=St[Xt]);if(wt){const Xt={},pn={};for(const wn of mt)this._tiles[wn.key].hasData()?Xt[wn.key]=wn:pn[wn.key]=wn;for(const wn in pn){const kn=pn[wn].children(this._source.maxzoom);this._tiles[kn[0].key]&&this._tiles[kn[1].key]&&this._tiles[kn[2].key]&&this._tiles[kn[3].key]&&(Xt[kn[0].key]=tt[kn[0].key]=kn[0],Xt[kn[1].key]=tt[kn[1].key]=kn[1],Xt[kn[2].key]=tt[kn[2].key]=kn[2],Xt[kn[3].key]=tt[kn[3].key]=kn[3],delete pn[wn])}for(const wn in pn){const kn=pn[wn],Fn=this.findLoadedParent(kn,this._source.minzoom),Hn=this.findLoadedSibling(kn),Gn=Fn||Hn||null;if(Gn){Xt[Gn.tileID.key]=tt[Gn.tileID.key]=Gn.tileID;for(const Qn in Xt)Xt[Qn].isChildOf(Gn.tileID)&&delete Xt[Qn]}}for(const wn in this._tiles)Xt[wn]||(this._coveredTiles[wn]=!0)}}update(tt,ot){if(!this._sourceLoaded||this._paused)return;let ht;this.transform=tt,this.terrain=ot,this.updateCacheSize(tt),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?ht=tt.getVisibleUnwrappedCoordinates(this._source.tileID).map(Gt=>new ct.S(Gt.canonical.z,Gt.wrap,Gt.canonical.z,Gt.canonical.x,Gt.canonical.y)):(ht=tt.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:ot}),this._source.hasTile&&(ht=ht.filter(Gt=>this._source.hasTile(Gt)))):ht=[];const dt=tt.coveringZoomLevel(this._source),mt=Math.max(dt-tr.maxOverzooming,this._source.minzoom),wt=Math.max(dt+tr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Gt={};for(const Xt of ht)if(Xt.canonical.z>this._source.minzoom){const pn=Xt.scaledTo(Xt.canonical.z-1);Gt[pn.key]=pn;const wn=Xt.scaledTo(Math.max(this._source.minzoom,Math.min(Xt.canonical.z,5)));Gt[wn.key]=wn}ht=ht.concat(Object.values(Gt))}const St=ht.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,St&&this.fire(new ct.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const Tt=this._updateRetainedTiles(ht,dt);qn(this._source.type)&&this._updateCoveredAndRetainedTiles(Tt,mt,wt,dt,ht,ot);for(const Gt in Tt)this._tiles[Gt].clearFadeHold();const Ft=ct.ab(this._tiles,Tt);for(const Gt of Ft){const Xt=this._tiles[Gt];Xt.hasSymbolBuckets&&!Xt.holdingForFade()?Xt.setHoldDuration(this.map._fadeDuration):Xt.hasSymbolBuckets&&!Xt.symbolFadeFinished()||this._removeTile(Gt)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const tt in this._tiles)this._tiles[tt].holdingForFade()&&this._removeTile(tt)}_updateRetainedTiles(tt,ot){var ht;const dt={},mt={},wt=Math.max(ot-tr.maxOverzooming,this._source.minzoom),St=Math.max(ot+tr.maxUnderzooming,this._source.minzoom),Tt={};for(const Ft of tt){const Gt=this._addTile(Ft);dt[Ft.key]=Ft,Gt.hasData()||ot<this._source.maxzoom&&(Tt[Ft.key]=Ft)}this._retainLoadedChildren(Tt,ot,St,dt);for(const Ft of tt){let Gt=this._tiles[Ft.key];if(Gt.hasData())continue;if(ot+1>this._source.maxzoom){const pn=Ft.children(this._source.maxzoom)[0],wn=this.getTile(pn);if(wn&&wn.hasData()){dt[pn.key]=pn;continue}}else{const pn=Ft.children(this._source.maxzoom);if(dt[pn[0].key]&&dt[pn[1].key]&&dt[pn[2].key]&&dt[pn[3].key])continue}let Xt=Gt.wasRequested();for(let pn=Ft.overscaledZ-1;pn>=wt;--pn){const wn=Ft.scaledTo(pn);if(mt[wn.key])break;if(mt[wn.key]=!0,Gt=this.getTile(wn),!Gt&&Xt&&(Gt=this._addTile(wn)),Gt){const kn=Gt.hasData();if((kn||!(!((ht=this.map)===null||ht===void 0)&&ht.cancelPendingTileRequestsWhileZooming)||Xt)&&(dt[wn.key]=wn),Xt=Gt.wasRequested(),kn)break}}}return dt}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const tt in this._tiles){const ot=[];let ht,dt=this._tiles[tt].tileID;for(;dt.overscaledZ>0;){if(dt.key in this._loadedParentTiles){ht=this._loadedParentTiles[dt.key];break}ot.push(dt.key);const mt=dt.scaledTo(dt.overscaledZ-1);if(ht=this._getLoadedTile(mt),ht)break;dt=mt}for(const mt of ot)this._loadedParentTiles[mt]=ht}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const tt in this._tiles){const ot=this._tiles[tt].tileID,ht=this._getLoadedTile(ot);this._loadedSiblingTiles[ot.key]=ht}}_addTile(tt){let ot=this._tiles[tt.key];if(ot)return ot;ot=this._cache.getAndRemove(tt),ot&&(this._setTileReloadTimer(tt.key,ot),ot.tileID=tt,this._state.initializeTileState(ot,this.map?this.map.painter:null),this._cacheTimers[tt.key]&&(clearTimeout(this._cacheTimers[tt.key]),delete this._cacheTimers[tt.key],this._setTileReloadTimer(tt.key,ot)));const ht=ot;return ot||(ot=new Ms(tt,this._source.tileSize*tt.overscaleFactor()),this._loadTile(ot,tt.key,ot.state)),ot.uses++,this._tiles[tt.key]=ot,ht||this._source.fire(new ct.k("dataloading",{tile:ot,coord:ot.tileID,dataType:"source"})),ot}_setTileReloadTimer(tt,ot){tt in this._timers&&(clearTimeout(this._timers[tt]),delete this._timers[tt]);const ht=ot.getExpiryTimeout();ht&&(this._timers[tt]=setTimeout(()=>{this._reloadTile(tt,"expired"),delete this._timers[tt]},ht))}_removeTile(tt){const ot=this._tiles[tt];ot&&(ot.uses--,delete this._tiles[tt],this._timers[tt]&&(clearTimeout(this._timers[tt]),delete this._timers[tt]),ot.uses>0||(ot.hasData()&&ot.state!=="reloading"?this._cache.add(ot.tileID,ot,ot.getExpiryTimeout()):(ot.aborted=!0,this._abortTile(ot),this._unloadTile(ot))))}_dataHandler(tt){const ot=tt.sourceDataType;tt.dataType==="source"&&ot==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&tt.dataType==="source"&&ot==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const tt in this._tiles)this._removeTile(tt);this._cache.reset()}tilesIn(tt,ot,ht){const dt=[],mt=this.transform;if(!mt)return dt;const wt=ht?mt.getCameraQueryGeometry(tt):tt,St=tt.map(kn=>mt.pointCoordinate(kn,this.terrain)),Tt=wt.map(kn=>mt.pointCoordinate(kn,this.terrain)),Ft=this.getIds();let Gt=1/0,Xt=1/0,pn=-1/0,wn=-1/0;for(const kn of Tt)Gt=Math.min(Gt,kn.x),Xt=Math.min(Xt,kn.y),pn=Math.max(pn,kn.x),wn=Math.max(wn,kn.y);for(let kn=0;kn<Ft.length;kn++){const Fn=this._tiles[Ft[kn]];if(Fn.holdingForFade())continue;const Hn=Fn.tileID,Gn=Math.pow(2,mt.zoom-Fn.tileID.overscaledZ),Qn=ot*Fn.queryPadding*ct.X/Fn.tileSize/Gn,Dn=[Hn.getTilePoint(new ct.Z(Gt,Xt)),Hn.getTilePoint(new ct.Z(pn,wn))];if(Dn[0].x-Qn<ct.X&&Dn[0].y-Qn<ct.X&&Dn[1].x+Qn>=0&&Dn[1].y+Qn>=0){const ar=St.map(Ar=>Hn.getTilePoint(Ar)),mr=Tt.map(Ar=>Hn.getTilePoint(Ar));dt.push({tile:Fn,tileID:Hn,queryGeometry:ar,cameraQueryGeometry:mr,scale:Gn})}}return dt}getVisibleCoordinates(tt){const ot=this.getRenderableIds(tt).map(ht=>this._tiles[ht].tileID);for(const ht of ot)ht.posMatrix=this.transform.calculatePosMatrix(ht.toUnwrapped());return ot}hasTransition(){if(this._source.hasTransition())return!0;if(qn(this._source.type)){const tt=Lt.now();for(const ot in this._tiles)if(this._tiles[ot].fadeEndTime>=tt)return!0}return!1}setFeatureState(tt,ot,ht){this._state.updateState(tt=tt||"_geojsonTileLayer",ot,ht)}removeFeatureState(tt,ot,ht){this._state.removeFeatureState(tt=tt||"_geojsonTileLayer",ot,ht)}getFeatureState(tt,ot){return this._state.getState(tt=tt||"_geojsonTileLayer",ot)}setDependencies(tt,ot,ht){const dt=this._tiles[tt];dt&&dt.setDependencies(ot,ht)}reloadTilesForDependencies(tt,ot){for(const ht in this._tiles)this._tiles[ht].hasDependency(tt,ot)&&this._reloadTile(ht,"reloading");this._cache.filter(ht=>!ht.hasDependency(tt,ot))}}function Yn(gt,tt){const ot=Math.abs(2*gt.wrap)-+(gt.wrap<0),ht=Math.abs(2*tt.wrap)-+(tt.wrap<0);return gt.overscaledZ-tt.overscaledZ||ht-ot||tt.canonical.y-gt.canonical.y||tt.canonical.x-gt.canonical.x}function qn(gt){return gt==="raster"||gt==="image"||gt==="video"}tr.maxOverzooming=10,tr.maxUnderzooming=3;class Er{constructor(tt,ot){this.reset(tt,ot)}reset(tt,ot){this.points=tt||[],this._distances=[0];for(let ht=1;ht<this.points.length;ht++)this._distances[ht]=this._distances[ht-1]+this.points[ht].dist(this.points[ht-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(ot||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(tt){if(this.points.length===1)return this.points[0];tt=ct.ac(tt,0,1);let ot=1,ht=this._distances[ot];const dt=tt*this.paddedLength+this.padding;for(;ht<dt&&ot<this._distances.length;)ht=this._distances[++ot];const mt=ot-1,wt=this._distances[mt],St=ht-wt,Tt=St>0?(dt-wt)/St:0;return this.points[mt].mult(1-Tt).add(this.points[ot].mult(Tt))}}function kr(gt,tt){let ot=!0;return gt==="always"||gt!=="never"&&tt!=="never"||(ot=!1),ot}class Us{constructor(tt,ot,ht){const dt=this.boxCells=[],mt=this.circleCells=[];this.xCellCount=Math.ceil(tt/ht),this.yCellCount=Math.ceil(ot/ht);for(let wt=0;wt<this.xCellCount*this.yCellCount;wt++)dt.push([]),mt.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=tt,this.height=ot,this.xScale=this.xCellCount/tt,this.yScale=this.yCellCount/ot,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(tt,ot,ht,dt,mt){this._forEachCell(ot,ht,dt,mt,this._insertBoxCell,this.boxUid++),this.boxKeys.push(tt),this.bboxes.push(ot),this.bboxes.push(ht),this.bboxes.push(dt),this.bboxes.push(mt)}insertCircle(tt,ot,ht,dt){this._forEachCell(ot-dt,ht-dt,ot+dt,ht+dt,this._insertCircleCell,this.circleUid++),this.circleKeys.push(tt),this.circles.push(ot),this.circles.push(ht),this.circles.push(dt)}_insertBoxCell(tt,ot,ht,dt,mt,wt){this.boxCells[mt].push(wt)}_insertCircleCell(tt,ot,ht,dt,mt,wt){this.circleCells[mt].push(wt)}_query(tt,ot,ht,dt,mt,wt,St){if(ht<0||tt>this.width||dt<0||ot>this.height)return[];const Tt=[];if(tt<=0&&ot<=0&&this.width<=ht&&this.height<=dt){if(mt)return[{key:null,x1:tt,y1:ot,x2:ht,y2:dt}];for(let Ft=0;Ft<this.boxKeys.length;Ft++)Tt.push({key:this.boxKeys[Ft],x1:this.bboxes[4*Ft],y1:this.bboxes[4*Ft+1],x2:this.bboxes[4*Ft+2],y2:this.bboxes[4*Ft+3]});for(let Ft=0;Ft<this.circleKeys.length;Ft++){const Gt=this.circles[3*Ft],Xt=this.circles[3*Ft+1],pn=this.circles[3*Ft+2];Tt.push({key:this.circleKeys[Ft],x1:Gt-pn,y1:Xt-pn,x2:Gt+pn,y2:Xt+pn})}}else this._forEachCell(tt,ot,ht,dt,this._queryCell,Tt,{hitTest:mt,overlapMode:wt,seenUids:{box:{},circle:{}}},St);return Tt}query(tt,ot,ht,dt){return this._query(tt,ot,ht,dt,!1,null)}hitTest(tt,ot,ht,dt,mt,wt){return this._query(tt,ot,ht,dt,!0,mt,wt).length>0}hitTestCircle(tt,ot,ht,dt,mt){const wt=tt-ht,St=tt+ht,Tt=ot-ht,Ft=ot+ht;if(St<0||wt>this.width||Ft<0||Tt>this.height)return!1;const Gt=[];return this._forEachCell(wt,Tt,St,Ft,this._queryCellCircle,Gt,{hitTest:!0,overlapMode:dt,circle:{x:tt,y:ot,radius:ht},seenUids:{box:{},circle:{}}},mt),Gt.length>0}_queryCell(tt,ot,ht,dt,mt,wt,St,Tt){const{seenUids:Ft,hitTest:Gt,overlapMode:Xt}=St,pn=this.boxCells[mt];if(pn!==null){const kn=this.bboxes;for(const Fn of pn)if(!Ft.box[Fn]){Ft.box[Fn]=!0;const Hn=4*Fn,Gn=this.boxKeys[Fn];if(tt<=kn[Hn+2]&&ot<=kn[Hn+3]&&ht>=kn[Hn+0]&&dt>=kn[Hn+1]&&(!Tt||Tt(Gn))&&(!Gt||!kr(Xt,Gn.overlapMode))&&(wt.push({key:Gn,x1:kn[Hn],y1:kn[Hn+1],x2:kn[Hn+2],y2:kn[Hn+3]}),Gt))return!0}}const wn=this.circleCells[mt];if(wn!==null){const kn=this.circles;for(const Fn of wn)if(!Ft.circle[Fn]){Ft.circle[Fn]=!0;const Hn=3*Fn,Gn=this.circleKeys[Fn];if(this._circleAndRectCollide(kn[Hn],kn[Hn+1],kn[Hn+2],tt,ot,ht,dt)&&(!Tt||Tt(Gn))&&(!Gt||!kr(Xt,Gn.overlapMode))){const Qn=kn[Hn],Dn=kn[Hn+1],ar=kn[Hn+2];if(wt.push({key:Gn,x1:Qn-ar,y1:Dn-ar,x2:Qn+ar,y2:Dn+ar}),Gt)return!0}}}return!1}_queryCellCircle(tt,ot,ht,dt,mt,wt,St,Tt){const{circle:Ft,seenUids:Gt,overlapMode:Xt}=St,pn=this.boxCells[mt];if(pn!==null){const kn=this.bboxes;for(const Fn of pn)if(!Gt.box[Fn]){Gt.box[Fn]=!0;const Hn=4*Fn,Gn=this.boxKeys[Fn];if(this._circleAndRectCollide(Ft.x,Ft.y,Ft.radius,kn[Hn+0],kn[Hn+1],kn[Hn+2],kn[Hn+3])&&(!Tt||Tt(Gn))&&!kr(Xt,Gn.overlapMode))return wt.push(!0),!0}}const wn=this.circleCells[mt];if(wn!==null){const kn=this.circles;for(const Fn of wn)if(!Gt.circle[Fn]){Gt.circle[Fn]=!0;const Hn=3*Fn,Gn=this.circleKeys[Fn];if(this._circlesCollide(kn[Hn],kn[Hn+1],kn[Hn+2],Ft.x,Ft.y,Ft.radius)&&(!Tt||Tt(Gn))&&!kr(Xt,Gn.overlapMode))return wt.push(!0),!0}}}_forEachCell(tt,ot,ht,dt,mt,wt,St,Tt){const Ft=this._convertToXCellCoord(tt),Gt=this._convertToYCellCoord(ot),Xt=this._convertToXCellCoord(ht),pn=this._convertToYCellCoord(dt);for(let wn=Ft;wn<=Xt;wn++)for(let kn=Gt;kn<=pn;kn++)if(mt.call(this,tt,ot,ht,dt,this.xCellCount*kn+wn,wt,St,Tt))return}_convertToXCellCoord(tt){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(tt*this.xScale)))}_convertToYCellCoord(tt){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(tt*this.yScale)))}_circlesCollide(tt,ot,ht,dt,mt,wt){const St=dt-tt,Tt=mt-ot,Ft=ht+wt;return Ft*Ft>St*St+Tt*Tt}_circleAndRectCollide(tt,ot,ht,dt,mt,wt,St){const Tt=(wt-dt)/2,Ft=Math.abs(tt-(dt+Tt));if(Ft>Tt+ht)return!1;const Gt=(St-mt)/2,Xt=Math.abs(ot-(mt+Gt));if(Xt>Gt+ht)return!1;if(Ft<=Tt||Xt<=Gt)return!0;const pn=Ft-Tt,wn=Xt-Gt;return pn*pn+wn*wn<=ht*ht}}function lo(gt,tt,ot,ht,dt){const mt=ct.H();return tt?(ct.K(mt,mt,[1/dt,1/dt,1]),ot||ct.ad(mt,mt,ht.angle)):ct.L(mt,ht.labelPlaneMatrix,gt),mt}function rr(gt,tt,ot,ht,dt){if(tt){const mt=ct.ae(gt);return ct.K(mt,mt,[dt,dt,1]),ot||ct.ad(mt,mt,-ht.angle),mt}return ht.glCoordMatrix}function _n(gt,tt,ot,ht){let dt;ht?(dt=[gt,tt,ht(gt,tt),1],ct.af(dt,dt,ot)):(dt=[gt,tt,0,1],ir(dt,dt,ot));const mt=dt[3];return{point:new ct.P(dt[0]/mt,dt[1]/mt),signedDistanceFromCamera:mt,isOccluded:!1}}function Wt(gt,tt){return .5+gt/tt*.5}function jt(gt,tt){return gt.x>=-tt[0]&&gt.x<=tt[0]&&gt.y>=-tt[1]&&gt.y<=tt[1]}function ln(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,wn,kn){const Fn=ht?gt.textSizeData:gt.iconSizeData,Hn=ct.ag(Fn,ot.transform.zoom),Gn=[256/ot.width*2+1,256/ot.height*2+1],Qn=ht?gt.text.dynamicLayoutVertexArray:gt.icon.dynamicLayoutVertexArray;Qn.clear();const Dn=gt.lineVertexArray,ar=ht?gt.text.placedSymbolArray:gt.icon.placedSymbolArray,mr=ot.transform.width/ot.transform.height;let Ar=!1;for(let Wr=0;Wr<ar.length;Wr++){const es=ar.get(Wr);if(es.hidden||es.writingMode===ct.ah.vertical&&!Ar){zn(es.numGlyphs,Qn);continue}Ar=!1;const us=_n(es.anchorX,es.anchorY,tt,kn);if(!jt(us.point,Gn)){zn(es.numGlyphs,Qn);continue}const ys=Wt(ot.transform.cameraToCenterDistance,us.signedDistanceFromCamera),os=ct.ai(Fn,Hn,es),rs=wt?os/ys:os*ys,Rs={getElevation:kn,labelPlaneMatrix:dt,lineVertexArray:Dn,pitchWithMap:wt,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:Ft,tileAnchorPoint:new ct.P(es.anchorX,es.anchorY),unwrappedTileID:Gt,width:Xt,height:pn,translation:wn},no=Tn(Rs,es,rs,!1,St,tt,mt,gt.glyphOffsetArray,Qn,mr,Tt);Ar=no.useVertical,(no.notEnoughRoom||Ar||no.needsFlipping&&Tn(Rs,es,rs,!0,St,tt,mt,gt.glyphOffsetArray,Qn,mr,Tt).notEnoughRoom)&&zn(es.numGlyphs,Qn)}ht?gt.text.dynamicLayoutVertexBuffer.updateData(Qn):gt.icon.dynamicLayoutVertexBuffer.updateData(Qn)}function xn(gt,tt,ot,ht,dt,mt,wt,St){const Tt=mt.glyphStartIndex+mt.numGlyphs,Ft=mt.lineStartIndex,Gt=mt.lineStartIndex+mt.lineLength,Xt=tt.getoffsetX(mt.glyphStartIndex),pn=tt.getoffsetX(Tt-1),wn=yn(gt*Xt,ot,ht,dt,mt.segment,Ft,Gt,St,wt);if(!wn)return null;const kn=yn(gt*pn,ot,ht,dt,mt.segment,Ft,Gt,St,wt);return kn?St.projectionCache.anyProjectionOccluded?null:{first:wn,last:kn}:null}function Nn(gt,tt,ot,ht){return gt===ct.ah.horizontal&&Math.abs(ot.y-tt.y)>Math.abs(ot.x-tt.x)*ht?{useVertical:!0}:(gt===ct.ah.vertical?tt.y<ot.y:tt.x>ot.x)?{needsFlipping:!0}:null}function Tn(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt){const Xt=ot/24,pn=tt.lineOffsetX*Xt,wn=tt.lineOffsetY*Xt;let kn;if(tt.numGlyphs>1){const Fn=tt.glyphStartIndex+tt.numGlyphs,Hn=tt.lineStartIndex,Gn=tt.lineStartIndex+tt.lineLength,Qn=xn(Xt,St,pn,wn,ht,tt,Gt,gt);if(!Qn)return{notEnoughRoom:!0};const Dn=_n(Qn.first.point.x,Qn.first.point.y,wt,gt.getElevation).point,ar=_n(Qn.last.point.x,Qn.last.point.y,wt,gt.getElevation).point;if(dt&&!ht){const mr=Nn(tt.writingMode,Dn,ar,Ft);if(mr)return mr}kn=[Qn.first];for(let mr=tt.glyphStartIndex+1;mr<Fn-1;mr++)kn.push(yn(Xt*St.getoffsetX(mr),pn,wn,ht,tt.segment,Hn,Gn,gt,Gt));kn.push(Qn.last)}else{if(dt&&!ht){const Hn=_n(gt.tileAnchorPoint.x,gt.tileAnchorPoint.y,mt,gt.getElevation).point,Gn=tt.lineStartIndex+tt.segment+1,Qn=new ct.P(gt.lineVertexArray.getx(Gn),gt.lineVertexArray.gety(Gn)),Dn=_n(Qn.x,Qn.y,mt,gt.getElevation),ar=Dn.signedDistanceFromCamera>0?Dn.point:function(Ar,Wr,es,us,ys,os){return Kn(Ar,Wr,es,1,ys,os)}(gt.tileAnchorPoint,Qn,Hn,0,mt,gt),mr=Nn(tt.writingMode,Hn,ar,Ft);if(mr)return mr}const Fn=yn(Xt*St.getoffsetX(tt.glyphStartIndex),pn,wn,ht,tt.segment,tt.lineStartIndex,tt.lineStartIndex+tt.lineLength,gt,Gt);if(!Fn||gt.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};kn=[Fn]}for(const Fn of kn)ct.aj(Tt,Fn.point,Fn.angle);return{}}function Kn(gt,tt,ot,ht,dt,mt){const wt=gt.add(gt.sub(tt)._unit()),St=dt!==void 0?_n(wt.x,wt.y,dt,mt.getElevation).point:un(wt.x,wt.y,mt).point,Tt=ot.sub(St);return ot.add(Tt._mult(ht/Tt.mag()))}function Cn(gt,tt,ot){const ht=tt.projectionCache;if(ht.projections[gt])return ht.projections[gt];const dt=new ct.P(tt.lineVertexArray.getx(gt),tt.lineVertexArray.gety(gt)),mt=un(dt.x,dt.y,tt);if(mt.signedDistanceFromCamera>0)return ht.projections[gt]=mt.point,ht.anyProjectionOccluded=ht.anyProjectionOccluded||mt.isOccluded,mt.point;const wt=gt-ot.direction;return function(St,Tt,Ft,Gt,Xt){return Kn(St,Tt,Ft,Gt,void 0,Xt)}(ot.distanceFromAnchor===0?tt.tileAnchorPoint:new ct.P(tt.lineVertexArray.getx(wt),tt.lineVertexArray.gety(wt)),dt,ot.previousVertex,ot.absOffsetX-ot.distanceFromAnchor+1,tt)}function un(gt,tt,ot){const ht=gt+ot.translation[0],dt=tt+ot.translation[1];let mt;return!ot.pitchWithMap&&ot.projection.useSpecialProjectionForSymbols?(mt=ot.projection.projectTileCoordinates(ht,dt,ot.unwrappedTileID,ot.getElevation),mt.point.x=(.5*mt.point.x+.5)*ot.width,mt.point.y=(.5*-mt.point.y+.5)*ot.height):(mt=_n(ht,dt,ot.labelPlaneMatrix,ot.getElevation),mt.isOccluded=!1),mt}function Rt(gt,tt,ot){return gt._unit()._perp()._mult(tt*ot)}function qt(gt,tt,ot,ht,dt,mt,wt,St,Tt){if(St.projectionCache.offsets[gt])return St.projectionCache.offsets[gt];const Ft=ot.add(tt);if(gt+Tt.direction<ht||gt+Tt.direction>=dt)return St.projectionCache.offsets[gt]=Ft,Ft;const Gt=Cn(gt+Tt.direction,St,Tt),Xt=Rt(Gt.sub(ot),wt,Tt.direction),pn=ot.add(Xt),wn=Gt.add(Xt);return St.projectionCache.offsets[gt]=ct.ak(mt,Ft,pn,wn)||Ft,St.projectionCache.offsets[gt]}function yn(gt,tt,ot,ht,dt,mt,wt,St,Tt){const Ft=ht?gt-tt:gt+tt;let Gt=Ft>0?1:-1,Xt=0;ht&&(Gt*=-1,Xt=Math.PI),Gt<0&&(Xt+=Math.PI);let pn,wn=Gt>0?mt+dt:mt+dt+1;St.projectionCache.cachedAnchorPoint?pn=St.projectionCache.cachedAnchorPoint:(pn=un(St.tileAnchorPoint.x,St.tileAnchorPoint.y,St).point,St.projectionCache.cachedAnchorPoint=pn);let kn,Fn,Hn=pn,Gn=pn,Qn=0,Dn=0;const ar=Math.abs(Ft),mr=[];let Ar;for(;Qn+Dn<=ar;){if(wn+=Gt,wn<mt||wn>=wt)return null;Qn+=Dn,Gn=Hn,Fn=kn;const us={absOffsetX:ar,direction:Gt,distanceFromAnchor:Qn,previousVertex:Gn};if(Hn=Cn(wn,St,us),ot===0)mr.push(Gn),Ar=Hn.sub(Gn);else{let ys;const os=Hn.sub(Gn);ys=os.mag()===0?Rt(Cn(wn+Gt,St,us).sub(Hn),ot,Gt):Rt(os,ot,Gt),Fn||(Fn=Gn.add(ys)),kn=qt(wn,ys,Hn,mt,wt,Fn,ot,St,us),mr.push(Fn),Ar=kn.sub(Fn)}Dn=Ar.mag()}const Wr=Ar._mult((ar-Qn)/Dn)._add(Fn||Gn),es=Xt+Math.atan2(Hn.y-Gn.y,Hn.x-Gn.x);return mr.push(Wr),{point:Wr,angle:Tt?es:0,path:mr}}const Rn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function zn(gt,tt){for(let ot=0;ot<gt;ot++){const ht=tt.length;tt.resize(ht+4),tt.float32.set(Rn,3*ht)}}function ir(gt,tt,ot){const ht=tt[0],dt=tt[1];return gt[0]=ot[0]*ht+ot[4]*dt+ot[12],gt[1]=ot[1]*ht+ot[5]*dt+ot[13],gt[3]=ot[3]*ht+ot[7]*dt+ot[15],gt}const Sr=100;class Nr{constructor(tt,ot,ht=new Us(tt.width+200,tt.height+200,25),dt=new Us(tt.width+200,tt.height+200,25)){this.transform=tt,this.mapProjection=ot,this.grid=ht,this.ignoredGrid=dt,this.pitchFactor=Math.cos(tt._pitch)*tt.cameraToCenterDistance,this.screenRightBoundary=tt.width+Sr,this.screenBottomBoundary=tt.height+Sr,this.gridRightBoundary=tt.width+200,this.gridBottomBoundary=tt.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt){const pn=tt.anchorPointX+Tt[0],wn=tt.anchorPointY+Tt[1],kn=this.projectAndGetPerspectiveRatio(dt,pn,wn,mt,Gt),Fn=ht*kn.perspectiveRatio;let Hn;if(wt||St)Hn=this._projectCollisionBox(tt,Fn,dt,mt,wt,St,Tt,kn,Gt,Xt);else{const mr=kn.point.x+(Xt?Xt.x*Fn:0),Ar=kn.point.y+(Xt?Xt.y*Fn:0);Hn={allPointsOccluded:!1,box:[mr+tt.x1*Fn,Ar+tt.y1*Fn,mr+tt.x2*Fn,Ar+tt.y2*Fn]}}const[Gn,Qn,Dn,ar]=Hn.box;return this.mapProjection.useSpecialProjectionForSymbols&&(wt?Hn.allPointsOccluded:this.mapProjection.isOccluded(pn,wn,mt))||kn.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Gn,Qn,Dn,ar)||ot!=="always"&&this.grid.hitTest(Gn,Qn,Dn,ar,ot,Ft)?{box:[Gn,Qn,Dn,ar],placeable:!1,offscreen:!1}:{box:[Gn,Qn,Dn,ar],placeable:!0,offscreen:this.isOffscreen(Gn,Qn,Dn,ar)}}placeCollisionCircles(tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,wn,kn,Fn,Hn){const Gn=[],Qn=new ct.P(ot.anchorX,ot.anchorY),Dn=this.getPerspectiveRatio(wt,Qn.x,Qn.y,St,Hn),ar=(Xt?mt/Dn:mt*Dn)/ct.ap,mr={getElevation:Hn,labelPlaneMatrix:Tt,lineVertexArray:ht,pitchWithMap:Xt,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Qn,unwrappedTileID:St,width:this.transform.width,height:this.transform.height,translation:Fn},Ar=xn(ar,dt,ot.lineOffsetX*ar,ot.lineOffsetY*ar,!1,ot,!1,mr);let Wr=!1,es=!1,us=!0;if(Ar){const ys=.5*wn*Dn+kn,os=new ct.P(-100,-100),rs=new ct.P(this.screenRightBoundary,this.screenBottomBoundary),Rs=new Er,no=Ar.first,as=Ar.last;let ms=[];for(let co=no.path.length-1;co>=1;co--)ms.push(no.path[co]);for(let co=1;co<as.path.length;co++)ms.push(as.path[co]);const Qs=2.5*ys;if(Ft){const co=this.projectPathToScreenSpace(ms,mr,Ft);ms=co.some(mo=>mo.signedDistanceFromCamera<=0)?[]:co.map(mo=>mo.point)}let Ho=[];if(ms.length>0){const co=ms[0].clone(),mo=ms[0].clone();for(let Wo=1;Wo<ms.length;Wo++)co.x=Math.min(co.x,ms[Wo].x),co.y=Math.min(co.y,ms[Wo].y),mo.x=Math.max(mo.x,ms[Wo].x),mo.y=Math.max(mo.y,ms[Wo].y);Ho=co.x>=os.x&&mo.x<=rs.x&&co.y>=os.y&&mo.y<=rs.y?[ms]:mo.x<os.x||co.x>rs.x||mo.y<os.y||co.y>rs.y?[]:ct.al([ms],os.x,os.y,rs.x,rs.y)}for(const co of Ho){Rs.reset(co,.25*ys);let mo=0;mo=Rs.length<=.5*ys?1:Math.ceil(Rs.paddedLength/Qs)+1;for(let Wo=0;Wo<mo;Wo++){const Nl=Wo/Math.max(mo-1,1),Iu=Rs.lerp(Nl),qo=Iu.x+Sr,su=Iu.y+Sr;Gn.push(qo,su,ys,0);const Yl=qo-ys,Bl=su-ys,Jl=qo+ys,Wu=su+ys;if(us=us&&this.isOffscreen(Yl,Bl,Jl,Wu),es=es||this.isInsideGrid(Yl,Bl,Jl,Wu),tt!=="always"&&this.grid.hitTestCircle(qo,su,ys,tt,pn)&&(Wr=!0,!Gt))return{circles:[],offscreen:!1,collisionDetected:Wr}}}}return{circles:!Gt&&Wr||!es||Dn<this.perspectiveRatioCutoff?[]:Gn,offscreen:us,collisionDetected:Wr}}projectPathToScreenSpace(tt,ot,ht){return tt.map(dt=>_n(dt.x,dt.y,ht,ot.getElevation))}queryRenderedSymbols(tt){if(tt.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const ot=[];let ht=1/0,dt=1/0,mt=-1/0,wt=-1/0;for(const Gt of tt){const Xt=new ct.P(Gt.x+Sr,Gt.y+Sr);ht=Math.min(ht,Xt.x),dt=Math.min(dt,Xt.y),mt=Math.max(mt,Xt.x),wt=Math.max(wt,Xt.y),ot.push(Xt)}const St=this.grid.query(ht,dt,mt,wt).concat(this.ignoredGrid.query(ht,dt,mt,wt)),Tt={},Ft={};for(const Gt of St){const Xt=Gt.key;if(Tt[Xt.bucketInstanceId]===void 0&&(Tt[Xt.bucketInstanceId]={}),Tt[Xt.bucketInstanceId][Xt.featureIndex])continue;const pn=[new ct.P(Gt.x1,Gt.y1),new ct.P(Gt.x2,Gt.y1),new ct.P(Gt.x2,Gt.y2),new ct.P(Gt.x1,Gt.y2)];ct.am(ot,pn)&&(Tt[Xt.bucketInstanceId][Xt.featureIndex]=!0,Ft[Xt.bucketInstanceId]===void 0&&(Ft[Xt.bucketInstanceId]=[]),Ft[Xt.bucketInstanceId].push(Xt.featureIndex))}return Ft}insertCollisionBox(tt,ot,ht,dt,mt,wt){(ht?this.ignoredGrid:this.grid).insert({bucketInstanceId:dt,featureIndex:mt,collisionGroupID:wt,overlapMode:ot},tt[0],tt[1],tt[2],tt[3])}insertCollisionCircles(tt,ot,ht,dt,mt,wt){const St=ht?this.ignoredGrid:this.grid,Tt={bucketInstanceId:dt,featureIndex:mt,collisionGroupID:wt,overlapMode:ot};for(let Ft=0;Ft<tt.length;Ft+=4)St.insertCircle(Tt,tt[Ft],tt[Ft+1],tt[Ft+2])}projectAndGetPerspectiveRatio(tt,ot,ht,dt,mt){let wt;mt?(wt=[ot,ht,mt(ot,ht),1],ct.af(wt,wt,tt)):(wt=[ot,ht,0,1],ir(wt,wt,tt));const St=wt[3];return{point:new ct.P((wt[0]/St+1)/2*this.transform.width+Sr,(-wt[1]/St+1)/2*this.transform.height+Sr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/St*.5,isOccluded:!1,signedDistanceFromCamera:St}}getPerspectiveRatio(tt,ot,ht,dt,mt){const wt=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(ot,ht,dt,mt):_n(ot,ht,tt,mt);return .5+this.transform.cameraToCenterDistance/wt.signedDistanceFromCamera*.5}isOffscreen(tt,ot,ht,dt){return ht<Sr||tt>=this.screenRightBoundary||dt<Sr||ot>this.screenBottomBoundary}isInsideGrid(tt,ot,ht,dt){return ht>=0&&tt<this.gridRightBoundary&&dt>=0&&ot<this.gridBottomBoundary}getViewportMatrix(){const tt=ct.an([]);return ct.J(tt,tt,[-100,-100,0]),tt}_projectCollisionBox(tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt){let Xt=new ct.P(1,0),pn=new ct.P(0,1);const wn=new ct.P(tt.anchorPointX+St[0],tt.anchorPointY+St[1]);if(wt&&!mt){const us=this.projectAndGetPerspectiveRatio(ht,wn.x+1,wn.y,dt,Ft).point.sub(Tt.point).unit(),ys=Math.atan(us.y/us.x)+(us.x<0?Math.PI:0),os=Math.sin(ys),rs=Math.cos(ys);Xt=new ct.P(rs,os),pn=new ct.P(-os,rs)}else if(!wt&&mt){const us=-this.transform.angle,ys=Math.sin(us),os=Math.cos(us);Xt=new ct.P(os,ys),pn=new ct.P(-ys,os)}let kn=Tt.point,Fn=ot;if(mt){kn=wn;const us=this.transform.zoom-Math.floor(this.transform.zoom);Fn=Math.pow(2,-us),Fn*=this.mapProjection.getPitchedTextCorrection(this.transform,wn,dt),Gt||(Fn*=ct.ac(.5+Tt.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}Gt&&(kn=kn.add(Xt.mult(Gt.x*Fn)).add(pn.mult(Gt.y*Fn)));const Hn=tt.x1*Fn,Gn=tt.x2*Fn,Qn=(Hn+Gn)/2,Dn=tt.y1*Fn,ar=tt.y2*Fn,mr=(Dn+ar)/2,Ar=[{offsetX:Hn,offsetY:Dn},{offsetX:Qn,offsetY:Dn},{offsetX:Gn,offsetY:Dn},{offsetX:Gn,offsetY:mr},{offsetX:Gn,offsetY:ar},{offsetX:Qn,offsetY:ar},{offsetX:Hn,offsetY:ar},{offsetX:Hn,offsetY:mr}];let Wr=[];for(const{offsetX:us,offsetY:ys}of Ar)Wr.push(new ct.P(kn.x+Xt.x*us+pn.x*ys,kn.y+Xt.y*us+pn.y*ys));let es=!1;if(mt){const us=Wr.map(ys=>this.projectAndGetPerspectiveRatio(ht,ys.x,ys.y,dt,Ft));es=us.some(ys=>!ys.isOccluded),Wr=us.map(ys=>ys.point)}else es=!0;return{box:ct.ao(Wr),allPointsOccluded:!es}}}function Fr(gt,tt,ot){return tt*(ct.X/(gt.tileSize*Math.pow(2,ot-gt.tileID.overscaledZ)))}class ps{constructor(tt,ot,ht,dt){this.opacity=tt?Math.max(0,Math.min(1,tt.opacity+(tt.placed?ot:-ot))):dt&&ht?1:0,this.placed=ht}isHidden(){return this.opacity===0&&!this.placed}}class Gr{constructor(tt,ot,ht,dt,mt){this.text=new ps(tt?tt.text:null,ot,ht,mt),this.icon=new ps(tt?tt.icon:null,ot,dt,mt)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ur{constructor(tt,ot,ht){this.text=tt,this.icon=ot,this.skipFade=ht}}class is{constructor(){this.invProjMatrix=ct.H(),this.viewportMatrix=ct.H(),this.circles=[]}}class fs{constructor(tt,ot,ht,dt,mt){this.bucketInstanceId=tt,this.featureIndex=ot,this.sourceLayerIndex=ht,this.bucketIndex=dt,this.tileID=mt}}class zs{constructor(tt){this.crossSourceCollisions=tt,this.maxGroupID=0,this.collisionGroups={}}get(tt){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[tt]){const ot=++this.maxGroupID;this.collisionGroups[tt]={ID:ot,predicate:ht=>ht.collisionGroupID===ot}}return this.collisionGroups[tt]}}function Gs(gt,tt,ot,ht,dt){const{horizontalAlign:mt,verticalAlign:wt}=ct.au(gt);return new ct.P(-(mt-.5)*tt+ht[0]*dt,-(wt-.5)*ot+ht[1]*dt)}class go{constructor(tt,ot,ht,dt,mt,wt){this.transform=tt.clone(),this.terrain=ht,this.collisionIndex=new Nr(this.transform,ot),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=dt,this.retainedQueryData={},this.collisionGroups=new zs(mt),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=wt,wt&&(wt.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(tt){const ot=this.terrain;return ot?(ht,dt)=>ot.getElevation(tt,ht,dt):null}getBucketParts(tt,ot,ht,dt){const mt=ht.getBucket(ot),wt=ht.latestFeatureIndex;if(!mt||!wt||ot.id!==mt.layerIds[0])return;const St=ht.collisionBoxArray,Tt=mt.layers[0].layout,Ft=mt.layers[0].paint,Gt=Math.pow(2,this.transform.zoom-ht.tileID.overscaledZ),Xt=ht.tileSize/ct.X,pn=ht.tileID.toUnwrapped(),wn=this.transform.calculatePosMatrix(pn),kn=Tt.get("text-pitch-alignment")==="map",Fn=Tt.get("text-rotation-alignment")==="map",Hn=Fr(ht,1,this.transform.zoom),Gn=this.collisionIndex.mapProjection.translatePosition(this.transform,ht,Ft.get("text-translate"),Ft.get("text-translate-anchor")),Qn=this.collisionIndex.mapProjection.translatePosition(this.transform,ht,Ft.get("icon-translate"),Ft.get("icon-translate-anchor")),Dn=lo(wn,kn,Fn,this.transform,Hn);let ar=null;if(kn){const Ar=rr(wn,kn,Fn,this.transform,Hn);ar=ct.L([],this.transform.labelPlaneMatrix,Ar)}this.retainedQueryData[mt.bucketInstanceId]=new fs(mt.bucketInstanceId,wt,mt.sourceLayerIndex,mt.index,ht.tileID);const mr={bucket:mt,layout:Tt,translationText:Gn,translationIcon:Qn,posMatrix:wn,unwrappedTileID:pn,textLabelPlaneMatrix:Dn,labelToScreenMatrix:ar,scale:Gt,textPixelRatio:Xt,holdingForFade:ht.holdingForFade(),collisionBoxArray:St,partiallyEvaluatedTextSize:ct.ag(mt.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(mt.sourceID)};if(dt)for(const Ar of mt.sortKeyRanges){const{sortKey:Wr,symbolInstanceStart:es,symbolInstanceEnd:us}=Ar;tt.push({sortKey:Wr,symbolInstanceStart:es,symbolInstanceEnd:us,parameters:mr})}else tt.push({symbolInstanceStart:0,symbolInstanceEnd:mt.symbolInstances.length,parameters:mr})}attemptAnchorPlacement(tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,wn,kn,Fn,Hn,Gn,Qn,Dn){const ar=ct.aq[tt.textAnchor],mr=[tt.textOffset0,tt.textOffset1],Ar=Gs(ar,ht,dt,mr,mt),Wr=this.collisionIndex.placeCollisionBox(ot,pn,Tt,Ft,Gt,St,wt,Hn,Xt.predicate,Dn,Ar);if((!Qn||this.collisionIndex.placeCollisionBox(Qn,pn,Tt,Ft,Gt,St,wt,Gn,Xt.predicate,Dn,Ar).placeable)&&Wr.placeable){let es;if(this.prevPlacement&&this.prevPlacement.variableOffsets[wn.crossTileID]&&this.prevPlacement.placements[wn.crossTileID]&&this.prevPlacement.placements[wn.crossTileID].text&&(es=this.prevPlacement.variableOffsets[wn.crossTileID].anchor),wn.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[wn.crossTileID]={textOffset:mr,width:ht,height:dt,anchor:ar,textBoxScale:mt,prevAnchor:es},this.markUsedJustification(kn,ar,wn,Fn),kn.allowVerticalPlacement&&(this.markUsedOrientation(kn,Fn,wn),this.placedOrientations[wn.crossTileID]=Fn),{shift:Ar,placedGlyphBoxes:Wr}}}placeLayerBucketPart(tt,ot,ht){const{bucket:dt,layout:mt,translationText:wt,translationIcon:St,posMatrix:Tt,unwrappedTileID:Ft,textLabelPlaneMatrix:Gt,labelToScreenMatrix:Xt,textPixelRatio:pn,holdingForFade:wn,collisionBoxArray:kn,partiallyEvaluatedTextSize:Fn,collisionGroup:Hn}=tt.parameters,Gn=mt.get("text-optional"),Qn=mt.get("icon-optional"),Dn=ct.ar(mt,"text-overlap","text-allow-overlap"),ar=Dn==="always",mr=ct.ar(mt,"icon-overlap","icon-allow-overlap"),Ar=mr==="always",Wr=mt.get("text-rotation-alignment")==="map",es=mt.get("text-pitch-alignment")==="map",us=mt.get("icon-text-fit")!=="none",ys=mt.get("symbol-z-order")==="viewport-y",os=ar&&(Ar||!dt.hasIconData()||Qn),rs=Ar&&(ar||!dt.hasTextData()||Gn);!dt.collisionArrays&&kn&&dt.deserializeCollisionBoxes(kn);const Rs=this._getTerrainElevationFunc(this.retainedQueryData[dt.bucketInstanceId].tileID),no=(as,ms,Qs)=>{var Ho,co;if(ot[as.crossTileID])return;if(wn)return void(this.placements[as.crossTileID]=new Ur(!1,!1,!1));let mo=!1,Wo=!1,Nl=!0,Iu=null,qo={box:null,placeable:!1,offscreen:null},su={box:null,placeable:!1,offscreen:null},Yl=null,Bl=null,Jl=null,Wu=0,em=0,Vm=0;ms.textFeatureIndex?Wu=ms.textFeatureIndex:as.useRuntimeCollisionCircles&&(Wu=as.featureIndex),ms.verticalTextFeatureIndex&&(em=ms.verticalTextFeatureIndex);const tm=ms.textBox;if(tm){const Au=Dl=>{let $l=ct.ah.horizontal;if(dt.allowVerticalPlacement&&!Dl&&this.prevPlacement){const _u=this.prevPlacement.placedOrientations[as.crossTileID];_u&&(this.placedOrientations[as.crossTileID]=_u,$l=_u,this.markUsedOrientation(dt,$l,as))}return $l},Tu=(Dl,$l)=>{if(dt.allowVerticalPlacement&&as.numVerticalGlyphVertices>0&&ms.verticalTextBox){for(const _u of dt.writingModes)if(_u===ct.ah.vertical?(qo=$l(),su=qo):qo=Dl(),qo&&qo.placeable)break}else qo=Dl()},hp=as.textAnchorOffsetStartIndex,Du=as.textAnchorOffsetEndIndex;if(Du===hp){const Dl=($l,_u)=>{const vo=this.collisionIndex.placeCollisionBox($l,Dn,pn,Tt,Ft,es,Wr,wt,Hn.predicate,Rs);return vo&&vo.placeable&&(this.markUsedOrientation(dt,_u,as),this.placedOrientations[as.crossTileID]=_u),vo};Tu(()=>Dl(tm,ct.ah.horizontal),()=>{const $l=ms.verticalTextBox;return dt.allowVerticalPlacement&&as.numVerticalGlyphVertices>0&&$l?Dl($l,ct.ah.vertical):{box:null,offscreen:null}}),Au(qo&&qo.placeable)}else{let Dl=ct.aq[(co=(Ho=this.prevPlacement)===null||Ho===void 0?void 0:Ho.variableOffsets[as.crossTileID])===null||co===void 0?void 0:co.anchor];const $l=(vo,Fp,nm)=>{const im=vo.x2-vo.x1,fy=vo.y2-vo.y1,s0=as.textBoxScale,my=us&&mr==="never"?Fp:null;let dp=null,gy=Dn==="never"?1:2,Wm="never";Dl&&gy++;for(let xm=0;xm<gy;xm++){for(let qm=hp;qm<Du;qm++){const Gm=dt.textAnchorOffsets.get(qm);if(Dl&&Gm.textAnchor!==Dl)continue;const rm=this.attemptAnchorPlacement(Gm,vo,im,fy,s0,Wr,es,pn,Tt,Ft,Hn,Wm,as,dt,nm,wt,St,my,Rs);if(rm&&(dp=rm.placedGlyphBoxes,dp&&dp.placeable))return mo=!0,Iu=rm.shift,dp}Dl?Dl=null:Wm=Dn}return ht&&!dp&&(dp={box:this.collisionIndex.placeCollisionBox(tm,"always",pn,Tt,Ft,es,Wr,wt,Hn.predicate,Rs,new ct.P(0,0)).box,offscreen:!1,placeable:!1}),dp};Tu(()=>$l(tm,ms.iconBox,ct.ah.horizontal),()=>{const vo=ms.verticalTextBox;return dt.allowVerticalPlacement&&(!qo||!qo.placeable)&&as.numVerticalGlyphVertices>0&&vo?$l(vo,ms.verticalIconBox,ct.ah.vertical):{box:null,occluded:!0,offscreen:null}}),qo&&(mo=qo.placeable,Nl=qo.offscreen);const _u=Au(qo&&qo.placeable);if(!mo&&this.prevPlacement){const vo=this.prevPlacement.variableOffsets[as.crossTileID];vo&&(this.variableOffsets[as.crossTileID]=vo,this.markUsedJustification(dt,vo.anchor,as,_u))}}}if(Yl=qo,mo=Yl&&Yl.placeable,Nl=Yl&&Yl.offscreen,as.useRuntimeCollisionCircles){const Au=dt.text.placedSymbolArray.get(as.centerJustifiedTextSymbolIndex),Tu=ct.ai(dt.textSizeData,Fn,Au),hp=mt.get("text-padding");Bl=this.collisionIndex.placeCollisionCircles(Dn,Au,dt.lineVertexArray,dt.glyphOffsetArray,Tu,Tt,Ft,Gt,Xt,ht,es,Hn.predicate,as.collisionCircleDiameter,hp,wt,Rs),Bl.circles.length&&Bl.collisionDetected&&!ht&&ct.w("Collisions detected, but collision boxes are not shown"),mo=ar||Bl.circles.length>0&&!Bl.collisionDetected,Nl=Nl&&Bl.offscreen}if(ms.iconFeatureIndex&&(Vm=ms.iconFeatureIndex),ms.iconBox){const Au=Tu=>this.collisionIndex.placeCollisionBox(Tu,mr,pn,Tt,Ft,es,Wr,St,Hn.predicate,Rs,us&&Iu?Iu:void 0);su&&su.placeable&&ms.verticalIconBox?(Jl=Au(ms.verticalIconBox),Wo=Jl.placeable):(Jl=Au(ms.iconBox),Wo=Jl.placeable),Nl=Nl&&Jl.offscreen}const Su=Gn||as.numHorizontalGlyphVertices===0&&as.numVerticalGlyphVertices===0,Hm=Qn||as.numIconVertices===0;Su||Hm?Hm?Su||(Wo=Wo&&mo):mo=Wo&&mo:Wo=mo=Wo&&mo;const L_=Wo&&Jl.placeable;if(mo&&Yl.placeable&&this.collisionIndex.insertCollisionBox(Yl.box,Dn,mt.get("text-ignore-placement"),dt.bucketInstanceId,su&&su.placeable&&em?em:Wu,Hn.ID),L_&&this.collisionIndex.insertCollisionBox(Jl.box,mr,mt.get("icon-ignore-placement"),dt.bucketInstanceId,Vm,Hn.ID),Bl&&mo&&this.collisionIndex.insertCollisionCircles(Bl.circles,Dn,mt.get("text-ignore-placement"),dt.bucketInstanceId,Wu,Hn.ID),ht&&this.storeCollisionData(dt.bucketInstanceId,Qs,ms,Yl,Jl,Bl),as.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(dt.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[as.crossTileID]=new Ur(mo||os,Wo||rs,Nl||dt.justReloaded),ot[as.crossTileID]=!0};if(ys){if(tt.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const as=dt.getSortedSymbolIndexes(this.transform.angle);for(let ms=as.length-1;ms>=0;--ms){const Qs=as[ms];no(dt.symbolInstances.get(Qs),dt.collisionArrays[Qs],Qs)}}else for(let as=tt.symbolInstanceStart;as<tt.symbolInstanceEnd;as++)no(dt.symbolInstances.get(as),dt.collisionArrays[as],as);if(ht&&dt.bucketInstanceId in this.collisionCircleArrays){const as=this.collisionCircleArrays[dt.bucketInstanceId];ct.as(as.invProjMatrix,Tt),as.viewportMatrix=this.collisionIndex.getViewportMatrix()}dt.justReloaded=!1}storeCollisionData(tt,ot,ht,dt,mt,wt){if(ht.textBox||ht.iconBox){let St,Tt;this.collisionBoxArrays.has(tt)?St=this.collisionBoxArrays.get(tt):(St=new Map,this.collisionBoxArrays.set(tt,St)),St.has(ot)?Tt=St.get(ot):(Tt={text:null,icon:null},St.set(ot,Tt)),ht.textBox&&(Tt.text=dt.box),ht.iconBox&&(Tt.icon=mt.box)}if(wt){let St=this.collisionCircleArrays[tt];St===void 0&&(St=this.collisionCircleArrays[tt]=new is);for(let Tt=0;Tt<wt.circles.length;Tt+=4)St.circles.push(wt.circles[Tt+0]),St.circles.push(wt.circles[Tt+1]),St.circles.push(wt.circles[Tt+2]),St.circles.push(wt.collisionDetected?1:0)}}markUsedJustification(tt,ot,ht,dt){let mt;mt=dt===ct.ah.vertical?ht.verticalPlacedTextSymbolIndex:{left:ht.leftJustifiedTextSymbolIndex,center:ht.centerJustifiedTextSymbolIndex,right:ht.rightJustifiedTextSymbolIndex}[ct.at(ot)];const wt=[ht.leftJustifiedTextSymbolIndex,ht.centerJustifiedTextSymbolIndex,ht.rightJustifiedTextSymbolIndex,ht.verticalPlacedTextSymbolIndex];for(const St of wt)St>=0&&(tt.text.placedSymbolArray.get(St).crossTileID=mt>=0&&St!==mt?0:ht.crossTileID)}markUsedOrientation(tt,ot,ht){const dt=ot===ct.ah.horizontal||ot===ct.ah.horizontalOnly?ot:0,mt=ot===ct.ah.vertical?ot:0,wt=[ht.leftJustifiedTextSymbolIndex,ht.centerJustifiedTextSymbolIndex,ht.rightJustifiedTextSymbolIndex];for(const St of wt)tt.text.placedSymbolArray.get(St).placedOrientation=dt;ht.verticalPlacedTextSymbolIndex&&(tt.text.placedSymbolArray.get(ht.verticalPlacedTextSymbolIndex).placedOrientation=mt)}commit(tt){this.commitTime=tt,this.zoomAtLastRecencyCheck=this.transform.zoom;const ot=this.prevPlacement;let ht=!1;this.prevZoomAdjustment=ot?ot.zoomAdjustment(this.transform.zoom):0;const dt=ot?ot.symbolFadeChange(tt):1,mt=ot?ot.opacities:{},wt=ot?ot.variableOffsets:{},St=ot?ot.placedOrientations:{};for(const Tt in this.placements){const Ft=this.placements[Tt],Gt=mt[Tt];Gt?(this.opacities[Tt]=new Gr(Gt,dt,Ft.text,Ft.icon),ht=ht||Ft.text!==Gt.text.placed||Ft.icon!==Gt.icon.placed):(this.opacities[Tt]=new Gr(null,dt,Ft.text,Ft.icon,Ft.skipFade),ht=ht||Ft.text||Ft.icon)}for(const Tt in mt){const Ft=mt[Tt];if(!this.opacities[Tt]){const Gt=new Gr(Ft,dt,!1,!1);Gt.isHidden()||(this.opacities[Tt]=Gt,ht=ht||Ft.text.placed||Ft.icon.placed)}}for(const Tt in wt)this.variableOffsets[Tt]||!this.opacities[Tt]||this.opacities[Tt].isHidden()||(this.variableOffsets[Tt]=wt[Tt]);for(const Tt in St)this.placedOrientations[Tt]||!this.opacities[Tt]||this.opacities[Tt].isHidden()||(this.placedOrientations[Tt]=St[Tt]);if(ot&&ot.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");ht?this.lastPlacementChangeTime=tt:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=ot?ot.lastPlacementChangeTime:tt)}updateLayerOpacities(tt,ot){const ht={};for(const dt of ot){const mt=dt.getBucket(tt);mt&&dt.latestFeatureIndex&&tt.id===mt.layerIds[0]&&this.updateBucketOpacities(mt,dt.tileID,ht,dt.collisionBoxArray)}}updateBucketOpacities(tt,ot,ht,dt){tt.hasTextData()&&(tt.text.opacityVertexArray.clear(),tt.text.hasVisibleVertices=!1),tt.hasIconData()&&(tt.icon.opacityVertexArray.clear(),tt.icon.hasVisibleVertices=!1),tt.hasIconCollisionBoxData()&&tt.iconCollisionBox.collisionVertexArray.clear(),tt.hasTextCollisionBoxData()&&tt.textCollisionBox.collisionVertexArray.clear();const mt=tt.layers[0],wt=mt.layout,St=new Gr(null,0,!1,!1,!0),Tt=wt.get("text-allow-overlap"),Ft=wt.get("icon-allow-overlap"),Gt=mt._unevaluatedLayout.hasValue("text-variable-anchor")||mt._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Xt=wt.get("text-rotation-alignment")==="map",pn=wt.get("text-pitch-alignment")==="map",wn=wt.get("icon-text-fit")!=="none",kn=new Gr(null,0,Tt&&(Ft||!tt.hasIconData()||wt.get("icon-optional")),Ft&&(Tt||!tt.hasTextData()||wt.get("text-optional")),!0);!tt.collisionArrays&&dt&&(tt.hasIconCollisionBoxData()||tt.hasTextCollisionBoxData())&&tt.deserializeCollisionBoxes(dt);const Fn=(Gn,Qn,Dn)=>{for(let ar=0;ar<Qn/4;ar++)Gn.opacityVertexArray.emplaceBack(Dn);Gn.hasVisibleVertices=Gn.hasVisibleVertices||Dn!==ku},Hn=this.collisionBoxArrays.get(tt.bucketInstanceId);for(let Gn=0;Gn<tt.symbolInstances.length;Gn++){const Qn=tt.symbolInstances.get(Gn),{numHorizontalGlyphVertices:Dn,numVerticalGlyphVertices:ar,crossTileID:mr}=Qn;let Ar=this.opacities[mr];ht[mr]?Ar=St:Ar||(Ar=kn,this.opacities[mr]=Ar),ht[mr]=!0;const Wr=Qn.numIconVertices>0,es=this.placedOrientations[Qn.crossTileID],us=es===ct.ah.vertical,ys=es===ct.ah.horizontal||es===ct.ah.horizontalOnly;if(Dn>0||ar>0){const rs=Xl(Ar.text);Fn(tt.text,Dn,us?ku:rs),Fn(tt.text,ar,ys?ku:rs);const Rs=Ar.text.isHidden();[Qn.rightJustifiedTextSymbolIndex,Qn.centerJustifiedTextSymbolIndex,Qn.leftJustifiedTextSymbolIndex].forEach(ms=>{ms>=0&&(tt.text.placedSymbolArray.get(ms).hidden=Rs||us?1:0)}),Qn.verticalPlacedTextSymbolIndex>=0&&(tt.text.placedSymbolArray.get(Qn.verticalPlacedTextSymbolIndex).hidden=Rs||ys?1:0);const no=this.variableOffsets[Qn.crossTileID];no&&this.markUsedJustification(tt,no.anchor,Qn,es);const as=this.placedOrientations[Qn.crossTileID];as&&(this.markUsedJustification(tt,"left",Qn,as),this.markUsedOrientation(tt,as,Qn))}if(Wr){const rs=Xl(Ar.icon),Rs=!(wn&&Qn.verticalPlacedIconSymbolIndex&&us);Qn.placedIconSymbolIndex>=0&&(Fn(tt.icon,Qn.numIconVertices,Rs?rs:ku),tt.icon.placedSymbolArray.get(Qn.placedIconSymbolIndex).hidden=Ar.icon.isHidden()),Qn.verticalPlacedIconSymbolIndex>=0&&(Fn(tt.icon,Qn.numVerticalIconVertices,Rs?ku:rs),tt.icon.placedSymbolArray.get(Qn.verticalPlacedIconSymbolIndex).hidden=Ar.icon.isHidden())}const os=Hn&&Hn.has(Gn)?Hn.get(Gn):{text:null,icon:null};if(tt.hasIconCollisionBoxData()||tt.hasTextCollisionBoxData()){const rs=tt.collisionArrays[Gn];if(rs){let Rs=new ct.P(0,0);if(rs.textBox||rs.verticalTextBox){let no=!0;if(Gt){const as=this.variableOffsets[mr];as?(Rs=Gs(as.anchor,as.width,as.height,as.textOffset,as.textBoxScale),Xt&&Rs._rotate(pn?this.transform.angle:-this.transform.angle)):no=!1}if(rs.textBox||rs.verticalTextBox){let as;rs.textBox&&(as=us),rs.verticalTextBox&&(as=ys),Ao(tt.textCollisionBox.collisionVertexArray,Ar.text.placed,!no||as,os.text,Rs.x,Rs.y)}}if(rs.iconBox||rs.verticalIconBox){const no=!!(!ys&&rs.verticalIconBox);let as;rs.iconBox&&(as=no),rs.verticalIconBox&&(as=!no),Ao(tt.iconCollisionBox.collisionVertexArray,Ar.icon.placed,as,os.icon,wn?Rs.x:0,wn?Rs.y:0)}}}}if(tt.sortFeatures(this.transform.angle),this.retainedQueryData[tt.bucketInstanceId]&&(this.retainedQueryData[tt.bucketInstanceId].featureSortOrder=tt.featureSortOrder),tt.hasTextData()&&tt.text.opacityVertexBuffer&&tt.text.opacityVertexBuffer.updateData(tt.text.opacityVertexArray),tt.hasIconData()&&tt.icon.opacityVertexBuffer&&tt.icon.opacityVertexBuffer.updateData(tt.icon.opacityVertexArray),tt.hasIconCollisionBoxData()&&tt.iconCollisionBox.collisionVertexBuffer&&tt.iconCollisionBox.collisionVertexBuffer.updateData(tt.iconCollisionBox.collisionVertexArray),tt.hasTextCollisionBoxData()&&tt.textCollisionBox.collisionVertexBuffer&&tt.textCollisionBox.collisionVertexBuffer.updateData(tt.textCollisionBox.collisionVertexArray),tt.text.opacityVertexArray.length!==tt.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${tt.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${tt.text.layoutVertexArray.length}) / 4`);if(tt.icon.opacityVertexArray.length!==tt.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${tt.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${tt.icon.layoutVertexArray.length}) / 4`);if(tt.bucketInstanceId in this.collisionCircleArrays){const Gn=this.collisionCircleArrays[tt.bucketInstanceId];tt.placementInvProjMatrix=Gn.invProjMatrix,tt.placementViewportMatrix=Gn.viewportMatrix,tt.collisionCircleArray=Gn.circles,delete this.collisionCircleArrays[tt.bucketInstanceId]}}symbolFadeChange(tt){return this.fadeDuration===0?1:(tt-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(tt){return Math.max(0,(this.transform.zoom-tt)/1.5)}hasTransitions(tt){return this.stale||tt-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(tt,ot){const ht=this.zoomAtLastRecencyCheck===ot?1-this.zoomAdjustment(ot):1;return this.zoomAtLastRecencyCheck=ot,this.commitTime+this.fadeDuration*ht>tt}setStale(){this.stale=!0}}function Ao(gt,tt,ot,ht,dt,mt){ht&&ht.length!==0||(ht=[0,0,0,0]);const wt=ht[0]-Sr,St=ht[1]-Sr,Tt=ht[2]-Sr,Ft=ht[3]-Sr;gt.emplaceBack(tt?1:0,ot?1:0,dt||0,mt||0,wt,St),gt.emplaceBack(tt?1:0,ot?1:0,dt||0,mt||0,Tt,St),gt.emplaceBack(tt?1:0,ot?1:0,dt||0,mt||0,Tt,Ft),gt.emplaceBack(tt?1:0,ot?1:0,dt||0,mt||0,wt,Ft)}const oo=Math.pow(2,25),Cl=Math.pow(2,24),eu=Math.pow(2,17),yl=Math.pow(2,16),Gl=Math.pow(2,9),h_=Math.pow(2,8),tu=Math.pow(2,1);function Xl(gt){if(gt.opacity===0&&!gt.placed)return 0;if(gt.opacity===1&&gt.placed)return 4294967295;const tt=gt.placed?1:0,ot=Math.floor(127*gt.opacity);return ot*oo+tt*Cl+ot*eu+tt*yl+ot*Gl+tt*h_+ot*tu+tt}const ku=0;function Bu(){return{isOccluded:(gt,tt,ot)=>!1,getPitchedTextCorrection:(gt,tt,ot)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(gt,tt,ot,ht){throw new Error("Not implemented.")},translatePosition:(gt,tt,ot,ht)=>function(dt,mt,wt,St,Tt=!1){if(!wt[0]&&!wt[1])return[0,0];const Ft=Tt?St==="map"?dt.angle:0:St==="viewport"?-dt.angle:0;if(Ft){const Gt=Math.sin(Ft),Xt=Math.cos(Ft);wt=[wt[0]*Xt-wt[1]*Gt,wt[0]*Gt+wt[1]*Xt]}return[Tt?wt[0]:Fr(mt,wt[0],dt.zoom),Tt?wt[1]:Fr(mt,wt[1],dt.zoom)]}(gt,tt,ot,ht),getCircleRadiusCorrection:gt=>1}}class Zo{constructor(tt){this._sortAcrossTiles=tt.layout.get("symbol-z-order")!=="viewport-y"&&!tt.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(tt,ot,ht,dt,mt){const wt=this._bucketParts;for(;this._currentTileIndex<tt.length;)if(ot.getBucketParts(wt,dt,tt[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,mt())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,wt.sort((St,Tt)=>St.sortKey-Tt.sortKey));this._currentPartIndex<wt.length;)if(ot.placeLayerBucketPart(wt[this._currentPartIndex],this._seenCrossTileIDs,ht),this._currentPartIndex++,mt())return!0;return!1}}class _p{constructor(tt,ot,ht,dt,mt,wt,St,Tt){this.placement=new go(tt,Bu(),ot,wt,St,Tt),this._currentPlacementIndex=ht.length-1,this._forceFullPlacement=dt,this._showCollisionBoxes=mt,this._done=!1}isDone(){return this._done}continuePlacement(tt,ot,ht){const dt=Lt.now(),mt=()=>!this._forceFullPlacement&&Lt.now()-dt>2;for(;this._currentPlacementIndex>=0;){const wt=ot[tt[this._currentPlacementIndex]],St=this.placement.collisionIndex.transform.zoom;if(wt.type==="symbol"&&(!wt.minzoom||wt.minzoom<=St)&&(!wt.maxzoom||wt.maxzoom>St)){if(this._inProgressLayer||(this._inProgressLayer=new Zo(wt)),this._inProgressLayer.continuePlacement(ht[wt.source],this.placement,this._showCollisionBoxes,wt,mt))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(tt){return this.placement.commit(tt),this.placement}}const Pl=512/ct.X/2;class Ko{constructor(tt,ot,ht){this.tileID=tt,this.bucketInstanceId=ht,this._symbolsByKey={};const dt=new Map;for(let mt=0;mt<ot.length;mt++){const wt=ot.get(mt),St=wt.key,Tt=dt.get(St);Tt?Tt.push(wt):dt.set(St,[wt])}for(const[mt,wt]of dt){const St={positions:wt.map(Tt=>({x:Math.floor(Tt.anchorX*Pl),y:Math.floor(Tt.anchorY*Pl)})),crossTileIDs:wt.map(Tt=>Tt.crossTileID)};if(St.positions.length>128){const Tt=new ct.av(St.positions.length,16,Uint16Array);for(const{x:Ft,y:Gt}of St.positions)Tt.add(Ft,Gt);Tt.finish(),delete St.positions,St.index=Tt}this._symbolsByKey[mt]=St}}getScaledCoordinates(tt,ot){const{x:ht,y:dt,z:mt}=this.tileID.canonical,{x:wt,y:St,z:Tt}=ot.canonical,Ft=Pl/Math.pow(2,Tt-mt),Gt=(St*ct.X+tt.anchorY)*Ft,Xt=dt*ct.X*Pl;return{x:Math.floor((wt*ct.X+tt.anchorX)*Ft-ht*ct.X*Pl),y:Math.floor(Gt-Xt)}}findMatches(tt,ot,ht){const dt=this.tileID.canonical.z<ot.canonical.z?1:Math.pow(2,this.tileID.canonical.z-ot.canonical.z);for(let mt=0;mt<tt.length;mt++){const wt=tt.get(mt);if(wt.crossTileID)continue;const St=this._symbolsByKey[wt.key];if(!St)continue;const Tt=this.getScaledCoordinates(wt,ot);if(St.index){const Ft=St.index.range(Tt.x-dt,Tt.y-dt,Tt.x+dt,Tt.y+dt).sort();for(const Gt of Ft){const Xt=St.crossTileIDs[Gt];if(!ht[Xt]){ht[Xt]=!0,wt.crossTileID=Xt;break}}}else if(St.positions)for(let Ft=0;Ft<St.positions.length;Ft++){const Gt=St.positions[Ft],Xt=St.crossTileIDs[Ft];if(Math.abs(Gt.x-Tt.x)<=dt&&Math.abs(Gt.y-Tt.y)<=dt&&!ht[Xt]){ht[Xt]=!0,wt.crossTileID=Xt;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:tt})=>tt)}}class $p{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(tt){const ot=Math.round((tt-this.lng)/360);if(ot!==0)for(const ht in this.indexes){const dt=this.indexes[ht],mt={};for(const wt in dt){const St=dt[wt];St.tileID=St.tileID.unwrapTo(St.tileID.wrap+ot),mt[St.tileID.key]=St}this.indexes[ht]=mt}this.lng=tt}addBucket(tt,ot,ht){if(this.indexes[tt.overscaledZ]&&this.indexes[tt.overscaledZ][tt.key]){if(this.indexes[tt.overscaledZ][tt.key].bucketInstanceId===ot.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(tt.overscaledZ,this.indexes[tt.overscaledZ][tt.key])}for(let mt=0;mt<ot.symbolInstances.length;mt++)ot.symbolInstances.get(mt).crossTileID=0;this.usedCrossTileIDs[tt.overscaledZ]||(this.usedCrossTileIDs[tt.overscaledZ]={});const dt=this.usedCrossTileIDs[tt.overscaledZ];for(const mt in this.indexes){const wt=this.indexes[mt];if(Number(mt)>tt.overscaledZ)for(const St in wt){const Tt=wt[St];Tt.tileID.isChildOf(tt)&&Tt.findMatches(ot.symbolInstances,tt,dt)}else{const St=wt[tt.scaledTo(Number(mt)).key];St&&St.findMatches(ot.symbolInstances,tt,dt)}}for(let mt=0;mt<ot.symbolInstances.length;mt++){const wt=ot.symbolInstances.get(mt);wt.crossTileID||(wt.crossTileID=ht.generate(),dt[wt.crossTileID]=!0)}return this.indexes[tt.overscaledZ]===void 0&&(this.indexes[tt.overscaledZ]={}),this.indexes[tt.overscaledZ][tt.key]=new Ko(tt,ot.symbolInstances,ot.bucketInstanceId),!0}removeBucketCrossTileIDs(tt,ot){for(const ht of ot.getCrossTileIDsLists())for(const dt of ht)delete this.usedCrossTileIDs[tt][dt]}removeStaleBuckets(tt){let ot=!1;for(const ht in this.indexes){const dt=this.indexes[ht];for(const mt in dt)tt[dt[mt].bucketInstanceId]||(this.removeBucketCrossTileIDs(ht,dt[mt]),delete dt[mt],ot=!0)}return ot}}class yp{constructor(){this.layerIndexes={},this.crossTileIDs=new $p,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(tt,ot,ht){let dt=this.layerIndexes[tt.id];dt===void 0&&(dt=this.layerIndexes[tt.id]=new hu);let mt=!1;const wt={};dt.handleWrapJump(ht);for(const St of ot){const Tt=St.getBucket(tt);Tt&&tt.id===Tt.layerIds[0]&&(Tt.bucketInstanceId||(Tt.bucketInstanceId=++this.maxBucketInstanceId),dt.addBucket(St.tileID,Tt,this.crossTileIDs)&&(mt=!0),wt[Tt.bucketInstanceId]=!0)}return dt.removeStaleBuckets(wt)&&(mt=!0),mt}pruneUnusedLayers(tt){const ot={};tt.forEach(ht=>{ot[ht]=!0});for(const ht in this.layerIndexes)ot[ht]||delete this.layerIndexes[ht]}}const du=(gt,tt)=>ct.t(gt,tt&&tt.filter(ot=>ot.identifier!=="source.canvas")),d_=ct.aw();class vp extends ct.E{constructor(tt,ot={}){super(),this._rtlPluginLoaded=()=>{for(const ht in this.sourceCaches){const dt=this.sourceCaches[ht].getSource().type;dt!=="vector"&&dt!=="geojson"||this.sourceCaches[ht].reload()}},this.map=tt,this.dispatcher=new Mn(En(),tt._getMapId()),this.dispatcher.registerMessageHandler("GG",(ht,dt)=>this.getGlyphs(ht,dt)),this.dispatcher.registerMessageHandler("GI",(ht,dt)=>this.getImages(ht,dt)),this.imageManager=new Xn,this.imageManager.setEventedParent(this),this.glyphManager=new br(tt._requestManager,ot.localIdeographFontFamily),this.lineAtlas=new An(256,512),this.crossTileSymbolIndex=new yp,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new ct.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",ct.ay()),Ts().on(Cr,this._rtlPluginLoaded),this.on("data",ht=>{if(ht.dataType!=="source"||ht.sourceDataType!=="metadata")return;const dt=this.sourceCaches[ht.sourceId];if(!dt)return;const mt=dt.getSource();if(mt&&mt.vectorLayerIds)for(const wt in this._layers){const St=this._layers[wt];St.source===mt.id&&this._validateLayer(St)}})}loadURL(tt,ot={},ht){this.fire(new ct.k("dataloading",{dataType:"style"})),ot.validate=typeof ot.validate!="boolean"||ot.validate;const dt=this.map._requestManager.transformRequest(tt,"Style");this._loadStyleRequest=new AbortController;const mt=this._loadStyleRequest;ct.h(dt,this._loadStyleRequest).then(wt=>{this._loadStyleRequest=null,this._load(wt.data,ot,ht)}).catch(wt=>{this._loadStyleRequest=null,wt&&!mt.signal.aborted&&this.fire(new ct.j(wt))})}loadJSON(tt,ot={},ht){this.fire(new ct.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Lt.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,ot.validate=ot.validate!==!1,this._load(tt,ot,ht)}).catch(()=>{})}loadEmpty(){this.fire(new ct.k("dataloading",{dataType:"style"})),this._load(d_,{validate:!1})}_load(tt,ot,ht){var dt;const mt=ot.transformStyle?ot.transformStyle(ht,tt):tt;if(!ot.validate||!du(this,ct.u(mt))){this._loaded=!0,this.stylesheet=mt;for(const wt in mt.sources)this.addSource(wt,mt.sources[wt],{validate:!1});mt.sprite?this._loadSprite(mt.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(mt.glyphs),this._createLayers(),this.light=new xr(this.stylesheet.light),this.sky=new $r(this.stylesheet.sky),this.map.setTerrain((dt=this.stylesheet.terrain)!==null&&dt!==void 0?dt:null),this.fire(new ct.k("data",{dataType:"style"})),this.fire(new ct.k("style.load"))}}_createLayers(){const tt=ct.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",tt),this._order=tt.map(ot=>ot.id),this._layers={},this._serializedLayers=null;for(const ot of tt){const ht=ct.aA(ot);ht.setEventedParent(this,{layer:{id:ot.id}}),this._layers[ot.id]=ht}}_loadSprite(tt,ot=!1,ht=void 0){let dt;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(mt,wt,St,Tt){return ct._(this,void 0,void 0,function*(){const Ft=Yt(mt),Gt=St>1?"@2x":"",Xt={},pn={};for(const{id:wn,url:kn}of Ft){const Fn=wt.transformRequest(vn(kn,Gt,".json"),"SpriteJSON");Xt[wn]=ct.h(Fn,Tt);const Hn=wt.transformRequest(vn(kn,Gt,".png"),"SpriteImage");pn[wn]=Ht.getImage(Hn,Tt)}return yield Promise.all([...Object.values(Xt),...Object.values(pn)]),function(wn,kn){return ct._(this,void 0,void 0,function*(){const Fn={};for(const Hn in wn){Fn[Hn]={};const Gn=Lt.getImageCanvasContext((yield kn[Hn]).data),Qn=(yield wn[Hn]).data;for(const Dn in Qn){const{width:ar,height:mr,x:Ar,y:Wr,sdf:es,pixelRatio:us,stretchX:ys,stretchY:os,content:rs,textFitWidth:Rs,textFitHeight:no}=Qn[Dn];Fn[Hn][Dn]={data:null,pixelRatio:us,sdf:es,stretchX:ys,stretchY:os,content:rs,textFitWidth:Rs,textFitHeight:no,spriteData:{width:ar,height:mr,x:Ar,y:Wr,context:Gn}}}}return Fn})}(Xt,pn)})}(tt,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(mt=>{if(this._spriteRequest=null,mt)for(const wt in mt){this._spritesImagesIds[wt]=[];const St=this._spritesImagesIds[wt]?this._spritesImagesIds[wt].filter(Tt=>!(Tt in mt)):[];for(const Tt of St)this.imageManager.removeImage(Tt),this._changedImages[Tt]=!0;for(const Tt in mt[wt]){const Ft=wt==="default"?Tt:`${wt}:${Tt}`;this._spritesImagesIds[wt].push(Ft),Ft in this.imageManager.images?this.imageManager.updateImage(Ft,mt[wt][Tt],!1):this.imageManager.addImage(Ft,mt[wt][Tt]),ot&&(this._changedImages[Ft]=!0)}}}).catch(mt=>{this._spriteRequest=null,dt=mt,this.fire(new ct.j(dt))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),ot&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new ct.k("data",{dataType:"style"})),ht&&ht(dt)})}_unloadSprite(){for(const tt of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(tt),this._changedImages[tt]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new ct.k("data",{dataType:"style"}))}_validateLayer(tt){const ot=this.sourceCaches[tt.source];if(!ot)return;const ht=tt.sourceLayer;if(!ht)return;const dt=ot.getSource();(dt.type==="geojson"||dt.vectorLayerIds&&dt.vectorLayerIds.indexOf(ht)===-1)&&this.fire(new ct.j(new Error(`Source layer "${ht}" does not exist on source "${dt.id}" as specified by style layer "${tt.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const tt in this.sourceCaches)if(!this.sourceCaches[tt].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(tt,ot=!1){const ht=this._serializedAllLayers();if(!tt||tt.length===0)return Object.values(ot?ct.aB(ht):ht);const dt=[];for(const mt of tt)if(ht[mt]){const wt=ot?ct.aB(ht[mt]):ht[mt];dt.push(wt)}return dt}_serializedAllLayers(){let tt=this._serializedLayers;if(tt)return tt;tt=this._serializedLayers={};const ot=Object.keys(this._layers);for(const ht of ot){const dt=this._layers[ht];dt.type!=="custom"&&(tt[ht]=dt.serialize())}return tt}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const tt in this.sourceCaches)if(this.sourceCaches[tt].hasTransition())return!0;for(const tt in this._layers)if(this._layers[tt].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(tt){if(!this._loaded)return;const ot=this._changed;if(ot){const dt=Object.keys(this._updatedLayers),mt=Object.keys(this._removedLayers);(dt.length||mt.length)&&this._updateWorkerLayers(dt,mt);for(const wt in this._updatedSources){const St=this._updatedSources[wt];if(St==="reload")this._reloadSource(wt);else{if(St!=="clear")throw new Error(`Invalid action ${St}`);this._clearSource(wt)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const wt in this._updatedPaintProps)this._layers[wt].updateTransitions(tt);this.light.updateTransitions(tt),this.sky.updateTransitions(tt),this._resetUpdates()}const ht={};for(const dt in this.sourceCaches){const mt=this.sourceCaches[dt];ht[dt]=mt.used,mt.used=!1}for(const dt of this._order){const mt=this._layers[dt];mt.recalculate(tt,this._availableImages),!mt.isHidden(tt.zoom)&&mt.source&&(this.sourceCaches[mt.source].used=!0)}for(const dt in ht){const mt=this.sourceCaches[dt];!!ht[dt]!=!!mt.used&&mt.fire(new ct.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:dt}))}this.light.recalculate(tt),this.sky.recalculate(tt),this.z=tt.zoom,ot&&this.fire(new ct.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const tt=Object.keys(this._changedImages);if(tt.length){for(const ot in this.sourceCaches)this.sourceCaches[ot].reloadTilesForDependencies(["icons","patterns"],tt);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const tt in this.sourceCaches)this.sourceCaches[tt].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(tt,ot){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(tt,!1),removedIds:ot})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(tt,ot={}){var ht;this._checkLoaded();const dt=this.serialize();if(tt=ot.transformStyle?ot.transformStyle(dt,tt):tt,((ht=ot.validate)===null||ht===void 0||ht)&&du(this,ct.u(tt)))return!1;(tt=ct.aB(tt)).layers=ct.az(tt.layers);const mt=ct.aC(dt,tt),wt=this._getOperationsToPerform(mt);if(wt.unimplemented.length>0)throw new Error(`Unimplemented: ${wt.unimplemented.join(", ")}.`);if(wt.operations.length===0)return!1;for(const St of wt.operations)St();return this.stylesheet=tt,this._serializedLayers=null,!0}_getOperationsToPerform(tt){const ot=[],ht=[];for(const dt of tt)switch(dt.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":ot.push(()=>this.addLayer.apply(this,dt.args));break;case"removeLayer":ot.push(()=>this.removeLayer.apply(this,dt.args));break;case"setPaintProperty":ot.push(()=>this.setPaintProperty.apply(this,dt.args));break;case"setLayoutProperty":ot.push(()=>this.setLayoutProperty.apply(this,dt.args));break;case"setFilter":ot.push(()=>this.setFilter.apply(this,dt.args));break;case"addSource":ot.push(()=>this.addSource.apply(this,dt.args));break;case"removeSource":ot.push(()=>this.removeSource.apply(this,dt.args));break;case"setLayerZoomRange":ot.push(()=>this.setLayerZoomRange.apply(this,dt.args));break;case"setLight":ot.push(()=>this.setLight.apply(this,dt.args));break;case"setGeoJSONSourceData":ot.push(()=>this.setGeoJSONSourceData.apply(this,dt.args));break;case"setGlyphs":ot.push(()=>this.setGlyphs.apply(this,dt.args));break;case"setSprite":ot.push(()=>this.setSprite.apply(this,dt.args));break;case"setSky":ot.push(()=>this.setSky.apply(this,dt.args));break;case"setTerrain":ot.push(()=>this.map.setTerrain.apply(this,dt.args));break;case"setTransition":ot.push(()=>{});break;default:ht.push(dt.command)}return{operations:ot,unimplemented:ht}}addImage(tt,ot){if(this.getImage(tt))return this.fire(new ct.j(new Error(`An image named "${tt}" already exists.`)));this.imageManager.addImage(tt,ot),this._afterImageUpdated(tt)}updateImage(tt,ot){this.imageManager.updateImage(tt,ot)}getImage(tt){return this.imageManager.getImage(tt)}removeImage(tt){if(!this.getImage(tt))return this.fire(new ct.j(new Error(`An image named "${tt}" does not exist.`)));this.imageManager.removeImage(tt),this._afterImageUpdated(tt)}_afterImageUpdated(tt){this._availableImages=this.imageManager.listImages(),this._changedImages[tt]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new ct.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(tt,ot,ht={}){if(this._checkLoaded(),this.sourceCaches[tt]!==void 0)throw new Error(`Source "${tt}" already exists.`);if(!ot.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(ot).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(ot.type)>=0&&this._validate(ct.u.source,`sources.${tt}`,ot,null,ht))return;this.map&&this.map._collectResourceTiming&&(ot.collectResourceTiming=!0);const dt=this.sourceCaches[tt]=new tr(tt,ot,this.dispatcher);dt.style=this,dt.setEventedParent(this,()=>({isSourceLoaded:dt.loaded(),source:dt.serialize(),sourceId:tt})),dt.onAdd(this.map),this._changed=!0}removeSource(tt){if(this._checkLoaded(),this.sourceCaches[tt]===void 0)throw new Error("There is no source with this ID");for(const ht in this._layers)if(this._layers[ht].source===tt)return this.fire(new ct.j(new Error(`Source "${tt}" cannot be removed while layer "${ht}" is using it.`)));const ot=this.sourceCaches[tt];delete this.sourceCaches[tt],delete this._updatedSources[tt],ot.fire(new ct.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:tt})),ot.setEventedParent(null),ot.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(tt,ot){if(this._checkLoaded(),this.sourceCaches[tt]===void 0)throw new Error(`There is no source with this ID=${tt}`);const ht=this.sourceCaches[tt].getSource();if(ht.type!=="geojson")throw new Error(`geojsonSource.type is ${ht.type}, which is !== 'geojson`);ht.setData(ot),this._changed=!0}getSource(tt){return this.sourceCaches[tt]&&this.sourceCaches[tt].getSource()}addLayer(tt,ot,ht={}){this._checkLoaded();const dt=tt.id;if(this.getLayer(dt))return void this.fire(new ct.j(new Error(`Layer "${dt}" already exists on this map.`)));let mt;if(tt.type==="custom"){if(du(this,ct.aD(tt)))return;mt=ct.aA(tt)}else{if("source"in tt&&typeof tt.source=="object"&&(this.addSource(dt,tt.source),tt=ct.aB(tt),tt=ct.e(tt,{source:dt})),this._validate(ct.u.layer,`layers.${dt}`,tt,{arrayIndex:-1},ht))return;mt=ct.aA(tt),this._validateLayer(mt),mt.setEventedParent(this,{layer:{id:dt}})}const wt=ot?this._order.indexOf(ot):this._order.length;if(ot&&wt===-1)this.fire(new ct.j(new Error(`Cannot add layer "${dt}" before non-existing layer "${ot}".`)));else{if(this._order.splice(wt,0,dt),this._layerOrderChanged=!0,this._layers[dt]=mt,this._removedLayers[dt]&&mt.source&&mt.type!=="custom"){const St=this._removedLayers[dt];delete this._removedLayers[dt],St.type!==mt.type?this._updatedSources[mt.source]="clear":(this._updatedSources[mt.source]="reload",this.sourceCaches[mt.source].pause())}this._updateLayer(mt),mt.onAdd&&mt.onAdd(this.map)}}moveLayer(tt,ot){if(this._checkLoaded(),this._changed=!0,!this._layers[tt])return void this.fire(new ct.j(new Error(`The layer '${tt}' does not exist in the map's style and cannot be moved.`)));if(tt===ot)return;const ht=this._order.indexOf(tt);this._order.splice(ht,1);const dt=ot?this._order.indexOf(ot):this._order.length;ot&&dt===-1?this.fire(new ct.j(new Error(`Cannot move layer "${tt}" before non-existing layer "${ot}".`))):(this._order.splice(dt,0,tt),this._layerOrderChanged=!0)}removeLayer(tt){this._checkLoaded();const ot=this._layers[tt];if(!ot)return void this.fire(new ct.j(new Error(`Cannot remove non-existing layer "${tt}".`)));ot.setEventedParent(null);const ht=this._order.indexOf(tt);this._order.splice(ht,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[tt]=ot,delete this._layers[tt],this._serializedLayers&&delete this._serializedLayers[tt],delete this._updatedLayers[tt],delete this._updatedPaintProps[tt],ot.onRemove&&ot.onRemove(this.map)}getLayer(tt){return this._layers[tt]}getLayersOrder(){return[...this._order]}hasLayer(tt){return tt in this._layers}setLayerZoomRange(tt,ot,ht){this._checkLoaded();const dt=this.getLayer(tt);dt?dt.minzoom===ot&&dt.maxzoom===ht||(ot!=null&&(dt.minzoom=ot),ht!=null&&(dt.maxzoom=ht),this._updateLayer(dt)):this.fire(new ct.j(new Error(`Cannot set the zoom range of non-existing layer "${tt}".`)))}setFilter(tt,ot,ht={}){this._checkLoaded();const dt=this.getLayer(tt);if(dt){if(!ct.aE(dt.filter,ot))return ot==null?(dt.filter=void 0,void this._updateLayer(dt)):void(this._validate(ct.u.filter,`layers.${dt.id}.filter`,ot,null,ht)||(dt.filter=ct.aB(ot),this._updateLayer(dt)))}else this.fire(new ct.j(new Error(`Cannot filter non-existing layer "${tt}".`)))}getFilter(tt){return ct.aB(this.getLayer(tt).filter)}setLayoutProperty(tt,ot,ht,dt={}){this._checkLoaded();const mt=this.getLayer(tt);mt?ct.aE(mt.getLayoutProperty(ot),ht)||(mt.setLayoutProperty(ot,ht,dt),this._updateLayer(mt)):this.fire(new ct.j(new Error(`Cannot style non-existing layer "${tt}".`)))}getLayoutProperty(tt,ot){const ht=this.getLayer(tt);if(ht)return ht.getLayoutProperty(ot);this.fire(new ct.j(new Error(`Cannot get style of non-existing layer "${tt}".`)))}setPaintProperty(tt,ot,ht,dt={}){this._checkLoaded();const mt=this.getLayer(tt);mt?ct.aE(mt.getPaintProperty(ot),ht)||(mt.setPaintProperty(ot,ht,dt)&&this._updateLayer(mt),this._changed=!0,this._updatedPaintProps[tt]=!0,this._serializedLayers=null):this.fire(new ct.j(new Error(`Cannot style non-existing layer "${tt}".`)))}getPaintProperty(tt,ot){return this.getLayer(tt).getPaintProperty(ot)}setFeatureState(tt,ot){this._checkLoaded();const ht=tt.source,dt=tt.sourceLayer,mt=this.sourceCaches[ht];if(mt===void 0)return void this.fire(new ct.j(new Error(`The source '${ht}' does not exist in the map's style.`)));const wt=mt.getSource().type;wt==="geojson"&&dt?this.fire(new ct.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):wt!=="vector"||dt?(tt.id===void 0&&this.fire(new ct.j(new Error("The feature id parameter must be provided."))),mt.setFeatureState(dt,tt.id,ot)):this.fire(new ct.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(tt,ot){this._checkLoaded();const ht=tt.source,dt=this.sourceCaches[ht];if(dt===void 0)return void this.fire(new ct.j(new Error(`The source '${ht}' does not exist in the map's style.`)));const mt=dt.getSource().type,wt=mt==="vector"?tt.sourceLayer:void 0;mt!=="vector"||wt?ot&&typeof tt.id!="string"&&typeof tt.id!="number"?this.fire(new ct.j(new Error("A feature id is required to remove its specific state property."))):dt.removeFeatureState(wt,tt.id,ot):this.fire(new ct.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(tt){this._checkLoaded();const ot=tt.source,ht=tt.sourceLayer,dt=this.sourceCaches[ot];if(dt!==void 0)return dt.getSource().type!=="vector"||ht?(tt.id===void 0&&this.fire(new ct.j(new Error("The feature id parameter must be provided."))),dt.getFeatureState(ht,tt.id)):void this.fire(new ct.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new ct.j(new Error(`The source '${ot}' does not exist in the map's style.`)))}getTransition(){return ct.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const tt=ct.aF(this.sourceCaches,mt=>mt.serialize()),ot=this._serializeByIds(this._order,!0),ht=this.map.getTerrain()||void 0,dt=this.stylesheet;return ct.aG({version:dt.version,name:dt.name,metadata:dt.metadata,light:dt.light,sky:dt.sky,center:dt.center,zoom:dt.zoom,bearing:dt.bearing,pitch:dt.pitch,sprite:dt.sprite,glyphs:dt.glyphs,transition:dt.transition,sources:tt,layers:ot,terrain:ht},mt=>mt!==void 0)}_updateLayer(tt){this._updatedLayers[tt.id]=!0,tt.source&&!this._updatedSources[tt.source]&&this.sourceCaches[tt.source].getSource().type!=="raster"&&(this._updatedSources[tt.source]="reload",this.sourceCaches[tt.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(tt){const ot=wt=>this._layers[wt].type==="fill-extrusion",ht={},dt=[];for(let wt=this._order.length-1;wt>=0;wt--){const St=this._order[wt];if(ot(St)){ht[St]=wt;for(const Tt of tt){const Ft=Tt[St];if(Ft)for(const Gt of Ft)dt.push(Gt)}}}dt.sort((wt,St)=>St.intersectionZ-wt.intersectionZ);const mt=[];for(let wt=this._order.length-1;wt>=0;wt--){const St=this._order[wt];if(ot(St))for(let Tt=dt.length-1;Tt>=0;Tt--){const Ft=dt[Tt].feature;if(ht[Ft.layer.id]<wt)break;mt.push(Ft),dt.pop()}else for(const Tt of tt){const Ft=Tt[St];if(Ft)for(const Gt of Ft)mt.push(Gt.feature)}}return mt}queryRenderedFeatures(tt,ot,ht){ot&&ot.filter&&this._validate(ct.u.filter,"queryRenderedFeatures.filter",ot.filter,null,ot);const dt={};if(ot&&ot.layers){if(!Array.isArray(ot.layers))return this.fire(new ct.j(new Error("parameters.layers must be an Array."))),[];for(const St of ot.layers){const Tt=this._layers[St];if(!Tt)return this.fire(new ct.j(new Error(`The layer '${St}' does not exist in the map's style and cannot be queried for features.`))),[];dt[Tt.source]=!0}}const mt=[];ot.availableImages=this._availableImages;const wt=this._serializedAllLayers();for(const St in this.sourceCaches)ot.layers&&!dt[St]||mt.push(cr(this.sourceCaches[St],this._layers,wt,tt,ot,ht));return this.placement&&mt.push(function(St,Tt,Ft,Gt,Xt,pn,wn){const kn={},Fn=pn.queryRenderedSymbols(Gt),Hn=[];for(const Gn of Object.keys(Fn).map(Number))Hn.push(wn[Gn]);Hn.sort(wr);for(const Gn of Hn){const Qn=Gn.featureIndex.lookupSymbolFeatures(Fn[Gn.bucketInstanceId],Tt,Gn.bucketIndex,Gn.sourceLayerIndex,Xt.filter,Xt.layers,Xt.availableImages,St);for(const Dn in Qn){const ar=kn[Dn]=kn[Dn]||[],mr=Qn[Dn];mr.sort((Ar,Wr)=>{const es=Gn.featureSortOrder;if(es){const us=es.indexOf(Ar.featureIndex);return es.indexOf(Wr.featureIndex)-us}return Wr.featureIndex-Ar.featureIndex});for(const Ar of mr)ar.push(Ar)}}for(const Gn in kn)kn[Gn].forEach(Qn=>{const Dn=Qn.feature,ar=Ft[St[Gn].source].getFeatureState(Dn.layer["source-layer"],Dn.id);Dn.source=Dn.layer.source,Dn.layer["source-layer"]&&(Dn.sourceLayer=Dn.layer["source-layer"]),Dn.state=ar});return kn}(this._layers,wt,this.sourceCaches,tt,ot,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(mt)}querySourceFeatures(tt,ot){ot&&ot.filter&&this._validate(ct.u.filter,"querySourceFeatures.filter",ot.filter,null,ot);const ht=this.sourceCaches[tt];return ht?function(dt,mt){const wt=dt.getRenderableIds().map(Ft=>dt.getTileByID(Ft)),St=[],Tt={};for(let Ft=0;Ft<wt.length;Ft++){const Gt=wt[Ft],Xt=Gt.tileID.canonical.key;Tt[Xt]||(Tt[Xt]=!0,Gt.querySourceFeatures(St,mt))}return St}(ht,ot):[]}getLight(){return this.light.getLight()}setLight(tt,ot={}){this._checkLoaded();const ht=this.light.getLight();let dt=!1;for(const wt in tt)if(!ct.aE(tt[wt],ht[wt])){dt=!0;break}if(!dt)return;const mt={now:Lt.now(),transition:ct.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(tt,ot),this.light.updateTransitions(mt)}getSky(){var tt;return(tt=this.stylesheet)===null||tt===void 0?void 0:tt.sky}setSky(tt,ot={}){const ht=this.getSky();let dt=!1;if(!tt&&!ht)return;if(tt&&!ht)dt=!0;else if(!tt&&ht)dt=!0;else for(const wt in tt)if(!ct.aE(tt[wt],ht[wt])){dt=!0;break}if(!dt)return;const mt={now:Lt.now(),transition:ct.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=tt,this.sky.setSky(tt,ot),this.sky.updateTransitions(mt)}_validate(tt,ot,ht,dt,mt={}){return(!mt||mt.validate!==!1)&&du(this,tt.call(ct.u,ct.e({key:ot,style:this.serialize(),value:ht,styleSpec:ct.v},dt)))}_remove(tt=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ts().off(Cr,this._rtlPluginLoaded);for(const ot in this._layers)this._layers[ot].setEventedParent(null);for(const ot in this.sourceCaches){const ht=this.sourceCaches[ot];ht.setEventedParent(null),ht.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),tt&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(tt)}_clearSource(tt){this.sourceCaches[tt].clearTiles()}_reloadSource(tt){this.sourceCaches[tt].resume(),this.sourceCaches[tt].reload()}_updateSources(tt){for(const ot in this.sourceCaches)this.sourceCaches[ot].update(tt,this.map.terrain)}_generateCollisionBoxes(){for(const tt in this.sourceCaches)this._reloadSource(tt)}_updatePlacement(tt,ot,ht,dt,mt=!1){let wt=!1,St=!1;const Tt={};for(const Ft of this._order){const Gt=this._layers[Ft];if(Gt.type!=="symbol")continue;if(!Tt[Gt.source]){const pn=this.sourceCaches[Gt.source];Tt[Gt.source]=pn.getRenderableIds(!0).map(wn=>pn.getTileByID(wn)).sort((wn,kn)=>kn.tileID.overscaledZ-wn.tileID.overscaledZ||(wn.tileID.isLessThan(kn.tileID)?-1:1))}const Xt=this.crossTileSymbolIndex.addLayer(Gt,Tt[Gt.source],tt.center.lng);wt=wt||Xt}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((mt=mt||this._layerOrderChanged||ht===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Lt.now(),tt.zoom))&&(this.pauseablePlacement=new _p(tt,this.map.terrain,this._order,mt,ot,ht,dt,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Tt),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Lt.now()),St=!0),wt&&this.pauseablePlacement.placement.setStale()),St||wt)for(const Ft of this._order){const Gt=this._layers[Ft];Gt.type==="symbol"&&this.placement.updateLayerOpacities(Gt,Tt[Gt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Lt.now())}_releaseSymbolFadeTiles(){for(const tt in this.sourceCaches)this.sourceCaches[tt].releaseSymbolFadeTiles()}getImages(tt,ot){return ct._(this,void 0,void 0,function*(){const ht=yield this.imageManager.getImages(ot.icons);this._updateTilesForChangedImages();const dt=this.sourceCaches[ot.source];return dt&&dt.setDependencies(ot.tileID.key,ot.type,ot.icons),ht})}getGlyphs(tt,ot){return ct._(this,void 0,void 0,function*(){const ht=yield this.glyphManager.getGlyphs(ot.stacks),dt=this.sourceCaches[ot.source];return dt&&dt.setDependencies(ot.tileID.key,ot.type,[""]),ht})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(tt,ot={}){this._checkLoaded(),tt&&this._validate(ct.u.glyphs,"glyphs",tt,null,ot)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=tt,this.glyphManager.entries={},this.glyphManager.setURL(tt))}addSprite(tt,ot,ht={},dt){this._checkLoaded();const mt=[{id:tt,url:ot}],wt=[...Yt(this.stylesheet.sprite),...mt];this._validate(ct.u.sprite,"sprite",wt,null,ht)||(this.stylesheet.sprite=wt,this._loadSprite(mt,!0,dt))}removeSprite(tt){this._checkLoaded();const ot=Yt(this.stylesheet.sprite);if(ot.find(ht=>ht.id===tt)){if(this._spritesImagesIds[tt])for(const ht of this._spritesImagesIds[tt])this.imageManager.removeImage(ht),this._changedImages[ht]=!0;ot.splice(ot.findIndex(ht=>ht.id===tt),1),this.stylesheet.sprite=ot.length>0?ot:void 0,delete this._spritesImagesIds[tt],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new ct.k("data",{dataType:"style"}))}else this.fire(new ct.j(new Error(`Sprite "${tt}" doesn't exists on this map.`)))}getSprite(){return Yt(this.stylesheet.sprite)}setSprite(tt,ot={},ht){this._checkLoaded(),tt&&this._validate(ct.u.sprite,"sprite",tt,null,ot)||(this.stylesheet.sprite=tt,tt?this._loadSprite(tt,!0,ht):(this._unloadSprite(),ht&&ht(null)))}}var ju=ct.Y([{name:"a_pos",type:"Int16",components:2}]);const $u={prelude:To(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:To(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:To(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:To(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:To("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:To(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:To(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:To("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:To("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:To("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:To(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:To(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:To(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:To(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:To(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:To(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:To(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:To(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:To(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:To(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:To(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:To(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:To(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:To(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:To(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:To(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:To("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:To("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:To("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:To("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function To(gt,tt){const ot=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,ht=tt.match(/attribute ([\w]+) ([\w]+)/g),dt=gt.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),mt=tt.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),wt=mt?mt.concat(dt):dt,St={};return{fragmentSource:gt=gt.replace(ot,(Tt,Ft,Gt,Xt,pn)=>(St[pn]=!0,Ft==="define"?`
#ifndef HAS_UNIFORM_u_${pn}
varying ${Gt} ${Xt} ${pn};
#else
uniform ${Gt} ${Xt} u_${pn};
#endif
`:`
#ifdef HAS_UNIFORM_u_${pn}
    ${Gt} ${Xt} ${pn} = u_${pn};
#endif
`)),vertexSource:tt=tt.replace(ot,(Tt,Ft,Gt,Xt,pn)=>{const wn=Xt==="float"?"vec2":"vec4",kn=pn.match(/color/)?"color":wn;return St[pn]?Ft==="define"?`
#ifndef HAS_UNIFORM_u_${pn}
uniform lowp float u_${pn}_t;
attribute ${Gt} ${wn} a_${pn};
varying ${Gt} ${Xt} ${pn};
#else
uniform ${Gt} ${Xt} u_${pn};
#endif
`:kn==="vec4"?`
#ifndef HAS_UNIFORM_u_${pn}
    ${pn} = a_${pn};
#else
    ${Gt} ${Xt} ${pn} = u_${pn};
#endif
`:`
#ifndef HAS_UNIFORM_u_${pn}
    ${pn} = unpack_mix_${kn}(a_${pn}, u_${pn}_t);
#else
    ${Gt} ${Xt} ${pn} = u_${pn};
#endif
`:Ft==="define"?`
#ifndef HAS_UNIFORM_u_${pn}
uniform lowp float u_${pn}_t;
attribute ${Gt} ${wn} a_${pn};
#else
uniform ${Gt} ${Xt} u_${pn};
#endif
`:kn==="vec4"?`
#ifndef HAS_UNIFORM_u_${pn}
    ${Gt} ${Xt} ${pn} = a_${pn};
#else
    ${Gt} ${Xt} ${pn} = u_${pn};
#endif
`:`
#ifndef HAS_UNIFORM_u_${pn}
    ${Gt} ${Xt} ${pn} = unpack_mix_${kn}(a_${pn}, u_${pn}_t);
#else
    ${Gt} ${Xt} ${pn} = u_${pn};
#endif
`}),staticAttributes:ht,staticUniforms:wt}}class xp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(tt,ot,ht,dt,mt,wt,St,Tt,Ft){this.context=tt;let Gt=this.boundPaintVertexBuffers.length!==dt.length;for(let Xt=0;!Gt&&Xt<dt.length;Xt++)this.boundPaintVertexBuffers[Xt]!==dt[Xt]&&(Gt=!0);!this.vao||this.boundProgram!==ot||this.boundLayoutVertexBuffer!==ht||Gt||this.boundIndexBuffer!==mt||this.boundVertexOffset!==wt||this.boundDynamicVertexBuffer!==St||this.boundDynamicVertexBuffer2!==Tt||this.boundDynamicVertexBuffer3!==Ft?this.freshBind(ot,ht,dt,mt,wt,St,Tt,Ft):(tt.bindVertexArray.set(this.vao),St&&St.bind(),mt&&mt.dynamicDraw&&mt.bind(),Tt&&Tt.bind(),Ft&&Ft.bind())}freshBind(tt,ot,ht,dt,mt,wt,St,Tt){const Ft=tt.numAttributes,Gt=this.context,Xt=Gt.gl;this.vao&&this.destroy(),this.vao=Gt.createVertexArray(),Gt.bindVertexArray.set(this.vao),this.boundProgram=tt,this.boundLayoutVertexBuffer=ot,this.boundPaintVertexBuffers=ht,this.boundIndexBuffer=dt,this.boundVertexOffset=mt,this.boundDynamicVertexBuffer=wt,this.boundDynamicVertexBuffer2=St,this.boundDynamicVertexBuffer3=Tt,ot.enableAttributes(Xt,tt);for(const pn of ht)pn.enableAttributes(Xt,tt);wt&&wt.enableAttributes(Xt,tt),St&&St.enableAttributes(Xt,tt),Tt&&Tt.enableAttributes(Xt,tt),ot.bind(),ot.setVertexAttribPointers(Xt,tt,mt);for(const pn of ht)pn.bind(),pn.setVertexAttribPointers(Xt,tt,mt);wt&&(wt.bind(),wt.setVertexAttribPointers(Xt,tt,mt)),dt&&dt.bind(),St&&(St.bind(),St.setVertexAttribPointers(Xt,tt,mt)),Tt&&(Tt.bind(),Tt.setVertexAttribPointers(Xt,tt,mt)),Gt.currentNumAttributes=Ft}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const dm=(gt,tt,ot,ht,dt)=>({u_matrix:gt,u_texture:0,u_ele_delta:tt,u_fog_matrix:ot,u_fog_color:ht?ht.properties.get("fog-color"):ct.aM.white,u_fog_ground_blend:ht?ht.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:ht?ht.calculateFogBlendOpacity(dt):0,u_horizon_color:ht?ht.properties.get("horizon-color"):ct.aM.white,u_horizon_fog_blend:ht?ht.properties.get("horizon-fog-blend"):1});function Zu(gt){const tt=[];for(let ot=0;ot<gt.length;ot++){if(gt[ot]===null)continue;const ht=gt[ot].split(" ");tt.push(ht.pop())}return tt}class Up{constructor(tt,ot,ht,dt,mt,wt){const St=tt.gl;this.program=St.createProgram();const Tt=Zu(ot.staticAttributes),Ft=ht?ht.getBinderAttributes():[],Gt=Tt.concat(Ft),Xt=$u.prelude.staticUniforms?Zu($u.prelude.staticUniforms):[],pn=ot.staticUniforms?Zu(ot.staticUniforms):[],wn=ht?ht.getBinderUniforms():[],kn=Xt.concat(pn).concat(wn),Fn=[];for(const Ar of kn)Fn.indexOf(Ar)<0&&Fn.push(Ar);const Hn=ht?ht.defines():[];mt&&Hn.push("#define OVERDRAW_INSPECTOR;"),wt&&Hn.push("#define TERRAIN3D;");const Gn=Hn.concat($u.prelude.fragmentSource,ot.fragmentSource).join(`
`),Qn=Hn.concat($u.prelude.vertexSource,ot.vertexSource).join(`
`),Dn=St.createShader(St.FRAGMENT_SHADER);if(St.isContextLost())return void(this.failedToCreate=!0);if(St.shaderSource(Dn,Gn),St.compileShader(Dn),!St.getShaderParameter(Dn,St.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${St.getShaderInfoLog(Dn)}`);St.attachShader(this.program,Dn);const ar=St.createShader(St.VERTEX_SHADER);if(St.isContextLost())return void(this.failedToCreate=!0);if(St.shaderSource(ar,Qn),St.compileShader(ar),!St.getShaderParameter(ar,St.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${St.getShaderInfoLog(ar)}`);St.attachShader(this.program,ar),this.attributes={};const mr={};this.numAttributes=Gt.length;for(let Ar=0;Ar<this.numAttributes;Ar++)Gt[Ar]&&(St.bindAttribLocation(this.program,Ar,Gt[Ar]),this.attributes[Gt[Ar]]=Ar);if(St.linkProgram(this.program),!St.getProgramParameter(this.program,St.LINK_STATUS))throw new Error(`Program failed to link: ${St.getProgramInfoLog(this.program)}`);St.deleteShader(ar),St.deleteShader(Dn);for(let Ar=0;Ar<Fn.length;Ar++){const Wr=Fn[Ar];if(Wr&&!mr[Wr]){const es=St.getUniformLocation(this.program,Wr);es&&(mr[Wr]=es)}}this.fixedUniforms=dt(tt,mr),this.terrainUniforms=((Ar,Wr)=>({u_depth:new ct.aH(Ar,Wr.u_depth),u_terrain:new ct.aH(Ar,Wr.u_terrain),u_terrain_dim:new ct.aI(Ar,Wr.u_terrain_dim),u_terrain_matrix:new ct.aJ(Ar,Wr.u_terrain_matrix),u_terrain_unpack:new ct.aK(Ar,Wr.u_terrain_unpack),u_terrain_exaggeration:new ct.aI(Ar,Wr.u_terrain_exaggeration)}))(tt,mr),this.binderUniforms=ht?ht.getUniforms(tt,mr):[]}draw(tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,wn,kn,Fn,Hn,Gn,Qn){const Dn=tt.gl;if(this.failedToCreate)return;if(tt.program.set(this.program),tt.setDepthMode(ht),tt.setStencilMode(dt),tt.setColorMode(mt),tt.setCullFace(wt),Tt){tt.activeTexture.set(Dn.TEXTURE2),Dn.bindTexture(Dn.TEXTURE_2D,Tt.depthTexture),tt.activeTexture.set(Dn.TEXTURE3),Dn.bindTexture(Dn.TEXTURE_2D,Tt.texture);for(const mr in this.terrainUniforms)this.terrainUniforms[mr].set(Tt[mr])}for(const mr in this.fixedUniforms)this.fixedUniforms[mr].set(St[mr]);Fn&&Fn.setUniforms(tt,this.binderUniforms,wn,{zoom:kn});let ar=0;switch(ot){case Dn.LINES:ar=2;break;case Dn.TRIANGLES:ar=3;break;case Dn.LINE_STRIP:ar=1}for(const mr of pn.get()){const Ar=mr.vaos||(mr.vaos={});(Ar[Ft]||(Ar[Ft]=new xp)).bind(tt,this,Gt,Fn?Fn.getPaintVertexBuffers():[],Xt,mr.vertexOffset,Hn,Gn,Qn),Dn.drawElements(ot,mr.primitiveLength*ar,Dn.UNSIGNED_SHORT,mr.primitiveOffset*ar*2)}}}function Vp(gt,tt,ot){const ht=1/Fr(ot,1,tt.transform.tileZoom),dt=Math.pow(2,ot.tileID.overscaledZ),mt=ot.tileSize*Math.pow(2,tt.transform.tileZoom)/dt,wt=mt*(ot.tileID.canonical.x+ot.tileID.wrap*dt),St=mt*ot.tileID.canonical.y;return{u_image:0,u_texsize:ot.imageAtlasTexture.size,u_scale:[ht,gt.fromScale,gt.toScale],u_fade:gt.t,u_pixel_coord_upper:[wt>>16,St>>16],u_pixel_coord_lower:[65535&wt,65535&St]}}const Ku=(gt,tt,ot,ht)=>{const dt=tt.style.light,mt=dt.properties.get("position"),wt=[mt.x,mt.y,mt.z],St=function(){var Ft=new ct.A(9);return ct.A!=Float32Array&&(Ft[1]=0,Ft[2]=0,Ft[3]=0,Ft[5]=0,Ft[6]=0,Ft[7]=0),Ft[0]=1,Ft[4]=1,Ft[8]=1,Ft}();dt.properties.get("anchor")==="viewport"&&function(Ft,Gt){var Xt=Math.sin(Gt),pn=Math.cos(Gt);Ft[0]=pn,Ft[1]=Xt,Ft[2]=0,Ft[3]=-Xt,Ft[4]=pn,Ft[5]=0,Ft[6]=0,Ft[7]=0,Ft[8]=1}(St,-tt.transform.angle),function(Ft,Gt,Xt){var pn=Gt[0],wn=Gt[1],kn=Gt[2];Ft[0]=pn*Xt[0]+wn*Xt[3]+kn*Xt[6],Ft[1]=pn*Xt[1]+wn*Xt[4]+kn*Xt[7],Ft[2]=pn*Xt[2]+wn*Xt[5]+kn*Xt[8]}(wt,wt,St);const Tt=dt.properties.get("color");return{u_matrix:gt,u_lightpos:wt,u_lightintensity:dt.properties.get("intensity"),u_lightcolor:[Tt.r,Tt.g,Tt.b],u_vertical_gradient:+ot,u_opacity:ht}},Hp=(gt,tt,ot,ht,dt,mt,wt)=>ct.e(Ku(gt,tt,ot,ht),Vp(mt,tt,wt),{u_height_factor:-Math.pow(2,dt.overscaledZ)/wt.tileSize/8}),np=gt=>({u_matrix:gt}),Yu=(gt,tt,ot,ht)=>ct.e(np(gt),Vp(ot,tt,ht)),p_=(gt,tt)=>({u_matrix:gt,u_world:tt}),pm=(gt,tt,ot,ht,dt)=>ct.e(Yu(gt,tt,ot,ht),{u_world:dt}),f_=(gt,tt,ot,ht)=>{const dt=gt.transform;let mt,wt;if(ht.paint.get("circle-pitch-alignment")==="map"){const St=Fr(ot,1,dt.zoom);mt=!0,wt=[St,St]}else mt=!1,wt=dt.pixelsToGLUnits;return{u_camera_to_center_distance:dt.cameraToCenterDistance,u_scale_with_map:+(ht.paint.get("circle-pitch-scale")==="map"),u_matrix:gt.translatePosMatrix(tt.posMatrix,ot,ht.paint.get("circle-translate"),ht.paint.get("circle-translate-anchor")),u_pitch_with_map:+mt,u_device_pixel_ratio:gt.pixelRatio,u_extrude_scale:wt}},xu=(gt,tt,ot)=>({u_matrix:gt,u_inv_matrix:tt,u_camera_to_center_distance:ot.cameraToCenterDistance,u_viewport_size:[ot.width,ot.height]}),Ju=(gt,tt,ot=1)=>({u_matrix:gt,u_color:tt,u_overlay:0,u_overlay_scale:ot}),Fl=gt=>({u_matrix:gt}),Rl=(gt,tt,ot,ht)=>({u_matrix:gt,u_extrude_scale:Fr(tt,1,ot),u_intensity:ht}),bp=(gt,tt,ot,ht)=>{const dt=ct.H();ct.aP(dt,0,gt.width,gt.height,0,0,1);const mt=gt.context.gl;return{u_matrix:dt,u_world:[mt.drawingBufferWidth,mt.drawingBufferHeight],u_image:ot,u_color_ramp:ht,u_opacity:tt.paint.get("heatmap-opacity")}};function ip(gt,tt){const ot=Math.pow(2,tt.canonical.z),ht=tt.canonical.y;return[new ct.Z(0,ht/ot).toLngLat().lat,new ct.Z(0,(ht+1)/ot).toLngLat().lat]}const Wp=(gt,tt,ot,ht)=>{const dt=gt.transform;return{u_matrix:In(gt,tt,ot,ht),u_ratio:1/Fr(tt,1,dt.zoom),u_device_pixel_ratio:gt.pixelRatio,u_units_to_pixels:[1/dt.pixelsToGLUnits[0],1/dt.pixelsToGLUnits[1]]}},Pm=(gt,tt,ot,ht,dt)=>ct.e(Wp(gt,tt,ot,dt),{u_image:0,u_image_height:ht}),rp=(gt,tt,ot,ht,dt)=>{const mt=gt.transform,wt=dn(tt,mt);return{u_matrix:In(gt,tt,ot,dt),u_texsize:tt.imageAtlasTexture.size,u_ratio:1/Fr(tt,1,mt.zoom),u_device_pixel_ratio:gt.pixelRatio,u_image:0,u_scale:[wt,ht.fromScale,ht.toScale],u_fade:ht.t,u_units_to_pixels:[1/mt.pixelsToGLUnits[0],1/mt.pixelsToGLUnits[1]]}},Ut=(gt,tt,ot,ht,dt,mt)=>{const wt=gt.lineAtlas,St=dn(tt,gt.transform),Tt=ot.layout.get("line-cap")==="round",Ft=wt.getDash(ht.from,Tt),Gt=wt.getDash(ht.to,Tt),Xt=Ft.width*dt.fromScale,pn=Gt.width*dt.toScale;return ct.e(Wp(gt,tt,ot,mt),{u_patternscale_a:[St/Xt,-Ft.height/2],u_patternscale_b:[St/pn,-Gt.height/2],u_sdfgamma:wt.width/(256*Math.min(Xt,pn)*gt.pixelRatio)/2,u_image:0,u_tex_y_a:Ft.y,u_tex_y_b:Gt.y,u_mix:dt.t})};function dn(gt,tt){return 1/Fr(gt,1,tt.tileZoom)}function In(gt,tt,ot,ht){return gt.translatePosMatrix(ht?ht.posMatrix:tt.tileID.posMatrix,tt,ot.paint.get("line-translate"),ot.paint.get("line-translate-anchor"))}const $n=(gt,tt,ot,ht,dt)=>{return{u_matrix:gt,u_tl_parent:tt,u_scale_parent:ot,u_buffer_scale:1,u_fade_t:ht.mix,u_opacity:ht.opacity*dt.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:dt.paint.get("raster-brightness-min"),u_brightness_high:dt.paint.get("raster-brightness-max"),u_saturation_factor:(wt=dt.paint.get("raster-saturation"),wt>0?1-1/(1.001-wt):-wt),u_contrast_factor:(mt=dt.paint.get("raster-contrast"),mt>0?1/(1-mt):1+mt),u_spin_weights:Zn(dt.paint.get("raster-hue-rotate"))};var mt,wt};function Zn(gt){gt*=Math.PI/180;const tt=Math.sin(gt),ot=Math.cos(gt);return[(2*ot+1)/3,(-Math.sqrt(3)*tt-ot+1)/3,(Math.sqrt(3)*tt-ot+1)/3]}const Jn=(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,wn)=>{const kn=wt.transform;return{u_is_size_zoom_constant:+(gt==="constant"||gt==="source"),u_is_size_feature_constant:+(gt==="constant"||gt==="camera"),u_size_t:tt?tt.uSizeT:0,u_size:tt?tt.uSize:0,u_camera_to_center_distance:kn.cameraToCenterDistance,u_pitch:kn.pitch/360*2*Math.PI,u_rotate_symbol:+ot,u_aspect_ratio:kn.width/kn.height,u_fade_change:wt.options.fadeDuration?wt.symbolFadeChange:1,u_matrix:St,u_label_plane_matrix:Tt,u_coord_matrix:Ft,u_is_text:+Xt,u_pitch_with_map:+ht,u_is_along_line:dt,u_is_variable_anchor:mt,u_texsize:pn,u_texture:0,u_translation:Gt,u_pitched_scale:wn}},fr=(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,wn,kn)=>{const Fn=wt.transform;return ct.e(Jn(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,kn),{u_gamma_scale:ht?Math.cos(Fn._pitch)*Fn.cameraToCenterDistance:1,u_device_pixel_ratio:wt.pixelRatio,u_is_halo:+wn})},sr=(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,wn)=>ct.e(fr(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,!0,Xt,!0,wn),{u_texsize_icon:pn,u_texture_icon:1}),Un=(gt,tt,ot)=>({u_matrix:gt,u_opacity:tt,u_color:ot}),pr=(gt,tt,ot,ht,dt,mt)=>ct.e(function(wt,St,Tt,Ft){const Gt=Tt.imageManager.getPattern(wt.from.toString()),Xt=Tt.imageManager.getPattern(wt.to.toString()),{width:pn,height:wn}=Tt.imageManager.getPixelSize(),kn=Math.pow(2,Ft.tileID.overscaledZ),Fn=Ft.tileSize*Math.pow(2,Tt.transform.tileZoom)/kn,Hn=Fn*(Ft.tileID.canonical.x+Ft.tileID.wrap*kn),Gn=Fn*Ft.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Gt.tl,u_pattern_br_a:Gt.br,u_pattern_tl_b:Xt.tl,u_pattern_br_b:Xt.br,u_texsize:[pn,wn],u_mix:St.t,u_pattern_size_a:Gt.displaySize,u_pattern_size_b:Xt.displaySize,u_scale_a:St.fromScale,u_scale_b:St.toScale,u_tile_units_to_pixels:1/Fr(Ft,1,Tt.transform.tileZoom),u_pixel_coord_upper:[Hn>>16,Gn>>16],u_pixel_coord_lower:[65535&Hn,65535&Gn]}}(ht,mt,ot,dt),{u_matrix:gt,u_opacity:tt}),ur={fillExtrusion:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_lightpos:new ct.aN(gt,tt.u_lightpos),u_lightintensity:new ct.aI(gt,tt.u_lightintensity),u_lightcolor:new ct.aN(gt,tt.u_lightcolor),u_vertical_gradient:new ct.aI(gt,tt.u_vertical_gradient),u_opacity:new ct.aI(gt,tt.u_opacity)}),fillExtrusionPattern:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_lightpos:new ct.aN(gt,tt.u_lightpos),u_lightintensity:new ct.aI(gt,tt.u_lightintensity),u_lightcolor:new ct.aN(gt,tt.u_lightcolor),u_vertical_gradient:new ct.aI(gt,tt.u_vertical_gradient),u_height_factor:new ct.aI(gt,tt.u_height_factor),u_image:new ct.aH(gt,tt.u_image),u_texsize:new ct.aO(gt,tt.u_texsize),u_pixel_coord_upper:new ct.aO(gt,tt.u_pixel_coord_upper),u_pixel_coord_lower:new ct.aO(gt,tt.u_pixel_coord_lower),u_scale:new ct.aN(gt,tt.u_scale),u_fade:new ct.aI(gt,tt.u_fade),u_opacity:new ct.aI(gt,tt.u_opacity)}),fill:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix)}),fillPattern:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_image:new ct.aH(gt,tt.u_image),u_texsize:new ct.aO(gt,tt.u_texsize),u_pixel_coord_upper:new ct.aO(gt,tt.u_pixel_coord_upper),u_pixel_coord_lower:new ct.aO(gt,tt.u_pixel_coord_lower),u_scale:new ct.aN(gt,tt.u_scale),u_fade:new ct.aI(gt,tt.u_fade)}),fillOutline:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_world:new ct.aO(gt,tt.u_world)}),fillOutlinePattern:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_world:new ct.aO(gt,tt.u_world),u_image:new ct.aH(gt,tt.u_image),u_texsize:new ct.aO(gt,tt.u_texsize),u_pixel_coord_upper:new ct.aO(gt,tt.u_pixel_coord_upper),u_pixel_coord_lower:new ct.aO(gt,tt.u_pixel_coord_lower),u_scale:new ct.aN(gt,tt.u_scale),u_fade:new ct.aI(gt,tt.u_fade)}),circle:(gt,tt)=>({u_camera_to_center_distance:new ct.aI(gt,tt.u_camera_to_center_distance),u_scale_with_map:new ct.aH(gt,tt.u_scale_with_map),u_pitch_with_map:new ct.aH(gt,tt.u_pitch_with_map),u_extrude_scale:new ct.aO(gt,tt.u_extrude_scale),u_device_pixel_ratio:new ct.aI(gt,tt.u_device_pixel_ratio),u_matrix:new ct.aJ(gt,tt.u_matrix)}),collisionBox:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_pixel_extrude_scale:new ct.aO(gt,tt.u_pixel_extrude_scale)}),collisionCircle:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_inv_matrix:new ct.aJ(gt,tt.u_inv_matrix),u_camera_to_center_distance:new ct.aI(gt,tt.u_camera_to_center_distance),u_viewport_size:new ct.aO(gt,tt.u_viewport_size)}),debug:(gt,tt)=>({u_color:new ct.aL(gt,tt.u_color),u_matrix:new ct.aJ(gt,tt.u_matrix),u_overlay:new ct.aH(gt,tt.u_overlay),u_overlay_scale:new ct.aI(gt,tt.u_overlay_scale)}),clippingMask:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix)}),heatmap:(gt,tt)=>({u_extrude_scale:new ct.aI(gt,tt.u_extrude_scale),u_intensity:new ct.aI(gt,tt.u_intensity),u_matrix:new ct.aJ(gt,tt.u_matrix)}),heatmapTexture:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_world:new ct.aO(gt,tt.u_world),u_image:new ct.aH(gt,tt.u_image),u_color_ramp:new ct.aH(gt,tt.u_color_ramp),u_opacity:new ct.aI(gt,tt.u_opacity)}),hillshade:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_image:new ct.aH(gt,tt.u_image),u_latrange:new ct.aO(gt,tt.u_latrange),u_light:new ct.aO(gt,tt.u_light),u_shadow:new ct.aL(gt,tt.u_shadow),u_highlight:new ct.aL(gt,tt.u_highlight),u_accent:new ct.aL(gt,tt.u_accent)}),hillshadePrepare:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_image:new ct.aH(gt,tt.u_image),u_dimension:new ct.aO(gt,tt.u_dimension),u_zoom:new ct.aI(gt,tt.u_zoom),u_unpack:new ct.aK(gt,tt.u_unpack)}),line:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_ratio:new ct.aI(gt,tt.u_ratio),u_device_pixel_ratio:new ct.aI(gt,tt.u_device_pixel_ratio),u_units_to_pixels:new ct.aO(gt,tt.u_units_to_pixels)}),lineGradient:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_ratio:new ct.aI(gt,tt.u_ratio),u_device_pixel_ratio:new ct.aI(gt,tt.u_device_pixel_ratio),u_units_to_pixels:new ct.aO(gt,tt.u_units_to_pixels),u_image:new ct.aH(gt,tt.u_image),u_image_height:new ct.aI(gt,tt.u_image_height)}),linePattern:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_texsize:new ct.aO(gt,tt.u_texsize),u_ratio:new ct.aI(gt,tt.u_ratio),u_device_pixel_ratio:new ct.aI(gt,tt.u_device_pixel_ratio),u_image:new ct.aH(gt,tt.u_image),u_units_to_pixels:new ct.aO(gt,tt.u_units_to_pixels),u_scale:new ct.aN(gt,tt.u_scale),u_fade:new ct.aI(gt,tt.u_fade)}),lineSDF:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_ratio:new ct.aI(gt,tt.u_ratio),u_device_pixel_ratio:new ct.aI(gt,tt.u_device_pixel_ratio),u_units_to_pixels:new ct.aO(gt,tt.u_units_to_pixels),u_patternscale_a:new ct.aO(gt,tt.u_patternscale_a),u_patternscale_b:new ct.aO(gt,tt.u_patternscale_b),u_sdfgamma:new ct.aI(gt,tt.u_sdfgamma),u_image:new ct.aH(gt,tt.u_image),u_tex_y_a:new ct.aI(gt,tt.u_tex_y_a),u_tex_y_b:new ct.aI(gt,tt.u_tex_y_b),u_mix:new ct.aI(gt,tt.u_mix)}),raster:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_tl_parent:new ct.aO(gt,tt.u_tl_parent),u_scale_parent:new ct.aI(gt,tt.u_scale_parent),u_buffer_scale:new ct.aI(gt,tt.u_buffer_scale),u_fade_t:new ct.aI(gt,tt.u_fade_t),u_opacity:new ct.aI(gt,tt.u_opacity),u_image0:new ct.aH(gt,tt.u_image0),u_image1:new ct.aH(gt,tt.u_image1),u_brightness_low:new ct.aI(gt,tt.u_brightness_low),u_brightness_high:new ct.aI(gt,tt.u_brightness_high),u_saturation_factor:new ct.aI(gt,tt.u_saturation_factor),u_contrast_factor:new ct.aI(gt,tt.u_contrast_factor),u_spin_weights:new ct.aN(gt,tt.u_spin_weights)}),symbolIcon:(gt,tt)=>({u_is_size_zoom_constant:new ct.aH(gt,tt.u_is_size_zoom_constant),u_is_size_feature_constant:new ct.aH(gt,tt.u_is_size_feature_constant),u_size_t:new ct.aI(gt,tt.u_size_t),u_size:new ct.aI(gt,tt.u_size),u_camera_to_center_distance:new ct.aI(gt,tt.u_camera_to_center_distance),u_pitch:new ct.aI(gt,tt.u_pitch),u_rotate_symbol:new ct.aH(gt,tt.u_rotate_symbol),u_aspect_ratio:new ct.aI(gt,tt.u_aspect_ratio),u_fade_change:new ct.aI(gt,tt.u_fade_change),u_matrix:new ct.aJ(gt,tt.u_matrix),u_label_plane_matrix:new ct.aJ(gt,tt.u_label_plane_matrix),u_coord_matrix:new ct.aJ(gt,tt.u_coord_matrix),u_is_text:new ct.aH(gt,tt.u_is_text),u_pitch_with_map:new ct.aH(gt,tt.u_pitch_with_map),u_is_along_line:new ct.aH(gt,tt.u_is_along_line),u_is_variable_anchor:new ct.aH(gt,tt.u_is_variable_anchor),u_texsize:new ct.aO(gt,tt.u_texsize),u_texture:new ct.aH(gt,tt.u_texture),u_translation:new ct.aO(gt,tt.u_translation),u_pitched_scale:new ct.aI(gt,tt.u_pitched_scale)}),symbolSDF:(gt,tt)=>({u_is_size_zoom_constant:new ct.aH(gt,tt.u_is_size_zoom_constant),u_is_size_feature_constant:new ct.aH(gt,tt.u_is_size_feature_constant),u_size_t:new ct.aI(gt,tt.u_size_t),u_size:new ct.aI(gt,tt.u_size),u_camera_to_center_distance:new ct.aI(gt,tt.u_camera_to_center_distance),u_pitch:new ct.aI(gt,tt.u_pitch),u_rotate_symbol:new ct.aH(gt,tt.u_rotate_symbol),u_aspect_ratio:new ct.aI(gt,tt.u_aspect_ratio),u_fade_change:new ct.aI(gt,tt.u_fade_change),u_matrix:new ct.aJ(gt,tt.u_matrix),u_label_plane_matrix:new ct.aJ(gt,tt.u_label_plane_matrix),u_coord_matrix:new ct.aJ(gt,tt.u_coord_matrix),u_is_text:new ct.aH(gt,tt.u_is_text),u_pitch_with_map:new ct.aH(gt,tt.u_pitch_with_map),u_is_along_line:new ct.aH(gt,tt.u_is_along_line),u_is_variable_anchor:new ct.aH(gt,tt.u_is_variable_anchor),u_texsize:new ct.aO(gt,tt.u_texsize),u_texture:new ct.aH(gt,tt.u_texture),u_gamma_scale:new ct.aI(gt,tt.u_gamma_scale),u_device_pixel_ratio:new ct.aI(gt,tt.u_device_pixel_ratio),u_is_halo:new ct.aH(gt,tt.u_is_halo),u_translation:new ct.aO(gt,tt.u_translation),u_pitched_scale:new ct.aI(gt,tt.u_pitched_scale)}),symbolTextAndIcon:(gt,tt)=>({u_is_size_zoom_constant:new ct.aH(gt,tt.u_is_size_zoom_constant),u_is_size_feature_constant:new ct.aH(gt,tt.u_is_size_feature_constant),u_size_t:new ct.aI(gt,tt.u_size_t),u_size:new ct.aI(gt,tt.u_size),u_camera_to_center_distance:new ct.aI(gt,tt.u_camera_to_center_distance),u_pitch:new ct.aI(gt,tt.u_pitch),u_rotate_symbol:new ct.aH(gt,tt.u_rotate_symbol),u_aspect_ratio:new ct.aI(gt,tt.u_aspect_ratio),u_fade_change:new ct.aI(gt,tt.u_fade_change),u_matrix:new ct.aJ(gt,tt.u_matrix),u_label_plane_matrix:new ct.aJ(gt,tt.u_label_plane_matrix),u_coord_matrix:new ct.aJ(gt,tt.u_coord_matrix),u_is_text:new ct.aH(gt,tt.u_is_text),u_pitch_with_map:new ct.aH(gt,tt.u_pitch_with_map),u_is_along_line:new ct.aH(gt,tt.u_is_along_line),u_is_variable_anchor:new ct.aH(gt,tt.u_is_variable_anchor),u_texsize:new ct.aO(gt,tt.u_texsize),u_texsize_icon:new ct.aO(gt,tt.u_texsize_icon),u_texture:new ct.aH(gt,tt.u_texture),u_texture_icon:new ct.aH(gt,tt.u_texture_icon),u_gamma_scale:new ct.aI(gt,tt.u_gamma_scale),u_device_pixel_ratio:new ct.aI(gt,tt.u_device_pixel_ratio),u_is_halo:new ct.aH(gt,tt.u_is_halo),u_translation:new ct.aO(gt,tt.u_translation),u_pitched_scale:new ct.aI(gt,tt.u_pitched_scale)}),background:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_opacity:new ct.aI(gt,tt.u_opacity),u_color:new ct.aL(gt,tt.u_color)}),backgroundPattern:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_opacity:new ct.aI(gt,tt.u_opacity),u_image:new ct.aH(gt,tt.u_image),u_pattern_tl_a:new ct.aO(gt,tt.u_pattern_tl_a),u_pattern_br_a:new ct.aO(gt,tt.u_pattern_br_a),u_pattern_tl_b:new ct.aO(gt,tt.u_pattern_tl_b),u_pattern_br_b:new ct.aO(gt,tt.u_pattern_br_b),u_texsize:new ct.aO(gt,tt.u_texsize),u_mix:new ct.aI(gt,tt.u_mix),u_pattern_size_a:new ct.aO(gt,tt.u_pattern_size_a),u_pattern_size_b:new ct.aO(gt,tt.u_pattern_size_b),u_scale_a:new ct.aI(gt,tt.u_scale_a),u_scale_b:new ct.aI(gt,tt.u_scale_b),u_pixel_coord_upper:new ct.aO(gt,tt.u_pixel_coord_upper),u_pixel_coord_lower:new ct.aO(gt,tt.u_pixel_coord_lower),u_tile_units_to_pixels:new ct.aI(gt,tt.u_tile_units_to_pixels)}),terrain:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_texture:new ct.aH(gt,tt.u_texture),u_ele_delta:new ct.aI(gt,tt.u_ele_delta),u_fog_matrix:new ct.aJ(gt,tt.u_fog_matrix),u_fog_color:new ct.aL(gt,tt.u_fog_color),u_fog_ground_blend:new ct.aI(gt,tt.u_fog_ground_blend),u_fog_ground_blend_opacity:new ct.aI(gt,tt.u_fog_ground_blend_opacity),u_horizon_color:new ct.aL(gt,tt.u_horizon_color),u_horizon_fog_blend:new ct.aI(gt,tt.u_horizon_fog_blend)}),terrainDepth:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_ele_delta:new ct.aI(gt,tt.u_ele_delta)}),terrainCoords:(gt,tt)=>({u_matrix:new ct.aJ(gt,tt.u_matrix),u_texture:new ct.aH(gt,tt.u_texture),u_terrain_coords_id:new ct.aI(gt,tt.u_terrain_coords_id),u_ele_delta:new ct.aI(gt,tt.u_ele_delta)}),sky:(gt,tt)=>({u_sky_color:new ct.aL(gt,tt.u_sky_color),u_horizon_color:new ct.aL(gt,tt.u_horizon_color),u_horizon:new ct.aI(gt,tt.u_horizon),u_sky_horizon_blend:new ct.aI(gt,tt.u_sky_horizon_blend)})};class zr{constructor(tt,ot,ht){this.context=tt;const dt=tt.gl;this.buffer=dt.createBuffer(),this.dynamicDraw=!!ht,this.context.unbindVAO(),tt.bindElementBuffer.set(this.buffer),dt.bufferData(dt.ELEMENT_ARRAY_BUFFER,ot.arrayBuffer,this.dynamicDraw?dt.DYNAMIC_DRAW:dt.STATIC_DRAW),this.dynamicDraw||delete ot.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(tt){const ot=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),ot.bufferSubData(ot.ELEMENT_ARRAY_BUFFER,0,tt.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Br{constructor(tt,ot,ht,dt){this.length=ot.length,this.attributes=ht,this.itemSize=ot.bytesPerElement,this.dynamicDraw=dt,this.context=tt;const mt=tt.gl;this.buffer=mt.createBuffer(),tt.bindVertexBuffer.set(this.buffer),mt.bufferData(mt.ARRAY_BUFFER,ot.arrayBuffer,this.dynamicDraw?mt.DYNAMIC_DRAW:mt.STATIC_DRAW),this.dynamicDraw||delete ot.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(tt){if(tt.length!==this.length)throw new Error(`Length of new data is ${tt.length}, which doesn't match current length of ${this.length}`);const ot=this.context.gl;this.bind(),ot.bufferSubData(ot.ARRAY_BUFFER,0,tt.arrayBuffer)}enableAttributes(tt,ot){for(let ht=0;ht<this.attributes.length;ht++){const dt=ot.attributes[this.attributes[ht].name];dt!==void 0&&tt.enableVertexAttribArray(dt)}}setVertexAttribPointers(tt,ot,ht){for(let dt=0;dt<this.attributes.length;dt++){const mt=this.attributes[dt],wt=ot.attributes[mt.name];wt!==void 0&&tt.vertexAttribPointer(wt,mt.components,tt[Vr[mt.type]],!1,this.itemSize,mt.offset+this.itemSize*(ht||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qr=new WeakMap;function Kr(gt){var tt;if(Qr.has(gt))return Qr.get(gt);{const ot=(tt=gt.getParameter(gt.VERSION))===null||tt===void 0?void 0:tt.startsWith("WebGL 2.0");return Qr.set(gt,ot),ot}}class Or{constructor(tt){this.gl=tt.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(tt){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Js extends Or{getDefault(){return ct.aM.transparent}set(tt){const ot=this.current;(tt.r!==ot.r||tt.g!==ot.g||tt.b!==ot.b||tt.a!==ot.a||this.dirty)&&(this.gl.clearColor(tt.r,tt.g,tt.b,tt.a),this.current=tt,this.dirty=!1)}}class Ns extends Or{getDefault(){return 1}set(tt){(tt!==this.current||this.dirty)&&(this.gl.clearDepth(tt),this.current=tt,this.dirty=!1)}}class Is extends Or{getDefault(){return 0}set(tt){(tt!==this.current||this.dirty)&&(this.gl.clearStencil(tt),this.current=tt,this.dirty=!1)}}class Vs extends Or{getDefault(){return[!0,!0,!0,!0]}set(tt){const ot=this.current;(tt[0]!==ot[0]||tt[1]!==ot[1]||tt[2]!==ot[2]||tt[3]!==ot[3]||this.dirty)&&(this.gl.colorMask(tt[0],tt[1],tt[2],tt[3]),this.current=tt,this.dirty=!1)}}class Es extends Or{getDefault(){return!0}set(tt){(tt!==this.current||this.dirty)&&(this.gl.depthMask(tt),this.current=tt,this.dirty=!1)}}class Xs extends Or{getDefault(){return 255}set(tt){(tt!==this.current||this.dirty)&&(this.gl.stencilMask(tt),this.current=tt,this.dirty=!1)}}class Bs extends Or{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(tt){const ot=this.current;(tt.func!==ot.func||tt.ref!==ot.ref||tt.mask!==ot.mask||this.dirty)&&(this.gl.stencilFunc(tt.func,tt.ref,tt.mask),this.current=tt,this.dirty=!1)}}class fo extends Or{getDefault(){const tt=this.gl;return[tt.KEEP,tt.KEEP,tt.KEEP]}set(tt){const ot=this.current;(tt[0]!==ot[0]||tt[1]!==ot[1]||tt[2]!==ot[2]||this.dirty)&&(this.gl.stencilOp(tt[0],tt[1],tt[2]),this.current=tt,this.dirty=!1)}}class po extends Or{getDefault(){return!1}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;tt?ot.enable(ot.STENCIL_TEST):ot.disable(ot.STENCIL_TEST),this.current=tt,this.dirty=!1}}class _o extends Or{getDefault(){return[0,1]}set(tt){const ot=this.current;(tt[0]!==ot[0]||tt[1]!==ot[1]||this.dirty)&&(this.gl.depthRange(tt[0],tt[1]),this.current=tt,this.dirty=!1)}}class xo extends Or{getDefault(){return!1}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;tt?ot.enable(ot.DEPTH_TEST):ot.disable(ot.DEPTH_TEST),this.current=tt,this.dirty=!1}}class wo extends Or{getDefault(){return this.gl.LESS}set(tt){(tt!==this.current||this.dirty)&&(this.gl.depthFunc(tt),this.current=tt,this.dirty=!1)}}class Io extends Or{getDefault(){return!1}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;tt?ot.enable(ot.BLEND):ot.disable(ot.BLEND),this.current=tt,this.dirty=!1}}class Do extends Or{getDefault(){const tt=this.gl;return[tt.ONE,tt.ZERO]}set(tt){const ot=this.current;(tt[0]!==ot[0]||tt[1]!==ot[1]||this.dirty)&&(this.gl.blendFunc(tt[0],tt[1]),this.current=tt,this.dirty=!1)}}class Yo extends Or{getDefault(){return ct.aM.transparent}set(tt){const ot=this.current;(tt.r!==ot.r||tt.g!==ot.g||tt.b!==ot.b||tt.a!==ot.a||this.dirty)&&(this.gl.blendColor(tt.r,tt.g,tt.b,tt.a),this.current=tt,this.dirty=!1)}}class Bo extends Or{getDefault(){return this.gl.FUNC_ADD}set(tt){(tt!==this.current||this.dirty)&&(this.gl.blendEquation(tt),this.current=tt,this.dirty=!1)}}class Lo extends Or{getDefault(){return!1}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;tt?ot.enable(ot.CULL_FACE):ot.disable(ot.CULL_FACE),this.current=tt,this.dirty=!1}}class Xo extends Or{getDefault(){return this.gl.BACK}set(tt){(tt!==this.current||this.dirty)&&(this.gl.cullFace(tt),this.current=tt,this.dirty=!1)}}class Fo extends Or{getDefault(){return this.gl.CCW}set(tt){(tt!==this.current||this.dirty)&&(this.gl.frontFace(tt),this.current=tt,this.dirty=!1)}}class $a extends Or{getDefault(){return null}set(tt){(tt!==this.current||this.dirty)&&(this.gl.useProgram(tt),this.current=tt,this.dirty=!1)}}class bu extends Or{getDefault(){return this.gl.TEXTURE0}set(tt){(tt!==this.current||this.dirty)&&(this.gl.activeTexture(tt),this.current=tt,this.dirty=!1)}}class nu extends Or{getDefault(){const tt=this.gl;return[0,0,tt.drawingBufferWidth,tt.drawingBufferHeight]}set(tt){const ot=this.current;(tt[0]!==ot[0]||tt[1]!==ot[1]||tt[2]!==ot[2]||tt[3]!==ot[3]||this.dirty)&&(this.gl.viewport(tt[0],tt[1],tt[2],tt[3]),this.current=tt,this.dirty=!1)}}class na extends Or{getDefault(){return null}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;ot.bindFramebuffer(ot.FRAMEBUFFER,tt),this.current=tt,this.dirty=!1}}class Ml extends Or{getDefault(){return null}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;ot.bindRenderbuffer(ot.RENDERBUFFER,tt),this.current=tt,this.dirty=!1}}class pu extends Or{getDefault(){return null}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;ot.bindTexture(ot.TEXTURE_2D,tt),this.current=tt,this.dirty=!1}}class js extends Or{getDefault(){return null}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;ot.bindBuffer(ot.ARRAY_BUFFER,tt),this.current=tt,this.dirty=!1}}class Fs extends Or{getDefault(){return null}set(tt){const ot=this.gl;ot.bindBuffer(ot.ELEMENT_ARRAY_BUFFER,tt),this.current=tt,this.dirty=!1}}class _s extends Or{getDefault(){return null}set(tt){var ot;if(tt===this.current&&!this.dirty)return;const ht=this.gl;Kr(ht)?ht.bindVertexArray(tt):(ot=ht.getExtension("OES_vertex_array_object"))===null||ot===void 0||ot.bindVertexArrayOES(tt),this.current=tt,this.dirty=!1}}class Cs extends Or{getDefault(){return 4}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;ot.pixelStorei(ot.UNPACK_ALIGNMENT,tt),this.current=tt,this.dirty=!1}}class Ss extends Or{getDefault(){return!1}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;ot.pixelStorei(ot.UNPACK_PREMULTIPLY_ALPHA_WEBGL,tt),this.current=tt,this.dirty=!1}}class Ws extends Or{getDefault(){return!1}set(tt){if(tt===this.current&&!this.dirty)return;const ot=this.gl;ot.pixelStorei(ot.UNPACK_FLIP_Y_WEBGL,tt),this.current=tt,this.dirty=!1}}class Zs extends Or{constructor(tt,ot){super(tt),this.context=tt,this.parent=ot}getDefault(){return null}}class ks extends Zs{setDirty(){this.dirty=!0}set(tt){if(tt===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const ot=this.gl;ot.framebufferTexture2D(ot.FRAMEBUFFER,ot.COLOR_ATTACHMENT0,ot.TEXTURE_2D,tt,0),this.current=tt,this.dirty=!1}}class ls extends Zs{set(tt){if(tt===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const ot=this.gl;ot.framebufferRenderbuffer(ot.FRAMEBUFFER,ot.DEPTH_ATTACHMENT,ot.RENDERBUFFER,tt),this.current=tt,this.dirty=!1}}class Ys extends Zs{set(tt){if(tt===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const ot=this.gl;ot.framebufferRenderbuffer(ot.FRAMEBUFFER,ot.DEPTH_STENCIL_ATTACHMENT,ot.RENDERBUFFER,tt),this.current=tt,this.dirty=!1}}class ao{constructor(tt,ot,ht,dt,mt){this.context=tt,this.width=ot,this.height=ht;const wt=tt.gl,St=this.framebuffer=wt.createFramebuffer();if(this.colorAttachment=new ks(tt,St),dt)this.depthAttachment=mt?new Ys(tt,St):new ls(tt,St);else if(mt)throw new Error("Stencil cannot be set without depth");if(wt.checkFramebufferStatus(wt.FRAMEBUFFER)!==wt.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const tt=this.context.gl,ot=this.colorAttachment.get();if(ot&&tt.deleteTexture(ot),this.depthAttachment){const ht=this.depthAttachment.get();ht&&tt.deleteRenderbuffer(ht)}tt.deleteFramebuffer(this.framebuffer)}}class to{constructor(tt,ot,ht){this.blendFunction=tt,this.blendColor=ot,this.mask=ht}}to.Replace=[1,0],to.disabled=new to(to.Replace,ct.aM.transparent,[!1,!1,!1,!1]),to.unblended=new to(to.Replace,ct.aM.transparent,[!0,!0,!0,!0]),to.alphaBlended=new to([1,771],ct.aM.transparent,[!0,!0,!0,!0]);class Ro{constructor(tt){var ot,ht;if(this.gl=tt,this.clearColor=new Js(this),this.clearDepth=new Ns(this),this.clearStencil=new Is(this),this.colorMask=new Vs(this),this.depthMask=new Es(this),this.stencilMask=new Xs(this),this.stencilFunc=new Bs(this),this.stencilOp=new fo(this),this.stencilTest=new po(this),this.depthRange=new _o(this),this.depthTest=new xo(this),this.depthFunc=new wo(this),this.blend=new Io(this),this.blendFunc=new Do(this),this.blendColor=new Yo(this),this.blendEquation=new Bo(this),this.cullFace=new Lo(this),this.cullFaceSide=new Xo(this),this.frontFace=new Fo(this),this.program=new $a(this),this.activeTexture=new bu(this),this.viewport=new nu(this),this.bindFramebuffer=new na(this),this.bindRenderbuffer=new Ml(this),this.bindTexture=new pu(this),this.bindVertexBuffer=new js(this),this.bindElementBuffer=new Fs(this),this.bindVertexArray=new _s(this),this.pixelStoreUnpack=new Cs(this),this.pixelStoreUnpackPremultiplyAlpha=new Ss(this),this.pixelStoreUnpackFlipY=new Ws(this),this.extTextureFilterAnisotropic=tt.getExtension("EXT_texture_filter_anisotropic")||tt.getExtension("MOZ_EXT_texture_filter_anisotropic")||tt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=tt.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=tt.getParameter(tt.MAX_TEXTURE_SIZE),Kr(tt)){this.HALF_FLOAT=tt.HALF_FLOAT;const dt=tt.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(ot=tt.RGBA16F)!==null&&ot!==void 0?ot:dt==null?void 0:dt.RGBA16F_EXT,this.RGB16F=(ht=tt.RGB16F)!==null&&ht!==void 0?ht:dt==null?void 0:dt.RGB16F_EXT,tt.getExtension("EXT_color_buffer_float")}else{tt.getExtension("EXT_color_buffer_half_float"),tt.getExtension("OES_texture_half_float_linear");const dt=tt.getExtension("OES_texture_half_float");this.HALF_FLOAT=dt==null?void 0:dt.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(tt,ot){return new zr(this,tt,ot)}createVertexBuffer(tt,ot,ht){return new Br(this,tt,ot,ht)}createRenderbuffer(tt,ot,ht){const dt=this.gl,mt=dt.createRenderbuffer();return this.bindRenderbuffer.set(mt),dt.renderbufferStorage(dt.RENDERBUFFER,tt,ot,ht),this.bindRenderbuffer.set(null),mt}createFramebuffer(tt,ot,ht,dt){return new ao(this,tt,ot,ht,dt)}clear({color:tt,depth:ot,stencil:ht}){const dt=this.gl;let mt=0;tt&&(mt|=dt.COLOR_BUFFER_BIT,this.clearColor.set(tt),this.colorMask.set([!0,!0,!0,!0])),ot!==void 0&&(mt|=dt.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(ot),this.depthMask.set(!0)),ht!==void 0&&(mt|=dt.STENCIL_BUFFER_BIT,this.clearStencil.set(ht),this.stencilMask.set(255)),dt.clear(mt)}setCullFace(tt){tt.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(tt.mode),this.frontFace.set(tt.frontFace))}setDepthMode(tt){tt.func!==this.gl.ALWAYS||tt.mask?(this.depthTest.set(!0),this.depthFunc.set(tt.func),this.depthMask.set(tt.mask),this.depthRange.set(tt.range)):this.depthTest.set(!1)}setStencilMode(tt){tt.test.func!==this.gl.ALWAYS||tt.mask?(this.stencilTest.set(!0),this.stencilMask.set(tt.mask),this.stencilOp.set([tt.fail,tt.depthFail,tt.pass]),this.stencilFunc.set({func:tt.test.func,ref:tt.ref,mask:tt.test.mask})):this.stencilTest.set(!1)}setColorMode(tt){ct.aE(tt.blendFunction,to.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(tt.blendFunction),this.blendColor.set(tt.blendColor)),this.colorMask.set(tt.mask)}createVertexArray(){var tt;return Kr(this.gl)?this.gl.createVertexArray():(tt=this.gl.getExtension("OES_vertex_array_object"))===null||tt===void 0?void 0:tt.createVertexArrayOES()}deleteVertexArray(tt){var ot;return Kr(this.gl)?this.gl.deleteVertexArray(tt):(ot=this.gl.getExtension("OES_vertex_array_object"))===null||ot===void 0?void 0:ot.deleteVertexArrayOES(tt)}unbindVAO(){this.bindVertexArray.set(null)}}class $s{constructor(tt,ot,ht){this.func=tt,this.mask=ot,this.range=ht}}$s.ReadOnly=!1,$s.ReadWrite=!0,$s.disabled=new $s(519,$s.ReadOnly,[0,1]);const xl=7680;class vs{constructor(tt,ot,ht,dt,mt,wt){this.test=tt,this.ref=ot,this.mask=ht,this.fail=dt,this.depthFail=mt,this.pass=wt}}vs.disabled=new vs({func:519,mask:0},0,0,xl,xl,xl);class ro{constructor(tt,ot,ht){this.enable=tt,this.mode=ot,this.frontFace=ht}}let Eo;function Po(gt,tt,ot,ht,dt){const mt=gt.context,wt=mt.gl,St=gt.useProgram("collisionBox"),Tt=[];let Ft=0,Gt=0;for(let Gn=0;Gn<ht.length;Gn++){const Qn=ht[Gn],Dn=tt.getTile(Qn).getBucket(ot);if(!Dn)continue;const ar=dt?Dn.textCollisionBox:Dn.iconCollisionBox,mr=Dn.collisionCircleArray;if(mr.length>0){const Ar=ct.H();ct.aQ(Ar,Dn.placementInvProjMatrix,gt.transform.glCoordMatrix),ct.aQ(Ar,Ar,Dn.placementViewportMatrix),Tt.push({circleArray:mr,circleOffset:Gt,transform:Qn.posMatrix,invTransform:Ar,coord:Qn}),Ft+=mr.length/4,Gt=Ft}ar&&St.draw(mt,wt.LINES,$s.disabled,vs.disabled,gt.colorModeForRenderPass(),ro.disabled,{u_matrix:Qn.posMatrix,u_pixel_extrude_scale:[1/(Xt=gt.transform).width,1/Xt.height]},gt.style.map.terrain&&gt.style.map.terrain.getTerrainData(Qn),ot.id,ar.layoutVertexBuffer,ar.indexBuffer,ar.segments,null,gt.transform.zoom,null,null,ar.collisionVertexBuffer)}var Xt;if(!dt||!Tt.length)return;const pn=gt.useProgram("collisionCircle"),wn=new ct.aR;wn.resize(4*Ft),wn._trim();let kn=0;for(const Gn of Tt)for(let Qn=0;Qn<Gn.circleArray.length/4;Qn++){const Dn=4*Qn,ar=Gn.circleArray[Dn+0],mr=Gn.circleArray[Dn+1],Ar=Gn.circleArray[Dn+2],Wr=Gn.circleArray[Dn+3];wn.emplace(kn++,ar,mr,Ar,Wr,0),wn.emplace(kn++,ar,mr,Ar,Wr,1),wn.emplace(kn++,ar,mr,Ar,Wr,2),wn.emplace(kn++,ar,mr,Ar,Wr,3)}(!Eo||Eo.length<2*Ft)&&(Eo=function(Gn){const Qn=2*Gn,Dn=new ct.aT;Dn.resize(Qn),Dn._trim();for(let ar=0;ar<Qn;ar++){const mr=6*ar;Dn.uint16[mr+0]=4*ar+0,Dn.uint16[mr+1]=4*ar+1,Dn.uint16[mr+2]=4*ar+2,Dn.uint16[mr+3]=4*ar+2,Dn.uint16[mr+4]=4*ar+3,Dn.uint16[mr+5]=4*ar+0}return Dn}(Ft));const Fn=mt.createIndexBuffer(Eo,!0),Hn=mt.createVertexBuffer(wn,ct.aS.members,!0);for(const Gn of Tt){const Qn=xu(Gn.transform,Gn.invTransform,gt.transform);pn.draw(mt,wt.TRIANGLES,$s.disabled,vs.disabled,gt.colorModeForRenderPass(),ro.disabled,Qn,gt.style.map.terrain&&gt.style.map.terrain.getTerrainData(Gn.coord),ot.id,Hn,Fn,ct.a0.simpleSegment(0,2*Gn.circleOffset,Gn.circleArray.length,Gn.circleArray.length/2),null,gt.transform.zoom,null,null,null)}Hn.destroy(),Fn.destroy()}ro.disabled=new ro(!1,1029,2305),ro.backCCW=new ro(!0,1029,2305);const Uo=ct.an(new Float32Array(16));function Co(gt,tt,ot,ht,dt,mt){const{horizontalAlign:wt,verticalAlign:St}=ct.au(gt);return new ct.P((-(wt-.5)*tt/dt+ht[0])*mt,(-(St-.5)*ot/dt+ht[1])*mt)}function Ol(gt,tt,ot,ht,dt,mt){const wt=tt.tileAnchorPoint.add(new ct.P(tt.translation[0],tt.translation[1]));if(tt.pitchWithMap){let St=ht.mult(mt);ot||(St=St.rotate(-dt));const Tt=wt.add(St);return _n(Tt.x,Tt.y,tt.labelPlaneMatrix,tt.getElevation).point}if(ot){const St=un(tt.tileAnchorPoint.x+1,tt.tileAnchorPoint.y,tt).point.sub(gt),Tt=Math.atan(St.y/St.x)+(St.x<0?Math.PI:0);return gt.add(ht.rotate(Tt))}return gt.add(ht)}function fu(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt,pn,wn){const kn=gt.text.placedSymbolArray,Fn=gt.text.dynamicLayoutVertexArray,Hn=gt.icon.dynamicLayoutVertexArray,Gn={};Fn.clear();for(let Qn=0;Qn<kn.length;Qn++){const Dn=kn.get(Qn),ar=Dn.hidden||!Dn.crossTileID||gt.allowVerticalPlacement&&!Dn.placedOrientation?null:ht[Dn.crossTileID];if(ar){const mr=new ct.P(Dn.anchorX,Dn.anchorY),Ar={getElevation:wn,width:dt.width,height:dt.height,labelPlaneMatrix:mt,lineVertexArray:null,pitchWithMap:ot,projection:Gt,projectionCache:null,tileAnchorPoint:mr,translation:Xt,unwrappedTileID:pn},Wr=ot?_n(mr.x,mr.y,wt,wn):un(mr.x,mr.y,Ar),es=Wt(dt.cameraToCenterDistance,Wr.signedDistanceFromCamera);let us=ct.ai(gt.textSizeData,Tt,Dn)*es/ct.ap;ot&&(us*=gt.tilePixelRatio/St);const{width:ys,height:os,anchor:rs,textOffset:Rs,textBoxScale:no}=ar,as=Co(rs,ys,os,Rs,no,us),ms=Gt.getPitchedTextCorrection(dt,mr.add(new ct.P(Xt[0],Xt[1])),pn),Qs=Ol(Wr.point,Ar,tt,as,dt.angle,ms),Ho=gt.allowVerticalPlacement&&Dn.placedOrientation===ct.ah.vertical?Math.PI/2:0;for(let co=0;co<Dn.numGlyphs;co++)ct.aj(Fn,Qs,Ho);Ft&&Dn.associatedIconIndex>=0&&(Gn[Dn.associatedIconIndex]={shiftedAnchor:Qs,angle:Ho})}else zn(Dn.numGlyphs,Fn)}if(Ft){Hn.clear();const Qn=gt.icon.placedSymbolArray;for(let Dn=0;Dn<Qn.length;Dn++){const ar=Qn.get(Dn);if(ar.hidden)zn(ar.numGlyphs,Hn);else{const mr=Gn[Dn];if(mr)for(let Ar=0;Ar<ar.numGlyphs;Ar++)ct.aj(Hn,mr.shiftedAnchor,mr.angle);else zn(ar.numGlyphs,Hn)}}gt.icon.dynamicLayoutVertexBuffer.updateData(Hn)}gt.text.dynamicLayoutVertexBuffer.updateData(Fn)}function Il(gt,tt,ot){return ot.iconsInText&&tt?"symbolTextAndIcon":gt?"symbolSDF":"symbolIcon"}function Pu(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft,Gt,Xt){const pn=gt.context,wn=pn.gl,kn=gt.transform,Fn=Bu(),Hn=St==="map",Gn=Tt==="map",Qn=St!=="viewport"&&ot.layout.get("symbol-placement")!=="point",Dn=Hn&&!Gn&&!Qn,ar=!Gn&&Qn,mr=!ot.layout.get("symbol-sort-key").isConstant();let Ar=!1;const Wr=gt.depthModeForSublayer(0,$s.ReadOnly),es=ot._unevaluatedLayout.hasValue("text-variable-anchor")||ot._unevaluatedLayout.hasValue("text-variable-anchor-offset"),us=[],ys=Fn.getCircleRadiusCorrection(kn);for(const os of ht){const rs=tt.getTile(os),Rs=rs.getBucket(ot);if(!Rs)continue;const no=dt?Rs.text:Rs.icon;if(!no||!no.segments.get().length||!no.hasVisibleVertices)continue;const as=no.programConfigurations.get(ot.id),ms=dt||Rs.sdfIcons,Qs=dt?Rs.textSizeData:Rs.iconSizeData,Ho=Gn||kn.pitch!==0,co=gt.useProgram(Il(ms,dt,Rs),as),mo=ct.ag(Qs,kn.zoom),Wo=gt.style.map.terrain&&gt.style.map.terrain.getTerrainData(os);let Nl,Iu,qo,su,Yl=[0,0],Bl=null;if(dt)Iu=rs.glyphAtlasTexture,qo=wn.LINEAR,Nl=rs.glyphAtlasTexture.size,Rs.iconsInText&&(Yl=rs.imageAtlasTexture.size,Bl=rs.imageAtlasTexture,su=Ho||gt.options.rotating||gt.options.zooming||Qs.kind==="composite"||Qs.kind==="camera"?wn.LINEAR:wn.NEAREST);else{const vo=ot.layout.get("icon-size").constantOr(0)!==1||Rs.iconsNeedLinear;Iu=rs.imageAtlasTexture,qo=ms||gt.options.rotating||gt.options.zooming||vo||Ho?wn.LINEAR:wn.NEAREST,Nl=rs.imageAtlasTexture.size}const Jl=Fr(rs,1,gt.transform.zoom),Wu=ar?os.posMatrix:Uo,em=lo(Wu,Gn,Hn,gt.transform,Jl),Vm=rr(Wu,Gn,Hn,gt.transform,Jl),tm=rr(os.posMatrix,Gn,Hn,gt.transform,Jl),Su=Fn.translatePosition(gt.transform,rs,mt,wt),Hm=es&&Rs.hasTextData(),L_=ot.layout.get("icon-text-fit")!=="none"&&Hm&&Rs.hasIconData();if(Qn){const vo=gt.style.map.terrain?(nm,im)=>gt.style.map.terrain.getElevation(os,nm,im):null,Fp=ot.layout.get("text-rotation-alignment")==="map";ln(Rs,os.posMatrix,gt,dt,em,tm,Gn,Ft,Fp,Fn,os.toUnwrapped(),kn.width,kn.height,Su,vo)}const Au=os.posMatrix,Tu=dt&&es||L_,hp=Qn||Tu?Uo:em,Du=Vm,Dl=ms&&ot.paint.get(dt?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let $l;$l=ms?Rs.iconsInText?sr(Qs.kind,mo,Dn,Gn,Qn,Tu,gt,Au,hp,Du,Su,Nl,Yl,ys):fr(Qs.kind,mo,Dn,Gn,Qn,Tu,gt,Au,hp,Du,Su,dt,Nl,!0,ys):Jn(Qs.kind,mo,Dn,Gn,Qn,Tu,gt,Au,hp,Du,Su,dt,Nl,ys);const _u={program:co,buffers:no,uniformValues:$l,atlasTexture:Iu,atlasTextureIcon:Bl,atlasInterpolation:qo,atlasInterpolationIcon:su,isSDF:ms,hasHalo:Dl};if(mr&&Rs.canOverlap){Ar=!0;const vo=no.segments.get();for(const Fp of vo)us.push({segments:new ct.a0([Fp]),sortKey:Fp.sortKey,state:_u,terrainData:Wo})}else us.push({segments:no.segments,sortKey:0,state:_u,terrainData:Wo})}Ar&&us.sort((os,rs)=>os.sortKey-rs.sortKey);for(const os of us){const rs=os.state;if(pn.activeTexture.set(wn.TEXTURE0),rs.atlasTexture.bind(rs.atlasInterpolation,wn.CLAMP_TO_EDGE),rs.atlasTextureIcon&&(pn.activeTexture.set(wn.TEXTURE1),rs.atlasTextureIcon&&rs.atlasTextureIcon.bind(rs.atlasInterpolationIcon,wn.CLAMP_TO_EDGE)),rs.isSDF){const Rs=rs.uniformValues;rs.hasHalo&&(Rs.u_is_halo=1,Qu(rs.buffers,os.segments,ot,gt,rs.program,Wr,Gt,Xt,Rs,os.terrainData)),Rs.u_is_halo=0}Qu(rs.buffers,os.segments,ot,gt,rs.program,Wr,Gt,Xt,rs.uniformValues,os.terrainData)}}function Qu(gt,tt,ot,ht,dt,mt,wt,St,Tt,Ft){const Gt=ht.context;dt.draw(Gt,Gt.gl.TRIANGLES,mt,wt,St,ro.disabled,Tt,Ft,ot.id,gt.layoutVertexBuffer,gt.indexBuffer,tt,ot.paint,ht.transform.zoom,gt.programConfigurations.get(ot.id),gt.dynamicLayoutVertexBuffer,gt.opacityVertexBuffer)}function fm(gt,tt,ot,ht){const dt=gt.context,mt=dt.gl,wt=vs.disabled,St=new to([mt.ONE,mt.ONE],ct.aM.transparent,[!0,!0,!0,!0]),Tt=tt.getBucket(ot);if(!Tt)return;const Ft=ht.key;let Gt=ot.heatmapFbos.get(Ft);Gt||(Gt=sp(dt,tt.tileSize,tt.tileSize),ot.heatmapFbos.set(Ft,Gt)),dt.bindFramebuffer.set(Gt.framebuffer),dt.viewport.set([0,0,tt.tileSize,tt.tileSize]),dt.clear({color:ct.aM.transparent});const Xt=Tt.programConfigurations.get(ot.id),pn=gt.useProgram("heatmap",Xt),wn=gt.style.map.terrain.getTerrainData(ht);pn.draw(dt,mt.TRIANGLES,$s.disabled,wt,St,ro.disabled,Rl(ht.posMatrix,tt,gt.transform.zoom,ot.paint.get("heatmap-intensity")),wn,ot.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,ot.paint,gt.transform.zoom,Xt)}function _a(gt,tt,ot){const ht=gt.context,dt=ht.gl;ht.setColorMode(gt.colorModeForRenderPass());const mt=wp(ht,tt),wt=ot.key,St=tt.heatmapFbos.get(wt);St&&(ht.activeTexture.set(dt.TEXTURE0),dt.bindTexture(dt.TEXTURE_2D,St.colorAttachment.get()),ht.activeTexture.set(dt.TEXTURE1),mt.bind(dt.LINEAR,dt.CLAMP_TO_EDGE),gt.useProgram("heatmapTexture").draw(ht,dt.TRIANGLES,$s.disabled,vs.disabled,gt.colorModeForRenderPass(),ro.disabled,bp(gt,tt,0,1),null,tt.id,gt.rasterBoundsBuffer,gt.quadTriangleIndexBuffer,gt.rasterBoundsSegments,tt.paint,gt.transform.zoom),St.destroy(),tt.heatmapFbos.delete(wt))}function sp(gt,tt,ot){var ht,dt;const mt=gt.gl,wt=mt.createTexture();mt.bindTexture(mt.TEXTURE_2D,wt),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_WRAP_S,mt.CLAMP_TO_EDGE),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_WRAP_T,mt.CLAMP_TO_EDGE),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_MIN_FILTER,mt.LINEAR),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_MAG_FILTER,mt.LINEAR);const St=(ht=gt.HALF_FLOAT)!==null&&ht!==void 0?ht:mt.UNSIGNED_BYTE,Tt=(dt=gt.RGBA16F)!==null&&dt!==void 0?dt:mt.RGBA;mt.texImage2D(mt.TEXTURE_2D,0,Tt,tt,ot,0,mt.RGBA,St,null);const Ft=gt.createFramebuffer(tt,ot,!1,!1);return Ft.colorAttachment.set(wt),Ft}function wp(gt,tt){return tt.colorRampTexture||(tt.colorRampTexture=new fn(gt,tt.colorRamp,gt.gl.RGBA)),tt.colorRampTexture}function So(gt,tt,ot,ht,dt){if(!ot||!ht||!ht.imageAtlas)return;const mt=ht.imageAtlas.patternPositions;let wt=mt[ot.to.toString()],St=mt[ot.from.toString()];if(!wt&&St&&(wt=St),!St&&wt&&(St=wt),!wt||!St){const Tt=dt.getPaintProperty(tt);wt=mt[Tt],St=mt[Tt]}wt&&St&&gt.setConstantPatternPositions(wt,St)}function Ep(gt,tt,ot,ht,dt,mt,wt){const St=gt.context.gl,Tt="fill-pattern",Ft=ot.paint.get(Tt),Gt=Ft&&Ft.constantOr(1),Xt=ot.getCrossfadeParameters();let pn,wn,kn,Fn,Hn;wt?(wn=Gt&&!ot.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",pn=St.LINES):(wn=Gt?"fillPattern":"fill",pn=St.TRIANGLES);const Gn=Ft.constantOr(null);for(const Qn of ht){const Dn=tt.getTile(Qn);if(Gt&&!Dn.patternsLoaded())continue;const ar=Dn.getBucket(ot);if(!ar)continue;const mr=ar.programConfigurations.get(ot.id),Ar=gt.useProgram(wn,mr),Wr=gt.style.map.terrain&&gt.style.map.terrain.getTerrainData(Qn);Gt&&(gt.context.activeTexture.set(St.TEXTURE0),Dn.imageAtlasTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE),mr.updatePaintBuffers(Xt)),So(mr,Tt,Gn,Dn,ot);const es=Wr?Qn:null,us=gt.translatePosMatrix(es?es.posMatrix:Qn.posMatrix,Dn,ot.paint.get("fill-translate"),ot.paint.get("fill-translate-anchor"));if(wt){Fn=ar.indexBuffer2,Hn=ar.segments2;const ys=[St.drawingBufferWidth,St.drawingBufferHeight];kn=wn==="fillOutlinePattern"&&Gt?pm(us,gt,Xt,Dn,ys):p_(us,ys)}else Fn=ar.indexBuffer,Hn=ar.segments,kn=Gt?Yu(us,gt,Xt,Dn):np(us);Ar.draw(gt.context,pn,dt,gt.stencilModeForClipping(Qn),mt,ro.disabled,kn,Wr,ot.id,ar.layoutVertexBuffer,Fn,Hn,ot.paint,gt.transform.zoom,mr)}}function mu(gt,tt,ot,ht,dt,mt,wt){const St=gt.context,Tt=St.gl,Ft="fill-extrusion-pattern",Gt=ot.paint.get(Ft),Xt=Gt.constantOr(1),pn=ot.getCrossfadeParameters(),wn=ot.paint.get("fill-extrusion-opacity"),kn=Gt.constantOr(null);for(const Fn of ht){const Hn=tt.getTile(Fn),Gn=Hn.getBucket(ot);if(!Gn)continue;const Qn=gt.style.map.terrain&&gt.style.map.terrain.getTerrainData(Fn),Dn=Gn.programConfigurations.get(ot.id),ar=gt.useProgram(Xt?"fillExtrusionPattern":"fillExtrusion",Dn);Xt&&(gt.context.activeTexture.set(Tt.TEXTURE0),Hn.imageAtlasTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE),Dn.updatePaintBuffers(pn)),So(Dn,Ft,kn,Hn,ot);const mr=gt.translatePosMatrix(Fn.posMatrix,Hn,ot.paint.get("fill-extrusion-translate"),ot.paint.get("fill-extrusion-translate-anchor")),Ar=ot.paint.get("fill-extrusion-vertical-gradient"),Wr=Xt?Hp(mr,gt,Ar,wn,Fn,pn,Hn):Ku(mr,gt,Ar,wn);ar.draw(St,St.gl.TRIANGLES,dt,mt,wt,ro.backCCW,Wr,Qn,ot.id,Gn.layoutVertexBuffer,Gn.indexBuffer,Gn.segments,ot.paint,gt.transform.zoom,Dn,gt.style.map.terrain&&Gn.centroidVertexBuffer)}}function op(gt,tt,ot,ht,dt,mt,wt){const St=gt.context,Tt=St.gl,Ft=ot.fbo;if(!Ft)return;const Gt=gt.useProgram("hillshade"),Xt=gt.style.map.terrain&&gt.style.map.terrain.getTerrainData(tt);St.activeTexture.set(Tt.TEXTURE0),Tt.bindTexture(Tt.TEXTURE_2D,Ft.colorAttachment.get()),Gt.draw(St,Tt.TRIANGLES,dt,mt,wt,ro.disabled,((pn,wn,kn,Fn)=>{const Hn=kn.paint.get("hillshade-shadow-color"),Gn=kn.paint.get("hillshade-highlight-color"),Qn=kn.paint.get("hillshade-accent-color");let Dn=kn.paint.get("hillshade-illumination-direction")*(Math.PI/180);kn.paint.get("hillshade-illumination-anchor")==="viewport"&&(Dn-=pn.transform.angle);const ar=!pn.options.moving;return{u_matrix:Fn?Fn.posMatrix:pn.transform.calculatePosMatrix(wn.tileID.toUnwrapped(),ar),u_image:0,u_latrange:ip(0,wn.tileID),u_light:[kn.paint.get("hillshade-exaggeration"),Dn],u_shadow:Hn,u_highlight:Gn,u_accent:Qn}})(gt,ot,ht,Xt?tt:null),Xt,ht.id,gt.rasterBoundsBuffer,gt.quadTriangleIndexBuffer,gt.rasterBoundsSegments)}function ap(gt,tt,ot,ht,dt,mt){const wt=gt.context,St=wt.gl,Tt=tt.dem;if(Tt&&Tt.data){const Ft=Tt.dim,Gt=Tt.stride,Xt=Tt.getPixels();if(wt.activeTexture.set(St.TEXTURE1),wt.pixelStoreUnpackPremultiplyAlpha.set(!1),tt.demTexture=tt.demTexture||gt.getTileTexture(Gt),tt.demTexture){const wn=tt.demTexture;wn.update(Xt,{premultiply:!1}),wn.bind(St.NEAREST,St.CLAMP_TO_EDGE)}else tt.demTexture=new fn(wt,Xt,St.RGBA,{premultiply:!1}),tt.demTexture.bind(St.NEAREST,St.CLAMP_TO_EDGE);wt.activeTexture.set(St.TEXTURE0);let pn=tt.fbo;if(!pn){const wn=new fn(wt,{width:Ft,height:Ft,data:null},St.RGBA);wn.bind(St.LINEAR,St.CLAMP_TO_EDGE),pn=tt.fbo=wt.createFramebuffer(Ft,Ft,!0,!1),pn.colorAttachment.set(wn.texture)}wt.bindFramebuffer.set(pn.framebuffer),wt.viewport.set([0,0,Ft,Ft]),gt.useProgram("hillshadePrepare").draw(wt,St.TRIANGLES,ht,dt,mt,ro.disabled,((wn,kn)=>{const Fn=kn.stride,Hn=ct.H();return ct.aP(Hn,0,ct.X,-ct.X,0,0,1),ct.J(Hn,Hn,[0,-ct.X,0]),{u_matrix:Hn,u_image:1,u_dimension:[Fn,Fn],u_zoom:wn.overscaledZ,u_unpack:kn.getUnpackVector()}})(tt.tileID,Tt),null,ot.id,gt.rasterBoundsBuffer,gt.quadTriangleIndexBuffer,gt.rasterBoundsSegments),tt.needsHillshadePrepare=!1}}function Rm(gt,tt,ot,ht,dt,mt){const wt=ht.paint.get("raster-fade-duration");if(!mt&&wt>0){const St=Lt.now(),Tt=(St-gt.timeAdded)/wt,Ft=tt?(St-tt.timeAdded)/wt:-1,Gt=ot.getSource(),Xt=dt.coveringZoomLevel({tileSize:Gt.tileSize,roundZoom:Gt.roundZoom}),pn=!tt||Math.abs(tt.tileID.overscaledZ-Xt)>Math.abs(gt.tileID.overscaledZ-Xt),wn=pn&&gt.refreshedUponExpiration?1:ct.ac(pn?Tt:1-Ft,0,1);return gt.refreshedUponExpiration&&Tt>=1&&(gt.refreshedUponExpiration=!1),tt?{opacity:1,mix:1-wn}:{opacity:wn,mix:0}}return{opacity:1,mix:0}}const Sp=new ct.aM(1,0,0,1),bo=new ct.aM(0,1,0,1),qp=new ct.aM(0,0,1,1),m_=new ct.aM(1,0,1,1),Mm=new ct.aM(0,1,1,1);function Zl(gt,tt,ot,ht){Ap(gt,0,tt+ot/2,gt.transform.width,ot,ht)}function Im(gt,tt,ot,ht){Ap(gt,tt-ot/2,0,ot,gt.transform.height,ht)}function Ap(gt,tt,ot,ht,dt,mt){const wt=gt.context,St=wt.gl;St.enable(St.SCISSOR_TEST),St.scissor(tt*gt.pixelRatio,ot*gt.pixelRatio,ht*gt.pixelRatio,dt*gt.pixelRatio),wt.clear({color:mt}),St.disable(St.SCISSOR_TEST)}function mm(gt,tt,ot){const ht=gt.context,dt=ht.gl,mt=ot.posMatrix,wt=gt.useProgram("debug"),St=$s.disabled,Tt=vs.disabled,Ft=gt.colorModeForRenderPass(),Gt="$debug",Xt=gt.style.map.terrain&&gt.style.map.terrain.getTerrainData(ot);ht.activeTexture.set(dt.TEXTURE0);const pn=tt.getTileByID(ot.key).latestRawTileData,wn=Math.floor((pn&&pn.byteLength||0)/1024),kn=tt.getTile(ot).tileSize,Fn=512/Math.min(kn,512)*(ot.overscaledZ/gt.transform.zoom)*.5;let Hn=ot.canonical.toString();ot.overscaledZ!==ot.canonical.z&&(Hn+=` => ${ot.overscaledZ}`),function(Gn,Qn){Gn.initDebugOverlayCanvas();const Dn=Gn.debugOverlayCanvas,ar=Gn.context.gl,mr=Gn.debugOverlayCanvas.getContext("2d");mr.clearRect(0,0,Dn.width,Dn.height),mr.shadowColor="white",mr.shadowBlur=2,mr.lineWidth=1.5,mr.strokeStyle="white",mr.textBaseline="top",mr.font="bold 36px Open Sans, sans-serif",mr.fillText(Qn,5,5),mr.strokeText(Qn,5,5),Gn.debugOverlayTexture.update(Dn),Gn.debugOverlayTexture.bind(ar.LINEAR,ar.CLAMP_TO_EDGE)}(gt,`${Hn} ${wn}kB`),wt.draw(ht,dt.TRIANGLES,St,Tt,to.alphaBlended,ro.disabled,Ju(mt,ct.aM.transparent,Fn),null,Gt,gt.debugBuffer,gt.quadTriangleIndexBuffer,gt.debugSegments),wt.draw(ht,dt.LINE_STRIP,St,Tt,Ft,ro.disabled,Ju(mt,ct.aM.red),Xt,Gt,gt.debugBuffer,gt.tileBorderIndexBuffer,gt.debugSegments)}function Gp(gt,tt,ot){const ht=gt.context,dt=ht.gl,mt=gt.colorModeForRenderPass(),wt=new $s(dt.LEQUAL,$s.ReadWrite,gt.depthRangeFor3D),St=gt.useProgram("terrain"),Tt=tt.getTerrainMesh();ht.bindFramebuffer.set(null),ht.viewport.set([0,0,gt.width,gt.height]);for(const Ft of ot){const Gt=gt.renderToTexture.getTexture(Ft),Xt=tt.getTerrainData(Ft.tileID);ht.activeTexture.set(dt.TEXTURE0),dt.bindTexture(dt.TEXTURE_2D,Gt.texture);const pn=gt.transform.calculatePosMatrix(Ft.tileID.toUnwrapped()),wn=tt.getMeshFrameDelta(gt.transform.zoom),kn=gt.transform.calculateFogMatrix(Ft.tileID.toUnwrapped()),Fn=dm(pn,wn,kn,gt.style.sky,gt.transform.pitch);St.draw(ht,dt.TRIANGLES,wt,vs.disabled,mt,ro.backCCW,Fn,Xt,"terrain",Tt.vertexBuffer,Tt.indexBuffer,Tt.segments)}}class Tp{constructor(tt,ot,ht){this.vertexBuffer=tt,this.indexBuffer=ot,this.segments=ht}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Cp{constructor(tt,ot){this.context=new Ro(tt),this.transform=ot,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:ct.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=tr.maxUnderzooming+tr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new yp}resize(tt,ot,ht){if(this.width=Math.floor(tt*ht),this.height=Math.floor(ot*ht),this.pixelRatio=ht,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const dt of this.style._order)this.style._layers[dt].resize()}setup(){const tt=this.context,ot=new ct.aX;ot.emplaceBack(0,0),ot.emplaceBack(ct.X,0),ot.emplaceBack(0,ct.X),ot.emplaceBack(ct.X,ct.X),this.tileExtentBuffer=tt.createVertexBuffer(ot,ju.members),this.tileExtentSegments=ct.a0.simpleSegment(0,0,4,2);const ht=new ct.aX;ht.emplaceBack(0,0),ht.emplaceBack(ct.X,0),ht.emplaceBack(0,ct.X),ht.emplaceBack(ct.X,ct.X),this.debugBuffer=tt.createVertexBuffer(ht,ju.members),this.debugSegments=ct.a0.simpleSegment(0,0,4,5);const dt=new ct.$;dt.emplaceBack(0,0,0,0),dt.emplaceBack(ct.X,0,ct.X,0),dt.emplaceBack(0,ct.X,0,ct.X),dt.emplaceBack(ct.X,ct.X,ct.X,ct.X),this.rasterBoundsBuffer=tt.createVertexBuffer(dt,Lr.members),this.rasterBoundsSegments=ct.a0.simpleSegment(0,0,4,2);const mt=new ct.aX;mt.emplaceBack(0,0),mt.emplaceBack(1,0),mt.emplaceBack(0,1),mt.emplaceBack(1,1),this.viewportBuffer=tt.createVertexBuffer(mt,ju.members),this.viewportSegments=ct.a0.simpleSegment(0,0,4,2);const wt=new ct.aZ;wt.emplaceBack(0),wt.emplaceBack(1),wt.emplaceBack(3),wt.emplaceBack(2),wt.emplaceBack(0),this.tileBorderIndexBuffer=tt.createIndexBuffer(wt);const St=new ct.aY;St.emplaceBack(0,1,2),St.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=tt.createIndexBuffer(St);const Tt=this.context.gl;this.stencilClearMode=new vs({func:Tt.ALWAYS,mask:0},0,255,Tt.ZERO,Tt.ZERO,Tt.ZERO)}clearStencil(){const tt=this.context,ot=tt.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const ht=ct.H();ct.aP(ht,0,this.width,this.height,0,0,1),ct.K(ht,ht,[ot.drawingBufferWidth,ot.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(tt,ot.TRIANGLES,$s.disabled,this.stencilClearMode,to.disabled,ro.disabled,Fl(ht),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(tt,ot){if(this.currentStencilSource===tt.source||!tt.isTileClipped()||!ot||!ot.length)return;this.currentStencilSource=tt.source;const ht=this.context,dt=ht.gl;this.nextStencilID+ot.length>256&&this.clearStencil(),ht.setColorMode(to.disabled),ht.setDepthMode($s.disabled);const mt=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const wt of ot){const St=this._tileClippingMaskIDs[wt.key]=this.nextStencilID++,Tt=this.style.map.terrain&&this.style.map.terrain.getTerrainData(wt);mt.draw(ht,dt.TRIANGLES,$s.disabled,new vs({func:dt.ALWAYS,mask:0},St,255,dt.KEEP,dt.KEEP,dt.REPLACE),to.disabled,ro.disabled,Fl(wt.posMatrix),Tt,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const tt=this.nextStencilID++,ot=this.context.gl;return new vs({func:ot.NOTEQUAL,mask:255},tt,255,ot.KEEP,ot.KEEP,ot.REPLACE)}stencilModeForClipping(tt){const ot=this.context.gl;return new vs({func:ot.EQUAL,mask:255},this._tileClippingMaskIDs[tt.key],0,ot.KEEP,ot.KEEP,ot.REPLACE)}stencilConfigForOverlap(tt){const ot=this.context.gl,ht=tt.sort((wt,St)=>St.overscaledZ-wt.overscaledZ),dt=ht[ht.length-1].overscaledZ,mt=ht[0].overscaledZ-dt+1;if(mt>1){this.currentStencilSource=void 0,this.nextStencilID+mt>256&&this.clearStencil();const wt={};for(let St=0;St<mt;St++)wt[St+dt]=new vs({func:ot.GEQUAL,mask:255},St+this.nextStencilID,255,ot.KEEP,ot.KEEP,ot.REPLACE);return this.nextStencilID+=mt,[wt,ht]}return[{[dt]:vs.disabled},ht]}colorModeForRenderPass(){const tt=this.context.gl;return this._showOverdrawInspector?new to([tt.CONSTANT_COLOR,tt.ONE],new ct.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?to.unblended:to.alphaBlended}depthModeForSublayer(tt,ot,ht){if(!this.opaquePassEnabledForLayer())return $s.disabled;const dt=1-((1+this.currentLayer)*this.numSublayers+tt)*this.depthEpsilon;return new $s(ht||this.context.gl.LEQUAL,ot,[dt,dt])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(tt,ot){this.style=tt,this.options=ot,this.lineAtlas=tt.lineAtlas,this.imageManager=tt.imageManager,this.glyphManager=tt.glyphManager,this.symbolFadeChange=tt.placement.symbolFadeChange(Lt.now()),this.imageManager.beginFrame();const ht=this.style._order,dt=this.style.sourceCaches,mt={},wt={},St={};for(const Tt in dt){const Ft=dt[Tt];Ft.used&&Ft.prepare(this.context),mt[Tt]=Ft.getVisibleCoordinates(),wt[Tt]=mt[Tt].slice().reverse(),St[Tt]=Ft.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Tt=0;Tt<ht.length;Tt++)if(this.style._layers[ht[Tt]].is3D()){this.opaquePassCutoff=Tt;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Tt of ht){const Ft=this.style._layers[Tt];if(!Ft.hasOffscreenPass()||Ft.isHidden(this.transform.zoom))continue;const Gt=wt[Ft.source];(Ft.type==="custom"||Gt.length)&&this.renderLayer(this,dt[Ft.source],Ft,Gt)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:ot.showOverdrawInspector?ct.aM.black:ct.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(Tt,Ft){const Gt=Tt.context,Xt=Gt.gl,pn=((Gn,Qn,Dn)=>({u_sky_color:Gn.properties.get("sky-color"),u_horizon_color:Gn.properties.get("horizon-color"),u_horizon:(Qn.height/2+Qn.getHorizon())*Dn,u_sky_horizon_blend:Gn.properties.get("sky-horizon-blend")*Qn.height/2*Dn}))(Ft,Tt.style.map.transform,Tt.pixelRatio),wn=new $s(Xt.LEQUAL,$s.ReadWrite,[0,1]),kn=vs.disabled,Fn=Tt.colorModeForRenderPass(),Hn=Tt.useProgram("sky");if(!Ft.mesh){const Gn=new ct.aX;Gn.emplaceBack(-1,-1),Gn.emplaceBack(1,-1),Gn.emplaceBack(1,1),Gn.emplaceBack(-1,1);const Qn=new ct.aY;Qn.emplaceBack(0,1,2),Qn.emplaceBack(0,2,3),Ft.mesh=new Tp(Gt.createVertexBuffer(Gn,ju.members),Gt.createIndexBuffer(Qn),ct.a0.simpleSegment(0,0,Gn.length,Qn.length))}Hn.draw(Gt,Xt.TRIANGLES,wn,kn,Fn,ro.disabled,pn,void 0,"sky",Ft.mesh.vertexBuffer,Ft.mesh.indexBuffer,Ft.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=ot.showOverdrawInspector,this.depthRangeFor3D=[0,1-(tt._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=ht.length-1;this.currentLayer>=0;this.currentLayer--){const Tt=this.style._layers[ht[this.currentLayer]],Ft=dt[Tt.source],Gt=mt[Tt.source];this._renderTileClippingMasks(Tt,Gt),this.renderLayer(this,Ft,Tt,Gt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<ht.length;this.currentLayer++){const Tt=this.style._layers[ht[this.currentLayer]],Ft=dt[Tt.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Tt))continue;const Gt=(Tt.type==="symbol"?St:wt)[Tt.source];this._renderTileClippingMasks(Tt,mt[Tt.source]),this.renderLayer(this,Ft,Tt,Gt)}if(this.options.showTileBoundaries){const Tt=function(Ft,Gt){let Xt=null;const pn=Object.values(Ft._layers).flatMap(Hn=>Hn.source&&!Hn.isHidden(Gt)?[Ft.sourceCaches[Hn.source]]:[]),wn=pn.filter(Hn=>Hn.getSource().type==="vector"),kn=pn.filter(Hn=>Hn.getSource().type!=="vector"),Fn=Hn=>{(!Xt||Xt.getSource().maxzoom<Hn.getSource().maxzoom)&&(Xt=Hn)};return wn.forEach(Hn=>Fn(Hn)),Xt||kn.forEach(Hn=>Fn(Hn)),Xt}(this.style,this.transform.zoom);Tt&&function(Ft,Gt,Xt){for(let pn=0;pn<Xt.length;pn++)mm(Ft,Gt,Xt[pn])}(this,Tt,Tt.getVisibleCoordinates())}this.options.showPadding&&function(Tt){const Ft=Tt.transform.padding;Zl(Tt,Tt.transform.height-(Ft.top||0),3,Sp),Zl(Tt,Ft.bottom||0,3,bo),Im(Tt,Ft.left||0,3,qp),Im(Tt,Tt.transform.width-(Ft.right||0),3,m_);const Gt=Tt.transform.centerPoint;(function(Xt,pn,wn,kn){Ap(Xt,pn-1,wn-10,2,20,kn),Ap(Xt,pn-10,wn-1,20,2,kn)})(Tt,Gt.x,Tt.transform.height-Gt.y,Mm)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(tt){if(!this.style||!this.style.map||!this.style.map.terrain)return;const ot=this.terrainFacilitator.matrix,ht=this.transform.modelViewProjectionMatrix;let dt=this.terrainFacilitator.dirty;dt||(dt=tt?!ct.a_(ot,ht):!ct.a$(ot,ht)),dt||(dt=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),dt&&(ct.b0(ot,ht),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(mt,wt){const St=mt.context,Tt=St.gl,Ft=to.unblended,Gt=new $s(Tt.LEQUAL,$s.ReadWrite,[0,1]),Xt=wt.getTerrainMesh(),pn=wt.sourceCache.getRenderableTiles(),wn=mt.useProgram("terrainDepth");St.bindFramebuffer.set(wt.getFramebuffer("depth").framebuffer),St.viewport.set([0,0,mt.width/devicePixelRatio,mt.height/devicePixelRatio]),St.clear({color:ct.aM.transparent,depth:1});for(const kn of pn){const Fn=wt.getTerrainData(kn.tileID),Hn={u_matrix:mt.transform.calculatePosMatrix(kn.tileID.toUnwrapped()),u_ele_delta:wt.getMeshFrameDelta(mt.transform.zoom)};wn.draw(St,Tt.TRIANGLES,Gt,vs.disabled,Ft,ro.backCCW,Hn,Fn,"terrain",Xt.vertexBuffer,Xt.indexBuffer,Xt.segments)}St.bindFramebuffer.set(null),St.viewport.set([0,0,mt.width,mt.height])}(this,this.style.map.terrain),function(mt,wt){const St=mt.context,Tt=St.gl,Ft=to.unblended,Gt=new $s(Tt.LEQUAL,$s.ReadWrite,[0,1]),Xt=wt.getTerrainMesh(),pn=wt.getCoordsTexture(),wn=wt.sourceCache.getRenderableTiles(),kn=mt.useProgram("terrainCoords");St.bindFramebuffer.set(wt.getFramebuffer("coords").framebuffer),St.viewport.set([0,0,mt.width/devicePixelRatio,mt.height/devicePixelRatio]),St.clear({color:ct.aM.transparent,depth:1}),wt.coordsIndex=[];for(const Fn of wn){const Hn=wt.getTerrainData(Fn.tileID);St.activeTexture.set(Tt.TEXTURE0),Tt.bindTexture(Tt.TEXTURE_2D,pn.texture);const Gn={u_matrix:mt.transform.calculatePosMatrix(Fn.tileID.toUnwrapped()),u_terrain_coords_id:(255-wt.coordsIndex.length)/255,u_texture:0,u_ele_delta:wt.getMeshFrameDelta(mt.transform.zoom)};kn.draw(St,Tt.TRIANGLES,Gt,vs.disabled,Ft,ro.backCCW,Gn,Hn,"terrain",Xt.vertexBuffer,Xt.indexBuffer,Xt.segments),wt.coordsIndex.push(Fn.tileID.key)}St.bindFramebuffer.set(null),St.viewport.set([0,0,mt.width,mt.height])}(this,this.style.map.terrain))}renderLayer(tt,ot,ht,dt){if(!ht.isHidden(this.transform.zoom)&&(ht.type==="background"||ht.type==="custom"||(dt||[]).length))switch(this.id=ht.id,ht.type){case"symbol":(function(mt,wt,St,Tt,Ft){if(mt.renderPass!=="translucent")return;const Gt=vs.disabled,Xt=mt.colorModeForRenderPass();(St._unevaluatedLayout.hasValue("text-variable-anchor")||St._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(pn,wn,kn,Fn,Hn,Gn,Qn,Dn,ar){const mr=wn.transform,Ar=Bu(),Wr=Hn==="map",es=Gn==="map";for(const us of pn){const ys=Fn.getTile(us),os=ys.getBucket(kn);if(!os||!os.text||!os.text.segments.get().length)continue;const rs=ct.ag(os.textSizeData,mr.zoom),Rs=Fr(ys,1,wn.transform.zoom),no=lo(us.posMatrix,es,Wr,wn.transform,Rs),as=kn.layout.get("icon-text-fit")!=="none"&&os.hasIconData();if(rs){const ms=Math.pow(2,mr.zoom-ys.tileID.overscaledZ),Qs=wn.style.map.terrain?(co,mo)=>wn.style.map.terrain.getElevation(us,co,mo):null,Ho=Ar.translatePosition(mr,ys,Qn,Dn);fu(os,Wr,es,ar,mr,no,us.posMatrix,ms,rs,as,Ar,Ho,us.toUnwrapped(),Qs)}}}(Tt,mt,St,wt,St.layout.get("text-rotation-alignment"),St.layout.get("text-pitch-alignment"),St.paint.get("text-translate"),St.paint.get("text-translate-anchor"),Ft),St.paint.get("icon-opacity").constantOr(1)!==0&&Pu(mt,wt,St,Tt,!1,St.paint.get("icon-translate"),St.paint.get("icon-translate-anchor"),St.layout.get("icon-rotation-alignment"),St.layout.get("icon-pitch-alignment"),St.layout.get("icon-keep-upright"),Gt,Xt),St.paint.get("text-opacity").constantOr(1)!==0&&Pu(mt,wt,St,Tt,!0,St.paint.get("text-translate"),St.paint.get("text-translate-anchor"),St.layout.get("text-rotation-alignment"),St.layout.get("text-pitch-alignment"),St.layout.get("text-keep-upright"),Gt,Xt),wt.map.showCollisionBoxes&&(Po(mt,wt,St,Tt,!0),Po(mt,wt,St,Tt,!1))})(tt,ot,ht,dt,this.style.placement.variableOffsets);break;case"circle":(function(mt,wt,St,Tt){if(mt.renderPass!=="translucent")return;const Ft=St.paint.get("circle-opacity"),Gt=St.paint.get("circle-stroke-width"),Xt=St.paint.get("circle-stroke-opacity"),pn=!St.layout.get("circle-sort-key").isConstant();if(Ft.constantOr(1)===0&&(Gt.constantOr(1)===0||Xt.constantOr(1)===0))return;const wn=mt.context,kn=wn.gl,Fn=mt.depthModeForSublayer(0,$s.ReadOnly),Hn=vs.disabled,Gn=mt.colorModeForRenderPass(),Qn=[];for(let Dn=0;Dn<Tt.length;Dn++){const ar=Tt[Dn],mr=wt.getTile(ar),Ar=mr.getBucket(St);if(!Ar)continue;const Wr=Ar.programConfigurations.get(St.id),es=mt.useProgram("circle",Wr),us=Ar.layoutVertexBuffer,ys=Ar.indexBuffer,os=mt.style.map.terrain&&mt.style.map.terrain.getTerrainData(ar),rs={programConfiguration:Wr,program:es,layoutVertexBuffer:us,indexBuffer:ys,uniformValues:f_(mt,ar,mr,St),terrainData:os};if(pn){const Rs=Ar.segments.get();for(const no of Rs)Qn.push({segments:new ct.a0([no]),sortKey:no.sortKey,state:rs})}else Qn.push({segments:Ar.segments,sortKey:0,state:rs})}pn&&Qn.sort((Dn,ar)=>Dn.sortKey-ar.sortKey);for(const Dn of Qn){const{programConfiguration:ar,program:mr,layoutVertexBuffer:Ar,indexBuffer:Wr,uniformValues:es,terrainData:us}=Dn.state;mr.draw(wn,kn.TRIANGLES,Fn,Hn,Gn,ro.disabled,es,us,St.id,Ar,Wr,Dn.segments,St.paint,mt.transform.zoom,ar)}})(tt,ot,ht,dt);break;case"heatmap":(function(mt,wt,St,Tt){if(St.paint.get("heatmap-opacity")===0)return;const Ft=mt.context;if(mt.style.map.terrain){for(const Gt of Tt){const Xt=wt.getTile(Gt);wt.hasRenderableParent(Gt)||(mt.renderPass==="offscreen"?fm(mt,Xt,St,Gt):mt.renderPass==="translucent"&&_a(mt,St,Gt))}Ft.viewport.set([0,0,mt.width,mt.height])}else mt.renderPass==="offscreen"?function(Gt,Xt,pn,wn){const kn=Gt.context,Fn=kn.gl,Hn=vs.disabled,Gn=new to([Fn.ONE,Fn.ONE],ct.aM.transparent,[!0,!0,!0,!0]);(function(Qn,Dn,ar){const mr=Qn.gl;Qn.activeTexture.set(mr.TEXTURE1),Qn.viewport.set([0,0,Dn.width/4,Dn.height/4]);let Ar=ar.heatmapFbos.get(ct.aU);Ar?(mr.bindTexture(mr.TEXTURE_2D,Ar.colorAttachment.get()),Qn.bindFramebuffer.set(Ar.framebuffer)):(Ar=sp(Qn,Dn.width/4,Dn.height/4),ar.heatmapFbos.set(ct.aU,Ar))})(kn,Gt,pn),kn.clear({color:ct.aM.transparent});for(let Qn=0;Qn<wn.length;Qn++){const Dn=wn[Qn];if(Xt.hasRenderableParent(Dn))continue;const ar=Xt.getTile(Dn),mr=ar.getBucket(pn);if(!mr)continue;const Ar=mr.programConfigurations.get(pn.id),Wr=Gt.useProgram("heatmap",Ar),{zoom:es}=Gt.transform;Wr.draw(kn,Fn.TRIANGLES,$s.disabled,Hn,Gn,ro.disabled,Rl(Dn.posMatrix,ar,es,pn.paint.get("heatmap-intensity")),null,pn.id,mr.layoutVertexBuffer,mr.indexBuffer,mr.segments,pn.paint,Gt.transform.zoom,Ar)}kn.viewport.set([0,0,Gt.width,Gt.height])}(mt,wt,St,Tt):mt.renderPass==="translucent"&&function(Gt,Xt){const pn=Gt.context,wn=pn.gl;pn.setColorMode(Gt.colorModeForRenderPass());const kn=Xt.heatmapFbos.get(ct.aU);kn&&(pn.activeTexture.set(wn.TEXTURE0),wn.bindTexture(wn.TEXTURE_2D,kn.colorAttachment.get()),pn.activeTexture.set(wn.TEXTURE1),wp(pn,Xt).bind(wn.LINEAR,wn.CLAMP_TO_EDGE),Gt.useProgram("heatmapTexture").draw(pn,wn.TRIANGLES,$s.disabled,vs.disabled,Gt.colorModeForRenderPass(),ro.disabled,bp(Gt,Xt,0,1),null,Xt.id,Gt.viewportBuffer,Gt.quadTriangleIndexBuffer,Gt.viewportSegments,Xt.paint,Gt.transform.zoom))}(mt,St)})(tt,ot,ht,dt);break;case"line":(function(mt,wt,St,Tt){if(mt.renderPass!=="translucent")return;const Ft=St.paint.get("line-opacity"),Gt=St.paint.get("line-width");if(Ft.constantOr(1)===0||Gt.constantOr(1)===0)return;const Xt=mt.depthModeForSublayer(0,$s.ReadOnly),pn=mt.colorModeForRenderPass(),wn=St.paint.get("line-dasharray"),kn=St.paint.get("line-pattern"),Fn=kn.constantOr(1),Hn=St.paint.get("line-gradient"),Gn=St.getCrossfadeParameters(),Qn=Fn?"linePattern":wn?"lineSDF":Hn?"lineGradient":"line",Dn=mt.context,ar=Dn.gl;let mr=!0;for(const Ar of Tt){const Wr=wt.getTile(Ar);if(Fn&&!Wr.patternsLoaded())continue;const es=Wr.getBucket(St);if(!es)continue;const us=es.programConfigurations.get(St.id),ys=mt.context.program.get(),os=mt.useProgram(Qn,us),rs=mr||os.program!==ys,Rs=mt.style.map.terrain&&mt.style.map.terrain.getTerrainData(Ar),no=kn.constantOr(null);if(no&&Wr.imageAtlas){const Qs=Wr.imageAtlas,Ho=Qs.patternPositions[no.to.toString()],co=Qs.patternPositions[no.from.toString()];Ho&&co&&us.setConstantPatternPositions(Ho,co)}const as=Rs?Ar:null,ms=Fn?rp(mt,Wr,St,Gn,as):wn?Ut(mt,Wr,St,wn,Gn,as):Hn?Pm(mt,Wr,St,es.lineClipsArray.length,as):Wp(mt,Wr,St,as);if(Fn)Dn.activeTexture.set(ar.TEXTURE0),Wr.imageAtlasTexture.bind(ar.LINEAR,ar.CLAMP_TO_EDGE),us.updatePaintBuffers(Gn);else if(wn&&(rs||mt.lineAtlas.dirty))Dn.activeTexture.set(ar.TEXTURE0),mt.lineAtlas.bind(Dn);else if(Hn){const Qs=es.gradients[St.id];let Ho=Qs.texture;if(St.gradientVersion!==Qs.version){let co=256;if(St.stepInterpolant){const mo=wt.getSource().maxzoom,Wo=Ar.canonical.z===mo?Math.ceil(1<<mt.transform.maxZoom-Ar.canonical.z):1;co=ct.ac(ct.aV(es.maxLineLength/ct.X*1024*Wo),256,Dn.maxTextureSize)}Qs.gradient=ct.aW({expression:St.gradientExpression(),evaluationKey:"lineProgress",resolution:co,image:Qs.gradient||void 0,clips:es.lineClipsArray}),Qs.texture?Qs.texture.update(Qs.gradient):Qs.texture=new fn(Dn,Qs.gradient,ar.RGBA),Qs.version=St.gradientVersion,Ho=Qs.texture}Dn.activeTexture.set(ar.TEXTURE0),Ho.bind(St.stepInterpolant?ar.NEAREST:ar.LINEAR,ar.CLAMP_TO_EDGE)}os.draw(Dn,ar.TRIANGLES,Xt,mt.stencilModeForClipping(Ar),pn,ro.disabled,ms,Rs,St.id,es.layoutVertexBuffer,es.indexBuffer,es.segments,St.paint,mt.transform.zoom,us,es.layoutVertexBuffer2),mr=!1}})(tt,ot,ht,dt);break;case"fill":(function(mt,wt,St,Tt){const Ft=St.paint.get("fill-color"),Gt=St.paint.get("fill-opacity");if(Gt.constantOr(1)===0)return;const Xt=mt.colorModeForRenderPass(),pn=St.paint.get("fill-pattern"),wn=mt.opaquePassEnabledForLayer()&&!pn.constantOr(1)&&Ft.constantOr(ct.aM.transparent).a===1&&Gt.constantOr(0)===1?"opaque":"translucent";if(mt.renderPass===wn){const kn=mt.depthModeForSublayer(1,mt.renderPass==="opaque"?$s.ReadWrite:$s.ReadOnly);Ep(mt,wt,St,Tt,kn,Xt,!1)}if(mt.renderPass==="translucent"&&St.paint.get("fill-antialias")){const kn=mt.depthModeForSublayer(St.getPaintProperty("fill-outline-color")?2:0,$s.ReadOnly);Ep(mt,wt,St,Tt,kn,Xt,!0)}})(tt,ot,ht,dt);break;case"fill-extrusion":(function(mt,wt,St,Tt){const Ft=St.paint.get("fill-extrusion-opacity");if(Ft!==0&&mt.renderPass==="translucent"){const Gt=new $s(mt.context.gl.LEQUAL,$s.ReadWrite,mt.depthRangeFor3D);if(Ft!==1||St.paint.get("fill-extrusion-pattern").constantOr(1))mu(mt,wt,St,Tt,Gt,vs.disabled,to.disabled),mu(mt,wt,St,Tt,Gt,mt.stencilModeFor3D(),mt.colorModeForRenderPass());else{const Xt=mt.colorModeForRenderPass();mu(mt,wt,St,Tt,Gt,vs.disabled,Xt)}}})(tt,ot,ht,dt);break;case"hillshade":(function(mt,wt,St,Tt){if(mt.renderPass!=="offscreen"&&mt.renderPass!=="translucent")return;const Ft=mt.context,Gt=mt.depthModeForSublayer(0,$s.ReadOnly),Xt=mt.colorModeForRenderPass(),[pn,wn]=mt.renderPass==="translucent"?mt.stencilConfigForOverlap(Tt):[{},Tt];for(const kn of wn){const Fn=wt.getTile(kn);Fn.needsHillshadePrepare!==void 0&&Fn.needsHillshadePrepare&&mt.renderPass==="offscreen"?ap(mt,Fn,St,Gt,vs.disabled,Xt):mt.renderPass==="translucent"&&op(mt,kn,Fn,St,Gt,pn[kn.overscaledZ],Xt)}Ft.viewport.set([0,0,mt.width,mt.height])})(tt,ot,ht,dt);break;case"raster":(function(mt,wt,St,Tt){if(mt.renderPass!=="translucent"||St.paint.get("raster-opacity")===0||!Tt.length)return;const Ft=mt.context,Gt=Ft.gl,Xt=wt.getSource(),pn=mt.useProgram("raster"),wn=mt.colorModeForRenderPass(),[kn,Fn]=Xt instanceof hr?[{},Tt]:mt.stencilConfigForOverlap(Tt),Hn=Fn[Fn.length-1].overscaledZ,Gn=!mt.options.moving;for(const Qn of Fn){const Dn=mt.depthModeForSublayer(Qn.overscaledZ-Hn,St.paint.get("raster-opacity")===1?$s.ReadWrite:$s.ReadOnly,Gt.LESS),ar=wt.getTile(Qn);ar.registerFadeDuration(St.paint.get("raster-fade-duration"));const mr=wt.findLoadedParent(Qn,0),Ar=wt.findLoadedSibling(Qn),Wr=Rm(ar,mr||Ar||null,wt,St,mt.transform,mt.style.map.terrain);let es,us;const ys=St.paint.get("raster-resampling")==="nearest"?Gt.NEAREST:Gt.LINEAR;Ft.activeTexture.set(Gt.TEXTURE0),ar.texture.bind(ys,Gt.CLAMP_TO_EDGE,Gt.LINEAR_MIPMAP_NEAREST),Ft.activeTexture.set(Gt.TEXTURE1),mr?(mr.texture.bind(ys,Gt.CLAMP_TO_EDGE,Gt.LINEAR_MIPMAP_NEAREST),es=Math.pow(2,mr.tileID.overscaledZ-ar.tileID.overscaledZ),us=[ar.tileID.canonical.x*es%1,ar.tileID.canonical.y*es%1]):ar.texture.bind(ys,Gt.CLAMP_TO_EDGE,Gt.LINEAR_MIPMAP_NEAREST),ar.texture.useMipmap&&Ft.extTextureFilterAnisotropic&&mt.transform.pitch>20&&Gt.texParameterf(Gt.TEXTURE_2D,Ft.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Ft.extTextureFilterAnisotropicMax);const os=mt.style.map.terrain&&mt.style.map.terrain.getTerrainData(Qn),rs=os?Qn:null,Rs=rs?rs.posMatrix:mt.transform.calculatePosMatrix(Qn.toUnwrapped(),Gn),no=$n(Rs,us||[0,0],es||1,Wr,St);Xt instanceof hr?pn.draw(Ft,Gt.TRIANGLES,Dn,vs.disabled,wn,ro.disabled,no,os,St.id,Xt.boundsBuffer,mt.quadTriangleIndexBuffer,Xt.boundsSegments):pn.draw(Ft,Gt.TRIANGLES,Dn,kn[Qn.overscaledZ],wn,ro.disabled,no,os,St.id,mt.rasterBoundsBuffer,mt.quadTriangleIndexBuffer,mt.rasterBoundsSegments)}})(tt,ot,ht,dt);break;case"background":(function(mt,wt,St,Tt){const Ft=St.paint.get("background-color"),Gt=St.paint.get("background-opacity");if(Gt===0)return;const Xt=mt.context,pn=Xt.gl,wn=mt.transform,kn=wn.tileSize,Fn=St.paint.get("background-pattern");if(mt.isPatternMissing(Fn))return;const Hn=!Fn&&Ft.a===1&&Gt===1&&mt.opaquePassEnabledForLayer()?"opaque":"translucent";if(mt.renderPass!==Hn)return;const Gn=vs.disabled,Qn=mt.depthModeForSublayer(0,Hn==="opaque"?$s.ReadWrite:$s.ReadOnly),Dn=mt.colorModeForRenderPass(),ar=mt.useProgram(Fn?"backgroundPattern":"background"),mr=Tt||wn.coveringTiles({tileSize:kn,terrain:mt.style.map.terrain});Fn&&(Xt.activeTexture.set(pn.TEXTURE0),mt.imageManager.bind(mt.context));const Ar=St.getCrossfadeParameters();for(const Wr of mr){const es=Tt?Wr.posMatrix:mt.transform.calculatePosMatrix(Wr.toUnwrapped()),us=Fn?pr(es,Gt,mt,Fn,{tileID:Wr,tileSize:kn},Ar):Un(es,Gt,Ft),ys=mt.style.map.terrain&&mt.style.map.terrain.getTerrainData(Wr);ar.draw(Xt,pn.TRIANGLES,Qn,Gn,Dn,ro.disabled,us,ys,St.id,mt.tileExtentBuffer,mt.quadTriangleIndexBuffer,mt.tileExtentSegments)}})(tt,0,ht,dt);break;case"custom":(function(mt,wt,St){const Tt=mt.context,Ft=St.implementation;if(mt.renderPass==="offscreen"){const Gt=Ft.prerender;Gt&&(mt.setCustomLayerDefaults(),Tt.setColorMode(mt.colorModeForRenderPass()),Gt.call(Ft,Tt.gl,mt.transform.customLayerMatrix()),Tt.setDirty(),mt.setBaseState())}else if(mt.renderPass==="translucent"){mt.setCustomLayerDefaults(),Tt.setColorMode(mt.colorModeForRenderPass()),Tt.setStencilMode(vs.disabled);const Gt=Ft.renderingMode==="3d"?new $s(mt.context.gl.LEQUAL,$s.ReadWrite,mt.depthRangeFor3D):mt.depthModeForSublayer(0,$s.ReadOnly);Tt.setDepthMode(Gt),Ft.render(Tt.gl,mt.transform.customLayerMatrix(),{farZ:mt.transform.farZ,nearZ:mt.transform.nearZ,fov:mt.transform._fov,modelViewProjectionMatrix:mt.transform.modelViewProjectionMatrix,projectionMatrix:mt.transform.projectionMatrix}),Tt.setDirty(),mt.setBaseState(),Tt.bindFramebuffer.set(null)}})(tt,0,ht)}}translatePosMatrix(tt,ot,ht,dt,mt){if(!ht[0]&&!ht[1])return tt;const wt=mt?dt==="map"?this.transform.angle:0:dt==="viewport"?-this.transform.angle:0;if(wt){const Ft=Math.sin(wt),Gt=Math.cos(wt);ht=[ht[0]*Gt-ht[1]*Ft,ht[0]*Ft+ht[1]*Gt]}const St=[mt?ht[0]:Fr(ot,ht[0],this.transform.zoom),mt?ht[1]:Fr(ot,ht[1],this.transform.zoom),0],Tt=new Float32Array(16);return ct.J(Tt,tt,St),Tt}saveTileTexture(tt){const ot=this._tileTextures[tt.size[0]];ot?ot.push(tt):this._tileTextures[tt.size[0]]=[tt]}getTileTexture(tt){const ot=this._tileTextures[tt];return ot&&ot.length>0?ot.pop():null}isPatternMissing(tt){if(!tt)return!1;if(!tt.from||!tt.to)return!0;const ot=this.imageManager.getPattern(tt.from.toString()),ht=this.imageManager.getPattern(tt.to.toString());return!ot||!ht}useProgram(tt,ot){this.cache=this.cache||{};const ht=tt+(ot?ot.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[ht]||(this.cache[ht]=new Up(this.context,$u[tt],ot,ur[tt],this._showOverdrawInspector,this.style.map.terrain)),this.cache[ht]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const tt=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(tt.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new fn(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:tt,drawingBufferHeight:ot}=this.context.gl;return this.width!==tt||this.height!==ot}}class iu{constructor(tt,ot){this.points=tt,this.planes=ot}static fromInvProjectionMatrix(tt,ot,ht){const dt=Math.pow(2,ht),mt=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(St=>{const Tt=1/(St=ct.af([],St,tt))[3]/ot*dt;return ct.b1(St,St,[Tt,Tt,1/St[3],Tt])}),wt=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(St=>{const Tt=function(pn,wn){var kn=wn[0],Fn=wn[1],Hn=wn[2],Gn=kn*kn+Fn*Fn+Hn*Hn;return Gn>0&&(Gn=1/Math.sqrt(Gn)),pn[0]=wn[0]*Gn,pn[1]=wn[1]*Gn,pn[2]=wn[2]*Gn,pn}([],function(pn,wn,kn){var Fn=wn[0],Hn=wn[1],Gn=wn[2],Qn=kn[0],Dn=kn[1],ar=kn[2];return pn[0]=Hn*ar-Gn*Dn,pn[1]=Gn*Qn-Fn*ar,pn[2]=Fn*Dn-Hn*Qn,pn}([],mn([],mt[St[0]],mt[St[1]]),mn([],mt[St[2]],mt[St[1]]))),Ft=-((Gt=Tt)[0]*(Xt=mt[St[1]])[0]+Gt[1]*Xt[1]+Gt[2]*Xt[2]);var Gt,Xt;return Tt.concat(Ft)});return new iu(mt,wt)}}class lp{constructor(tt,ot){this.min=tt,this.max=ot,this.center=function(ht,dt,mt){return ht[0]=.5*dt[0],ht[1]=.5*dt[1],ht[2]=.5*dt[2],ht}([],function(ht,dt,mt){return ht[0]=dt[0]+mt[0],ht[1]=dt[1]+mt[1],ht[2]=dt[2]+mt[2],ht}([],this.min,this.max))}quadrant(tt){const ot=[tt%2==0,tt<2],ht=Ot(this.min),dt=Ot(this.max);for(let mt=0;mt<ot.length;mt++)ht[mt]=ot[mt]?this.min[mt]:this.center[mt],dt[mt]=ot[mt]?this.center[mt]:this.max[mt];return dt[2]=this.max[2],new lp(ht,dt)}distanceX(tt){return Math.max(Math.min(this.max[0],tt[0]),this.min[0])-tt[0]}distanceY(tt){return Math.max(Math.min(this.max[1],tt[1]),this.min[1])-tt[1]}intersects(tt){const ot=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let ht=!0;for(let dt=0;dt<tt.planes.length;dt++){const mt=tt.planes[dt];let wt=0;for(let St=0;St<ot.length;St++)ct.b2(mt,ot[St])>=0&&wt++;if(wt===0)return 0;wt!==ot.length&&(ht=!1)}if(ht)return 2;for(let dt=0;dt<3;dt++){let mt=Number.MAX_VALUE,wt=-Number.MAX_VALUE;for(let St=0;St<tt.points.length;St++){const Tt=tt.points[St][dt]-this.min[dt];mt=Math.min(mt,Tt),wt=Math.max(wt,Tt)}if(wt<0||mt>this.max[dt]-this.min[dt])return 0}return 1}}class cp{constructor(tt=0,ot=0,ht=0,dt=0){if(isNaN(tt)||tt<0||isNaN(ot)||ot<0||isNaN(ht)||ht<0||isNaN(dt)||dt<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=tt,this.bottom=ot,this.left=ht,this.right=dt}interpolate(tt,ot,ht){return ot.top!=null&&tt.top!=null&&(this.top=ct.y.number(tt.top,ot.top,ht)),ot.bottom!=null&&tt.bottom!=null&&(this.bottom=ct.y.number(tt.bottom,ot.bottom,ht)),ot.left!=null&&tt.left!=null&&(this.left=ct.y.number(tt.left,ot.left,ht)),ot.right!=null&&tt.right!=null&&(this.right=ct.y.number(tt.right,ot.right,ht)),this}getCenter(tt,ot){const ht=ct.ac((this.left+tt-this.right)/2,0,tt),dt=ct.ac((this.top+ot-this.bottom)/2,0,ot);return new ct.P(ht,dt)}equals(tt){return this.top===tt.top&&this.bottom===tt.bottom&&this.left===tt.left&&this.right===tt.right}clone(){return new cp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const kp=85.051129;class Uu{constructor(tt,ot,ht,dt,mt){this.tileSize=512,this._renderWorldCopies=mt===void 0||!!mt,this._minZoom=tt||0,this._maxZoom=ot||22,this._minPitch=ht??0,this._maxPitch=dt??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new ct.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new cp,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const tt=new Uu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return tt.apply(this),tt}apply(tt){this.tileSize=tt.tileSize,this.latRange=tt.latRange,this.lngRange=tt.lngRange,this.width=tt.width,this.height=tt.height,this._center=tt._center,this._elevation=tt._elevation,this.minElevationForCurrentTile=tt.minElevationForCurrentTile,this.zoom=tt.zoom,this.angle=tt.angle,this._fov=tt._fov,this._pitch=tt._pitch,this._unmodified=tt._unmodified,this._edgeInsets=tt._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(tt){this._minZoom!==tt&&(this._minZoom=tt,this.zoom=Math.max(this.zoom,tt))}get maxZoom(){return this._maxZoom}set maxZoom(tt){this._maxZoom!==tt&&(this._maxZoom=tt,this.zoom=Math.min(this.zoom,tt))}get minPitch(){return this._minPitch}set minPitch(tt){this._minPitch!==tt&&(this._minPitch=tt,this.pitch=Math.max(this.pitch,tt))}get maxPitch(){return this._maxPitch}set maxPitch(tt){this._maxPitch!==tt&&(this._maxPitch=tt,this.pitch=Math.min(this.pitch,tt))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(tt){tt===void 0?tt=!0:tt===null&&(tt=!1),this._renderWorldCopies=tt}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new ct.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(tt){const ot=-ct.b3(tt,-180,180)*Math.PI/180;this.angle!==ot&&(this._unmodified=!1,this.angle=ot,this._calcMatrices(),this.rotationMatrix=function(){var ht=new ct.A(4);return ct.A!=Float32Array&&(ht[1]=0,ht[2]=0),ht[0]=1,ht[3]=1,ht}(),function(ht,dt,mt){var wt=dt[0],St=dt[1],Tt=dt[2],Ft=dt[3],Gt=Math.sin(mt),Xt=Math.cos(mt);ht[0]=wt*Xt+Tt*Gt,ht[1]=St*Xt+Ft*Gt,ht[2]=wt*-Gt+Tt*Xt,ht[3]=St*-Gt+Ft*Xt}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(tt){const ot=ct.ac(tt,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==ot&&(this._unmodified=!1,this._pitch=ot,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(tt){tt=Math.max(.01,Math.min(60,tt)),this._fov!==tt&&(this._unmodified=!1,this._fov=tt/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(tt){const ot=Math.min(Math.max(tt,this.minZoom),this.maxZoom);this._zoom!==ot&&(this._unmodified=!1,this._zoom=ot,this.tileZoom=Math.max(0,Math.floor(ot)),this.scale=this.zoomScale(ot),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(tt){tt.lat===this._center.lat&&tt.lng===this._center.lng||(this._unmodified=!1,this._center=tt,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(tt){tt!==this._elevation&&(this._elevation=tt,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(tt){this._edgeInsets.equals(tt)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,tt,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(tt){return this._edgeInsets.equals(tt)}interpolatePadding(tt,ot,ht){this._unmodified=!1,this._edgeInsets.interpolate(tt,ot,ht),this._constrain(),this._calcMatrices()}coveringZoomLevel(tt){const ot=(tt.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/tt.tileSize));return Math.max(0,ot)}getVisibleUnwrappedCoordinates(tt){const ot=[new ct.b4(0,tt)];if(this._renderWorldCopies){const ht=this.pointCoordinate(new ct.P(0,0)),dt=this.pointCoordinate(new ct.P(this.width,0)),mt=this.pointCoordinate(new ct.P(this.width,this.height)),wt=this.pointCoordinate(new ct.P(0,this.height)),St=Math.floor(Math.min(ht.x,dt.x,mt.x,wt.x)),Tt=Math.floor(Math.max(ht.x,dt.x,mt.x,wt.x)),Ft=1;for(let Gt=St-Ft;Gt<=Tt+Ft;Gt++)Gt!==0&&ot.push(new ct.b4(Gt,tt))}return ot}coveringTiles(tt){var ot,ht;let dt=this.coveringZoomLevel(tt);const mt=dt;if(tt.minzoom!==void 0&&dt<tt.minzoom)return[];tt.maxzoom!==void 0&&dt>tt.maxzoom&&(dt=tt.maxzoom);const wt=this.pointCoordinate(this.getCameraPoint()),St=ct.Z.fromLngLat(this.center),Tt=Math.pow(2,dt),Ft=[Tt*wt.x,Tt*wt.y,0],Gt=[Tt*St.x,Tt*St.y,0],Xt=iu.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,dt);let pn=tt.minzoom||0;!tt.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(pn=dt);const wn=tt.terrain?2/Math.min(this.tileSize,tt.tileSize)*this.tileSize:3,kn=Dn=>({aabb:new lp([Dn*Tt,0,0],[(Dn+1)*Tt,Tt,0]),zoom:0,x:0,y:0,wrap:Dn,fullyVisible:!1}),Fn=[],Hn=[],Gn=dt,Qn=tt.reparseOverscaled?mt:dt;if(this._renderWorldCopies)for(let Dn=1;Dn<=3;Dn++)Fn.push(kn(-Dn)),Fn.push(kn(Dn));for(Fn.push(kn(0));Fn.length>0;){const Dn=Fn.pop(),ar=Dn.x,mr=Dn.y;let Ar=Dn.fullyVisible;if(!Ar){const os=Dn.aabb.intersects(Xt);if(os===0)continue;Ar=os===2}const Wr=tt.terrain?Ft:Gt,es=Dn.aabb.distanceX(Wr),us=Dn.aabb.distanceY(Wr),ys=Math.max(Math.abs(es),Math.abs(us));if(Dn.zoom===Gn||ys>wn+(1<<Gn-Dn.zoom)-2&&Dn.zoom>=pn){const os=Gn-Dn.zoom,rs=Ft[0]-.5-(ar<<os),Rs=Ft[1]-.5-(mr<<os);Hn.push({tileID:new ct.S(Dn.zoom===Gn?Qn:Dn.zoom,Dn.wrap,Dn.zoom,ar,mr),distanceSq:hn([Gt[0]-.5-ar,Gt[1]-.5-mr]),tileDistanceToCamera:Math.sqrt(rs*rs+Rs*Rs)})}else for(let os=0;os<4;os++){const rs=(ar<<1)+os%2,Rs=(mr<<1)+(os>>1),no=Dn.zoom+1;let as=Dn.aabb.quadrant(os);if(tt.terrain){const ms=new ct.S(no,Dn.wrap,no,rs,Rs),Qs=tt.terrain.getMinMaxElevation(ms),Ho=(ot=Qs.minElevation)!==null&&ot!==void 0?ot:this.elevation,co=(ht=Qs.maxElevation)!==null&&ht!==void 0?ht:this.elevation;as=new lp([as.min[0],as.min[1],Ho],[as.max[0],as.max[1],co])}Fn.push({aabb:as,zoom:no,x:rs,y:Rs,wrap:Dn.wrap,fullyVisible:Ar})}}return Hn.sort((Dn,ar)=>Dn.distanceSq-ar.distanceSq).map(Dn=>Dn.tileID)}resize(tt,ot){this.width=tt,this.height=ot,this.pixelsToGLUnits=[2/tt,-2/ot],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(tt){return Math.pow(2,tt)}scaleZoom(tt){return Math.log(tt)/Math.LN2}project(tt){const ot=ct.ac(tt.lat,-85.051129,kp);return new ct.P(ct.O(tt.lng)*this.worldSize,ct.Q(ot)*this.worldSize)}unproject(tt){return new ct.Z(tt.x/this.worldSize,tt.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(tt){const ot=this.elevation,ht=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,dt=this.pointLocation(this.centerPoint,tt),mt=tt.getElevationForLngLatZoom(dt,this.tileZoom);if(!(this.elevation-mt))return;const wt=ht+ot-mt,St=Math.cos(this._pitch)*this.cameraToCenterDistance/wt/ct.b5(1,dt.lat),Tt=this.scaleZoom(St/this.tileSize);this._elevation=mt,this._center=dt,this.zoom=Tt}setLocationAtPoint(tt,ot){const ht=this.pointCoordinate(ot),dt=this.pointCoordinate(this.centerPoint),mt=this.locationCoordinate(tt),wt=new ct.Z(mt.x-(ht.x-dt.x),mt.y-(ht.y-dt.y));this.center=this.coordinateLocation(wt),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(tt,ot){return ot?this.coordinatePoint(this.locationCoordinate(tt),ot.getElevationForLngLatZoom(tt,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(tt))}pointLocation(tt,ot){return this.coordinateLocation(this.pointCoordinate(tt,ot))}locationCoordinate(tt){return ct.Z.fromLngLat(tt)}coordinateLocation(tt){return tt&&tt.toLngLat()}pointCoordinate(tt,ot){if(ot){const pn=ot.pointCoordinate(tt);if(pn!=null)return pn}const ht=[tt.x,tt.y,0,1],dt=[tt.x,tt.y,1,1];ct.af(ht,ht,this.pixelMatrixInverse),ct.af(dt,dt,this.pixelMatrixInverse);const mt=ht[3],wt=dt[3],St=ht[1]/mt,Tt=dt[1]/wt,Ft=ht[2]/mt,Gt=dt[2]/wt,Xt=Ft===Gt?0:(0-Ft)/(Gt-Ft);return new ct.Z(ct.y.number(ht[0]/mt,dt[0]/wt,Xt)/this.worldSize,ct.y.number(St,Tt,Xt)/this.worldSize)}coordinatePoint(tt,ot=0,ht=this.pixelMatrix){const dt=[tt.x*this.worldSize,tt.y*this.worldSize,ot,1];return ct.af(dt,dt,ht),new ct.P(dt[0]/dt[3],dt[1]/dt[3])}getBounds(){const tt=Math.max(0,this.height/2-this.getHorizon());return new On().extend(this.pointLocation(new ct.P(0,tt))).extend(this.pointLocation(new ct.P(this.width,tt))).extend(this.pointLocation(new ct.P(this.width,this.height))).extend(this.pointLocation(new ct.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new On([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(tt){tt?(this.lngRange=[tt.getWest(),tt.getEast()],this.latRange=[tt.getSouth(),tt.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,kp])}calculateTileMatrix(tt){const ot=tt.canonical,ht=this.worldSize/this.zoomScale(ot.z),dt=ot.x+Math.pow(2,ot.z)*tt.wrap,mt=ct.an(new Float64Array(16));return ct.J(mt,mt,[dt*ht,ot.y*ht,0]),ct.K(mt,mt,[ht/ct.X,ht/ct.X,1]),mt}calculatePosMatrix(tt,ot=!1){const ht=tt.key,dt=ot?this._alignedPosMatrixCache:this._posMatrixCache;if(dt[ht])return dt[ht];const mt=this.calculateTileMatrix(tt);return ct.L(mt,ot?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,mt),dt[ht]=new Float32Array(mt),dt[ht]}calculateFogMatrix(tt){const ot=tt.key,ht=this._fogMatrixCache;if(ht[ot])return ht[ot];const dt=this.calculateTileMatrix(tt);return ct.L(dt,this.fogMatrix,dt),ht[ot]=new Float32Array(dt),ht[ot]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(tt,ot){ot=ct.ac(+ot,this.minZoom,this.maxZoom);const ht={center:new ct.N(tt.lng,tt.lat),zoom:ot};let dt=this.lngRange;if(!this._renderWorldCopies&&dt===null){const Dn=179.9999999999;dt=[-Dn,Dn]}const mt=this.tileSize*this.zoomScale(ht.zoom);let wt=0,St=mt,Tt=0,Ft=mt,Gt=0,Xt=0;const{x:pn,y:wn}=this.size;if(this.latRange){const Dn=this.latRange;wt=ct.Q(Dn[1])*mt,St=ct.Q(Dn[0])*mt,St-wt<wn&&(Gt=wn/(St-wt))}dt&&(Tt=ct.b3(ct.O(dt[0])*mt,0,mt),Ft=ct.b3(ct.O(dt[1])*mt,0,mt),Ft<Tt&&(Ft+=mt),Ft-Tt<pn&&(Xt=pn/(Ft-Tt)));const{x:kn,y:Fn}=this.project.call({worldSize:mt},tt);let Hn,Gn;const Qn=Math.max(Xt||0,Gt||0);if(Qn){const Dn=new ct.P(Xt?(Ft+Tt)/2:kn,Gt?(St+wt)/2:Fn);return ht.center=this.unproject.call({worldSize:mt},Dn).wrap(),ht.zoom+=this.scaleZoom(Qn),ht}if(this.latRange){const Dn=wn/2;Fn-Dn<wt&&(Gn=wt+Dn),Fn+Dn>St&&(Gn=St-Dn)}if(dt){const Dn=(Tt+Ft)/2;let ar=kn;this._renderWorldCopies&&(ar=ct.b3(kn,Dn-mt/2,Dn+mt/2));const mr=pn/2;ar-mr<Tt&&(Hn=Tt+mr),ar+mr>Ft&&(Hn=Ft-mr)}if(Hn!==void 0||Gn!==void 0){const Dn=new ct.P(Hn??kn,Gn??Fn);ht.center=this.unproject.call({worldSize:mt},Dn).wrap()}return ht}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const tt=this._unmodified,{center:ot,zoom:ht}=this.getConstrained(this.center,this.zoom);this.center=ot,this.zoom=ht,this._unmodified=tt,this._constraining=!1}_calcMatrices(){if(!this.height)return;const tt=this.centerOffset,ot=this.point.x,ht=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=ct.b5(1,this.center.lat)*this.worldSize;let dt=ct.an(new Float64Array(16));ct.K(dt,dt,[this.width/2,-this.height/2,1]),ct.J(dt,dt,[1,-1,0]),this.labelPlaneMatrix=dt,dt=ct.an(new Float64Array(16)),ct.K(dt,dt,[1,-1,1]),ct.J(dt,dt,[-1,-1,0]),ct.K(dt,dt,[2/this.width,2/this.height,1]),this.glCoordMatrix=dt;const mt=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),wt=Math.min(this.elevation,this.minElevationForCurrentTile),St=mt-wt*this._pixelPerMeter/Math.cos(this._pitch),Tt=wt<0?St:mt,Ft=Math.PI/2+this._pitch,Gt=this._fov*(.5+tt.y/this.height),Xt=Math.sin(Gt)*Tt/Math.sin(ct.ac(Math.PI-Ft-Gt,.01,Math.PI-.01)),pn=this.getHorizon(),wn=2*Math.atan(pn/this.cameraToCenterDistance)*(.5+tt.y/(2*pn)),kn=Math.sin(wn)*Tt/Math.sin(ct.ac(Math.PI-Ft-wn,.01,Math.PI-.01)),Fn=Math.min(Xt,kn);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Fn+Tt),this.nearZ=this.height/50,dt=new Float64Array(16),ct.b6(dt,this._fov,this.width/this.height,this.nearZ,this.farZ),dt[8]=2*-tt.x/this.width,dt[9]=2*tt.y/this.height,this.projectionMatrix=ct.ae(dt),ct.K(dt,dt,[1,-1,1]),ct.J(dt,dt,[0,0,-this.cameraToCenterDistance]),ct.b7(dt,dt,this._pitch),ct.ad(dt,dt,this.angle),ct.J(dt,dt,[-ot,-ht,0]),this.mercatorMatrix=ct.K([],dt,[this.worldSize,this.worldSize,this.worldSize]),ct.K(dt,dt,[1,1,this._pixelPerMeter]),this.pixelMatrix=ct.L(new Float64Array(16),this.labelPlaneMatrix,dt),ct.J(dt,dt,[0,0,-this.elevation]),this.modelViewProjectionMatrix=dt,this.invModelViewProjectionMatrix=ct.as([],dt),this.fogMatrix=new Float64Array(16),ct.b6(this.fogMatrix,this._fov,this.width/this.height,mt,this.farZ),this.fogMatrix[8]=2*-tt.x/this.width,this.fogMatrix[9]=2*tt.y/this.height,ct.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),ct.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),ct.b7(this.fogMatrix,this.fogMatrix,this._pitch),ct.ad(this.fogMatrix,this.fogMatrix,this.angle),ct.J(this.fogMatrix,this.fogMatrix,[-ot,-ht,0]),ct.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),ct.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=ct.L(new Float64Array(16),this.labelPlaneMatrix,dt);const Hn=this.width%2/2,Gn=this.height%2/2,Qn=Math.cos(this.angle),Dn=Math.sin(this.angle),ar=ot-Math.round(ot)+Qn*Hn+Dn*Gn,mr=ht-Math.round(ht)+Qn*Gn+Dn*Hn,Ar=new Float64Array(dt);if(ct.J(Ar,Ar,[ar>.5?ar-1:ar,mr>.5?mr-1:mr,0]),this.alignedModelViewProjectionMatrix=Ar,dt=ct.as(new Float64Array(16),this.pixelMatrix),!dt)throw new Error("failed to invert matrix");this.pixelMatrixInverse=dt,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const tt=this.pointCoordinate(new ct.P(0,0)),ot=[tt.x*this.worldSize,tt.y*this.worldSize,0,1];return ct.af(ot,ot,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const tt=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new ct.P(0,tt))}getCameraQueryGeometry(tt){const ot=this.getCameraPoint();if(tt.length===1)return[tt[0],ot];{let ht=ot.x,dt=ot.y,mt=ot.x,wt=ot.y;for(const St of tt)ht=Math.min(ht,St.x),dt=Math.min(dt,St.y),mt=Math.max(mt,St.x),wt=Math.max(wt,St.y);return[new ct.P(ht,dt),new ct.P(mt,dt),new ct.P(mt,wt),new ct.P(ht,wt),new ct.P(ht,dt)]}}lngLatToCameraDepth(tt,ot){const ht=this.locationCoordinate(tt),dt=[ht.x*this.worldSize,ht.y*this.worldSize,ot,1];return ct.af(dt,dt,this.modelViewProjectionMatrix),dt[2]/dt[3]}}function _h(gt,tt){let ot,ht=!1,dt=null,mt=null;const wt=()=>{dt=null,ht&&(gt.apply(mt,ot),dt=setTimeout(wt,tt),ht=!1)};return(...St)=>(ht=!0,mt=this,ot=St,dt||wt(),dt)}class Pp{constructor(tt){this._getCurrentHash=()=>{const ot=window.location.hash.replace("#","");if(this._hashName){let ht;return ot.split("&").map(dt=>dt.split("=")).forEach(dt=>{dt[0]===this._hashName&&(ht=dt)}),(ht&&ht[1]||"").split("/")}return ot.split("/")},this._onHashChange=()=>{const ot=this._getCurrentHash();if(ot.length>=3&&!ot.some(ht=>isNaN(ht))){const ht=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(ot[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+ot[2],+ot[1]],zoom:+ot[0],bearing:ht,pitch:+(ot[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const ot=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,ot)},this._removeHash=()=>{const ot=this._getCurrentHash();if(ot.length===0)return;const ht=ot.join("/");let dt=ht;dt.split("&").length>0&&(dt=dt.split("&")[0]),this._hashName&&(dt=`${this._hashName}=${ht}`);let mt=window.location.hash.replace(dt,"");mt.startsWith("#&")?mt=mt.slice(0,1)+mt.slice(2):mt==="#"&&(mt="");let wt=window.location.href.replace(/(#.+)?$/,mt);wt=wt.replace("&&","&"),window.history.replaceState(window.history.state,null,wt)},this._updateHash=_h(this._updateHashUnthrottled,300),this._hashName=tt&&encodeURIComponent(tt)}addTo(tt){return this._map=tt,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(tt){const ot=this._map.getCenter(),ht=Math.round(100*this._map.getZoom())/100,dt=Math.ceil((ht*Math.LN2+Math.log(512/360/.5))/Math.LN10),mt=Math.pow(10,dt),wt=Math.round(ot.lng*mt)/mt,St=Math.round(ot.lat*mt)/mt,Tt=this._map.getBearing(),Ft=this._map.getPitch();let Gt="";if(Gt+=tt?`/${wt}/${St}/${ht}`:`${ht}/${St}/${wt}`,(Tt||Ft)&&(Gt+="/"+Math.round(10*Tt)/10),Ft&&(Gt+=`/${Math.round(Ft)}`),this._hashName){const Xt=this._hashName;let pn=!1;const wn=window.location.hash.slice(1).split("&").map(kn=>{const Fn=kn.split("=")[0];return Fn===Xt?(pn=!0,`${Fn}=${Gt}`):kn}).filter(kn=>kn);return pn||wn.push(`${Xt}=${Gt}`),`#${wn.join("&")}`}return`#${Gt}`}}const Xp={linearity:.3,easing:ct.b8(0,0,.3,1)},Rp=ct.e({deceleration:2500,maxSpeed:1400},Xp),g_=ct.e({deceleration:20,maxSpeed:1400},Xp),Dm=ct.e({deceleration:1e3,maxSpeed:360},Xp),Mp=ct.e({deceleration:1e3,maxSpeed:90},Xp);class Xr{constructor(tt){this._map=tt,this.clear()}clear(){this._inertiaBuffer=[]}record(tt){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Lt.now(),settings:tt})}_drainInertiaBuffer(){const tt=this._inertiaBuffer,ot=Lt.now();for(;tt.length>0&&ot-tt[0].time>160;)tt.shift()}_onMoveEnd(tt){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const ot={zoom:0,bearing:0,pitch:0,pan:new ct.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:mt}of this._inertiaBuffer)ot.zoom+=mt.zoomDelta||0,ot.bearing+=mt.bearingDelta||0,ot.pitch+=mt.pitchDelta||0,mt.panDelta&&ot.pan._add(mt.panDelta),mt.around&&(ot.around=mt.around),mt.pinchAround&&(ot.pinchAround=mt.pinchAround);const ht=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,dt={};if(ot.pan.mag()){const mt=so(ot.pan.mag(),ht,ct.e({},Rp,tt||{}));dt.offset=ot.pan.mult(mt.amount/ot.pan.mag()),dt.center=this._map.transform.center,Ks(dt,mt)}if(ot.zoom){const mt=so(ot.zoom,ht,g_);dt.zoom=this._map.transform.zoom+mt.amount,Ks(dt,mt)}if(ot.bearing){const mt=so(ot.bearing,ht,Dm);dt.bearing=this._map.transform.bearing+ct.ac(mt.amount,-179,179),Ks(dt,mt)}if(ot.pitch){const mt=so(ot.pitch,ht,Mp);dt.pitch=this._map.transform.pitch+mt.amount,Ks(dt,mt)}if(dt.zoom||dt.bearing){const mt=ot.pinchAround===void 0?ot.around:ot.pinchAround;dt.around=mt?this._map.unproject(mt):this._map.getCenter()}return this.clear(),ct.e(dt,{noMoveStart:!0})}}function Ks(gt,tt){(!gt.duration||gt.duration<tt.duration)&&(gt.duration=tt.duration,gt.easing=tt.easing)}function so(gt,tt,ot){const{maxSpeed:ht,linearity:dt,deceleration:mt}=ot,wt=ct.ac(gt*dt/(tt/1e3),-ht,ht),St=Math.abs(wt)/(mt*dt);return{easing:ot.easing,duration:1e3*St,amount:wt*(St/2)}}class io extends ct.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(tt,ot,ht,dt={}){const mt=Mt.mousePos(ot.getCanvas(),ht),wt=ot.unproject(mt);super(tt,ct.e({point:mt,lngLat:wt,originalEvent:ht},dt)),this._defaultPrevented=!1,this.target=ot}}class ho extends ct.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(tt,ot,ht){const dt=tt==="touchend"?ht.changedTouches:ht.touches,mt=Mt.touchPos(ot.getCanvasContainer(),dt),wt=mt.map(Tt=>ot.unproject(Tt)),St=mt.reduce((Tt,Ft,Gt,Xt)=>Tt.add(Ft.div(Xt.length)),new ct.P(0,0));super(tt,{points:mt,point:St,lngLats:wt,lngLat:ot.unproject(St),originalEvent:ht}),this._defaultPrevented=!1}}class uo extends ct.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(tt,ot,ht){super(tt,{originalEvent:ht}),this._defaultPrevented=!1}}class Jo{constructor(tt,ot){this._map=tt,this._clickTolerance=ot.clickTolerance}reset(){delete this._mousedownPos}wheel(tt){return this._firePreventable(new uo(tt.type,this._map,tt))}mousedown(tt,ot){return this._mousedownPos=ot,this._firePreventable(new io(tt.type,this._map,tt))}mouseup(tt){this._map.fire(new io(tt.type,this._map,tt))}click(tt,ot){this._mousedownPos&&this._mousedownPos.dist(ot)>=this._clickTolerance||this._map.fire(new io(tt.type,this._map,tt))}dblclick(tt){return this._firePreventable(new io(tt.type,this._map,tt))}mouseover(tt){this._map.fire(new io(tt.type,this._map,tt))}mouseout(tt){this._map.fire(new io(tt.type,this._map,tt))}touchstart(tt){return this._firePreventable(new ho(tt.type,this._map,tt))}touchmove(tt){this._map.fire(new ho(tt.type,this._map,tt))}touchend(tt){this._map.fire(new ho(tt.type,this._map,tt))}touchcancel(tt){this._map.fire(new ho(tt.type,this._map,tt))}_firePreventable(tt){if(this._map.fire(tt),tt.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mo{constructor(tt){this._map=tt}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(tt){this._map.fire(new io(tt.type,this._map,tt))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new io("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(tt){this._delayContextMenu?this._contextMenuEvent=tt:this._ignoreContextMenu||this._map.fire(new io(tt.type,this._map,tt)),this._map.listens("contextmenu")&&tt.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kl{constructor(tt){this._map=tt}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(tt){return this.transform.pointLocation(ct.P.convert(tt),this._map.terrain)}}class El{constructor(tt,ot){this._map=tt,this._tr=new Kl(tt),this._el=tt.getCanvasContainer(),this._container=tt.getContainer(),this._clickTolerance=ot.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(tt,ot){this.isEnabled()&&tt.shiftKey&&tt.button===0&&(Mt.disableDrag(),this._startPos=this._lastPos=ot,this._active=!0)}mousemoveWindow(tt,ot){if(!this._active)return;const ht=ot;if(this._lastPos.equals(ht)||!this._box&&ht.dist(this._startPos)<this._clickTolerance)return;const dt=this._startPos;this._lastPos=ht,this._box||(this._box=Mt.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",tt));const mt=Math.min(dt.x,ht.x),wt=Math.max(dt.x,ht.x),St=Math.min(dt.y,ht.y),Tt=Math.max(dt.y,ht.y);Mt.setTransform(this._box,`translate(${mt}px,${St}px)`),this._box.style.width=wt-mt+"px",this._box.style.height=Tt-St+"px"}mouseupWindow(tt,ot){if(!this._active||tt.button!==0)return;const ht=this._startPos,dt=ot;if(this.reset(),Mt.suppressClick(),ht.x!==dt.x||ht.y!==dt.y)return this._map.fire(new ct.k("boxzoomend",{originalEvent:tt})),{cameraAnimation:mt=>mt.fitScreenCoordinates(ht,dt,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",tt)}keydown(tt){this._active&&tt.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",tt))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Mt.remove(this._box),this._box=null),Mt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(tt,ot){return this._map.fire(new ct.k(tt,{originalEvent:ot}))}}function ru(gt,tt){if(gt.length!==tt.length)throw new Error(`The number of touches and points are not equal - touches ${gt.length}, points ${tt.length}`);const ot={};for(let ht=0;ht<gt.length;ht++)ot[gt[ht].identifier]=tt[ht];return ot}class up{constructor(tt){this.reset(),this.numTouches=tt.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(tt,ot,ht){(this.centroid||ht.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=tt.timeStamp),ht.length===this.numTouches&&(this.centroid=function(dt){const mt=new ct.P(0,0);for(const wt of dt)mt._add(wt);return mt.div(dt.length)}(ot),this.touches=ru(ht,ot)))}touchmove(tt,ot,ht){if(this.aborted||!this.centroid)return;const dt=ru(ht,ot);for(const mt in this.touches){const wt=dt[mt];(!wt||wt.dist(this.touches[mt])>30)&&(this.aborted=!0)}}touchend(tt,ot,ht){if((!this.centroid||tt.timeStamp-this.startTime>500)&&(this.aborted=!0),ht.length===0){const dt=!this.aborted&&this.centroid;if(this.reset(),dt)return dt}}}class Ip{constructor(tt){this.singleTap=new up(tt),this.numTaps=tt.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(tt,ot,ht){this.singleTap.touchstart(tt,ot,ht)}touchmove(tt,ot,ht){this.singleTap.touchmove(tt,ot,ht)}touchend(tt,ot,ht){const dt=this.singleTap.touchend(tt,ot,ht);if(dt){const mt=tt.timeStamp-this.lastTime<500,wt=!this.lastTap||this.lastTap.dist(dt)<30;if(mt&&wt||this.reset(),this.count++,this.lastTime=tt.timeStamp,this.lastTap=dt,this.count===this.numTaps)return this.reset(),dt}}}class Ru{constructor(tt){this._tr=new Kl(tt),this._zoomIn=new Ip({numTouches:1,numTaps:2}),this._zoomOut=new Ip({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(tt,ot,ht){this._zoomIn.touchstart(tt,ot,ht),this._zoomOut.touchstart(tt,ot,ht)}touchmove(tt,ot,ht){this._zoomIn.touchmove(tt,ot,ht),this._zoomOut.touchmove(tt,ot,ht)}touchend(tt,ot,ht){const dt=this._zoomIn.touchend(tt,ot,ht),mt=this._zoomOut.touchend(tt,ot,ht),wt=this._tr;return dt?(this._active=!0,tt.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:St=>St.easeTo({duration:300,zoom:wt.zoom+1,around:wt.unproject(dt)},{originalEvent:tt})}):mt?(this._active=!0,tt.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:St=>St.easeTo({duration:300,zoom:wt.zoom-1,around:wt.unproject(mt)},{originalEvent:tt})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zl{constructor(tt){this._enabled=!!tt.enable,this._moveStateManager=tt.moveStateManager,this._clickTolerance=tt.clickTolerance||1,this._moveFunction=tt.move,this._activateOnStart=!!tt.activateOnStart,tt.assignEvents(this),this.reset()}reset(tt){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(tt)}_move(...tt){const ot=this._moveFunction(...tt);if(ot.bearingDelta||ot.pitchDelta||ot.around||ot.panDelta)return this._active=!0,ot}dragStart(tt,ot){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(tt)&&(this._moveStateManager.startMove(tt),this._lastPoint=ot.length?ot[0]:ot,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(tt,ot){if(!this.isEnabled())return;const ht=this._lastPoint;if(!ht)return;if(tt.preventDefault(),!this._moveStateManager.isValidMoveEvent(tt))return void this.reset(tt);const dt=ot.length?ot[0]:ot;return!this._moved&&dt.dist(ht)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=dt,this._move(ht,dt))}dragEnd(tt){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(tt)&&(this._moved&&Mt.suppressClick(),this.reset(tt))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const __={0:1,2:2};class Lm{constructor(tt){this._correctEvent=tt.checkCorrectEvent}startMove(tt){const ot=Mt.mouseButton(tt);this._eventButton=ot}endMove(tt){delete this._eventButton}isValidStartEvent(tt){return this._correctEvent(tt)}isValidMoveEvent(tt){return!function(ot,ht){const dt=__[ht];return ot.buttons===void 0||(ot.buttons&dt)!==dt}(tt,this._eventButton)}isValidEndEvent(tt){return Mt.mouseButton(tt)===this._eventButton}}class y_{constructor(){this._firstTouch=void 0}_isOneFingerTouch(tt){return tt.targetTouches.length===1}_isSameTouchEvent(tt){return tt.targetTouches[0].identifier===this._firstTouch}startMove(tt){this._firstTouch=tt.targetTouches[0].identifier}endMove(tt){delete this._firstTouch}isValidStartEvent(tt){return this._isOneFingerTouch(tt)}isValidMoveEvent(tt){return this._isOneFingerTouch(tt)&&this._isSameTouchEvent(tt)}isValidEndEvent(tt){return this._isOneFingerTouch(tt)&&this._isSameTouchEvent(tt)}}const Fm=gt=>{gt.mousedown=gt.dragStart,gt.mousemoveWindow=gt.dragMove,gt.mouseup=gt.dragEnd,gt.contextmenu=tt=>{tt.preventDefault()}},v_=({enable:gt,clickTolerance:tt,bearingDegreesPerPixelMoved:ot=.8})=>{const ht=new Lm({checkCorrectEvent:dt=>Mt.mouseButton(dt)===0&&dt.ctrlKey||Mt.mouseButton(dt)===2});return new zl({clickTolerance:tt,move:(dt,mt)=>({bearingDelta:(mt.x-dt.x)*ot}),moveStateManager:ht,enable:gt,assignEvents:Fm})},x_=({enable:gt,clickTolerance:tt,pitchDegreesPerPixelMoved:ot=-.5})=>{const ht=new Lm({checkCorrectEvent:dt=>Mt.mouseButton(dt)===0&&dt.ctrlKey||Mt.mouseButton(dt)===2});return new zl({clickTolerance:tt,move:(dt,mt)=>({pitchDelta:(mt.y-dt.y)*ot}),moveStateManager:ht,enable:gt,assignEvents:Fm})};class Dp{constructor(tt,ot){this._clickTolerance=tt.clickTolerance||1,this._map=ot,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new ct.P(0,0)}_shouldBePrevented(tt){return tt<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(tt,ot,ht){return this._calculateTransform(tt,ot,ht)}touchmove(tt,ot,ht){if(this._active){if(!this._shouldBePrevented(ht.length))return tt.preventDefault(),this._calculateTransform(tt,ot,ht);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",tt)}}touchend(tt,ot,ht){this._calculateTransform(tt,ot,ht),this._active&&this._shouldBePrevented(ht.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(tt,ot,ht){ht.length>0&&(this._active=!0);const dt=ru(ht,ot),mt=new ct.P(0,0),wt=new ct.P(0,0);let St=0;for(const Ft in dt){const Gt=dt[Ft],Xt=this._touches[Ft];Xt&&(mt._add(Gt),wt._add(Gt.sub(Xt)),St++,dt[Ft]=Gt)}if(this._touches=dt,this._shouldBePrevented(St)||!wt.mag())return;const Tt=wt.div(St);return this._sum._add(Tt),this._sum.mag()<this._clickTolerance?void 0:{around:mt.div(St),panDelta:Tt}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Om{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(tt,ot,ht){this._firstTwoTouches||ht.length<2||(this._firstTwoTouches=[ht[0].identifier,ht[1].identifier],this._start([ot[0],ot[1]]))}touchmove(tt,ot,ht){if(!this._firstTwoTouches)return;tt.preventDefault();const[dt,mt]=this._firstTwoTouches,wt=gm(ht,ot,dt),St=gm(ht,ot,mt);if(!wt||!St)return;const Tt=this._aroundCenter?null:wt.add(St).div(2);return this._move([wt,St],Tt,tt)}touchend(tt,ot,ht){if(!this._firstTwoTouches)return;const[dt,mt]=this._firstTwoTouches,wt=gm(ht,ot,dt),St=gm(ht,ot,mt);wt&&St||(this._active&&Mt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(tt){this._enabled=!0,this._aroundCenter=!!tt&&tt.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function gm(gt,tt,ot){for(let ht=0;ht<gt.length;ht++)if(gt[ht].identifier===ot)return tt[ht]}function b_(gt,tt){return Math.log(gt/tt)/Math.LN2}class w_ extends Om{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(tt){this._startDistance=this._distance=tt[0].dist(tt[1])}_move(tt,ot){const ht=this._distance;if(this._distance=tt[0].dist(tt[1]),this._active||!(Math.abs(b_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:b_(this._distance,ht),pinchAround:ot}}}function E_(gt,tt){return 180*gt.angleWith(tt)/Math.PI}class S_ extends Om{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(tt){this._startVector=this._vector=tt[0].sub(tt[1]),this._minDiameter=tt[0].dist(tt[1])}_move(tt,ot,ht){const dt=this._vector;if(this._vector=tt[0].sub(tt[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:E_(this._vector,dt),pinchAround:ot}}_isBelowThreshold(tt){this._minDiameter=Math.min(this._minDiameter,tt.mag());const ot=25/(Math.PI*this._minDiameter)*360,ht=E_(tt,this._startVector);return Math.abs(ht)<ot}}function zm(gt){return Math.abs(gt.y)>Math.abs(gt.x)}class Zp extends Om{constructor(tt){super(),this._currentTouchCount=0,this._map=tt}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(tt,ot,ht){super.touchstart(tt,ot,ht),this._currentTouchCount=ht.length}_start(tt){this._lastPoints=tt,zm(tt[0].sub(tt[1]))&&(this._valid=!1)}_move(tt,ot,ht){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const dt=tt[0].sub(this._lastPoints[0]),mt=tt[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(dt,mt,ht.timeStamp),this._valid?(this._lastPoints=tt,this._active=!0,{pitchDelta:(dt.y+mt.y)/2*-.5}):void 0}gestureBeginsVertically(tt,ot,ht){if(this._valid!==void 0)return this._valid;const dt=tt.mag()>=2,mt=ot.mag()>=2;if(!dt&&!mt)return;if(!dt||!mt)return this._firstMove===void 0&&(this._firstMove=ht),ht-this._firstMove<100&&void 0;const wt=tt.y>0==ot.y>0;return zm(tt)&&zm(ot)&&wt}}const ay={panStep:100,bearingStep:15,pitchStep:10};class wu{constructor(tt){this._tr=new Kl(tt);const ot=ay;this._panStep=ot.panStep,this._bearingStep=ot.bearingStep,this._pitchStep=ot.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(tt){if(tt.altKey||tt.ctrlKey||tt.metaKey)return;let ot=0,ht=0,dt=0,mt=0,wt=0;switch(tt.keyCode){case 61:case 107:case 171:case 187:ot=1;break;case 189:case 109:case 173:ot=-1;break;case 37:tt.shiftKey?ht=-1:(tt.preventDefault(),mt=-1);break;case 39:tt.shiftKey?ht=1:(tt.preventDefault(),mt=1);break;case 38:tt.shiftKey?dt=1:(tt.preventDefault(),wt=-1);break;case 40:tt.shiftKey?dt=-1:(tt.preventDefault(),wt=1);break;default:return}return this._rotationDisabled&&(ht=0,dt=0),{cameraAnimation:St=>{const Tt=this._tr;St.easeTo({duration:300,easeId:"keyboardHandler",easing:Vu,zoom:ot?Math.round(Tt.zoom)+ot*(tt.shiftKey?2:1):Tt.zoom,bearing:Tt.bearing+ht*this._bearingStep,pitch:Tt.pitch+dt*this._pitchStep,offset:[-mt*this._panStep,-wt*this._panStep],center:Tt.center},{originalEvent:tt})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Vu(gt){return gt*(2-gt)}const A_=4.000244140625;class Mu{constructor(tt,ot){this._onTimeout=ht=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(ht)},this._map=tt,this._tr=new Kl(tt),this._triggerRenderFrame=ot,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(tt){this._defaultZoomRate=tt}setWheelZoomRate(tt){this._wheelZoomRate=tt}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(tt){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!tt&&tt.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(tt){return!!this._map.cooperativeGestures.isEnabled()&&!(tt.ctrlKey||this._map.cooperativeGestures.isBypassed(tt))}wheel(tt){if(!this.isEnabled())return;if(this._shouldBePrevented(tt))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",tt);let ot=tt.deltaMode===WheelEvent.DOM_DELTA_LINE?40*tt.deltaY:tt.deltaY;const ht=Lt.now(),dt=ht-(this._lastWheelEventTime||0);this._lastWheelEventTime=ht,ot!==0&&ot%A_==0?this._type="wheel":ot!==0&&Math.abs(ot)<4?this._type="trackpad":dt>400?(this._type=null,this._lastValue=ot,this._timeout=setTimeout(this._onTimeout,40,tt)):this._type||(this._type=Math.abs(dt*ot)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,ot+=this._lastValue)),tt.shiftKey&&ot&&(ot/=4),this._type&&(this._lastWheelEvent=tt,this._delta-=ot,this._active||this._start(tt)),tt.preventDefault()}_start(tt){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const ot=Mt.mousePos(this._map.getCanvas(),tt),ht=this._tr;this._around=ot.y>ht.transform.height/2-ht.transform.getHorizon()?ct.N.convert(this._aroundCenter?ht.center:ht.unproject(ot)):ct.N.convert(ht.center),this._aroundPoint=ht.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const tt=this._tr.transform;if(this._delta!==0){const Tt=this._type==="wheel"&&Math.abs(this._delta)>A_?this._wheelZoomRate:this._defaultZoomRate;let Ft=2/(1+Math.exp(-Math.abs(this._delta*Tt)));this._delta<0&&Ft!==0&&(Ft=1/Ft);const Gt=typeof this._targetZoom=="number"?tt.zoomScale(this._targetZoom):tt.scale;this._targetZoom=Math.min(tt.maxZoom,Math.max(tt.minZoom,tt.scaleZoom(Gt*Ft))),this._type==="wheel"&&(this._startZoom=tt.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const ot=typeof this._targetZoom=="number"?this._targetZoom:tt.zoom,ht=this._startZoom,dt=this._easing;let mt,wt=!1;const St=Lt.now()-this._lastWheelEventTime;if(this._type==="wheel"&&ht&&dt&&St){const Tt=Math.min(St/200,1),Ft=dt(Tt);mt=ct.y.number(ht,ot,Ft),Tt<1?this._frameId||(this._frameId=!0):wt=!0}else mt=ot,wt=!0;return this._active=!0,wt&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!wt,zoomDelta:mt-tt.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(tt){let ot=ct.b9;if(this._prevEase){const ht=this._prevEase,dt=(Lt.now()-ht.start)/ht.duration,mt=ht.easing(dt+.01)-ht.easing(dt),wt=.27/Math.sqrt(mt*mt+1e-4)*.01,St=Math.sqrt(.0729-wt*wt);ot=ct.b8(wt,St,.25,1)}return this._prevEase={start:Lt.now(),duration:tt,easing:ot},ot}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Lp{constructor(tt,ot){this._clickZoom=tt,this._tapZoom=ot}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Jy{constructor(tt){this._tr=new Kl(tt),this.reset()}reset(){this._active=!1}dblclick(tt,ot){return tt.preventDefault(),{cameraAnimation:ht=>{ht.easeTo({duration:300,zoom:this._tr.zoom+(tt.shiftKey?-1:1),around:this._tr.unproject(ot)},{originalEvent:tt})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qy{constructor(){this._tap=new Ip({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(tt,ot,ht){if(!this._swipePoint)if(this._tapTime){const dt=ot[0],mt=tt.timeStamp-this._tapTime<500,wt=this._tapPoint.dist(dt)<30;mt&&wt?ht.length>0&&(this._swipePoint=dt,this._swipeTouch=ht[0].identifier):this.reset()}else this._tap.touchstart(tt,ot,ht)}touchmove(tt,ot,ht){if(this._tapTime){if(this._swipePoint){if(ht[0].identifier!==this._swipeTouch)return;const dt=ot[0],mt=dt.y-this._swipePoint.y;return this._swipePoint=dt,tt.preventDefault(),this._active=!0,{zoomDelta:mt/128}}}else this._tap.touchmove(tt,ot,ht)}touchend(tt,ot,ht){if(this._tapTime)this._swipePoint&&ht.length===0&&this.reset();else{const dt=this._tap.touchend(tt,ot,ht);dt&&(this._tapTime=tt.timeStamp,this._tapPoint=dt)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ly{constructor(tt,ot,ht){this._el=tt,this._mousePan=ot,this._touchPan=ht}enable(tt){this._inertiaOptions=tt||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class cy{constructor(tt,ot,ht){this._pitchWithRotate=tt.pitchWithRotate,this._mouseRotate=ot,this._mousePitch=ht}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class T_{constructor(tt,ot,ht,dt){this._el=tt,this._touchZoom=ot,this._touchRotate=ht,this._tapDragZoom=dt,this._rotationDisabled=!1,this._enabled=!0}enable(tt){this._touchZoom.enable(tt),this._rotationDisabled||this._touchRotate.enable(tt),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Kp{constructor(tt,ot){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=tt,this._options=ot,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const tt=this._map.getCanvasContainer();tt.classList.add("maplibregl-cooperative-gestures"),this._container=Mt.create("div","maplibregl-cooperative-gesture-screen",tt);let ot=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(ot=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const ht=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),dt=document.createElement("div");dt.className="maplibregl-desktop-message",dt.textContent=ot,this._container.appendChild(dt);const mt=document.createElement("div");mt.className="maplibregl-mobile-message",mt.textContent=ht,this._container.appendChild(mt),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Mt.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(tt){return tt[this._bypassKey]}notifyGestureBlocked(tt,ot){this._enabled&&(this._map.fire(new ct.k("cooperativegestureprevented",{gestureType:tt,originalEvent:ot})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Eu=gt=>gt.zoom||gt.drag||gt.pitch||gt.rotate;class bs extends ct.k{}function Nm(gt){return gt.panDelta&&gt.panDelta.mag()||gt.zoomDelta||gt.bearingDelta||gt.pitchDelta}class C_{constructor(tt,ot){this.handleWindowEvent=dt=>{this.handleEvent(dt,`${dt.type}Window`)},this.handleEvent=(dt,mt)=>{if(dt.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const wt=dt.type==="renderFrame"?void 0:dt,St={needsRenderFrame:!1},Tt={},Ft={},Gt=dt.touches,Xt=Gt?this._getMapTouches(Gt):void 0,pn=Xt?Mt.touchPos(this._map.getCanvas(),Xt):Mt.mousePos(this._map.getCanvas(),dt);for(const{handlerName:Fn,handler:Hn,allowed:Gn}of this._handlers){if(!Hn.isEnabled())continue;let Qn;this._blockedByActive(Ft,Gn,Fn)?Hn.reset():Hn[mt||dt.type]&&(Qn=Hn[mt||dt.type](dt,pn,Xt),this.mergeHandlerResult(St,Tt,Qn,Fn,wt),Qn&&Qn.needsRenderFrame&&this._triggerRenderFrame()),(Qn||Hn.isActive())&&(Ft[Fn]=Hn)}const wn={};for(const Fn in this._previousActiveHandlers)Ft[Fn]||(wn[Fn]=wt);this._previousActiveHandlers=Ft,(Object.keys(wn).length||Nm(St))&&(this._changes.push([St,Tt,wn]),this._triggerRenderFrame()),(Object.keys(Ft).length||Nm(St))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:kn}=St;kn&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],kn(this._map))},this._map=tt,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xr(tt),this._bearingSnap=ot.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(ot);const ht=this._el;this._listeners=[[ht,"touchstart",{passive:!0}],[ht,"touchmove",{passive:!1}],[ht,"touchend",void 0],[ht,"touchcancel",void 0],[ht,"mousedown",void 0],[ht,"mousemove",void 0],[ht,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[ht,"mouseover",void 0],[ht,"mouseout",void 0],[ht,"dblclick",void 0],[ht,"click",void 0],[ht,"keydown",{capture:!1}],[ht,"keyup",void 0],[ht,"wheel",{passive:!1}],[ht,"contextmenu",void 0],[window,"blur",void 0]];for(const[dt,mt,wt]of this._listeners)Mt.addEventListener(dt,mt,dt===document?this.handleWindowEvent:this.handleEvent,wt)}destroy(){for(const[tt,ot,ht]of this._listeners)Mt.removeEventListener(tt,ot,tt===document?this.handleWindowEvent:this.handleEvent,ht)}_addDefaultHandlers(tt){const ot=this._map,ht=ot.getCanvasContainer();this._add("mapEvent",new Jo(ot,tt));const dt=ot.boxZoom=new El(ot,tt);this._add("boxZoom",dt),tt.interactive&&tt.boxZoom&&dt.enable();const mt=ot.cooperativeGestures=new Kp(ot,tt.cooperativeGestures);this._add("cooperativeGestures",mt),tt.cooperativeGestures&&mt.enable();const wt=new Ru(ot),St=new Jy(ot);ot.doubleClickZoom=new Lp(St,wt),this._add("tapZoom",wt),this._add("clickZoom",St),tt.interactive&&tt.doubleClickZoom&&ot.doubleClickZoom.enable();const Tt=new Qy;this._add("tapDragZoom",Tt);const Ft=ot.touchPitch=new Zp(ot);this._add("touchPitch",Ft),tt.interactive&&tt.touchPitch&&ot.touchPitch.enable(tt.touchPitch);const Gt=v_(tt),Xt=x_(tt);ot.dragRotate=new cy(tt,Gt,Xt),this._add("mouseRotate",Gt,["mousePitch"]),this._add("mousePitch",Xt,["mouseRotate"]),tt.interactive&&tt.dragRotate&&ot.dragRotate.enable();const pn=(({enable:Qn,clickTolerance:Dn})=>{const ar=new Lm({checkCorrectEvent:mr=>Mt.mouseButton(mr)===0&&!mr.ctrlKey});return new zl({clickTolerance:Dn,move:(mr,Ar)=>({around:Ar,panDelta:Ar.sub(mr)}),activateOnStart:!0,moveStateManager:ar,enable:Qn,assignEvents:Fm})})(tt),wn=new Dp(tt,ot);ot.dragPan=new ly(ht,pn,wn),this._add("mousePan",pn),this._add("touchPan",wn,["touchZoom","touchRotate"]),tt.interactive&&tt.dragPan&&ot.dragPan.enable(tt.dragPan);const kn=new S_,Fn=new w_;ot.touchZoomRotate=new T_(ht,Fn,kn,Tt),this._add("touchRotate",kn,["touchPan","touchZoom"]),this._add("touchZoom",Fn,["touchPan","touchRotate"]),tt.interactive&&tt.touchZoomRotate&&ot.touchZoomRotate.enable(tt.touchZoomRotate);const Hn=ot.scrollZoom=new Mu(ot,()=>this._triggerRenderFrame());this._add("scrollZoom",Hn,["mousePan"]),tt.interactive&&tt.scrollZoom&&ot.scrollZoom.enable(tt.scrollZoom);const Gn=ot.keyboard=new wu(ot);this._add("keyboard",Gn),tt.interactive&&tt.keyboard&&ot.keyboard.enable(),this._add("blockableMapEvent",new Mo(ot))}_add(tt,ot,ht){this._handlers.push({handlerName:tt,handler:ot,allowed:ht}),this._handlersById[tt]=ot}stop(tt){if(!this._updatingCamera){for(const{handler:ot}of this._handlers)ot.reset();this._inertia.clear(),this._fireEvents({},{},tt),this._changes=[]}}isActive(){for(const{handler:tt}of this._handlers)if(tt.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Eu(this._eventsInProgress)||this.isZooming()}_blockedByActive(tt,ot,ht){for(const dt in tt)if(dt!==ht&&(!ot||ot.indexOf(dt)<0))return!0;return!1}_getMapTouches(tt){const ot=[];for(const ht of tt)this._el.contains(ht.target)&&ot.push(ht);return ot}mergeHandlerResult(tt,ot,ht,dt,mt){if(!ht)return;ct.e(tt,ht);const wt={handlerName:dt,originalEvent:ht.originalEvent||mt};ht.zoomDelta!==void 0&&(ot.zoom=wt),ht.panDelta!==void 0&&(ot.drag=wt),ht.pitchDelta!==void 0&&(ot.pitch=wt),ht.bearingDelta!==void 0&&(ot.rotate=wt)}_applyChanges(){const tt={},ot={},ht={};for(const[dt,mt,wt]of this._changes)dt.panDelta&&(tt.panDelta=(tt.panDelta||new ct.P(0,0))._add(dt.panDelta)),dt.zoomDelta&&(tt.zoomDelta=(tt.zoomDelta||0)+dt.zoomDelta),dt.bearingDelta&&(tt.bearingDelta=(tt.bearingDelta||0)+dt.bearingDelta),dt.pitchDelta&&(tt.pitchDelta=(tt.pitchDelta||0)+dt.pitchDelta),dt.around!==void 0&&(tt.around=dt.around),dt.pinchAround!==void 0&&(tt.pinchAround=dt.pinchAround),dt.noInertia&&(tt.noInertia=dt.noInertia),ct.e(ot,mt),ct.e(ht,wt);this._updateMapTransform(tt,ot,ht),this._changes=[]}_updateMapTransform(tt,ot,ht){const dt=this._map,mt=dt._getTransformForUpdate(),wt=dt.terrain;if(!(Nm(tt)||wt&&this._terrainMovement))return this._fireEvents(ot,ht,!0);let{panDelta:St,zoomDelta:Tt,bearingDelta:Ft,pitchDelta:Gt,around:Xt,pinchAround:pn}=tt;pn!==void 0&&(Xt=pn),dt._stop(!0),Xt=Xt||dt.transform.centerPoint;const wn=mt.pointLocation(St?Xt.sub(St):Xt);Ft&&(mt.bearing+=Ft),Gt&&(mt.pitch+=Gt),Tt&&(mt.zoom+=Tt),wt?this._terrainMovement||!ot.drag&&!ot.zoom?ot.drag&&this._terrainMovement?mt.center=mt.pointLocation(mt.centerPoint.sub(St)):mt.setLocationAtPoint(wn,Xt):(this._terrainMovement=!0,this._map._elevationFreeze=!0,mt.setLocationAtPoint(wn,Xt)):mt.setLocationAtPoint(wn,Xt),dt._applyUpdatedTransform(mt),this._map._update(),tt.noInertia||this._inertia.record(tt),this._fireEvents(ot,ht,!0)}_fireEvents(tt,ot,ht){const dt=Eu(this._eventsInProgress),mt=Eu(tt),wt={};for(const Xt in tt){const{originalEvent:pn}=tt[Xt];this._eventsInProgress[Xt]||(wt[`${Xt}start`]=pn),this._eventsInProgress[Xt]=tt[Xt]}!dt&&mt&&this._fireEvent("movestart",mt.originalEvent);for(const Xt in wt)this._fireEvent(Xt,wt[Xt]);mt&&this._fireEvent("move",mt.originalEvent);for(const Xt in tt){const{originalEvent:pn}=tt[Xt];this._fireEvent(Xt,pn)}const St={};let Tt;for(const Xt in this._eventsInProgress){const{handlerName:pn,originalEvent:wn}=this._eventsInProgress[Xt];this._handlersById[pn].isActive()||(delete this._eventsInProgress[Xt],Tt=ot[pn]||wn,St[`${Xt}end`]=Tt)}for(const Xt in St)this._fireEvent(Xt,St[Xt]);const Ft=Eu(this._eventsInProgress),Gt=(dt||mt)&&!Ft;if(Gt&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Xt=this._map._getTransformForUpdate();Xt.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(Xt)}if(ht&&Gt){this._updatingCamera=!0;const Xt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),pn=wn=>wn!==0&&-this._bearingSnap<wn&&wn<this._bearingSnap;!Xt||!Xt.essential&&Lt.prefersReducedMotion?(this._map.fire(new ct.k("moveend",{originalEvent:Tt})),pn(this._map.getBearing())&&this._map.resetNorth()):(pn(Xt.bearing||this._map.getBearing())&&(Xt.bearing=0),Xt.freezeElevation=!0,this._map.easeTo(Xt,{originalEvent:Tt})),this._updatingCamera=!1}}_fireEvent(tt,ot){this._map.fire(new ct.k(tt,ot?{originalEvent:ot}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(tt=>{delete this._frameId,this.handleEvent(new bs("renderFrame",{timeStamp:tt})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class uy extends ct.E{constructor(tt,ot){super(),this._renderFrameCallback=()=>{const ht=Math.min((Lt.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(ht)),ht<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=tt,this._bearingSnap=ot.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new ct.N(this.transform.center.lng,this.transform.center.lat)}setCenter(tt,ot){return this.jumpTo({center:tt},ot)}panBy(tt,ot,ht){return tt=ct.P.convert(tt).mult(-1),this.panTo(this.transform.center,ct.e({offset:tt},ot),ht)}panTo(tt,ot,ht){return this.easeTo(ct.e({center:tt},ot),ht)}getZoom(){return this.transform.zoom}setZoom(tt,ot){return this.jumpTo({zoom:tt},ot),this}zoomTo(tt,ot,ht){return this.easeTo(ct.e({zoom:tt},ot),ht)}zoomIn(tt,ot){return this.zoomTo(this.getZoom()+1,tt,ot),this}zoomOut(tt,ot){return this.zoomTo(this.getZoom()-1,tt,ot),this}getBearing(){return this.transform.bearing}setBearing(tt,ot){return this.jumpTo({bearing:tt},ot),this}getPadding(){return this.transform.padding}setPadding(tt,ot){return this.jumpTo({padding:tt},ot),this}rotateTo(tt,ot,ht){return this.easeTo(ct.e({bearing:tt},ot),ht)}resetNorth(tt,ot){return this.rotateTo(0,ct.e({duration:1e3},tt),ot),this}resetNorthPitch(tt,ot){return this.easeTo(ct.e({bearing:0,pitch:0,duration:1e3},tt),ot),this}snapToNorth(tt,ot){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(tt,ot):this}getPitch(){return this.transform.pitch}setPitch(tt,ot){return this.jumpTo({pitch:tt},ot),this}cameraForBounds(tt,ot){tt=On.convert(tt).adjustAntiMeridian();const ht=ot&&ot.bearing||0;return this._cameraForBoxAndBearing(tt.getNorthWest(),tt.getSouthEast(),ht,ot)}_cameraForBoxAndBearing(tt,ot,ht,dt){const mt={top:0,bottom:0,right:0,left:0};if(typeof(dt=ct.e({padding:mt,offset:[0,0],maxZoom:this.transform.maxZoom},dt)).padding=="number"){const os=dt.padding;dt.padding={top:os,bottom:os,right:os,left:os}}dt.padding=ct.e(mt,dt.padding);const wt=this.transform,St=wt.padding,Tt=new On(tt,ot),Ft=wt.project(Tt.getNorthWest()),Gt=wt.project(Tt.getNorthEast()),Xt=wt.project(Tt.getSouthEast()),pn=wt.project(Tt.getSouthWest()),wn=ct.ba(-ht),kn=Ft.rotate(wn),Fn=Gt.rotate(wn),Hn=Xt.rotate(wn),Gn=pn.rotate(wn),Qn=new ct.P(Math.max(kn.x,Fn.x,Gn.x,Hn.x),Math.max(kn.y,Fn.y,Gn.y,Hn.y)),Dn=new ct.P(Math.min(kn.x,Fn.x,Gn.x,Hn.x),Math.min(kn.y,Fn.y,Gn.y,Hn.y)),ar=Qn.sub(Dn),mr=(wt.width-(St.left+St.right+dt.padding.left+dt.padding.right))/ar.x,Ar=(wt.height-(St.top+St.bottom+dt.padding.top+dt.padding.bottom))/ar.y;if(Ar<0||mr<0)return void ct.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Wr=Math.min(wt.scaleZoom(wt.scale*Math.min(mr,Ar)),dt.maxZoom),es=ct.P.convert(dt.offset),us=new ct.P((dt.padding.left-dt.padding.right)/2,(dt.padding.top-dt.padding.bottom)/2).rotate(ct.ba(ht)),ys=es.add(us).mult(wt.scale/wt.zoomScale(Wr));return{center:wt.unproject(Ft.add(Xt).div(2).sub(ys)),zoom:Wr,bearing:ht}}fitBounds(tt,ot,ht){return this._fitInternal(this.cameraForBounds(tt,ot),ot,ht)}fitScreenCoordinates(tt,ot,ht,dt,mt){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(ct.P.convert(tt)),this.transform.pointLocation(ct.P.convert(ot)),ht,dt),dt,mt)}_fitInternal(tt,ot,ht){return tt?(delete(ot=ct.e(tt,ot)).padding,ot.linear?this.easeTo(ot,ht):this.flyTo(ot,ht)):this}jumpTo(tt,ot){this.stop();const ht=this._getTransformForUpdate();let dt=!1,mt=!1,wt=!1;return"zoom"in tt&&ht.zoom!==+tt.zoom&&(dt=!0,ht.zoom=+tt.zoom),tt.center!==void 0&&(ht.center=ct.N.convert(tt.center)),"bearing"in tt&&ht.bearing!==+tt.bearing&&(mt=!0,ht.bearing=+tt.bearing),"pitch"in tt&&ht.pitch!==+tt.pitch&&(wt=!0,ht.pitch=+tt.pitch),tt.padding==null||ht.isPaddingEqual(tt.padding)||(ht.padding=tt.padding),this._applyUpdatedTransform(ht),this.fire(new ct.k("movestart",ot)).fire(new ct.k("move",ot)),dt&&this.fire(new ct.k("zoomstart",ot)).fire(new ct.k("zoom",ot)).fire(new ct.k("zoomend",ot)),mt&&this.fire(new ct.k("rotatestart",ot)).fire(new ct.k("rotate",ot)).fire(new ct.k("rotateend",ot)),wt&&this.fire(new ct.k("pitchstart",ot)).fire(new ct.k("pitch",ot)).fire(new ct.k("pitchend",ot)),this.fire(new ct.k("moveend",ot))}calculateCameraOptionsFromTo(tt,ot,ht,dt=0){const mt=ct.Z.fromLngLat(tt,ot),wt=ct.Z.fromLngLat(ht,dt),St=wt.x-mt.x,Tt=wt.y-mt.y,Ft=wt.z-mt.z,Gt=Math.hypot(St,Tt,Ft);if(Gt===0)throw new Error("Can't calculate camera options with same From and To");const Xt=Math.hypot(St,Tt),pn=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Gt/this.transform.tileSize),wn=180*Math.atan2(St,-Tt)/Math.PI;let kn=180*Math.acos(Xt/Gt)/Math.PI;return kn=Ft<0?90-kn:90+kn,{center:wt.toLngLat(),zoom:pn,pitch:kn,bearing:wn}}easeTo(tt,ot){var ht;this._stop(!1,tt.easeId),((tt=ct.e({offset:[0,0],duration:500,easing:ct.b9},tt)).animate===!1||!tt.essential&&Lt.prefersReducedMotion)&&(tt.duration=0);const dt=this._getTransformForUpdate(),mt=dt.zoom,wt=dt.bearing,St=dt.pitch,Tt=dt.padding,Ft="bearing"in tt?this._normalizeBearing(tt.bearing,wt):wt,Gt="pitch"in tt?+tt.pitch:St,Xt="padding"in tt?tt.padding:dt.padding,pn=ct.P.convert(tt.offset);let wn=dt.centerPoint.add(pn);const kn=dt.pointLocation(wn),{center:Fn,zoom:Hn}=dt.getConstrained(ct.N.convert(tt.center||kn),(ht=tt.zoom)!==null&&ht!==void 0?ht:mt);this._normalizeCenter(Fn,dt);const Gn=dt.project(kn),Qn=dt.project(Fn).sub(Gn),Dn=dt.zoomScale(Hn-mt);let ar,mr;tt.around&&(ar=ct.N.convert(tt.around),mr=dt.locationPoint(ar));const Ar={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Hn!==mt,this._rotating=this._rotating||wt!==Ft,this._pitching=this._pitching||Gt!==St,this._padding=!dt.isPaddingEqual(Xt),this._easeId=tt.easeId,this._prepareEase(ot,tt.noMoveStart,Ar),this.terrain&&this._prepareElevation(Fn),this._ease(Wr=>{if(this._zooming&&(dt.zoom=ct.y.number(mt,Hn,Wr)),this._rotating&&(dt.bearing=ct.y.number(wt,Ft,Wr)),this._pitching&&(dt.pitch=ct.y.number(St,Gt,Wr)),this._padding&&(dt.interpolatePadding(Tt,Xt,Wr),wn=dt.centerPoint.add(pn)),this.terrain&&!tt.freezeElevation&&this._updateElevation(Wr),ar)dt.setLocationAtPoint(ar,mr);else{const es=dt.zoomScale(dt.zoom-mt),us=Hn>mt?Math.min(2,Dn):Math.max(.5,Dn),ys=Math.pow(us,1-Wr),os=dt.unproject(Gn.add(Qn.mult(Wr*ys)).mult(es));dt.setLocationAtPoint(dt.renderWorldCopies?os.wrap():os,wn)}this._applyUpdatedTransform(dt),this._fireMoveEvents(ot)},Wr=>{this.terrain&&tt.freezeElevation&&this._finalizeElevation(),this._afterEase(ot,Wr)},tt),this}_prepareEase(tt,ot,ht={}){this._moving=!0,ot||ht.moving||this.fire(new ct.k("movestart",tt)),this._zooming&&!ht.zooming&&this.fire(new ct.k("zoomstart",tt)),this._rotating&&!ht.rotating&&this.fire(new ct.k("rotatestart",tt)),this._pitching&&!ht.pitching&&this.fire(new ct.k("pitchstart",tt))}_prepareElevation(tt){this._elevationCenter=tt,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(tt,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(tt){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const ot=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(tt<1&&ot!==this._elevationTarget){const ht=this._elevationTarget-this._elevationStart;this._elevationStart+=tt*(ht-(ot-(ht*tt+this._elevationStart))/(1-tt)),this._elevationTarget=ot}this.transform.elevation=ct.y.number(this._elevationStart,this._elevationTarget,tt)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(tt){const ot=tt.getCameraPosition(),ht=this.terrain.getElevationForLngLatZoom(ot.lngLat,tt.zoom);if(ot.altitude<ht){const dt=this.calculateCameraOptionsFromTo(ot.lngLat,ht,tt.center,tt.elevation);return{pitch:dt.pitch,zoom:dt.zoom}}return{}}_applyUpdatedTransform(tt){const ot=[];if(this.terrain&&ot.push(dt=>this._elevateCameraIfInsideTerrain(dt)),this.transformCameraUpdate&&ot.push(dt=>this.transformCameraUpdate(dt)),!ot.length)return;const ht=tt.clone();for(const dt of ot){const mt=ht.clone(),{center:wt,zoom:St,pitch:Tt,bearing:Ft,elevation:Gt}=dt(mt);wt&&(mt.center=wt),St!==void 0&&(mt.zoom=St),Tt!==void 0&&(mt.pitch=Tt),Ft!==void 0&&(mt.bearing=Ft),Gt!==void 0&&(mt.elevation=Gt),ht.apply(mt)}this.transform.apply(ht)}_fireMoveEvents(tt){this.fire(new ct.k("move",tt)),this._zooming&&this.fire(new ct.k("zoom",tt)),this._rotating&&this.fire(new ct.k("rotate",tt)),this._pitching&&this.fire(new ct.k("pitch",tt))}_afterEase(tt,ot){if(this._easeId&&ot&&this._easeId===ot)return;delete this._easeId;const ht=this._zooming,dt=this._rotating,mt=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,ht&&this.fire(new ct.k("zoomend",tt)),dt&&this.fire(new ct.k("rotateend",tt)),mt&&this.fire(new ct.k("pitchend",tt)),this.fire(new ct.k("moveend",tt))}flyTo(tt,ot){var ht;if(!tt.essential&&Lt.prefersReducedMotion){const ms=ct.M(tt,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ms,ot)}this.stop(),tt=ct.e({offset:[0,0],speed:1.2,curve:1.42,easing:ct.b9},tt);const dt=this._getTransformForUpdate(),mt=dt.zoom,wt=dt.bearing,St=dt.pitch,Tt=dt.padding,Ft="bearing"in tt?this._normalizeBearing(tt.bearing,wt):wt,Gt="pitch"in tt?+tt.pitch:St,Xt="padding"in tt?tt.padding:dt.padding,pn=ct.P.convert(tt.offset);let wn=dt.centerPoint.add(pn);const kn=dt.pointLocation(wn),{center:Fn,zoom:Hn}=dt.getConstrained(ct.N.convert(tt.center||kn),(ht=tt.zoom)!==null&&ht!==void 0?ht:mt);this._normalizeCenter(Fn,dt);const Gn=dt.zoomScale(Hn-mt),Qn=dt.project(kn),Dn=dt.project(Fn).sub(Qn);let ar=tt.curve;const mr=Math.max(dt.width,dt.height),Ar=mr/Gn,Wr=Dn.mag();if("minZoom"in tt){const ms=ct.ac(Math.min(tt.minZoom,mt,Hn),dt.minZoom,dt.maxZoom),Qs=mr/dt.zoomScale(ms-mt);ar=Math.sqrt(Qs/Wr*2)}const es=ar*ar;function us(ms){const Qs=(Ar*Ar-mr*mr+(ms?-1:1)*es*es*Wr*Wr)/(2*(ms?Ar:mr)*es*Wr);return Math.log(Math.sqrt(Qs*Qs+1)-Qs)}function ys(ms){return(Math.exp(ms)-Math.exp(-ms))/2}function os(ms){return(Math.exp(ms)+Math.exp(-ms))/2}const rs=us(!1);let Rs=function(ms){return os(rs)/os(rs+ar*ms)},no=function(ms){return mr*((os(rs)*(ys(Qs=rs+ar*ms)/os(Qs))-ys(rs))/es)/Wr;var Qs},as=(us(!0)-rs)/ar;if(Math.abs(Wr)<1e-6||!isFinite(as)){if(Math.abs(mr-Ar)<1e-6)return this.easeTo(tt,ot);const ms=Ar<mr?-1:1;as=Math.abs(Math.log(Ar/mr))/ar,no=()=>0,Rs=Qs=>Math.exp(ms*ar*Qs)}return tt.duration="duration"in tt?+tt.duration:1e3*as/("screenSpeed"in tt?+tt.screenSpeed/ar:+tt.speed),tt.maxDuration&&tt.duration>tt.maxDuration&&(tt.duration=0),this._zooming=!0,this._rotating=wt!==Ft,this._pitching=Gt!==St,this._padding=!dt.isPaddingEqual(Xt),this._prepareEase(ot,!1),this.terrain&&this._prepareElevation(Fn),this._ease(ms=>{const Qs=ms*as,Ho=1/Rs(Qs);dt.zoom=ms===1?Hn:mt+dt.scaleZoom(Ho),this._rotating&&(dt.bearing=ct.y.number(wt,Ft,ms)),this._pitching&&(dt.pitch=ct.y.number(St,Gt,ms)),this._padding&&(dt.interpolatePadding(Tt,Xt,ms),wn=dt.centerPoint.add(pn)),this.terrain&&!tt.freezeElevation&&this._updateElevation(ms);const co=ms===1?Fn:dt.unproject(Qn.add(Dn.mult(no(Qs))).mult(Ho));dt.setLocationAtPoint(dt.renderWorldCopies?co.wrap():co,wn),this._applyUpdatedTransform(dt),this._fireMoveEvents(ot)},()=>{this.terrain&&tt.freezeElevation&&this._finalizeElevation(),this._afterEase(ot)},tt),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(tt,ot){var ht;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const dt=this._onEaseEnd;delete this._onEaseEnd,dt.call(this,ot)}return tt||(ht=this.handlers)===null||ht===void 0||ht.stop(!1),this}_ease(tt,ot,ht){ht.animate===!1||ht.duration===0?(tt(1),ot()):(this._easeStart=Lt.now(),this._easeOptions=ht,this._onEaseFrame=tt,this._onEaseEnd=ot,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(tt,ot){tt=ct.b3(tt,-180,180);const ht=Math.abs(tt-ot);return Math.abs(tt-360-ot)<ht&&(tt-=360),Math.abs(tt+360-ot)<ht&&(tt+=360),tt}_normalizeCenter(tt,ot){if(!ot.renderWorldCopies||ot.lngRange)return;const ht=tt.lng-ot.center.lng;tt.lng+=ht>180?-360:ht<-180?360:0}queryTerrainElevation(tt){return this.terrain?this.terrain.getElevationForLngLatZoom(ct.N.convert(tt),this.transform.tileZoom)-this.transform.elevation:null}}const Yp={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Jp{constructor(tt=Yp){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=ot=>{!ot||ot.sourceDataType!=="metadata"&&ot.sourceDataType!=="visibility"&&ot.dataType!=="style"&&ot.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=tt}getDefaultPosition(){return"bottom-right"}onAdd(tt){return this._map=tt,this._compact=this.options.compact,this._container=Mt.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Mt.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Mt.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Mt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(tt,ot){const ht=this._map._getUIString(`AttributionControl.${ot}`);tt.title=ht,tt.setAttribute("aria-label",ht)}_updateAttributions(){if(!this._map.style)return;let tt=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?tt=tt.concat(this.options.customAttribution.map(dt=>typeof dt!="string"?"":dt)):typeof this.options.customAttribution=="string"&&tt.push(this.options.customAttribution)),this._map.style.stylesheet){const dt=this._map.style.stylesheet;this.styleOwner=dt.owner,this.styleId=dt.id}const ot=this._map.style.sourceCaches;for(const dt in ot){const mt=ot[dt];if(mt.used||mt.usedForTerrain){const wt=mt.getSource();wt.attribution&&tt.indexOf(wt.attribution)<0&&tt.push(wt.attribution)}}tt=tt.filter(dt=>String(dt).trim()),tt.sort((dt,mt)=>dt.length-mt.length),tt=tt.filter((dt,mt)=>{for(let wt=mt+1;wt<tt.length;wt++)if(tt[wt].indexOf(dt)>=0)return!1;return!0});const ht=tt.join(" | ");ht!==this._attribHTML&&(this._attribHTML=ht,tt.length?(this._innerContainer.innerHTML=ht,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class k_{constructor(tt={}){this._updateCompact=()=>{const ot=this._container.children;if(ot.length){const ht=ot[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&ht.classList.add("maplibregl-compact"):ht.classList.remove("maplibregl-compact")}},this.options=tt}getDefaultPosition(){return"bottom-left"}onAdd(tt){this._map=tt,this._compact=this.options&&this.options.compact,this._container=Mt.create("div","maplibregl-ctrl");const ot=Mt.create("a","maplibregl-ctrl-logo");return ot.target="_blank",ot.rel="noopener nofollow",ot.href="https://maplibre.org/",ot.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),ot.setAttribute("rel","noopener nofollow"),this._container.appendChild(ot),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Mt.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class yo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(tt){const ot=++this._id;return this._queue.push({callback:tt,id:ot,cancelled:!1}),ot}remove(tt){const ot=this._currentlyRunning,ht=ot?this._queue.concat(ot):this._queue;for(const dt of ht)if(dt.id===tt)return void(dt.cancelled=!0)}run(tt=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const ot=this._currentlyRunning=this._queue;this._queue=[];for(const ht of ot)if(!ht.cancelled&&(ht.callback(tt),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var P_=ct.Y([{name:"a_pos3d",type:"Int16",components:3}]);class e0 extends ct.E{constructor(tt){super(),this.sourceCache=tt,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,tt.usedForTerrain=!0,tt.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(tt,ot){this.sourceCache.update(tt,ot),this._renderableTilesKeys=[];const ht={};for(const dt of tt.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:ot}))ht[dt.key]=!0,this._renderableTilesKeys.push(dt.key),this._tiles[dt.key]||(dt.posMatrix=new Float64Array(16),ct.aP(dt.posMatrix,0,ct.X,0,ct.X,0,1),this._tiles[dt.key]=new Ms(dt,this.tileSize));for(const dt in this._tiles)ht[dt]||delete this._tiles[dt]}freeRtt(tt){for(const ot in this._tiles){const ht=this._tiles[ot];(!tt||ht.tileID.equals(tt)||ht.tileID.isChildOf(tt)||tt.isChildOf(ht.tileID))&&(ht.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(tt=>this.getTileByID(tt))}getTileByID(tt){return this._tiles[tt]}getTerrainCoords(tt){const ot={};for(const ht of this._renderableTilesKeys){const dt=this._tiles[ht].tileID;if(dt.canonical.equals(tt.canonical)){const mt=tt.clone();mt.posMatrix=new Float64Array(16),ct.aP(mt.posMatrix,0,ct.X,0,ct.X,0,1),ot[ht]=mt}else if(dt.canonical.isChildOf(tt.canonical)){const mt=tt.clone();mt.posMatrix=new Float64Array(16);const wt=dt.canonical.z-tt.canonical.z,St=dt.canonical.x-(dt.canonical.x>>wt<<wt),Tt=dt.canonical.y-(dt.canonical.y>>wt<<wt),Ft=ct.X>>wt;ct.aP(mt.posMatrix,0,Ft,0,Ft,0,1),ct.J(mt.posMatrix,mt.posMatrix,[-St*Ft,-Tt*Ft,0]),ot[ht]=mt}else if(tt.canonical.isChildOf(dt.canonical)){const mt=tt.clone();mt.posMatrix=new Float64Array(16);const wt=tt.canonical.z-dt.canonical.z,St=tt.canonical.x-(tt.canonical.x>>wt<<wt),Tt=tt.canonical.y-(tt.canonical.y>>wt<<wt),Ft=ct.X>>wt;ct.aP(mt.posMatrix,0,ct.X,0,ct.X,0,1),ct.J(mt.posMatrix,mt.posMatrix,[St*Ft,Tt*Ft,0]),ct.K(mt.posMatrix,mt.posMatrix,[1/2**wt,1/2**wt,0]),ot[ht]=mt}}return ot}getSourceTile(tt,ot){const ht=this.sourceCache._source;let dt=tt.overscaledZ-this.deltaZoom;if(dt>ht.maxzoom&&(dt=ht.maxzoom),dt<ht.minzoom)return null;this._sourceTileCache[tt.key]||(this._sourceTileCache[tt.key]=tt.scaledTo(dt).key);let mt=this.sourceCache.getTileByID(this._sourceTileCache[tt.key]);if((!mt||!mt.dem)&&ot)for(;dt>=ht.minzoom&&(!mt||!mt.dem);)mt=this.sourceCache.getTileByID(tt.scaledTo(dt--).key);return mt}tilesAfterTime(tt=Date.now()){return Object.values(this._tiles).filter(ot=>ot.timeAdded>=tt)}}class R_{constructor(tt,ot,ht){this.painter=tt,this.sourceCache=new e0(ot),this.options=ht,this.exaggeration=typeof ht.exaggeration=="number"?ht.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(tt,ot,ht,dt=ct.X){var mt;if(!(ot>=0&&ot<dt&&ht>=0&&ht<dt))return 0;const wt=this.getTerrainData(tt),St=(mt=wt.tile)===null||mt===void 0?void 0:mt.dem;if(!St)return 0;const Tt=function(kn,Fn,Hn){var Gn=Fn[0],Qn=Fn[1];return kn[0]=Hn[0]*Gn+Hn[4]*Qn+Hn[12],kn[1]=Hn[1]*Gn+Hn[5]*Qn+Hn[13],kn}([],[ot/dt*ct.X,ht/dt*ct.X],wt.u_terrain_matrix),Ft=[Tt[0]*St.dim,Tt[1]*St.dim],Gt=Math.floor(Ft[0]),Xt=Math.floor(Ft[1]),pn=Ft[0]-Gt,wn=Ft[1]-Xt;return St.get(Gt,Xt)*(1-pn)*(1-wn)+St.get(Gt+1,Xt)*pn*(1-wn)+St.get(Gt,Xt+1)*(1-pn)*wn+St.get(Gt+1,Xt+1)*pn*wn}getElevationForLngLatZoom(tt,ot){if(!ct.bb(ot,tt.wrap()))return 0;const{tileID:ht,mercatorX:dt,mercatorY:mt}=this._getOverscaledTileIDFromLngLatZoom(tt,ot);return this.getElevation(ht,dt%ct.X,mt%ct.X,ct.X)}getElevation(tt,ot,ht,dt=ct.X){return this.getDEMElevation(tt,ot,ht,dt)*this.exaggeration}getTerrainData(tt){if(!this._emptyDemTexture){const dt=this.painter.context,mt=new ct.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new fn(dt,mt,dt.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new fn(dt,new ct.R({width:1,height:1}),dt.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(dt.gl.NEAREST,dt.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=ct.an([])}const ot=this.sourceCache.getSourceTile(tt,!0);if(ot&&ot.dem&&(!ot.demTexture||ot.needsTerrainPrepare)){const dt=this.painter.context;ot.demTexture=this.painter.getTileTexture(ot.dem.stride),ot.demTexture?ot.demTexture.update(ot.dem.getPixels(),{premultiply:!1}):ot.demTexture=new fn(dt,ot.dem.getPixels(),dt.gl.RGBA,{premultiply:!1}),ot.demTexture.bind(dt.gl.NEAREST,dt.gl.CLAMP_TO_EDGE),ot.needsTerrainPrepare=!1}const ht=ot&&ot+ot.tileID.key+tt.key;if(ht&&!this._demMatrixCache[ht]){const dt=this.sourceCache.sourceCache._source.maxzoom;let mt=tt.canonical.z-ot.tileID.canonical.z;tt.overscaledZ>tt.canonical.z&&(tt.canonical.z>=dt?mt=tt.canonical.z-dt:ct.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const wt=tt.canonical.x-(tt.canonical.x>>mt<<mt),St=tt.canonical.y-(tt.canonical.y>>mt<<mt),Tt=ct.bc(new Float64Array(16),[1/(ct.X<<mt),1/(ct.X<<mt),0]);ct.J(Tt,Tt,[wt*ct.X,St*ct.X,0]),this._demMatrixCache[tt.key]={matrix:Tt,coord:tt}}return{u_depth:2,u_terrain:3,u_terrain_dim:ot&&ot.dem&&ot.dem.dim||1,u_terrain_matrix:ht?this._demMatrixCache[tt.key].matrix:this._emptyDemMatrix,u_terrain_unpack:ot&&ot.dem&&ot.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(ot&&ot.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:ot}}getFramebuffer(tt){const ot=this.painter,ht=ot.width/devicePixelRatio,dt=ot.height/devicePixelRatio;return!this._fbo||this._fbo.width===ht&&this._fbo.height===dt||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new fn(ot.context,{width:ht,height:dt,data:null},ot.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(ot.context.gl.NEAREST,ot.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new fn(ot.context,{width:ht,height:dt,data:null},ot.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(ot.context.gl.NEAREST,ot.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=ot.context.createFramebuffer(ht,dt,!0,!1),this._fbo.depthAttachment.set(ot.context.createRenderbuffer(ot.context.gl.DEPTH_COMPONENT16,ht,dt))),this._fbo.colorAttachment.set(tt==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const tt=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const ot=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let mt=0,wt=0;mt<this._coordsTextureSize;mt++)for(let St=0;St<this._coordsTextureSize;St++,wt+=4)ot[wt+0]=255&St,ot[wt+1]=255&mt,ot[wt+2]=St>>8<<4|mt>>8,ot[wt+3]=0;const ht=new ct.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(ot.buffer)),dt=new fn(tt,ht,tt.gl.RGBA,{premultiply:!1});return dt.bind(tt.gl.NEAREST,tt.gl.CLAMP_TO_EDGE),this._coordsTexture=dt,dt}pointCoordinate(tt){this.painter.maybeDrawDepthAndCoords(!0);const ot=new Uint8Array(4),ht=this.painter.context,dt=ht.gl,mt=Math.round(tt.x*this.painter.pixelRatio/devicePixelRatio),wt=Math.round(tt.y*this.painter.pixelRatio/devicePixelRatio),St=Math.round(this.painter.height/devicePixelRatio);ht.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),dt.readPixels(mt,St-wt-1,1,1,dt.RGBA,dt.UNSIGNED_BYTE,ot),ht.bindFramebuffer.set(null);const Tt=ot[0]+(ot[2]>>4<<8),Ft=ot[1]+((15&ot[2])<<8),Gt=this.coordsIndex[255-ot[3]],Xt=Gt&&this.sourceCache.getTileByID(Gt);if(!Xt)return null;const pn=this._coordsTextureSize,wn=(1<<Xt.tileID.canonical.z)*pn;return new ct.Z((Xt.tileID.canonical.x*pn+Tt)/wn+Xt.tileID.wrap,(Xt.tileID.canonical.y*pn+Ft)/wn,this.getElevation(Xt.tileID,Tt,Ft,pn))}depthAtPoint(tt){const ot=new Uint8Array(4),ht=this.painter.context,dt=ht.gl;return ht.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),dt.readPixels(tt.x,this.painter.height/devicePixelRatio-tt.y-1,1,1,dt.RGBA,dt.UNSIGNED_BYTE,ot),ht.bindFramebuffer.set(null),(ot[0]/16777216+ot[1]/65536+ot[2]/256+ot[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const tt=this.painter.context,ot=new ct.bd,ht=new ct.aY,dt=this.meshSize,mt=ct.X/dt,wt=dt*dt;for(let Xt=0;Xt<=dt;Xt++)for(let pn=0;pn<=dt;pn++)ot.emplaceBack(pn*mt,Xt*mt,0);for(let Xt=0;Xt<wt;Xt+=dt+1)for(let pn=0;pn<dt;pn++)ht.emplaceBack(pn+Xt,dt+pn+Xt+1,dt+pn+Xt+2),ht.emplaceBack(pn+Xt,dt+pn+Xt+2,pn+Xt+1);const St=ot.length,Tt=St+2*(dt+1);for(const Xt of[0,1])for(let pn=0;pn<=dt;pn++)for(const wn of[0,1])ot.emplaceBack(pn*mt,Xt*ct.X,wn);for(let Xt=0;Xt<2*dt;Xt+=2)ht.emplaceBack(Tt+Xt,Tt+Xt+1,Tt+Xt+3),ht.emplaceBack(Tt+Xt,Tt+Xt+3,Tt+Xt+2),ht.emplaceBack(St+Xt,St+Xt+3,St+Xt+1),ht.emplaceBack(St+Xt,St+Xt+2,St+Xt+3);const Ft=ot.length,Gt=Ft+2*(dt+1);for(const Xt of[0,1])for(let pn=0;pn<=dt;pn++)for(const wn of[0,1])ot.emplaceBack(Xt*ct.X,pn*mt,wn);for(let Xt=0;Xt<2*dt;Xt+=2)ht.emplaceBack(Ft+Xt,Ft+Xt+1,Ft+Xt+3),ht.emplaceBack(Ft+Xt,Ft+Xt+3,Ft+Xt+2),ht.emplaceBack(Gt+Xt,Gt+Xt+3,Gt+Xt+1),ht.emplaceBack(Gt+Xt,Gt+Xt+2,Gt+Xt+3);return this._mesh=new Tp(tt.createVertexBuffer(ot,P_.members),tt.createIndexBuffer(ht),ct.a0.simpleSegment(0,0,ot.length,ht.length)),this._mesh}getMeshFrameDelta(tt){return 2*Math.PI*ct.be/Math.pow(2,tt)/5}getMinTileElevationForLngLatZoom(tt,ot){var ht;const{tileID:dt}=this._getOverscaledTileIDFromLngLatZoom(tt,ot);return(ht=this.getMinMaxElevation(dt).minElevation)!==null&&ht!==void 0?ht:0}getMinMaxElevation(tt){const ot=this.getTerrainData(tt).tile,ht={minElevation:null,maxElevation:null};return ot&&ot.dem&&(ht.minElevation=ot.dem.min*this.exaggeration,ht.maxElevation=ot.dem.max*this.exaggeration),ht}_getOverscaledTileIDFromLngLatZoom(tt,ot){const ht=ct.Z.fromLngLat(tt.wrap()),dt=(1<<ot)*ct.X,mt=ht.x*dt,wt=ht.y*dt,St=Math.floor(mt/ct.X),Tt=Math.floor(wt/ct.X);return{tileID:new ct.S(ot,0,ot,St,Tt),mercatorX:mt,mercatorY:wt}}}class t0{constructor(tt,ot,ht){this._context=tt,this._size=ot,this._tileSize=ht,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const tt of this._objects)tt.texture.destroy(),tt.fbo.destroy()}_createObject(tt){const ot=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),ht=new fn(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return ht.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),ot.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),ot.colorAttachment.set(ht.texture),{id:tt,fbo:ot,texture:ht,stamp:-1,inUse:!1}}getObjectForId(tt){return this._objects[tt]}useObject(tt){tt.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(ot=>tt.id!==ot),this._recentlyUsed.push(tt.id)}stampObject(tt){tt.stamp=++this._stamp}getOrCreateFreeObject(){for(const ot of this._recentlyUsed)if(!this._objects[ot].inUse)return this._objects[ot];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const tt=this._createObject(this._objects.length);return this._objects.push(tt),tt}freeObject(tt){tt.inUse=!1}freeAllObjects(){for(const tt of this._objects)this.freeObject(tt)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(tt=>!tt.inUse)===!1}}const Qp={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class hy{constructor(tt,ot){this.painter=tt,this.terrain=ot,this.pool=new t0(tt.context,30,ot.sourceCache.tileSize*ot.qualityFactor)}destruct(){this.pool.destruct()}getTexture(tt){return this.pool.getObjectForId(tt.rtt[this._stacks.length-1].id).texture}prepareForRender(tt,ot){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=tt._order.filter(ht=>!tt._layers[ht].isHidden(ot)),this._coordsDescendingInv={};for(const ht in tt.sourceCaches){this._coordsDescendingInv[ht]={};const dt=tt.sourceCaches[ht].getVisibleCoordinates();for(const mt of dt){const wt=this.terrain.sourceCache.getTerrainCoords(mt);for(const St in wt)this._coordsDescendingInv[ht][St]||(this._coordsDescendingInv[ht][St]=[]),this._coordsDescendingInv[ht][St].push(wt[St])}}this._coordsDescendingInvStr={};for(const ht of tt._order){const dt=tt._layers[ht],mt=dt.source;if(Qp[dt.type]&&!this._coordsDescendingInvStr[mt]){this._coordsDescendingInvStr[mt]={};for(const wt in this._coordsDescendingInv[mt])this._coordsDescendingInvStr[mt][wt]=this._coordsDescendingInv[mt][wt].map(St=>St.key).sort().join()}}for(const ht of this._renderableTiles)for(const dt in this._coordsDescendingInvStr){const mt=this._coordsDescendingInvStr[dt][ht.tileID.key];mt&&mt!==ht.rttCoords[dt]&&(ht.rtt=[])}}renderLayer(tt){if(tt.isHidden(this.painter.transform.zoom))return!1;const ot=tt.type,ht=this.painter,dt=this._renderableLayerIds[this._renderableLayerIds.length-1]===tt.id;if(Qp[ot]&&(this._prevType&&Qp[this._prevType]||this._stacks.push([]),this._prevType=ot,this._stacks[this._stacks.length-1].push(tt.id),!dt))return!0;if(Qp[this._prevType]||Qp[ot]&&dt){this._prevType=ot;const mt=this._stacks.length-1,wt=this._stacks[mt]||[];for(const St of this._renderableTiles){if(this.pool.isFull()&&(Gp(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(St),St.rtt[mt]){const Ft=this.pool.getObjectForId(St.rtt[mt].id);if(Ft.stamp===St.rtt[mt].stamp){this.pool.useObject(Ft);continue}}const Tt=this.pool.getOrCreateFreeObject();this.pool.useObject(Tt),this.pool.stampObject(Tt),St.rtt[mt]={id:Tt.id,stamp:Tt.stamp},ht.context.bindFramebuffer.set(Tt.fbo.framebuffer),ht.context.clear({color:ct.aM.transparent,stencil:0}),ht.currentStencilSource=void 0;for(let Ft=0;Ft<wt.length;Ft++){const Gt=ht.style._layers[wt[Ft]],Xt=Gt.source?this._coordsDescendingInv[Gt.source][St.tileID.key]:[St.tileID];ht.context.viewport.set([0,0,Tt.fbo.width,Tt.fbo.height]),ht._renderTileClippingMasks(Gt,Xt),ht.renderLayer(ht,ht.style.sourceCaches[Gt.source],Gt,Xt),Gt.source&&(St.rttCoords[Gt.source]=this._coordsDescendingInvStr[Gt.source][St.tileID.key])}}return Gp(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Qp[ot]}return!1}}const M_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},dy=At,n0={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Yp,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:ct.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},I_=gt=>{gt.touchstart=gt.dragStart,gt.touchmoveWindow=gt.dragMove,gt.touchend=gt.dragEnd},i0={showCompass:!0,showZoom:!0,visualizePitch:!1};class r0{constructor(tt,ot,ht=!1){this.mousedown=wt=>{this.startMouse(ct.e({},wt,{ctrlKey:!0,preventDefault:()=>wt.preventDefault()}),Mt.mousePos(this.element,wt)),Mt.addEventListener(window,"mousemove",this.mousemove),Mt.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=wt=>{this.moveMouse(wt,Mt.mousePos(this.element,wt))},this.mouseup=wt=>{this.mouseRotate.dragEnd(wt),this.mousePitch&&this.mousePitch.dragEnd(wt),this.offTemp()},this.touchstart=wt=>{wt.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Mt.touchPos(this.element,wt.targetTouches)[0],this.startTouch(wt,this._startPos),Mt.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Mt.addEventListener(window,"touchend",this.touchend))},this.touchmove=wt=>{wt.targetTouches.length!==1?this.reset():(this._lastPos=Mt.touchPos(this.element,wt.targetTouches)[0],this.moveTouch(wt,this._lastPos))},this.touchend=wt=>{wt.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const dt=tt.dragRotate._mouseRotate.getClickTolerance(),mt=tt.dragRotate._mousePitch.getClickTolerance();this.element=ot,this.mouseRotate=v_({clickTolerance:dt,enable:!0}),this.touchRotate=(({enable:wt,clickTolerance:St,bearingDegreesPerPixelMoved:Tt=.8})=>{const Ft=new y_;return new zl({clickTolerance:St,move:(Gt,Xt)=>({bearingDelta:(Xt.x-Gt.x)*Tt}),moveStateManager:Ft,enable:wt,assignEvents:I_})})({clickTolerance:dt,enable:!0}),this.map=tt,ht&&(this.mousePitch=x_({clickTolerance:mt,enable:!0}),this.touchPitch=(({enable:wt,clickTolerance:St,pitchDegreesPerPixelMoved:Tt=-.5})=>{const Ft=new y_;return new zl({clickTolerance:St,move:(Gt,Xt)=>({pitchDelta:(Xt.y-Gt.y)*Tt}),moveStateManager:Ft,enable:wt,assignEvents:I_})})({clickTolerance:mt,enable:!0})),Mt.addEventListener(ot,"mousedown",this.mousedown),Mt.addEventListener(ot,"touchstart",this.touchstart,{passive:!1}),Mt.addEventListener(ot,"touchcancel",this.reset)}startMouse(tt,ot){this.mouseRotate.dragStart(tt,ot),this.mousePitch&&this.mousePitch.dragStart(tt,ot),Mt.disableDrag()}startTouch(tt,ot){this.touchRotate.dragStart(tt,ot),this.touchPitch&&this.touchPitch.dragStart(tt,ot),Mt.disableDrag()}moveMouse(tt,ot){const ht=this.map,{bearingDelta:dt}=this.mouseRotate.dragMove(tt,ot)||{};if(dt&&ht.setBearing(ht.getBearing()+dt),this.mousePitch){const{pitchDelta:mt}=this.mousePitch.dragMove(tt,ot)||{};mt&&ht.setPitch(ht.getPitch()+mt)}}moveTouch(tt,ot){const ht=this.map,{bearingDelta:dt}=this.touchRotate.dragMove(tt,ot)||{};if(dt&&ht.setBearing(ht.getBearing()+dt),this.touchPitch){const{pitchDelta:mt}=this.touchPitch.dragMove(tt,ot)||{};mt&&ht.setPitch(ht.getPitch()+mt)}}off(){const tt=this.element;Mt.removeEventListener(tt,"mousedown",this.mousedown),Mt.removeEventListener(tt,"touchstart",this.touchstart,{passive:!1}),Mt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Mt.removeEventListener(window,"touchend",this.touchend),Mt.removeEventListener(tt,"touchcancel",this.reset),this.offTemp()}offTemp(){Mt.enableDrag(),Mt.removeEventListener(window,"mousemove",this.mousemove),Mt.removeEventListener(window,"mouseup",this.mouseup),Mt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Mt.removeEventListener(window,"touchend",this.touchend)}}let gu;function Vo(gt,tt,ot){const ht=new ct.N(gt.lng,gt.lat);if(gt=new ct.N(gt.lng,gt.lat),tt){const dt=new ct.N(gt.lng-360,gt.lat),mt=new ct.N(gt.lng+360,gt.lat),wt=ot.locationPoint(gt).distSqr(tt);ot.locationPoint(dt).distSqr(tt)<wt?gt=dt:ot.locationPoint(mt).distSqr(tt)<wt&&(gt=mt)}for(;Math.abs(gt.lng-ot.center.lng)>180;){const dt=ot.locationPoint(gt);if(dt.x>=0&&dt.y>=0&&dt.x<=ot.width&&dt.y<=ot.height)break;gt.lng>ot.center.lng?gt.lng-=360:gt.lng+=360}return gt.lng!==ht.lng&&ot.locationPoint(gt).y>ot.height/2-ot.getHorizon()?gt:ht}const _f={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bm(gt,tt,ot){const ht=gt.classList;for(const dt in _f)ht.remove(`maplibregl-${ot}-anchor-${dt}`);ht.add(`maplibregl-${ot}-anchor-${tt}`)}class jm extends ct.E{constructor(tt){if(super(),this._onKeyPress=ot=>{const ht=ot.code,dt=ot.charCode||ot.keyCode;ht!=="Space"&&ht!=="Enter"&&dt!==32&&dt!==13||this.togglePopup()},this._onMapClick=ot=>{const ht=ot.originalEvent.target,dt=this._element;this._popup&&(ht===dt||dt.contains(ht))&&this.togglePopup()},this._update=ot=>{var ht;if(!this._map)return;const dt=this._map.loaded()&&!this._map.isMoving();((ot==null?void 0:ot.type)==="terrain"||(ot==null?void 0:ot.type)==="render"&&!dt)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Vo(this._lngLat,this._flatPos,this._map.transform):(ht=this._lngLat)===null||ht===void 0?void 0:ht.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let mt="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?mt=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(mt=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let wt="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?wt="rotateX(0deg)":this._pitchAlignment==="map"&&(wt=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||ot&&ot.type!=="moveend"||(this._pos=this._pos.round()),Mt.setTransform(this._element,`${_f[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${wt} ${mt}`),Lt.frameAsync(new AbortController).then(()=>{this._updateOpacity(ot&&ot.type==="moveend")}).catch(()=>{})},this._onMove=ot=>{if(!this._isDragging){const ht=this._clickTolerance||this._map._clickTolerance;this._isDragging=ot.point.dist(this._pointerdownPos)>=ht}this._isDragging&&(this._pos=ot.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new ct.k("dragstart"))),this.fire(new ct.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new ct.k("dragend")),this._state="inactive"},this._addDragHandler=ot=>{this._element.contains(ot.originalEvent.target)&&(ot.preventDefault(),this._positionDelta=ot.point.sub(this._pos).add(this._offset),this._pointerdownPos=ot.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=tt&&tt.anchor||"center",this._color=tt&&tt.color||"#3FB1CE",this._scale=tt&&tt.scale||1,this._draggable=tt&&tt.draggable||!1,this._clickTolerance=tt&&tt.clickTolerance||0,this._subpixelPositioning=tt&&tt.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=tt&&tt.rotation||0,this._rotationAlignment=tt&&tt.rotationAlignment||"auto",this._pitchAlignment=tt&&tt.pitchAlignment&&tt.pitchAlignment!=="auto"?tt.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(tt==null?void 0:tt.opacity,tt==null?void 0:tt.opacityWhenCovered),tt&&tt.element)this._element=tt.element,this._offset=ct.P.convert(tt&&tt.offset||[0,0]);else{this._defaultMarker=!0,this._element=Mt.create("div");const ot=Mt.createNS("http://www.w3.org/2000/svg","svg"),ht=41,dt=27;ot.setAttributeNS(null,"display","block"),ot.setAttributeNS(null,"height",`${ht}px`),ot.setAttributeNS(null,"width",`${dt}px`),ot.setAttributeNS(null,"viewBox",`0 0 ${dt} ${ht}`);const mt=Mt.createNS("http://www.w3.org/2000/svg","g");mt.setAttributeNS(null,"stroke","none"),mt.setAttributeNS(null,"stroke-width","1"),mt.setAttributeNS(null,"fill","none"),mt.setAttributeNS(null,"fill-rule","evenodd");const wt=Mt.createNS("http://www.w3.org/2000/svg","g");wt.setAttributeNS(null,"fill-rule","nonzero");const St=Mt.createNS("http://www.w3.org/2000/svg","g");St.setAttributeNS(null,"transform","translate(3.0, 29.0)"),St.setAttributeNS(null,"fill","#000000");const Tt=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Gn of Tt){const Qn=Mt.createNS("http://www.w3.org/2000/svg","ellipse");Qn.setAttributeNS(null,"opacity","0.04"),Qn.setAttributeNS(null,"cx","10.5"),Qn.setAttributeNS(null,"cy","5.80029008"),Qn.setAttributeNS(null,"rx",Gn.rx),Qn.setAttributeNS(null,"ry",Gn.ry),St.appendChild(Qn)}const Ft=Mt.createNS("http://www.w3.org/2000/svg","g");Ft.setAttributeNS(null,"fill",this._color);const Gt=Mt.createNS("http://www.w3.org/2000/svg","path");Gt.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ft.appendChild(Gt);const Xt=Mt.createNS("http://www.w3.org/2000/svg","g");Xt.setAttributeNS(null,"opacity","0.25"),Xt.setAttributeNS(null,"fill","#000000");const pn=Mt.createNS("http://www.w3.org/2000/svg","path");pn.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Xt.appendChild(pn);const wn=Mt.createNS("http://www.w3.org/2000/svg","g");wn.setAttributeNS(null,"transform","translate(6.0, 7.0)"),wn.setAttributeNS(null,"fill","#FFFFFF");const kn=Mt.createNS("http://www.w3.org/2000/svg","g");kn.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Fn=Mt.createNS("http://www.w3.org/2000/svg","circle");Fn.setAttributeNS(null,"fill","#000000"),Fn.setAttributeNS(null,"opacity","0.25"),Fn.setAttributeNS(null,"cx","5.5"),Fn.setAttributeNS(null,"cy","5.5"),Fn.setAttributeNS(null,"r","5.4999962");const Hn=Mt.createNS("http://www.w3.org/2000/svg","circle");Hn.setAttributeNS(null,"fill","#FFFFFF"),Hn.setAttributeNS(null,"cx","5.5"),Hn.setAttributeNS(null,"cy","5.5"),Hn.setAttributeNS(null,"r","5.4999962"),kn.appendChild(Fn),kn.appendChild(Hn),wt.appendChild(St),wt.appendChild(Ft),wt.appendChild(Xt),wt.appendChild(wn),wt.appendChild(kn),ot.appendChild(wt),ot.setAttributeNS(null,"height",ht*this._scale+"px"),ot.setAttributeNS(null,"width",dt*this._scale+"px"),this._element.appendChild(ot),this._offset=ct.P.convert(tt&&tt.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",ot=>{ot.preventDefault()}),this._element.addEventListener("mousedown",ot=>{ot.preventDefault()}),Bm(this._element,this._anchor,"marker"),tt&&tt.className)for(const ot of tt.className.split(" "))this._element.classList.add(ot);this._popup=null}addTo(tt){return this.remove(),this._map=tt,this._element.setAttribute("aria-label",tt._getUIString("Marker.Title")),tt.getCanvasContainer().appendChild(this._element),tt.on("move",this._update),tt.on("moveend",this._update),tt.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Mt.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(tt){return this._lngLat=ct.N.convert(tt),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(tt){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),tt){if(!("offset"in tt.options)){const dt=Math.abs(13.5)/Math.SQRT2;tt.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[dt,-1*(38.1-13.5+dt)],"bottom-right":[-dt,-1*(38.1-13.5+dt)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=tt,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(tt){return this._subpixelPositioning=tt,this}getPopup(){return this._popup}togglePopup(){const tt=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:tt?(tt.isOpen()?tt.remove():(tt.setLngLat(this._lngLat),tt.addTo(this._map)),this):this}_updateOpacity(tt=!1){var ot,ht;if(!(!((ot=this._map)===null||ot===void 0)&&ot.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(tt)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const dt=this._map,mt=dt.terrain.depthAtPoint(this._pos),wt=dt.terrain.getElevationForLngLatZoom(this._lngLat,dt.transform.tileZoom);if(dt.transform.lngLatToCameraDepth(this._lngLat,wt)-mt<.006)return void(this._element.style.opacity=this._opacity);const St=-this._offset.y/dt.transform._pixelPerMeter,Tt=Math.sin(dt.getPitch()*Math.PI/180)*St,Ft=dt.terrain.depthAtPoint(new ct.P(this._pos.x,this._pos.y-this._offset.y)),Gt=dt.transform.lngLatToCameraDepth(this._lngLat,wt+Tt)-Ft>.006;!((ht=this._popup)===null||ht===void 0)&&ht.isOpen()&&Gt&&this._popup.remove(),this._element.style.opacity=Gt?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(tt){return this._offset=ct.P.convert(tt),this._update(),this}addClassName(tt){this._element.classList.add(tt)}removeClassName(tt){this._element.classList.remove(tt)}toggleClassName(tt){return this._element.classList.toggle(tt)}setDraggable(tt){return this._draggable=!!tt,this._map&&(tt?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(tt){return this._rotation=tt||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(tt){return this._rotationAlignment=tt||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(tt){return this._pitchAlignment=tt&&tt!=="auto"?tt:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(tt,ot){return tt===void 0&&ot===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),tt!==void 0&&(this._opacity=tt),ot!==void 0&&(this._opacityWhenCovered=ot),this._map&&this._updateOpacity(!0),this}}const py={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let _m=0,ym=!1;const Hu={maxWidth:100,unit:"metric"};function vm(gt,tt,ot){const ht=ot&&ot.maxWidth||100,dt=gt._container.clientHeight/2,mt=gt.unproject([0,dt]),wt=gt.unproject([ht,dt]),St=mt.distanceTo(wt);if(ot&&ot.unit==="imperial"){const Tt=3.2808*St;Tt>5280?Ps(tt,ht,Tt/5280,gt._getUIString("ScaleControl.Miles")):Ps(tt,ht,Tt,gt._getUIString("ScaleControl.Feet"))}else ot&&ot.unit==="nautical"?Ps(tt,ht,St/1852,gt._getUIString("ScaleControl.NauticalMiles")):St>=1e3?Ps(tt,ht,St/1e3,gt._getUIString("ScaleControl.Kilometers")):Ps(tt,ht,St,gt._getUIString("ScaleControl.Meters"))}function Ps(gt,tt,ot,ht){const dt=function(mt){const wt=Math.pow(10,`${Math.floor(mt)}`.length-1);let St=mt/wt;return St=St>=10?10:St>=5?5:St>=3?3:St>=2?2:St>=1?1:function(Tt){const Ft=Math.pow(10,Math.ceil(-Math.log(Tt)/Math.LN10));return Math.round(Tt*Ft)/Ft}(St),wt*St}(ot);gt.style.width=tt*(dt/ot)+"px",gt.innerHTML=`${dt}&nbsp;${ht}`}const qs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},$m=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Um(gt){if(gt){if(typeof gt=="number"){const tt=Math.round(Math.abs(gt)/Math.SQRT2);return{center:new ct.P(0,0),top:new ct.P(0,gt),"top-left":new ct.P(tt,tt),"top-right":new ct.P(-tt,tt),bottom:new ct.P(0,-gt),"bottom-left":new ct.P(tt,-tt),"bottom-right":new ct.P(-tt,-tt),left:new ct.P(gt,0),right:new ct.P(-gt,0)}}if(gt instanceof ct.P||Array.isArray(gt)){const tt=ct.P.convert(gt);return{center:tt,top:tt,"top-left":tt,"top-right":tt,bottom:tt,"bottom-left":tt,"bottom-right":tt,left:tt,right:tt}}return{center:ct.P.convert(gt.center||[0,0]),top:ct.P.convert(gt.top||[0,0]),"top-left":ct.P.convert(gt["top-left"]||[0,0]),"top-right":ct.P.convert(gt["top-right"]||[0,0]),bottom:ct.P.convert(gt.bottom||[0,0]),"bottom-left":ct.P.convert(gt["bottom-left"]||[0,0]),"bottom-right":ct.P.convert(gt["bottom-right"]||[0,0]),left:ct.P.convert(gt.left||[0,0]),right:ct.P.convert(gt.right||[0,0])}}return Um(new ct.P(0,0))}const D_=At;yt.AJAXError=ct.bh,yt.Evented=ct.E,yt.LngLat=ct.N,yt.MercatorCoordinate=ct.Z,yt.Point=ct.P,yt.addProtocol=ct.bi,yt.config=ct.a,yt.removeProtocol=ct.bj,yt.AttributionControl=Jp,yt.BoxZoomHandler=El,yt.CanvasSource=Tr,yt.CooperativeGesturesHandler=Kp,yt.DoubleClickZoomHandler=Lp,yt.DragPanHandler=ly,yt.DragRotateHandler=cy,yt.EdgeInsets=cp,yt.FullscreenControl=class extends ct.E{constructor(gt={}){super(),this._onFullscreenChange=()=>{var tt;let ot=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((tt=ot==null?void 0:ot.shadowRoot)===null||tt===void 0)&&tt.fullscreenElement;)ot=ot.shadowRoot.fullscreenElement;ot===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,gt&&gt.container&&(gt.container instanceof HTMLElement?this._container=gt.container:ct.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(gt){return this._map=gt,this._container||(this._container=this._map.getContainer()),this._controlContainer=Mt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Mt.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const gt=this._fullscreenButton=Mt.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Mt.create("span","maplibregl-ctrl-icon",gt).setAttribute("aria-hidden","true"),gt.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const gt=this._getTitle();this._fullscreenButton.setAttribute("aria-label",gt),this._fullscreenButton.title=gt}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new ct.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new ct.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},yt.GeoJSONSource=ss,yt.GeolocateControl=class extends ct.E{constructor(gt){super(),this._onSuccess=tt=>{if(this._map){if(this._isOutOfMapMaxBounds(tt))return this._setErrorState(),this.fire(new ct.k("outofmaxbounds",tt)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=tt,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(tt),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(tt),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new ct.k("geolocate",tt)),this._finish()}},this._updateCamera=tt=>{const ot=new ct.N(tt.coords.longitude,tt.coords.latitude),ht=tt.coords.accuracy,dt=this._map.getBearing(),mt=ct.e({bearing:dt},this.options.fitBoundsOptions),wt=On.fromLngLat(ot,ht);this._map.fitBounds(wt,mt,{geolocateSource:!0})},this._updateMarker=tt=>{if(tt){const ot=new ct.N(tt.coords.longitude,tt.coords.latitude);this._accuracyCircleMarker.setLngLat(ot).addTo(this._map),this._userLocationDotMarker.setLngLat(ot).addTo(this._map),this._accuracy=tt.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=tt=>{if(this._map){if(this.options.trackUserLocation)if(tt.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const ot=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=ot,this._geolocateButton.setAttribute("aria-label",ot),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(tt.code===3&&ym)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new ct.k("error",tt)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",tt=>tt.preventDefault()),this._geolocateButton=Mt.create("button","maplibregl-ctrl-geolocate",this._container),Mt.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=tt=>{if(this._map){if(tt===!1){ct.w("Geolocation support is not available so the GeolocateControl will be disabled.");const ot=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=ot,this._geolocateButton.setAttribute("aria-label",ot)}else{const ot=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=ot,this._geolocateButton.setAttribute("aria-label",ot)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Mt.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jm({element:this._dotElement}),this._circleElement=Mt.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jm({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",ot=>{ot.geolocateSource||this._watchState!=="ACTIVE_LOCK"||ot.originalEvent&&ot.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new ct.k("trackuserlocationend")),this.fire(new ct.k("userlocationlostfocus")))})}},this.options=ct.e({},py,gt)}onAdd(gt){return this._map=gt,this._container=Mt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return ct._(this,arguments,void 0,function*(tt=!1){if(gu!==void 0&&!tt)return gu;if(window.navigator.permissions===void 0)return gu=!!window.navigator.geolocation,gu;try{gu=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{gu=!!window.navigator.geolocation}return gu})}().then(tt=>this._finishSetupUI(tt)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Mt.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,_m=0,ym=!1}_isOutOfMapMaxBounds(gt){const tt=this._map.getMaxBounds(),ot=gt.coords;return tt&&(ot.longitude<tt.getWest()||ot.longitude>tt.getEast()||ot.latitude<tt.getSouth()||ot.latitude>tt.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const gt=this._map.getBounds(),tt=gt.getSouthEast(),ot=gt.getNorthEast(),ht=tt.distanceTo(ot),dt=Math.ceil(this._accuracy/(ht/this._map._container.clientHeight)*2);this._circleElement.style.width=`${dt}px`,this._circleElement.style.height=`${dt}px`}trigger(){if(!this._setup)return ct.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new ct.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":_m--,ym=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new ct.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new ct.k("trackuserlocationstart")),this.fire(new ct.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let gt;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),_m++,_m>1?(gt={maximumAge:6e5,timeout:0},ym=!0):(gt=this.options.positionOptions,ym=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,gt)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},yt.Hash=Pp,yt.ImageSource=hr,yt.KeyboardHandler=wu,yt.LngLatBounds=On,yt.LogoControl=k_,yt.Map=class extends uy{constructor(gt){ct.bf.mark(ct.bg.create);const tt=Object.assign(Object.assign({},n0),gt);if(tt.minZoom!=null&&tt.maxZoom!=null&&tt.minZoom>tt.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(tt.minPitch!=null&&tt.maxPitch!=null&&tt.minPitch>tt.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(tt.minPitch!=null&&tt.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(tt.maxPitch!=null&&tt.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Uu(tt.minZoom,tt.maxZoom,tt.minPitch,tt.maxPitch,tt.renderWorldCopies),{bearingSnap:tt.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new yo,this._controls=[],this._mapId=ct.a4(),this._contextLost=ot=>{ot.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new ct.k("webglcontextlost",{originalEvent:ot}))},this._contextRestored=ot=>{this._setupPainter(),this.resize(),this._update(),this.fire(new ct.k("webglcontextrestored",{originalEvent:ot}))},this._onMapScroll=ot=>{if(ot.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=tt.interactive,this._maxTileCacheSize=tt.maxTileCacheSize,this._maxTileCacheZoomLevels=tt.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=tt.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=tt.preserveDrawingBuffer===!0,this._antialias=tt.antialias===!0,this._trackResize=tt.trackResize===!0,this._bearingSnap=tt.bearingSnap,this._refreshExpiredTiles=tt.refreshExpiredTiles===!0,this._fadeDuration=tt.fadeDuration,this._crossSourceCollisions=tt.crossSourceCollisions===!0,this._collectResourceTiming=tt.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},M_),tt.locale),this._clickTolerance=tt.clickTolerance,this._overridePixelRatio=tt.pixelRatio,this._maxCanvasSize=tt.maxCanvasSize,this.transformCameraUpdate=tt.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=tt.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ht.addThrottleControl(()=>this.isMoving()),this._requestManager=new nn(tt.transformRequest),typeof tt.container=="string"){if(this._container=document.getElementById(tt.container),!this._container)throw new Error(`Container '${tt.container}' not found.`)}else{if(!(tt.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=tt.container}if(tt.maxBounds&&this.setMaxBounds(tt.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let ot=!1;const ht=_h(dt=>{this._trackResize&&!this._removed&&(this.resize(dt),this.redraw())},50);this._resizeObserver=new ResizeObserver(dt=>{ot?ht(dt):ot=!0}),this._resizeObserver.observe(this._container)}this.handlers=new C_(this,tt),this._hash=tt.hash&&new Pp(typeof tt.hash=="string"&&tt.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:tt.center,zoom:tt.zoom,bearing:tt.bearing,pitch:tt.pitch}),tt.bounds&&(this.resize(),this.fitBounds(tt.bounds,ct.e({},tt.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=tt.localIdeographFontFamily,this._validateStyle=tt.validateStyle,tt.style&&this.setStyle(tt.style,{localIdeographFontFamily:tt.localIdeographFontFamily}),tt.attributionControl&&this.addControl(new Jp(typeof tt.attributionControl=="boolean"?void 0:tt.attributionControl)),tt.maplibreLogo&&this.addControl(new k_,tt.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",ot=>{this._update(ot.dataType==="style"),this.fire(new ct.k(`${ot.dataType}data`,ot))}),this.on("dataloading",ot=>{this.fire(new ct.k(`${ot.dataType}dataloading`,ot))}),this.on("dataabort",ot=>{this.fire(new ct.k("sourcedataabort",ot))})}_getMapId(){return this._mapId}addControl(gt,tt){if(tt===void 0&&(tt=gt.getDefaultPosition?gt.getDefaultPosition():"top-right"),!gt||!gt.onAdd)return this.fire(new ct.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const ot=gt.onAdd(this);this._controls.push(gt);const ht=this._controlPositions[tt];return tt.indexOf("bottom")!==-1?ht.insertBefore(ot,ht.firstChild):ht.appendChild(ot),this}removeControl(gt){if(!gt||!gt.onRemove)return this.fire(new ct.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const tt=this._controls.indexOf(gt);return tt>-1&&this._controls.splice(tt,1),gt.onRemove(this),this}hasControl(gt){return this._controls.indexOf(gt)>-1}calculateCameraOptionsFromTo(gt,tt,ot,ht){return ht==null&&this.terrain&&(ht=this.terrain.getElevationForLngLatZoom(ot,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(gt,tt,ot,ht)}resize(gt){var tt;const ot=this._containerDimensions(),ht=ot[0],dt=ot[1],mt=this._getClampedPixelRatio(ht,dt);if(this._resizeCanvas(ht,dt,mt),this.painter.resize(ht,dt,mt),this.painter.overLimit()){const St=this.painter.context.gl;this._maxCanvasSize=[St.drawingBufferWidth,St.drawingBufferHeight];const Tt=this._getClampedPixelRatio(ht,dt);this._resizeCanvas(ht,dt,Tt),this.painter.resize(ht,dt,Tt)}this.transform.resize(ht,dt),(tt=this._requestedCameraState)===null||tt===void 0||tt.resize(ht,dt);const wt=!this._moving;return wt&&(this.stop(),this.fire(new ct.k("movestart",gt)).fire(new ct.k("move",gt))),this.fire(new ct.k("resize",gt)),wt&&this.fire(new ct.k("moveend",gt)),this}_getClampedPixelRatio(gt,tt){const{0:ot,1:ht}=this._maxCanvasSize,dt=this.getPixelRatio(),mt=gt*dt,wt=tt*dt;return Math.min(mt>ot?ot/mt:1,wt>ht?ht/wt:1)*dt}getPixelRatio(){var gt;return(gt=this._overridePixelRatio)!==null&&gt!==void 0?gt:devicePixelRatio}setPixelRatio(gt){this._overridePixelRatio=gt,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(gt){return this.transform.setMaxBounds(On.convert(gt)),this._update()}setMinZoom(gt){if((gt=gt??-2)>=-2&&gt<=this.transform.maxZoom)return this.transform.minZoom=gt,this._update(),this.getZoom()<gt&&this.setZoom(gt),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(gt){if((gt=gt??22)>=this.transform.minZoom)return this.transform.maxZoom=gt,this._update(),this.getZoom()>gt&&this.setZoom(gt),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(gt){if((gt=gt??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(gt>=0&&gt<=this.transform.maxPitch)return this.transform.minPitch=gt,this._update(),this.getPitch()<gt&&this.setPitch(gt),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(gt){if((gt=gt??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(gt>=this.transform.minPitch)return this.transform.maxPitch=gt,this._update(),this.getPitch()>gt&&this.setPitch(gt),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(gt){return this.transform.renderWorldCopies=gt,this._update()}project(gt){return this.transform.locationPoint(ct.N.convert(gt),this.style&&this.terrain)}unproject(gt){return this.transform.pointLocation(ct.P.convert(gt),this.terrain)}isMoving(){var gt;return this._moving||((gt=this.handlers)===null||gt===void 0?void 0:gt.isMoving())}isZooming(){var gt;return this._zooming||((gt=this.handlers)===null||gt===void 0?void 0:gt.isZooming())}isRotating(){var gt;return this._rotating||((gt=this.handlers)===null||gt===void 0?void 0:gt.isRotating())}_createDelegatedListener(gt,tt,ot){if(gt==="mouseenter"||gt==="mouseover"){let ht=!1;return{layers:tt,listener:ot,delegates:{mousemove:mt=>{const wt=tt.filter(Tt=>this.getLayer(Tt)),St=wt.length!==0?this.queryRenderedFeatures(mt.point,{layers:wt}):[];St.length?ht||(ht=!0,ot.call(this,new io(gt,this,mt.originalEvent,{features:St}))):ht=!1},mouseout:()=>{ht=!1}}}}if(gt==="mouseleave"||gt==="mouseout"){let ht=!1;return{layers:tt,listener:ot,delegates:{mousemove:wt=>{const St=tt.filter(Tt=>this.getLayer(Tt));(St.length!==0?this.queryRenderedFeatures(wt.point,{layers:St}):[]).length?ht=!0:ht&&(ht=!1,ot.call(this,new io(gt,this,wt.originalEvent)))},mouseout:wt=>{ht&&(ht=!1,ot.call(this,new io(gt,this,wt.originalEvent)))}}}}{const ht=dt=>{const mt=tt.filter(St=>this.getLayer(St)),wt=mt.length!==0?this.queryRenderedFeatures(dt.point,{layers:mt}):[];wt.length&&(dt.features=wt,ot.call(this,dt),delete dt.features)};return{layers:tt,listener:ot,delegates:{[gt]:ht}}}}_saveDelegatedListener(gt,tt){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[gt]=this._delegatedListeners[gt]||[],this._delegatedListeners[gt].push(tt)}_removeDelegatedListener(gt,tt,ot){if(!this._delegatedListeners||!this._delegatedListeners[gt])return;const ht=this._delegatedListeners[gt];for(let dt=0;dt<ht.length;dt++){const mt=ht[dt];if(mt.listener===ot&&mt.layers.length===tt.length&&mt.layers.every(wt=>tt.includes(wt))){for(const wt in mt.delegates)this.off(wt,mt.delegates[wt]);return void ht.splice(dt,1)}}}on(gt,tt,ot){if(ot===void 0)return super.on(gt,tt);const ht=this._createDelegatedListener(gt,typeof tt=="string"?[tt]:tt,ot);this._saveDelegatedListener(gt,ht);for(const dt in ht.delegates)this.on(dt,ht.delegates[dt]);return this}once(gt,tt,ot){if(ot===void 0)return super.once(gt,tt);const ht=typeof tt=="string"?[tt]:tt,dt=this._createDelegatedListener(gt,ht,ot);for(const mt in dt.delegates){const wt=dt.delegates[mt];dt.delegates[mt]=(...St)=>{this._removeDelegatedListener(gt,ht,ot),wt(...St)}}this._saveDelegatedListener(gt,dt);for(const mt in dt.delegates)this.once(mt,dt.delegates[mt]);return this}off(gt,tt,ot){return ot===void 0?super.off(gt,tt):(this._removeDelegatedListener(gt,typeof tt=="string"?[tt]:tt,ot),this)}queryRenderedFeatures(gt,tt){if(!this.style)return[];let ot;const ht=gt instanceof ct.P||Array.isArray(gt),dt=ht?gt:[[0,0],[this.transform.width,this.transform.height]];if(tt=tt||(ht?{}:gt)||{},dt instanceof ct.P||typeof dt[0]=="number")ot=[ct.P.convert(dt)];else{const mt=ct.P.convert(dt[0]),wt=ct.P.convert(dt[1]);ot=[mt,new ct.P(wt.x,mt.y),wt,new ct.P(mt.x,wt.y),mt]}return this.style.queryRenderedFeatures(ot,tt,this.transform)}querySourceFeatures(gt,tt){return this.style.querySourceFeatures(gt,tt)}setStyle(gt,tt){return(tt=ct.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},tt)).diff!==!1&&tt.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&gt?(this._diffStyle(gt,tt),this):(this._localIdeographFontFamily=tt.localIdeographFontFamily,this._updateStyle(gt,tt))}setTransformRequest(gt){return this._requestManager.setTransformRequest(gt),this}_getUIString(gt){const tt=this._locale[gt];if(tt==null)throw new Error(`Missing UI string '${gt}'`);return tt}_updateStyle(gt,tt){if(tt.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(gt,tt));const ot=this.style&&tt.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!gt)),gt?(this.style=new vp(this,tt||{}),this.style.setEventedParent(this,{style:this.style}),typeof gt=="string"?this.style.loadURL(gt,tt,ot):this.style.loadJSON(gt,tt,ot),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new vp(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(gt,tt){if(typeof gt=="string"){const ot=this._requestManager.transformRequest(gt,"Style");ct.h(ot,new AbortController).then(ht=>{this._updateDiff(ht.data,tt)}).catch(ht=>{ht&&this.fire(new ct.j(ht))})}else typeof gt=="object"&&this._updateDiff(gt,tt)}_updateDiff(gt,tt){try{this.style.setState(gt,tt)&&this._update(!0)}catch(ot){ct.w(`Unable to perform style diff: ${ot.message||ot.error||ot}.  Rebuilding the style from scratch.`),this._updateStyle(gt,tt)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():ct.w("There is no style added to the map.")}addSource(gt,tt){return this._lazyInitEmptyStyle(),this.style.addSource(gt,tt),this._update(!0)}isSourceLoaded(gt){const tt=this.style&&this.style.sourceCaches[gt];if(tt!==void 0)return tt.loaded();this.fire(new ct.j(new Error(`There is no source with ID '${gt}'`)))}setTerrain(gt){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),gt){const tt=this.style.sourceCaches[gt.source];if(!tt)throw new Error(`cannot load terrain, because there exists no source with ID: ${gt.source}`);this.terrain===null&&tt.reload();for(const ot in this.style._layers){const ht=this.style._layers[ot];ht.type==="hillshade"&&ht.source===gt.source&&ct.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new R_(this.painter,tt,gt),this.painter.renderToTexture=new hy(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=ot=>{ot.dataType==="style"?this.terrain.sourceCache.freeRtt():ot.dataType==="source"&&ot.tile&&(ot.sourceId!==gt.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(ot.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new ct.k("terrain",{terrain:gt})),this}getTerrain(){var gt,tt;return(tt=(gt=this.terrain)===null||gt===void 0?void 0:gt.options)!==null&&tt!==void 0?tt:null}areTilesLoaded(){const gt=this.style&&this.style.sourceCaches;for(const tt in gt){const ot=gt[tt]._tiles;for(const ht in ot){const dt=ot[ht];if(dt.state!=="loaded"&&dt.state!=="errored")return!1}}return!0}removeSource(gt){return this.style.removeSource(gt),this._update(!0)}getSource(gt){return this.style.getSource(gt)}addImage(gt,tt,ot={}){const{pixelRatio:ht=1,sdf:dt=!1,stretchX:mt,stretchY:wt,content:St,textFitWidth:Tt,textFitHeight:Ft}=ot;if(this._lazyInitEmptyStyle(),!(tt instanceof HTMLImageElement||ct.b(tt))){if(tt.width===void 0||tt.height===void 0)return this.fire(new ct.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:Gt,height:Xt,data:pn}=tt,wn=tt;return this.style.addImage(gt,{data:new ct.R({width:Gt,height:Xt},new Uint8Array(pn)),pixelRatio:ht,stretchX:mt,stretchY:wt,content:St,textFitWidth:Tt,textFitHeight:Ft,sdf:dt,version:0,userImage:wn}),wn.onAdd&&wn.onAdd(this,gt),this}}{const{width:Gt,height:Xt,data:pn}=Lt.getImageData(tt);this.style.addImage(gt,{data:new ct.R({width:Gt,height:Xt},pn),pixelRatio:ht,stretchX:mt,stretchY:wt,content:St,textFitWidth:Tt,textFitHeight:Ft,sdf:dt,version:0})}}updateImage(gt,tt){const ot=this.style.getImage(gt);if(!ot)return this.fire(new ct.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const ht=tt instanceof HTMLImageElement||ct.b(tt)?Lt.getImageData(tt):tt,{width:dt,height:mt,data:wt}=ht;if(dt===void 0||mt===void 0)return this.fire(new ct.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(dt!==ot.data.width||mt!==ot.data.height)return this.fire(new ct.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const St=!(tt instanceof HTMLImageElement||ct.b(tt));return ot.data.replace(wt,St),this.style.updateImage(gt,ot),this}getImage(gt){return this.style.getImage(gt)}hasImage(gt){return gt?!!this.style.getImage(gt):(this.fire(new ct.j(new Error("Missing required image id"))),!1)}removeImage(gt){this.style.removeImage(gt)}loadImage(gt){return Ht.getImage(this._requestManager.transformRequest(gt,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(gt,tt){return this._lazyInitEmptyStyle(),this.style.addLayer(gt,tt),this._update(!0)}moveLayer(gt,tt){return this.style.moveLayer(gt,tt),this._update(!0)}removeLayer(gt){return this.style.removeLayer(gt),this._update(!0)}getLayer(gt){return this.style.getLayer(gt)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(gt,tt,ot){return this.style.setLayerZoomRange(gt,tt,ot),this._update(!0)}setFilter(gt,tt,ot={}){return this.style.setFilter(gt,tt,ot),this._update(!0)}getFilter(gt){return this.style.getFilter(gt)}setPaintProperty(gt,tt,ot,ht={}){return this.style.setPaintProperty(gt,tt,ot,ht),this._update(!0)}getPaintProperty(gt,tt){return this.style.getPaintProperty(gt,tt)}setLayoutProperty(gt,tt,ot,ht={}){return this.style.setLayoutProperty(gt,tt,ot,ht),this._update(!0)}getLayoutProperty(gt,tt){return this.style.getLayoutProperty(gt,tt)}setGlyphs(gt,tt={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(gt,tt),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(gt,tt,ot={}){return this._lazyInitEmptyStyle(),this.style.addSprite(gt,tt,ot,ht=>{ht||this._update(!0)}),this}removeSprite(gt){return this._lazyInitEmptyStyle(),this.style.removeSprite(gt),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(gt,tt={}){return this._lazyInitEmptyStyle(),this.style.setSprite(gt,tt,ot=>{ot||this._update(!0)}),this}setLight(gt,tt={}){return this._lazyInitEmptyStyle(),this.style.setLight(gt,tt),this._update(!0)}getLight(){return this.style.getLight()}setSky(gt){return this._lazyInitEmptyStyle(),this.style.setSky(gt),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(gt,tt){return this.style.setFeatureState(gt,tt),this._update()}removeFeatureState(gt,tt){return this.style.removeFeatureState(gt,tt),this._update()}getFeatureState(gt){return this.style.getFeatureState(gt)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let gt=0,tt=0;return this._container&&(gt=this._container.clientWidth||400,tt=this._container.clientHeight||300),[gt,tt]}_setupContainer(){const gt=this._container;gt.classList.add("maplibregl-map");const tt=this._canvasContainer=Mt.create("div","maplibregl-canvas-container",gt);this._interactive&&tt.classList.add("maplibregl-interactive"),this._canvas=Mt.create("canvas","maplibregl-canvas",tt),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const ot=this._containerDimensions(),ht=this._getClampedPixelRatio(ot[0],ot[1]);this._resizeCanvas(ot[0],ot[1],ht);const dt=this._controlContainer=Mt.create("div","maplibregl-control-container",gt),mt=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(wt=>{mt[wt]=Mt.create("div",`maplibregl-ctrl-${wt} `,dt)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(gt,tt,ot){this._canvas.width=Math.floor(ot*gt),this._canvas.height=Math.floor(ot*tt),this._canvas.style.width=`${gt}px`,this._canvas.style.height=`${tt}px`}_setupPainter(){const gt={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let tt=null;this._canvas.addEventListener("webglcontextcreationerror",ht=>{tt={requestedAttributes:gt},ht&&(tt.statusMessage=ht.statusMessage,tt.type=ht.type)},{once:!0});const ot=this._canvas.getContext("webgl2",gt)||this._canvas.getContext("webgl",gt);if(!ot){const ht="Failed to initialize WebGL";throw tt?(tt.message=ht,new Error(JSON.stringify(tt))):new Error(ht)}this.painter=new Cp(ot,this.transform),Qt.testSupport(ot)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(gt){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||gt,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(gt){return this._update(),this._renderTaskQueue.add(gt)}_cancelRenderFrame(gt){this._renderTaskQueue.remove(gt)}_render(gt){const tt=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(gt),this._removed)return;let ot=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const dt=this.transform.zoom,mt=Lt.now();this.style.zoomHistory.update(dt,mt);const wt=new ct.z(dt,{now:mt,fadeDuration:tt,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),St=wt.crossFadingFactor();St===1&&St===this._crossFadingFactor||(ot=!0,this._crossFadingFactor=St),this.style.update(wt)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,tt,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:tt,showPadding:this.showPadding}),this.fire(new ct.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ct.bf.mark(ct.bg.load),this.fire(new ct.k("load"))),this.style&&(this.style.hasTransitions()||ot)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const ht=this._sourcesDirty||this._styleDirty||this._placementDirty;return ht||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new ct.k("idle")),!this._loaded||this._fullyLoaded||ht||(this._fullyLoaded=!0,ct.bf.mark(ct.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var gt;this._hash&&this._hash.remove();for(const ot of this._controls)ot.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ht.removeThrottleControl(this._imageQueueHandle),(gt=this._resizeObserver)===null||gt===void 0||gt.disconnect();const tt=this.painter.context.gl.getExtension("WEBGL_lose_context");tt!=null&&tt.loseContext&&tt.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Mt.remove(this._canvasContainer),Mt.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),ct.bf.clearMetrics(),this._removed=!0,this.fire(new ct.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Lt.frameAsync(this._frameRequest).then(gt=>{ct.bf.frame(gt),this._frameRequest=null,this._render(gt)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(gt){this._showTileBoundaries!==gt&&(this._showTileBoundaries=gt,this._update())}get showPadding(){return!!this._showPadding}set showPadding(gt){this._showPadding!==gt&&(this._showPadding=gt,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(gt){this._showCollisionBoxes!==gt&&(this._showCollisionBoxes=gt,gt?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(gt){this._showOverdrawInspector!==gt&&(this._showOverdrawInspector=gt,this._update())}get repaint(){return!!this._repaint}set repaint(gt){this._repaint!==gt&&(this._repaint=gt,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(gt){this._vertices=gt,this._update()}get version(){return dy}getCameraTargetElevation(){return this.transform.elevation}},yt.MapMouseEvent=io,yt.MapTouchEvent=ho,yt.MapWheelEvent=uo,yt.Marker=jm,yt.NavigationControl=class{constructor(gt){this._updateZoomButtons=()=>{const tt=this._map.getZoom(),ot=tt===this._map.getMaxZoom(),ht=tt===this._map.getMinZoom();this._zoomInButton.disabled=ot,this._zoomOutButton.disabled=ht,this._zoomInButton.setAttribute("aria-disabled",ot.toString()),this._zoomOutButton.setAttribute("aria-disabled",ht.toString())},this._rotateCompassArrow=()=>{const tt=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=tt},this._setButtonTitle=(tt,ot)=>{const ht=this._map._getUIString(`NavigationControl.${ot}`);tt.title=ht,tt.setAttribute("aria-label",ht)},this.options=ct.e({},i0,gt),this._container=Mt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",tt=>tt.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",tt=>this._map.zoomIn({},{originalEvent:tt})),Mt.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",tt=>this._map.zoomOut({},{originalEvent:tt})),Mt.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",tt=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:tt}):this._map.resetNorth({},{originalEvent:tt})}),this._compassIcon=Mt.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(gt){return this._map=gt,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new r0(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Mt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(gt,tt){const ot=Mt.create("button",gt,this._container);return ot.type="button",ot.addEventListener("click",tt),ot}},yt.Popup=class extends ct.E{constructor(gt){super(),this.remove=()=>(this._content&&Mt.remove(this._content),this._container&&(Mt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new ct.k("close"))),this),this._onMouseUp=tt=>{this._update(tt.point)},this._onMouseMove=tt=>{this._update(tt.point)},this._onDrag=tt=>{this._update(tt.point)},this._update=tt=>{var ot;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Mt.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Mt.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const St of this.options.className.split(" "))this._container.classList.add(St);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Vo(this._lngLat,this._flatPos,this._map.transform):(ot=this._lngLat)===null||ot===void 0?void 0:ot.wrap(),this._trackPointer&&!tt)return;const ht=this._flatPos=this._pos=this._trackPointer&&tt?tt:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&tt?tt:this._map.transform.locationPoint(this._lngLat));let dt=this.options.anchor;const mt=Um(this.options.offset);if(!dt){const St=this._container.offsetWidth,Tt=this._container.offsetHeight;let Ft;Ft=ht.y+mt.bottom.y<Tt?["top"]:ht.y>this._map.transform.height-Tt?["bottom"]:[],ht.x<St/2?Ft.push("left"):ht.x>this._map.transform.width-St/2&&Ft.push("right"),dt=Ft.length===0?"bottom":Ft.join("-")}let wt=ht.add(mt[dt]);this.options.subpixelPositioning||(wt=wt.round()),Mt.setTransform(this._container,`${_f[dt]} translate(${wt.x}px,${wt.y}px)`),Bm(this._container,dt,"popup")},this._onClose=()=>{this.remove()},this.options=ct.e(Object.create(qs),gt)}addTo(gt){return this._map&&this.remove(),this._map=gt,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new ct.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(gt){return this._lngLat=ct.N.convert(gt),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(gt){return this.setDOMContent(document.createTextNode(gt))}setHTML(gt){const tt=document.createDocumentFragment(),ot=document.createElement("body");let ht;for(ot.innerHTML=gt;ht=ot.firstChild,ht;)tt.appendChild(ht);return this.setDOMContent(tt)}getMaxWidth(){var gt;return(gt=this._container)===null||gt===void 0?void 0:gt.style.maxWidth}setMaxWidth(gt){return this.options.maxWidth=gt,this._update(),this}setDOMContent(gt){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Mt.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(gt),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(gt){return this._container&&this._container.classList.add(gt),this}removeClassName(gt){return this._container&&this._container.classList.remove(gt),this}setOffset(gt){return this.options.offset=gt,this._update(),this}toggleClassName(gt){if(this._container)return this._container.classList.toggle(gt)}setSubpixelPositioning(gt){this.options.subpixelPositioning=gt}_createCloseButton(){this.options.closeButton&&(this._closeButton=Mt.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const gt=this._container.querySelector($m);gt&&gt.focus()}},yt.RasterDEMTileSource=jr,yt.RasterTileSource=Jr,yt.ScaleControl=class{constructor(gt){this._onMove=()=>{vm(this._map,this._container,this.options)},this.setUnit=tt=>{this.options.unit=tt,vm(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Hu),gt)}getDefaultPosition(){return"bottom-left"}onAdd(gt){return this._map=gt,this._container=Mt.create("div","maplibregl-ctrl maplibregl-ctrl-scale",gt.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Mt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},yt.ScrollZoomHandler=Mu,yt.Style=vp,yt.TerrainControl=class{constructor(gt){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=gt}onAdd(gt){return this._map=gt,this._container=Mt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Mt.create("button","maplibregl-ctrl-terrain",this._container),Mt.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Mt.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},yt.TwoFingersTouchPitchHandler=Zp,yt.TwoFingersTouchRotateHandler=S_,yt.TwoFingersTouchZoomHandler=w_,yt.TwoFingersTouchZoomRotateHandler=T_,yt.VectorTileSource=ts,yt.VideoSource=or,yt.addSourceType=(gt,tt)=>ct._(void 0,void 0,void 0,function*(){if(qr(gt))throw new Error(`A source type called "${gt}" already exists.`);((ot,ht)=>{Zr[ot]=ht})(gt,tt)}),yt.clearPrewarmedResources=function(){const gt=rn;gt&&(gt.isPreloaded()&&gt.numActive()===1?(gt.release(Nt),rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},yt.getMaxParallelImageRequests=function(){return ct.a.MAX_PARALLEL_IMAGE_REQUESTS},yt.getRTLTextPluginStatus=function(){return Ts().getRTLTextPluginStatus()},yt.getVersion=function(){return D_},yt.getWorkerCount=function(){return Zt.workerCount},yt.getWorkerUrl=function(){return ct.a.WORKER_URL},yt.importScriptInWorkers=function(gt){return jn().broadcast("IS",gt)},yt.prewarm=function(){En().acquire(Nt)},yt.setMaxParallelImageRequests=function(gt){ct.a.MAX_PARALLEL_IMAGE_REQUESTS=gt},yt.setRTLTextPlugin=function(gt,tt){return Ts().setRTLTextPlugin(gt,tt)},yt.setWorkerCount=function(gt){Zt.workerCount=gt},yt.setWorkerUrl=function(gt){ct.a.WORKER_URL=gt}});var pt=rt;return pt})})(maplibreGl);var maplibreGlExports=maplibreGl.exports;const maplibregl=getDefaultExportFromCjs(maplibreGlExports),MapComponent=()=>{const _e=reactExports.useRef(null),et=reactExports.useRef(null),[rt,at]=reactExports.useState(1e3),[ut,pt]=reactExports.useState([]),yt=(Pt,kt,Lt)=>{const Mt=Lt,Qt={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[ct(kt[0],kt[1],Mt,64)]}}]};Pt.getSource("radius-circle")?Pt.getSource("radius-circle").setData(Qt):(Pt.addSource("radius-circle",{type:"geojson",data:Qt}),Pt.addLayer({id:"radius-circle",type:"fill",source:"radius-circle",paint:{"fill-color":"#00bf60","fill-opacity":.3}}))},ct=(Pt,kt,Lt,Mt)=>{const Qt=[],Jt=Lt/111320,sn=Lt/(111.32*1e3),tn=Pt,Bt=kt;for(let zt=0;zt<Mt;zt++){const Ht=zt*360/Mt,nn=tn+Jt*Math.cos(Ht*Math.PI/180),Ot=Bt+sn*Math.sin(Ht*Math.PI/180);Qt.push([nn,Ot])}return Qt.push(Qt[0]),Qt},At=async(Pt,kt)=>{try{const Lt=await fetch("/api/users/Getshops",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:Pt,longitude:kt,maxDistance:rt})});if(!Lt.ok)throw new Error("Failed to fetch shops");const Mt=await Lt.json();pt(Mt.map(Qt=>({id:Qt._id,lat:Qt.latitude,lng:Qt.longitude,title:Qt.fullName,description:Qt.description||"No description available",img:Qt.profilePic||"https://via.placeholder.com/100"})))}catch(Lt){console.error("Error fetching shops: ",Lt.message)}};return reactExports.useEffect(()=>{if(et.current)return;const Pt=new maplibregl.Map({container:_e.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:[83.2111287,17.8177412],zoom:13});return et.current=Pt,navigator.geolocation?navigator.geolocation.getCurrentPosition(kt=>{const Lt=kt.coords.latitude,Mt=kt.coords.longitude;new maplibregl.Marker({color:"red"}).setLngLat([Mt,Lt]).setPopup(new maplibregl.Popup().setText("Your Location")).addTo(Pt),Pt.once("load",()=>{Pt.flyTo({center:[Mt,Lt],zoom:14,speed:1.5,curve:1,essential:!0})}),yt(Pt,[Mt,Lt],rt),At(Lt,Mt)}):alert("Geolocation is not supported by this browser."),Pt.addControl(new maplibregl.NavigationControl,"bottom-right"),Pt.addControl(new maplibregl.FullscreenControl,"bottom-right"),Pt.addControl(new maplibregl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,container:document.getElementById("geolocate-control-container")}),"bottom-right"),()=>{Pt.remove(),et.current=null}},[]),reactExports.useEffect(()=>{et.current&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(Pt=>{const kt=Pt.coords.latitude,Lt=Pt.coords.longitude;yt(et.current,[Lt,kt],rt),At(kt,Lt)})},[rt]),reactExports.useEffect(()=>{if(!et.current||ut.length===0)return;const Pt=et.current;ut.forEach(kt=>{new maplibregl.Marker({color:"blue"}).setLngLat([kt.lng,kt.lat]).setPopup(new maplibregl.Popup().setHTML(`
            <div class="px-3 z-50 text-black items-center flex flex-col">
              <img class="object-cover" src="${kt.img}" alt="Shop Image" style="width: 500px; height: 200px; border-radius: 8px; margin-bottom: 8px;" />
              <h3 class="font-bold text-2xl w-full">${kt.title}</h3>
              <p class="w-full">${kt.description}</p>
              <a href="/?id=${kt.id}" class="bg-blue-500 px-5 py-2 my-3 font-bold text-white">Order Shop</a>
            </div>
          `)).addTo(Pt).getElement().addEventListener("click",()=>{Pt.flyTo({center:[kt.lng,kt.lat],zoom:14,speed:1.5,curve:1,essential:!0})})})},[ut]),jsxRuntimeExports.jsxs("div",{className:"w-full h-full relative",children:[jsxRuntimeExports.jsx("div",{id:"map geolocate-control-container",ref:_e,className:"w-full h-full rounded-lg shadow-lg"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-2 left-2 z-10 bg-white pl-2  rounded-lg shadow-md flex  sm:flex-row justify-center items-center gap-4",style:{maxWidth:"400px"},children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium whitespace-nowrap text-gray-700",children:"Search Radius:"}),jsxRuntimeExports.jsx("input",{type:"number",value:rt,onChange:Pt=>at(parseInt(Pt.target.value,10)),placeholder:"Enter radius",className:"w-fit p-2 bg-white text-black border rounded-lg shadow focus:outline-none "})]})]})},Orders=()=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold mb-5",children:"Orders"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-2",children:"Order 1"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Order Date: 2021-10-10"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Status: Pending"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Quantity: 2"}),jsxRuntimeExports.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-3 py-1",children:"View"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-2",children:"Order 2"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Order Date: 2021-10-10"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Status: Pending"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Quantity: 2"}),jsxRuntimeExports.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-3 py-1",children:"View"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-2",children:"Order 3"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Order Date: 2021-10-10"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Status: Pending"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-2",children:"Quantity: 2"}),jsxRuntimeExports.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-3 py-1",children:"View"})]})]})]});function App(){const{authUser:_e}=useAuthContext();return jsxRuntimeExports.jsxs("div",{className:"  h-screen flex items-center justify-center",children:[jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:_e?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(Home,{})}):jsxRuntimeExports.jsx(Navigate,{to:"/login"})}),jsxRuntimeExports.jsx(Route,{path:"/login",element:_e?jsxRuntimeExports.jsx(Navigate,{to:"/"}):jsxRuntimeExports.jsx(Login,{})}),jsxRuntimeExports.jsx(Route,{path:"/signup",element:_e?jsxRuntimeExports.jsx(Navigate,{to:"/"}):jsxRuntimeExports.jsx(SignUp,{})}),jsxRuntimeExports.jsx(Route,{path:"/map",element:_e?jsxRuntimeExports.jsx(MapComponent,{}):jsxRuntimeExports.jsx(Navigate,{to:"/"})}),jsxRuntimeExports.jsx(Route,{path:"/orders",element:_e?jsxRuntimeExports.jsx(Orders,{}):jsxRuntimeExports.jsx(Navigate,{to:"/"})})]}),jsxRuntimeExports.jsx(Ie,{})]})}client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(BrowserRouter,{children:jsxRuntimeExports.jsx(AuthContextProvider,{children:jsxRuntimeExports.jsx(SocketContextProvider,{children:jsxRuntimeExports.jsx(App,{})})})})}));
